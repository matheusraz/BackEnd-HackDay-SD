<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Esper Reference</title><link rel="stylesheet" href="css/espertech.css" type="text/css"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL-NS Stylesheets V1.74.0"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><div class="book" lang="en-US"><div class="titlepage"><div><p xmlns:d="http://docbook.org/ns/docbook" id="title"><a href="http://www.espertech.com" class="site_href"><strong>www.espertech.com</strong></a><a href="http://www.espertech.com/esper/documentation.php" class="doc_href"><strong>Documentation</strong></a></p><div><h1 class="title"><a id="d0e1"/>Esper Reference</h1></div><div><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="authorgroup"><div class="authors">by <span xmlns="http://www.w3.org/1999/xhtml" class="orgname"><a class="link" href="http://www.espertech.com" target="">EsperTech Inc.</a></span></div><div class="editors"/><div class="others"/></div></div><div><p class="releaseinfo">Version 7.1.0</p></div><div><p class="copyright">Copyright Â© 2018 EsperTech Inc.</p></div></div><hr/></div><div class="toc"><dl><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#gettingstarted">1. Getting Started</a></span></dt><dd><dl><dt><span class="sect1"><a href="#gettingstarted_introcep">1.1. Introduction to Complex Event Processing</a></span></dt><dt><span class="sect1"><a href="#gettingstarted_steps">1.2. Steps</a></span></dt><dd><dl><dt><span class="sect2"><a href="#gettingstarted_steps_1">1.2.1. Step One: Setting up Classpath</a></span></dt><dt><span class="sect2"><a href="#gettingstarted_steps_2">1.2.2. Step Two: Obtain Engine Instance</a></span></dt><dt><span class="sect2"><a href="#gettingstarted_steps_3">1.2.3. Step Three: Provide Information on Input Events</a></span></dt><dt><span class="sect2"><a href="#gettingstarted_steps_4">1.2.4. Step Four: Create EPL Statements and Attach Callbacks</a></span></dt><dt><span class="sect2"><a href="#gettingstarted_steps_5">1.2.5. Step Five: Send Events</a></span></dt></dl></dd><dt><span class="sect1"><a href="#required_3rd_party">1.3. Required 3rd Party Libraries</a></span></dt></dl></dd><dt><span class="chapter"><a href="#processingmodel">2. Basic Concepts</a></span></dt><dd><dl><dt><span class="sect1"><a href="#processingmodel_intro">2.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicselect">2.2. Basic Select</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicaggregation">2.3. Basic Aggregation</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicfilter">2.4. Basic Filter</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicfilterwithagg">2.5. Basic Filter and Aggregation</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicwindow">2.6. Basic Data Window</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicwindowagg">2.7. Basic Data Window and Aggregation</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicfilterwindowagg">2.8. Basic Filter, Data Window and Aggregation</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicwhereclause">2.9. Basic Where-Clause</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basictimewindow">2.10. Basic Time Window and Aggregation</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicpartition">2.11. Basic Partitioned Query</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicoutputlimited">2.12. Basic Output-Rate-Limited Query</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicpartitionedandoutputlimited">2.13. Basic Partitioned and Output-Rate-Limited Query</a></span></dt><dt><span class="sect1"><a href="#processingmodel_namedwindows">2.14. Basic Named Windows and Tables</a></span></dt><dt><span class="sect1"><a href="#processingmodel_aggregation">2.15. Basic Aggregated Query Types</a></span></dt><dd><dl><dt><span class="sect2"><a href="#processingmodel_aggregation_batch_unagg">2.15.1. Un-Aggregated and Un-Grouped</a></span></dt><dt><span class="sect2"><a href="#processingmodel_aggregation_batch_full_agg">2.15.2. Fully Aggregated and Un-Grouped</a></span></dt><dt><span class="sect2"><a href="#processingmodel_aggregation_batch_event_agg">2.15.3. Aggregated and Un-Grouped</a></span></dt><dt><span class="sect2"><a href="#processingmodel_aggregation_batch_group_agg">2.15.4. Fully Aggregated and Grouped</a></span></dt><dt><span class="sect2"><a href="#processingmodel_aggregation_batch_event_agg_group">2.15.5. Aggregated and Grouped</a></span></dt></dl></dd><dt><span class="sect1"><a href="#processingmodel_matchrecognizepattern">2.16. Basic Match-Recognize Patterns</a></span></dt><dt><span class="sect1"><a href="#processingmodel_eplpattern">2.17. Basic EPL Patterns</a></span></dt><dt><span class="sect1"><a href="#processingmodel_indexes">2.18. Basic Indexes</a></span></dt><dd><dl><dt><span class="sect2"><a href="#processingmodel_indexes_kinds">2.18.1. Index Kinds</a></span></dt><dt><span class="sect2"><a href="#processingmodel_indexes_filterindexes">2.18.2. Filter Indexes</a></span></dt><dt><span class="sect2"><a href="#processingmodel_indexes_eventindexes">2.18.3. Event Indexes</a></span></dt></dl></dd><dt><span class="sect1"><a href="#processingmodel_3valuedlogic">2.19. Basic Null</a></span></dt></dl></dd><dt><span class="chapter"><a href="#event_representation">3. Event Representations</a></span></dt><dd><dl><dt><span class="sect1"><a href="#eventrep_intro">3.1. Event Underlying Java Objects</a></span></dt><dt><span class="sect1"><a href="#eventrep-properties">3.2. Event Properties</a></span></dt><dd><dl><dt><span class="sect2"><a href="#eventrep-properties-escaping">3.2.1. Escape Characters</a></span></dt><dt><span class="sect2"><a href="#eventrep-properties-expression">3.2.2. Expression as Key or Index Value</a></span></dt></dl></dd><dt><span class="sect1"><a href="#eventrep-dyncproperties">3.3. Dynamic Event Properties</a></span></dt><dt><span class="sect1"><a href="#eventrep-fragment">3.4. Fragment and Fragment Type</a></span></dt><dt><span class="sect1"><a href="#eventrep_comparing">3.5. Comparing Event Representations</a></span></dt><dd><dl><dt><span class="sect2"><a href="#eventrep_comparing_incoming">3.5.1. Incoming Events</a></span></dt><dt><span class="sect2"><a href="#eventrep_comparing_outgoing">3.5.2. Outgoing Events</a></span></dt><dt><span class="sect2"><a href="#eventrep_comparing_schema">3.5.3. Schema</a></span></dt><dt><span class="sect2"><a href="#eventrep_comparing_advantages">3.5.4. Side-by-Side</a></span></dt></dl></dd><dt><span class="sect1"><a href="#eventrep-generictuple">3.6. Support for Generic Tuples</a></span></dt><dt><span class="sect1"><a href="#eventrep-plug-in">3.7. Additional Event Representations</a></span></dt><dt><span class="sect1"><a href="#eventrep-update">3.8. Updating, Merging and Versioning Events</a></span></dt><dt><span class="sect1"><a href="#eventrep-coarse">3.9. Coarse-Grained Events</a></span></dt><dt><span class="sect1"><a href="#eventrep-insertinto">3.10. Event Objects Instantiated and Populated by Insert Into</a></span></dt></dl></dd><dt><span class="chapter"><a href="#context">4. Context and Context Partitions</a></span></dt><dd><dl><dt><span class="sect1"><a href="#context_intro">4.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#context_decl">4.2. Context Declaration</a></span></dt><dd><dl><dt><span class="sect2"><a href="#context_decl_props">4.2.1. Context-Provided Properties</a></span></dt><dt><span class="sect2"><a href="#context_def_keyed">4.2.2. Keyed Segmented Context</a></span></dt><dt><span class="sect2"><a href="#context_def_hashed">4.2.3. Hash Segmented Context</a></span></dt><dt><span class="sect2"><a href="#context_def_category">4.2.4. Category Segmented Context</a></span></dt><dt><span class="sect2"><a href="#context_def_nonoverlapping">4.2.5. Non-Overlapping Context</a></span></dt><dt><span class="sect2"><a href="#context_def_overlapping">4.2.6. Overlapping Context</a></span></dt><dt><span class="sect2"><a href="#context_def_condition">4.2.7. Context Conditions</a></span></dt></dl></dd><dt><span class="sect1"><a href="#context_nesting">4.3. Context Nesting</a></span></dt><dd><dl><dt><span class="sect2"><a href="#context_nesting_walkthru">4.3.1. Nested Context Sample Walk-Through</a></span></dt><dt><span class="sect2"><a href="#context_nesting_builtin">4.3.2. Built-In Nested Context Properties</a></span></dt></dl></dd><dt><span class="sect1"><a href="#context_other">4.4. Partitioning Without Context Declaration</a></span></dt><dt><span class="sect1"><a href="#context_outputterminated">4.5. Output When a Context Partition Ends or Terminates</a></span></dt><dt><span class="sect1"><a href="#context_named_windows">4.6. Context and Named Window</a></span></dt><dt><span class="sect1"><a href="#context_tables">4.7. Context and Tables</a></span></dt><dt><span class="sect1"><a href="#context_variables">4.8. Context and Variables</a></span></dt><dt><span class="sect1"><a href="#context_selection">4.9. Operations on Specific Context Partitions</a></span></dt></dl></dd><dt><span class="chapter"><a href="#epl_clauses">5. EPL Reference: Clauses</a></span></dt><dd><dl><dt><span class="sect1"><a href="#epl-intro">5.1. EPL Introduction</a></span></dt><dt><span class="sect1"><a href="#epl-select-syntax">5.2. EPL Syntax</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-syntax-time-periods">5.2.1. Specifying Time Periods</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-comments">5.2.2. Using Comments</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-keywords">5.2.3. Reserved Keywords</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-escapestring">5.2.4. Escaping Strings</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-datatype">5.2.5. Data Types</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-javaconst">5.2.6. Using Constants and Enum Types</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-annotation">5.2.7. Annotation</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-expression-alias">5.2.8. Expression Alias</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-expression-decl">5.2.9. Expression Declaration</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-script-decl">5.2.10. Script Declaration</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-context-decl">5.2.11. Referring to a Context</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-select-list">5.3. Choosing Event Properties and Events: The Select Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-select-all-props">5.3.1. Choosing the Event Itself: Select *</a></span></dt><dt><span class="sect2"><a href="#epl-select-event-props">5.3.2. Choosing Specific Event Properties</a></span></dt><dt><span class="sect2"><a href="#epl-select-expressions">5.3.3. Expressions</a></span></dt><dt><span class="sect2"><a href="#epl-select-renaming">5.3.4. Renaming Event Properties</a></span></dt><dt><span class="sect2"><a href="#epl-select-all-join">5.3.5. Choosing Event Properties and Events in a Join</a></span></dt><dt><span class="sect2"><a href="#epl-select-pattern">5.3.6. Choosing Event Properties and Events From a Pattern</a></span></dt><dt><span class="sect2"><a href="#epl-select-using-istream-rstream">5.3.7. Selecting Insert and Remove Stream Events</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-prefix-propsandstream">5.3.8. Qualifying Property Names and Stream Names</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-distinct">5.3.9. Select Distinct</a></span></dt><dt><span class="sect2"><a href="#epl-transposefunc">5.3.10. Transposing an Expression Result to a Stream</a></span></dt><dt><span class="sect2"><a href="#epl-selecteventbean">5.3.11. Selecting EventBean Instead of Underlying Event</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-from-clause">5.4. Specifying Event Streams: The From Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-from-clause-filter">5.4.1. Filter-Based Event Streams</a></span></dt><dt><span class="sect2"><a href="#epl-from-clause-patterns">5.4.2. Pattern-Based Event Streams</a></span></dt><dt><span class="sect2"><a href="#epl-from-clause-window-spec">5.4.3. Specifying Data Windows</a></span></dt><dt><span class="sect2"><a href="#epl-from-clause-view-multidatawindow">5.4.4. Multiple Data Windows</a></span></dt><dt><span class="sect2"><a href="#epl-from-clause-stream-name">5.4.5. Using the Stream Name</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-where-clause">5.5. Specifying Search Conditions: The Where Clause</a></span></dt><dt><span class="sect1"><a href="#epl-grouping-aggregating">5.6. Aggregates and Grouping: The Group-By Clause and the Having Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-grouping-aggregate-functions">5.6.1. Using Aggregate Functions</a></span></dt><dt><span class="sect2"><a href="#epl-grouping-group-by">5.6.2. Organizing Statement Results into Groups: The Group-by Clause</a></span></dt><dt><span class="sect2"><a href="#epl-grouping-rollup">5.6.3. Using Group-By with Rollup, Cube and Grouping Sets</a></span></dt><dt><span class="sect2"><a href="#epl-grouping-agglocal">5.6.4. Specifying Grouping for Each Aggregation Function</a></span></dt><dt><span class="sect2"><a href="#epl-grouping-aggfilter">5.6.5. Specifying a Filter Expression for Each Aggregation Function</a></span></dt><dt><span class="sect2"><a href="#epl-grouping-having">5.6.6. Selecting Groups of Events: The Having Clause</a></span></dt><dt><span class="sect2"><a href="#epl-filter-where-grouping-having-interactions">5.6.7. How the Stream Filter, Where, Group By and Having-Clauses Interact</a></span></dt><dt><span class="sect2"><a href="#epl-group-by-versus-view">5.6.8. Comparing Keyed Segmented Context, the Group By Clause and #groupwin for Data Windows</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-output-rate">5.7. Stabilizing and Controlling Output: The Output Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-output-options">5.7.1. Output Clause Options</a></span></dt><dt><span class="sect2"><a href="#epl-output-groupby">5.7.2. Aggregation, Group By, Having and Output Clause Interaction</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-order-by">5.8. Sorting Output: the Order By Clause</a></span></dt><dt><span class="sect1"><a href="#epl-limit">5.9. Limiting Row Count: the Limit Clause</a></span></dt><dt><span class="sect1"><a href="#epl-insert-into">5.10. Merging Streams and Continuous Insertion: The Insert Into Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#insert-into-property-transpose">5.10.1. Transposing a Property to a Stream</a></span></dt><dt><span class="sect2"><a href="#insert-into-merging-columns">5.10.2. Merging Streams by Event Type</a></span></dt><dt><span class="sect2"><a href="#insert-into-merging-types">5.10.3. Merging Disparate Types of Events: Variant Streams</a></span></dt><dt><span class="sect2"><a href="#insert-into-decorated">5.10.4. Decorated Events</a></span></dt><dt><span class="sect2"><a href="#insert-into-eventasproperty">5.10.5. Event as a Property</a></span></dt><dt><span class="sect2"><a href="#insert-into-populate">5.10.6. Instantiating and Populating an Underlying Event Object</a></span></dt><dt><span class="sect2"><a href="#insert-into-expression">5.10.7. Transposing an Expression Result</a></span></dt><dt><span class="sect2"><a href="#insert-into-reconcile">5.10.8. Select-Clause Expression and Inserted-Into Column Event Type</a></span></dt><dt><span class="sect2"><a href="#insert-into-typewithoutprops">5.10.9. Insert Into for Event Types Without Properties</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-subqueries">5.11. Subqueries</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-subqueries-exists">5.11.1. The 'Exists' Keyword</a></span></dt><dt><span class="sect2"><a href="#epl-subqueries-in">5.11.2. The 'In' and 'Not In' Keywords</a></span></dt><dt><span class="sect2"><a href="#epl-subqueries-anysome">5.11.3. The 'Any' and 'Some' Keywords</a></span></dt><dt><span class="sect2"><a href="#epl-subqueries-all">5.11.4. The 'All' Keyword</a></span></dt><dt><span class="sect2"><a href="#epl-subqueries-groupby">5.11.5. Subquery With Group By Clause</a></span></dt><dt><span class="sect2"><a href="#epl-subqueries-multicolumn">5.11.6. Multi-Column Selection</a></span></dt><dt><span class="sect2"><a href="#epl-subqueries-multirow">5.11.7. Multi-Row Selection</a></span></dt><dt><span class="sect2"><a href="#epl-subqueries-hints">5.11.8. Hints Related to Subqueries</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-join">5.12. Joining Event Streams</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-join-introducing">5.12.1. Introducing Joins</a></span></dt><dt><span class="sect2"><a href="#epl-join-inner">5.12.2. Inner (Default) Joins</a></span></dt><dt><span class="sect2"><a href="#epl-outerjoin">5.12.3. Outer, Left and Right Joins</a></span></dt><dt><span class="sect2"><a href="#epl-unidirectional">5.12.4. Unidirectional Joins</a></span></dt><dt><span class="sect2"><a href="#epl-unidirectional-fullouterjoin">5.12.5. Unidirectional Full Outer Joins</a></span></dt><dt><span class="sect2"><a href="#epl-join-hints">5.12.6. Hints Related to Joins</a></span></dt></dl></dd><dt><span class="sect1"><a href="#histdata_overview">5.13. Accessing Relational Data via SQL</a></span></dt><dd><dl><dt><span class="sect2"><a href="#histdata_join">5.13.1. Joining SQL Query Results</a></span></dt><dt><span class="sect2"><a href="#histdata_join_where">5.13.2. SQL Query and the EPL Where Clause</a></span></dt><dt><span class="sect2"><a href="#histdata_outerjoin">5.13.3. Outer Joins With SQL Queries</a></span></dt><dt><span class="sect2"><a href="#histdata_polling_pattern">5.13.4. Using Patterns to Request (Poll) Data</a></span></dt><dt><span class="sect2"><a href="#histdata_polling">5.13.5. Polling SQL Queries via Iterator</a></span></dt><dt><span class="sect2"><a href="#histdata_implementation">5.13.6. JDBC Implementation Overview</a></span></dt><dt><span class="sect2"><a href="#histdata_nometadata">5.13.7. Oracle Drivers and No-Metadata Workaround</a></span></dt><dt><span class="sect2"><a href="#histdata_convert_cols">5.13.8. SQL Input Parameter and Column Output Conversion</a></span></dt><dt><span class="sect2"><a href="#histdata_convert_row">5.13.9. SQL Row POJO Conversion</a></span></dt></dl></dd><dt><span class="sect1"><a href="#joining_method">5.14. Accessing Non-Relational Data via Method, Script or UDF Invocation</a></span></dt><dd><dl><dt><span class="sect2"><a href="#joining_method_syntax">5.14.1. Joining Method, Script or UDF Invocation Results</a></span></dt><dt><span class="sect2"><a href="#joining_method_polling">5.14.2. Polling Invocation Results via Iterator</a></span></dt><dt><span class="sect2"><a href="#joining_method_exposing">5.14.3. Providing the Method</a></span></dt><dt><span class="sect2"><a href="#joining_method_map">5.14.4. Using a Map Return Type</a></span></dt><dt><span class="sect2"><a href="#joining_method_oa">5.14.5. Using a Object Array Return Type</a></span></dt><dt><span class="sect2"><a href="#joining_method_eventbeanarray">5.14.6. Using an EventBean Return Type</a></span></dt><dt><span class="sect2"><a href="#joining_method_script">5.14.7. Providing the Script</a></span></dt><dt><span class="sect2"><a href="#joining_method_udf">5.14.8. Providing the UDF</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl_createschema">5.15. Declaring an Event Type: Create Schema</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl_createschema_properties">5.15.1. Declare an Event Type by Providing Names and Types</a></span></dt><dt><span class="sect2"><a href="#epl_createschema_class">5.15.2. Declare an Event Type by Providing a Class Name</a></span></dt><dt><span class="sect2"><a href="#epl_createschema_variant">5.15.3. Declare a Variant Stream</a></span></dt></dl></dd><dt><span class="sect1"><a href="#split_overview">5.16. Splitting and Duplicating Streams</a></span></dt><dd><dl><dt><span class="sect2"><a href="#split_containedeventselect">5.16.1. Generating Marker Events for Contained Events</a></span></dt></dl></dd><dt><span class="sect1"><a href="#variables_overview">5.17. Variables and Constants</a></span></dt><dd><dl><dt><span class="sect2"><a href="#variable_create">5.17.1. Creating Variables: The Create Variable Clause</a></span></dt><dt><span class="sect2"><a href="#variable_set">5.17.2. Setting Variable Values: The On Set Clause</a></span></dt><dt><span class="sect2"><a href="#variable_using">5.17.3. Using Variables</a></span></dt><dt><span class="sect2"><a href="#variable_object">5.17.4. Object-Type Variables</a></span></dt><dt><span class="sect2"><a href="#variable_eventtype">5.17.5. Class and Event-Type Variables</a></span></dt></dl></dd><dt><span class="sect1"><a href="#create-exprglobal">5.18. Declaring Global Expressions, Aliases and Scripts: Create Expression</a></span></dt><dd><dl><dt><span class="sect2"><a href="#create-exprglobal-alias">5.18.1. Global Expression Aliases</a></span></dt><dt><span class="sect2"><a href="#create-exprglobal-expr">5.18.2. Global Expression Declarations</a></span></dt><dt><span class="sect2"><a href="#create-exprglobal-script">5.18.3. Global Scripts</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-containedeventselect">5.19. Contained-Event Selection</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-containedeventselect-select">5.19.1. Select-Clause in a Contained-Event Selection</a></span></dt><dt><span class="sect2"><a href="#epl-containedeventselect-where">5.19.2. Where Clause in a Contained-Event Selection</a></span></dt><dt><span class="sect2"><a href="#epl-containedeventselect-join">5.19.3. Contained-Event Selection and Joins</a></span></dt><dt><span class="sect2"><a href="#epl-containedeventselect-pojoexample">5.19.4. Sentence and Word Example</a></span></dt><dt><span class="sect2"><a href="#epl-containedeventselect-examples">5.19.5. More Examples</a></span></dt><dt><span class="sect2"><a href="#epl-containedeventselect-arrayofprimitive">5.19.6. Contained Expression Returning an Array of Property Values</a></span></dt><dt><span class="sect2"><a href="#epl-containedeventselect-arrayofevent">5.19.7. Contained Expression Returning an Array of EventBean</a></span></dt><dt><span class="sect2"><a href="#epl-containedeventselect-beginend">5.19.8. Generating Marker Events Such as a Begin and End Event</a></span></dt><dt><span class="sect2"><a href="#epl-containedeventselect-restrictions">5.19.9. Contained-Event Limitations</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-update">5.20. Updating an Insert Stream: The Update IStream Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-update-object">5.20.1. Immutability and Updates</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-grouped-delivery">5.21. Controlling Event Delivery : The For Clause</a></span></dt></dl></dd><dt><span class="chapter"><a href="#nwtable">6. EPL Reference: Named Windows and Tables</a></span></dt><dd><dl><dt><span class="sect1"><a href="#nwtable-overview">6.1. Overview</a></span></dt><dd><dl><dt><span class="sect2"><a href="#nwtable-overview-namedwindow">6.1.1. Named Window Overview</a></span></dt><dt><span class="sect2"><a href="#nwtable-overview-table">6.1.2. Table Overview</a></span></dt><dt><span class="sect2"><a href="#nwtable-overview-compare">6.1.3. Comparing Named Windows and Tables</a></span></dt></dl></dd><dt><span class="sect1"><a href="#nwtable-namedwindow">6.2. Named Window Usage</a></span></dt><dd><dl><dt><span class="sect2"><a href="#named_create">6.2.1. Creating Named Windows: The Create Window clause</a></span></dt><dt><span class="sect2"><a href="#named_inserting">6.2.2. Inserting Into Named Windows</a></span></dt><dt><span class="sect2"><a href="#named_selecting">6.2.3. Selecting From Named Windows</a></span></dt></dl></dd><dt><span class="sect1"><a href="#nwtable-table">6.3. Table Usage</a></span></dt><dd><dl><dt><span class="sect2"><a href="#table_create">6.3.1. Creating Tables: The Create Table Clause</a></span></dt><dt><span class="sect2"><a href="#table_agginto">6.3.2. Aggregating Into Table Rows: The Into Table Clause</a></span></dt><dt><span class="sect2"><a href="#table_keyedaccess">6.3.3. Table Column Keyed-Access Expressions</a></span></dt><dt><span class="sect2"><a href="#nwtable-insert">6.3.4. Inserting Into Tables</a></span></dt><dt><span class="sect2"><a href="#nwtable-table-selecting">6.3.5. Selecting From Tables</a></span></dt></dl></dd><dt><span class="sect1"><a href="#named_querying">6.4. Triggered Select: The On Select Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#named_querying_namedwin">6.4.1. Notes on On-Select With Named Windows</a></span></dt><dt><span class="sect2"><a href="#named_querying_table">6.4.2. Notes on On-Select With Tables</a></span></dt><dt><span class="sect2"><a href="#named_query">6.4.3. On-Select Compared to Join</a></span></dt></dl></dd><dt><span class="sect1"><a href="#named_selectdelete">6.5. Triggered Select+Delete: The On Select Delete Clause</a></span></dt><dt><span class="sect1"><a href="#named_update">6.6. Updating Data: The On Update Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#named_update_namedwin">6.6.1. Notes on On-Update With Named Windows</a></span></dt><dt><span class="sect2"><a href="#named_update_table">6.6.2. Notes on On-Update With Tables</a></span></dt></dl></dd><dt><span class="sect1"><a href="#named_delete">6.7. Deleting Data: The On Delete Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#named_delete_pattern">6.7.1. Using Patterns in the On-Delete Clause</a></span></dt><dt><span class="sect2"><a href="#named_delete_namedwin">6.7.2. Notes on On-Delete With Named Windows</a></span></dt><dt><span class="sect2"><a href="#named_delete_table">6.7.3. Notes on On-Update With Tables</a></span></dt></dl></dd><dt><span class="sect1"><a href="#named_upsert">6.8. Triggered Upsert Using the On-Merge Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#named_upsert_insertunmatched">6.8.1. On-Merge Insert</a></span></dt><dt><span class="sect2"><a href="#named_upsert_upsert">6.8.2. On-Merge Update, Delete, Select (Upsert)</a></span></dt><dt><span class="sect2"><a href="#named_merge_namedwin">6.8.3. Notes on On-Merge With Named Windows</a></span></dt><dt><span class="sect2"><a href="#named_merge_table">6.8.4. Notes on On-Merge With Tables</a></span></dt></dl></dd><dt><span class="sect1"><a href="#named_explicit_index">6.9. Explicitly Indexing Named Windows and Tables</a></span></dt><dt><span class="sect1"><a href="#nwtable-faf">6.10. Using Fire-and-Forget Queries With Named Windows and Tables</a></span></dt><dd><dl><dt><span class="sect2"><a href="#named_insertfaf">6.10.1. Inserting Data</a></span></dt><dt><span class="sect2"><a href="#named_update_faf">6.10.2. Updating Data</a></span></dt><dt><span class="sect2"><a href="#named_delete_faf">6.10.3. Deleting Data</a></span></dt></dl></dd><dt><span class="sect1"><a href="#named_versioning">6.11. Versioning and Revision Event Type Use With Named Windows</a></span></dt><dt><span class="sect1"><a href="#named-eventasproperty">6.12. Events as Property</a></span></dt></dl></dd><dt><span class="chapter"><a href="#event_patterns">7. EPL Reference: Patterns</a></span></dt><dd><dl><dt><span class="sect1"><a href="#event-pattern-intro">7.1. Event Pattern Overview</a></span></dt><dt><span class="sect1"><a href="#pattern-how-to-use">7.2. How to Use Patterns</a></span></dt><dd><dl><dt><span class="sect2"><a href="#pattern-howto-syntax">7.2.1. Pattern Syntax</a></span></dt><dt><span class="sect2"><a href="#pattern-in-eql">7.2.2. Patterns in EPL</a></span></dt><dt><span class="sect2"><a href="#patterns-howto-subscribe">7.2.3. Subscribing to Pattern Events</a></span></dt><dt><span class="sect2"><a href="#pattern-howto-pull-data">7.2.4. Pulling Data From Patterns</a></span></dt><dt><span class="sect2"><a href="#pattern-errorreporting">7.2.5. Pattern Error Reporting</a></span></dt><dt><span class="sect2"><a href="#patterns-howto-suppress">7.2.6. Suppressing Same-Event Matches</a></span></dt><dt><span class="sect2"><a href="#patterns-howto-discard">7.2.7. Discarding Partially Completed Patterns</a></span></dt></dl></dd><dt><span class="sect1"><a href="#pattern-op-precedence">7.3. Operator Precedence</a></span></dt><dt><span class="sect1"><a href="#pattern-filter">7.4. Filter Expressions in Patterns</a></span></dt><dd><dl><dt><span class="sect2"><a href="#pattern-filter-performance">7.4.1. Filter Expressions and Filter Indexes</a></span></dt><dt><span class="sect2"><a href="#pattern-filter-consumption">7.4.2. Controlling Event Consumption</a></span></dt><dt><span class="sect2"><a href="#pattern-filter-namedwindow">7.4.3. Use With Named Windows and Tables</a></span></dt></dl></dd><dt><span class="sect1"><a href="#pattern-operators">7.5. Pattern Operators</a></span></dt><dd><dl><dt><span class="sect2"><a href="#pattern-logical-every">7.5.1. Every</a></span></dt><dt><span class="sect2"><a href="#pattern-logical-everydistinct">7.5.2. Every-Distinct</a></span></dt><dt><span class="sect2"><a href="#pattern-repeat">7.5.3. Repeat</a></span></dt><dt><span class="sect2"><a href="#pattern-repeatuntil">7.5.4. Repeat-Until</a></span></dt><dt><span class="sect2"><a href="#pattern-logical-and">7.5.5. And</a></span></dt><dt><span class="sect2"><a href="#pattern-logical-or">7.5.6. Or</a></span></dt><dt><span class="sect2"><a href="#pattern-logical-not">7.5.7. Not</a></span></dt><dt><span class="sect2"><a href="#pattern-temporal-followed-by">7.5.8. Followed-By</a></span></dt><dt><span class="sect2"><a href="#pattern-guards">7.5.9. Pattern Guards</a></span></dt></dl></dd><dt><span class="sect1"><a href="#pattern-atoms">7.6. Pattern Atoms</a></span></dt><dd><dl><dt><span class="sect2"><a href="#pattern-atom-filter">7.6.1. Filter Atoms</a></span></dt><dt><span class="sect2"><a href="#pattern-atom-time">7.6.2. Observer Atoms Overview</a></span></dt><dt><span class="sect2"><a href="#pattern-timer-interval">7.6.3. Interval (timer:interval)</a></span></dt><dt><span class="sect2"><a href="#pattern-timer-at">7.6.4. Crontab (timer:at)</a></span></dt><dt><span class="sect2"><a href="#pattern-timer-schedule">7.6.5. Schedule (timer:schedule)</a></span></dt></dl></dd><dt><span class="sect1"><a href="#pattern-walkthrough">7.7. Event Pattern Walkthrough</a></span></dt></dl></dd><dt><span class="chapter"><a href="#match-recognize">8. EPL Reference: Match Recognize</a></span></dt><dd><dl><dt><span class="sect1"><a href="#match-recognize-intro">8.1. Overview</a></span></dt><dt><span class="sect1"><a href="#match-recognize-compare-pattern">8.2. Comparison of Match Recognize and EPL Patterns</a></span></dt><dt><span class="sect1"><a href="#match-recognize-syntax">8.3. Syntax</a></span></dt><dd><dl><dt><span class="sect2"><a href="#match-recognize-syntax-example">8.3.1. Syntax Example</a></span></dt></dl></dd><dt><span class="sect1"><a href="#match-recognize-patternops">8.4. Pattern and Pattern Operators</a></span></dt><dd><dl><dt><span class="sect2"><a href="#match-recognize-patternops-precedence">8.4.1. Operator Precedence</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-concatenation">8.4.2. Concatenation</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-alternation">8.4.3. Alternation</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-quantifiers">8.4.4. Quantifiers Overview</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-permutation">8.4.5. Permutations</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-singletonvars">8.4.6. Variables Can Be Singleton or Group</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-iterator">8.4.7. Eliminating Duplicate Matches</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-quantifiers-reluctant">8.4.8. Greedy or Reluctant</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-quantifiers-oneormore">8.4.9. Quantifier - One or More (+ and +?)</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-quantifiers-zeroormore">8.4.10. Quantifier - Zero or More (* and *?)</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-quantifiers-zeroorone">8.4.11. Quantifier - Zero or One (? and ??)</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-quantifiersrepeat-exactlyn">8.4.12. Repetition - Exactly N Matches</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-quantifiersrepeat-n_or_more">8.4.13. Repetition - N or More Matches</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-quantifiersrepeat-between_n_and_m">8.4.14. Repetition - Between N and M Matches</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-quantifiersrepeat-">8.4.15. Repetition - Between Zero and M Matches</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-repeat-equiv">8.4.16. Repetition Equivalence</a></span></dt></dl></dd><dt><span class="sect1"><a href="#match-recognize-define">8.5. Define Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#match-recognize-define-prev">8.5.1. The Prev Operator</a></span></dt></dl></dd><dt><span class="sect1"><a href="#match-recognize-measure">8.6. Measure Clause</a></span></dt><dt><span class="sect1"><a href="#match-recognize-datawindow">8.7. Datawindow-Bound</a></span></dt><dt><span class="sect1"><a href="#match-recognize-interval">8.8. Interval</a></span></dt><dt><span class="sect1"><a href="#match-recognize-intervalorterminated">8.9. Interval-or-Terminated</a></span></dt><dt><span class="sect1"><a href="#match-recognize-variant">8.10. Use With Different Event Types</a></span></dt><dt><span class="sect1"><a href="#match-recognize-state-max">8.11. Limiting Engine-Wide State Count</a></span></dt><dt><span class="sect1"><a href="#match-recognize-limitations">8.12. Limitations</a></span></dt></dl></dd><dt><span class="chapter"><a href="#epl-operator">9. EPL Reference: Operators</a></span></dt><dd><dl><dt><span class="sect1"><a href="#epl-operator-ref-arithmetic">9.1. Arithmetic Operators</a></span></dt><dt><span class="sect1"><a href="#epl-operator-ref-logical">9.2. Logical and Comparison Operators</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-operator-ref-logical-null">9.2.1. Null-Value Comparison Operators</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-operator-ref-string">9.3. Concatenation Operators</a></span></dt><dt><span class="sect1"><a href="#epl-operator-ref-binary">9.4. Binary Operators</a></span></dt><dt><span class="sect1"><a href="#epl-operator-ref-array">9.5. Array Definition Operator</a></span></dt><dt><span class="sect1"><a href="#epl-operator-ref-dot">9.6. Dot Operator</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-operator-ref-dot-duck">9.6.1. Duck Typing</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-operator-ref-keyword-in">9.7. The 'In' Keyword</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-operator-ref-keyword-in-range">9.7.1. 'In' for Range Selection</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-operator-ref-keyword-between">9.8. The 'Between' Keyword</a></span></dt><dt><span class="sect1"><a href="#epl-operator-ref-keyword-like">9.9. The 'Like' Keyword</a></span></dt><dt><span class="sect1"><a href="#epl-operator-ref-keyword-regexp">9.10. The 'Regexp' Keyword</a></span></dt><dt><span class="sect1"><a href="#epl-operator-anysome">9.11. The 'Any' and 'Some' Keywords</a></span></dt><dt><span class="sect1"><a href="#epl-operator-all">9.12. The 'All' Keyword</a></span></dt><dt><span class="sect1"><a href="#epl-operator-new">9.13. The 'New' Keyword</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-operator-new-datastructure">9.13.1. Using 'New' to Populate a Data Structure</a></span></dt><dt><span class="sect2"><a href="#epl-operator-new-instance">9.13.2. Using 'New' to Instantiate an Object</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#functionreference">10. EPL Reference: Functions</a></span></dt><dd><dl><dt><span class="sect1"><a href="#epl-single-row-function-ref">10.1. Single-Row Function Reference</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-single-row-function-ref-case">10.1.1. The Case Control Flow Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-cast">10.1.2. The Cast Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-ref-coalesce">10.1.3. The Coalesce Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-ref-currentevaluationcontext">10.1.4. The Current_Evaluation_Context Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-ref-currenttime">10.1.5. The Current_Timestamp Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-exists">10.1.6. The Exists Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-grouping">10.1.7. The Grouping Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-groupingid">10.1.8. The Grouping_Id Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-instanceof">10.1.9. The Instance-Of Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-istream">10.1.10. The Istream Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-ref-minmax">10.1.11. The Min and Max Functions</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-ref-previous">10.1.12. The Previous Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-ref-previoustail">10.1.13. The Previous-Tail Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-ref-previouswindow">10.1.14. The Previous-Window Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-ref-previouscount">10.1.15. The Previous-Count Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-ref-prior">10.1.16. The Prior Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-typeof">10.1.17. The Type-Of Function</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-function-aggregation">10.2. Aggregation Functions</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-function-aggregation-std">10.2.1. SQL-Standard Functions</a></span></dt><dt><span class="sect2"><a href="#epl-function-aggregation-event">10.2.2. Event Aggregation Functions</a></span></dt><dt><span class="sect2"><a href="#epl-function-aggregation-approx">10.2.3. Approximation Aggregation Functions</a></span></dt><dt><span class="sect2"><a href="#epl-function-aggregation-add">10.2.4. Additional Aggregation Functions</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-function-user-defined">10.3. User-Defined Functions</a></span></dt><dt><span class="sect1"><a href="#functionreference-transpose">10.4. Select-Clause Transpose Function</a></span></dt><dd><dl><dt><span class="sect2"><a href="#functionreference-transpose-insert-into">10.4.1. Transpose with Insert-Into</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#enumerationreference">11. EPL Reference: Enumeration Methods</a></span></dt><dd><dl><dt><span class="sect1"><a href="#enumeration-intro">11.1. Overview</a></span></dt><dt><span class="sect1"><a href="#enumeration-exampledata">11.2. Example Events</a></span></dt><dt><span class="sect1"><a href="#enumeration-howtouse">11.3. How to Use</a></span></dt><dd><dl><dt><span class="sect2"><a href="#enumeration-howtouse-synopsis">11.3.1. Syntax</a></span></dt><dt><span class="sect2"><a href="#enumeration-howtouse-example">11.3.2. Introductory Examples</a></span></dt><dt><span class="sect2"><a href="#enumeration-howtouse-output">11.3.3. Input, Output and Limitations</a></span></dt></dl></dd><dt><span class="sect1"><a href="#enumeration-inputs">11.4. Inputs</a></span></dt><dd><dl><dt><span class="sect2"><a href="#enumeration-ds-subquery">11.4.1. Subquery Results</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-namedwindow">11.4.2. Named Window</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-table">11.4.3. Table</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-property">11.4.4. Event Property and Insert-Into With @eventbean</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-accessagg">11.4.5. Event Aggregation Function</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-prev">11.4.6. Prev, Prevwindow and Prevtail Single-Row Functions as Input</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-udf">11.4.7. Single-Row Function, User-Defined Function and Enum Types</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-lambda">11.4.8. Declared Expression</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-variable">11.4.9. Variables</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-substitution">11.4.10. Substitution Parameters</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-matchrecog">11.4.11. Match-Recognize Group Variable</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-eplpattern">11.4.12. Pattern Repeat and Repeat-Until Operators</a></span></dt></dl></dd><dt><span class="sect1"><a href="#enumeration-example">11.5. Example</a></span></dt><dt><span class="sect1"><a href="#enumeration-method">11.6. Reference</a></span></dt><dd><dl><dt><span class="sect2"><a href="#enumeration-method-aggregate">11.6.1. Aggregate</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-allof">11.6.2. AllOf</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-anyof">11.6.3. AnyOf</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-average">11.6.4. Average</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-countof">11.6.5. CountOf</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-distinctof">11.6.6. DistinctOf</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-except">11.6.7. Except</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-firstof">11.6.8. FirstOf</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-groupby">11.6.9. GroupBy</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-intersect">11.6.10. Intersect</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-lastof">11.6.11. LastOf</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-leastfrequent">11.6.12. LeastFrequent</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-max">11.6.13. Max</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-maxby">11.6.14. MaxBy</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-min">11.6.15. Min</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-minby">11.6.16. MinBy</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-mostfrequent">11.6.17. MostFrequent</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-orderby">11.6.18. OrderBy and OrderByDesc</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-reverse">11.6.19. Reverse</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-selectfrom">11.6.20. SelectFrom</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-sequenceequal">11.6.21. SequenceEqual</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-sumof">11.6.22. SumOf</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-take">11.6.23. Take</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-takelast">11.6.24. TakeLast</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-takewhile">11.6.25. TakeWhile</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-takewhilelast">11.6.26. TakeWhileLast</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-tomap">11.6.27. ToMap</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-union">11.6.28. Union</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-where">11.6.29. Where</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#datetimereference">12. EPL Reference: Date-Time Methods</a></span></dt><dd><dl><dt><span class="sect1"><a href="#datetime-intro">12.1. Overview</a></span></dt><dt><span class="sect1"><a href="#datetime-howtouse">12.2. How to Use</a></span></dt><dd><dl><dt><span class="sect2"><a href="#datetime-howtouse-synopsis">12.2.1. Syntax</a></span></dt></dl></dd><dt><span class="sect1"><a href="#datetime-method-calref">12.3. Calendar and Formatting Reference</a></span></dt><dd><dl><dt><span class="sect2"><a href="#datetime-method-between">12.3.1. Between</a></span></dt><dt><span class="sect2"><a href="#datetime-method-format">12.3.2. Format</a></span></dt><dt><span class="sect2"><a href="#datetime-method-get">12.3.3. Get (By Field)</a></span></dt><dt><span class="sect2"><a href="#datetime-method-getitem">12.3.4. Get (By Name) </a></span></dt><dt><span class="sect2"><a href="#datetime-method-minus">12.3.5. Minus</a></span></dt><dt><span class="sect2"><a href="#datetime-method-plus">12.3.6. Plus</a></span></dt><dt><span class="sect2"><a href="#datetime-method-roundceiling">12.3.7. RoundCeiling</a></span></dt><dt><span class="sect2"><a href="#datetime-method-roundfloor">12.3.8. RoundFloor</a></span></dt><dt><span class="sect2"><a href="#datetime-method-roundhalf">12.3.9. RoundHalf</a></span></dt><dt><span class="sect2"><a href="#datetime-method-set">12.3.10. Set (By Field)</a></span></dt><dt><span class="sect2"><a href="#datetime-method-withdate">12.3.11. WithDate</a></span></dt><dt><span class="sect2"><a href="#datetime-method-withmin">12.3.12. WithMax</a></span></dt><dt><span class="sect2"><a href="#datetime-method-withmax">12.3.13. WithMin</a></span></dt><dt><span class="sect2"><a href="#datetime-method-withtime">12.3.14. WithTime</a></span></dt><dt><span class="sect2"><a href="#datetime-method-tocal">12.3.15. ToCalendar</a></span></dt><dt><span class="sect2"><a href="#datetime-method-todate">12.3.16. ToDate</a></span></dt><dt><span class="sect2"><a href="#datetime-method-tomsec">12.3.17. ToMillisec</a></span></dt></dl></dd><dt><span class="sect1"><a href="#datetime-method-intervalref">12.4. Interval Algebra Reference</a></span></dt><dd><dl><dt><span class="sect2"><a href="#datetime-method-examples">12.4.1. Examples</a></span></dt><dt><span class="sect2"><a href="#datetime-method-parameters">12.4.2. Interval Algebra Parameters</a></span></dt><dt><span class="sect2"><a href="#datetime-method-performance">12.4.3. Performance</a></span></dt><dt><span class="sect2"><a href="#datetime-method-limitations">12.4.4. Limitations</a></span></dt><dt><span class="sect2"><a href="#datetime-method-after">12.4.5. After</a></span></dt><dt><span class="sect2"><a href="#datetime-method-before">12.4.6. Before</a></span></dt><dt><span class="sect2"><a href="#datetime-method-coincides">12.4.7. Coincides</a></span></dt><dt><span class="sect2"><a href="#datetime-method-during">12.4.8. During</a></span></dt><dt><span class="sect2"><a href="#datetime-method-finishes">12.4.9. Finishes</a></span></dt><dt><span class="sect2"><a href="#datetime-method-finishedby">12.4.10. Finished By</a></span></dt><dt><span class="sect2"><a href="#datetime-method-includes">12.4.11. Includes</a></span></dt><dt><span class="sect2"><a href="#datetime-method-meets">12.4.12. Meets</a></span></dt><dt><span class="sect2"><a href="#datetime-method-metby">12.4.13. Met By</a></span></dt><dt><span class="sect2"><a href="#datetime-method-overlaps">12.4.14. Overlaps</a></span></dt><dt><span class="sect2"><a href="#datetime-method-overlappedby">12.4.15. Overlapped By</a></span></dt><dt><span class="sect2"><a href="#datetime-method-starts">12.4.16. Starts</a></span></dt><dt><span class="sect2"><a href="#datetime-method-startedby">12.4.17. Started By</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#epl-views">13. EPL Reference: Data Windows</a></span></dt><dd><dl><dt><span class="sect1"><a href="#view-parameters">13.1. A Note on Data Window Name and Parameters</a></span></dt><dt><span class="sect1"><a href="#view-batchwindows">13.2. A Note on Batch Windows</a></span></dt><dt><span class="sect1"><a href="#win-views">13.3. Data Windows</a></span></dt><dd><dl><dt><span class="sect2"><a href="#view-win-length">13.3.1. Length Window (length or win:length)</a></span></dt><dt><span class="sect2"><a href="#view-win-length-batch">13.3.2. Length Batch Window (length_batch or win:length_batch)</a></span></dt><dt><span class="sect2"><a href="#view-win-time">13.3.3. Time Window (time or win:time)</a></span></dt><dt><span class="sect2"><a href="#view-win-ext_time">13.3.4. Externally-timed Window (ext_timed or win:ext_timed)</a></span></dt><dt><span class="sect2"><a href="#view-win-time-batch">13.3.5. Time batch Window (time_batch or win:time_batch)</a></span></dt><dt><span class="sect2"><a href="#view-win-ext-time-batch">13.3.6. Externally-timed Batch Window (ext_timed_batch or win:ext_timed_batch)</a></span></dt><dt><span class="sect2"><a href="#view-win-time-length-batch">13.3.7. Time-Length Combination Batch Window (time_length_batch or win:time_length_batch)</a></span></dt><dt><span class="sect2"><a href="#view-win-time-accumulating">13.3.8. Time-Accumulating Window (time_accum or win:time_accum)</a></span></dt><dt><span class="sect2"><a href="#view-win-keepall">13.3.9. Keep-All Window (keepall or win:keepall)</a></span></dt><dt><span class="sect2"><a href="#view-win-firstlength">13.3.10. First Length Window(firstlength or win:firstlength)</a></span></dt><dt><span class="sect2"><a href="#view-win-firsttime">13.3.11. First Time Window (firsttime or win:firsttime)</a></span></dt><dt><span class="sect2"><a href="#view-win-expr">13.3.12. Expiry Expression Window (expr or win:expr)</a></span></dt><dt><span class="sect2"><a href="#view-win-exprbatch">13.3.13. Expiry Expression Batch Window (expr_batch or win:expr_batch)</a></span></dt><dt><span class="sect2"><a href="#view-std-unique">13.3.14. Unique Window (unique or std:unique)</a></span></dt><dt><span class="sect2"><a href="#view-std-groupwin">13.3.15. Grouped Data Window (groupwin or std:groupwin)</a></span></dt><dt><span class="sect2"><a href="#view-std-last">13.3.16. Last Event Window (std:lastevent)</a></span></dt><dt><span class="sect2"><a href="#view-std-first">13.3.17. First Event Window (firstevent or std:firstevent)</a></span></dt><dt><span class="sect2"><a href="#view-std-firstunique">13.3.18. First Unique Window (firstunique or std:firstunique)</a></span></dt><dt><span class="sect2"><a href="#view-ext-sort">13.3.19. Sorted Window (sort or ext:sort)</a></span></dt><dt><span class="sect2"><a href="#view-ext-rank">13.3.20. Ranked Window (rank or ext:rank)</a></span></dt><dt><span class="sect2"><a href="#view-time-order">13.3.21. Time-Order Window (time_order or ext:time_order)</a></span></dt><dt><span class="sect2"><a href="#view-timetolive">13.3.22. Time-To-Live Window (timetolive or ext:timetolive)</a></span></dt></dl></dd><dt><span class="sect1"><a href="#stat-views">13.4. Special Derived-Value Windows</a></span></dt><dd><dl><dt><span class="sect2"><a href="#view-std-size">13.4.1. Size Derived-Value Window (size) or std:size)</a></span></dt><dt><span class="sect2"><a href="#view-stat-uni">13.4.2. Univariate Statistics Derived-Value Window (uni or stat:uni)</a></span></dt><dt><span class="sect2"><a href="#view-stat-linest">13.4.3. Regression Derived-Value Window (linest or stat:linest)</a></span></dt><dt><span class="sect2"><a href="#view-stat-correl">13.4.4. Correlation Derived-Value Window (correl or stat:correl)</a></span></dt><dt><span class="sect2"><a href="#view-stat-weightedavg">13.4.5. Weighted Average Derived-Value Window (weighted_avg or stat:weighted_avg)</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#api">14. API Reference</a></span></dt><dd><dl><dt><span class="sect1"><a href="#api-reference-intro">14.1. API Overview</a></span></dt><dt><span class="sect1"><a href="#api-engine-instances">14.2. The Service Provider Interface</a></span></dt><dt><span class="sect1"><a href="#api-administrative">14.3. The Administrative Interface</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-admin-creating">14.3.1. Creating Statements</a></span></dt><dt><span class="sect2"><a href="#api-receive-results">14.3.2. Receiving Statement Results</a></span></dt><dt><span class="sect2"><a href="#api-admin-subscriber">14.3.3. Setting a Subscriber Object</a></span></dt><dt><span class="sect2"><a href="#api-admin-listeners">14.3.4. Adding Listeners</a></span></dt><dt><span class="sect2"><a href="#api-admin-iterators">14.3.5. Using Iterators</a></span></dt><dt><span class="sect2"><a href="#api-admin-mgmt-stmt">14.3.6. Managing Statements</a></span></dt><dt><span class="sect2"><a href="#api-admin-atomic">14.3.7. Atomic Statement Management</a></span></dt><dt><span class="sect2"><a href="#api-admin-runtime-config">14.3.8. Runtime Configuration</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-runtime">14.4. The Runtime Interface</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-runtime-eventsender">14.4.1. Event Sender</a></span></dt><dt><span class="sect2"><a href="#api-runtime-unmatched">14.4.2. Receiving Unmatched Events</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-ondemand">14.5. On-Demand Fire-and-Forget Query Execution</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-ondemand-single">14.5.1. On-Demand Query Single Execution</a></span></dt><dt><span class="sect2"><a href="#api-ondemand-prepared">14.5.2. On-Demand Query Prepared Unparameterized Execution</a></span></dt><dt><span class="sect2"><a href="#api-ondemand-preparedparameterized">14.5.3. On-Demand Query Prepared Parameterized Execution</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-event">14.6. Event and Event Type</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-eventtype">14.6.1. Event Type Metadata</a></span></dt><dt><span class="sect2"><a href="#api-eventbean">14.6.2. Event Object</a></span></dt><dt><span class="sect2"><a href="#api-eventtype-query">14.6.3. Query Example</a></span></dt><dt><span class="sect2"><a href="#api-eventtype-pattern">14.6.4. Pattern Example</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-threading">14.7. Engine Threading and Concurrency</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-threading-advanced">14.7.1. Advanced Threading</a></span></dt><dt><span class="sect2"><a href="#api-processingorder">14.7.2. Processing Order</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-controlling-time">14.8. Controlling Time-Keeping</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-controlling-time-span">14.8.1. Controlling Time Using Time Span Events</a></span></dt><dt><span class="sect2"><a href="#api-time-resolution">14.8.2. Time Resolution and Time Unit</a></span></dt><dt><span class="sect2"><a href="#api-time-internal">14.8.3. Internal Timer Based on JVM System Time</a></span></dt><dt><span class="sect2"><a href="#api-controlling-time-spi">14.8.4. Additional Time-Related APIs</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-isolatedservice">14.9. Service Isolation</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-isolatedservice-overview">14.9.1. Overview</a></span></dt><dt><span class="sect2"><a href="#api-isolatedruntime-suspend">14.9.2. Example: Suspending a Statement</a></span></dt><dt><span class="sect2"><a href="#api-isolatedruntime-catchup">14.9.3. Example: Catching Up a Statement From Historical Data</a></span></dt><dt><span class="sect2"><a href="#api-isolatedruntime-insertinto">14.9.4. Isolation for Insert-Into</a></span></dt><dt><span class="sect2"><a href="#api-isolatedruntime-namedwindowtable">14.9.5. Isolation for Named Windows and Tables</a></span></dt><dt><span class="sect2"><a href="#api-isolatedruntime-runtime">14.9.6. Runtime Considerations</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-exception">14.10. Exception Handling</a></span></dt><dt><span class="sect1"><a href="#api-condition">14.11. Condition Handling</a></span></dt><dt><span class="sect1"><a href="#api-soda">14.12. Statement Object Model</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-soda-building-step1">14.12.1. Building an Object Model</a></span></dt><dt><span class="sect2"><a href="#api-soda-building-step2">14.12.2. Building Expressions</a></span></dt><dt><span class="sect2"><a href="#api-soda-building-step3">14.12.3. Building a Pattern Statement</a></span></dt><dt><span class="sect2"><a href="#api-soda-building-step4">14.12.4. Building a Select Statement</a></span></dt><dt><span class="sect2"><a href="#api-soda-building-step5">14.12.5. Building a Create-Variable and On-Set Statement</a></span></dt><dt><span class="sect2"><a href="#api-soda-building-step6">14.12.6. Building Create-Window, On-Delete and On-Select Statements</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-prepared">14.13. Prepared Statement and Substitution Parameters</a></span></dt><dt><span class="sect1"><a href="#api-instrumentation">14.14. Engine and Statement Metrics Reporting</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-instrumentation-enginemetrics">14.14.1. Engine Metrics</a></span></dt><dt><span class="sect2"><a href="#api-instrumentation-statementmetrics">14.14.2. Statement Metrics</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-output-rendering">14.15. Event Rendering to XML and JSON</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-output-rendering-json">14.15.1. JSON Event Rendering Conventions and Options</a></span></dt><dt><span class="sect2"><a href="#api-output-rendering-xml">14.15.2. XML Event Rendering Conventions and Options</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-plugin">14.16. Plug-In Loader</a></span></dt><dt><span class="sect1"><a href="#api-annotation">14.17. Interrogating EPL Annotations</a></span></dt><dt><span class="sect1"><a href="#api-contextpartitionselection">14.18. Context Partition Selection</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-contextpartitionselection-selectors">14.18.1. Selectors</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-contextpartitionadmin">14.19. Context Partition Administration</a></span></dt><dt><span class="sect1"><a href="#api-testing">14.20. Test and Assertion Support</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-testing-assertion">14.20.1. EPAssertionUtil Summary</a></span></dt><dt><span class="sect2"><a href="#api-testing-listener">14.20.2. SupportUpdateListener Summary</a></span></dt><dt><span class="sect2"><a href="#api-testing-usage">14.20.3. Usage Example</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-osgi">14.21. OSGi, Class Loader, Class-For-Name</a></span></dt></dl></dd><dt><span class="chapter"><a href="#configuration">15. Configuration</a></span></dt><dd><dl><dt><span class="sect1"><a href="#configuration-programmatic">15.1. Programmatic Configuration</a></span></dt><dt><span class="sect1"><a href="#configuration-via-xml">15.2. Configuration via XML File</a></span></dt><dt><span class="sect1"><a href="#configuration-transientobjects">15.3. Passing Services or Transient Objects</a></span></dt><dd><dl><dt><span class="sect2"><a href="#configuration-transientobjects-service">15.3.1. Service Example</a></span></dt><dt><span class="sect2"><a href="#configuration-transientobjects-classforname">15.3.2. Class-for-Name</a></span></dt><dt><span class="sect2"><a href="#configuration-transientobjects-classloader">15.3.3. Class Loader</a></span></dt><dt><span class="sect2"><a href="#configuration-transientobjects-classloaderfastclass">15.3.4. Class Loader CGLib FastClass</a></span></dt></dl></dd><dt><span class="sect1"><a href="#configuration-items">15.4. Configuration Items</a></span></dt><dd><dl><dt><span class="sect2"><a href="#config-java">15.4.1. Events Represented by Java Classes</a></span></dt><dt><span class="sect2"><a href="#config-java-util-map">15.4.2. Events Represented by java.util.Map</a></span></dt><dt><span class="sect2"><a href="#config-objectarray">15.4.3. Events Represented by Object[] (Object-array)</a></span></dt><dt><span class="sect2"><a href="#config-avro">15.4.4. Events Represented by Avro GenericData.Record</a></span></dt><dt><span class="sect2"><a href="#config-xml-dom">15.4.5. Events Represented by org.w3c.dom.Node</a></span></dt><dt><span class="sect2"><a href="#config-plugineventrep">15.4.6. Events Represented by Plug-in Event Representations</a></span></dt><dt><span class="sect2"><a href="#config-class--package-imports">15.4.7. Class and Package Imports</a></span></dt><dt><span class="sect2"><a href="#config-class--package-imports-annotations">15.4.8. Annotation Class and Package Imports</a></span></dt><dt><span class="sect2"><a href="#config-method-invocations">15.4.9. Cache Settings for From-Clause Method Invocations</a></span></dt><dt><span class="sect2"><a href="#config-variables">15.4.10. Variables</a></span></dt><dt><span class="sect2"><a href="#config-database-ref">15.4.11. Relational Database Access</a></span></dt><dt><span class="sect2"><a href="#config-engine-bytecodegen">15.4.12. Engine Settings Related to Byte Code Generation and Compilation</a></span></dt><dt><span class="sect2"><a href="#config-engine-threading">15.4.13. Engine Settings Related to Concurrency and Threading</a></span></dt><dt><span class="sect2"><a href="#config-engine-eventmeta">15.4.14. Engine Settings Related to Event Metadata</a></span></dt><dt><span class="sect2"><a href="#config-engine-viewresources">15.4.15. Engine Settings Related to View Resources</a></span></dt><dt><span class="sect2"><a href="#config-engine-logging">15.4.16. Engine Settings Related to Logging</a></span></dt><dt><span class="sect2"><a href="#config-engine-variables">15.4.17. Engine Settings Related to Variables</a></span></dt><dt><span class="sect2"><a href="#config-engine-patterns">15.4.18. Engine Settings Related to Patterns</a></span></dt><dt><span class="sect2"><a href="#config-engine-matchrecognize">15.4.19. Engine Settings Related to Match-Recognize</a></span></dt><dt><span class="sect2"><a href="#config-engine-scripts">15.4.20. Engine Settings Related to Scripts</a></span></dt><dt><span class="sect2"><a href="#config-engine-stream-selection">15.4.21. Engine Settings Related to Stream Selection</a></span></dt><dt><span class="sect2"><a href="#config-engine-time-source">15.4.22. Engine Settings Related to Time Source</a></span></dt><dt><span class="sect2"><a href="#config-engine-jmxmetrics">15.4.23. Engine Settings Related to JMX Metrics</a></span></dt><dt><span class="sect2"><a href="#config-engine-instrumentation">15.4.24. Engine Settings Related to Metrics Reporting</a></span></dt><dt><span class="sect2"><a href="#config-engine-language">15.4.25. Engine Settings Related to Language and Locale</a></span></dt><dt><span class="sect2"><a href="#config-engine-expression">15.4.26. Engine Settings Related to Expression Evaluation</a></span></dt><dt><span class="sect2"><a href="#config-engine-execution">15.4.27. Engine Settings Related to Execution of Statements</a></span></dt><dt><span class="sect2"><a href="#config-engine-exceptionhandling">15.4.28. Engine Settings Related to Exception Handling</a></span></dt><dt><span class="sect2"><a href="#config-engine-conditionhandling">15.4.29. Engine Settings Related to Condition Handling</a></span></dt><dt><span class="sect2"><a href="#config-revisionevent">15.4.30. Revision Event Type</a></span></dt><dt><span class="sect2"><a href="#config-variantstream">15.4.31. Variant Stream</a></span></dt></dl></dd><dt><span class="sect1"><a href="#configuration-type-names">15.5. Type Names</a></span></dt><dt><span class="sect1"><a href="#configuration-runtime">15.6. Runtime Configuration</a></span></dt><dt><span class="sect1"><a href="#configuration-logging">15.7. Logging Configuration</a></span></dt><dd><dl><dt><span class="sect2"><a href="#configuration-logging-log4j">15.7.1. Log4j Logging Configuration</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#devlifecycle">16. Development Lifecycle</a></span></dt><dd><dl><dt><span class="sect1"><a href="#devlifecycle-authoring">16.1. Authoring</a></span></dt><dt><span class="sect1"><a href="#devlifecycle-testing">16.2. Testing</a></span></dt><dt><span class="sect1"><a href="#devlifecycle-debugging">16.3. Debugging</a></span></dt><dd><dl><dt><span class="sect2"><a href="#devlifecycle-debugging-audit">16.3.1. @Audit Annotation</a></span></dt></dl></dd><dt><span class="sect1"><a href="#devlifecycle-packagedeploy">16.4. Packaging and Deploying Overview</a></span></dt><dt><span class="sect1"><a href="#devlifecycle-eplmodule">16.5. EPL Modules</a></span></dt><dt><span class="sect1"><a href="#devlifecycle-admin">16.6. The Deployment Administrative Interface</a></span></dt><dd><dl><dt><span class="sect2"><a href="#devlifecycle-admin-readparse">16.6.1. Reading Module Content</a></span></dt><dt><span class="sect2"><a href="#devlifecycle-admin-order">16.6.2. Ordering Multiple Modules</a></span></dt><dt><span class="sect2"><a href="#devlifecycle-admin-devlifecycle-undeploy">16.6.3. Deploying and Un-Deploying</a></span></dt><dt><span class="sect2"><a href="#devlifecycle-admin-list">16.6.4. Listing Deployments</a></span></dt><dt><span class="sect2"><a href="#devlifecycle-admin-transition">16.6.5. State Transitioning a Module</a></span></dt><dt><span class="sect2"><a href="#devlifecycle-admin-bestpractices">16.6.6. Best Practices</a></span></dt></dl></dd><dt><span class="sect1"><a href="#devlifecycle-j2ee">16.7. J2EE Packaging and Deployment</a></span></dt><dd><dl><dt><span class="sect2"><a href="#devlifecycle-j2ee-considerations">16.7.1. J2EE Deployment Considerations</a></span></dt><dt><span class="sect2"><a href="#devlifecycle-j2ee-servletcontextlistener">16.7.2. Servlet Context Listener</a></span></dt></dl></dd><dt><span class="sect1"><a href="#devlifecycle-monitoring">16.8. Monitoring and JMX</a></span></dt></dl></dd><dt><span class="chapter"><a href="#extension">17. Integration and Extension</a></span></dt><dd><dl><dt><span class="sect1"><a href="#extension-overview">17.1. Overview</a></span></dt><dt><span class="sect1"><a href="#extension-virtualdw">17.2. Virtual Data Window</a></span></dt><dd><dl><dt><span class="sect2"><a href="#extension-virtualdw-howto">17.2.1. How to Use</a></span></dt><dt><span class="sect2"><a href="#extension-virtualdw-vdwfactory">17.2.2. Implementing the Factory</a></span></dt><dt><span class="sect2"><a href="#extension-virtualdw-vdw">17.2.3. Implementing the Virtual Data Window</a></span></dt><dt><span class="sect2"><a href="#extension-virtualdw-lookup">17.2.4. Implementing the Lookup</a></span></dt></dl></dd><dt><span class="sect1"><a href="#custom-singlerow-function">17.3. Single-Row Function</a></span></dt><dd><dl><dt><span class="sect2"><a href="#custom-singlerow-implementing">17.3.1. Implementing a Single-Row Function</a></span></dt><dt><span class="sect2"><a href="#custom-single-row-config">17.3.2. Configuring the Single-Row Function Name</a></span></dt><dt><span class="sect2"><a href="#custom-single-row-cache">17.3.3. Value Cache</a></span></dt><dt><span class="sect2"><a href="#custom-single-filter-optimizable">17.3.4. Single-Row Functions in Filter Predicate Expressions</a></span></dt><dt><span class="sect2"><a href="#custom-single-eventsparam">17.3.5. Single-Row Functions Taking Events as Parameters</a></span></dt><dt><span class="sect2"><a href="#custom-single-returningevents">17.3.6. Single-Row Functions Returning Events</a></span></dt><dt><span class="sect2"><a href="#custom-single-receivectx">17.3.7. Receiving a Context Object</a></span></dt><dt><span class="sect2"><a href="#custom-single-rethrowex">17.3.8. Exception Handling</a></span></dt></dl></dd><dt><span class="sect1"><a href="#custom-views">17.4. Derived-Value and Data Window View</a></span></dt><dd><dl><dt><span class="sect2"><a href="#custom-views-viewfactory">17.4.1. Implementing a View Factory</a></span></dt><dt><span class="sect2"><a href="#custom-views-view">17.4.2. Implementing a View</a></span></dt><dt><span class="sect2"><a href="#custom-views-contract">17.4.3. View Contract</a></span></dt><dt><span class="sect2"><a href="#custom-views-config">17.4.4. Configuring View Namespace and Name</a></span></dt><dt><span class="sect2"><a href="#custom-views-datawin">17.4.5. Requirement for Data Window Views</a></span></dt><dt><span class="sect2"><a href="#custom-views-derivedvalue">17.4.6. Requirement for Derived-Value Views</a></span></dt><dt><span class="sect2"><a href="#custom-views-grouped">17.4.7. Requirement for Grouped Views</a></span></dt></dl></dd><dt><span class="sect1"><a href="#custom-aggregation-function">17.5. Aggregation Function</a></span></dt><dd><dl><dt><span class="sect2"><a href="#custom-aggregation-single">17.5.1. Aggregation Single-Function Development</a></span></dt><dt><span class="sect2"><a href="#custom-aggregation-multi">17.5.2. Aggregation Multi-Function Development</a></span></dt></dl></dd><dt><span class="sect1"><a href="#custom-pattern-guard">17.6. Pattern Guard</a></span></dt><dd><dl><dt><span class="sect2"><a href="#custom-pattern-guard-factory-implementing">17.6.1. Implementing a Guard Factory</a></span></dt><dt><span class="sect2"><a href="#custom-pattern-guard-implementing">17.6.2. Implementing a Guard Class</a></span></dt><dt><span class="sect2"><a href="#custom-pattern-guard-config">17.6.3. Configuring Guard Namespace and Name</a></span></dt></dl></dd><dt><span class="sect1"><a href="#custom-pattern-observer">17.7. Pattern Observer</a></span></dt><dd><dl><dt><span class="sect2"><a href="#custom-pattern-observer-factory-implementing">17.7.1. Implementing an Observer Factory</a></span></dt><dt><span class="sect2"><a href="#custom-pattern-observer-implementing">17.7.2. Implementing an Observer Class</a></span></dt><dt><span class="sect2"><a href="#custom-pattern-observer-config">17.7.3. Configuring Observer Namespace and Name</a></span></dt></dl></dd><dt><span class="sect1"><a href="#custom-event-representation">17.8. Event Type and Event Object</a></span></dt><dd><dl><dt><span class="sect2"><a href="#custom-eventrep-overview">17.8.1. How It Works</a></span></dt><dt><span class="sect2"><a href="#custom-eventrep-steps">17.8.2. Steps</a></span></dt><dt><span class="sect2"><a href="#custom-eventrep-uriresolution">17.8.3. URI-Based Resolution</a></span></dt><dt><span class="sect2"><a href="#custom-eventrep-example">17.8.4. Example</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#script">18. Script Support</a></span></dt><dd><dl><dt><span class="sect1"><a href="#script-overview">18.1. Overview</a></span></dt><dt><span class="sect1"><a href="#script-syntax">18.2. Syntax</a></span></dt><dt><span class="sect1"><a href="#script-examples">18.3. Examples</a></span></dt><dt><span class="sect1"><a href="#script-variablevisibility">18.4. Built-In EPL Script Attributes</a></span></dt><dt><span class="sect1"><a href="#script-performance">18.5. Performance Notes</a></span></dt><dt><span class="sect1"><a href="#script-other">18.6. Additional Notes</a></span></dt></dl></dd><dt><span class="chapter"><a href="#spatial">19. EPL Reference: Spatial Methods and Indexes</a></span></dt><dd><dl><dt><span class="sect1"><a href="#spatial_intro">19.1. Overview</a></span></dt><dt><span class="sect1"><a href="#spatial_method">19.2. Spatial Methods</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spatial_method_pointinsiderectangle">19.2.1. Point-Inside-Rectangle</a></span></dt><dt><span class="sect2"><a href="#spatial_method_rectangleintersectsrectangle">19.2.2. Rectangle-Intersects-Rectangle</a></span></dt></dl></dd><dt><span class="sect1"><a href="#spatial_index">19.3. Spatial Index - Quadtree</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spatial_index_overview">19.3.1. Overview</a></span></dt><dt><span class="sect2"><a href="#spatial_index_pointregionquadtreedeclare">19.3.2. Declaring a Point-Region Quadtree Index</a></span></dt><dt><span class="sect2"><a href="#spatial_index_pointregionquadtreefilterindex">19.3.3. Using a Point-Region Quadtree as a Filter Index</a></span></dt><dt><span class="sect2"><a href="#spatial_index_pointregionquadtreeeventindex">19.3.4. Using a Point-Region Quadtree as an Event Index</a></span></dt><dt><span class="sect2"><a href="#spatial_index_mxcifquadtreedeclare">19.3.5. Declaring a MX-CIF Quadtree Index</a></span></dt><dt><span class="sect2"><a href="#spatial_index_mxcifquadtreefilterindex">19.3.6. Using a MX-CIF Quadtree as a Filter Index</a></span></dt><dt><span class="sect2"><a href="#spatial_index_mxcifquadtreeeventindex">19.3.7. Using a MX-CIF Quadtree as an Event Index</a></span></dt></dl></dd><dt><span class="sect1"><a href="#spatial_etc">19.4. Spatial Types, Functions and Methods from External Libraries</a></span></dt></dl></dd><dt><span class="chapter"><a href="#dataflow">20. EPL Reference: Data Flow</a></span></dt><dd><dl><dt><span class="sect1"><a href="#dataflow-intro">20.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#dataflow-usage">20.2. Usage</a></span></dt><dd><dl><dt><span class="sect2"><a href="#dataflow-usage-overview">20.2.1. Overview</a></span></dt><dt><span class="sect2"><a href="#dataflow-usage-syntax">20.2.2. Syntax</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dataflow-reference">20.3. Built-In Operators</a></span></dt><dd><dl><dt><span class="sect2"><a href="#dataflow-reference-beaconsource">20.3.1. BeaconSource</a></span></dt><dt><span class="sect2"><a href="#dataflow-reference-epstatementsource">20.3.2. EPStatementSource</a></span></dt><dt><span class="sect2"><a href="#dataflow-reference-eventbussink">20.3.3. EventBusSink</a></span></dt><dt><span class="sect2"><a href="#dataflow-reference-eventbussource">20.3.4. EventBusSource</a></span></dt><dt><span class="sect2"><a href="#dataflow-reference-filter">20.3.5. Filter</a></span></dt><dt><span class="sect2"><a href="#dataflow-reference-logsink">20.3.6. LogSink</a></span></dt><dt><span class="sect2"><a href="#dataflow-reference-select">20.3.7. Select</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dataflow-api">20.4. API</a></span></dt><dd><dl><dt><span class="sect2"><a href="#dataflow-api-declaring">20.4.1. Declaring a Data Flow</a></span></dt><dt><span class="sect2"><a href="#dataflow-api-instantiating">20.4.2. Instantiating a Data Flow</a></span></dt><dt><span class="sect2"><a href="#dataflow-api-executing">20.4.3. Executing a Data Flow</a></span></dt><dt><span class="sect2"><a href="#dataflow-api-instantiationoptions">20.4.4. Instantiation Options</a></span></dt><dt><span class="sect2"><a href="#dataflow-api-startcaptive">20.4.5. Start Captive</a></span></dt><dt><span class="sect2"><a href="#dataflow-api-punctuation">20.4.6. Data Flow Punctuation With Markers</a></span></dt><dt><span class="sect2"><a href="#dataflow-api-exception">20.4.7. Exception Handling</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dataflow-examples">20.5. Examples</a></span></dt><dt><span class="sect1"><a href="#dataflow-op">20.6. Operator Implementation</a></span></dt><dd><dl><dt><span class="sect2"><a href="#dataflow-op-source">20.6.1. Sample Operator Acting as Source</a></span></dt><dt><span class="sect2"><a href="#dataflow-op-second">20.6.2. Sample Tokenizer Operator</a></span></dt><dt><span class="sect2"><a href="#dataflow-op-third">20.6.3. Sample Aggregator Operator</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#examples">21. Examples, Tutorials, Case Studies</a></span></dt><dd><dl><dt><span class="sect1"><a href="#examples-overview">21.1. Examples Overview</a></span></dt><dt><span class="sect1"><a href="#examples-running">21.2. Running the Examples</a></span></dt><dt><span class="sect1"><a href="#examples-autoid">21.3. AutoID RFID Reader</a></span></dt><dt><span class="sect1"><a href="#examples-runtimeconfig">21.4. Runtime Configuration</a></span></dt><dt><span class="sect1"><a href="#examples-servershell">21.5. JMS Server Shell and Client</a></span></dt><dd><dl><dt><span class="sect2"><a href="#examples-servershell-processes">21.5.1. Overview</a></span></dt><dt><span class="sect2"><a href="#examples-servershell-jmsevents">21.5.2. JMS Messages as Events</a></span></dt><dt><span class="sect2"><a href="#examples-servershell-jmx">21.5.3. JMX for Remote Dynamic Statement Management</a></span></dt></dl></dd><dt><span class="sect1"><a href="#examples-marketdata-monitor">21.6. Market Data Feed Monitor</a></span></dt><dd><dl><dt><span class="sect2"><a href="#examples-marketdata-monitor-input">21.6.1. Input Events</a></span></dt><dt><span class="sect2"><a href="#examples-marketdata-computing">21.6.2. Computing Rates per Feed</a></span></dt><dt><span class="sect2"><a href="#examples-marketdata-falloff">21.6.3. Detecting a Fall-Off</a></span></dt><dt><span class="sect2"><a href="#examples-marketdata-monitor-sim">21.6.4. Event generator</a></span></dt></dl></dd><dt><span class="sect1"><a href="#examples-ohlcpluginview">21.7. OHLC Plug-In Data Window</a></span></dt><dt><span class="sect1"><a href="#examples-transaction-3-event-challenge">21.8. Transaction 3-Event Challenge</a></span></dt><dd><dl><dt><span class="sect2"><a href="#examples-txn3event-1">21.8.1. The Events</a></span></dt><dt><span class="sect2"><a href="#examples-txn3event-2">21.8.2. Combined Event</a></span></dt><dt><span class="sect2"><a href="#examples-txn3event-3">21.8.3. Real-Time Summary Data</a></span></dt><dt><span class="sect2"><a href="#examples-txn3event-4">21.8.4. Find Problems</a></span></dt><dt><span class="sect2"><a href="#examples-txn3event-5">21.8.5. Event Generator</a></span></dt></dl></dd><dt><span class="sect1"><a href="#examples-terminalsvc-J2EE">21.9. Self-Service Terminal</a></span></dt><dd><dl><dt><span class="sect2"><a href="#examples-terminalsvc-events">21.9.1. Events</a></span></dt><dt><span class="sect2"><a href="#examples-terminalsvc-pattern1">21.9.2. Detecting Customer Check-In Issues</a></span></dt><dt><span class="sect2"><a href="#examples-terminalsvc-pattern2">21.9.3. Absence of Status Events</a></span></dt><dt><span class="sect2"><a href="#examples-terminalsvc-epl1">21.9.4. Activity Summary Data</a></span></dt><dt><span class="sect2"><a href="#examples-terminalsvc-j2ee">21.9.5. Sample Application for J2EE Application Server</a></span></dt></dl></dd><dt><span class="sect1"><a href="#examples-assets-moving">21.10. Assets Moving Across Zones - An RFID Example</a></span></dt><dt><span class="sect1"><a href="#examples-stockticker">21.11. StockTicker</a></span></dt><dt><span class="sect1"><a href="#examples-matchmaker">21.12. MatchMaker</a></span></dt><dt><span class="sect1"><a href="#examples-namedwindowquery">21.13. Named Window Query</a></span></dt><dt><span class="sect1"><a href="#examples-virtualdw">21.14. Sample Virtual Data Window</a></span></dt><dt><span class="sect1"><a href="#examples-cycledetect">21.15. Sample Cycle Detection</a></span></dt><dt><span class="sect1"><a href="#examples-qossla">21.16. Quality of Service</a></span></dt><dt><span class="sect1"><a href="#examples-trivia">21.17. Trivia Geeks Club</a></span></dt></dl></dd><dt><span class="chapter"><a href="#bytecodegen">22. Byte Code Generation</a></span></dt><dd><dl><dt><span class="sect1"><a href="#bytecodegen_intro">22.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#bytecodegen_usage">22.2. Usage Notes</a></span></dt><dd><dl><dt><span class="sect2"><a href="#bytecodegen_criteria">22.2.1. Criteria</a></span></dt><dt><span class="sect2"><a href="#bytecodegen_fallback">22.2.2. Fallback</a></span></dt><dt><span class="sect2"><a href="#bytecodegen_logging">22.2.3. Logging</a></span></dt><dt><span class="sect2"><a href="#bytecodegen_debugging">22.2.4. Debugging Generated Code</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#performance">23. Performance</a></span></dt><dd><dl><dt><span class="sect1"><a href="#performance-results">23.1. Performance Results</a></span></dt><dt><span class="sect1"><a href="#performance-tips">23.2. Performance Tips</a></span></dt><dd><dl><dt><span class="sect2"><a href="#perf-tips-1">23.2.1. Understand How to Tune Your Java Virtual Machine</a></span></dt><dt><span class="sect2"><a href="#perf-tips-3">23.2.2. Input and Output Bottlenecks</a></span></dt><dt><span class="sect2"><a href="#perf-tips-3-a">23.2.3. Theading</a></span></dt><dt><span class="sect2"><a href="#perf-tips-4">23.2.4. Select the Underlying Event Rather Than Individual Fields</a></span></dt><dt><span class="sect2"><a href="#perf-tips-5">23.2.5. Prefer Stream-Level Filtering Over Where-Clause Filtering</a></span></dt><dt><span class="sect2"><a href="#perf-tips-6">23.2.6. Reduce the Use of Arithmetic in Expressions</a></span></dt><dt><span class="sect2"><a href="#perf-tips-6a">23.2.7. Remove Unneccessary Constructs</a></span></dt><dt><span class="sect2"><a href="#perf-tips-6b">23.2.8. End Pattern Sub-Expressions</a></span></dt><dt><span class="sect2"><a href="#perf-tips-7">23.2.9. Consider Using EventPropertyGetter for Fast Access to Event Properties</a></span></dt><dt><span class="sect2"><a href="#perf-tips-8">23.2.10. Consider Casting the Underlying Event</a></span></dt><dt><span class="sect2"><a href="#perf-tips-9">23.2.11. Turn Off Logging and Audit</a></span></dt><dt><span class="sect2"><a href="#perf-tips-11">23.2.12. Tune or Disable Delivery Order Guarantees</a></span></dt><dt><span class="sect2"><a href="#perf-tips-12">23.2.13. Use a Subscriber Object to Receive Events</a></span></dt><dt><span class="sect2"><a href="#perf-tips-12b">23.2.14. Consider Data Flows</a></span></dt><dt><span class="sect2"><a href="#perf-tips-13">23.2.15. High-Arrival-Rate Streams and Single Statements</a></span></dt><dt><span class="sect2"><a href="#perf-tips-13a">23.2.16. Subqueries Versus Joins and Where-Clause and Data Windows</a></span></dt><dt><span class="sect2"><a href="#perf-tips-13b">23.2.17. Patterns and Pattern Sub-Expression Instances</a></span></dt><dt><span class="sect2"><a href="#perf-tips-13b2">23.2.18. Pattern Sub-Expression Instance Versus Data Window Use</a></span></dt><dt><span class="sect2"><a href="#perf-tips-13c">23.2.19. The Keep-All Data Window</a></span></dt><dt><span class="sect2"><a href="#perf-tips-13d">23.2.20. Statement Design for Reduced Memory Consumption - Diagnosing OutOfMemoryError</a></span></dt><dt><span class="sect2"><a href="#perf-tips-14">23.2.21. Performance, JVM, OS and Hardware</a></span></dt><dt><span class="sect2"><a href="#perf-tips-15">23.2.22. Consider Using Hints</a></span></dt><dt><span class="sect2"><a href="#perf-tips-16">23.2.23. Optimizing Stream Filter Expressions</a></span></dt><dt><span class="sect2"><a href="#perf-tips-17">23.2.24. Statement and Engine Metric Reporting</a></span></dt><dt><span class="sect2"><a href="#perf-tips-18">23.2.25. Expression Evaluation Order and Early Exit</a></span></dt><dt><span class="sect2"><a href="#perf-tips-19">23.2.26. Large Number of Threads</a></span></dt><dt><span class="sect2"><a href="#perf-tips-19a">23.2.27. Filter Evaluation Tuning</a></span></dt><dt><span class="sect2"><a href="#perf-tips-20">23.2.28. Context Partition Related Information</a></span></dt><dt><span class="sect2"><a href="#perf-tips-21">23.2.29. Prefer Constant Variables Over Non-Constant Variables</a></span></dt><dt><span class="sect2"><a href="#perf-tips-22">23.2.30. Prefer Object-Array Events</a></span></dt><dt><span class="sect2"><a href="#perf-tips-23">23.2.31. Composite or Compound Keys</a></span></dt><dt><span class="sect2"><a href="#perf-tips-24">23.2.32. Notes on Query Planning</a></span></dt><dt><span class="sect2"><a href="#perf-tips-25a">23.2.33. Query Planning Expression Analysis Hints</a></span></dt><dt><span class="sect2"><a href="#perf-tips-25b">23.2.34. Query Planning Index Hints</a></span></dt><dt><span class="sect2"><a href="#perf-tips-26">23.2.35. Measuring Throughput</a></span></dt><dt><span class="sect2"><a href="#perf-tips-27">23.2.36. Do Not Create the Same or Similar EPL Statement X Times</a></span></dt><dt><span class="sect2"><a href="#perf-tips-28">23.2.37. Comparing Single-Threaded and Multi-Threaded Performance</a></span></dt><dt><span class="sect2"><a href="#perf-tips-29">23.2.38. Incremental Versus Recomputed Aggregation for Named Window Events</a></span></dt><dt><span class="sect2"><a href="#perf-tips-30">23.2.39. When Does Memory Get Released</a></span></dt><dt><span class="sect2"><a href="#perf-tips-31">23.2.40. Measure throughput of non-matches as well as matches</a></span></dt></dl></dd><dt><span class="sect1"><a href="#performance-kit">23.3. Using the Performance Kit</a></span></dt><dd><dl><dt><span class="sect2"><a href="#how-to-kit">23.3.1. How to Use the Performance Kit</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#references">24. References</a></span></dt><dd><dl><dt><span class="sect1"><a href="#references-listing">24.1. Reference List</a></span></dt></dl></dd><dt><span class="appendix"><a href="#appendix_outputspec">A. Output Reference and Samples</a></span></dt><dd><dl><dt><span class="sect1"><a href="#outputspec-intro">A.1. Introduction and Sample Data</a></span></dt><dt><span class="sect1"><a href="#outputspec-simple">A.2. Output for Un-Aggregated and Un-Grouped Queries</a></span></dt><dd><dl><dt><span class="sect2"><a href="#outputspec-simple-none">A.2.1. No Output Rate Limiting</a></span></dt><dt><span class="sect2"><a href="#outputspec-simple-default">A.2.2. Output Rate Limiting - Default</a></span></dt><dt><span class="sect2"><a href="#outputspec-simple-last">A.2.3. Output Rate Limiting - Last</a></span></dt><dt><span class="sect2"><a href="#outputspec-simple-first">A.2.4. Output Rate Limiting - First</a></span></dt><dt><span class="sect2"><a href="#outputspec-simple-snapshot">A.2.5. Output Rate Limiting - Snapshot</a></span></dt></dl></dd><dt><span class="sect1"><a href="#outputspec-rowforall">A.3. Output for Fully-Aggregated and Un-Grouped Queries</a></span></dt><dd><dl><dt><span class="sect2"><a href="#outputspec-rowforall-none">A.3.1. No Output Rate Limiting</a></span></dt><dt><span class="sect2"><a href="#outputspec-rowforall-default">A.3.2. Output Rate Limiting - Default</a></span></dt><dt><span class="sect2"><a href="#outputspec-rowforall-last">A.3.3. Output Rate Limiting - Last</a></span></dt><dt><span class="sect2"><a href="#outputspec-rowforall-first">A.3.4. Output Rate Limiting - First</a></span></dt><dt><span class="sect2"><a href="#outputspec-rowforall-snapshot">A.3.5. Output Rate Limiting - Snapshot</a></span></dt></dl></dd><dt><span class="sect1"><a href="#outputspec-aggregateall">A.4. Output for Aggregated and Un-Grouped Queries</a></span></dt><dd><dl><dt><span class="sect2"><a href="#outputspec-aggregateall-none">A.4.1. No Output Rate Limiting</a></span></dt><dt><span class="sect2"><a href="#outputspec-aggregateall-default">A.4.2. Output Rate Limiting - Default</a></span></dt><dt><span class="sect2"><a href="#outputspec-aggregateall-last">A.4.3. Output Rate Limiting - Last</a></span></dt><dt><span class="sect2"><a href="#outputspec-aggregateall-first">A.4.4. Output Rate Limiting - First</a></span></dt><dt><span class="sect2"><a href="#outputspec-aggregateall-snapshot">A.4.5. Output Rate Limiting - Snapshot</a></span></dt></dl></dd><dt><span class="sect1"><a href="#outputspec-groupedrowpergroup">A.5. Output for Fully-Aggregated and Grouped Queries</a></span></dt><dd><dl><dt><span class="sect2"><a href="#outputspec-groupedrowpergroup-none">A.5.1. No Output Rate Limiting</a></span></dt><dt><span class="sect2"><a href="#outputspec-groupedrowpergroup-default">A.5.2. Output Rate Limiting - Default</a></span></dt><dt><span class="sect2"><a href="#outputspec-groupedrowpergroup-all">A.5.3. Output Rate Limiting - All</a></span></dt><dt><span class="sect2"><a href="#outputspec-groupedrowpergroup-last">A.5.4. Output Rate Limiting - Last</a></span></dt><dt><span class="sect2"><a href="#outputspec-groupedrowpergroup-first">A.5.5. Output Rate Limiting - First</a></span></dt><dt><span class="sect2"><a href="#outputspec-groupedrowpergroup-snapshot">A.5.6. Output Rate Limiting - Snapshot</a></span></dt></dl></dd><dt><span class="sect1"><a href="#outputspec-aggregategrouped">A.6. Output for Aggregated and Grouped Queries</a></span></dt><dd><dl><dt><span class="sect2"><a href="#outputspec-aggregategrouped-none">A.6.1. No Output Rate Limiting</a></span></dt><dt><span class="sect2"><a href="#outputspec-aggregategrouped-default">A.6.2. Output Rate Limiting - Default</a></span></dt><dt><span class="sect2"><a href="#outputspec-aggregategrouped-all">A.6.3. Output Rate Limiting - All</a></span></dt><dt><span class="sect2"><a href="#outputspec-aggregategrouped-last">A.6.4. Output Rate Limiting - Last</a></span></dt><dt><span class="sect2"><a href="#outputspec-aggregategrouped-first">A.6.5. Output Rate Limiting - First</a></span></dt><dt><span class="sect2"><a href="#outputspec-aggregategrouped-snapshot">A.6.6. Output Rate Limiting - Snapshot</a></span></dt></dl></dd><dt><span class="sect1"><a href="#outputspec-groupedrowpergrouprollup">A.7. Output for Fully-Aggregated, Grouped Queries With Rollup</a></span></dt><dd><dl><dt><span class="sect2"><a href="#outputspec-groupedrowpergrouprollup-none">A.7.1. No Output Rate Limiting</a></span></dt><dt><span class="sect2"><a href="#outputspec-groupedrowpergrouprollup-default">A.7.2. Output Rate Limiting - Default</a></span></dt><dt><span class="sect2"><a href="#outputspec-groupedrowpergrouprollup-all">A.7.3. Output Rate Limiting - All</a></span></dt><dt><span class="sect2"><a href="#outputspec-groupedrowpergrouprollup-last">A.7.4. Output Rate Limiting - Last</a></span></dt><dt><span class="sect2"><a href="#outputspec-groupedrowpergrouprollup-first">A.7.5. Output Rate Limiting - First</a></span></dt><dt><span class="sect2"><a href="#outputspec-groupedrowpergrouprollup-snapshot">A.7.6. Output Rate Limiting - Snapshot</a></span></dt></dl></dd></dl></dd><dt><span class="appendix"><a href="#appendix_outputlimit">B. Runtime Considerations for Output Rate Limiting</a></span></dt><dd><dl><dt><span class="sect1"><a href="#epl-output-unaggandungrouped">B.1. For Un-Aggregated and Un-Grouped Queries</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-output-unaggandungrouped-last">B.1.1. Output Last</a></span></dt><dt><span class="sect2"><a href="#epl-output-unaggandungrouped-all">B.1.2. Output All</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-output-fullyaggandungrouped">B.2. For Fully Aggregated and Un-Grouped Queries</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-output-fullyaggandungrouped-last">B.2.1. Output Last</a></span></dt><dt><span class="sect2"><a href="#epl-output-fullyaggandungrouped-all">B.2.2. Output All</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-output-aggandungrouped">B.3. For Aggregated and Un-Grouped Queries</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-output-aggandungrouped-last">B.3.1. Output Last</a></span></dt><dt><span class="sect2"><a href="#epl-output-aggandungrouped-all">B.3.2. Output All</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-output-fullyaggandgrouped">B.4. For Fully Aggregated and Grouped Queries (Includes Rollup)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-output-fullyaggandgrouped-last">B.4.1. Output Last</a></span></dt><dt><span class="sect2"><a href="#epl-output-fullyaggandgrouped-all">B.4.2. Output All</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-output-aggandgrouped">B.5. For Aggregated and Grouped Queries</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-output-aggandgrouped-last">B.5.1. Output Last</a></span></dt><dt><span class="sect2"><a href="#epl-output-aggandgrouped-all">B.5.2. Output All</a></span></dt></dl></dd></dl></dd><dt><span class="appendix"><a href="#appendix_keywords">C. Reserved Keywords</a></span></dt><dt><span class="appendix"><a href="#appendix_eventrepbean">D. Event Representation: Plain-Old Java Object Events</a></span></dt><dd><dl><dt><span class="sect1"><a href="#appendix_eventrepbean_overview">D.1. Overview</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepbean_properties">D.2. Java Object Event Properties</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepbean_propertynames">D.3. Property Names</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepbean_parameterized">D.4. Parameterized Types</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepbean_indexedmappedsetter">D.5. Setter Methods for Indexed and Mapped Properties</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepbean_knownlimit">D.6. Known Limitations</a></span></dt></dl></dd><dt><span class="appendix"><a href="#appendix_eventrepmap">E. Event Representation: java.util.Map Events</a></span></dt><dd><dl><dt><span class="sect1"><a href="#appendix_eventrepmap_overview">E.1. Overview</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepmap_properties">E.2. Map Properties</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepmap_supertype">E.3. Map Supertypes</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepmap_advanced">E.4. Advanced Map Property Types</a></span></dt><dd><dl><dt><span class="sect2"><a href="#appendix_eventrepmap_nested">E.4.1. Nested Properties</a></span></dt><dt><span class="sect2"><a href="#appendix_eventrepmap_array">E.4.2. One-to-Many Relationships</a></span></dt></dl></dd></dl></dd><dt><span class="appendix"><a href="#appendix_eventrepoa">F. Event Representation: Object-Array (Object[]) Events</a></span></dt><dd><dl><dt><span class="sect1"><a href="#appendix_eventrepoa_overview">F.1. Overview</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepoa_properties">F.2. Object-Array Properties</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepoa_supertype">F.3. Object-Array Supertype</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepoa_advanced">F.4. Advanced Object-Array Property Types</a></span></dt><dd><dl><dt><span class="sect2"><a href="#appendix_eventrepoa_arraynested">F.4.1. Nested Properties</a></span></dt><dt><span class="sect2"><a href="#appendix_eventrepoa_array">F.4.2. One-to-Many Relationships</a></span></dt></dl></dd></dl></dd><dt><span class="appendix"><a href="#appendix_eventrepavro">G. Event Representation: Avro Events (org.apache.avro.generic.GenericData.Record)</a></span></dt><dd><dl><dt><span class="sect1"><a href="#appendix_eventrepavro_overview">G.1. Overview</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepavro_properties">G.2. Avro Event Type</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepavro_schemanamerequirement">G.3. Avro Schema Name Requirement</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepavro_schematoprop">G.4. Avro Field Schema to Property Type Mapping</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepavro_typetoschema">G.5. Primitive Data Type and Class to Avro Schema Mapping</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepavro_avroschemafieldannotation">G.6. Customizing Avro Schema Assignment</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepavro_classtoavroschema">G.7. Customizing Class-to-Avro Schema</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepavro_typemapping">G.8. Customizing Object-to-Avro Field Value Assignment</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepavro_apiexamples">G.9. API Examples</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepavro_limitations">G.10. Limitations</a></span></dt></dl></dd><dt><span class="appendix"><a href="#appendix_eventrepxml">H. Event Representation: org.w3c.dom.Node XML Events</a></span></dt><dd><dl><dt><span class="sect1"><a href="#appendix_eventrepxml_overview">H.1. Overview</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepxml_schema">H.2. Schema-Provided XML Events</a></span></dt><dd><dl><dt><span class="sect2"><a href="#appendix_eventrepxml_schema-start">H.2.1. Getting Started</a></span></dt><dt><span class="sect2"><a href="#appendix_eventrepxml_schema-propertyexpr">H.2.2. Property Expressions and Namespaces</a></span></dt><dt><span class="sect2"><a href="#appendix_eventrepxml_schema-propertyexpr-xpath">H.2.3. Property Expression to XPath Rewrite</a></span></dt><dt><span class="sect2"><a href="#appendix_eventrepxml_schema-propertyarray">H.2.4. Array Properties</a></span></dt><dt><span class="sect2"><a href="#appendix_eventrepxml_schema-propertydynamic">H.2.5. Dynamic Properties</a></span></dt><dt><span class="sect2"><a href="#appendix_eventrepxml_schema-propertytranspose">H.2.6. Transposing Properties</a></span></dt><dt><span class="sect2"><a href="#appendix_eventrepxml_eventsender">H.2.7. Event Sender</a></span></dt><dt><span class="sect2"><a href="#appendix_eventrepxml_limitations">H.2.8. Limitations</a></span></dt></dl></dd><dt><span class="sect1"><a href="#appendix_eventrepxml_noschema">H.3. No-Schema-Provided XML Events</a></span></dt><dt><span class="sect1"><a href="#appendix_eventrepxml_explicit">H.4. Explicitly-Configured Properties</a></span></dt><dd><dl><dt><span class="sect2"><a href="#appendix_eventrepxml_explicit-simple">H.4.1. Simple Explicit Property</a></span></dt><dt><span class="sect2"><a href="#appendix_eventrepxml_explicit-casted">H.4.2. Explicit Property Casting and Parsing</a></span></dt><dt><span class="sect2"><a href="#appendix_eventrepxml_explicit-node">H.4.3. Node and Nodeset Explicit Property</a></span></dt></dl></dd></dl></dd><dt><span class="appendix"><a href="#appendix_dotnet">I. NEsper .NET -Specific Information</a></span></dt><dd><dl><dt><span class="sect1"><a href="#appendix_dotnet_general">I.1. .NET General Information</a></span></dt><dt><span class="sect1"><a href="#appendix_dotnet_annotation">I.2. .NET and Annotations</a></span></dt><dt><span class="sect1"><a href="#appendix_dotnet_locksconcurrency">I.3. .NET and Locks and Concurrency</a></span></dt><dt><span class="sect1"><a href="#appendix_dotnet_threading">I.4. .NET and Threading</a></span></dt><dt><span class="sect1"><a href="#appendix_dotnet_configuration">I.5. .NET NEsper Configuration</a></span></dt><dt><span class="sect1"><a href="#appendix_dotnet_eventrep_intro">I.6. .NET Event Underlying Objects</a></span></dt><dt><span class="sect1"><a href="#appendix_dotnet_eventrep_javabean">I.7. .NET Object Events</a></span></dt><dt><span class="sect1"><a href="#appendix_dotnet_eventrep_map">I.8. .NET IDictionary Events</a></span></dt><dt><span class="sect1"><a href="#appendix_dotnet_eventrep_xml">I.9. .NET XML Events</a></span></dt><dt><span class="sect1"><a href="#appendix_dotnet_eventrep_insertinto">I.10. .NET Event Objects Instantiated and Populated by Insert Into</a></span></dt><dt><span class="sect1"><a href="#appendix_dotnet_processingmodel_intro">I.11. .NET Basic Concepts</a></span></dt><dt><span class="sect1"><a href="#appendix_dotnet_epl_syntax_datatype">I.12. .NET EPL Syntax - Data Types</a></span></dt><dt><span class="sect1"><a href="#appendix_dotnet_histdata_overview">I.13. .NET Accessing Relational Data via SQL</a></span></dt><dt><span class="sect1"><a href="#appendix_dotnet_api_receive_results">I.14. .NET API - Receiving Statement Results</a></span></dt><dt><span class="sect1"><a href="#appendix_dotnet_api_admin_listeners">I.15. .NET API - Adding Listeners</a></span></dt><dt><span class="sect1"><a href="#appendix_dotnet_api_threading">I.16. .NET API - Engine Threading and Concurrency</a></span></dt><dt><span class="sect1"><a href="#appendix_dotnet_config_database_ref">I.17. .NET Configurations - Relational Database Access</a></span></dt><dt><span class="sect1"><a href="#appendix_dotnet_configuration_logging">I.18. .NET Configurations - Logging Configuration</a></span></dt></dl></dd><dt><span class="index"><a href="#d0e55854">Index</a></span></dt></dl></div><div class="preface" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="preface"/>Preface</h2></div></div></div><p>
			Analyzing and reacting to information in real-time oftentimes requires the development of custom applications.
			Typically these applications must obtain the data to analyze, filter data, derive information and then indicate 
			this information through some form of presentation or communication. Data may arrive with high frequency
			requiring high throughput processing. And applications may need to be flexible and react to changes in requirements 
			while the data is processed. Esper is an event stream processor that aims to enable a short development cycle from inception to production 
			for these types of applications.
        </p><p>
			This document is a resource for software developers who develop event driven applications. It also contains information that is useful for business analysts and system architects who are evaluating Esper.
        </p><p>
			It is assumed that the reader is familiar with the Java programming language.
        </p><p>
			For NEsper .NET the reader is is familiar with the C# programming language. For NEsper .NET, please also review <a class="xref" href="#appendix_dotnet" title="AppendixÂ I.Â NEsper .NET -Specific Information">AppendixÂ I, <i>NEsper .NET -Specific Information</i></a>.
        </p><p>
			This document is relevant in all phases of your software development project: from design to deployment and support.
        </p><p>
			If you are new to Esper, please follow these steps:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
                    Read the tutorials, case studies and solution patterns available on the Esper public web site at <code class="literal">http://www.espertech.com/esper</code>
                </p></li><li><p>
                    Read <a class="xref" href="#gettingstarted" title="ChapterÂ 1.Â Getting Started">ChapterÂ 1, <i>Getting Started</i></a> if you are new to CEP and streaming analytics
                </p></li><li><p>
                    Read <a class="xref" href="#processingmodel" title="ChapterÂ 2.Â Basic Concepts">ChapterÂ 2, <i>Basic Concepts</i></a> to gain insight into EPL basic concepts
                </p></li><li><p>
                    Read <a class="xref" href="#event_representation" title="ChapterÂ 3.Â Event Representations">ChapterÂ 3, <i>Event Representations</i></a> that explains the different ways of representing events to Esper
                </p></li><li><p>
                    Read <a class="xref" href="#epl-intro" title="5.1.Â EPL Introduction">SectionÂ 5.1, âEPL Introductionâ</a> for an introduction to event stream processing via EPL
                </p></li><li><p>
                    Read <a class="xref" href="#event-pattern-intro" title="7.1.Â Event Pattern Overview">SectionÂ 7.1, âEvent Pattern Overviewâ</a> for an overview over event patterns
                </p></li><li><p>
                    Read <a class="xref" href="#match-recognize-intro" title="8.1.Â Overview">SectionÂ 8.1, âOverviewâ</a> for an overview over event patterns using the match recognize syntax.
                </p></li><li><p>
                    Then glance over the examples <a class="xref" href="#examples-overview" title="21.1.Â Examples Overview">SectionÂ 21.1, âExamples Overviewâ</a>
                </p></li><li><p>
                    Finally to test drive Esper performance, read <a class="xref" href="#performance" title="ChapterÂ 23.Â Performance">ChapterÂ 23, <i>Performance</i></a>
                </p></li></ol></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="gettingstarted"/>ChapterÂ 1.Â Getting Started</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#gettingstarted_introcep">1.1. Introduction to Complex Event Processing</a></span></dt><dt><span class="sect1"><a href="#gettingstarted_steps">1.2. Steps</a></span></dt><dd><dl><dt><span class="sect2"><a href="#gettingstarted_steps_1">1.2.1. Step One: Setting up Classpath</a></span></dt><dt><span class="sect2"><a href="#gettingstarted_steps_2">1.2.2. Step Two: Obtain Engine Instance</a></span></dt><dt><span class="sect2"><a href="#gettingstarted_steps_3">1.2.3. Step Three: Provide Information on Input Events</a></span></dt><dt><span class="sect2"><a href="#gettingstarted_steps_4">1.2.4. Step Four: Create EPL Statements and Attach Callbacks</a></span></dt><dt><span class="sect2"><a href="#gettingstarted_steps_5">1.2.5. Step Five: Send Events</a></span></dt></dl></dd><dt><span class="sect1"><a href="#required_3rd_party">1.3. Required 3rd Party Libraries</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="gettingstarted_introcep"/>1.1.Â Introduction to Complex Event Processing</h2></div></div></div><p>
			The Esper engine has been developed to address the requirements of applications that analyze and react to events. Some typical examples of applications are:
        </p><div class="itemizedlist"><ul compact="compact"><li><p>
					Business process management and automation (process monitoring, BAM, reporting exceptions) 
				</p></li><li><p>
					Finance (algorithmic trading, fraud detection, risk management)
				</p></li><li><p>
					Network and application monitoring (intrusion detection, SLA monitoring)
				</p></li><li><p>
					Sensor network applications (RFID reading, scheduling and control of fabrication lines, air traffic) 
				</p></li></ul></div><p>
			What these applications have in common is the requirement to process events (or messages) in real-time or near real-time. This is sometimes referred to as complex event processing (CEP) and event series analysis. Key considerations for these types of applications are throughput, latency and the complexity of the logic required.
        </p><div class="itemizedlist"><ul compact="compact"><li><p>
					High throughput - applications that process large volumes of messages (between 1,000 to 100k messages per second)
				</p></li><li><p>
					Low latency - applications that react in real-time to conditions that occur (from a few milliseconds to a few seconds)
				</p></li><li><p>
					Complex computations - applications that detect patterns among events (event correlation), filter events, aggregate time or length windows of events, join event series, trigger based on absence of events etc.
				</p></li></ul></div><p>
			The Esper engine was designed to make it easier to build and extend CEP applications. 
        </p><p>
			More information on CEP can be found at <a class="link" href="http://www.espertech.com/esper/esper-faq#whatiscep" target="">FAQ</a>.
        </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="gettingstarted_steps"/>1.2.Â Steps</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="gettingstarted_steps_1"/>1.2.1.Â Step One: Setting up Classpath</h3></div></div></div><p>
				Please add Esper and dependent jar files to the classpath:
			</p><div class="itemizedlist"><ul><li><p>Esper core jar file <code class="literal">esper-</code><span class="emphasis"><em>version</em></span><code class="literal">.jar</code></p></li><li><p>ANTLR parser jar file <code class="literal">antlr-runtime-4.7.jar</code></p></li><li><p>CGLIB code generator jar file <code class="literal">cglib-nodep-3.2.5.jar</code></p></li><li><p>SLF4J logging library <code class="literal">slf4j-api-1.7.25.jar</code></p></li><li><p>Janino Java compiler (unless disabled via configuration, see below) <code class="literal">janino-3.0.7.jar</code> and <code class="literal">commons-compiler-3.0.7.jar</code></p></li></ul></div><p>
				Optionally, for logging using Log4j, please add <code class="literal">slf4j-log4j12-1.7.25.jar</code> and <code class="literal">log4j-1.2.17.jar</code> to the classpath.
			</p><p>
				Optionally, for using Apache Avro with Esper, please add <code class="literal">esper-avro-</code><span class="emphasis"><em>version</em></span><code class="literal">.jar</code> to the classpath.
			</p><p>
				The use of the Janino compiler can be disabled by turning off code generation. Please see <a class="xref" href="#bytecodegen" title="ChapterÂ 22.Â Byte Code Generation">ChapterÂ 22, <i>Byte Code Generation</i></a> and <a class="xref" href="#config-engine-bytecodegen" title="15.4.12.Â Engine Settings Related to Byte Code Generation and Compilation">SectionÂ 15.4.12, âEngine Settings Related to Byte Code Generation and Compilationâ</a>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="gettingstarted_steps_2"/>1.2.2.Â Step Two: Obtain Engine Instance</h3></div></div></div><p>
				Your application can obtain an engine instance by calling the <code class="literal">getDefaultPovider</code> static method of the <code class="literal">EPServiceProviderManager</code> class:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPServiceProvider engine = EPServiceProviderManager.getDefaultProvider();</pre><p>
				This example does not provide a <code class="literal">Configuration</code> configuration object and thus the engine instance returned is configured with defaults. The default engine URI, which is simply the name assigned to the engine, is <code class="literal">"default"</code>.
			</p><p>
				More information about <code class="literal">EPServiceProviderManager</code> can be found at <a class="xref" href="#api-engine-instances" title="14.2.Â The Service Provider Interface">SectionÂ 14.2, âThe Service Provider Interfaceâ</a> and the JavaDoc.
			</p><p>
				More information about engine configuration can be found at <a class="xref" href="#configuration" title="ChapterÂ 15.Â Configuration">ChapterÂ 15, <i>Configuration</i></a> and the JavaDoc. 
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="gettingstarted_steps_3"/>1.2.3.Â Step Three: Provide Information on Input Events</h3></div></div></div><p>
				Your application can register an event type to instruct the engine what the input events look like. When creating EPL statements the engine checks the available event type information
				to determine that the statement is valid.
			</p><p>
				This example assumes that there is a Java class <code class="literal">PersonEvent</code> and each instance of the <code class="literal">PersonEvent</code> class is an event. Note that it is not necessary to create classes for each event type, as explained below. Here is the class:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">package com.mycompany.myapp;

public class PersonEvent {
  private String name;
  private int age;

  public PersonEvent(String name, int age) {
    this.name = name;
    this.age = age;
  }

  public String getName() {
    return name;
  }

  public int getAge() {
    return age;
  }
}</pre><p>
				Your application can call the <code class="literal">addEventType</code> method  that is part of the runtime configuration interface to tell the engine about the <code class="literal">PersonEvent</code> class:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">engine.getEPAdministrator().getConfiguration().addEventType(PersonEvent.class);</pre><p>
				Upon calling the <code class="literal">addEventType</code> method and passing the <code class="literal">PersonEvent</code> class the engine inspects the class using reflection and determines the event properties.
				Because the class has two JavaBean-standard getter-methods the engine determines that a <code class="literal">PersonEvent</code> has two properties: the <code class="literal">name</code> property of type <code class="literal">string</code> and the <code class="literal">age</code> property of type <code class="literal">int</code>.
			</p><p>
				Now that the <code class="literal">PersonEvent</code> event type is known to the engine, your application can create EPL statements that have <code class="literal">PersonEvent</code> in the <code class="literal">from</code>-clause and EPL can refer to event property names.
			</p><p>
				Instead of <code class="literal">PersonEvent</code> being a Java class, it could also be an Apache Avro schema or an XML schema or a Map or array of names and properties. The different event representations are discussed at <a class="xref" href="#eventrep_comparing" title="3.5.Â Comparing Event Representations">SectionÂ 3.5, âComparing Event Representationsâ</a>.
			</p><p>
				Your application can instead pre-configure event types using the <code class="literal">Configuration</code> object, see <a class="xref" href="#configuration-items" title="15.4.Â Configuration Items">SectionÂ 15.4, âConfiguration Itemsâ</a>.
			</p><p>
				Your application can, instead of calling an API, add event types using EPL with <code class="literal">create schema</code>, see <a class="xref" href="#epl_createschema" title="5.15.Â Declaring an Event Type: Create Schema">SectionÂ 5.15, âDeclaring an Event Type: Create Schemaâ</a>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="gettingstarted_steps_4"/>1.2.4.Â Step Four: Create EPL Statements and Attach Callbacks</h3></div></div></div><p>
				The sample EPL for this getting-started section simply selects the name and the age of each arriving person event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select name, age from PersonEvent</pre><p>
				Your application can create an EPL statement using the <code class="literal">createEPL</code> method that is part of the administrative interface.
			</p><p>
				The API calls are:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String epl = "select name, age from PersonEvent";
EPStatement statement = engine.getEPAdministrator().createEPL(epl);</pre><p>
				Upon creating the statement, the engine verifies that <code class="literal">PersonEvent</code> exists since it is listed in the <code class="literal">from</code>-clause.
				The engine also verifies that the <code class="literal">name</code> and <code class="literal">age</code> properties are available for the <code class="literal">PersonEvent</code> since they are listed in the <code class="literal">select</code>-clause.
			</p><p>
				After successful verification, the engine internally adds an entry to an internally-maintained filter index tree structure that ensures that when a <code class="literal">PersonEvent</code> comes in it will be processed by the statement.
			</p><p>
				Your application can attach a callback to the <code class="literal">EPStatement</code> to receive statement results.
			</p><p>
				The following callback simply prints name and age:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">statement.addListener( (newData, oldData) -&gt; {
  String name = (String) newData[0].get("name");
  int age = (int) newData[0].get("age");
  System.out.println("String.format(Name: %s, Age: %d", name, age));
});</pre><p>
				More information about creating EPL statements is at <a class="xref" href="#api-admin-creating" title="14.3.1.Â Creating Statements">SectionÂ 14.3.1, âCreating Statementsâ</a> and <a class="xref" href="#devlifecycle-admin" title="16.6.Â The Deployment Administrative Interface">SectionÂ 16.6, âThe Deployment Administrative Interfaceâ</a> and the JavaDoc.
			</p><p>
				Your application can provide different kinds of callbacks, see <a class="xref" href="#api-receive-results" title="14.3.2.Â Receiving Statement Results">SectionÂ 14.3.2, âReceiving Statement Resultsâ</a>.
			  </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="gettingstarted_steps_5"/>1.2.5.Â Step Five: Send Events</h3></div></div></div><p>
				Your application can send events into the engine using the <code class="literal">sendEvent</code> method that is part of the runtime interface:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">engine.getEPRuntime().sendEvent(new PersonEvent("Peter", 10));</pre><p>
				The output you should see is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Name: Peter, Age: 10</pre><p>
				Upon sending the <code class="literal">PersonEvent</code> event object to the engine, the engine consults the internally-maintainced shared filter index tree structure to determine if any EPL statement is interested in <code class="literal">PersonEvent</code> events.
				The EPL statement that was created as part of this example has <code class="literal">PersonEvent</code> in the <code class="literal">from</code>-clause, thus the engine delegates processing of such events to the statement.
				The EPL statement obtains the name and age properties by calling the <code class="literal">getName</code> and <code class="literal">getAge</code> methods.
			</p><p>
				For different event representations and <code class="literal">sendEvent</code> methods please see <a class="xref" href="#eventrep_comparing" title="3.5.Â Comparing Event Representations">SectionÂ 3.5, âComparing Event Representationsâ</a>.
			</p><p>
				Specialized event senders are explained in <a class="xref" href="#api-runtime-eventsender" title="14.4.1.Â Event Sender">SectionÂ 14.4.1, âEvent Senderâ</a>.
			</p><p>
				For reference, here is the complete code without event class:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPServiceProvider engine = EPServiceProviderManager.getDefaultProvider();
engine.getEPAdministrator().getConfiguration().addEventType(PersonEvent.class);
String epl = "select name, age from PersonEvent";
EPStatement statement = engine.getEPAdministrator().createEPL(epl);
statement.addListener( (newData, oldData) -&gt; {
  String name = (String) newData[0].get("name");
  int age = (int) newData[0].get("age");
  System.out.println(String.format("Name: %s, Age: %d", name, age));
});
engine.getEPRuntime().sendEvent(new PersonEvent("Peter", 10));
</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="required_3rd_party"/>1.3.Â Required 3rd Party Libraries</h2></div></div></div><p>
            Esper requires the following 3rd-party libraries at runtime:
        </p><div class="itemizedlist"><ul compact="compact"><li><p>
					ANTLR is the parser generator used for parsing and parse tree walking of the pattern and EPL syntax. Credit goes to Terence Parr at http://www.antlr.org. The ANTLR license is a BSD license and is provided in <code class="literal">lib/esper_3rdparties.license</code>. The <code class="literal">antlr-runtime</code> runtime library is required for runtime.
				</p></li><li><p>
					CGLIB is the code generation library for fast method calls, licensed under Apache 2.0 license as provided in <code class="literal">lib/esper_3rdparties.license</code>.
				</p></li><li><p>
					SLF4J is a logging API that can work together with LOG4J and other logging APIs. While SLF4J is required, the LOG4J log component is not required and can be replaced with other loggers. SLF4J is licensed under Apache 2.0 license as provided in <code class="literal">lib/esper_3rdparties.license</code>.
				</p></li><li><p>
					Janino (optional) is a small and fast Java compiler. Esper, in the default configuration, generates code and compiles generated code using Janino. Janino is optional and does not need to be in classpath after your configuration disables code generation. Janino is licensed under 3-clause New BSD License as provided in <code class="literal">lib/esper_3rdparties.license</code>.
				</p></li></ul></div><p>
            Esper requires the following 3rd-party libraries for running the test suite:
        </p><div class="itemizedlist"><ul compact="compact"><li><p>
					JUnit is a great unit testing framework. Its license has also been placed in the lib directory. The library is required for build-time only.
				</p></li><li><p>
					MySQL connector library is used for testing SQL integration and is required for running the automated test suite.
				</p></li></ul></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel"/>ChapterÂ 2.Â Basic Concepts</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#processingmodel_intro">2.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicselect">2.2. Basic Select</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicaggregation">2.3. Basic Aggregation</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicfilter">2.4. Basic Filter</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicfilterwithagg">2.5. Basic Filter and Aggregation</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicwindow">2.6. Basic Data Window</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicwindowagg">2.7. Basic Data Window and Aggregation</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicfilterwindowagg">2.8. Basic Filter, Data Window and Aggregation</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicwhereclause">2.9. Basic Where-Clause</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basictimewindow">2.10. Basic Time Window and Aggregation</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicpartition">2.11. Basic Partitioned Query</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicoutputlimited">2.12. Basic Output-Rate-Limited Query</a></span></dt><dt><span class="sect1"><a href="#processingmodel_basicpartitionedandoutputlimited">2.13. Basic Partitioned and Output-Rate-Limited Query</a></span></dt><dt><span class="sect1"><a href="#processingmodel_namedwindows">2.14. Basic Named Windows and Tables</a></span></dt><dt><span class="sect1"><a href="#processingmodel_aggregation">2.15. Basic Aggregated Query Types</a></span></dt><dd><dl><dt><span class="sect2"><a href="#processingmodel_aggregation_batch_unagg">2.15.1. Un-Aggregated and Un-Grouped</a></span></dt><dt><span class="sect2"><a href="#processingmodel_aggregation_batch_full_agg">2.15.2. Fully Aggregated and Un-Grouped</a></span></dt><dt><span class="sect2"><a href="#processingmodel_aggregation_batch_event_agg">2.15.3. Aggregated and Un-Grouped</a></span></dt><dt><span class="sect2"><a href="#processingmodel_aggregation_batch_group_agg">2.15.4. Fully Aggregated and Grouped</a></span></dt><dt><span class="sect2"><a href="#processingmodel_aggregation_batch_event_agg_group">2.15.5. Aggregated and Grouped</a></span></dt></dl></dd><dt><span class="sect1"><a href="#processingmodel_matchrecognizepattern">2.16. Basic Match-Recognize Patterns</a></span></dt><dt><span class="sect1"><a href="#processingmodel_eplpattern">2.17. Basic EPL Patterns</a></span></dt><dt><span class="sect1"><a href="#processingmodel_indexes">2.18. Basic Indexes</a></span></dt><dd><dl><dt><span class="sect2"><a href="#processingmodel_indexes_kinds">2.18.1. Index Kinds</a></span></dt><dt><span class="sect2"><a href="#processingmodel_indexes_filterindexes">2.18.2. Filter Indexes</a></span></dt><dt><span class="sect2"><a href="#processingmodel_indexes_eventindexes">2.18.3. Event Indexes</a></span></dt></dl></dd><dt><span class="sect1"><a href="#processingmodel_3valuedlogic">2.19. Basic Null</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_intro"/>2.1.Â Introduction</h2></div></div></div><p>
			For NEsper .NET also see <a class="xref" href="#appendix_dotnet_processingmodel_intro" title="I.11.Â .NET Basic Concepts">SectionÂ I.11, â.NET Basic Conceptsâ</a>.
		</p><p>
			Esper is a container for EPL queries. EPL queries are continuous query statements that analyze events and time and that detect situations. Esper contains the EPL queries as it manages their lifecycle and execution.
		</p><p>
			You interact with Esper by managing EPL queries and callbacks and by sending events and advancing time.
		</p><div class="table"><a id="d0e473"/><p class="title"><b>TableÂ 2.1.Â Interacting With Esper</b></p><div class="table-contents"><table summary="Interacting With Esper" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>What</th><th>How</th></tr></thead><tbody><tr><td>EPL</td><td>First, deploy EPL queries, please refer to <a class="xref" href="#epl_clauses" title="ChapterÂ 5.Â EPL Reference: Clauses">ChapterÂ 5, <i>EPL Reference: Clauses</i></a> and the API at <a class="xref" href="#api-administrative" title="14.3.Â The Administrative Interface">SectionÂ 14.3, âThe Administrative Interfaceâ</a>.</td></tr><tr><td>Callbacks</td><td>Second, attach executable code that your application provides to receive output, please refer to <a class="xref" href="#api-receive-results" title="14.3.2.Â Receiving Statement Results">SectionÂ 14.3.2, âReceiving Statement Resultsâ</a>.</td></tr><tr><td>Events</td><td>Next, send events using the runtime API, please refer to <a class="xref" href="#api-runtime" title="14.4.Â The Runtime Interface">SectionÂ 14.4, âThe Runtime Interfaceâ</a>.</td></tr><tr><td>Time</td><td>Next, advance time using the runtime API or system time, please refer to <a class="xref" href="#api-controlling-time" title="14.8.Â Controlling Time-Keeping">SectionÂ 14.8, âControlling Time-Keepingâ</a>.</td></tr></tbody></table></div></div><br class="table-break"/><p>
			Esper contains queries like so:
		</p><div class="figure"><a id="processingmodel_into_querycontainerpic"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/refdoc_procmodel_querycontainer.png" align="middle" alt="Esper Is a Query Container"/></div></div><p class="title"><b>FigureÂ 2.1.Â Esper Is a Query Container</b></p></div><br class="figure-break"/><p>
			When time passes or an event arrives Esper evaluates only those queries that need to see such event or time. Esper analyzes EPL queries, performs query planning and utilizes data structures to avoid unneeded evaluation.
		</p><p>
			EPL queries can be partitioned. A partitioned query can have multiple partitions. For example, there could be partition for each room in a building. 
			For a building with 10 rooms you could have one EPL query that has 10 partitions. Please refer to <a class="xref" href="#context" title="ChapterÂ 4.Â Context and Context Partitions">ChapterÂ 4, <i>Context and Context Partitions</i></a>.
		</p><p>
			An EPL query that is not partitioned implicitly has one partition. Upon creating the un-partitioned EPL query Esper allocates the single partition. Upon destroying the un-partitioned EPL query Esper destroys the partition.
		</p><p>
			A partition (or <span class="emphasis"><em>context partition</em></span>) is where Esper keeps the state. In the picture above there are three un-partitioned queries and one partitioned query that has three partitions.
		</p><p>
			The next sections discuss various easily-understood EPL queries. 
			The sections illustrate how queries behave, the information that Esper passes to callbacks (the output) and what information Esper remembers for queries (the <span class="emphasis"><em>state</em></span>, all state lives in a partition).
			The sample queries assume an event type by name <code class="literal">Withdrawal</code> that has <code class="literal">account</code> and <code class="literal">amount</code> properties.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_basicselect"/>2.2.Â Basic Select</h2></div></div></div><p>
			This EPL query selects all <code class="literal">Withdrawal</code> events.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from Withdrawal</pre><p>
			Upon a new <code class="literal">Withdrawal</code> event arriving, Esper passes the arriving event, unchanged and the same object reference, to callbacks.
			After that Esper effectively forgets the current event.
		</p><p>
			The diagram below shows a series of <code class="literal">Withdrawal</code> events (1 to 6) arriving over time.
			In the picture the <code class="literal">W</code><sub>n</sub> stands for a specific <code class="literal">Withdrawal</code> event arriving. The number in parenthesis is the withdrawal amount.
		</p><div class="figure"><a id="processingmodel_into_basicselect"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/refdoc_procmodel_basicselect.png" align="middle" alt="EPL Select Example Input and Output Flow"/></div></div><p class="title"><b>FigureÂ 2.2.Â EPL Select Example Input and Output Flow</b></p></div><br class="figure-break"/><p>
			For this query, Esper remembers no information and does not remember any events. A query where Esper does not need to remember any information at all is a query without state (a <span class="emphasis"><em>stateless</em></span> query).
		</p><p>
			The term <span class="emphasis"><em>insert stream</em></span> is a name for the stream of new events that are arriving. The insert stream in this example is the stream of arriving Withdrawal events.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_basicaggregation"/>2.3.Â Basic Aggregation</h2></div></div></div><p>
			An aggregation function is a function that groups multiple events together to form a single value. Please find more information at <a class="xref" href="#epl-function-aggregation" title="10.2.Â Aggregation Functions">SectionÂ 10.2, âAggregation Functionsâ</a>.
        </p><p>
			This query selects a count and a total amount of all Withdrawal events.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*), sum(amount) from Withdrawal</pre><p>
			Upon a new <code class="literal">Withdrawal</code> event arriving, Esper increments the count and adds the amount to a running total. It passes the new count and total to callbacks.
			After that Esper effectively forgets the current event and does not remember any events at all, but does remember the current count and total.
		</p><div class="figure"><a id="processingmodel_into_basicaggregation"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/refdoc_procmodel_basicaggregation.png" align="middle" alt="EPL Select Example Input and Output Flow"/></div></div><p class="title"><b>FigureÂ 2.3.Â EPL Select Example Input and Output Flow</b></p></div><br class="figure-break"/><p>
			Here, Esper only remembers the current number of events and the total amount. 
			The count is a single long-type value and the total is a single double-type value (assuming <code class="literal">amount</code> is a double-value, the total can be <code class="literal">BigDecimal</code> as applicable).
			 This query is not stateless and the state consists of a long-typed value and a double-typed value.
		</p><p>
			Upon a new <code class="literal">Withdrawal</code> event arriving, Esper increases the count by one and adds the amount to the running total. Esper does not re-compute the count and total because it does not remember events.
			In general, Esper does not re-compute aggregations (unless otherwise indicated). Instead, Esper adds (increments, enters, accumulates) data to aggregation state and subtracts (decrements, removes, reduces, decreases) from aggregation state.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_basicfilter"/>2.4.Â Basic Filter</h2></div></div></div><p>
			Place filter expressions in parenthesis after the event type name. For further information see <a class="xref" href="#epl-from-clause-filter" title="5.4.1.Â Filter-Based Event Streams">SectionÂ 5.4.1, âFilter-Based Event Streamsâ</a>.
		</p><p>
			This statement selects <code class="literal">Withdrawal</code> events that have an amount of 200 or higher:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from Withdrawal(amount &gt;= 200)</pre><p>
			Upon a new <code class="literal">Withdrawal</code> event with an amount of 200 or higher arriving, Esper passes the arriving event to callbacks. 
		</p><div class="figure"><a id="processingmodel_into_basicfilter"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/refdoc_procmodel_basicfilter.png" align="middle" alt="EPL Filter Example Input and Output Flow"/></div></div><p class="title"><b>FigureÂ 2.4.Â EPL Filter Example Input and Output Flow</b></p></div><br class="figure-break"/><p>
			For this query, Esper remembers no information and does not remember any events. 
		</p><p>
			You may ask what happens for <code class="literal">Withdrawal</code> events with an amount of less than 200. The answer is that the EPL query itself does not even see such events. This is because Esper knows to discard such events right away
			and the EPL query does not even know about such events. Esper discards unneeded events very fast enabled by EPL query analysis, planning and suitable data structures.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_basicfilterwithagg"/>2.5.Â Basic Filter and Aggregation</h2></div></div></div><p>
			This statement selects the count and the total amount for <code class="literal">Withdrawal</code> events that have an amount of 200 or higher:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*), sum(amount) from Withdrawal(amount &gt;= 200)</pre><p>
			Upon a new <code class="literal">Withdrawal</code> event with an amount of 200 or higher arriving, Esper increments the count and adds the amount to the running total. Esper passes the count and total to callbacks.
		</p><div class="figure"><a id="processingmodel_into_basicfilterwithagg"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/refdoc_procmodel_basicfilteragg.png" align="middle" alt="EPL Filter and Aggregation Example Input and Output Flow"/></div></div><p class="title"><b>FigureÂ 2.5.Â EPL Filter and Aggregation Example Input and Output Flow</b></p></div><br class="figure-break"/><p>
			In this example Esper only remembers the count and total and again does not remember events. The engine discards <code class="literal">Withdrawal</code> events with an amount of less than 200.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_basicwindow"/>2.6.Â Basic Data Window</h2></div></div></div><p>
			A <span class="emphasis"><em>data window</em></span>, or <span class="emphasis"><em>window</em></span> for short, retains events for the purpose of aggregation, join, match-recognize patterns, subqueries, iterating via API  and output-snapshot.
			A data window defines which subset of events to retain. For example, a length window keeps the last N events and a time window keeps the last N seconds of events.
			See <a class="xref" href="#epl-views" title="ChapterÂ 13.Â EPL Reference: Data Windows">ChapterÂ 13, <i>EPL Reference: Data Windows</i></a> for details.
		</p><p>
			This query selects all <code class="literal">Withdrawal</code> events and instructs Esper to remember the last five events.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from Withdrawal#length(5)</pre><p>
			Upon a new <code class="literal">Withdrawal</code> event arriving, Esper adds the event to the length window. It also passes the same event to callbacks.
		</p><div class="figure"><a id="processingmodel_into_basicdatawindow"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/refdoc_procmodel_basicwindow.png" align="middle" alt="EPL Basic Data Window Example Input and Output Flow"/></div></div><p class="title"><b>FigureÂ 2.6.Â EPL Basic Data Window Example Input and Output Flow</b></p></div><br class="figure-break"/><p>
			Upon arrival of event W<sub>6</sub>, event W<sub>1</sub> leaves the length window. We use the term <span class="emphasis"><em>expires</em></span> to say that an event leaves a data window.
			We use the term <span class="emphasis"><em>remove stream</em></span> to describe the stream of events leaving a data window.
		</p><p>
			Esper remembers up to five events in total (the last five events). At the start of the query the data window is empty.
			By itself, keeping the last five events may not sound useful. But in connection with a join, subquery or match-recognize pattern for example a data window tells the engine which events you want to query.
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
			By default the engine only delivers the insert stream to listeners and observers. 
			EPL supports optional <code class="literal">istream</code>, <code class="literal">irstream</code> and <code class="literal">rstream</code> keywords for select- and insert-into clauses to control which streams to deliver, see <a class="xref" href="#epl-select-using-istream-rstream" title="5.3.7.Â Selecting Insert and Remove Stream Events">SectionÂ 5.3.7, âSelecting Insert and Remove Stream Eventsâ</a>.
        </div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_basicwindowagg"/>2.7.Â Basic Data Window and Aggregation</h2></div></div></div><p>
			This query outputs the count and total of the last five <code class="literal">Withdrawal</code> events.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*), sum(amount) from Withdrawal#length(5)</pre><p>
			Upon a new <code class="literal">Withdrawal</code> event arriving, Esper adds the event to the length window, increases the count by one and adds the amount to the current total amount. 
			Upon a <code class="literal">Withdrawal</code> event leaving the data window, Esper decreases the count by one and subtracts its amount from the current total amount. 
			It passes the running count and total to callbacks.
		</p><div class="figure"><a id="processingmodel_into_basicwindowagg"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/refdoc_procmodel_basicwindowagg.png" align="middle" alt="EPL Basic Data Window and Aggregation Example Input and Output Flow"/></div></div><p class="title"><b>FigureÂ 2.7.Â EPL Basic Data Window and Aggregation Example Input and Output Flow</b></p></div><br class="figure-break"/><p>
			Before the arrival of event W<sub>6</sub> the current count is five and the running total amount is 1000. Upon arrival of event W<sub>6</sub> the following takes place:
        </p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						Esper determines that event W<sub>1</sub> leaves the length window.
				</p></li><li><p>
						To account for the new event W<sub>6</sub>, Esper increases the count by one and adds 300 to the running total amount.
				</p></li><li><p>
						To account for the expiring event W<sub>1</sub>, Esper decreases the count by one and subtracts 500 from the running total amount.
				</p></li><li><p>
						The output is a count of five and a total of 800 as a result of <code class="literal">1000 + 300 - 500</code>.
				</p></li></ol></div><p>
			Esper adds (increments, enters, accumulates) insert stream events into aggregation state and subtracts (decrements, removes, reduces, decreases) remove stream events from aggregation state.
			It thus maintains aggregation state in an incremental fashion.
		</p><p>
			For this query, once the count reaches 5, the count will always remain at 5.
		</p><p>
			The information that Esper remembers for this query is the last five events and the current long-typed count and double-typed total.
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>
				Use the <code class="literal">irstream</code> keyword to receive both the current as well as the previous aggregation value for aggregating queries.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_basicfilterwindowagg"/>2.8.Â Basic Filter, Data Window and Aggregation</h2></div></div></div><p>
			The following query outputs the count and total of the last five <code class="literal">Withdrawal</code> events considering only those <code class="literal">Withdrawal</code> events that have an amount of at least 200:
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*), sum(amount) from Withdrawal(amount&gt;=200)#length(5)</pre><p>
			Upon a new <code class="literal">Withdrawal</code> event arriving, and only if that Withdrawal event has an amount of 200 or more, Esper adds the event to the length window, increases the count by one and adds the amount to the current total amount. 
			Upon a <code class="literal">Withdrawal</code> event leaving the data window, Esper decreases the count by one and subtracts its amount from the current total amount. 
			It passes the running count and total to callbacks.
		</p><div class="figure"><a id="processingmodel_into_basicfilterwindowagg"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/refdoc_procmodel_basicfilterwindowagg.png" align="middle" alt="EPL Basic Filter, Data Window and Aggregation Example Input and Output Flow"/></div></div><p class="title"><b>FigureÂ 2.8.Â EPL Basic Filter, Data Window and Aggregation Example Input and Output Flow</b></p></div><br class="figure-break"/></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_basicwhereclause"/>2.9.Â Basic Where-Clause</h2></div></div></div><p>
			For queries without a data window, the where-clause behaves the same as the filter expressions that are placed in parenthesis.
        </p><p>
			The following two queries are fully equivalent because of the absence of a data window (the <code class="literal">....</code> means any select-clause expressions):
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select .... from Withdrawal(amount &gt; 200)
// equivalent to
select .... from Withdrawal where amount &gt; 200</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
				In Esper, the where-clause is typically used for correlation in a join or subquery. Filter expressions should be placed right after the event type name in parenthesis.
			</p></div><p>
			The next statement applies a where-clause to Withdrawal events. Where-clauses are discussed in more detail in <a class="xref" href="#epl-where-clause" title="5.5.Â Specifying Search Conditions: The Where Clause">SectionÂ 5.5, âSpecifying Search Conditions: The Where Clauseâ</a>.
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from Withdrawal#length(5) where amount &gt;= 200</pre><p>
			The where-clause applies to both new events and expiring events. Only events that pass the where-clause are passed to callbacks.
        </p><div class="figure"><a id="processingmodel_into_basicwhere"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/refdoc_procmodel_basicwhere.png" align="middle" alt="EPL Basic Where-Clause Example Input and Output Flow"/></div></div><p class="title"><b>FigureÂ 2.9.Â EPL Basic Where-Clause Example Input and Output Flow</b></p></div><br class="figure-break"/></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_basictimewindow"/>2.10.Â Basic Time Window and Aggregation</h2></div></div></div><p>
			A time window is a data window that extends the specified time interval into the past. More information on time windows can be found at <a class="xref" href="#view-win-time" title="13.3.3.Â Time Window (time or win:time)">SectionÂ 13.3.3, âTime Window (time or win:time)â</a>.
        </p><p>
			The next query selects the count and total amount of <code class="literal">Withdrawal</code> events considering the last four seconds of events.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*), total(amount) from Withdrawal#time(4)</pre><p>
			The diagram starts at a given time <code class="literal">t</code> and displays the contents of the time window at <code class="literal">t + 4</code> and <code class="literal">t + 5 seconds</code> and so on.
		</p><div class="figure"><a id="processingmodel_into_basictimewindow"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/refdoc_procmodel_basictimewindowagg.png" align="middle" alt="EPL Basic Time Window Example Input and Output Flow"/></div></div><p class="title"><b>FigureÂ 2.10.Â EPL Basic Time Window Example Input and Output Flow</b></p></div><br class="figure-break"/><p>
			The activity as illustrated by the diagram:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					At time <code class="literal">t + 4 seconds</code> an event <code class="literal">W<sub>1</sub></code> arrives and the output is a count of one and a total of 500.
				</p></li><li><p>
					At time <code class="literal">t + 5 seconds</code> an event <code class="literal">W<sub>2</sub></code> arrives and the output is a count of two and a total of 600.
				</p></li><li><p>
					At time <code class="literal">t + 6.5 seconds</code> an event <code class="literal">W<sub>3</sub></code> arrives and the output is a count of three and a total of 800.
				</p></li><li><p>
					At time <code class="literal">t + 8 seconds</code> event <code class="literal">W<sub>1</sub></code> expires and the output is a count of two and a total of 300.
				</p></li></ol></div><p>
			For this query Esper remembers the last four seconds of <code class="literal">Withdrawal</code> events as well as the long-typed count and the double-typed total amount.
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>
				Time can have a millisecond or microsecond resolution.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_basicpartition"/>2.11.Â Basic Partitioned Query</h2></div></div></div><p>
			The queries discussed so far are not partitioned. A query that is not partitioned implicitly has one partition. 
			Upon creating the un-partitioned EPL query Esper allocates the single partition and it destroys the partition when your application destroys the query.
        </p><p>
			A partitioned query is handy for batch processing, sessions, resetting and start/stop of your analysis. For partitioned queries you must specify a context. A context defines how partitions are allocated and destroyed.
			Additional information about partitioned queries and contexts can be found at <a class="xref" href="#context" title="ChapterÂ 4.Â Context and Context Partitions">ChapterÂ 4, <i>Context and Context Partitions</i></a>.
		</p><p>
			We shall have a single partition that starts immediately and ends after four seconds:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context Batch4Seconds start @now end after 4 sec</pre><p>
			The next query selects the count and total amount of <code class="literal">Withdrawal</code> events that arrived since the last reset (resets are at <code class="literal">t</code>, <code class="literal">t+4</code>, <code class="literal">t+8</code> as so on), resetting each four seconds:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context Batch4Seconds select count(*), total(amount) from Withdrawal</pre><div class="figure"><a id="processingmodel_into_basicpartitioned"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/refdoc_procmodel_basicpartitioned.png" align="middle" alt="EPL Basic Partitioned Query Example Input and Output Flow"/></div></div><p class="title"><b>FigureÂ 2.11.Â EPL Basic Partitioned Query Example Input and Output Flow</b></p></div><br class="figure-break"/><p>
			At time <code class="literal">t + 4 seconds</code> and <code class="literal">t + 8 seconds</code> the engine destroys the current partition. This discards the current count and running total. 
			The engine immediately allocates a new partition and the count and total start fresh at zero.
		</p><p>
			For this query Esper only remembers the count and running total, and the fact how long a partition lives.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_basicoutputlimited"/>2.12.Â Basic Output-Rate-Limited Query</h2></div></div></div><p>
			All the previous queries had continuous output. In other words, in each of previous queries output occurred as a result of a new event arriving.
			Use output rate limiting to output when a condition occurs, as described in <a class="xref" href="#epl-output-rate" title="5.7.Â Stabilizing and Controlling Output: The Output Clause">SectionÂ 5.7, âStabilizing and Controlling Output: The Output Clauseâ</a>.
		</p><p>
			The next query outputs the last count and total of all <code class="literal">Withdrawal</code> events every four seconds:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*), total(amount) from Withdrawal output last every 4 seconds</pre><div class="figure"><a id="processingmodel_into_basicoutputlimited"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/refdoc_procmodel_basicoutputratelimited.png" align="middle" alt="EPL Basic Output-Rate-Limited Query Example Input and Output Flow"/></div></div><p class="title"><b>FigureÂ 2.12.Â EPL Basic Output-Rate-Limited Query Example Input and Output Flow</b></p></div><br class="figure-break"/><p>
			At time <code class="literal">t + 4 seconds</code> and <code class="literal">t + 8 seconds</code> the engine outputs the last aggregation values to callbacks.
		</p><p>
			For this query Esper only remembers the count and running total, and the fact when output shall occur.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_basicpartitionedandoutputlimited"/>2.13.Â Basic Partitioned and Output-Rate-Limited Query</h2></div></div></div><p>
			Use a partitioned query with output rate limiting to output-and-reset. This allows you to form batches, analyze a batch and then forget all such state in respect to that batch, continuing with the next batch. 
		</p><p>
			The next query selects the count and total amount of <code class="literal">Withdrawal</code> events that arrived within the last four seconds at the end of four seconds, resetting after output:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context Batch4Seconds start @now end after 4 sec</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context Batch4Seconds select count(*), total(amount) from Withdrawal output last when terminated</pre><div class="figure"><a id="processingmodel_into_basicpartitionedandoutputlimited"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/refdoc_procmodel_basicpartitionedandoutputlimited.png" align="middle" alt="EPL Basic Partitioned and Output-Rate-Limited Query Example Input and Output Flow"/></div></div><p class="title"><b>FigureÂ 2.13.Â EPL Basic Partitioned and Output-Rate-Limited Query Example Input and Output Flow</b></p></div><br class="figure-break"/><p>
			At time <code class="literal">t + 4 seconds</code> and <code class="literal">t + 8 seconds</code> the engine outputs the last aggregation values to callbacks, and resets the current count and total.
		</p><p>
			For this query Esper only remembers the count and running total, and the fact when the output shall occur and how long a partition lives.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_namedwindows"/>2.14.Â Basic Named Windows and Tables</h2></div></div></div><p>
			A named window is a global data window that can take part in many queries, and that can be selected-from, inserted- into and deleted-from by multiple EPL queries.
			Named windows can be queried with fire-and-forget queries through the API and inward-facing JDBC driver.
			The documentation link is <a class="xref" href="#nwtable" title="ChapterÂ 6.Â EPL Reference: Named Windows and Tables">ChapterÂ 6, <i>EPL Reference: Named Windows and Tables</i></a>.
		</p><p>
			Create a named window, for example, to hold alarm information:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window AlertNamedWindow as (origin string, priority string, alarmNumber long)</pre><p>
			Use on-merge to insert and update the named window.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on Alert as a1 merge AlertNamedWindow as a2 where a1.alarmNumber = a2.alarmNumber
  when not matched then insert select *</pre><p>
			The following query outputs the current count of rows in the named window:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*) from AlertNamedWindow</pre><p>
			Tables are similar to named window however have a well-defined primary-key and can share aggregated state, while named windows only share a subset of events.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_aggregation"/>2.15.Â Basic Aggregated Query Types</h2></div></div></div><p>
			The expressions in the select-clause, the use of aggregation functions and the group-by-clause are relevant to EPL query design.
			The overview herein is especially relevant to joins, on-trigger, output-rate-limiting and batch data windows.
		</p><div class="itemizedlist"><ul><li><p>If your query only selects aggregation values, the engine outputs one row (or zero rows in a join).</p></li><li><p>Without a group-by clause, if your query selects non-aggregated values along with aggregation values, the engine outputs a row per event.</p></li><li><p>With a group-by clause, if your query selects non-aggregated values that are all in the group-by-clause, the engine outputs a row per group.</p></li><li><p>With a group-by clause, if your query selects non-aggregated values and not all non-aggregated values are in the group-by-clause, the engine outputs a row per event.</p></li></ul></div><p>
			EPL allows each aggregation function to specify its own grouping criteria. Please find further information in <a class="xref" href="#epl-grouping-agglocal" title="5.6.4.Â Specifying Grouping for Each Aggregation Function">SectionÂ 5.6.4, âSpecifying Grouping for Each Aggregation Functionâ</a>.
			The documentation provides output examples for query types in <a class="xref" href="#appendix_outputspec" title="AppendixÂ A.Â Output Reference and Samples">AppendixÂ A, <i>Output Reference and Samples</i></a>, and the next sections outlines each query type.
		</p><p>
			The examples below assume <code class="literal">BankInformationWindow</code> is a named window defined elsewhere.
			The examples use a join to illustrate. Joins are further described in <a class="xref" href="#epl-join" title="5.12.Â Joining Event Streams">SectionÂ 5.12, âJoining Event Streamsâ</a>.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="processingmodel_aggregation_batch_unagg"/>2.15.1.Â Un-Aggregated and Un-Grouped</h3></div></div></div><p>
				An example statement for the un-aggregated and un-grouped case is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from Withdrawal unidirectional, BankInformationWindow</pre><p>
				Upon a <code class="literal">Withdrawal</code> event coming in, the number of output rows is the number of rows in the <code class="literal">BankInformationWindow</code>.
			</p><p>
				The appendix provides a complete example including input and output events over time at <a class="xref" href="#outputspec-simple" title="A.2.Â Output for Un-Aggregated and Un-Grouped Queries">SectionÂ A.2, âOutput for Un-Aggregated and Un-Grouped Queriesâ</a>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="processingmodel_aggregation_batch_full_agg"/>2.15.2.Â Fully Aggregated and Un-Grouped</h3></div></div></div><p>
				If your statement only selects aggregation values and does not group, your statement may look as the example below:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(amount) 
from Withdrawal unidirectional, BankInformationWindow</pre><p>
				Upon a <code class="literal">Withdrawal</code> event coming in, the number of output rows is always zero or one.
			</p><p>
				The appendix provides a complete example including input and output events over time at <a class="xref" href="#outputspec-rowforall" title="A.3.Â Output for Fully-Aggregated and Un-Grouped Queries">SectionÂ A.3, âOutput for Fully-Aggregated and Un-Grouped Queriesâ</a>.
			</p><p>
				If any aggregation functions specify the <code class="literal">group_by</code> parameter and a dimension, for example <code class="literal">sum(amount, group_by:account)</code>, 
				the query executes as an aggregated and grouped query instead.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="processingmodel_aggregation_batch_event_agg"/>2.15.3.Â Aggregated and Un-Grouped</h3></div></div></div><p>
				If your statement selects non-aggregated properties and aggregation values, and does not group, your statement may be similar to this statement:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select account, sum(amount) 
from Withdrawal unidirectional, BankInformationWindow</pre><p>
				Upon a <code class="literal">Withdrawal</code> event coming in, the number of output rows is the number of rows in the <code class="literal">BankInformationWindow</code>.
			</p><p>
				The appendix provides a complete example including input and output events over time at <a class="xref" href="#outputspec-aggregateall" title="A.4.Â Output for Aggregated and Un-Grouped Queries">SectionÂ A.4, âOutput for Aggregated and Un-Grouped Queriesâ</a>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="processingmodel_aggregation_batch_group_agg"/>2.15.4.Â Fully Aggregated and Grouped</h3></div></div></div><p>
				If your statement selects aggregation values and all non-aggregated properties in the <code class="literal">select</code> clause are listed in the <code class="literal">group by</code> clause, then your statement may look similar to this example:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select account, sum(amount) 
from Withdrawal unidirectional, BankInformationWindow
group by account</pre><p>
				Upon a <code class="literal">Withdrawal</code> event coming in, the number of output rows is one row per unique account number.
			</p><p>
				The appendix provides a complete example including input and output events over time at <a class="xref" href="#outputspec-groupedrowpergroup" title="A.5.Â Output for Fully-Aggregated and Grouped Queries">SectionÂ A.5, âOutput for Fully-Aggregated and Grouped Queriesâ</a>.
			</p><p>
				If any aggregation functions specify the <code class="literal">group_by</code> parameter and a dimension other than <code class="literal">group by</code> dimension(s), 
				for example <code class="literal">sum(amount, group_by:accountCategory)</code>, the query executes as an aggregated and grouped query instead.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="processingmodel_aggregation_batch_event_agg_group"/>2.15.5.Â Aggregated and Grouped</h3></div></div></div><p>
				If your statement selects non-aggregated properties and aggregation values, and groups only some properties using the <code class="literal">group by</code> clause,  your statement may look as below:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select account, accountName, sum(amount) 
from Withdrawal unidirectional, BankInformationWindow
group by account</pre><p>
				Upon a <code class="literal">Withdrawal</code> event coming in, the number of output rows is the number of rows in the <code class="literal">BankInformationWindow</code>.
			</p><p>
				The appendix provides a complete example including input and output events over time at <a class="xref" href="#outputspec-aggregategrouped" title="A.6.Â Output for Aggregated and Grouped Queries">SectionÂ A.6, âOutput for Aggregated and Grouped Queriesâ</a>.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_matchrecognizepattern"/>2.16.Â Basic Match-Recognize Patterns</h2></div></div></div><p>
			Esper offers the standardized match-recognize syntax for finding patterns among events. A match-recognize pattern is very similar to a regular-expression pattern. 
		</p><p>
			The below query is a sample match-recognize pattern. It detects a pattern that may be present in the events held by the named window as declared above. It looks for two immediately-followed events, i.e. with no events in-between for the same origin. The first of the two events must have high priority and the second of the two events must have medium priority.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from AlertNamedWindow
  match_recognize (
    partition by origin
    measures a1.origin as origin, a1.alarmNumber as alarmNumber1, a2.alarmNumber as alarmNumber2
    pattern (a1 a2)
    define
      a1 as a1.priority = 'high',
      a2 as a2.priority = 'medium'
)</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_eplpattern"/>2.17.Â Basic EPL Patterns</h2></div></div></div><p>
			Esper offers the EPL pattern language, a versatile and expressive syntax for finding time and property relationships between events of many streams.
		</p><p>
			Event patterns match when an event or multiple events occur that match the pattern's definition, in a bottom-up fashion.
			Pattern expressions can consist of filter expressions combined with pattern operators. Expressions can contain further nested pattern expressions by including the nested expression(s) in parenthesis.
		</p><p>
			There are five types of operators:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Operators that control pattern finder creation and termination: <code class="literal">every</code></p></li><li><p>Logical operators: <code class="literal">and</code>, <code class="literal">or</code>, <code class="literal">not</code></p></li><li><p>Temporal operators that operate on event order: <code class="literal">-&gt;</code> (the followed-by operator)</p></li><li><p>Guards are where-conditions that cause termination of pattern subexpressions, such as <code class="literal">timer:within</code></p></li><li><p>Observers that observe time events, such as <code class="literal">timer:interval</code> (an interval observer), <code class="literal">timer:at</code> (a crontab-like observer)</p></li></ol></div><p>
			A sample pattern that alerts on each IBM stock tick with a price greater than 80 and within the next 60 seconds:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every StockTickEvent(symbol="IBM", price&gt;80) where timer:within(60 seconds)</pre><p>
			A sample pattern that alerts every five minutes past the hour:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every timer:at(5, *, *, *, *)</pre><p>
			A sample pattern that alerts when event A occurs, followed by either event B or event C:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">A -&gt; ( B or C)</pre><p>
			A pattern where a property of a following event must match a property from the first event:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every a=EventX -&gt; every b=EventY(objectID=a.objectID)</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_indexes"/>2.18.Â Basic Indexes</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="processingmodel_indexes_kinds"/>2.18.1.Â Index Kinds</h3></div></div></div><p>
				Esper, depending on the EPL statements, builds and maintains two kinds of indexes: filter indexes and event indexes.
			</p><p>
				Esper builds and maintains indexes for efficiency so as to achieve good performance.
			</p><p>
				The following table compares the two kinds of indexes:
			</p><div class="table"><a id="d0e1316"/><p class="title"><b>TableÂ 2.2.Â Kinds of Indexes</b></p><div class="table-contents"><table summary="Kinds of Indexes" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Â </th><th>Filter Indexes</th><th>Event Indexes</th></tr></thead><tbody><tr><td>Improve the speed of</td><td>Matching incoming events to currently-active filters that shall process the event</td><td>Lookup of rows</td></tr><tr><td>Similar to</td><td>A structured registry of callbacks; or content-based routing</td><td>Database index</td></tr><tr><td>Index stores values of</td><td>Values provided by expressions</td><td>Values for certain column(s)</td></tr><tr><td>Index points to</td><td>Currently-active filters</td><td>Rows</td></tr><tr><td>Comparable to </td><td>A sieve or a switchboard</td><td>An index in a book</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="processingmodel_indexes_filterindexes"/>2.18.2.Â Filter Indexes</h3></div></div></div><p>
				Filter indexes organize filters so that they can be searched efficiently. Filter indexes link back to the statement that the filter(s) come from. 
			</p><p>
			    We use the term <span class="emphasis"><em>filter</em></span> or <span class="emphasis"><em>filter criteria</em></span> to mean the selection predicate, such as <code class="literal">symbol=âgoogleâ and price &gt; 200 and volume &gt; 111000</code>. 
			    Statements provide filter criteria in the <code class="literal">from</code>-clause, and/or in EPL patterns and/or in context declarations. 
			    Please see <a class="xref" href="#epl-from-clause-filter" title="5.4.1.Â Filter-Based Event Streams">SectionÂ 5.4.1, âFilter-Based Event Streamsâ</a>, <a class="xref" href="#pattern-filter" title="7.4.Â Filter Expressions in Patterns">SectionÂ 7.4, âFilter Expressions in Patternsâ</a> and <a class="xref" href="#context_def_condition_filter" title="4.2.7.1.Â Filter Context Condition">SectionÂ 4.2.7.1, âFilter Context Conditionâ</a>.
			</p><p>
				When the engine receives an event, it consults the filter indexes to determine which statements, if any, must process the event.
			</p><p>
				The purpose of filter indexes is to enable:
			</p><div class="itemizedlist"><ul><li><p>Efficient matching of events to only those statements that need them.</p></li><li><p>Efficient discarding of events that are not needed by any statement.</p></li><li><p>Efficient evaluation with best case approximately O(1) to O(log n) i.e. in the best case executes in approximately the same time regardless of the size of the input data set  which is the number of active filters.</p></li></ul></div><p>
				Filter index building is a result of the engine analyzing the filter criteria in the <code class="literal">from</code>-clause and also in EPL patterns. It is done automatically by the engine.
			</p><p>
				Esper builds and maintains separate sets of filter indexes per event type, when such event type occurs in the <code class="literal">from</code>-clause or pattern. 
				Filter indexes are sharable within the same event type filter. Thus various <code class="literal">from</code>-clauses and patterns that refer for the same event type can contribute to the same set of filter indexes.
			</p><p>
				Esper builds filter indexes in a nested fashion: Filter indexes may contain further filter indexes, forming a tree-like structure, a filter index tree. The nesting of indexes is beyond the introductory discussion provided here.
			</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="processingmodel_indexes_filterindexes_stmt"/>2.18.2.1.Â Filter Index Multi-Statement Example</h3></div></div></div><p>
					The <code class="literal">from</code>-clause in a statement and, in special cases, also the <code class="literal">where</code>-clause provide filter criteria that the engine analyzes and for which it builds filter indexes.
				</p><p>
					For example, assume the <code class="literal">WithdrawalEvent</code> has an <code class="literal">account</code> field. You could create three EPL statements like so:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@name('A') select * from WithdrawalEvent(account = 1)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@name('B') select * from WithdrawalEvent(account = 1)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@name('C') select * from WithdrawalEvent(account = 2)</pre><p>
					In this example, both statement A and statement B register interest in <code class="literal">WithdrawalEvent</code> events that have an <code class="literal">account</code> value of 1. 
					Statement C registers interest in <code class="literal">WithdrawalEvent</code> events that have an <code class="literal">account</code> value of 2.
				</p><p>
					The below table is a sample filter index for the three statements:
				</p><div class="table"><a id="d0e1461"/><p class="title"><b>TableÂ 2.3.Â Sample Filter Index Multi-Statement Example</b></p><div class="table-contents"><table summary="Sample Filter Index Multi-Statement Example" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Value of <code class="literal">account</code></th><th>Filter</th></tr></thead><tbody><tr><td><code class="literal">1</code></td><td>Statement A, Statement B</td></tr><tr><td><code class="literal">2</code></td><td>Statement C</td></tr></tbody></table></div></div><br class="table-break"/><p>
					When a <code class="literal">Withdrawal</code> event arrives, the engine extracts the <code class="literal">account</code> and performs a lookup into above table. 
					If there are no matching rows in the table, for example when the <code class="literal">account</code> is 3, the engine knows that there is no further processing for the event.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="processingmodel_indexes_filterindexes_pattern"/>2.18.2.2.Â Filter Index Pattern Example</h3></div></div></div><p>
					As part of a pattern you may specify event types and filter criteria. The engine analyzes patterns and determines filter criteria for filter index building. 
				</p><p>
					Consider the following example pattern that fires for each <code class="literal">WithdrawalEvent</code> that is followed by another <code class="literal">WithdrawalEvent</code> for the same <code class="literal">account</code> value:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@name('P') select * from pattern [every w1=WithdrawalEvent -&gt; w2=WithdrawalEvent(account = w.account)]</pre><p>
					Upon creating the above statement, the engine starts looking for <code class="literal">WithdrawalEvent</code> events. At this time there is only one active filter:
				</p><div class="itemizedlist"><ul><li><p>
							 A filter looking for <code class="literal">WithdrawalEvent</code> events regardless of account id.
						</p></li></ul></div><p>
					Assume a <code class="literal">WithdrawalEvent</code> W<sub>a</sub> for account 1 arrives. The engine then activates a filter looking for another <code class="literal">WithdrawalEvent</code> for account 1.
					At this time there are two active filters: 
				</p><div class="itemizedlist"><ul><li><p>
							 A filter looking for <code class="literal">WithdrawalEvent</code> events regardless of account id.
						</p></li><li><p>
							A filter looking for <code class="literal">WithdrawalEvent(account=1)</code> associated to <code class="literal">w1</code>=W<sub>a</sub>.
						</p></li></ul></div><p>
					Assume another <code class="literal">WithdrawalEvent</code> W<sub>b</sub> for account 1 arrives. The engine then activates a filter looking for another <code class="literal">WithdrawalEvent</code> for account 1.
					At this time there are three active filters: 
				</p><div class="itemizedlist"><ul><li><p>
							 A filter looking for <code class="literal">WithdrawalEvent</code> events regardless of account id.
						</p></li><li><p>
							A filter looking for <code class="literal">WithdrawalEvent(account=1)</code> associated to <code class="literal">w1</code>=W<sub>a</sub>.
						</p></li><li><p>
							A filter looking for <code class="literal">WithdrawalEvent(account=1)</code> associated to <code class="literal">w2</code>=W<sub>b</sub>.
						</p></li></ul></div><p>
					Assume another <code class="literal">WithdrawalEvent</code> W<sub>c</sub> for account 2 arrives. The engine then activates a filter looking for another <code class="literal">WithdrawalEvent</code> for account 2.
					At this time there are four active filters:
				</p><div class="itemizedlist"><ul><li><p>
							 A filter looking for <code class="literal">WithdrawalEvent</code> events regardless of account id.
						</p></li><li><p>
							A filter looking for <code class="literal">WithdrawalEvent(account=1)</code> associated to <code class="literal">w1</code>=W<sub>a</sub>.
						</p></li><li><p>
							A filter looking for <code class="literal">WithdrawalEvent(account=1)</code> associated to <code class="literal">w1</code>=W<sub>b</sub>.
						</p></li><li><p>
							A filter looking for <code class="literal">WithdrawalEvent(account=2)</code> associated to <code class="literal">w1</code>=W<sub>c</sub>.
						</p></li></ul></div><p>
					The below table is a sample filter index for the pattern after the W<sub>a</sub>, W<sub>b</sub>and W<sub>c</sub> events arrived:
				</p><div class="table"><a id="d0e1666"/><p class="title"><b>TableÂ 2.4.Â Sample Filter Index Pattern Example</b></p><div class="table-contents"><table summary="Sample Filter Index Pattern Example" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Value of <code class="literal">account</code></th><th>Filter</th></tr></thead><tbody><tr><td><code class="literal">1</code></td><td>Statement P Pattern <code class="literal">w1</code>=W<sub>a</sub>, Statement P Pattern <code class="literal">w1</code>=W<sub>b</sub></td></tr><tr><td><code class="literal">2</code></td><td>Statement P Pattern <code class="literal">w1</code>=W<sub>c</sub></td></tr></tbody></table></div></div><br class="table-break"/><p>
					When a <code class="literal">Withdrawal</code> event arrives, the engine extracts the <code class="literal">account</code> and performs a lookup into above table. 
					If a matching row is found, the engine can hand off the event to the relevant pattern subexpressions.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="processingmodel_indexes_filterindexes_context"/>2.18.2.3.Â Filter Index Context Example</h3></div></div></div><p>
					This example is similar to the previous example of multiple statements, but instead it declares a context and associates a single statement to the context.
				</p><p>
					For example, assume the <code class="literal">LoginEvent</code> has an <code class="literal">account</code> field. You could declare a context initiated by a <code class="literal">LoginEvent</code> for a user:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@name('A') create context UserSession initiated by LoginEvent as loginEvent</pre><p>
					By associating the statement to the context you can tell the engine to analze per <code class="literal">LoginEvent</code>, for example:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@name('B') context UserSession select count(*) from WithdrawalEvent(account = context.loginEvent.account)</pre><p>
					Upon creating the above two statements, the engine starts looking for <code class="literal">LoginEvent</code> events. At this time there is only one active filter:
				</p><div class="itemizedlist"><ul><li><p>
							 A filter looking for <code class="literal">LoginEvent</code> events (any account id).
						</p></li></ul></div><p>
					Assume a <code class="literal">LoginEvent</code> L<sub>a</sub> for account 1 arrives. The engine then activates a context partition of statement B and therefore the filter looking for <code class="literal">WithdrawalEvent</code> for account 1.
					At this time there are two active filters: 
				</p><div class="itemizedlist"><ul><li><p>
							 A filter looking for <code class="literal">LoginEvent</code> events (any account id).
						</p></li><li><p>
							A filter looking for <code class="literal">WithdrawalEvent(account=1)</code> associated to <code class="literal">loginEvent</code>=L<sub>a</sub>.
						</p></li></ul></div><p>
					Assume a <code class="literal">LoginEvent</code> L<sub>b</sub> for account 1 arrives. The engine then activates a context partition of statement B and therefore the filter looking for <code class="literal">WithdrawalEvent</code> for account 1.
					At this time there are three active filters: 
				</p><div class="itemizedlist"><ul><li><p>
							 A filter looking for <code class="literal">LoginEvent</code> events (any account id).
						</p></li><li><p>
							A filter looking for <code class="literal">WithdrawalEvent(account=1)</code> associated to <code class="literal">loginEvent</code>=L<sub>a</sub>.
						</p></li><li><p>
							A filter looking for <code class="literal">WithdrawalEvent(account=1)</code> associated to <code class="literal">loginEvent</code>=L<sub>b</sub>.
						</p></li></ul></div><p>
					Assume a <code class="literal">LoginEvent</code> L<sub>c</sub> for account 2 arrives. The engine then activates a context partition of statement B and therefore the filter looking for <code class="literal">WithdrawalEvent</code> for account 2.
					At this time there are four active filters: 
				</p><div class="itemizedlist"><ul><li><p>
							 A filter looking for <code class="literal">LoginEvent</code> events (any account id).
						</p></li><li><p>
							A filter looking for <code class="literal">WithdrawalEvent(account=1)</code> associated to <code class="literal">loginEvent</code>=L<sub>a</sub>.
						</p></li><li><p>
							A filter looking for <code class="literal">WithdrawalEvent(account=1)</code> associated to <code class="literal">loginEvent</code>=L<sub>b</sub>.
						</p></li><li><p>
							A filter looking for <code class="literal">WithdrawalEvent(account=2)</code> associated to <code class="literal">loginEvent</code>=L<sub>c</sub>.
						</p></li></ul></div><p>
					The below table is a sample filter index for the three statement context partitions:
				</p><div class="table"><a id="d0e1882"/><p class="title"><b>TableÂ 2.5.Â Sample Filter Index Context Example</b></p><div class="table-contents"><table summary="Sample Filter Index Context Example" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Value of <code class="literal">account</code></th><th>Filter</th></tr></thead><tbody><tr><td><code class="literal">1</code></td><td>Statement B Context Partition #0 <code class="literal">loginEvent</code>=L<sub>a</sub>, Statement B Context Partition #1 <code class="literal">loginEvent</code>=L<sub>b</sub></td></tr><tr><td><code class="literal">2</code></td><td>Statement B Context Partition #2 <code class="literal">loginEvent</code>=L<sub>c</sub></td></tr></tbody></table></div></div><br class="table-break"/><p>
					When a <code class="literal">Withdrawal</code> event arrives, the engine extracts the <code class="literal">account</code> and performs a lookup into above table. 
					It can then hand of the event directly to the relevant statement context partitions, or ignore the event if no rows are found for a given account id.
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="processingmodel_indexes_eventindexes"/>2.18.3.Â Event Indexes</h3></div></div></div><p>
				Event indexes organize certain columns so that they can be searched efficiently. Event indexes link back to the row that the column(s) come from.
			</p><p>
			    As event indexes are similar to database indexes, for this discussion, we use the term <span class="emphasis"><em>column</em></span> to mean a column in a EPL table or named window and to also mean an event property or field.
				We use the term <span class="emphasis"><em>row</em></span> to mean a row in an EPL table or named window and to also mean an event.
			</p><p>
				When the engine performs statement processing it may use event indexes to find correlated rows efficiently.
			</p><p>
				The purpose of event indexes is to enable:
			</p><div class="itemizedlist"><ul><li><p>Efficient evaluation of subqueries.</p></li><li><p>Efficient evaluation of joins.</p></li><li><p>Efficient evaluation of on-action statements.</p></li><li><p>Efficient evaluation of fire-and-forget queries.</p></li></ul></div><p>
				Event index building is a result of the engine analyzing the <code class="literal">where-</code>clause correlation criteria for joins (<code class="literal">on-</code>clause for outer joins), subqueries, on-action and fire-and-forget queries.
				It is done automatically by the engine. You may utilize the <code class="literal">create index</code> clause to explicitly index named windows and tables. You may utilize query planner hints to influence index building, use and sharing.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="processingmodel_3valuedlogic"/>2.19.Â Basic Null</h2></div></div></div><p>
			EPL and SQL use a three-valued logic: besides <code class="literal">true</code> and <code class="literal">false</code>, the result of expressions can also be unknown. Three-valued logic is a consequence of supporting <code class="literal">null</code> to mark absent data. 
			If a <code class="literal">null</code> value affects the result of a logical expression, the result is neither <code class="literal">true</code> nor <code class="literal">false</code> but unknown.
        </p><p>
			A <code class="literal">null</code> value basically means âcould be anythingâ. It is therefore impossible to tell whether a comparison to <code class="literal">null</code> is <code class="literal">true</code> or <code class="literal">false</code>. 
			Thatâs where the third logical value, unknown, comes in. Unknown means âtrue or false, depending on the null valuesâ.
        </p><p>
			The result of each of the following comparisons is therefore <code class="literal">null</code> (unknown):
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">null = 1</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">null &lt;&gt; 1</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">null &gt; 1</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">null = null</pre><p>
			Nothing <span class="emphasis"><em>equals</em></span> null. Not even <code class="literal">null</code> equals <code class="literal">null</code> because each <code class="literal">null</code> could be different. 
			Thatâs why EPL has the <code class="literal">is null</code> predicate to test whether a value is null or not.
		</p><p>
			Credit: Above is an excerpt from an online text that can be found at <a class="link" href="http://modern-sql.com/concept/three-valued-logic" target="">http://modern-sql.com/concept/three-valued-logic</a>.
		</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="event_representation"/>ChapterÂ 3.Â Event Representations</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#eventrep_intro">3.1. Event Underlying Java Objects</a></span></dt><dt><span class="sect1"><a href="#eventrep-properties">3.2. Event Properties</a></span></dt><dd><dl><dt><span class="sect2"><a href="#eventrep-properties-escaping">3.2.1. Escape Characters</a></span></dt><dt><span class="sect2"><a href="#eventrep-properties-expression">3.2.2. Expression as Key or Index Value</a></span></dt></dl></dd><dt><span class="sect1"><a href="#eventrep-dyncproperties">3.3. Dynamic Event Properties</a></span></dt><dt><span class="sect1"><a href="#eventrep-fragment">3.4. Fragment and Fragment Type</a></span></dt><dt><span class="sect1"><a href="#eventrep_comparing">3.5. Comparing Event Representations</a></span></dt><dd><dl><dt><span class="sect2"><a href="#eventrep_comparing_incoming">3.5.1. Incoming Events</a></span></dt><dt><span class="sect2"><a href="#eventrep_comparing_outgoing">3.5.2. Outgoing Events</a></span></dt><dt><span class="sect2"><a href="#eventrep_comparing_schema">3.5.3. Schema</a></span></dt><dt><span class="sect2"><a href="#eventrep_comparing_advantages">3.5.4. Side-by-Side</a></span></dt></dl></dd><dt><span class="sect1"><a href="#eventrep-generictuple">3.6. Support for Generic Tuples</a></span></dt><dt><span class="sect1"><a href="#eventrep-plug-in">3.7. Additional Event Representations</a></span></dt><dt><span class="sect1"><a href="#eventrep-update">3.8. Updating, Merging and Versioning Events</a></span></dt><dt><span class="sect1"><a href="#eventrep-coarse">3.9. Coarse-Grained Events</a></span></dt><dt><span class="sect1"><a href="#eventrep-insertinto">3.10. Event Objects Instantiated and Populated by Insert Into</a></span></dt></dl></div><p>
		This section outlines the different means to model and represent events.
    </p><p>
		Esper uses the term <span class="emphasis"><em>event type</em></span> to describe the type information available for an event representation.
	</p><p>
	    Your application may configure predefined event types at startup time or dynamically add event types at runtime via API or EPL syntax. See <a class="xref" href="#configuration-items" title="15.4.Â Configuration Items">SectionÂ 15.4, âConfiguration Itemsâ</a> for startup-time configuration and <a class="xref" href="#api-admin-runtime-config" title="14.3.8.Â Runtime Configuration">SectionÂ 14.3.8, âRuntime Configurationâ</a> for the runtime configuration API.
	</p><p>
	    The EPL <code class="literal">create schema</code> syntax allows declaring an event type at runtime using EPL, see <a class="xref" href="#epl_createschema" title="5.15.Â Declaring an Event Type: Create Schema">SectionÂ 5.15, âDeclaring an Event Type: Create Schemaâ</a>.
	</p><p>
		<a class="xref" href="#api-event" title="14.6.Â Event and Event Type">SectionÂ 14.6, âEvent and Event Typeâ</a> explains how an event type becomes visible in EPL statements and output events delivered by the engine.
    </p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="eventrep_intro"/>3.1.Â Event Underlying Java Objects</h2></div></div></div><a id="d0e2076" class="indexterm"/><p>
			An event is an immutable record of a past occurrence of an action or state change. Event properties capture the state information for an event.
        </p><p>
			In Esper, an event can be represented by any of the following underlying Java objects (NEsper .NET, see <a class="xref" href="#appendix_dotnet_eventrep_intro" title="I.6.Â .NET Event Underlying Objects">SectionÂ I.6, â.NET Event Underlying Objectsâ</a>):
        </p><div class="table"><a id="d0e2087"/><p class="title"><b>TableÂ 3.1.Â Event Underlying Java Objects</b></p><div class="table-contents"><table summary="Event Underlying Java Objects" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Java Class</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">java.lang.Object</code></td><td>Any Java POJO (plain-old java object) with getter methods following JavaBean conventions;  Legacy Java classes not following JavaBean conventions can also serve as events .</td></tr><tr><td><code class="literal">java.util.Map</code></td><td>Map events are implementations of the <code class="literal">java.util.Map</code> interface where each map entry is a propery value.</td></tr><tr><td><code class="literal">Object[] (array of object)</code></td><td>Object-array events are arrays of objects (type <code class="literal">Object[]</code>) where each array element is a property value.</td></tr><tr><td><code class="literal">org.apache.avro.generic.GenericData.Record</code></td><td>Apache Avro events are <code class="literal">GenericData.Record</code> objects (Avro is a data serialization system with JSON and schema support)</td></tr><tr><td><code class="literal">org.w3c.dom.Node</code></td><td>XML document object model (DOM).</td></tr><tr><td><code class="literal">org.apache.axiom.om.OMDocument or OMElement</code></td><td>XML - Streaming API for XML (StAX) - Apache Axiom (provided by EsperIO package).</td></tr><tr><td>Application classes</td><td>Plug-in event representation via the extension API.</td></tr></tbody></table></div></div><br class="table-break"/><p>
			Esper provides multiple choices for representing an event. There is no absolute need for you to create new Java classes to represent an event.
		</p><p>
			Event representations have the following in common:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					All event representations support nested, indexed and mapped properties (aka. property expression), as explained in more detail below. There is no limitation to the nesting level.
				</p></li><li><p>
					All event representations provide event type metadata. This includes type metadata for nested properties.
				</p></li><li><p>
					All event representations allow transposing the event itself and parts or all of its property graph into new events. The term transposing refers to selecting the event itself or event properties that are themselves nestable property graphs, and then querying the event's properties or nested property graphs in further statements. The Apache Axiom event representation is an exception and does not currently allow transposing event properties but does allow transposing the event itself.
				</p></li><li><p>
					The Java object, Map, Object-array and Avro representations allow supertypes.
				</p></li></ul></div><p>
			The API behavior for all event representations is the same, with minor exceptions noted. 
		</p><p>
			The benefits of multiple event representations are:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					For applications that already have events in one of the supported representations, there is no need to transform events before processing for both input and output.
				</p></li><li><p>
					Event representations are exchangeable, reducing or eliminating the need to change statements when the event representation changes, i.e. the EPL does not depend on whether events are Objects, Map(s), Object-array(s), Avro record(s) or XML document(s).
				</p></li><li><p>
					Event representations are interoperable, allowing all event representations to interoperate in same or different statements.
				</p></li><li><p>
					The choice makes it possible to consciously trade-off performance, ease-of-use, the ability to evolve and effort needed to import or externalize events and use existing event type metadata. 
				</p></li></ul></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="eventrep-properties"/>3.2.Â Event Properties</h2></div></div></div><a id="d0e2187" class="indexterm"/><p>
			 Event properties capture the state information for an event. Event properties can be simple, indexed, mapped and nested event properties.
		</p><p>
			 The table below outlines the different types of properties and their syntax in an event expression:
		</p><div class="table"><a id="d0e2196"/><p class="title"><b>TableÂ 3.2.Â Types of Event Properties</b></p><div class="table-contents"><table summary="Types of Event Properties" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th>Type</th><th>Description</th><th>Syntax</th><th>Example</th></tr></thead><tbody><tr><td>Simple</td><td>A property that has a single value that may be retrieved.</td><td><pre class="synopsis">name</pre></td><td><pre class="synopsis">sensorId</pre></td></tr><tr><td>Indexed</td><td>An indexed property stores an ordered collection of objects (all of the same type) that can be individually accessed by an integer-valued, non-negative index (or subscript).</td><td><pre class="synopsis">name[<span class="emphasis"><em>index</em></span>]</pre></td><td><pre class="synopsis">temperature[0]</pre></td></tr><tr><td>Mapped</td><td>A mapped property stores a keyed collection of objects (all of the same type).</td><td><pre class="synopsis">name('<span class="emphasis"><em>key</em></span>')</pre></td><td><pre class="synopsis">isTurnedOn('light')</pre></td></tr><tr><td>Nested</td><td>A nested property is a property that lives within another property of an event.</td><td><pre class="synopsis">name.nestedname</pre></td><td><pre class="synopsis">sensor.value</pre></td></tr></tbody></table></div></div><br class="table-break"/><p>
			Combinations are also possible. For example, a valid combination could be <code class="literal">person.address('home').street[0]</code>.
		</p><p>
			You may use any expression as a mapped property key or indexed property index by putting the expression within parenthesis after the mapped or index property name. Please find examples below.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="eventrep-properties-escaping"/>3.2.1.Â Escape Characters</h3></div></div></div><p>
				If your application uses <code class="literal">java.util.Map</code>, <code class="literal">Object[]</code> (object-array) or XML to represent events, then event property names may themselves contain the dot ('.') character. The backslash ('\') character can be used to escape dot characters in property names, allowing a property name to contain dot characters. 
			</p><p>
				For example, the EPL as shown below expects a property by name <code class="literal">part1.part2</code> to exist on event type <code class="literal">MyEvent</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select part1\.part2 from MyEvent</pre><p>
				Sometimes your event properties may overlap with EPL language keywords or contain spaces or other special characters. In this case you may use the backwards apostrophe <code class="literal">`</code> (aka. back tick) character to escape the property name.
			</p><p>
				The next example assumes a <code class="literal">Quote</code> event that has a property by name <code class="literal">order</code>, while <code class="literal">order</code> is also a reserved keyword:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select `order`, price as `price.for.goods` from Quote</pre><p>
				When escaping mapped or indexed properties, make sure the back tick character appears outside of the map key or index.
			</p><p>
				The next EPL selects event properties that have names that contain spaces (e.g. <code class="literal">candidate book</code>), have the tick special character  (e.g. <code class="literal">children's books</code>), are an indexed property (e.g. <code class="literal">children's books[0]</code>) and a mapped property 
				that has a reserved keyword as part of the property name (e.g. <code class="literal">book select('isbn')</code>):
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select `candidate book` , `children's books`[0], `book select`('isbn') from MyEventType</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
					Avro does not support the dot-character in field names.
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="eventrep-properties-expression"/>3.2.2.Â Expression as Key or Index Value</h3></div></div></div><p>
				The key or index expression must be placed in parenthesis.  When using an expression as key for a mapped property, the expression must return a <code class="literal">String</code>-typed value. When using an expression as index for an indexed property, the expression must return an <code class="literal">int</code>-typed value.				
			</p><p>
				This example below uses Java classes to illustrate; The same principles apply to all event representations.
			</p><p>
				Assume a class declares these properties (getters not shown for brevity):
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyEventType {
  String myMapKey;
  int myIndexValue;
  int myInnerIndexValue;
  Map&lt;String, InnerType&gt; innerTypesMap;	// mapped property
  InnerType[] innerTypesArray; // indexed property
}

public class InnerType {
  String name;
  int[] ids;
}</pre><p>
				A sample EPL statement demonstrating expressions as map keys or indexes is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select innerTypesMap('somekey'),  // returns map value for 'somekey'
  innerTypesMap(myMapKey),        // returns map value for myMapKey value (an expression)
  innerTypesArray[1],             // returns array value at index 1
  innerTypesArray(myIndexValue)   // returns array value at index myIndexValue (an expression)
  from MyEventType</pre><p>
				The dot-operator can be used to access methods on the value objects returned by the mapped or indexed properties. By using the dot-operator the syntax follows the chained method invocation described at <a class="xref" href="#epl-operator-ref-dot" title="9.6.Â Dot Operator">SectionÂ 9.6, âDot Operatorâ</a>.
			</p><p>
				A sample EPL statement demonstrating the dot-operator as well as expressions as map keys or indexes is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""> select innerTypesMap('somekey').ids[1],
  innerTypesMap(myMapKey).getIds(myIndexValue),
  innerTypesArray[1].ids[2],
  innerTypesArray(myIndexValue).getIds(myInnerIndexValue)
  from MyEventType</pre><p>
				Please note the following limitations:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						The square brackets-syntax for indexed properties does now allow expressions and requires a constant index value.
					</p></li><li><p>
						When using the dot-operator with mapped or indexed properties that have expressions as map keys or indexes you must follow the chained method invocation syntax.
					</p></li></ul></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="eventrep-dyncproperties"/>3.3.Â Dynamic Event Properties</h2></div></div></div><a id="d0e2373" class="indexterm"/><a id="d0e2376" class="indexterm"/><p>
			Dynamic (unchecked) properties are event properties that need not be known at statement compilation time. Such properties are resolved during runtime: they provide duck typing functionality.
		</p><p>
			The idea behind dynamic properties is that for a given underlying event representation you don't always know all properties in advance. An underlying event may have additional properties that are not known at statement compilation time, that you want to query on. The concept is especially useful for events that represent rich, object-oriented domain models.
		</p><p>
			The syntax of dynamic properties consists of the property name and a question mark. Indexed, mapped and nested properties can also be dynamic properties:
		</p><div class="table"><a id="d0e2387"/><p class="title"><b>TableÂ 3.3.Â Types of Event Properties</b></p><div class="table-contents"><table summary="Types of Event Properties" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Type</th><th>Syntax</th></tr></thead><tbody><tr><td>Dynamic Simple</td><td><pre class="synopsis">name?</pre></td></tr><tr><td>Dynamic Indexed</td><td><pre class="synopsis">name[<span class="emphasis"><em>index</em></span>]?</pre></td></tr><tr><td>Dynamic Mapped</td><td><pre class="synopsis">name('<span class="emphasis"><em>key</em></span>')?</pre></td></tr><tr><td>Dynamic Nested</td><td><pre class="synopsis">name?.nestedPropertyName</pre></td></tr></tbody></table></div></div><br class="table-break"/><p>
			 Dynamic properties always return the <code class="literal">java.lang.Object</code> type. Also, dynamic properties return a <code class="literal">null</code> value if the dynamic property does not exist on events processed at runtime. 
		</p><p>
			As an example, consider an OrderEvent event that provides an "item" property. The "item" property is of type <code class="literal">Object</code> and holds a reference to an instance of either a Service or Product. 
		</p><p>
			Assume that both Service and Product classes provide a property named "price". Via a dynamic property you can specify a query that obtains the price property from either object (Service or Product):
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select item.price? from OrderEvent</pre><p>
			 As a second example, assume that the Service class contains a "serviceName" property that the Product class does not possess. The following query returns the value of the "serviceName" property for Service objects. It returns a <code class="literal">null</code>-value for Product objects that do not have the "serviceName" property:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select item.serviceName? from OrderEvent</pre><p>
			Consider the case where OrderEvent has multiple implementation classes, some of which have a "timestamp" property. The next query returns the timestamp property of those implementations of the OrderEvent interface that feature the property:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timestamp? from OrderEvent</pre><p>
			The query as above returns a single column named "timestamp?" of type <code class="literal">Object</code>. 			
		</p><p>
			When dynamic properties are nested, then all properties under the dynamic property are also considered dynamic properties. In the below example the query asks for the "direction" property of the object returned by the "detail" dynamic property:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select detail?.direction from OrderEvent</pre><p>
			Above is equivalent to:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select detail?.direction? from OrderEvent</pre><p>
			The functions that are often useful in conjunction with dynamic properties are:
		</p><div class="itemizedlist"><ul><li><p>
                    The <code class="literal">cast</code> function casts the value of a dynamic property (or the value of an expression) to a given type.
                </p></li><li><p>
                    The <code class="literal">exists</code> function checks whether a dynamic property exists. It returns <code class="literal">true</code> if the event has a property of that name, or false if the property does not exist on that event.
                </p></li><li><p>
                    The <code class="literal">instanceof</code> function checks whether the value of a dynamic property (or the value of an expression) is of any of the given types.
                </p></li><li><p>
                    The <code class="literal">typeof</code> function returns the string type name of a dynamic property.
                </p></li></ul></div><p>
			Dynamic event properties work with all event representations outlined next: Java objects, Map-based, Object-array-based and XML DOM-based events.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="eventrep-fragment"/>3.4.Â Fragment and Fragment Type</h2></div></div></div><p>
			Sometimes an event can have properties that are itself events. Esper uses the term <span class="emphasis"><em>fragment</em></span> and <span class="emphasis"><em>fragment type</em></span> for such event pieces. The best example is a pattern
			that matches two or more events and the output event contains the matching events as fragments. In other words, output events can be a composite event that consists of further events, the fragments.
		</p><p>
			Fragments have the same metadata available as their enclosing composite events. The metadata for enclosing composite events contains information about which properties are fragments, or have a property value that can be 
			represented as a fragment and therefore as an event itself.
		</p><p>
			Fragments and type metadata can allow your application to navigate composite events without the need for using the Java reflection API and reducing the coupling to the underlying event representation.
			The API is further described in <a class="xref" href="#api-event" title="14.6.Â Event and Event Type">SectionÂ 14.6, âEvent and Event Typeâ</a>.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="eventrep_comparing"/>3.5.Â Comparing Event Representations</h2></div></div></div><p>
			More information on event representations can be found in the appendix. The links are:
		</p><div class="table"><a id="d0e2525"/><p class="title"><b>TableÂ 3.4.Â Comparing Event Representations</b></p><div class="table-contents"><table summary="Comparing Event Representations" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Event Representation</th><th>More Information and Examples</th></tr></thead><tbody><tr><td>Java Object (POJO/Bean or other)</td><td><a class="xref" href="#appendix_eventrepbean" title="AppendixÂ D.Â Event Representation: Plain-Old Java Object Events">AppendixÂ D, <i>Event Representation: Plain-Old Java Object Events</i></a></td></tr><tr><td>Map</td><td><a class="xref" href="#appendix_eventrepmap" title="AppendixÂ E.Â Event Representation: java.util.Map Events">AppendixÂ E, <i>Event Representation: java.util.Map Events</i></a></td></tr><tr><td>Object-array</td><td><a class="xref" href="#appendix_eventrepoa" title="AppendixÂ F.Â Event Representation: Object-Array (Object[]) Events">AppendixÂ F, <i>Event Representation: Object-Array (Object[]) Events</i></a></td></tr><tr><td>Avro</td><td><a class="xref" href="#appendix_eventrepavro" title="AppendixÂ G.Â Event Representation: Avro Events (org.apache.avro.generic.GenericData.Record)">AppendixÂ G, <i>Event Representation: Avro Events (org.apache.avro.generic.GenericData.Record)</i></a></td></tr><tr><td>XML Document</td><td><a class="xref" href="#appendix_eventrepxml" title="AppendixÂ H.Â Event Representation: org.w3c.dom.Node XML Events">AppendixÂ H, <i>Event Representation: org.w3c.dom.Node XML Events</i></a></td></tr></tbody></table></div></div><br class="table-break"/><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="eventrep_comparing_incoming"/>3.5.1.Â Incoming Events</h3></div></div></div><p>
				For sending incoming events into the engine for processing, your application uses one of the send-event methods on the <code class="literal">EPRuntime</code> interface: 
			</p><div class="table"><a id="d0e2571"/><p class="title"><b>TableÂ 3.5.Â EPRuntime Send-event Methods</b></p><div class="table-contents"><table summary="EPRuntime Send-event Methods" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Event Representation</th><th>Method for Processing Events</th></tr></thead><tbody><tr><td>Java Object (POJO/Bean or other)</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">sendEvent(Object event)</pre></td></tr><tr><td>Map</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">sendEvent(Map map, String mapEventTypeName)</pre></td></tr><tr><td>Object-array</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">sendEvent(Object[] objectarray, String objectArrayEventTypeName)</pre></td></tr><tr><td>Avro</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">sendEvent(Object avroGenericDataDotRecord, String avroEventTypeName)</pre></td></tr><tr><td>XML Document</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">sendEvent(org.w3c.dom.Node node)</pre></td></tr></tbody></table></div></div><br class="table-break"/><p>
				Please find an example in the respective appendix.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="eventrep_comparing_outgoing"/>3.5.2.Â Outgoing Events</h3></div></div></div><p>
				The <code class="literal">StatementUpdateListener</code> interface receives EPL statement output. The output events can be either of the representations
			</p><div class="table"><a id="d0e2624"/><p class="title"><b>TableÂ 3.6.Â Annotation for Receiving Events</b></p><div class="table-contents"><table summary="Annotation for Receiving Events" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Event Representation</th><th>Annotation</th></tr></thead><tbody><tr><td>Java Object (POJO/Bean or other)</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">N/A</pre></td></tr><tr><td>Map</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@EventRepresentation(map)</pre></td></tr><tr><td>Object-array</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@EventRepresentation(objectarray)</pre></td></tr><tr><td>Avro</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@EventRepresentation(avro)</pre></td></tr><tr><td>XML Document</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">N/A</pre></td></tr></tbody></table></div></div><br class="table-break"/><p>
				Please find an example in the respective appendix.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="eventrep_comparing_schema"/>3.5.3.Â Schema</h3></div></div></div><p>
				The create-schema clause can be used to define an event type and its event representation.
			</p><div class="table"><a id="d0e2674"/><p class="title"><b>TableÂ 3.7.Â Create-Schema</b></p><div class="table-contents"><table summary="Create-Schema" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Event Representation</th><th>Annotation</th></tr></thead><tbody><tr><td>Java Object (POJO/Bean or other)</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>name</em></span> as <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>class_name</em></span></pre></td></tr><tr><td>Map</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create map schema <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>name</em></span> as (...)</pre></td></tr><tr><td>Object-array</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create objectarray schema <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>name</em></span> as (...)</pre></td></tr><tr><td>Avro</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create avro schema <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>name</em></span> as (...)</pre></td></tr><tr><td>XML Document</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">N/A</pre></td></tr></tbody></table></div></div><br class="table-break"/><p>
				Your EPL statements can use <code class="literal">create schema</code> and <code class="literal">insert into</code> to define an event type and to produce events of the type.
			</p><p>
				In the following example the first statement declares a schema and the second statement inserts events according to the schema:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create map schema ParkingEvent as (carId string, driverName string)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into ParkingEvent select carId, 'jim' as driverName from CarArrivalEvent</pre><p>
				Please find additional examples in <a class="xref" href="#epl_createschema" title="5.15.Â Declaring an Event Type: Create Schema">SectionÂ 5.15, âDeclaring an Event Type: Create Schemaâ</a>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="eventrep_comparing_advantages"/>3.5.4.Â Side-by-Side</h3></div></div></div><p>
				Each of the event representations of Java object, Map, Object-array, Avro and XML document has advantages and disadvantages that are summarized in the table below:
			</p><div class="table"><a id="d0e2754"/><p class="title"><b>TableÂ 3.8.Â Comparing Event Representations</b></p><div class="table-contents"><table summary="Comparing Event Representations" border="1"><colgroup><col/><col/><col/><col/><col/><col/></colgroup><thead><tr><th>Â </th><th>Java Object (POJO/Bean or other)</th><th>Map</th><th>Object-array</th><th>Avro</th><th>XML Document</th></tr></thead><tbody><tr><td>Performance</td><td>Very Good (with Byte Code Generation, else Good)</td><td>Good</td><td>Very Good</td><td>Very Good</td><td>Not comparable and depending on use of XPath</td></tr><tr><td>Memory Use</td><td>Small</td><td>Medium</td><td>Small</td><td>Small</td><td>Depends on DOM and XPath implementation used, can be large</td></tr><tr><td>Call Method on Event</td><td>Yes</td><td>Yes, if contains Object(s)</td><td>Yes, if contains Object(s)</td><td>No</td><td>No</td></tr><tr><td>Nested, Indexed, Mapped and Dynamic Properties</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Course-grained event syntax</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Insert-into that Representation</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>No</td></tr><tr><td>Runtime Type Change</td><td>Reload class, yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Create-schema Syntax</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>No, runtime and static configuration</td></tr><tr><td>Object is Self-Descriptive</td><td>Yes</td><td>Yes</td><td>No</td><td>Yes</td><td>Yes</td></tr><tr><td>Supertypes</td><td>Multiple</td><td>Multiple</td><td>Single</td><td>Single</td><td>No</td></tr></tbody></table></div></div><br class="table-break"/></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="eventrep-generictuple"/>3.6.Â Support for Generic Tuples</h2></div></div></div><p>
			   Esper does not require a fixed tuple structure and fully supports generic tuples. Event properties can be defined, added to existing types and queried at runtime.
		   </p><p>
			 The facilities for support of generic tuples are:  
		   </p><div class="itemizedlist"><ul><li><p>Dynamic properties allow querying properties that are not defined, see <a class="xref" href="#eventrep-dyncproperties" title="3.3.Â Dynamic Event Properties">SectionÂ 3.3, âDynamic Event Propertiesâ</a>.</p></li><li><p>The <code class="literal">cast</code> function for operations that require strongly-typed data, see <a class="xref" href="#epl-single-row-function-cast" title="10.1.2.Â The Cast Function">SectionÂ 10.1.2, âThe Cast Functionâ</a>.</p></li><li><p>Type inheritance for adding properties to supertypes, see <a class="xref" href="#epl_createschema" title="5.15.Â Declaring an Event Type: Create Schema">SectionÂ 5.15, âDeclaring an Event Type: Create Schemaâ</a></p></li><li><p>The Map event representation, as it allows any map key to become an event property, see <a class="xref" href="#appendix_eventrepmap" title="AppendixÂ E.Â Event Representation: java.util.Map Events">AppendixÂ E, <i>Event Representation: java.util.Map Events</i></a></p></li><li><p>The Avro event representation, as it allows any Avro field to become an event property, see <a class="xref" href="#appendix_eventrepavro" title="AppendixÂ G.Â Event Representation: Avro Events (org.apache.avro.generic.GenericData.Record)">AppendixÂ G, <i>Event Representation: Avro Events (org.apache.avro.generic.GenericData.Record)</i></a></p></li><li><p>The POJO event representation, as getter-methods and fields can be dynamically discovered to become an event property, see <a class="xref" href="#appendix_eventrepbean" title="AppendixÂ D.Â Event Representation: Plain-Old Java Object Events">AppendixÂ D, <i>Event Representation: Plain-Old Java Object Events</i></a></p></li><li><p>The XML event representation, as the DOM can have any attribute or nested element and there does not need to be a schema, see <a class="xref" href="#appendix_eventrepxml" title="AppendixÂ H.Â Event Representation: org.w3c.dom.Node XML Events">AppendixÂ H, <i>Event Representation: org.w3c.dom.Node XML Events</i></a></p></li><li><p>Event types can be updated at runtime using the API</p></li></ul></div><p>
				There is no need to explicitly create an event type for each tuple type. It is not necessary to create classes for tuple types at all. Events can be arbitrary objects.
			</p><p>
				The engine validates EPL at statement creation time therefore there is an advantage if type information is available: the engine can verify your EPL statement against the known properties and types,
				preventing you as the EPL designer from making mistakes in EPL design.
				The engine does not verify dynamic properties, which may return <code class="literal">null</code> at runtime. 
				If type information is not available then properties are assumed to return <code class="literal">java.lang.Object</code>-typed values.
			</p><p>
				For example, let's say you need a generic tuple and you have <code class="literal">Map</code> events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema GenericTuple()</pre><p>
				Create statements that use dynamic properties, as the next EPL shows, which casts the timestamp value to a <code class="literal">long</code>-type value and outputs the hour-minute-second string:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select cast(timestamp?, long).format('hh mm ss') from GenericTuple</pre><p>
				Send events like this:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Map&lt;String, Object&gt; genericEvent = new HashMap&lt;&gt;();
genericEvent.put("timestamp", new Date().getTime());
genericEvent.put("some_other_property", "hello");
epService.getEPRuntime().sendEvent(genericEvent, "GenericTuple");</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="eventrep-plug-in"/>3.7.Â Additional Event Representations</h2></div></div></div><a id="d0e2983" class="indexterm"/><p>
		    Part of the extension and plug-in features of Esper is an event representation API. This set of classes allow an application to create new event types and event instances based on information available elsewhere, statically or dynamically at runtime when EPL statements are created. Please see <a class="xref" href="#custom-event-representation" title="17.8.Â Event Type and Event Object">SectionÂ 17.8, âEvent Type and Event Objectâ</a> for details.
		</p><p>
			Creating a plug-in event representation can be useful when your application has existing Java classes that carry event metadata and event property values and your application does not want to (or cannot) extract or transform
such event metadata and event data into one of the built-in event representations (POJO Java objects, Map, Object-array or XML DOM).
		</p><p>
			Further use of a plug-in event representation is to provide a faster or short-cut access path to event data. For example, access to event data stored in a XML format through the Streaming API for XML (StAX) is known to be very efficient. A plug-in event representation can also provide network lookup and dynamic resolution of event type and dynamic sourcing of event instances.
		</p><p>
			Currently, EsperIO provides the following additional event representations:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					Apache Axiom: Streaming API for XML (StAX) implementation
				</p></li></ul></div><p>
			Please see the EsperIO documentation for details on the above.
		</p><p>
			The chapter on <a class="xref" href="#custom-event-representation" title="17.8.Â Event Type and Event Object">SectionÂ 17.8, âEvent Type and Event Objectâ</a> explains how to create your own custom event representation.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="eventrep-update"/>3.8.Â Updating, Merging and Versioning Events</h2></div></div></div><a id="d0e3011" class="indexterm"/><a id="d0e3016" class="indexterm"/><p>
			To summarize, an event is an immutable record of a past occurrence of an action or state change, and event properties contain useful information about an event.
        </p><p>
			The length of time an event is of interest to the event processing engine (retention time) depends on your EPL statements, and especially the data window, pattern and output rate 
			limiting clauses of your statements.
        </p><p>
			During the retention time of an event more information about the event may become available, such as additional properties or changes to existing properties. 
			Esper provides three concepts for handling updates to events.
        </p><p>
			  The first means to handle updating events is the <code class="literal">update istream</code> clause as further described in <a class="xref" href="#epl-update" title="5.20.Â Updating an Insert Stream: The Update IStream Clause">SectionÂ 5.20, âUpdating an Insert Stream: The Update IStream Clauseâ</a>. It is useful when you need to update events as they enter a stream, before events are evaluated by any particular 
			  consuming statement to that stream.
        </p><p>
			  The second means to update events is the <code class="literal">on-merge</code> and <code class="literal">on-update</code> clauses, for use with tables and named windows only, as further described in <a class="xref" href="#named_upsert" title="6.8.Â Triggered Upsert Using the On-Merge Clause">SectionÂ 6.8, âTriggered Upsert Using the On-Merge Clauseâ</a> and <a class="xref" href="#named_update" title="6.6.Â Updating Data: The On Update Clause">SectionÂ 6.6, âUpdating Data: The On Update Clauseâ</a>. On-merge
			  is similar to the SQL <code class="literal">merge</code> clause and provides what is known as an "Upsert" operation: Update existing events or if no existing event(s) are found then insert a new event, all in one atomic operation provided by a single EPL statement. 
			  On-update can be used to update individual properties of rows held in a table or named window.
        </p><p>
			  The third means to handle updating events is the revision event types, for use with named windows only, as further described in <a class="xref" href="#named_versioning" title="6.11.Â Versioning and Revision Event Type Use With Named Windows">SectionÂ 6.11, âVersioning and Revision Event Type Use With Named Windowsâ</a>. With revision event types you can declare, via configuration only, multiple different event types. The engine can present a merged event type that contains a superset of properties of all merged types, and the engine can merge events as they arrive without additional EPL statements.
        </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="eventrep-coarse"/>3.9.Â Coarse-Grained Events</h2></div></div></div><a id="d0e3056" class="indexterm"/><a id="d0e3061" class="indexterm"/><p>
			Your application events may consist of fairly comprehensive, coarse-grained structures or documents. For example in business-to-business integration scenarios, XML documents or other event objects can be rich deeply-nested graphs of event properties.
        </p><p>
			To extract information from a coarse-grained event or to perform bulk operations on the rows of the property graph in an event, Esper provides a convenient syntax: 
			When specifying a filter expression in a pattern or in a <code class="literal">select</code> clause, it may contain an contained-event selection syntax, as further described in <a class="xref" href="#epl-containedeventselect" title="5.19.Â Contained-Event Selection">SectionÂ 5.19, âContained-Event Selectionâ</a>.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="eventrep-insertinto"/>3.10.Â Event Objects Instantiated and Populated by <code class="literal">Insert Into</code></h2></div></div></div><a id="d0e3080" class="indexterm"/><p>
			For NEsper .NET also see <a class="xref" href="#appendix_dotnet_eventrep_insertinto" title="I.10.Â .NET Event Objects Instantiated and Populated by Insert Into">SectionÂ I.10, â.NET Event Objects Instantiated and Populated by Insert Intoâ</a>.
		</p><p>
			The <code class="literal">insert into</code> clause can instantiate and populate new instances of Java object events, <code class="literal">java.util.Map</code> events and <code class="literal">Object[]</code> (object array) events directly from the results of <code class="literal">select</code> clause expressions. Simply use the event type name as the stream name in the <code class="literal">insert into</code> clause as described in <a class="xref" href="#epl-insert-into" title="5.10.Â Merging Streams and Continuous Insertion: The Insert Into Clause">SectionÂ 5.10, âMerging Streams and Continuous Insertion: The Insert Into Clauseâ</a>.
        </p><p>
           If instead you have an existing instance of a Java object returned by an expression, such as a single-row function or static method invocation for example, you can transpose that expression result object to a stream. This is described further in <a class="xref" href="#insert-into-expression" title="5.10.7.Â Transposing an Expression Result">SectionÂ 5.10.7, âTransposing an Expression Resultâ</a> and <a class="xref" href="#functionreference-transpose" title="10.4.Â Select-Clause Transpose Function">SectionÂ 10.4, âSelect-Clause Transpose Functionâ</a>.
        </p><p>
			The column names specified in the <code class="literal">select</code> and <code class="literal">insert into</code> clause must match available writable properties in the event object to be populated (the target event type). The expression result types of any expressions in the <code class="literal">select</code> clause must also be compatible with the property types of the target event type.
		</p><p>
			If populating a POJO-based event type and the class provides a matching constructor, the expression result types of expressions in the <code class="literal">select</code> clause must be compatible with the constructor parameters in the order listed by the constructor. The <code class="literal">insert into</code> clause column names are not relevant in this case.
		</p><p>
			Consider the following example statement:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into com.mycompany.NewEmployeeEvent 
select fname as firstName, lname as lastName from HRSystemEvent</pre><p>
			The above example specifies the fully-qualified class name of <code class="literal">NewEmployeeEvent</code>. The engine instantianes <code class="literal">NewEmployeeEvent</code> for each result row and populates the <code class="literal">firstName</code> and <code class="literal">lastName</code> properties of each instance from the result of <code class="literal">select</code> clause expressions. The <code class="literal">HRSystemEvent</code> in the example is assumed to have <code class="literal">lname</code> and <code class="literal">fname</code> properties, and either setter-methods and a default constructor, or a matching constructor.
		</p><p>
			Note how the example uses the <code class="literal">as</code>-keyword to assign column names that match the property names of the <code class="literal">NewEmployeeEvent</code> target event. If the property names of the source and target events are the same, the <code class="literal">as</code>-keyword is not required.
		</p><p>
			The next example is an alternate form and specifies property names within the <code class="literal">insert into</code> clause instead. The example also assumes that <code class="literal">NewEmployeeEvent</code> has been defined or imported via configuration since it does not specify the event class package name:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into NewEmployeeEvent(firstName, lastName) 
select fname, lname from HRSystemEvent</pre><p>
			Finally, this example populates <code class="literal">HRSystemEvent</code> events. The example populates the value of a <code class="literal">type</code> property where the event has the value 'NEW' and populates a new event object with the value 'HIRED', copying the <code class="literal">fname</code> and <code class="literal">lname</code> property values to the new event object:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into HRSystemEvent 
select fname, lname, 'HIRED' as type from HRSystemEvent(type='NEW')</pre><p>
          The matching of the <code class="literal">select</code> or <code class="literal">insert into</code>-clause column names to target event type's property names is case-sensitive. You can specify a subset of all available columns in the target event type. Wildcard (<code class="literal">*</code>) is allowed and copies all fields of the events or multiple events in a join.
		</p><p>
			For Java object events, your event class must provide setter-methods according to JavaBean conventions or, alternatively, a matching constructor. If the event class provides setter methods the class should also provide a default constructor taking no parameters. If the event class provides a matching constructor there is no need for setter-methods. If your event class does not have a default constructor and setter methods, or a matching constructor, your application may configure a factory method via <code class="literal">ConfigurationEventTypeLegacy</code>. If your event class does not have a default constructor and there is no factory method provided, the engine uses in connection with the Oracle JVM the <code class="literal">sun.reflect.ReflectionFactory</code>, noting that in this case member variables do not get initialized to assigned defaults.
		</p><p>
			The engine follows Java standards in terms of widening, performing widening automatically in cases where widening type conversion is allowed without loss of precision, for both boxed and primitive types and including BigInteger and BigDecimal.
		</p><p>
			When inserting array-typed properties into a Java, Map-type or Object-array underlying event the event definition should declare the target property as an array.
		</p><p>
		    Please note the following limitations: 
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					Event types that utilize XML <code class="literal">org.w3c.dom.Node</code> underlying event objects cannot be target of an <code class="literal">insert into</code> clause.
				</p></li></ul></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="context"/>ChapterÂ 4.Â Context and Context Partitions</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#context_intro">4.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#context_decl">4.2. Context Declaration</a></span></dt><dd><dl><dt><span class="sect2"><a href="#context_decl_props">4.2.1. Context-Provided Properties</a></span></dt><dt><span class="sect2"><a href="#context_def_keyed">4.2.2. Keyed Segmented Context</a></span></dt><dt><span class="sect2"><a href="#context_def_hashed">4.2.3. Hash Segmented Context</a></span></dt><dt><span class="sect2"><a href="#context_def_category">4.2.4. Category Segmented Context</a></span></dt><dt><span class="sect2"><a href="#context_def_nonoverlapping">4.2.5. Non-Overlapping Context</a></span></dt><dt><span class="sect2"><a href="#context_def_overlapping">4.2.6. Overlapping Context</a></span></dt><dt><span class="sect2"><a href="#context_def_condition">4.2.7. Context Conditions</a></span></dt></dl></dd><dt><span class="sect1"><a href="#context_nesting">4.3. Context Nesting</a></span></dt><dd><dl><dt><span class="sect2"><a href="#context_nesting_walkthru">4.3.1. Nested Context Sample Walk-Through</a></span></dt><dt><span class="sect2"><a href="#context_nesting_builtin">4.3.2. Built-In Nested Context Properties</a></span></dt></dl></dd><dt><span class="sect1"><a href="#context_other">4.4. Partitioning Without Context Declaration</a></span></dt><dt><span class="sect1"><a href="#context_outputterminated">4.5. Output When a Context Partition Ends or Terminates</a></span></dt><dt><span class="sect1"><a href="#context_named_windows">4.6. Context and Named Window</a></span></dt><dt><span class="sect1"><a href="#context_tables">4.7. Context and Tables</a></span></dt><dt><span class="sect1"><a href="#context_variables">4.8. Context and Variables</a></span></dt><dt><span class="sect1"><a href="#context_selection">4.9. Operations on Specific Context Partitions</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="context_intro"/>4.1.Â Introduction</h2></div></div></div><p>
			This section discusses the notion of context and its role in the Esper event processing language (EPL).
        </p><p>
           When you look up the word <span class="emphasis"><em>context</em></span> in a dictionary, you may find: Context is the set of circumstances or facts that surround a particular event, situation, etc. 
        </p><p>
          Context-dependent event processing occurs frequently: For example, consider a requirement that monitors banking transactions. For different customers your analysis considers customer-specific aggregations, patterns or data windows. In this example the context of detection is the customer. For a given customer you may want to analyze the banking transactions of that customer by using aggregations, data windows, patterns including other EPL constructs.
        </p><p>
          In a second example, consider traffic monitoring to detect speed violations. Assume the speed limit must be enforced only between 9 am and 5 pm. The context of detection is of temporal nature.
        </p><p>
           A context takes a cloud of events and classifies them into one or more sets. These sets are called <span class="emphasis"><em>context partitions</em></span>. An event processing operation that is associated with a context operates on each of these context partitions independently. (Credit: Taken from the book "Event Processing in Action" by Opher Etzion and Peter Niblett.)
           A basic partitioned query was reviewed in <a class="xref" href="#processingmodel_basicpartition" title="2.11.Â Basic Partitioned Query">SectionÂ 2.11, âBasic Partitioned Queryâ</a>.
        </p><p>
          A context is a declaration of dimension and may thus result in one or more context partitions. In the banking transaction example the context dimension is the customer and a context partition exists per customer. In the traffic monitoring example there is a single context partition that exists only between 9 am and 5 pm and does not exist outside of that daily time period.
        </p><p>
          In an event processing glossary you may find the term <span class="emphasis"><em>event processing agent</em></span>. An EPL statement is an <span class="emphasis"><em>event processing agent</em></span>.  An alternative term for context partition is <span class="emphasis"><em>event processing agent instance</em></span>. 
        </p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Think of context partitions as instances of a class, wherein the class is the EPL statement. </p></div><p>
          Esper EPL allows you to declare contexts explicitly, offering the following benefits:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
                    Context can apply to multiple statements thereby eliminating the need to duplicate context dimensional information between statements.
                </p></li><li><p>
                    Context partitions can be temporally overlapping.
                </p></li><li><p>
                    Context partitions provide a fine-grained lifecycle that is independent of the lifecycle of statement lifecycle, making it easy to specify when an analysis should start and end.
                </p></li><li><p>
                    Fine-grained lock granularity: The engine locks on the level of context partitions thereby allowing very high concurrency, with a maximum (theoretical) degree of parallelism at 2^31-1 (2,147,483,647) parallel threads working to process a single EPL statement under a hash segmented context.
                </p></li><li><p>
                    EPL can become easier to read as common predicate expressions can be factored out into a context.
                </p></li><li><p>
                    You may specify a nested context that is composed from two or more contexts. In particular a temporal context type is frequently used in combination with a segmentation-oriented context.
                </p></li><li><p>
                    Using contexts your application can aggregate events over time periods (overlapping or non-overlapping) without retaining any events in memory.
                </p></li><li><p>
                    Using contexts your application can coordinate boundaries for multiple statements.
                </p></li></ol></div><p>
          Esper EPL allows you to declare a context explicitly via the <code class="literal">create context</code> syntax introduced below.
		</p><p>
		  After you have declared a context, one or more EPL statements can refer to that context by specifying <code class="literal">context </code><span class="emphasis"><em>name</em></span>.
		  When an EPL statement refers to a context, all EPL-statement related state such as aggregations, patterns or data windows etc. exists once per context partition.
		</p><p>
		  If an EPL statement does not declare a context, it implicitly has a single context partition. The single context partition lives as long as the EPL statement is started and ends when the EPL statement is stopped.
		</p><p>
			You may have heard of the term <span class="emphasis"><em>session</em></span>. A context partition is the same as a session.
		</p><p>
			You may have heard of the term <span class="emphasis"><em>session window</em></span> to describe the duration between when a session becomes alive to when a session gets destroyed. We use the term context partition lifecycle instead.
		</p><p>
			The context declaration specifies how the engine manages context partitions (or sessions):
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
                    For keyed segmented context there is a context partition (or session) per key or multiple keys see <a class="xref" href="#context_def_keyed" title="4.2.2.Â Keyed Segmented Context">SectionÂ 4.2.2, âKeyed Segmented Contextâ</a>.
				</p></li><li><p>
                    For hash segmented context there is a context partition (or session) per hash code of one or more keys see <a class="xref" href="#context_def_hashed" title="4.2.3.Â Hash Segmented Context">SectionÂ 4.2.3, âHash Segmented Contextâ</a>.
				</p></li><li><p>
                    For overlapping contexts there can be multiple overlapping context partitions (or sessions), see <a class="xref" href="#context_def_overlapping" title="4.2.6.Â Overlapping Context">SectionÂ 4.2.6, âOverlapping Contextâ</a>.
				</p></li><li><p>
                    For non-overlapping contexts there is only zero or one single context partition (or session), see <a class="xref" href="#context_def_nonoverlapping" title="4.2.5.Â Non-Overlapping Context">SectionÂ 4.2.5, âNon-Overlapping Contextâ</a>.
				</p></li><li><p>
                    For category segmented context there is a context partition (or session) per predefined category, see <a class="xref" href="#context_def_category" title="4.2.4.Â Category Segmented Context">SectionÂ 4.2.4, âCategory Segmented Contextâ</a>.
				</p></li></ul></div><p>
		   For the API to administrate context partitions please see <a class="xref" href="#api-contextpartitionadmin" title="14.19.Â Context Partition Administration">SectionÂ 14.19, âContext Partition Administrationâ</a>. For more information on locking and threading please see <a class="xref" href="#api-threading" title="14.7.Â Engine Threading and Concurrency">SectionÂ 14.7, âEngine Threading and Concurrencyâ</a>. For performance related information please refer to <a class="xref" href="#performance" title="ChapterÂ 23.Â Performance">ChapterÂ 23, <i>Performance</i></a>.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="context_decl"/>4.2.Â Context Declaration</h2></div></div></div><p>
			The <code class="literal">create context</code> statement declares a context by specifying a context name and context dimension information.
		</p><p>
			A context declaration by itself does not consume any resources or perform any logic until your application starts at least one statement that refers to that context. Until then the context is inactive and not in use.
		</p><p>
			When your application creates or starts the first statement that refers to the context, the engine activates the context.
		</p><p>
			As soon as your application stops or destroys all statements that refer to the context, the context becomes inactive again.
		</p><p>
		   When your application stops or destroys a statement that refers to a context, the context partitions associated to that statement also end (context partitions associated to other started statements live on).
		</p><p>
		   When your application stops or destroys the statement that declared the context and does not also stop or destroy any statements that refer to the context, the context partitions associated to each such statement do not end.
		</p><p>
			When your application destroys the statement that declared the context and destroys all statements that refer to that context then the engine removes the context declaration entirely.
		</p><p>
			The <code class="literal">create context</code> statement posts no output events to listeners or subscribers and does not return any rows when iterated.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="context_decl_props"/>4.2.1.Â Context-Provided Properties</h3></div></div></div><p>
			   Each of the context declarations makes available a set of built-in context properties as well as initiating event or pattern properties, as applicable. You may select these context properties for output or use them in any of the statement expressions.
			</p><p>
			   Refer to built-in context properties as <code class="literal">context.</code><span class="emphasis"><em>property_name</em></span>, wherein <span class="emphasis"><em>property_name</em></span> refers to the name of the built-in context property.
			</p><p>
			   Refer to initiating event or pattern match event properties as <code class="literal">context.</code><span class="emphasis"><em>stream_name</em></span>.<span class="emphasis"><em>property_name</em></span>, wherein <span class="emphasis"><em>stream_name</em></span> refers to the name assigned to the event or the tag name specified in a pattern and <span class="emphasis"><em>property_name</em></span> refers to the name of the initiating event or pattern match event property.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="context_def_keyed"/>4.2.2.Â Keyed Segmented Context</h3></div></div></div><p>
				  This context assigns events to context partitions based on the values of one or more event properties, using the value of these property(s) as a key that picks a unique context partition directly. Each event thus belongs to exactly one context partition or zero context partitions if the event does not match the optional filter predicate expression(s). Each context partition handles exactly one set of key values.
			</p><p>
				The syntax for creating a keyed segmented context is as follows: 
			</p><pre class="synopsis">create context <span class="emphasis"><em>context_name</em></span> partition [by]
  <span class="emphasis"><em>event_property</em></span> [and <span class="emphasis"><em>event_property</em></span> [and ...]] from <span class="emphasis"><em>stream_def</em></span>
  [, <span class="emphasis"><em>event_property</em></span> [...] from <span class="emphasis"><em>stream_def</em></span>]
  [, ...]</pre><p>
				The <span class="emphasis"><em>context_name</em></span> you assign to the context can be any identifier.
			</p><p>
				Following the context name is one or more lists of event properties and a stream definition for each entry, separated by comma (<code class="literal">,</code>).
			</p><p>
				The <span class="emphasis"><em>event_property</em></span> is the name(s) of the event properties that provide the value(s) to pick a unique partition. Multiple event property names are separated by the <code class="literal">and</code> keyword.
			</p><p>
				The <span class="emphasis"><em>stream_def</em></span> is a stream definition which consists of an event type name optionally followed by parenthesis that contains filter expressions. If providing filter expressions, only events matching the provided filter expressions for that event type are considered by context partitions. The name of a named window or table is not allowed.
			</p><p>				
				You may list multiple event properties for each stream definition. You may list multiple stream definitions. Please refer to usage guidelines below when specifying multiple event properties and/or multiple stream definitions.
			</p><p>
				The next statement creates a context <code class="literal">SegmentedByCustomer</code> that considers the value of the <code class="literal">custId</code> property of the <code class="literal">BankTxn</code> event type to pick the context partition to assign events to:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context SegmentedByCustomer partition by custId from BankTxn</pre><p>
			    The following statement refers to the context created as above to compute a total withdrawal amount per account for each customer:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context SegmentedByCustomer
select custId, account, sum(amount) from BankTxn group by account</pre><p>
			    The following statement refers to the context created as above and detects a withdrawal of more than 400 followed by a second withdrawal of more then 400 that occur within 10 minutes of the first withdrawal, all for the same customer:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context SegmentedByCustomer
select * from pattern [
  every a=BankTxn(amount &gt; 400) -&gt; b=BankTxn(amount &gt; 400) where timer:within(10 minutes)
]</pre><p>
				The EPL statement that refers to a keyed segmented context must have at least one filter expression, at any place within the EPL statement that looks for events of any of the event types listed in the context declaration.
			</p><p>
			    For example, the following is not valid:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Neither LoginEvent nor LogoutEvent are listed in the context declaration
context SegmentedByCustomer
select * from pattern [every a=LoginEvent -&gt; b=LogoutEvent where timer:within(10 minutes)]</pre><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="context_def_keyed_multitype"/>4.2.2.1.Â Multiple Stream Definitions</h4></div></div></div><p>				
					If the context declaration lists multiple streams, each event type must be unrelated: You may not list the same event type twice and you may not list a sub- or super-type of any event type already listed.
				</p><p>
					The following is not a valid declaration since the <code class="literal">BankTxn</code> event type is listed twice:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Not valid
create context SegmentedByCustomer partition by custId from BankTxn, account from BankTxn</pre><p>
					If the context declaration lists multiple streams, the number of event properties provided for each event type must also be the same. The value type returned by event properties of each event type must match within the respective position it is listed in, i.e. the first property listed for each event type must have the same type, the second property listed for each event type must have the same type, and so on.
				</p><p>
					The following is not a valid declaration since the customer id of <code class="literal">BankTxn</code> and login time of <code class="literal">LoginEvent</code> is not the same type:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Invalid: Type mismatch between properties
create context SegmentedByCustomer partition by custId from BankTxn, loginTime from LoginEvent</pre><p>
					The next statement creates a context <code class="literal">SegmentedByCustomer</code> that also considers <code class="literal">LoginEvent</code> and <code class="literal">LogoutEvent</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context SegmentedByCustomer partition by 
  custId from BankTxn, loginId from LoginEvent, loginId from LogoutEvent</pre><p>
				  As you may have noticed, the above example refers to <code class="literal">loginId</code> as the event property name for <code class="literal">LoginEvent</code> and <code class="literal">LogoutEvent</code> events. The assumption is that the <code class="literal">loginId</code> event property of the login and logout events has the same type and carries the same exact value as the <code class="literal">custId</code> of bank transaction events, thereby allowing all events of the three event types to apply to the same customer-specific context partition.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="context_def_keyed_filter"/>4.2.2.2.Â Filters</h4></div></div></div><p>
				  You may add a filter expression to each of the event types listed. The engine applies the filter expression to the EPL statement that refers to the context and to the same event type.
				</p><p>
					The next statement creates a context <code class="literal">SegmentedByCustomer</code> that does not consider login events that indicate that the login failed.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context SegmentedByCustomer partition by 
  custId from BankTxn, loginId from LoginEvent(failed=false)</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="context_def_keyed_multiprop"/>4.2.2.3.Â Multiple Properties per Event Type</h4></div></div></div><p>
					You may assign events to context partitions based on the values of two or more event properties. The engine thus uses the combination of values of these properties to pick a context partition.
				</p><p>
					An example context declaration follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context ByCustomerAndAccount partition by custId and account from BankTxn</pre><p>
					The next statement refers to the context and computes a total withdrawal amount, per account and customer:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context ByCustomerAndAccount select custId, account, sum(amount) from BankTxn</pre><p>
				  As you can see, the above statement does not need to specify <code class="literal">group by</code> clause to aggregate per customer and account, since events of each unique combination of customer id and account are assigned to separate context partitions.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="context_def_keyed_builtin"/>4.2.2.4.Â Built-In Context Properties</h4></div></div></div><p>
				  The following context properties are available in your EPL statement when it refers to a keyed segmented context:
				</p><div class="table"><a id="d0e3586"/><p class="title"><b>TableÂ 4.1.Â Keyed Segmented Context Properties</b></p><div class="table-contents"><table summary="Keyed Segmented Context Properties" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">name</code></td><td>The string-type context name.</td></tr><tr><td><code class="literal">id</code></td><td>The integer-type internal context partition id that the engine assigns to the context partition.</td></tr><tr><td><code class="literal">key1</code></td><td>The event property value for the first key.</td></tr><tr><td><code class="literal">key</code><span class="emphasis"><em>N</em></span></td><td>The event property value for the Nth key.</td></tr></tbody></table></div></div><br class="table-break"/><p>
					Assume the keyed segmented context is declared as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context ByCustomerAndAccount partition by custId and account from BankTxn</pre><p>
					You may, for example, select the context properties as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context ByCustomerAndAccount
  select context.name, context.id, context.key1, context.key2 from BankTxn</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="context_def_keyed_additional"/>4.2.2.5.Â Examples of Joins</h4></div></div></div><p>
				  This section discusses the impact of contexts on joins to provide further samples of use and deepen the understanding of context partitions.
				</p><p>
				    Consider a context declared as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context ByCust partition by custId from BankTxn</pre><p>
				  The following statement matches, within the same customer id, the current event with the last 30 minutes of events to determine those events that match amounts:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context ByCust 
  select * from BankTxn as t1 unidirectional, BankTxn#time(30) t2 
  where t1.amount = t2.amount</pre><p>
				  Note that the <code class="literal">where</code>-clause in the join above does not mention customer id. Since each <code class="literal">BankTxn</code> applies to a specific context partition the join evaluates within that single context partition.
				</p><p>
				  Consider the next statement that matches a security event with the last 30 minutes of transaction events for each customer:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context ByCust
  select * from SecurityEvent as t1 unidirectional, BankTxn#time(30) t2 
  where t1.customerName = t2.customerName</pre><p>
				    When a security event comes in, it applies to all context partitions and not any specific context partition, since the <code class="literal">SecurityEvent</code> event type is not part of the context declaration.
				  </p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="context_def_hashed"/>4.2.3.Â Hash Segmented Context</h3></div></div></div><p>
				  This context assigns events to context partitions based on the result of a hash function and modulo operation. Each event belongs to exactly one context partition or zero context partitions if the event does not match the optional filter predicate expression(s). Each context partition handles exactly one result of hash value modulo granularity. 
			</p><p>
				The syntax for creating a hashed segmented context is as follows: 
			</p><pre class="synopsis">create context <span class="emphasis"><em>context_name</em></span> coalesce [by] 
  <span class="emphasis"><em>hash_func_name</em></span>(<span class="emphasis"><em>hash_func_param</em></span>) from <span class="emphasis"><em>stream_def</em></span>
  [, <span class="emphasis"><em>hash_func_name</em></span>(<span class="emphasis"><em>hash_func_param</em></span>) from <span class="emphasis"><em>stream_def</em></span> ]
  [, ...]
  granularity <span class="emphasis"><em>granularity_value</em></span>
  [preallocate]</pre><p>
				The <span class="emphasis"><em>context_name</em></span> you assign to the context can be any identifier.
			</p><p>
				Following the context name is one or more lists of hash function name and parameters pairs and a stream definition for each entry, separated by comma (<code class="literal">,</code>).
			</p><p>
				The <span class="emphasis"><em>hash_func_name</em></span> can either be <code class="literal">consistent_hash_crc32</code> or <code class="literal">hash_code</code> or a plug-in single-row function. The <span class="emphasis"><em>hash_func_param</em></span> is a list of parameter expressions.
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						If you specify <code class="literal">consistent_hash_crc32</code> the engine computes a consistent hash code using the CRC-32 algorithm. 
					</p></li><li><p>
						If you specify <code class="literal">hash_code</code> the engine uses the Java object hash code. 
					</p></li><li><p>
						If you specify the name of a plug-in single-row function your function must return an integer value that is the hash code. You may use the wildcard <code class="literal">(*)</code> character among the parameters to pass the underlying event to the single-row function.
					</p></li></ul></div><p>
				The <span class="emphasis"><em>stream_def</em></span> is a stream definition which consists of an event type name optionally followed by parenthesis that contains filter expressions. If providing filter expressions, only events matching the provided filter expressions for that event type are considered by context partitions. The name of a named window or table is not allowed.
			</p><p>				
				You may list multiple stream definitions. Please refer to usage guidelines below when specifying multiple stream definitions.
			</p><p>
			  The <code class="literal">granularity</code> is required and is an integer number that defines the maximum number of context partitions. The engine computes hash code modulo granularity <code class="literal">hash(</code><span class="emphasis"><em>params</em></span><code class="literal">) mod </code><span class="emphasis"><em>granularity</em></span> to determine the context partition. When you specify the <code class="literal">hash_code</code> function the engine uses the object hash code and the computation is <span class="emphasis"><em>params.</em></span><code class="literal">hashCode() %</code> <span class="emphasis"><em>granularity</em></span>.
			</p><p>
			  Since the engine locks on the level of context partition to protect state, the granularity defines the maximum degree of parallelism. For example, a granularity of 1024 means that 1024 context partitions handle events and thus a maximum 1024 threads can process each assigned statement concurrently.
			</p><p>
			  The optional <code class="literal">preallocate</code> keyword instructs the engine to allocate all context partitions at once at the time a statement refers to the context. This is beneficial for performance as the engine does not need to determine whether a context partition exists and dynamically allocate, but may require more memory. 
			</p><p>
				The next statement creates a context <code class="literal">SegmentedByCustomerHash</code> that considers the CRC-32 hash code of the <code class="literal">custId</code> property of the <code class="literal">BankTxn</code> event type to pick the context partition to assign events to, with up to 16 different context partitions that are preallocated:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context SegmentedByCustomerHash
  coalesce by consistent_hash_crc32(custId) from BankTxn granularity 16 preallocate</pre><p>
			    The following statement refers to the context created as above to compute a total withdrawal amount per account for each customer:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context SegmentedByCustomerHash
select custId, account, sum(amount) from BankTxn group by custId, account</pre><p>
			  Note that the statement above groups by <code class="literal">custId</code>: Since the events for different customer ids can be assigned to the same context partition, it is necessary that the EPL statement also groups by customer id.
			</p><p>
				The context declaration shown next assumes that the application provides a <code class="literal">computeHash</code> single-row function that accepts BankTxn as a parameter, wherein the result of this function must be an integer value that returns the context partition id for each event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context MyHashContext
  coalesce by computeHash(*) from BankTxn granularity 16 preallocate</pre><p>
				The EPL statement that refers to a hash segmented context must have at least one filter expression, at any place within the EPL statement that looks for events of any of the event types listed in the context declaration.
			</p><p>
			    For example, the following is not valid:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Neither LoginEvent nor LogoutEvent are listed in the context declaration
context SegmentedByCustomerHash
select * from pattern [every a=LoginEvent -&gt; b=LogoutEvent where timer:within(10 minutes)]</pre><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="context_def_hashed_multitype"/>4.2.3.1.Â Multiple Stream Definitions</h4></div></div></div><p>				
					If the context declaration lists multiple streams, each event type must be unrelated: You may not list the same event type twice and you may not list a sub- or super-type of any event type already listed.
				</p><p>
					If the context declaration lists multiple streams, the hash code function should return the same hash code for the related keys of all streams.
				</p><p>
					The next statement creates a context <code class="literal">HashedByCustomer</code> that also considers <code class="literal">LoginEvent</code> and <code class="literal">LogoutEvent</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context HashedByCustomer as coalesce
  consistent_hash_crc32(custId) from BankTxn,
  consistent_hash_crc32(loginId) from LoginEvent, 
  consistent_hash_crc32(loginId) from LogoutEvent
  granularity 32 preallocate</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="context_def_hashed_filter"/>4.2.3.2.Â Filters</h4></div></div></div><p>
				  You may add a filter expression to each of the event types listed. The engine applies the filter expression to the EPL statement that refers to the context and to the same event type.
				</p><p>
					The next statement creates a context <code class="literal">HashedByCustomer </code> that does not consider login events that indicate that the login failed.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context HashedByCustomer 
  coalesce consistent_hash_crc32(loginId) from LoginEvent(failed = false) 
  granularity 1024 preallocate</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="context_def_hashed_builtin"/>4.2.3.3.Â Built-In Context Properties</h4></div></div></div><p>
				  The following context properties are available in your EPL statement when it refers to a keyed segmented context:
				</p><div class="table"><a id="d0e3850"/><p class="title"><b>TableÂ 4.2.Â Hash Segmented Context Properties</b></p><div class="table-contents"><table summary="Hash Segmented Context Properties" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">name</code></td><td>The string-type context name.</td></tr><tr><td><code class="literal">id</code></td><td>The integer-type internal context partition id that the engine assigns to the context partition.</td></tr></tbody></table></div></div><br class="table-break"/><p>
					Assume the hashed segmented context is declared as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context ByCustomerHash coalesce consistent_hash_crc32(custId) from BankTxn granularity 1024</pre><p>
					You may, for example, select the context properties as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context ByCustomerHash
  select context.name, context.id from BankTxn</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="context_def_hashed_perf"/>4.2.3.4.Â Performance Considerations</h4></div></div></div><p>
				  The <code class="literal">hash_code</code> function based on the Java object hash code is generally faster than the CRC32 algorithm. The CRC32 algorithm, when used with a non-String parameter or with multiple parameters, requires the engine to serialize all expression results to a byte array to compute the CRC32 hash code.
				</p><p>
				  We recommend keeping the granularity small (1k and under) when using <code class="literal">preallocate</code>.
				</p><p>
				  When specifying a granularity greater than <code class="literal">65536</code> (64k) the engine switches to a Map-based lookup of context partition state which can slow down statement processing.
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="context_def_category"/>4.2.4.Â Category Segmented Context</h3></div></div></div><p>
				  This context assigns events to context partitions based on the values of one or more event properties, using a predicate expression(s) to define context partition membership. Each event can thus belong to zero, one or many context partitions depending on the outcome of the predicate expression(s).
			</p><p>
				The syntax for creating a category segmented context is as follows: 
			</p><pre class="synopsis">create context <span class="emphasis"><em>context_name</em></span>
  group [by] <span class="emphasis"><em>group_expression</em></span> as <span class="emphasis"><em>category_label</em></span>
  [, group [by] <span class="emphasis"><em>group_expression</em></span> as <span class="emphasis"><em>category_label</em></span>]
  [, ...]
  from <span class="emphasis"><em>stream_def</em></span></pre><p>
				The <span class="emphasis"><em>context_name</em></span> you assign to the context can be any identifier.
			</p><p>
				Following the context name is a list of groups separated by the <code class="literal">group</code> keyword. The list of groups is followed by the <code class="literal">from</code> keyword and a stream definition.
			</p><p>
				The <span class="emphasis"><em>group_expression</em></span> is an expression that categorizes events. Each group expression must be followed by the <code class="literal">as</code> keyword and a category label which can be any identifier.
			</p><p>
				Group expressions are predicate expressions and must return a Boolean-type true or false when applied to an event. For a given event, any number of group expressions may return true thus categories can be overlapping.
			</p><p>
				The <span class="emphasis"><em>stream_def</em></span> is a stream definition which consists of an event type name optionally followed by parenthesis that contains filter expressions. If providing filter expressions, only events matching the provided filter expressions for that event type are considered by context partitions.
			</p><p>
				The next statement creates a context <code class="literal">CategoryByTemp</code> that consider the value of the <code class="literal">temperature</code> property of the <code class="literal">SensorEvent</code> event type to pick context partitions to assign events to:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context CategoryByTemp
  group temp &lt; 65 as cold,
  group temp between 65 and 85 as normal,
  group temp &gt; 85 as large
  from SensorEvent</pre><p>
				The following statement simply counts, for each category, the number of events and outputs the category label and count:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context CategoryByTemp select context.label, count(*) from SensorEvent</pre><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="context_def_category_builtin"/>4.2.4.1.Â Built-In Context Properties</h4></div></div></div><p>
				  The following context properties are available in your EPL statement when it refers to a category segmented context:
				</p><div class="table"><a id="d0e3977"/><p class="title"><b>TableÂ 4.3.Â Category Segmented Context Properties</b></p><div class="table-contents"><table summary="Category Segmented Context Properties" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">name</code></td><td>The string-type context name.</td></tr><tr><td><code class="literal">id</code></td><td>The integer-type internal context partition id that the engine assigns to the context partition.</td></tr><tr><td><code class="literal">label</code></td><td>The category label is the string identifier value after the <code class="literal">as</code> keyword that is specified for each group.</td></tr></tbody></table></div></div><br class="table-break"/><p>
					You may, for example, select the context properties as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context CategoryByTemp
  select context.name, context.id, context.label from SensorEvent</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="context_def_nonoverlapping"/>4.2.5.Â Non-Overlapping Context</h3></div></div></div><p>
				  You may declare a non-overlapping context that exists once or that repeats in a regular fashion as controlled by a start condition and an optional end condition. 
				  The number of context partitions is always either one or zero: Context partitions do not overlap.
			</p><p>
				The syntax for creating a non-overlapping context is as follows: 
			</p><pre class="synopsis">create context <span class="emphasis"><em>context_name</em></span>
  start (@now | <span class="emphasis"><em>start_condition</em></span>) 
  [ end <span class="emphasis"><em>end_condition</em></span> ]</pre><p>
				The <span class="emphasis"><em>context_name</em></span> you assign to the context can be any identifier.
			</p><p>
				Following the context name is the <code class="literal">start</code> keyword, either <code class="literal">@now</code> or a <span class="emphasis"><em>start_condition</em></span>. It follows the optional <code class="literal">end</code> keyword and an <span class="emphasis"><em>end_condition</em></span>.
			</p><p>
			  Both the start condition and the end condition, if specified, can be an event filter, a pattern, a crontab or a time period. 
			  The syntax of start and end conditions is described in <a class="xref" href="#context_def_condition" title="4.2.7.Â Context Conditions">SectionÂ 4.2.7, âContext Conditionsâ</a>.
			</p><p>
			  Once the start condition occurs, the engine no longer observes the start condition and begins observing the end condition, if an end condition was provided.
			  Once the end condition occurs, the engine observes the start condition again.
			  If you specified <code class="literal">@now</code> instead of a start condition, the engine begins observing the end condition instead.
			  If there is no end condition the context partition remains alive and does not end.
			</p><p>
			    If you specified an event filter as the start condition, then the event also counts towards the statement(s) that refer to that context. If you specified a pattern as the start condition, then the events that may constitute the pattern match can also count towards the statement(s) that refer to the context provided that <code class="literal">@inclusive</code> and event tags are both specified (see below).
			</p><p>
			  At the time of context activation when your application creates a statement that utilizes the context, the engine checks whether the start and end condition are crontab expressions. The engine evaluates the start and end crontab expressions and determines whether the current time is a time between start and end. If the current time
			  is between start and end times, the engine allocates the context partition and waits for observing the end time. Otherwise the engine waits to observe the start time and does not allocate a context partition.
			</p><p>
				The built-in context properties that are available are the same as described in <a class="xref" href="#context_def_overlapping_builtin" title="4.2.6.2.Â Built-In Context Properties">SectionÂ 4.2.6.2, âBuilt-In Context Propertiesâ</a>.
			</p><p>
  				The next statement creates a context <code class="literal">NineToFive</code> that declares a daily time period that starts at 9 am and ends at 5 pm: 
  			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context NineToFive start (0, 9, *, *, *) end (0, 17, *, *, *)</pre><p>
  				The following statement outputs speed violations between 9 am and 5 pm, considering a speed of 100 or greater as a violation:
  			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context NineToFive select * from TrafficEvent(speed &gt;= 100)</pre><p>
			  The example that follows demonstrates the use of an event filter as the start condition and a pattern as the end condition.
			</p><p>
  				The next statement creates a context <code class="literal">PowerOutage</code> that starts when the first <code class="literal">PowerOutageEvent</code> event arrives and that ends 5 seconds after a subsequent <code class="literal">PowerOnEvent</code> arrives:
  			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context PowerOutage start PowerOutageEvent end pattern [PowerOnEvent -&gt; timer:interval(5)]</pre><p>
  				The following statement outputs the temperature during a power outage and for 5 seconds after the power comes on:
  			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context PowerOutage select * from TemperatureEvent</pre><p>
			  To output only the last value when a context partition ends (terminates, expires), please read on to the description of output rate limiting.
			</p><p>
  				The next statement creates a context <code class="literal">Every15Minutes</code> that starts immediately and lasts for 15 minutes, repeatedly allocating a new context partition at the end of 15 minute intervals:
  			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context Every15Minutes start @now end after 15 minutes</pre><p>
  				The next example declares an <code class="literal">AlwaysOn</code> context: It starts immediately and does not end unless the application uses the API to terminate the context partition:
  			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context AlwaysOn start @now</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>
				A non-overlapping context with <code class="literal">@now</code> is always-on: A context partition is always allocated at any given point in time. Only if <code class="literal">@now</code> is specified
				will a context partition always exist at any point in time.
				</p></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
					If you specified an event filter or pattern as the end condition for a context partition, and statements that refer to the context specify an event filter or pattern that matches the same conditions,
					use @Priority to instruct the engine whether the context management or the statement evaluation takes priority (see below for configuring prioritized execution).
				</p><p>
					For example, if your context declaration looks like this:
				</p><pre xmlns="" class="">create context MyCtx start MyStartEvent end MyEndEvent</pre><p>
					And a statement managed by the context is this:
				</p><pre class="synopsis">context MyCtx select count(*) as cnt from MyEndEvent output when terminated</pre><p> 
					By using <code class="literal">@Priority(1)</code> for create-context and <code class="literal">@Priority(0)</code> for the counting statement the counting statement does not count the last <code class="literal">MyEndEvent</code>
					since context partition management takes priority.
				</p><p> 
					By using <code class="literal">@Priority(0)</code> for create-context and <code class="literal">@Priority(1)</code> for the counting statement the counting statement will count the last <code class="literal">MyEndEvent</code>
					since the statement evaluation takes priority.
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="context_def_overlapping"/>4.2.6.Â Overlapping Context</h3></div></div></div><p>
				  This context initiates a new context partition when an initiating condition occurs, and terminates one or more context partitions when the terminating condition occurs, 
				  if a terminating condition was specified. Thus multiple overlapping context partitions can be active at any point and context partitions can overlap.
			</p><p>
				The syntax for creating an overlapping context is as follows: 
			</p><pre class="synopsis">create context <span class="emphasis"><em>context_name</em></span>
  initiated [by] [distinct (<span class="emphasis"><em>distinct_value_expr [,...]</em></span>)] [@now and] <span class="emphasis"><em>initiating_condition</em></span>
  [ terminated [by] <span class="emphasis"><em>terminating_condition</em></span> ]</pre><p>
				The <span class="emphasis"><em>context_name</em></span> you assign to the context can be any identifier.
			</p><p>
				Following the context name is the <code class="literal">initiated</code> keyword.
				After the <code class="literal">initiated</code> keyword you can optionally specify the <code class="literal">distinct</code> keyword and, within parenthesis, list one or more distinct value expressions.
				After the <code class="literal">initiated</code> keyword you can also specify <code class="literal">@now and</code> as explained below.
			</p><p>
				After the <code class="literal">initiated</code> keyword you must specify the initiating condition. 
				You may optionally use the <code class="literal">terminated</code> keyword followed by the terminating condition.
				If no terminating condition is specified each context partition remains alive and does not terminate.
			</p><p>
			  Both the initiating condition and the terminating condition, if specified, can be an event filter, a pattern, a crontab or a time period. The syntax of initiating and terminating conditions is described in <a class="xref" href="#context_def_condition" title="4.2.7.Â Context Conditions">SectionÂ 4.2.7, âContext Conditionsâ</a>.
			</p><p>
				If you specified <code class="literal">@now and</code> before the initiating condition then the engine initiates a new context partition immediately. The <code class="literal">@now</code> is only allowed in conjunction with initiation conditions that specify a pattern, crontab or time period and not with event filters.
			</p><p>
			    If you specified an event filter for the initiating condition, then the event that initiates a new context partition also counts towards the statement(s) that refer to that context. If you specified a pattern to initiate a new context partition, then the events that may constitute the pattern match can also count towards the statement(s) that refer to the context provided that <code class="literal">@inclusive</code> and event tags are both specified (see below).
			</p><p>
				The next statement creates a context <code class="literal">CtxTrainEnter</code> that allocates a new context partition when a train enters a station, and that terminates each context partition 5 minutes after the time the context partition was allocated:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context CtxTrainEnter
  initiated by TrainEnterEvent as te
  terminated after 5 minutes</pre><p>
				The context declared above assigns the stream name <code class="literal">te</code>. Thereby the initiating event's properties can be accessed, for example, by specifying <code class="literal">context.te.trainId</code>.
			</p><p>
				The following statement detects when a train enters a station as indicated by a <code class="literal">TrainEnterEvent</code>, but does not leave the station within 5 minutes as would be indicated by a matching <code class="literal">TrainLeaveEvent</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context CtxTrainEnter
select t1 from pattern [
  t1=TrainEnterEvent(trainId = context.te.trainId) -&gt; timer:interval(5 min) and not TrainLeaveEvent(trainId = context.te.trainId)
  ]</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>
					Each event (incoming or inserted-into) applies to each context partition. You must provide filter expressions that indicate how events apply to context partitions.
				</p><p>
					The example above has <code class="literal">trainId = context.te.trainId</code> to say that the train id of events must match the train id of the initiating event of the particular context partition.
				</p></div><p>
			  Since the <code class="literal">TrainEnterEvent</code> that initiates a new context partition also counts towards the statement, the first part of the pattern (the <code class="literal">t1=TrainEnterEvent</code>) is satisfied by that initiating event.
			</p><p>
				The next statement creates a context <code class="literal">CtxEachMinute</code> that allocates a new context partition immediately and every 1 minute, and that terminates each context partition 1 minute after the time the context partition was allocated:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context CtxEachMinute
  initiated @now and pattern [every timer:interval(1 minute)]
  terminated after 1 minutes</pre><p>
				The statement above specifies <code class="literal">@now</code> to instruct the engine to allocate a new context partition immediately as well as when the pattern fires.
				Without the <code class="literal">@now</code> the engine would only allocate a new context partition when the pattern fires after 1 minute and every minute thereafter.
			</p><p>
				The following statement averages the temperature, starting anew every 1 minute and outputs the aggregate value continuously:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context CtxEachMinute select avg(temp) from SensorEvent</pre><p>
			  To output only the last value when a context partition ends (terminates, expires), please read on to the description of output rate limiting.
			</p><p>
				By providing no terminating condition, you can tell the engine to allocate context partitions that never terminate, for example:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context CtxTrainEnter initiated by TrainEnterEvent as te</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
					If you specified an event filter or pattern as the termination condition for a context partition, and statements that refer to the context specify an event filter or pattern that matches the same conditions,
					use @Priority to instruct the engine whether the context management or the statement evaluation takes priority (see below for configuring prioritized execution). See the note above for more information.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="context_def_overlapping_distinct"/>4.2.6.1.Â Distinct Events for the Initiating Condition</h4></div></div></div><p>
					If your initiating condition is a filter context condition, you may specify the <code class="literal">distinct</code> keyword followed by one or more distinct-value expressions.
				</p><p>
					The following sample EPL specifies a context that initiates a context partition for distinct order id values, remembering that order id until the time the context partition terminates:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context OrderContext
  initiated by distinct(orderId) NewOrderEvent as newOrder 
  terminated by CloseOrderEvent(closeOrderId = newOrder.orderId)</pre><p>
					The engine allocates a new context partition only when a context partition does not already exist for a given <code class="literal">orderId</code> value of <code class="literal">NewOrderEvent</code>.					
					When the context partition terminates at the time a <code class="literal">CloseOrderEvent</code> arrives, the engine forgets about the <code class="literal">orderId</code>,
					allowing the next <code class="literal">NewOrderEvent</code> event for the same <code class="literal">orderId</code> to allocate a new context partition.
				</p><p>
					Please note the following limitations:
				</p><div class="itemizedlist"><ul><li>
					  The <code class="literal">distinct</code> keyword requires the initiating condition to be an event stream (and not a crontab or pattern, for example) and a stream name must be 
					  assigned using the <code class="literal">as</code> keyword.
					</li><li>
					  Subqueries, aggregations and the special <code class="literal">prev</code> and <code class="literal">prior</code> functions are not allowed among the distinct-value expressions.
					</li></ul></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="context_def_overlapping_builtin"/>4.2.6.2.Â Built-In Context Properties</h4></div></div></div><p>
				  The following context properties are available in your EPL statement when it refers to a context:
				</p><div class="table"><a id="d0e4356"/><p class="title"><b>TableÂ 4.4.Â Context Properties</b></p><div class="table-contents"><table summary="Context Properties" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">name</code></td><td>The string-type context name.</td></tr><tr><td><code class="literal">startTime</code></td><td>The start time of the context partition.</td></tr><tr><td><code class="literal">endTime</code></td><td>The end time of the context partition. This field is only available in the case that it can be computed from the crontab or time period expression that is provided. Use <code class="literal">current_timestamp</code> instead.
								</td></tr></tbody></table></div></div><br class="table-break"/><p>
					You may, for example, select the context properties as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context NineToFive 
select context.name, context.startTime, context.endTime from TrafficEvent(speed &gt;= 100)</pre><p>
					The following statement looks for the next train leave event for the same train id and selects a few of the context properties: 
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context CtxTrainEnter
select *, context.te.trainId, context.id, context.name
from TrainLeaveEvent(trainId = context.te.trainId)</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="context_def_condition"/>4.2.7.Â Context Conditions</h3></div></div></div><p>
			  Context start/initiating and end/terminating conditions are for use with overlapping and non-overlapping contexts. Any combination of conditions may be specified.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="context_def_condition_filter"/>4.2.7.1.Â Filter Context Condition</h4></div></div></div><p>
					Define the stream that starts/initiates a context partition or that ends/terminates a context partition:
				</p><pre class="synopsis"><span class="emphasis"><em>event_stream_name</em></span> [(<span class="emphasis"><em>filter_criteria</em></span>)] [as <span class="emphasis"><em>stream_name</em></span>]</pre><p>
				  The <span class="emphasis"><em>event_stream_name</em></span> is either the name of an event type or name of an event stream populated by an insert into statement. The <span class="emphasis"><em>filter_criteria</em></span> is optional and consists of a list of expressions filtering the events of the event stream, within
parenthesis after the event stream name.
				</p><p>
				  Two examples are:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// A non-overlapping context that starts when MyStartEvent arrives and ends when MyEndEvent arrives
create context MyContext start MyStartEvent end MyEndEvent</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// An overlapping context where each MyEvent with level greater zero 
// initiates a new context partition that terminates after 10 seconds
create context MyContext initiated MyEvent(level &gt; 0) terminated after 10 seconds</pre><p>
				  You may correlate the start/initiating and end/terminating streams by providing a stream name following the <code class="literal">as</code> keyword, and by referring to that stream name in the filter criteria of the end condition.
				</p><p>
				  Two examples that correlate the start/initiating and end/terminating condition are:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// A non-overlapping context that starts when MyEvent arrives
// and ends when a matching MyEvent arrives (same id)
create context MyContext 
start MyEvent as myevent
end MyEvent(id=myevent.id)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// An overlapping context where each MyInitEvent initiates a new context partition 
// that terminates when a matching MyTermEvent arrives 
create context MyContext 
initiated by MyInitEvent as e1 
terminated by MyTermEvent(id=e1.id, level &lt;&gt; e1.level)</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="context_def_condition_pattern"/>4.2.7.2.Â Pattern Context Condition</h4></div></div></div><p>
					You can define a pattern that starts/initiates a context partition or that ends/terminates a context partition:
				</p><pre class="synopsis">pattern [<span class="emphasis"><em>pattern_expression</em></span>] [@inclusive]</pre><p>
				  The <span class="emphasis"><em>pattern_expression</em></span> is a pattern at <a class="xref" href="#event_patterns" title="ChapterÂ 7.Â EPL Reference: Patterns">ChapterÂ 7, <i>EPL Reference: Patterns</i></a>.
				</p><p>
				  Specify <code class="literal">@inclusive</code> after the pattern to have those same events that constitute the pattern match also count towards any statements that are associated to the context.
				  You must also provide a tag for each event in a pattern that should be included.
				</p><p>
				  Examples are:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// A non-overlapping context that starts when either StartEventOne or StartEventTwo arrive
// and that ends after 5 seconds.
// Here neither StartEventOne or StartEventTwo count towards any statements
// that are referring to the context.
create context MyContext 
  start pattern [StartEventOne or StartEventTwo] 
  end after 5 seconds</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Same as above. 
// Here both StartEventOne or StartEventTwo do count towards any statements
// that are referring to the context.
create context MyContext 
  start pattern [a=StartEventOne or b=StartEventTwo] @inclusive 
  end after 5 seconds</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// An overlapping context where each distinct MyInitEvent initiates a new context 
// and each context partition terminates after 20 seconds
// Use @inclusive to say that the same MyInitEvent that fires the pattern
// also applies to statements that are associated to the context.
create context MyContext
  initiated by pattern [every-distinct(a.id, 20 sec) a=MyInitEvent]@inclusive
  terminated after 20 sec</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// An overlapping context where each pattern match initiates a new context 
// and all context partitions terminate when MyTermEvent arrives.
// The MyInitEvent and MyOtherEvent that trigger the pattern are themselves not included 
// in any statements that are associated to the context.
create context MyContext
  initiated by pattern [every MyInitEvent -&gt; MyOtherEvent where timer:within(5)]
  terminated by MyTermEvent</pre><p>
				  You may correlate the start and end streams by providing tags as part of the pattern, and by referring to the tag name(s) in the filter criteria of the end condition.
				</p><p>
				  An example that correlates the start and end condition is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// A non-overlapping context that starts when either StartEventOne or StartEventTwo arrive
// and that ends when either a matching EndEventOne or EndEventTwo arrive
create context MyContext 
  start pattern [a=StartEventOne or b=StartEventTwo]@inclusive
  end pattern [EndEventOne(id=a.id) or EndEventTwo(id=b.id)]</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="context_def_condition_crontab"/>4.2.7.3.Â Crontab Context Condition</h4></div></div></div><p>
					 Crontab expression are described in <a class="xref" href="#pattern-timer-at" title="7.6.4.Â Crontab (timer:at)">SectionÂ 7.6.4, âCrontab (timer:at)â</a>.
				</p><p>
				  Examples are:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// A non-overlapping context started daily between 9 am to 5 pm
// and not started outside of these hours:
create context NineToFive start (0, 9, *, *, *) end (0, 17, *, *, *)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// An overlapping context where crontab initiates a new context every 1 minute
// and each context partition terminates after 10 seconds:
create context MyContext initiated (*, *, *, *, *) terminated after 10 seconds</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="context_def_condition_after"/>4.2.7.4.Â Time Period Context Condition</h4></div></div></div><p>
					You may specify a time period that the engine observes before the condition fires. Time period expressions are described in <a class="xref" href="#epl-syntax-time-periods" title="5.2.1.Â Specifying Time Periods">SectionÂ 5.2.1, âSpecifying Time Periodsâ</a>.
				</p><p>
					The syntax is: 
				</p><pre class="synopsis">after <span class="emphasis"><em>time_period_expression</em></span></pre><p>
				  Examples are:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// A non-overlapping context started after 10 seconds 
// that ends 1 minute after it starts and that again starts 10 seconds thereafter.
create context NonOverlap10SecFor1Min start after 10 seconds end after 1 minute</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// An overlapping context that starts a new context partition every 5 seconds
// and each context partition lasts 1 minute
create context Overlap5SecFor1Min initiated after 5 seconds terminated after 1 minute</pre></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="context_nesting"/>4.3.Â Context Nesting</h2></div></div></div><p>
		  A nested context is a context that is composed from two or more contexts.
		</p><p>
			The syntax for creating a nested context is as follows: 
		</p><pre class="synopsis">create context <span class="emphasis"><em>context_name</em></span>
  context <span class="emphasis"><em>nested_context_name</em></span> [as] <span class="emphasis"><em>nested_context_definition</em></span> ,
  context <span class="emphasis"><em>nested_context_name</em></span> [as] <span class="emphasis"><em>nested_context_definition</em></span> [, ...]</pre><p>
			The <span class="emphasis"><em>context_name</em></span> you assign to the context can be any identifier.
		</p><p>
			Following the context name is a comma-separated list of nested contexts. For each nested context specify the <code class="literal">context</code> keyword followed a nested context name and the nested context declaration. Any of the context declarations as outlined in <a class="xref" href="#context_decl" title="4.2.Â Context Declaration">SectionÂ 4.2, âContext Declarationâ</a> are allowed for nested contexts.
			The order of nested context declarations matters as outlined below. The nested context names have meaning only in respect to built-in properties and statements may not be assigned to nested context names.
		</p><p>
			The next statement creates a nested context <code class="literal">NineToFiveSegmented</code> that, between 9 am and 5 pm, allocates a new context partition for each customer id:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context NineToFiveSegmented
  context NineToFive start (0, 9, *, *, *) end (0, 17, *, *, *),
  context SegmentedByCustomer partition by custId from BankTxn</pre><p>
			The following statement refers to the nested context to compute a total withdrawal amount per account for each customer but only between 9 am and 5 pm:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context NineToFiveSegmented
select custId, account, sum(amount) from BankTxn group by account</pre><p>
		    Esper implements nested contexts as a context tree: The context declared first controls the lifecycle of the context(s) declared thereafter. Thereby, in the above example, outside of the 9am-to-5pm time the engine has no memory and consumes no resources in relationship to bank transactions or customer ids.
		</p><p>
		    When combining segmented contexts, the set of context partitions for the nested context effectively is the Cartesian product of the partition sets of the nested segmented contexts (sample: <code class="literal">create context MyCartSegmented context SegmentedByAccount partition by acctId from BankTxn context SegmentedByCustomer partition by custId from BankTxn</code>).
		</p><p>
		    When combining temporal contexts with other contexts, since temporal contexts may overlap and may terminate, it is important to understand that temporal contexts control the lifecycle of sub-contexts (contexts declared thereafter). The order of declaration of contexts in a nested context 
		    can thereby change resource usage and output result.
		</p><p>
			The next statement creates a context that allocates context partition only when a train enters a station and then for each hash of the tag id of a passenger as indicated by PassengerScanEvent events, and terminates all context partitions after 5 minutes:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context CtxNestedTrainEnter
  context InitCtx initiated by TrainEnterEvent as te terminated after 5 minutes,
  context HashCtx coalesce by consistent_hash_crc32(tagId) from PassengerScanEvent
    granularity 16 preallocate</pre><p>
		   In the example above the engine does not start tracking PassengerScanEvent events or hash codes or allocate context partitions until a TrainEnterEvent arrives.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="context_nesting_walkthru"/>4.3.1.Â Nested Context Sample Walk-Through</h3></div></div></div><p>
				This section declares a nested context with nested non-overlapping contexts and walks through a specific scenario to help you better understand nested context lifecycles.
			</p><p>
				Assume event types <code class="literal">AStart</code>, <code class="literal">AEnd</code>, <code class="literal">BStart</code>, <code class="literal">BEnd</code> and <code class="literal">C</code>.
				The following EPL counts <code class="literal">C</code>-events that occur within the span of  <code class="literal">AStart</code> and <code class="literal">AEnd</code> and 
				a span of <code class="literal">BStart</code> and <code class="literal">BEnd</code>, wherein the span of <code class="literal">AStart</code>-to-<code class="literal">AEnd</code> must contain the span of <code class="literal">BStart</code>-to-<code class="literal">BEnd</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context CtxSampleNestedContext
  context SpanA start AStart end AEnd,
  context SpanB start BStart end BEnd</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context CtxSampleNestedContext select count(*) from C</pre><p>
				Upon creating the EPL statements above, the engine starts looking for an <code class="literal">AStart</code> event only and does not yet look for <code class="literal">AEnd</code>, <code class="literal">BStart</code>, <code class="literal">BEnd</code> or <code class="literal">C</code> events.
			</p><p>
				In the scenario, assume that an <code class="literal">AStart</code> event arrives next. This is, logically,  the beginning of the <code class="literal">SpanA</code> lifecycle (aka. session, interval):
			</p><div class="itemizedlist"><ul><li><p>The engine stops looking for an <code class="literal">AStart</code> event.</p></li><li><p>The engine starts looking for an <code class="literal">AEnd</code> event, since that would mean the end of the current <code class="literal">SpanA</code> lifecycle.</p></li><li><p>The engine starts looking for a <code class="literal">BStart</code> event, in order to detect the beginning of a <code class="literal">SpanB</code> lifecycle.</p></li></ul></div><p>
				In the scenario, assume that a <code class="literal">BStart</code> event arrives. This is, logically, the beginning of the <code class="literal">SpanB</code> lifecycle:
			</p><div class="itemizedlist"><ul><li><p>The engine stops looking for further <code class="literal">BStart</code> events.</p></li><li><p>The engine starts looking for a <code class="literal">BEnd</code> event, since that would mean the end of the current <code class="literal">SpanB</code> lifecycle.</p></li><li><p>The engine keeps looking for an <code class="literal">AEnd</code> event, since that would mean the end of the current <code class="literal">SpanA</code> lifecycle.</p></li><li><p>The engine starts looking for <code class="literal">C</code> events and now starts counting each <code class="literal">C</code> that arrives.</p></li></ul></div><p>
				In the scenario, assume that a <code class="literal">BEnd</code> event arrives. This is, logically, the end of the <code class="literal">SpanB</code> lifecycle:
			</p><div class="itemizedlist"><ul><li><p>The engine stops looking for a <code class="literal">BEnd</code> event.</p></li><li><p>The engine stops looking for <code class="literal">C</code> events and stops counting each.</p></li><li><p>The engine starts looking for a <code class="literal">BStart</code> event, since that would mean the beginning of another <code class="literal">SpanB</code> lifecycle.</p></li></ul></div><p>
				In the scenario, assume that an <code class="literal">AEnd</code> event arrives. This is, logically, the end of the <code class="literal">SpanA</code> lifecycle:
			</p><div class="itemizedlist"><ul><li><p>The engine stops looking for an <code class="literal">AEnd</code> event.</p></li><li><p>The engine stops looking for a <code class="literal">BStart</code> event.</p></li><li><p>The engine starts looking for an <code class="literal">AStart</code> event, since that would mean the beginning of another <code class="literal">SpanA</code> lifecycle.</p></li></ul></div><p>
				In the scenario describe above, after the <code class="literal">AEnd</code> arrives, the engine is back to the same state as the engine had after the statements were created originally.
			</p><p>
				If your use case calls for a logical OR relationships, please consider a pattern for the start condition, like for example so (not equivalent to above):
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context CtxSampleNestedContext 
  start pattern[every a=AStart or every a=BStart] as mypattern 
  end pattern[every AEnd or every BEnd]</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="context_nesting_builtin"/>4.3.2.Â Built-In Nested Context Properties</h3></div></div></div><p>
			  Context properties of all nested contexts are available for use. Specify <code class="literal">context.</code><span class="emphasis"><em>nested_context_name</em></span><code class="literal">.</code><span class="emphasis"><em>property_name</em></span> or if nested context declaration provided stream names or tags for patterns then <code class="literal">context.</code><span class="emphasis"><em>nested_context_name</em></span><code class="literal">.</code><span class="emphasis"><em>stream_name</em></span><code class="literal">.</code><span class="emphasis"><em>property_name</em></span>.
			</p><p>
			  For example, consider the <code class="literal">CtxNestedTrainEnter</code> context declared earlier. The following statement selects a few of the context properties:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context CtxNestedTrainEnter
select context.InitCtx.te.trainId, context.HashCtx.id,
  tagId, count(*) from PassengerScanEvent group by tagId</pre><p>
			  In a second example, consider the <code class="literal">NineToFiveSegmented</code> context declared earlier. The following statement selects a few of the context properties:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context NineToFiveSegmented
select context.NineToFive.startTime, context.SegmentedByCustomer.key1 from BankTxn</pre><p>
			  The following context properties are available in your EPL statement when it refers to a nested context:
			</p><div class="table"><a id="d0e4832"/><p class="title"><b>TableÂ 4.5.Â Nested Context Properties</b></p><div class="table-contents"><table summary="Nested Context Properties" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">name</code></td><td>The string-type context name.</td></tr><tr><td><code class="literal">id</code></td><td>The integer-type internal context partition id that the engine assigns to the context partition.</td></tr></tbody></table></div></div><br class="table-break"/><p>
			  This example selects the nested context name and context partition id:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context NineToFiveSegmented select context.name, context.id from BankTxn</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="context_other"/>4.4.Â Partitioning Without Context Declaration</h2></div></div></div><p>
		  You do not need to declare a context to partition data windows, aggregation values or patterns themselves individually. You may mix-and-match partitioning as needed.
		</p><p>
		  The table below outlines other partitioning syntax supported by EPL:
		</p><div class="table"><a id="d0e4868"/><p class="title"><b>TableÂ 4.6.Â Partition in EPL Without the Use of Context Declarations</b></p><div class="table-contents"><table summary="Partition in EPL Without the Use of Context Declarations" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Partition Type</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td>Grouped Data Window</td><td><p>Partitions at the level of data window, only applies to appended data window(s).</p><p>Syntax: <code class="literal">#groupwin(...)</code></p></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Length window of 2 events per customer
select * from
  BankTxn#groupwin(custId)#length(2)</pre></td></tr><tr><td>Grouped Aggregation</td><td><p>Partitions at the level of aggregation, only applies to any aggregations.</p><p>Syntax: <code class="literal">group by ....</code></p></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select avg(price), window(*)
  from BankTxn group by custId</pre></td></tr><tr><td>Pattern</td><td><p>Partitions pattern subexpressions.</p><p>Syntax: <code class="literal">every</code> or <code class="literal">every-distinct</code></p></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern [
  every a=BankTxn -&gt; BankTxn(custId = a.custId)...]</pre></td></tr><tr><td>Match-Recognize</td><td><p>Partitions match-recognize patterns.</p><p>Syntax: <code class="literal">partition by</code></p></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from match_recognize 
  ... partition by custId</pre></td></tr><tr><td>Join and Subquery</td><td><p>Partitions join and subqueries.</p><p>Syntax: <code class="literal">where ...</code></p></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from ... where a.custId = b.custId</pre></td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="context_outputterminated"/>4.5.Â Output When a Context Partition Ends or Terminates</h2></div></div></div><p>
          You may use output rate limiting to trigger output when a context partition ends or terminates using <code class="literal">output when terminated</code>.
          This concept was introduced to you in <a class="xref" href="#processingmodel_basicpartitionedandoutputlimited" title="2.13.Â Basic Partitioned and Output-Rate-Limited Query">SectionÂ 2.13, âBasic Partitioned and Output-Rate-Limited Queryâ</a>.
          For more information on output rate limiting please see <a class="xref" href="#epl-output-rate" title="5.7.Â Stabilizing and Controlling Output: The Output Clause">SectionÂ 5.7, âStabilizing and Controlling Output: The Output Clauseâ</a>.
        </p><p>
			The context <code class="literal">CtxEachMinute</code> initiates a new context partition every 1 minute, and each context partition expires after 5 minutes:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context CtxEachMinute
initiated by pattern [every timer:interval(1 min)]
terminated after 5 minutes</pre><p>
			The following statement computes an ongoing average temperature however only outputs the last value of the average temperature, together with the context partition id and the current engine time, after 5 minutes when a context partition ends:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context CtxEachMinute
select current_timestamp as endtime, context.id, avg(temp) from SensorEvent output last when terminated</pre><p>
			The <code class="literal">when terminated</code> syntax can be combined with other output rates.
		</p><p>
			The next example outputs every 1 minute and also when the context partition ends:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context CtxEachMinute
select context.id, avg(temp) from SensorEvent output last every 1 minute and when terminated</pre><p>
			In the case that the end/terminating condition of the context partition is an event or pattern, the context properties contain the information of the tagged events in the pattern or the single event that ended/terminated the context partition. 
		</p><p>
			For example, consider the following context wherein the engine initializes a new context partition for each arriving <code class="literal">MyStartEvent</code> event and that terminates a context partition when a matching <code class="literal">MyEndEvent</code> arrives:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context CtxSample
initiated by MyStartEvent as startevent
terminated by MyEndEvent(id = startevent.id) as endevent</pre><p>
			The following statement outputs the id property of the initiating and terminating event and only outputs when a context partition ends:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context CtxSample 
select context.startevent.id, context.endevent.id, count(*) from MyEvent
output last when terminated</pre><p>
			You may in addition specify a termination expression that the engine evaluates when a context partition terminates. Only when the termination expression evaluates to true does output occur. The expression may refer to built-in properties as described in <a class="xref" href="#epl-output-expression" title="5.7.1.1.Â Controlling Output Using an Expression">SectionÂ 5.7.1.1, âControlling Output Using an Expressionâ</a>. The syntax is as follows:
		</p><pre class="synopsis">...output when terminated and <span class="emphasis"><em>termination_expression</em></span></pre><p>
			The next example statement outputs when a context partition ends but only if at least two events are available for output:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context CtxEachMinute
select * from SensorEvent output when terminated and count_insert &gt;= 2</pre><p>
			The final example EPL outputs when a context partition ends and sets the variable <code class="literal">myvar</code> to a new value:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context CtxEachMinute
select * from SensorEvent output when terminated then set myvar=3</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="context_named_windows"/>4.6.Â Context and Named Window</h2></div></div></div><p>
			Named windows are globally-visible data windows that may be referred to by multiple statements. You may refer to named windows in statements that declare a context without any special considerations,
			with the exception of on-action statements (latter must refer to the same context associated with the named window).
		</p><p>
			You may also create a named window and declare a context for the named window. In this case the engine in effect manages separate named windows, one for each context partition.
		</p><p>
		  For example, consider the 9 am to 5 pm non-overlapping context as shown earlier:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context NineToFive start (0, 9, *, *, *) end (0, 17, *, *, *)</pre><p>
		  You may create a named window that only exists between 9 am and 5 pm:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context NineToFive create window SpeedingEvents1Hour#time(30 min) as TrafficEvent</pre><p>
		  You can insert into the named window:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context NineToFive on TrafficEvent(speed &gt; 100) merge SpeedingEvents1Hour insert select *</pre><p>
		  Any on-merge, on-select, on-update and on-delete statements must declare the same context, in order to operate on partitioned named windows or tables for the same partition.
		</p><p>
		  The following is not a valid statement as it does not declare the same context that was used to declare the named window:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// You must declare the same context for on-trigger statements
on TruncateEvent delete from SpeedingEvents1Hour</pre><p>
		  The following is valid:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context NineToFive on TruncateEvent delete from SpeedingEvents1Hour</pre><p>
		  For context declarations that require specifying event types, such as the hash segmented context and keyed segmented context, please provide the named window underlying event type.
		</p><p>
		  The following sample EPL statements define a type for the named window, declare a context and associate the named window to the context:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema ScoreCycle (userId string, keyword string, productId string, score long)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context HashByUserCtx as 
  coalesce by consistent_hash_crc32(userId) from ScoreCycle granularity 64</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context HashByUserCtx create window ScoreCycleWindow#unique(productId, keyword) as ScoreCycle</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
				Use on-merge to insert events into a specific partition.
			</p><p>
				<code class="literal">Insert Into</code> produces an event that is visible to all partitions.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="context_tables"/>4.7.Â Context and Tables</h2></div></div></div><p>
			Tables are globally-visible data structures that hold rows organized by primary key(s) and that may be referred to by multiple statements. You may refer to tables in statements that declare a context 
			without any special considerations, with the exception of on-action statements (latter must refer to the same context associated with the table).
		</p><p>
			You may also create a table and declare a context for the table. In this case the engine in effect manages separate tables, one for each context partition.
		</p><p>
		  For example, consider the 9 am to 5 pm non-overlapping context as shown earlier:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context NineToFive start (0, 9, *, *, *) end (0, 17, *, *, *)</pre><p>
		  You may create a table that only exists between 9 am and 5 pm:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context NineToFive create table AverageSpeedTable (
  carId string primary key, 
  avgSpeed avg(double))</pre><p>
		  You can aggregate-into the table only if the aggregating statement declares the same context:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// declare the same context as for the table
context NineToFive into table AverageSpeedTable
select avg(speed) as avgSpeed
from TrafficEvent
group by carId</pre><p>
		  When you declare a context for a table, any select, on-merge, on-select, on-update and on-delete statements as well as statements that subquery the table must declare the same context.
		</p><p>
		  For example, this EPL truncates the AverageSpeedTable:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context NineToFive on TruncateEvent delete from AverageSpeedTable</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
				Use on-merge or into-table to insert events into a specific partition.
			</p><p>
				<code class="literal">Insert Into</code> produces an event that is visible to all partitions.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="context_variables"/>4.8.Â Context and Variables</h2></div></div></div><p>
			A variable is a scalar, object or event value that is available for use in all statements. Variables can be either global variables or context variables.
		</p><p>
		  The value of a global variable is the same for all context partitions. The next example declares a global threshold variable:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create variable integer var_global_threshold = 100</pre><p>
		  For context variables, there is a variable value per context partition. The next example declares a context and a context variable:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context ParkingLotContext initiated by CarArrivalEvent as cae terminated by CarDepartureEvent(lot = cae.lot)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context ParkingLotContext create variable integer var_parkinglot_threshold = 100</pre><p>
			The variable <code class="literal">var_parkinglot_threshold</code> is a context variable. Each context partition can have its own value for the variable. 
		</p><p>
			For more information on variables, please refer to <a class="xref" href="#variables_overview" title="5.17.Â Variables and Constants">SectionÂ 5.17, âVariables and Constantsâ</a>.
		</p><p>
			Context variables can only be used in statements that associated to the same context.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="context_selection"/>4.9.Â Operations on Specific Context Partitions</h2></div></div></div><p>
			   The API to read and manage content partitions themselves is <a class="xref" href="#api-contextpartitionadmin" title="14.19.Â Context Partition Administration">SectionÂ 14.19, âContext Partition Administrationâ</a>.
		</p><p>
			  Selecting specific context partitions and interrogating context partition state is useful for:
        </p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
				  Iterating a specific context partition or a specific set of context partitions. Iterating a statement is described in <a class="xref" href="#api-admin-iterators" title="14.3.5.Â Using Iterators">SectionÂ 14.3.5, âUsing Iteratorsâ</a>.
				</p></li><li><p>
				 Executing an on-demand (fire-and-forget) query against specific context partition(s). On-demand queries are described in <a class="xref" href="#api-ondemand" title="14.5.Â On-Demand Fire-and-Forget Query Execution">SectionÂ 14.5, âOn-Demand Fire-and-Forget Query Executionâ</a>.
				</p></li></ol></div><p>
			  Esper provides APIs to identify, filter and select context partitions for statement iteration and on-demand queries. The APIs are described in detail at <a class="xref" href="#api-contextpartitionselection" title="14.18.Â Context Partition Selection">SectionÂ 14.18, âContext Partition Selectionâ</a>.
        </p><p>
             For statement iteration, your application can provide context selector objects to the <code class="literal">iterate</code> and <code class="literal">safeIterate</code> methods on <code class="literal">EPStatement</code>. If your code does not provide context selectors
             the iteration considers all context partitions. At the time of iteration, the engine obtains the current set of context partitions and iterates each independently. If your statement has an order-by clause, the order-by clause orders within the context partition and does not order across context partitions.
        </p><p>
             For on-demand queries, your application can provide context selector objects to the <code class="literal">executeQuery</code> method on <code class="literal">EPRuntime</code> and to the <code class="literal">execute</code> method on <code class="literal">EPOnDemandPreparedQuery</code>. If your code does not provide context selectors the on-demand query considers all context partitions. At the time of on-demand query execution, the engine obtains the current set of context partitions and queries each independently. If the on-demand query has an order-by clause, the order-by clause orders within the context partition and does not order across context partitions.
        </p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl_clauses"/>ChapterÂ 5.Â EPL Reference: Clauses</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#epl-intro">5.1. EPL Introduction</a></span></dt><dt><span class="sect1"><a href="#epl-select-syntax">5.2. EPL Syntax</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-syntax-time-periods">5.2.1. Specifying Time Periods</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-comments">5.2.2. Using Comments</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-keywords">5.2.3. Reserved Keywords</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-escapestring">5.2.4. Escaping Strings</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-datatype">5.2.5. Data Types</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-javaconst">5.2.6. Using Constants and Enum Types</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-annotation">5.2.7. Annotation</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-expression-alias">5.2.8. Expression Alias</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-expression-decl">5.2.9. Expression Declaration</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-script-decl">5.2.10. Script Declaration</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-context-decl">5.2.11. Referring to a Context</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-select-list">5.3. Choosing Event Properties and Events: The Select Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-select-all-props">5.3.1. Choosing the Event Itself: Select *</a></span></dt><dt><span class="sect2"><a href="#epl-select-event-props">5.3.2. Choosing Specific Event Properties</a></span></dt><dt><span class="sect2"><a href="#epl-select-expressions">5.3.3. Expressions</a></span></dt><dt><span class="sect2"><a href="#epl-select-renaming">5.3.4. Renaming Event Properties</a></span></dt><dt><span class="sect2"><a href="#epl-select-all-join">5.3.5. Choosing Event Properties and Events in a Join</a></span></dt><dt><span class="sect2"><a href="#epl-select-pattern">5.3.6. Choosing Event Properties and Events From a Pattern</a></span></dt><dt><span class="sect2"><a href="#epl-select-using-istream-rstream">5.3.7. Selecting Insert and Remove Stream Events</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-prefix-propsandstream">5.3.8. Qualifying Property Names and Stream Names</a></span></dt><dt><span class="sect2"><a href="#epl-syntax-distinct">5.3.9. Select Distinct</a></span></dt><dt><span class="sect2"><a href="#epl-transposefunc">5.3.10. Transposing an Expression Result to a Stream</a></span></dt><dt><span class="sect2"><a href="#epl-selecteventbean">5.3.11. Selecting EventBean Instead of Underlying Event</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-from-clause">5.4. Specifying Event Streams: The From Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-from-clause-filter">5.4.1. Filter-Based Event Streams</a></span></dt><dt><span class="sect2"><a href="#epl-from-clause-patterns">5.4.2. Pattern-Based Event Streams</a></span></dt><dt><span class="sect2"><a href="#epl-from-clause-window-spec">5.4.3. Specifying Data Windows</a></span></dt><dt><span class="sect2"><a href="#epl-from-clause-view-multidatawindow">5.4.4. Multiple Data Windows</a></span></dt><dt><span class="sect2"><a href="#epl-from-clause-stream-name">5.4.5. Using the Stream Name</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-where-clause">5.5. Specifying Search Conditions: The Where Clause</a></span></dt><dt><span class="sect1"><a href="#epl-grouping-aggregating">5.6. Aggregates and Grouping: The Group-By Clause and the Having Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-grouping-aggregate-functions">5.6.1. Using Aggregate Functions</a></span></dt><dt><span class="sect2"><a href="#epl-grouping-group-by">5.6.2. Organizing Statement Results into Groups: The Group-by Clause</a></span></dt><dt><span class="sect2"><a href="#epl-grouping-rollup">5.6.3. Using Group-By with Rollup, Cube and Grouping Sets</a></span></dt><dt><span class="sect2"><a href="#epl-grouping-agglocal">5.6.4. Specifying Grouping for Each Aggregation Function</a></span></dt><dt><span class="sect2"><a href="#epl-grouping-aggfilter">5.6.5. Specifying a Filter Expression for Each Aggregation Function</a></span></dt><dt><span class="sect2"><a href="#epl-grouping-having">5.6.6. Selecting Groups of Events: The Having Clause</a></span></dt><dt><span class="sect2"><a href="#epl-filter-where-grouping-having-interactions">5.6.7. How the Stream Filter, Where, Group By and Having-Clauses Interact</a></span></dt><dt><span class="sect2"><a href="#epl-group-by-versus-view">5.6.8. Comparing Keyed Segmented Context, the Group By Clause and #groupwin for Data Windows</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-output-rate">5.7. Stabilizing and Controlling Output: The Output Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-output-options">5.7.1. Output Clause Options</a></span></dt><dt><span class="sect2"><a href="#epl-output-groupby">5.7.2. Aggregation, Group By, Having and Output Clause Interaction</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-order-by">5.8. Sorting Output: the Order By Clause</a></span></dt><dt><span class="sect1"><a href="#epl-limit">5.9. Limiting Row Count: the Limit Clause</a></span></dt><dt><span class="sect1"><a href="#epl-insert-into">5.10. Merging Streams and Continuous Insertion: The Insert Into Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#insert-into-property-transpose">5.10.1. Transposing a Property to a Stream</a></span></dt><dt><span class="sect2"><a href="#insert-into-merging-columns">5.10.2. Merging Streams by Event Type</a></span></dt><dt><span class="sect2"><a href="#insert-into-merging-types">5.10.3. Merging Disparate Types of Events: Variant Streams</a></span></dt><dt><span class="sect2"><a href="#insert-into-decorated">5.10.4. Decorated Events</a></span></dt><dt><span class="sect2"><a href="#insert-into-eventasproperty">5.10.5. Event as a Property</a></span></dt><dt><span class="sect2"><a href="#insert-into-populate">5.10.6. Instantiating and Populating an Underlying Event Object</a></span></dt><dt><span class="sect2"><a href="#insert-into-expression">5.10.7. Transposing an Expression Result</a></span></dt><dt><span class="sect2"><a href="#insert-into-reconcile">5.10.8. Select-Clause Expression and Inserted-Into Column Event Type</a></span></dt><dt><span class="sect2"><a href="#insert-into-typewithoutprops">5.10.9. Insert Into for Event Types Without Properties</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-subqueries">5.11. Subqueries</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-subqueries-exists">5.11.1. The 'Exists' Keyword</a></span></dt><dt><span class="sect2"><a href="#epl-subqueries-in">5.11.2. The 'In' and 'Not In' Keywords</a></span></dt><dt><span class="sect2"><a href="#epl-subqueries-anysome">5.11.3. The 'Any' and 'Some' Keywords</a></span></dt><dt><span class="sect2"><a href="#epl-subqueries-all">5.11.4. The 'All' Keyword</a></span></dt><dt><span class="sect2"><a href="#epl-subqueries-groupby">5.11.5. Subquery With Group By Clause</a></span></dt><dt><span class="sect2"><a href="#epl-subqueries-multicolumn">5.11.6. Multi-Column Selection</a></span></dt><dt><span class="sect2"><a href="#epl-subqueries-multirow">5.11.7. Multi-Row Selection</a></span></dt><dt><span class="sect2"><a href="#epl-subqueries-hints">5.11.8. Hints Related to Subqueries</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-join">5.12. Joining Event Streams</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-join-introducing">5.12.1. Introducing Joins</a></span></dt><dt><span class="sect2"><a href="#epl-join-inner">5.12.2. Inner (Default) Joins</a></span></dt><dt><span class="sect2"><a href="#epl-outerjoin">5.12.3. Outer, Left and Right Joins</a></span></dt><dt><span class="sect2"><a href="#epl-unidirectional">5.12.4. Unidirectional Joins</a></span></dt><dt><span class="sect2"><a href="#epl-unidirectional-fullouterjoin">5.12.5. Unidirectional Full Outer Joins</a></span></dt><dt><span class="sect2"><a href="#epl-join-hints">5.12.6. Hints Related to Joins</a></span></dt></dl></dd><dt><span class="sect1"><a href="#histdata_overview">5.13. Accessing Relational Data via SQL</a></span></dt><dd><dl><dt><span class="sect2"><a href="#histdata_join">5.13.1. Joining SQL Query Results</a></span></dt><dt><span class="sect2"><a href="#histdata_join_where">5.13.2. SQL Query and the EPL Where Clause</a></span></dt><dt><span class="sect2"><a href="#histdata_outerjoin">5.13.3. Outer Joins With SQL Queries</a></span></dt><dt><span class="sect2"><a href="#histdata_polling_pattern">5.13.4. Using Patterns to Request (Poll) Data</a></span></dt><dt><span class="sect2"><a href="#histdata_polling">5.13.5. Polling SQL Queries via Iterator</a></span></dt><dt><span class="sect2"><a href="#histdata_implementation">5.13.6. JDBC Implementation Overview</a></span></dt><dt><span class="sect2"><a href="#histdata_nometadata">5.13.7. Oracle Drivers and No-Metadata Workaround</a></span></dt><dt><span class="sect2"><a href="#histdata_convert_cols">5.13.8. SQL Input Parameter and Column Output Conversion</a></span></dt><dt><span class="sect2"><a href="#histdata_convert_row">5.13.9. SQL Row POJO Conversion</a></span></dt></dl></dd><dt><span class="sect1"><a href="#joining_method">5.14. Accessing Non-Relational Data via Method, Script or UDF Invocation</a></span></dt><dd><dl><dt><span class="sect2"><a href="#joining_method_syntax">5.14.1. Joining Method, Script or UDF Invocation Results</a></span></dt><dt><span class="sect2"><a href="#joining_method_polling">5.14.2. Polling Invocation Results via Iterator</a></span></dt><dt><span class="sect2"><a href="#joining_method_exposing">5.14.3. Providing the Method</a></span></dt><dt><span class="sect2"><a href="#joining_method_map">5.14.4. Using a Map Return Type</a></span></dt><dt><span class="sect2"><a href="#joining_method_oa">5.14.5. Using a Object Array Return Type</a></span></dt><dt><span class="sect2"><a href="#joining_method_eventbeanarray">5.14.6. Using an EventBean Return Type</a></span></dt><dt><span class="sect2"><a href="#joining_method_script">5.14.7. Providing the Script</a></span></dt><dt><span class="sect2"><a href="#joining_method_udf">5.14.8. Providing the UDF</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl_createschema">5.15. Declaring an Event Type: Create Schema</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl_createschema_properties">5.15.1. Declare an Event Type by Providing Names and Types</a></span></dt><dt><span class="sect2"><a href="#epl_createschema_class">5.15.2. Declare an Event Type by Providing a Class Name</a></span></dt><dt><span class="sect2"><a href="#epl_createschema_variant">5.15.3. Declare a Variant Stream</a></span></dt></dl></dd><dt><span class="sect1"><a href="#split_overview">5.16. Splitting and Duplicating Streams</a></span></dt><dd><dl><dt><span class="sect2"><a href="#split_containedeventselect">5.16.1. Generating Marker Events for Contained Events</a></span></dt></dl></dd><dt><span class="sect1"><a href="#variables_overview">5.17. Variables and Constants</a></span></dt><dd><dl><dt><span class="sect2"><a href="#variable_create">5.17.1. Creating Variables: The Create Variable Clause</a></span></dt><dt><span class="sect2"><a href="#variable_set">5.17.2. Setting Variable Values: The On Set Clause</a></span></dt><dt><span class="sect2"><a href="#variable_using">5.17.3. Using Variables</a></span></dt><dt><span class="sect2"><a href="#variable_object">5.17.4. Object-Type Variables</a></span></dt><dt><span class="sect2"><a href="#variable_eventtype">5.17.5. Class and Event-Type Variables</a></span></dt></dl></dd><dt><span class="sect1"><a href="#create-exprglobal">5.18. Declaring Global Expressions, Aliases and Scripts: Create Expression</a></span></dt><dd><dl><dt><span class="sect2"><a href="#create-exprglobal-alias">5.18.1. Global Expression Aliases</a></span></dt><dt><span class="sect2"><a href="#create-exprglobal-expr">5.18.2. Global Expression Declarations</a></span></dt><dt><span class="sect2"><a href="#create-exprglobal-script">5.18.3. Global Scripts</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-containedeventselect">5.19. Contained-Event Selection</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-containedeventselect-select">5.19.1. Select-Clause in a Contained-Event Selection</a></span></dt><dt><span class="sect2"><a href="#epl-containedeventselect-where">5.19.2. Where Clause in a Contained-Event Selection</a></span></dt><dt><span class="sect2"><a href="#epl-containedeventselect-join">5.19.3. Contained-Event Selection and Joins</a></span></dt><dt><span class="sect2"><a href="#epl-containedeventselect-pojoexample">5.19.4. Sentence and Word Example</a></span></dt><dt><span class="sect2"><a href="#epl-containedeventselect-examples">5.19.5. More Examples</a></span></dt><dt><span class="sect2"><a href="#epl-containedeventselect-arrayofprimitive">5.19.6. Contained Expression Returning an Array of Property Values</a></span></dt><dt><span class="sect2"><a href="#epl-containedeventselect-arrayofevent">5.19.7. Contained Expression Returning an Array of EventBean</a></span></dt><dt><span class="sect2"><a href="#epl-containedeventselect-beginend">5.19.8. Generating Marker Events Such as a Begin and End Event</a></span></dt><dt><span class="sect2"><a href="#epl-containedeventselect-restrictions">5.19.9. Contained-Event Limitations</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-update">5.20. Updating an Insert Stream: The Update IStream Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-update-object">5.20.1. Immutability and Updates</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-grouped-delivery">5.21. Controlling Event Delivery : The For Clause</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-intro"/>5.1.Â EPL Introduction</h2></div></div></div><p>
			The Event Processing Language (EPL) is a SQL-standard language with extensions, offering <code class="literal">SELECT</code>, <code class="literal">FROM</code>, <code class="literal">WHERE</code>, <code class="literal">GROUP BY</code>, <code class="literal">HAVING</code> and <code class="literal">ORDER BY</code> clauses. Streams replace tables as the source of data with events replacing rows as the basic unit of data. Since events are composed of data, the SQL concepts of correlation through joins, subqueries and aggregation through grouping can be effectively leveraged.
        </p><p>
			The <code class="literal">INSERT INTO</code> clause is recast as a means of forwarding events to other streams for further processing. External data may be queried and joined with the stream data. Additional clauses such as the <code class="literal">PATTERN</code> and <code class="literal">OUTPUT</code> clauses are available to provide the missing SQL language constructs specific to event processing.
        </p><p>
			EPL statements can specify data windows. Similar to tables in a SQL statement, data windows define the subset of events to be analyzed. 
            Data windows can be combined to an intersection or union of sets of events.
            Some of the often-used data windows are <code class="literal">#length</code>, <code class="literal">#time</code>, <code class="literal">#unique</code>, <code class="literal">#lastevent</code>, <code class="literal">#firstevent</code> and <code class="literal">#keepall</code>.
        </p><p>
			EPL provides the concept of <span class="emphasis"><em>named window</em></span>. Named windows are data windows that can be used by multiple statements. 
			The name of a named window can occur in a statement's <code class="literal">FROM</code> clause to query the named window or to include the named window in a join or subquery. 
        </p><p>
			EPL provides the concept of <span class="emphasis"><em>table</em></span>. Tables are globally-visible data structures that typically have primary key columns and that can hold aggregation state. 
			An overview of named windows and tables, and a comparison between them, can be found at <a class="xref" href="#nwtable-overview" title="6.1.Â Overview">SectionÂ 6.1, âOverviewâ</a>.
        </p><p>
			EPL allows execution of on-demand (fire-and-forget, non-continuous, triggered by API) queries against named windows and tables through the runtime API. The query engine automatically indexes named window data for fast access by <code class="literal">ON SELECT/MERGE/UPDATE/INSERT/DELETE</code> without the need to create an index explicitly, or can access explicit (secondary) table indexes for operations on tables. For fast on-demand query execution via runtime API use the <code class="literal">CREATE INDEX</code> syntax to create an explicit index for the named window or table in question.
        </p><p>
			Use <code class="literal">CREATE SCHEMA</code> to declare an event type.
        </p><p>
			<span class="emphasis"><em>Variables</em></span> can come in handy to parameterize statements and change parameters on-the-fly and in response to events. Variables can be used in an expression anywhere in a statement as well as in the output clause for dynamic control of output rates.
        </p><p>
			Esper can be extended by plugging-in custom developed data windows, aggregation functions, and more.
        </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-select-syntax"/>5.2.Â EPL Syntax</h2></div></div></div><p>
			EPL queries are created and stored in the engine, and publish results to listeners as events are received by the engine or timer events occur that match the criteria specified in the query. Events can also be obtained from running EPL queries via the <code class="literal">safeIterator</code> and <code class="literal">iterator</code> methods that provide a pull-data API.
		</p><p>
			The <code class="literal">select</code> clause in an EPL query specifies the event properties or events to retrieve. The <code class="literal">from</code> clause in an EPL query specifies the event stream definitions and stream names to use. The <code class="literal">where</code> clause in an EPL query specifies search conditions that specify which event or event combination to search for. For example, the following statement returns the average price for IBM stock ticks in the last 30 seconds.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select avg(price) from StockTick#time(30 sec) where symbol='IBM'</pre><p>
			EPL queries follow the below syntax. EPL queries can be simple queries or more complex queries. A simple select contains only a <code class="literal">select</code> clause and a single stream definition. Complex EPL queries can be build that feature a more elaborate select list utilizing expressions, may join multiple streams, may contain a <code class="literal">where</code> clause with search conditions and so on.
		</p><pre class="synopsis">[<span class="emphasis"><em>annotations</em></span>]
[<span class="emphasis"><em>expression_declarations</em></span>]
[context <span class="emphasis"><em>context_name</em></span>]
[into table <span class="emphasis"><em>table_name</em></span>]
[insert into <span class="emphasis"><em>insert_into_def</em></span>]
select <span class="emphasis"><em>select_list</em></span>
from <span class="emphasis"><em>stream_def</em></span> [as name] [, <span class="emphasis"><em>stream_def</em></span> [as name]] [,...]
[where <span class="emphasis"><em>search_conditions</em></span>]
[group by <span class="emphasis"><em>grouping_expression_list</em></span>]
[having <span class="emphasis"><em>grouping_search_conditions</em></span>]
[output <span class="emphasis"><em>output_specification</em></span>]
[order by <span class="emphasis"><em>order_by_expression_list</em></span>]
[limit <span class="emphasis"><em>num_rows</em></span>]
</pre><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-syntax-time-periods"/>5.2.1.Â Specifying Time Periods</h3></div></div></div><p>
					Time-based windows as well as pattern observers and guards take a time period as a parameter. Time periods follow the syntax below.
			</p><pre class="synopsis">time-period : [<span class="emphasis"><em>year-part</em></span>] [<span class="emphasis"><em>month-part</em></span>] [<span class="emphasis"><em>week-part</em></span>] [<span class="emphasis"><em>day-part</em></span>] [<span class="emphasis"><em>hour-part</em></span>] 
      [<span class="emphasis"><em>minute-part</em></span>] [<span class="emphasis"><em>seconds-part</em></span>] [<span class="emphasis"><em>milliseconds-part</em></span>] [<span class="emphasis"><em>microseconds-part</em></span>]

year-part : <span class="emphasis"><em>(number|variable_name)</em></span> ("years" | "year")
month-part : <span class="emphasis"><em>(number|variable_name)</em></span> ("months" | "month")
week-part : <span class="emphasis"><em>(number|variable_name)</em></span> ("weeks" | "week")
day-part : <span class="emphasis"><em>(number|variable_name)</em></span> ("days" | "day")
hour-part : <span class="emphasis"><em>(number|variable_name)</em></span> ("hours" | "hour")
minute-part : <span class="emphasis"><em>(number|variable_name)</em></span> ("minutes" | "minute" | "min")
seconds-part : <span class="emphasis"><em>(number|variable_name)</em></span> ("seconds" | "second" | "sec")
milliseconds-part : <span class="emphasis"><em>(number|variable_name)</em></span> ("milliseconds" | "millisecond" | "msec")
microseconds-part : <span class="emphasis"><em>(number|variable_name)</em></span> ("microseconds" | "microsecond" | "usec")</pre><p>
					Some examples of time periods are:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">10 seconds
10 minutes 30 seconds
20 sec 100 msec
1 day 2 hours 20 minutes 15 seconds 110 milliseconds 5 microseconds
0.5 minutes
1 year
1 year 1 month</pre><p>
				Variable names and substitution parameters '<code class="literal">?</code>' for prepared statements are also allowed as part of a time period expression.
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
					When the time period has a month or year part, all values must be integer-type values.
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-syntax-comments"/>5.2.2.Â Using Comments</h3></div></div></div><p>
				Comments can appear anywhere in the EPL or pattern statement text where whitespace is allowed. Comments can be written in two ways: slash-slash (<code class="literal">// ...</code>) comments and slash-star (<code class="literal">/* ... */</code>) comments.
			</p><p>
				Slash-slash comments extend to the end of the line:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// This comment extends to the end of the line.
// Two forward slashes with no whitespace between them begin such comments.

select * from MyEvent  // this is a slash-slash comment

// All of this text together is a valid statement.</pre><p>
				Slash-star comments can span multiple lines:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">/* This comment is a "slash-star" comment that spans multiple lines.
 * It begins with the slash-star sequence with no space between the '/' and '*' characters.
 * By convention, subsequent lines can begin with a star and are aligned, but this is 
 * not required.
 */		
select * from MyEvent  /* this also works */</pre><p>
				Comments styles can also be mixed:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select field1, // first comment
  /* second comment*/  field2
  from MyEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-syntax-keywords"/>5.2.3.Â Reserved Keywords</h3></div></div></div><a id="d0e5441" class="indexterm"/><p>
				Certain words such as <code class="literal">select</code>, <code class="literal">delete</code> or <code class="literal">set</code> are reserved and may not be used as identifiers. Please consult <a class="xref" href="#appendix_keywords" title="AppendixÂ C.Â Reserved Keywords">AppendixÂ C, <i>Reserved Keywords</i></a> for the list of reserved keywords and permitted keywords.
			</p><p>
				Names of built-in functions and certain auxiliary keywords are permitted as event property names and in the rename syntax of the <code class="literal">select</code> clause. For example, <code class="literal">count</code> is acceptable. 
			</p><p>
				Consider the example below, which assumes that <code class="literal">'last'</code> is an event property of MyEvent:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// valid
select last, count(*) as count from MyEvent</pre><p>
				This example shows an incorrect use of a reserved keyword:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// invalid
select insert from MyEvent</pre><p>
				EPL offers an escape syntax for reserved keywords: Event properties as well as event or stream names may be escaped via the backwards apostrophe <code class="literal">`</code> (ASCII 96) character.
			</p><p>
				The next example queries an event type by name <code class="literal">Order</code> (a reserved keyword) that provides a property by name <code class="literal">insert</code> (a reserved keyword):
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// valid
select `insert` from `Order`</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-syntax-escapestring"/>5.2.4.Â Escaping Strings</h3></div></div></div><a id="d0e5494" class="indexterm"/><p>
				You may surround string values by either double-quotes (<code class="literal">"</code>) or single-quotes (<code class="literal">'</code>). When your string constant in an EPL statement itself contains double quotes or single quotes,
				you must escape the quotes.
			</p><p>
				Double and single quotes may be escaped by the backslash (<code class="literal">\</code>) character or by unicode notation. Unicode 0027 is a single quote (<code class="literal">'</code>) and 0022 is a double quote (<code class="literal">"</code>).
			</p><p>
			  Escaping event property names is described in <a class="xref" href="#eventrep-properties-escaping" title="3.2.1.Â Escape Characters">SectionÂ 3.2.1, âEscape Charactersâ</a>.
			</p><p>
				The sample EPL below escapes the single quote in the string constant <code class="literal">John's</code>, and filters out order events where the name value matches:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from OrderEvent(name='John\'s')
// ...equivalent to...
select * from OrderEvent(name='John\u0027s')</pre><p>
				The next EPL escapes the string constant <code class="literal">Quote "Hello"</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from OrderEvent(description like "Quote \"Hello\"")
// is equivalent to
select * from OrderEvent(description like "Quote \u0022Hello\u0022")</pre><p>
				When building an escape string via the API, escape the backslash, as shown in below code snippet:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epService.getEPAdministrator().createEPL("select * from OrderEvent(name='John\\'s')");
// ... and for double quotes...
epService.getEPAdministrator().createEPL("select * from OrderEvent(
  description like \"Quote \\\"Hello\\\"\")");</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-syntax-datatype"/>5.2.5.Â Data Types</h3></div></div></div><a id="d0e5541" class="indexterm"/><p>
				For NEsper .NET also see <a class="xref" href="#appendix_dotnet_epl_syntax_datatype" title="I.12.Â .NET EPL Syntax - Data Types">SectionÂ I.12, â.NET EPL Syntax - Data Typesâ</a>.
			</p><p>
				EPL honors all Java built-in primitive and boxed types, including <code class="literal">java.math.BigInteger</code> and <code class="literal">java.math.BigDecimal</code>.
			</p><p>
				EPL also follows Java standards in terms of widening, performing widening automatically in cases where widening type conversion is allowed without loss of precision, for both boxed and primitive types and including <code class="literal">BigInteger</code> and <code class="literal">BigDecimal</code>:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						byte to short, int, long, float, double, BigInteger or BigDecimal
					</p></li><li><p>
						short to int, long, float, or double, BigInteger or BigDecimal
					</p></li><li><p>
						char to int, long, float, or double, BigInteger or BigDecimal
					</p></li><li><p>
						int to long, float, or double, BigInteger or BigDecimal
					</p></li><li><p>
						long to float or double, BigInteger or BigDecimal
					</p></li><li><p>
						float to double or BigDecimal
					</p></li><li><p>
						double to BigDecimal
					</p></li></ol></div><p>
				In cases where loss of precision is possible because of narrowing requirements, EPL compilation outputs a compilation error.
			</p><p>
				EPL supports casting via the <code class="literal">cast</code> function.
			</p><p>
				EPL returns double-type values for division regardless of operand type. EPL can also be configured to follow Java rules for integer arithmetic instead as described in <a class="xref" href="#config-engine-expression" title="15.4.26.Â Engine Settings Related to Expression Evaluation">SectionÂ 15.4.26, âEngine Settings Related to Expression Evaluationâ</a>.
			</p><p>
				Division by zero returns positive or negative infinity. Division by zero can be configured to return null instead.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-syntax-datatype-constants"/>5.2.5.1.Â Data Type of Constants</h4></div></div></div><a id="d0e5602" class="indexterm"/><a id="d0e5605" class="indexterm"/><p>
					An EPL constant is a number or a character string that indicates a fixed value. Constants can be used as expressions in many EPL statements, including variable assignment and case-when statements. They can also be used as parameter values for many built-in objects and clauses. Constants are also called literals.				
				</p><p>
					EPL supports the standard SQL constant notation as well as Java data type literals.
				</p><p>
					The following are types of EPL constants:
				</p><div class="table"><a id="d0e5614"/><p class="title"><b>TableÂ 5.1.Â Types of EPL constants</b></p><div class="table-contents"><table summary="Types of EPL constants" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Type</th><th>Description</th><th>Examples</th></tr></thead><tbody><tr><td>string</td><td>A single character to an unlimited number of characters. Valid delimiters are the single quote (') or double quote (").</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select 'volume' as field1,
   "sleep" as field2, 
  "\u0041" as unicodeA</pre></td></tr><tr><td>boolean</td><td>A boolean value.</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select true as field1, 
  false as field2</pre></td></tr><tr><td>integer</td><td>An integer value (4 byte).</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select 1 as field1, 
  -1 as field2, 
  1e2 as field3</pre></td></tr><tr><td>long</td><td>A long value (8 byte). Use the "L" or "l" (lowercase L) suffix.</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select 1L as field1, 
  1l as field2</pre></td></tr><tr><td>double</td><td>A double-precision 64-bit IEEE 754 floating point.</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select 1.67 as field1, 
  167e-2 as field2, 
  1.67d as field3</pre></td></tr><tr><td>float</td><td>A single-precision 32-bit IEEE 754 floating point. Use the "f" suffix.</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select 1.2f as field1, 
  1.2F as field2</pre></td></tr><tr><td>byte</td><td>A 8-bit signed two's complement integer.</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select 0x10 as field1</pre></td></tr></tbody></table></div></div><br class="table-break"/><p>
					EPL does not have a single-byte character data type for its literals. Single character literals are treated as string.
				</p><p>
					Internal byte representation and boundary values of constants follow the Java standard.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-syntax-datatype-bignumber"/>5.2.5.2.Â BigInteger and BigDecimal</h4></div></div></div><p>
					EPL automatically performs widening of numbers to <code class="literal">BigInteger</code> and <code class="literal">BigDecimal</code> as required, and employs the respective <code class="literal">equals</code>, <code class="literal">compareTo</code> and arithmetic methods provided by <code class="literal">BigInteger</code> and <code class="literal">BigDecimal</code>.
				</p><p>
					To explicitly create <code class="literal">BigInteger</code> and <code class="literal">BigDecimal</code> constants in EPL, please use the cast syntax : <code class="literal">cast(</code><span class="emphasis"><em>value</em></span><code class="literal">, BigInteger)</code>.
				</p><p>
					Note that since <code class="literal">BigDecimal.valueOf(1.0)</code> is not the same as <code class="literal">BigDecimal.valueOf(1)</code> (in terms of equality through <code class="literal">equals</code>), care should be taken towards the consistent use of scale.
				</p><p>
					When using aggregation functions for <code class="literal">BigInteger</code> and <code class="literal">BigDecimal</code> values, please note these limitations:
				</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
							The <code class="literal">median</code>, <code class="literal">stddev</code> and <code class="literal">avedev</code> aggregation functions operate on the double value of the object and return a double value.
						</p></li><li><p>
							All other aggregation functions return <code class="literal">BigDecimal</code> or <code class="literal">BigInteger</code> values (except <code class="literal">count</code>).
						</p></li></ol></div><p>
				  For <code class="literal">BigDecimal</code> precision and rounding, please see <a class="xref" href="#config-engine-expression-mathcontext" title="15.4.26.6.Â Math Context">SectionÂ 15.4.26.6, âMath Contextâ</a>. For division operations with BigDecimal number we recommend
				  configuring a math context.
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-syntax-javaconst"/>5.2.6.Â Using Constants and Enum Types</h3></div></div></div><a id="d0e5782" class="indexterm"/><a id="d0e5785" class="indexterm"/><p>
				This chapter is about Java language constants and enum types and their use in EPL expressions. 
			</p><p>
				Java language constants are public static final fields in Java that may participate in expressions of all kinds, as this example shows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent where property = MyConstantClass.FIELD_VALUE</pre><p>
				Event properties that are enumeration values can be compared by their enum type value:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent where enumProp = EnumClass.ENUM_VALUE_1</pre><p>
				Event properties can also be passed to enum type functions or compared to an enum type method result:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent where somevalue = EnumClass.ENUM_VALUE_1.getSomeValue()
  or EnumClass.ENUM_VALUE_2.analyze(someothervalue)</pre><p>
				Enum types have a <code class="literal">valueOf</code> method that returns the enum type value:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent where enumProp = EnumClass.valueOf('ENUM_VALUE_1')</pre><p>
				If your application does not import, through configuration, the package that contains the enumeration class, then it must also specify the package name of the class. Enum types that are inner classes must be qualified with <code class="literal">$</code> following Java conventions.
			</p><p>
				For example, the Color enum type as an inner class to <code class="literal">MyEvent</code> in package <code class="literal">org.myorg</code> can be referenced as shown:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent(enumProp=org.myorg.MyEvent$Color.GREEN)#firstevent</pre><p>
				Instance methods may also be invoked on event instances by specifying a stream name, as shown below:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select myevent.computeSomething() as result from MyEvent as myevent</pre><p>
				Chaining instance methods is supported as this example shows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select myevent.getComputerFor('books', 'movies').calculate() as result 
from MyEvent as myevent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-syntax-annotation"/>5.2.7.Â Annotation</h3></div></div></div><a id="d0e5835" class="indexterm"/><p>
				An annotation is an addition made to information in a statement. Esper provides certain built-in annotations for defining statement name, adding a statement description or for tagging statements such as for managing statements or directing statement output. 
				Other than the built-in annotations, applications can provide their own annotation classes that the EPL compiler can populate.
			</p><p>
				An annotation is part of the statement text and precedes the EPL select or pattern statement. Annotations are therefore part of the EPL grammar. The syntax for annotations follows the host language (Java, .NET) annotation syntax:
			</p><pre class="synopsis">@<span class="emphasis"><em>annotation_name</em></span> [(<span class="emphasis"><em>annotation_parameters</em></span>)]</pre><p>
				An annotation consists of the annotation name and optional annotation parameters. The <span class="emphasis"><em>annotation_name</em></span> is the simple class name or fully-qualified class name of the annotation class. The optional <span class="emphasis"><em>annotation_parameters</em></span> 
				are a list of key-value pairs following the syntax:
			</p><pre class="synopsis">@<span class="emphasis"><em>annotation_name</em></span> (<span class="emphasis"><em>attribute_name</em></span> = <span class="emphasis"><em>attribute_value</em></span>, [name=value, ...])</pre><p>
				The <span class="emphasis"><em>attribute_name</em></span> is an identifier that must match the attributes defined by the annotation class. An <span class="emphasis"><em>attribute_value</em></span> is a constant of any of the primitive types or string, an array, an enum type value or another (nested) annotation. Null values are not allowed as annotation attribute values. Enumeration values are supported in EPL statements and not support in statements created via the <code class="literal">createPattern</code> method.
			</p><p>
				Use the <code class="literal">getAnnotations</code> method of <code class="literal">EPStatement</code> to obtain annotations provided via statement text.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-syntax-annotation-application"/>5.2.7.1.Â Application-Provided Annotations</h4></div></div></div><a id="d0e5891" class="indexterm"/><p>
					Your application may provide its own annotation classes. The engine detects and populates annotation instances for application annotation classes.
				</p><p>
					The name of application-provided annotations is case-sensitive.
				</p><p>
					To enable the engine to recognize application annotation classes, your annotation name must include the package name (i.e. be fully-qualified) or your engine configuration must import the annotation class or package via the configuration API.  
				</p><p>
					For example, assume that your application defines an annotation in its application code as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public @interface ProcessMonitor {
  String processName();
  boolean isLongRunning default false;
  int[] subProcessIds;
}</pre><p>
					Shown next is an EPL statement text that utilizes the annotation class defined earlier:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@ProcessMonitor(processName='CreditApproval',
  isLongRunning=true, subProcessIds = {1, 2, 3} )
  
select count(*) from ProcessEvent(processId in (1, 2, 3)#time(30)</pre><p>
					Above example assumes the <code class="literal">ProcessMonitor</code> annotation class is imported via configuration XML or API. 					
				</p><p>
					If <code class="literal">ProcessMonitor</code> should only be visible for use in annotations, use <code class="literal">addAnnotationImport</code> (or the <code class="literal">auto-import-annotations</code> XML tag).
					If <code class="literal">ProcessMonitor</code> should be visible in all of EPL including annotations, use <code class="literal">addImport</code> (or the <code class="literal">auto-import</code> XML tag).
				</p><p>
					Here is an example API call to import for annotation-only all classes in package <code class="literal">com.mycompany.app.myannotations</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epService.getEPAdministrator().getConfiguration().addAnnotationImport("com.mycompany.app.myannotations.*");</pre><p>
					The next example imports the <code class="literal">ProcessMonitor</code> class only and only for annotation use:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epService.getEPAdministrator().getConfiguration().addAnnotationImport("com.mycompany.myannotations.ProcessMonitor");</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-syntax-annotation-withenum"/>5.2.7.2.Â Annotations With Enumeration Values</h4></div></div></div><a id="d0e5952" class="indexterm"/><p>
					For annotations that accept an enumeration value, the enumeration name does not need to be specified and matching is not case-sensitive.
				</p><p>
					For example, assume the enum is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public enum MyEnum {
    ENUM_VALUE_1,
    ENUM_VALUE_2;
}</pre><p>
					Assume the annotation is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public @interface MyAnnotationWithEnum {
    MyEnum myEnum();
}</pre><p>
					The EPL statement can specify:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@MyAnnotationWithEnum(myEnum = enum_value_1) select * from MyEvent</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-syntax-annotation-builtin"/>5.2.7.3.Â Built-In Statement Annotations</h4></div></div></div><a id="d0e5974" class="indexterm"/><p>
					The name of built-in annotations is not case-sensitive, allowing both <code class="literal">@NAME</code> or <code class="literal">@name</code>, for example.
				</p><p>
					The list of built-in EPL statement-level annotations is:
				</p><div class="table"><a id="d0e5989"/><p class="title"><b>TableÂ 5.2.Â Built-In EPL Statement Annotations</b></p><div class="table-contents"><table summary="Built-In EPL Statement Annotations" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Name</th><th>Purpose and Attributes</th><th>Example</th></tr></thead><tbody><tr><td>Name</td><td>
									<p>Provides a statement name. Attributes are:</p>
									<p>value : Statement name.</p>
								</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Name("MyStatementName")</pre></td></tr><tr><td>Description</td><td>
									<p>Provides a statement textual description. Attributes are:</p>
									<p>value : Statement description.</p>
								</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Description("Place statement
description here.")</pre></td></tr><tr><td>Tag</td><td>
									<p>For tagging a statement with additional information. Attributes are:</p>
									<p>name : Tag name.</p>
									<p>value : Tag value.</p>
								</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Tag(name="MyTagName", 
 value="MyTagValue")</pre></td></tr><tr><td>Priority</td><td>
									<p>Applicable when an event (or schedule) matches filter criteria for multiple statements: Defines the order of statement processing (requires an engine-level setting).</p>
									<p>Attributes are:</p>
									<p>value : priority value.</p>
								</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Priority(10)</pre></td></tr><tr><td>Drop</td><td>
									<p>Applicable when an event (or schedule) matches filter criteria for multiple statements, drops the event after processing the statement (requires an engine-level setting).</p>
									<p>No attributes.</p>
								</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Drop</pre></td></tr><tr><td>Hint</td><td>
									<p>For providing one or more hints towards how the engine should execute a statement. Attributes are:</p>
									<p>value : A comma-separated list of one or more case-insensitive keywords.</p>
								</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Hint('iterate_only')</pre></td></tr><tr><td>Hook</td><td>
									<p>Use this annotation to register one or more statement-specific hooks providing a hook type for each individual hook, such as for SQL parameter, column or row conversion.</p>
									<p>Attributes are the hook <code class="literal">type</code> and the <code class="literal">hook</code> itself (usually a import or class name):</p>
								</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Hook(type=HookType.SQLCOL,
  hook='MyDBTypeConvertor')</pre></td></tr><tr><td>Audit</td><td>
									<p>Causes the engine to output detailed processing information for a statement.</p>
									<p>optional value : A comma-separated list of one or more case-insensitive keywords.</p>
								</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Audit</pre></td></tr><tr><td>EventRepresentation</td><td>
									<p>Causes the engine to use object-array or Avro event representation, if possible, for output and internal event types.</p>
								</td><td>
									<p>
										For Object-Array:
									</p>
									<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@EventRepresentation(objectarray)</pre>
									<p>
										For Avro:
									</p>
									<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@EventRepresentation(avro)</pre></td></tr><tr><td>IterableUnbound</td><td>
									<p>For use when iterating statements with unbound streams, instructs the engine to retain the last event for iterating.</p>
								</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@IterableUnbound</pre></td></tr></tbody></table></div></div><br class="table-break"/><p>
					The following example statement text specifies some of the built-in annotations in combination:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Name("RevenuePerCustomer")
@Description("Outputs revenue per customer considering all events encountered so far.")
@Tag(name="grouping", value="customer")

select customerId, sum(revenue) from CustomerRevenueEvent</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-syntax-annotation-name"/>5.2.7.4.Â @Name</h4></div></div></div><p>
					Use the @Name EPL annotation to specify a statement name within the EPL statement itself, as an alternative to specifying the statement name via API.
				</p><p>
					If your application is also providing a statement name through the API, the statement name provided through the API overrides the annotation-provided statement name.
				</p><p>
					Example:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Name("SecurityFilter1") select * from SecurityFilter(ip="127.0.0.1")</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-syntax-annotation-description"/>5.2.7.5.Â @Description</h4></div></div></div><p>
					Use the @Description EPL annotation to add a statement textual description.
				</p><p>
					Example:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Description('This statement filters localhost.') select * from SecurityFilter(ip="127.0.0.1")</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-syntax-annotation-tag"/>5.2.7.6.Â @Tag</h4></div></div></div><p>
					Use the @Tag EPL annotation to tag statements with name-value pairs, effectively adding a property to the statement. The attributes <code class="literal">name</code> and <code class="literal">value</code> are of type string.
				</p><p>
					Example:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Tag(name='ip_sensitive', value='Y') 
@Tag(name='author', value='Jim')
select * from SecurityFilter(ip="127.0.0.1")</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-syntax-annotation-priority"/>5.2.7.7.Â @Priority</h4></div></div></div><p>
					This annotation only takes effect if the engine-level setting for prioritized execution is set via configuration, as described in <a class="xref" href="#config-engine-execution" title="15.4.27.Â Engine Settings Related to Execution of Statements">SectionÂ 15.4.27, âEngine Settings Related to Execution of Statementsâ</a>.
				</p><p>
					Use the @Priority EPL annotation to tag statements with a priority value. The default priority value is zero (0) for all statements. When an event (or single timer execution) requires processing the event for multiple statements, processing begins with the highest priority statement and ends with the lowest-priority statement.
				</p><p>
					Example:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Priority(10) select * from SecurityFilter(ip="127.0.0.1")</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-syntax-annotation-drop"/>5.2.7.8.Â @Drop</h4></div></div></div><p>
					This annotation only takes effect if the engine-level setting for prioritized execution is set via configuration, as described in <a class="xref" href="#config-engine-execution" title="15.4.27.Â Engine Settings Related to Execution of Statements">SectionÂ 15.4.27, âEngine Settings Related to Execution of Statementsâ</a>.
				</p><p>
					Use the @Drop EPL annotation to tag statements that preempt all other same or lower-priority statements. When an event (or single timer execution) requires processing the event for multiple statements, processing begins with the highest priority statement and ends with the first statement marked with @Drop, which becomes the last statement to process that event.
				</p><p>
					Unless a different priority is specified, the statement with the @Drop EPL annotation executes at priority 1. Thereby @Drop alone is an effective means to remove events from a stream.
				</p><p>
					Example:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Drop select * from SecurityFilter(ip="127.0.0.1")</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-syntax-annotation-hint"/>5.2.7.9.Â @Hint</h4></div></div></div><p>
					A hint can be used to provide tips for the engine to affect statement execution. Hints change performance or memory-use of a statement but generally do not change its output.
				</p><p>
					The string value of a <code class="literal">Hint</code> annotation contains a keyword or a comma-separated list of multiple keywords. Hint keywords are case-insensitive. A list of hints is available in <a class="xref" href="#perf-tips-15" title="23.2.22.Â Consider Using Hints">SectionÂ 23.2.22, âConsider Using Hintsâ</a>.
				</p><p>
					Example:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Hint('disable_reclaim_group') 
select ipaddress, count(*) from SecurityFilter#time(60 sec) group by ipaddress</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-syntax-annotation-hook"/>5.2.7.10.Â @Hook</h4></div></div></div><p>
					A hook is for attaching a callback to a statement.
				</p><p>
					The type value of a <code class="literal">@Hook</code> annotation defines the type of hook and the <code class="literal">hook</code> value is an imported or fully-qualified class name providing the callback implementation.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-syntax-annotation-audit"/>5.2.7.11.Â @Audit</h4></div></div></div><p>
					Causes the engine to output detailed information about the statements processing. Described in more detail at <a class="xref" href="#devlifecycle-debugging-audit" title="16.3.1.Â @Audit Annotation">SectionÂ 16.3.1, â@Audit Annotationâ</a>.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-syntax-annotation-eventrepresentation"/>5.2.7.12.Â @EventRepresentation</h4></div></div></div><p>
				  Use the <code class="literal">@EventRepresentation</code> annotation with <code class="literal">create schema</code> and <code class="literal">create window</code> statements to instruct the engine to use a specific event representation for the schema or named window.
				</p><p>
				  Use the <code class="literal">@EventRepresentation</code> annotation with <code class="literal">select</code> statements to instruct the engine to use a specific event representation for output events.
				</p><p>
				  When no <code class="literal">@EventRepresentation</code> annotation is specified, the engine uses the default event representation as configured, see <a class="xref" href="#config-engine-eventmeta-representation" title="15.4.14.1.Â Default Event Representation">SectionÂ 15.4.14.1, âDefault Event Representationâ</a>.
				</p><p>
				  Use <code class="literal">@EventRepresentation(objectarray)</code> to instruct the engine to use object-array events.
				</p><p>
				  Use <code class="literal">@EventRepresentation(avro)</code> to instruct the engine to use Avro events.
				</p><p>
				  Use <code class="literal">@EventRepresentation(map)</code> to instruct the engine to use Map events.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-syntax-annotation-iterableunbound"/>5.2.7.13.Â @IterableUnbound</h4></div></div></div><p>
					Causes the engine, for statements with unbound streams, to retain the last event for the purpose of iterating using the iterator API. An engine-wide configuration is
					also available as described in <a class="xref" href="#config-engine-viewresources-iterableunbound" title="15.4.15.2.Â Iterator Behavior For Unbound Streams">SectionÂ 15.4.15.2, âIterator Behavior For Unbound Streamsâ</a>.
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-syntax-expression-alias"/>5.2.8.Â Expression Alias</h3></div></div></div><a id="d0e6318" class="indexterm"/><a id="d0e6321" class="indexterm"/><p>
				An expression alias simply assigns a name to an expression. The alias name can be used in other expressions to refer to that expression, without the need to duplicate the expression.
			</p><p>
				The expression alias obtains its scope from where it is used. Parameters cannot be provided. 
				A second means to sharing expressions is the expression declaration as described next, which allows passing parameters and is more tightly scoped.
			</p><p>
				An EPL statement can contain and refer to any number of expression aliases. 
			    For expressions aliases that are visible across multiple EPL statements please consult <a class="xref" href="#create-exprglobal-alias" title="5.18.1.Â Global Expression Aliases">SectionÂ 5.18.1, âGlobal Expression Aliasesâ</a> 
			    that explains the <code class="literal">create expression</code> clause.
			</p><p>
				The syntax for an expression alias is:
			</p><pre class="synopsis">expression <span class="emphasis"><em>expression_name</em></span> <code class="literal">alias for { </code><span class="emphasis"><em>expression</em></span> <code class="literal">}</code></pre><p>
				An expression alias consists of the expression name and an expression in curly braces.
				The return type of the expression is determined by the engine and need not be specified. 
				The scope is automatic and determined by where the alias name is used therefore parameters cannot be specified.
			</p><p>
				This example declares an expression alias <code class="literal">twoPI</code> that substitutes <code class="literal">Math.PI * 2</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression twoPI alias for { Math.PI * 2 }
select twoPI from SampleEvent</pre><p>
				The next example specifies an alias <code class="literal">countPeople</code> and uses the alias in the <code class="literal">select</code>-clause and the <code class="literal">having</code>-clause:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression countPeople alias for { count(*) }
select countPeople from EnterRoomEvent#time(10 seconds) having countPeople &gt; 10</pre><p>
				When using the expression alias in an expression, empty parentheses can optionally be specified. In the above example, <code class="literal">countPeople()</code> can be used instead and equivalently.
			</p><p>
				The following scope rules apply for expression aliases:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						Expression aliases do not remove implicit limitations: For example, aggregation functions cannot be used in a filter expression even if assigned an alias.
					</p></li></ol></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-syntax-expression-decl"/>5.2.9.Â Expression Declaration</h3></div></div></div><a id="d0e6390" class="indexterm"/><a id="d0e6393" class="indexterm"/><p>
				An EPL statement can contain expression declarations. Expressions that are common to multiple places in the same EPL statement can be moved to a named expression declaration and reused within the same statement without duplicating the expression itself.
			</p><p>
			    For declaring expressions that are visible across multiple EPL statements i.e. globally visible expressions please consult <a class="xref" href="#create-exprglobal-expr" title="5.18.2.Â Global Expression Declarations">SectionÂ 5.18.2, âGlobal Expression Declarationsâ</a> 
			    that explains the <code class="literal">create expression</code> clause.
			</p><p>
			    The engine may cache declared expression result values and reuse cache values, see <a class="xref" href="#config-engine-execution-declaredexprvaluecachesize" title="15.4.27.8.Â Declared Expression Value Cache Size">SectionÂ 15.4.27.8, âDeclared Expression Value Cache Sizeâ</a>.
			</p><p>
				An expression declaration follows the lambda-style expression syntax. This syntax was chosen as it typically allows for a shorter and more concise expression body that can be easier to read then most procedural code. 
			</p><p>
				The syntax for an expression declaration is:
			</p><pre class="synopsis">expression <span class="emphasis"><em>expression_name</em></span> { <span class="emphasis"><em>expression_body</em></span> }</pre><p>
				An expression declaration consists of the expression name and an expression body. The <span class="emphasis"><em>expression_name</em></span> is any identifier. The <span class="emphasis"><em>expression_body</em></span> contains optional parameters and the expression.
				The parameter types and the return type of the expression is determined by the engine and do not need to be specified.
			</p><p>
				Parameters to a declared expression can be a stream name, pattern tag name or wildcard (<code class="literal">*</code>). Use wildcard to pass the event itself to the expression. In a join or subquery, or more generally in an expression where multiple streams or pattern tags are available, the EPL must specify the stream name or pattern tag name and cannot use wildcard.
			</p><p>
				In the expression body the <code class="literal">=&gt;</code> lambda operator reads as "goes to" (<code class="literal">-&gt;</code> may be used and is equivalent). The left side of the lambda operator specifies the input parameters (if any) and the right side holds the expression. The lambda expression <code class="literal">x =&gt; x * x</code> is read "x goes to x times x".
			</p><p>
				In the expression body, if your expression takes no parameters, you may simply specify the expression and do not need the <code class="literal">=&gt;</code> lambda operator.
			</p><p>
				If your expression takes one parameters, specify the input parameter name followed by the <code class="literal">=&gt;</code> lambda operator and followed by the expression. The synopsis for use with a single input parameter is:
			</p><pre class="synopsis">expression_body:   <span class="emphasis"><em>input_param_name</em></span> =&gt; <span class="emphasis"><em>expression</em></span> </pre><p>
				If your expression takes two or more parameters, specify the input parameter names in parenthesis followed by the <code class="literal">=&gt;</code> lambda operator followed by the expression. The synopsis for use with a multiple input parameter is:
			</p><pre class="synopsis">expression_body:   (<span class="emphasis"><em>input_param</em></span> [,<span class="emphasis"><em>input_param</em></span> [,...]]) =&gt; <span class="emphasis"><em>expression</em></span> </pre><p>
				The following example declares an expression that returns two times PI (ratio of the circumference of a circle to its diameter) and demonstrates its use in a select-clause:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression twoPI { Math.PI * 2} select twoPI() from SampleEvent</pre><p>
				The parentheses are optional when the expression accepts no parameters. The below is equivalent to the previous example:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression twoPI { Math.PI * 2} select twoPI from SampleEvent</pre><p>
				The next example declares an expression that accepts one parameter: a MarketData event. The expression computes a new "mid" price based on the buy and sell price:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression midPrice { x =&gt; (x.buy + x.sell) / 2 } 
select midPrice(md) from MarketDataEvent as md</pre><p>
				The variable name can be left off if event property names resolve without ambiguity.
			</p><p>
				This example EPL removes the variable name <code class="literal">x</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression midPrice { x =&gt; (buy + sell) / 2 } 
select midPrice(md) from MarketDataEvent as md</pre><p>
				The next example EPL specifies wildcard instead:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression midPrice { x =&gt; (buy + sell) / 2 } 
select midPrice(*) from MarketDataEvent</pre><p>
				A further example that demonstrates two parameters is listed next. The example joins two streams and uses the price value from MarketDataEvent and the sentiment value of NewsEvent to compute a weighted sentiment:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression weightedSentiment { (x, y) =&gt; x.price * y.sentiment } 
select weightedSentiment(md, news) 
from MarketDataEvent#lastevent as md, NewsEvent#lastevent news</pre><p>
				Any expression can be used in the expression body including aggregations, variables, subqueries or further declared or alias expressions. Sub-queries, when used without <code class="literal">in</code> or <code class="literal">exists</code>, must be placed within parenthesis.
			</p><p>
			    An example subquery within an expression declaration is shown next:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression newsSubq { md -&gt; 
    (select sentiment from NewsEvent#unique(symbol) where symbol = md.symbol) 
} 
select newsSubq(mdstream)
from MarketDataEvent mdstream</pre><p>
				When using expression declarations please note these limitations:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						Parameters to a declared expression can only be a stream name, pattern tag name or wildcard (<code class="literal">*</code>).
					</p></li><li><p>
						Expression declarations do not remove implicit limitations: For example, aggregation functions cannot be used in a filter expression even if using an expression declaration.
					</p></li></ol></div><p>
				The following scope rules apply for declared expressions:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						The scope of the expression body of a declared expression only includes the parameters explicitly listed. Consider using an expression alias instead.
					</p></li></ol></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-syntax-script-decl"/>5.2.10.Â Script Declaration</h3></div></div></div><a id="d0e6543" class="indexterm"/><p>
				Esper allows the use of scripting languages within EPL. Any scripting language that supports JSR 223 and also the MVEL scripting language can be specified in EPL.
			</p><p>
				Please see <a class="xref" href="#script" title="ChapterÂ 18.Â Script Support">ChapterÂ 18, <i>Script Support</i></a> for more information.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-syntax-context-decl"/>5.2.11.Â Referring to a Context</h3></div></div></div><p>
			   You may refer to a context in the EPL text by specifying the <code class="literal">context</code> keyword followed by a context name. Context are described in more detail at <a class="xref" href="#context" title="ChapterÂ 4.Â Context and Context Partitions">ChapterÂ 4, <i>Context and Context Partitions</i></a>
			</p><p>
				The effect of referring to a context is that your statement operates according to the context dimensional information as declared for the context.
			</p><p>
			  The synopsis is:
			</p><pre class="synopsis">... context <span class="emphasis"><em>context_name</em></span> ...</pre><p>
			  You may refer to a context in all statements except for the following types of statements:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						<code class="literal">create schema</code> for declaring event types.
					</p></li><li><p>
						<code class="literal">create variable</code> for declaring a variable.
					</p></li><li><p>
						<code class="literal">create index</code> for creating an index on a named window or table.
					</p></li><li><p>
						<code class="literal">update istream</code> for updating insert stream events.
					</p></li></ol></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-select-list"/>5.3.Â Choosing Event Properties and Events: The <span class="emphasis"><em>Select</em></span> Clause</h2></div></div></div><a id="d0e6604" class="indexterm"/><a id="d0e6607" class="indexterm"/><p>
			The <code class="literal">select</code> clause is required in all EPL statements. The <code class="literal">select</code> clause can be used to select all properties via the wildcard <code class="literal">*</code>, or to specify a list of event properties and expressions. The <code class="literal">select</code> clause defines the event type (event property names and types) of the resulting events published by the statement, or pulled from the statement via the iterator methods.
		</p><p>
			The <code class="literal">select</code> clause also offers optional <code class="literal">istream</code>, <code class="literal">irstream</code> and <code class="literal">rstream</code> keywords to control whether input stream, remove stream or input and remove stream events are posted to <code class="literal">UpdateListener</code> instances and observers to a statement. By default, the engine provides only the insert stream to listener and observers. See <a class="xref" href="#config-engine-stream-selection" title="15.4.21.Â Engine Settings Related to Stream Selection">SectionÂ 15.4.21, âEngine Settings Related to Stream Selectionâ</a> on how to change the default.
		</p><p>
			The syntax for the <code class="literal">select</code> clause is summarized below.
		</p><pre class="synopsis">select [istream | irstream | rstream] [distinct] * | <span class="emphasis"><em>expression_list</em></span> ... </pre><p>
			The <code class="literal">istream</code> keyword is the default, and indicates that the engine only delivers insert stream events to listeners and observers. The <code class="literal">irstream</code> keyword indicates that the engine delivers both insert and remove stream. Finally, the <code class="literal">rstream</code> keyword tells the engine to deliver only the remove stream.
		</p><p>
			The <code class="literal">distinct</code> keyword outputs only unique rows depending on the column list you have specified after it. It must occur after the <code class="literal">select</code> and after the optional stream keywords, as described in more detail below.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-select-all-props"/>5.3.1.Â Choosing the Event Itself: Select *</h3></div></div></div><p>
				The syntax for selecting the event itself is:
			</p><pre class="synopsis">select * from <span class="emphasis"><em>stream_def</em></span></pre><p>
				The following statement selects StockTick events for the last 30 seconds of IBM stock ticks.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTick(symbol='IBM')#time(30 sec)</pre><p>
			  You may well be asking: Why does the statement specify a time window here? First, the statement is meant to demonstrate the use of <code class="literal">*</code> wildcard. 
			  When the engine pushes statement results to your listener and as the statement does not select remove stream events via <code class="literal">rstream</code> keyword, the listener receives only new events and the time window could be left off.
			  By adding the time window the pull API (iterator API or JDBC driver) returns the last 30 seconds of events.
			</p><p>
				The <code class="literal">*</code> wildcard and expressions can also be combined in a <code class="literal">select</code> clause. The combination selects all event properties and in addition the computed values
				as specified by any additional expressions that are part of the <code class="literal">select</code> clause. Here is an example that selects all properties of stock tick events plus a computed product of price and volume that the 
				statement names 'pricevolume':
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select *, price * volume as pricevolume from StockTick</pre><p>
				When using wildcard (*), Esper does not actually read or copy your event properties out of your event or events, neither does it copy the event object. 
				It simply wraps your native type in an <code class="literal">EventBean</code> interface. Your application has access to
				the underlying event object through the <code class="literal">getUnderlying</code> method and has access to the property values through the <code class="literal">get</code> method.
			</p><p>
				In a join statement, using the <code class="literal">select *</code> syntax selects one event property per stream to hold the event for that stream. The property name is the stream name in the <code class="literal">from</code> clause. 
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-select-event-props"/>5.3.2.Â Choosing Specific Event Properties</h3></div></div></div><p>
				To choose the particular event properties to return:
			</p><pre class="synopsis">select <span class="emphasis"><em>event_property</em></span> [, <span class="emphasis"><em>event_property</em></span>] [, ...] from <span class="emphasis"><em>stream_def</em></span></pre><p>
				The following statement simply selects the symbol and price properties of stock ticks, and the total volume for stock tick events in a 60-second time window. 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, price, sum(volume) from StockTick(symbol='IBM')#time(60 sec)
</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-select-expressions"/>5.3.3.Â Expressions</h3></div></div></div><p>
				The <code class="literal">select</code> clause can contain one or more expressions.
			</p><pre class="synopsis">select <span class="emphasis"><em>expression</em></span> [, <span class="emphasis"><em>expression</em></span>] [, ...] from <span class="emphasis"><em>stream_def</em></span></pre><p>
				The following statement selects the volume multiplied by price for a time batch of the last 30 seconds of stock tick events. 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select volume * price from StockTick#time_batch(30 sec)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-select-renaming"/>5.3.4.Â Renaming Event Properties</h3></div></div></div><p>
				Event properties and expressions can be renamed using below syntax.
			</p><pre class="synopsis">select [<span class="emphasis"><em>event_property</em></span> | <span class="emphasis"><em>expression</em></span>] [as] <span class="emphasis"><em>identifier</em></span> [, ...]</pre><p>
				The following statement selects volume multiplied by price and specifies the name <span class="emphasis"><em>volPrice</em></span> for the resulting column.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select volume * price as volPrice from StockTick</pre><p>
				Identifiers cannot contain the "." (dot) character, i.e. "vol.price" is not a valid identifier for the rename syntax.
			</p><p>
				The <code class="literal">as</code> keyword is optional. The following EPL is therefore equivalent to above:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select volume * price volPrice from StockTick</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-select-all-join"/>5.3.5.Â Choosing Event Properties and Events in a Join</h3></div></div></div><p>
				If your statement is joining multiple streams, your may specify property names that are unique among the joined streams, or use wildcard (*) as explained earlier.
			</p><p>
				In case the property name in your <code class="literal">select</code> or other clauses is not unique considering all joined streams, you will need to use the name of the stream as a prefix to the property.
			</p><p>
				This example is a join between the two streams StockTick and News, respectively named as 'tick' and 'news'. The example selects from the StockTick event the symbol value using the 'tick' stream name as a prefix:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select tick.symbol from StockTick#time(10) as tick, News#time(10) as news
where news.symbol = tick.symbol</pre><p>
				Use the wildcard (*) selector in a join to generate a property for each stream, with the property value being the event itself. The output events of the statement below have two properties: the 'tick' property holds the StockTick event and the 'news' property holds the News event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTick#time(10) as tick, News#time(10) as news</pre><p>
				The following syntax can also be used to specify what stream's properties to select:
			</p><pre class="synopsis">select <span class="emphasis"><em>stream_name</em></span>.* [as <span class="emphasis"><em>name</em></span>] from ...</pre><p>
				The selection of <code class="literal">tick.*</code> selects the StockTick stream events only:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select tick.* from StockTick#time(10) as tick, News#time(10) as news
where tick.symbol = news.symbol</pre><p>
				The next example uses the <code class="literal">as</code> keyword to name each stream's joined events. This instructs the engine to create a property for each named event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select tick.* as stocktick, news.* as news 
from StockTick#time(10) as tick, News#time(10) as news
where stock.symbol = news.symbol</pre><p>
				The output events of the above example have two properties 'stocktick' and 'news' that are the StockTick and News events.
			</p><p>
				The stream name itself, as further described in <a class="xref" href="#epl-from-clause-stream-name" title="5.4.5.Â Using the Stream Name">SectionÂ 5.4.5, âUsing the Stream Nameâ</a>, may be used within expressions or alone. 
			</p><p>
				This example passes events to a user-defined function named <code class="literal">compute</code> and also shows <code class="literal">insert-into</code> to populate an event stream of combined events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into TickNewStream select tick, news, MyLib.compute(news, tick) as result
from StockTick#time(10) as tick, News#time(10) as news
where tick.symbol = news.symbol</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// second statement that uses the TickNewStream stream
select tick.price, news.text, result from TickNewStream</pre><p>
				In summary, the <span class="emphasis"><em>stream_name.*</em></span> streamname wildcard syntax can be used to select a stream as the underlying event or as a property, but cannot appear within an expression. While the <span class="emphasis"><em>stream_name</em></span> syntax (without wildcard) always selects a property (and not as an underlying event), and can occur anywhere within an expression.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-select-pattern"/>5.3.6.Â Choosing Event Properties and Events From a Pattern</h3></div></div></div><p>
				If your statement employs pattern expressions, then your pattern expression tags events with a tag name. Each tag name becomes available for use as a property in the <code class="literal">select</code> clause and all other clauses.
			</p><p>
				For example, here is a very simple pattern that matches on every StockTick event received within 30 seconds after start of the statement. The sample selects the symbol and price properties of the matching events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select tick.symbol as symbol, tick.price as price
from pattern[every tick=StockTick where timer:within(10 sec)]</pre><p>
				The use of the wildcard selector, as shown in the next statement, creates a property for each tagged event in the output. The next statement outputs events that hold a single 'tick' property whose value is the event itself:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern[every tick=StockTick where timer:within(10 sec)]</pre><p>
				You may also select the matching event itself using the <code class="literal">tick.*</code> syntax. The engine outputs the StockTick event itself to listeners:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select tick.* from pattern[every tick=StockTick where timer:within(10 sec)]</pre><p>
				A tag name as specified in a pattern is a valid expression itself. This example uses the <code class="literal">insert into</code> clause to make available the events matched by a pattern to further statements:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// make a new stream of ticks and news available
insert into StockTickAndNews 
select tick, news from pattern [every tick=StockTick -&gt; news=News(symbol=tick.symbol)]</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// second statement to select from the stream of ticks and news
select tick.symbol, tick.price, news.text from StockTickAndNews</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-select-using-istream-rstream"/>5.3.7.Â Selecting <code class="literal">Insert</code> and <code class="literal">Remove</code> Stream Events</h3></div></div></div><p>
				The optional <code class="literal">istream</code>, <code class="literal">irstream</code> and <code class="literal">rstream</code> keywords in the <code class="literal">select</code> clause control the event streams posted to listeners and observers to a statement. 
			</p><p>
				If neither keyword is specified, and in the default engine configuration, the engine posts only 
				insert stream events via the <code class="literal">newEvents</code> parameter to the <code class="literal">update</code> method of <code class="literal">UpdateListener</code> instances listening to 
				the statement. The engine does not post remove stream events, by default.
				</p><p>
				The insert stream consists of the events entering the respective window(s) or stream(s) or aggregations, while the remove stream consists of the events leaving the respective window(s) or the changed aggregation result.
				See <a class="xref" href="#processingmodel" title="ChapterÂ 2.Â Basic Concepts">ChapterÂ 2, <i>Basic Concepts</i></a> for more information on insert and remove streams.
				</p><p>
				The engine posts remove stream events to the <code class="literal">oldEvents</code> parameter of the <code class="literal">update</code> method only if the <code class="literal">irstream</code> keyword
				occurs in the <code class="literal">select</code> clause. This behavior can be changed via engine-wide configuration as described in <a class="xref" href="#config-engine-stream-selection" title="15.4.21.Â Engine Settings Related to Stream Selection">SectionÂ 15.4.21, âEngine Settings Related to Stream Selectionâ</a>.
			</p><p>
				By specifying the <code class="literal">istream</code> keyword you can instruct the engine to only post insert stream events via the <code class="literal">newEvents</code> parameter to the <code class="literal">update</code> method on listeners. The engine will then not post any remove stream events, and the <code class="literal">oldEvents</code> parameter is always a null value.
			</p><p>
				By specifying the <code class="literal">irstream</code> keyword you can instruct the engine to post both insert stream and remove stream events.
			</p><p>
				By specifying the <code class="literal">rstream</code> keyword you can instruct the engine to only post remove stream events via the <code class="literal">newEvents</code> parameter to the <code class="literal">update</code> method on listeners. The engine will then not post any insert stream events, and the <code class="literal">oldEvents</code> parameter is also always a null value.
			</p><p>
				The following statement selects only the events that are leaving the 30 second time window.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select rstream * from StockTick#time(30 sec)</pre><p>
				The <code class="literal">istream</code> and <code class="literal">rstream</code> keywords in the <code class="literal">select</code> clause are matched by same-name keywords available in the <code class="literal">insert into</code> clause. While the keywords in the <code class="literal">select</code> clause control the event stream posted to listeners to the statement, the same keywords in the <code class="literal">insert into</code> clause specify the event stream that the engine makes available to other statements.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-syntax-prefix-propsandstream"/>5.3.8.Â Qualifying Property Names and Stream Names</h3></div></div></div><p>
				Property or column names can optionally be qualified by a stream name and the provider URI. The syntax is:
			</p><pre class="synopsis">[[<span class="emphasis"><em>provider_URI</em></span>.]<span class="emphasis"><em>stream_name</em></span>.]<span class="emphasis"><em>property_name</em></span></pre><p>
				The <span class="emphasis"><em>provider_URI</em></span> is the URI supplied to the <code class="literal">EPServiceProviderManager</code> class, or the string <code class="literal">default</code> for the default provider.
			</p><p>
				This example assumes the provider is the default provider:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select MyEvent.myProperty from MyEvent
// ... equivalent to ...
select default.MyEvent.myProperty from MyEvent</pre><p>
				Stream names can also be qualified by the provider URI. The syntax is:
			</p><pre class="synopsis">[<span class="emphasis"><em>provider_URI</em></span>.]<span class="emphasis"><em>stream_name</em></span></pre><p>
				The next example assumes a provider URI by name of <code class="literal">Processor</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select Processor.MyEvent.myProperty from Processor.MyEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-syntax-distinct"/>5.3.9.Â Select <code class="literal">Distinct</code></h3></div></div></div><p>
				The optional <code class="literal">distinct</code> keyword removes duplicate output events from output. The keyword must occur after the <code class="literal">select</code> keyword and after the optional <code class="literal">irstream</code> keyword.
			</p><p>
				The <code class="literal">distinct</code> keyword in your <code class="literal">select</code> instructs the engine to consolidate, at time of output, the output event(s) and remove output events with identical property values.
				Duplicate removal only takes place when two or more events are output together at any one time, therefore <code class="literal">distinct</code> is typically used with a batch data window, output rate limiting, on-demand queries, on-select or iterator pull API.
			</p><p>
				If two or more output event objects have same property values for all properties of the event, the <code class="literal">distinct</code> removes all but one duplicated event before outputting events to listeners. Indexed, nested and mapped properties
				are considered in the comparison, if present in the output event.				
			</p><p>
				The next example outputs sensor ids of temperature sensor events, but only every 10 seconds and only unique sensor id values during the 10 seconds:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select distinct sensorId from TemperatureSensorEvent output every 10 seconds</pre><p>
				Use <code class="literal">distinct</code> with wildcard (<code class="literal">*</code>) to remove duplicate output events considering all properties of an event.
			</p><p>
				This example statement outputs all distinct events either when 100 events arrive or when 10 seconds passed, whichever occurs first:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select distinct * from TemperatureSensorEvent#time_length_batch(10, 100)</pre><p>
				When selecting nested, indexed, mapped or dynamic properties in a <code class="literal">select</code> clause with <code class="literal">distinct</code>, it is relevant to know that the comparison uses hash code and the Java <code class="literal">equals</code> semantics.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-transposefunc"/>5.3.10.Â Transposing an Expression Result to a Stream</h3></div></div></div><p>
			   For transposing an instance of a Java object returned by an expression to a stream use the transpose function as described in <a class="xref" href="#functionreference-transpose" title="10.4.Â Select-Clause Transpose Function">SectionÂ 10.4, âSelect-Clause Transpose Functionâ</a>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-selecteventbean"/>5.3.11.Â Selecting EventBean Instead of Underlying Event</h3></div></div></div><p>
				By default, for certain select-clause expressions that output events or a collection of events,
				the engine outputs the underlying event objects. The term <span class="emphasis"><em>outputs</em></span> means the data passed to listeners, 
				subscribers and inserted-into into another stream via insert-into.			   
			</p><p>
				The select-clause expressions for which underlying event objects are output by default are:
			</p><div class="itemizedlist"><ul><li>
					Event Aggregation Functions (including extension API)
				</li><li>
					The <code class="literal">previous</code> family of single-row functions
				</li><li>
					Subselects that select events
				</li><li>
					Declared expressions and enumeration methods that operate on any of the above
				</li></ul></div><p>
				To have the engine output <code class="literal">EventBean</code> instance(s) instead, add <code class="literal">@eventbean</code>
				to the relevant expressions of the <code class="literal">select</code>-clause.
			</p><p>
				The sample EPL shown below outputs current data window contents as <code class="literal">EventBean</code> instances
				into the stream <code class="literal">OutStream</code>, thereby statements consuming the stream may operate on such instances:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into OutStream 
select prevwindow(s0) @eventbean as win 
from MyEvent#length(2) as s0</pre><p>
				The next EPL consumes the stream and selects the last event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select win.lastOf() from OutStream</pre><p>
				It is not necessary to use <code class="literal">@eventbean</code> if an event type by the same name (<code class="literal">OutStream</code> in the example) is already declared 
				and a property exist on the type by the same name (<code class="literal">win</code> in this example) and the type of the property is the event type (<code class="literal">MyEvent</code> in the example) 
				returned by the expression. This is further described in <a class="xref" href="#insert-into-reconcile" title="5.10.8.Â Select-Clause Expression and Inserted-Into Column Event Type">SectionÂ 5.10.8, âSelect-Clause Expression and Inserted-Into Column Event Typeâ</a>.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-from-clause"/>5.4.Â Specifying Event Streams: The <span class="emphasis"><em>From</em></span> Clause</h2></div></div></div><a id="d0e7192" class="indexterm"/><a id="d0e7197" class="indexterm"/><a id="d0e7200" class="indexterm"/><p>
			The <code class="literal">from</code> clause is required in all EPL statements. It specifies one or more event streams, named windows or tables. Each event stream, named window or table can optionally be given a name by means of the <code class="literal">as</code> keyword.
		</p><pre class="synopsis">from <span class="emphasis"><em>stream_def</em></span> [as <span class="emphasis"><em>name</em></span>] [unidirectional] [retain-union | retain-intersection] 
    [, <span class="emphasis"><em>stream_def</em></span> [as <span class="emphasis"><em>stream_name</em></span>]] [, ...]</pre><p>
			The event stream definition <span class="emphasis"><em>stream_def</em></span> as shown in the syntax above can consists of either a filter-based event stream definition or a pattern-based event stream definition. 
		</p><p>
			For joins and outer joins, specify two or more event streams. Joins and the <code class="literal">unidirectional</code> keyword are described in more detail in <a class="xref" href="#epl-join" title="5.12.Â Joining Event Streams">SectionÂ 5.12, âJoining Event Streamsâ</a>.
			Joins are handy when multiple streams or patterns can trigger output and outer joins can be used to union and connect streams via <code class="literal">or</code>.
		</p><p>
			Esper supports joins against relational databases for access to historical or reference data as explained in <a class="xref" href="#histdata_overview" title="5.13.Â Accessing Relational Data via SQL">SectionÂ 5.13, âAccessing Relational Data via SQLâ</a>. Esper can also join results returned by an arbitrary invocation, as discussed in <a class="xref" href="#joining_method" title="5.14.Â Accessing Non-Relational Data via Method, Script or UDF Invocation">SectionÂ 5.14, âAccessing Non-Relational Data via Method, Script or UDF Invocationâ</a>.
		</p><p>
			The <span class="emphasis"><em>stream_name</em></span> is an optional identifier assigned to the stream. The stream name can itself occur in any expression and provides access to the event itself from the named stream. Also, a stream name may be combined with a method name to invoke instance methods on events of that stream.
		</p><p>
			For all streams with the exception of historical sources your query may employ data windows as outlined below. The <code class="literal">retain-intersection</code> (the default) and <code class="literal">retain-union</code> keywords build a union or intersection of two or more data windows as described in <a class="xref" href="#epl-from-clause-view-multidatawindow" title="5.4.4.Â Multiple Data Windows">SectionÂ 5.4.4, âMultiple Data Windowsâ</a>.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-from-clause-filter"/>5.4.1.Â Filter-Based Event Streams</h3></div></div></div><p>
				The <span class="emphasis"><em>stream_def</em></span> syntax for a filter-based event stream is as below:
			</p><pre class="synopsis"><span class="emphasis"><em>event_stream_name</em></span> [(<span class="emphasis"><em>filter_criteria</em></span>)] [<span class="emphasis"><em>contained_selection</em></span>] [#<span class="emphasis"><em>window_spec</em></span>] [#<span class="emphasis"><em>window_spec</em></span>] [...]</pre><p>
			  The <span class="emphasis"><em>event_stream_name</em></span> is either the name of an event type or name of an event stream populated by an <code class="literal">insert into</code> statement 
			  or the name of a named window or table.
			</p><p>
			  The <span class="emphasis"><em>filter_criteria</em></span> is optional and consists of a list of expressions filtering the events of the event stream, within parenthesis after the event stream name.
			  Filter criteria cannot be specified for tables.
			</p><p>
			  The <span class="emphasis"><em>contained_selection</em></span> is optional and is for use with coarse-grained events that have properties that are themselves one or more events, see <a class="xref" href="#epl-containedeventselect" title="5.19.Â Contained-Event Selection">SectionÂ 5.19, âContained-Event Selectionâ</a> for the synopsis and examples.
			  Contained-event cannot be specified for tables.
			</p><p>
			  The <span class="emphasis"><em>window_spec</em></span> specify one or more data windows.
			  Data windows cannot be specified for named windows and tables. Instead of the <code class="literal">#</code> hash character the <code class="literal">.</code> dot character can also be used, however the dot character requires the data window namespace.
			</p><p>
				The following EPL statement shows event type, filter criteria and data windows combined in one statement. It selects all event properties for the last 100 events of IBM stock ticks for volume. In the example, the event type is the fully qualified Java class name <code class="literal">org.esper.example.StockTick</code>. The expression filters for events where the property <code class="literal">symbol</code> has a value of "IBM". This query specifies a length window and thus computes the total volume of the last 100 events.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(volume) from org.esper.example.StockTick(symbol='IBM')#length(100)</pre><p>
				Esper filters out events in an event stream as defined by filter criteria that are placed in parenthesis, before it sends events to the data window(s) (if any). Thus, compared to search conditions in a <code class="literal">where</code> clause, filter criteria remove unneeded events early. In the above example, events with a symbol other than IBM do not enter the length window.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-filter-event-type"/>5.4.1.1.Â Specifying an Event Type</h4></div></div></div><p>
					The simplest form of filter is a filter for events of a given type without any conditions on the event property values. This filter matches any event of that type regardless of the event's properties. The example below is such a filter. 
				 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from com.mypackage.myevents.RfidEvent</pre><p>
					Instead of the fully-qualified Java class name any other event name can be mapped via Configuration to a Java class, making the resulting statement more readable:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from RfidEvent</pre><p>
					 Interfaces and superclasses are also supported as event types. In the below example <code class="literal">IRfidReadable</code> is an interface class.
				 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from org.myorg.rfid.IRfidReadable</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-filter-criteria"/>5.4.1.2.Â Specifying Filter Criteria</h4></div></div></div><p>
					The filtering criteria to filter for events with certain event property values are placed within parenthesis after the event type name:
				 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from RfidEvent(category="Perishable")</pre><p>
					All expressions can be used in filters, including static methods that return a boolean value:
				 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from com.mycompany.RfidEvent(MyRFIDLib.isInRange(x, y) or (x &lt; 0 and y &lt; 0))</pre><p>
					Filter expressions can be separated via a single comma '<code class="literal">,</code>'. The comma represents a logical AND between filter expressions:
				 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from RfidEvent(zone=1, category=10)
...is equivalent to...
select * from RfidEvent(zone=1 and category=10)</pre><p>
					The engine analyzes the filter expressions and determines the filter indexes to use or to create. The following operators are the preferred means of filtering event streams, especially in the presence of a larger number of filters or statements. Please read <a class="xref" href="#processingmodel_indexes_filterindexes" title="2.18.2.Â Filter Indexes">SectionÂ 2.18.2, âFilter Indexesâ</a> for more information. The engine can translate the following operators, including combinations of these operators connected via <code class="literal">and</code> and <code class="literal">or</code>, into filter indexes:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							equals <code class="literal">=</code>
						</p></li><li><p>
							not equals <code class="literal">!=</code>
						</p></li><li><p>
							comparison operators <code class="literal">&lt; , &gt; , &gt;=, &lt;=</code>
						</p></li><li><p>
							ranges 
						</p><div class="itemizedlist"><ul compact="compact"><li><p>
									use the <code class="literal">between</code> keyword for a closed range where both endpoints are included
								</p></li><li><p>
									use the <code class="literal">in </code> keyword and round <code class="literal">()</code> or square brackets <code class="literal">[]</code> to control how endpoints are included
								</p></li><li><p>
									for inverted ranges use the <code class="literal">not</code> keyword and the <code class="literal">between</code> or <code class="literal">in</code> keywords
								</p></li></ul></div></li><li><p>
							list-of-values checks using the <code class="literal">in</code> keyword or the <code class="literal">not in </code> keywords followed by a comma-separated list of values
						</p></li><li><p>
							single-row functions that have been registered and are invoked via function name (see user-defined functions) and that either return a boolean value or that have their return value compared to a constant
						</p></li><li><p>
							the <code class="literal">and</code> and <code class="literal">or</code> logical operators
						</p></li></ul></div><p>
					At compile time the engine scans new filter expressions for sub-expressions that can be placed into filter indexes. Indexing filter values to match event properties of incoming events enables the engine to match incoming events faster, especially if your application creates a large number of statements or context partitions or requires many similar filters. The above list of operators represents the set of operators that the engine can best convert into filter index entries. The use of comma or logical <code class="literal">and</code> in filter expressions is fully equivalent. 
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-filter-ranges"/>5.4.1.3.Â Filtering Ranges</h4></div></div></div><p>
					Ranges come in the following 4 varieties. The use of round <code class="literal">()</code> 
					or square <code class="literal">[]</code> bracket dictates whether an endpoint is included or excluded. The low point and the high-point of the range are separated by the colon <code class="literal">:</code> character.
				 </p><div class="itemizedlist"><ul compact="compact"><li><p>
							Open ranges that contain neither endpoint <code class="literal">(low:high)</code>
						</p></li><li><p>
							Closed ranges that contain both endpoints <code class="literal">[low:high]</code>. The equivalent 'between' keyword also defines a closed range.
						</p></li><li><p>
							Half-open ranges that contain the low endpoint but not the high endpoint <code class="literal">[low:high)</code>
						</p></li><li><p>
							Half-closed ranges that contain the high endpoint but not the low endpoint <code class="literal">(low:high]</code>
						</p></li></ul></div><p>
					The next statement shows a filter specifying a range for <code class="literal">x</code> and <code class="literal">y</code> values of RFID events. The range includes both endpoints therefore uses <code class="literal">[]</code> hard brackets.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">mypackage.RfidEvent(x in [100:200], y in [0:100])</pre><p>
					The <code class="literal">between</code> keyword is equivalent for closed ranges. The same filter using the <code class="literal">between</code> keyword is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">mypackage.RfidEvent(x between 100 and 200, y between 0 and 50)</pre><p>
					The <code class="literal">not</code> keyword can be used to determine if a value falls outside a given range:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">mypackage.RfidEvent(x not in [0:100])</pre><p>
					The equivalent statement using the <code class="literal">between</code> keyword is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">mypackage.RfidEvent(x not between 0 and 100)</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-filter-in"/>5.4.1.4.Â Filtering Sets of Values</h4></div></div></div><p>
					The <code class="literal">in</code> keyword for filter criteria determines if a given value matches any value in a list of values.
				 </p><p>
					In this example you are interested in RFID events where the category matches any of the given values:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">mypackage.RfidEvent(category in ('Perishable', 'Container'))</pre><p>
					By using the <code class="literal">not in </code>keywords you can filter events with a property value that does not match any of the values in a list of values:
				 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">mypackage.RfidEvent(category not in ('Household', 'Electrical'))</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-filter-limitations"/>5.4.1.5.Â Filter Limitations</h4></div></div></div><p>
					The following restrictions apply to filter criteria:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							Range and comparison operators require the event property to be of a numeric or string type. 
						</p></li><li><p>
							Aggregation functions are not allowed within filter expressions.
						</p></li><li><p>
							The <code class="literal">prev</code> previous event function and the <code class="literal">prior</code> prior event function cannot be used in filter expressions.
						</p></li></ul></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-from-clause-patterns"/>5.4.2.Â Pattern-Based Event Streams</h3></div></div></div><p>
				Event pattern expressions can also be used to specify one or more event streams in an EPL statement.
				For pattern-based event streams, the event stream definition <span class="emphasis"><em>stream_def</em></span> consists of the keyword <code class="literal">pattern</code> and a pattern expression in brackets <code class="literal">[]</code>. The syntax for an event stream definition using a pattern expression is below. As in filter-based event streams you can specify data windows.
			</p><pre class="synopsis">pattern [<span class="emphasis"><em>pattern_expression</em></span>] [#<span class="emphasis"><em>window_spec</em></span>] [#<span class="emphasis"><em>window_spec</em></span>] [...]</pre><p>
				The next statement specifies an event stream that consists of both stock tick events and trade events. The example tags stock tick events with the name "tick" and trade events with the name "trade".
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern [every tick=StockTickEvent or every trade=TradeEvent]</pre><p>
				This statement generates an event every time the engine receives either one of the event types. The generated events resemble a map with "tick" and "trade" keys. For stock tick events, the "tick" key value is the underlying stock tick event, and the "trade" key value is a null value. For trade events, the "trade" key value is the underlying trade event, and the "tick" key value is a null value.
			</p><p>
				Lets further refine this statement adding a data window the gives us the last 30 seconds of either stock tick or trade events. Lets also select prices and a price total.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select tick.price as tickPrice, trade.price as tradePrice, 
       sum(tick.price) + sum(trade.price) as total
  from pattern [every tick=StockTickEvent or every trade=TradeEvent]#time(30 sec)</pre><p>
				Note that in the statement above <code class="literal">tickPrice</code> and <code class="literal">tradePrice</code> can each be null values depending on the event processed. Therefore, an aggregation function such as <code class="literal">sum(tick.price + trade.price))</code> would always return null values as either of the two price properties are always a null value for any event matching the pattern. Use the <code class="literal">coalesce</code> function to handle null values, for example: <code class="literal">sum(coalesce(tick.price, 0) + coalesce(trade.price, 0))</code>.
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
					When used with patterns, specifying a data window defines what pattern matches to retain in memory for the purpose of joins or for using the iterator API.
				</p><p>
					When used with patterns, specifying a data window does not limit pattern matches to events in the window. The <code class="literal">match_recognize</code> pattern matching however does limit matches to events retained by a data window.
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-from-clause-window-spec"/>5.4.3.Â Specifying Data Windows</h3></div></div></div><p>
				Data windows retain a subset of events. They provide an retain/expiry policy for events and the engine automatically removes events according to the retain/expiry policy. Data windows can be grouped and data windows can be intersected or unioned. See the section <a class="xref" href="#epl-views" title="ChapterÂ 13.Â EPL Reference: Data Windows">ChapterÂ 13, <i>EPL Reference: Data Windows</i></a> on the data windows available. Data windows can take parameters. Any expressions can be a parameter, with limitations.
			</p><p>
				The example statement below outputs a count per expressway for car location events (contains information about the location of a car on a highway) of the last 60 seconds:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select expressway, count(*) from CarLocEvent#time(60) 
group by expressway</pre><p>
				The next example declares <code class="literal">#groupwin</code> and a <code class="literal">#length</code> window to indicate that there is a separate length window per car id:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select cardId, expressway, direction, segment, count(*) 
from CarLocEvent#groupwin(carId)#length(4) 
group by carId, expressway, direction, segment</pre><p>
				The <code class="literal">#groupwin(carId)</code> groups car location events by car id. The <code class="literal">#length(4)</code> keeps a length window of the 4 last events, with one separate length window for each car id. 
				The example reports the number of events per car id and per expressway, direction and segment considering the last 4 events for each car id only. 
			</p><p>
				The special keep-all window keeps all events: It does not expire events and does not provide a remove stream, i.e. events are not removed from the keep-all window unless by means of <code class="literal">on-delete</code> or <code class="literal">on-merge</code> or fire-and-forget <code class="literal">delete</code>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-from-clause-view-multidatawindow"/>5.4.4.Â Multiple Data Windows</h3></div></div></div><p>
			   Data windows provide an expiry policy that indicates when to remove events from the data window, with the exception of the keep-all data window which has no expiry policy and the <code class="literal">#groupwin</code> grouped-window for allocating a new data window per group.
		   </p><p>
			   EPL allows the freedom to use multiple data windows onto a stream and thus combine expiry policies. Combining data windows into an intersection (the default) or a union can achieve a useful strategy for retaining events and expiring events that are no longer of interest. Named windows, tables and <code class="literal">on-merge</code> and <code class="literal">on-delete</code> provide an additional degree of freedom.
		   </p><p>
			   In order to combine two or more data windows there is no keyword required. The <span class="emphasis"><em>retain-intersection</em></span> keyword is the default and the <span class="emphasis"><em>retain-union</em></span> keyword may instead be provided for a stream.
		   </p><p>
				The concept of union and intersection come from Set mathematics. In the language of Set mathematics, two sets A and B can be "added" together: The intersection of A and B is the set of all things which are members of both A and B, i.e. the members two sets have "in common". The union of A and B is the set of all things which are members of either A or B. 
			</p><p>
			   Use the <span class="emphasis"><em>retain-intersection</em></span> (the default) keyword to retain an intersection of all events as defined by two or more data windows. All events removed from any of the intersected data windows are entered into the remove stream. This is the default behavior if neither retain keyword is specified.
		   </p><p>
			   Use the <span class="emphasis"><em>retain-union</em></span> keyword to retain a union of all events as defined by two or more data windows. Only events removed from all data windows are entered into the remove stream.
		   </p><p>
			   The next example statement totals the price of OrderEvent events in a union of the last 30 seconds and unique by product name:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(price) from OrderEvent#time(30 sec)#unique(productName) retain-union</pre><p>
			   In the above statement, all OrderEvent events that are either less then 30 seconds old or that are the last event for the product name are considered.
		   </p><p>
			   Here is an example statement totals the price of OrderEvent events in an intersection of the last 30 seconds and unique by product name:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(price) from OrderEvent#time(30 sec)#unique(productName) retain-intersection</pre><p>
			   In the above statement, only those OrderEvent events that are both less then 30 seconds old and are the last event for the product name are considered. The number of events that the engine retains is the number of unique events per product name in the last 30 seconds (and not the number of events in the last 30 seconds).
		   </p><p>
		     For an intersection the engine retains the minimal number of events representing that intersection. Thus when combining a time window of 30 seconds and a last-event window, for example, the number of events retained at any time is zero or one event (and not 30 seconds of events).
		   </p><p>
		     When combining a batch window into an intersection with another data window the combined data window gains batching semantics: Only when the batch criteria is fulfilled does the engine provide the batch of intersecting insert stream events. Multiple batch data windows may not be combined into an intersection.
		   </p><p>
		     The table below provides additional examples for data window intersections:
		   </p><div class="table"><a id="d0e7728"/><p class="title"><b>TableÂ 5.3.Â Intersection Data Window Examples</b></p><div class="table-contents"><table summary="Intersection Data Window Examples" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Example</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">#time(30)#firstunique(keys)</code></td><td>Retains 30 seconds of events unique per <code class="literal">keys</code> value (first event per value).</td></tr><tr><td><code class="literal">#firstlength(3)#firstunique(keys)</code></td><td>Retains the first 3 events that are also unique per <code class="literal">keys</code> value.</td></tr><tr><td><code class="literal">#time_batch(N seconds)#unique(keys)</code></td><td>Posts a batch every N seconds that contains the last of each unique event per <code class="literal">keys</code> value.</td></tr><tr><td><code class="literal">#time_batch(N seconds)#firstunique(keys)</code></td><td>Posts a batch every N seconds that contains the first of each unique event per <code class="literal">keys</code> value.</td></tr><tr><td><code class="literal">#length_batch(N)#unique(keys)</code></td><td>Posts a batch of unique events (last event per value) when N unique events per <code class="literal">keys</code> value are encountered.</td></tr><tr><td><code class="literal">#length_batch(N)#firstunique(keys)</code></td><td>Posts a batch of unique events (first event per value) when N unique events per <code class="literal">keys</code> value are encountered.</td></tr></tbody></table></div></div><br class="table-break"/><p>
			   For advanced users and for backward compatibility, it is possible to configure Esper to allow multiple data windows without either of the <code class="literal">retain</code> keywords, as described in <a class="xref" href="#config-engine-viewresources-multipolicy" title="15.4.15.3.Â Configuring Multi-Expiry Policy Defaults">SectionÂ 15.4.15.3, âConfiguring Multi-Expiry Policy Defaultsâ</a>.
		   </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-from-clause-stream-name"/>5.4.5.Â Using the Stream Name</h3></div></div></div><p>
				Your <code class="literal">from</code> clause may assign a name to each stream. This assigned stream name can serve any of the following purposes.
			</p><p>
				First, the stream name can be used to disambiguate property names. The <code class="literal">stream_name.property_name</code> syntax uniquely identifies which property to select if property names overlap between streams. Here is an example:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prod.productId, ord.productId from ProductEvent as prod, OrderEvent as ord</pre><p>
				Second, the stream name can be used with a wildcard (*) character to select events in a join, or assign new names to the streams in a join:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Select ProductEvent only
select prod.* from ProductEvent as prod, OrderEvent</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Assign column names 'product' and 'order' to each event
select prod.* as product, ord.* as order from ProductEvent as prod, OrderEvent as ord</pre><p>
				Further, the stream name by itself can occur in any expression: The engine passes the event itself to that expression. For example, the engine passes the ProductEvent and the OrderEvent to the user-defined function 'checkOrder':
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prod.productId, MyFunc.checkOrder(prod, ord) 
from ProductEvent as prod, OrderEvent as ord</pre><p>
				Last, you may invoke an instance method on each event of a stream, and pass parameters to the instance method as well. Instance method calls are allowed anywhere in an expression.
			</p><p>
				The next statement demonstrates this capability by invoking a method 'computeTotal' on OrderEvent events and a method 'getMultiplier' on ProductEvent events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select ord.computeTotal(prod.getMultiplier()) from ProductEvent as prod, OrderEvent as ord</pre><p>
				Instance methods may also be chained: Your EPL may invoke a method on the result returned by a method invocation.
			</p><p>
				Assume that your product event exposes a method <code class="literal">getZone</code> which returns a zone object. Assume that the Zone class declares a method <code class="literal">checkZone</code>.
				This example statement invokes a method chain:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prod.getZone().checkZone("zone 1") from ProductEvent as prod</pre><p>
				Use the backwards apostrophe ` (aka. back tick) character to escape stream names in the <code class="literal">from</code>-clause and in <code class="literal">on-</code>trigger statements (e.g. <code class="literal">from MyEvent as `order`...</code>).
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-where-clause"/>5.5.Â Specifying Search Conditions: The <span class="emphasis"><em>Where</em></span> Clause</h2></div></div></div><a id="d0e7862" class="indexterm"/><a id="d0e7865" class="indexterm"/><p>
			The <code class="literal">where</code> clause is an optional clause in EPL statements. Via the <code class="literal">where</code> clause event streams can be joined and correlated. 
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>
				For filtering events in order to remove unwanted events, use filters as part of the <code class="literal">from</code> clause as described in <a class="xref" href="#epl-from-clause-filter" title="5.4.1.Â Filter-Based Event Streams">SectionÂ 5.4.1, âFilter-Based Event Streamsâ</a> 
				or for patterns in <a class="xref" href="#pattern-filter" title="7.4.Â Filter Expressions in Patterns">SectionÂ 7.4, âFilter Expressions in Patternsâ</a>.
			</p><p>
				Place expressions that remove unwanted events into parenthesis right after the event type, like <code class="literal">... from OrderEvent(fraud.severity = 5 and amount &gt; 500) ...</code>. 
				There is related information at <a class="xref" href="#">???</a> and <a class="xref" href="#perf-tips-5" title="23.2.5.Â Prefer Stream-Level Filtering Over Where-Clause Filtering">SectionÂ 23.2.5, âPrefer Stream-Level Filtering Over Where-Clause Filteringâ</a>.
			</p></div><p>
			Any expression can be placed in the <code class="literal">where</code> clause. Typically you would use comparison operators <code class="literal">=, &lt; , &gt; , &gt;=, &lt;=, !=, &lt;&gt;, is null, is not null</code> and logical combinations via <code class="literal">and</code> and <code class="literal">or</code> for joining, correlating or comparing events. 
			The <code class="literal">where</code> clause introduces join conditions as outlined in <a class="xref" href="#epl-join" title="5.12.Â Joining Event Streams">SectionÂ 5.12, âJoining Event Streamsâ</a>.
		</p><p>
			Some examples are listed below.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">...where settlement.orderId = order.orderId</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">...where exists (select orderId from Settlement#time(1 min) where settlement.orderId = order.orderId)</pre><p>
			The following two EPL statements are equivalent since both queries filter events by the <code class="literal">amount</code> property value and both queries do not specify a data window. 
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// preferable: specify filter criteria with the "eventtype(...filters...)" notation
@name('first') select * from Withdrawal(amount &gt; 200)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// equivalent only when there is no data window
@name('second') select * from Withdrawal where amount &gt; 200</pre><p>
			You can control whether the engine rewrites the second query to the form of the first query. If you specify @Hint('disable_whereexpr_moveto_filter') you can instruct the engine to not move the <code class="literal">where</code>-clause expression into the filter.
        </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-grouping-aggregating"/>5.6.Â Aggregates and Grouping: The <span class="emphasis"><em>Group-By</em></span> Clause and the <span class="emphasis"><em>Having</em></span> Clause</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-grouping-aggregate-functions"/>5.6.1.Â Using Aggregate Functions</h3></div></div></div><p>
					The aggregate functions are further documented in <a class="xref" href="#epl-function-aggregation" title="10.2.Â Aggregation Functions">SectionÂ 10.2, âAggregation Functionsâ</a>. 
					You can use aggregate functions to calculate and summarize data from event properties.
				</p><p>
					For example, to find out the total price for all stock tick events in the last 30 seconds, type:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(price) from StockTickEvent#time(30 sec)</pre><p>
					Aggregation functions do not require the use of data windows. The examples herein specify data windows for the purpose of example.
					An alternative means to instruct the engine when to start and stop aggregating and on what level to aggregate is via context declarations.
				</p><p>
					For example, to find out the total price for all stock tick events since statement start, type:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(price) from StockTickEvent</pre><p>
					Here is the syntax for aggregate functions: 
				</p><pre class="synopsis"><span class="emphasis"><em>aggregate_function</em></span>( [all | distinct] <span class="emphasis"><em>expression</em></span> [,<span class="emphasis"><em>expression</em></span> [,...]] 
    [, group_by:<span class="emphasis"><em>local_group_by</em></span>] [, filter:<span class="emphasis"><em>filter_expression</em></span>] )</pre><p>
					You can apply aggregate functions to all events in an event stream window or to one or more groups of events (i.e. <code class="literal">group by</code>). From each set of events to which an aggregate function is applied, Esper generates a single value. 
				</p><p>
					<code class="literal">Expression</code> is usually an event property name. However it can also be a constant, function, or any combination of event property names, constants, 
					and functions connected by arithmetic operators.
				</p><p>
					You can provide a grouping dimension for each aggregation function by providing the optional <code class="literal">group_by</code> parameter as part of aggregation function parameters. 
					Please refer to <a class="xref" href="#epl-grouping-agglocal" title="5.6.4.Â Specifying Grouping for Each Aggregation Function">SectionÂ 5.6.4, âSpecifying Grouping for Each Aggregation Functionâ</a>.
				</p><p>
					You can provide a filter expression for each aggregation function by providing the optional <code class="literal">filter</code> parameter as part of aggregation function parameters. 
					Please refer to <a class="xref" href="#epl-grouping-aggfilter" title="5.6.5.Â Specifying a Filter Expression for Each Aggregation Function">SectionÂ 5.6.5, âSpecifying a Filter Expression for Each Aggregation Functionâ</a>.
				</p><p>
					For example, to find out the average price for all stock tick events in the last 30 seconds if the price was doubled:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select avg(price * 2) from StockTickEvent#time(30 seconds)</pre><p>
					You can use the optional keyword <code class="literal">distinct</code> with all aggregate functions to eliminate duplicate values before the aggregate function is applied. The optional 
					keyword <code class="literal">all</code> which performs the operation on all events is the default. 
				</p><p>
					You can use aggregation functions in a <code class="literal">select</code> clause and in a <code class="literal">having</code> clause. You cannot use aggregate functions in a <code class="literal">where</code> clause, but you can use the <code class="literal">where</code> clause to restrict the events to which the aggregate is applied. The next query computes the average and sum of the price of stock tick events for the symbol IBM only, for the last 10 stock tick events regardless of their symbol.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select 'IBM stats' as title, avg(price) as avgPrice, sum(price) as sumPrice
from StockTickEvent#length(10)
where symbol='IBM'</pre><p>
					In the above example the length window of 10 elements is not affected by the <code class="literal">where</code> clause, i.e. all events enter and leave the length window regardless of their symbol. If you only care about the last 10 IBM events, you need to add filter criteria as below.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select 'IBM stats' as title, avg(price) as avgPrice, sum(price) as sumPrice
from StockTickEvent(symbol='IBM')#length(10)
where symbol='IBM'</pre><p>
					You can use aggregate functions with any type of event property or expression, with the following exceptions:
				</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
							You can use <code class="literal">sum, avg, median, stddev, avedev</code> with numeric event properties only	
						</p></li></ol></div><p>
					Esper ignores any null values returned by the event property or expression on which the aggregate function is operating, except for the <code class="literal">count(*)</code> function, which counts null values as well. All aggregate functions return null if the data set contains no events, or if all events in the data set contain only null values for the aggregated expression.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-grouping-group-by"/>5.6.2.Â Organizing Statement Results into Groups: The <span class="emphasis"><em>Group-by</em></span> Clause</h3></div></div></div><a id="d0e8059" class="indexterm"/><a id="d0e8062" class="indexterm"/><p>
					The <code class="literal">group by</code> clause is optional in all EPL statements. The <code class="literal">group by</code> clause divides the output of an EPL statement into groups. You can group by one or more event property names, or by the result of computed expressions. When used with aggregate functions, <code class="literal">group by</code> retrieves the calculations in each subgroup. You can use <code class="literal">group by</code> without aggregate functions, but generally that can produce confusing results.
				</p><p>
					For example, the below statement returns the total price per symbol for all stock tick events in the last 30 seconds:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, sum(price) from StockTickEvent#time(30 sec) group by symbol</pre><p>
					The syntax of the <code class="literal">group by</code> clause is:
				</p><pre class="synopsis">group by <span class="emphasis"><em>aggregate_free_expression</em></span> [, <span class="emphasis"><em>aggregate_free_expression</em></span>] [, ...]</pre><p>
					Esper places the following restrictions on expressions in the <code class="literal">group by</code> clause:
				</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
							Expressions in the <code class="literal">group by</code> cannot contain aggregate functions.
						</p></li><li><p>
							When grouping an unbound stream, i.e. no data window is specified onto the stream providing groups, or when using output rate limiting with the ALL keyword, you should ensure your group-by expression does not return an unlimited number of values. If, for example, your group-by expression is a fine-grained timestamp, group state that accumulates for an unlimited number of groups potentially reduces available memory significantly.
							Use a @Hint as described below to instruct the engine when to discard group state.
						</p></li></ol></div><p>
					You can list more then one expression in the <code class="literal">group by</code> clause to nest groups. Once the sets are established with <code class="literal">group by</code> the aggregation
					functions are applied. This statement posts the median volume for all stock tick events in the last 30 seconds per symbol and tick data feed. Esper posts one event for each group to statement listeners:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, tickDataFeed, median(volume) 
from StockTickEvent#time(30 sec) 
group by symbol, tickDataFeed</pre><p>
					In the statement above the event properties in the <code class="literal">select</code> list (symbol, tickDataFeed) are also listed in the <code class="literal">group by</code> clause.
					The statement thus follows the SQL standard which prescribes that non-aggregated event properties in the <code class="literal">select</code> list must match the 
					<code class="literal">group by</code> columns.
				</p><p>
					Esper also supports statements in which one or more event properties in the <code class="literal">select</code> list are not listed in the <code class="literal">group by</code> clause.
					The statement below demonstrates this case. It calculates the standard deviation since statement start over stock ticks aggregating by symbol and posting for 
					each event the symbol, tickDataFeed and the standard deviation on price.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, tickDataFeed, stddev(price) from StockTickEvent group by symbol</pre><p>
					The above example still aggregates the <code class="literal">price</code> event property based on the <code class="literal">symbol</code>, but produces one event per incoming event, not one 
					event per group.
				</p><p>
					Additionally, Esper supports statements in which one or more event properties in the <code class="literal">group by</code> clause are not listed in the <code class="literal">select</code> list.
					This is an example that calculates the mean deviation per <code class="literal">symbol</code> and <code class="literal">tickDataFeed</code> and posts one event per group with <code class="literal">symbol</code> and mean deviation of price in the generated events. Since tickDataFeed is not in the posted results, this can potentially be confusing.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, avedev(price) 
from StockTickEvent#time(30 sec) 
group by symbol, tickDataFeed</pre><p>
					Expressions are also allowed in the <code class="literal">group by</code> list:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol * price, count(*) from StockTickEvent#time(30 sec) group by symbol * price</pre><p>
					If the <code class="literal">group by</code> expression resulted in a null value, the null value becomes its own group. All null values are aggregated into the same group. If you are using the <code class="literal">count(expression)</code> aggregate function which does not count null values, the count returns zero if only null values are encountered.								
				</p><p>
					You can use a <code class="literal">where</code> clause in a statement with <code class="literal">group by</code>. Events that do not satisfy the conditions in the <code class="literal">where</code> clause are eliminated before any grouping is done. For example, the statement below posts the number of stock ticks in the last 30 seconds with a volume larger then 100, posting one event per group (symbol).
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, count(*) from StockTickEvent#time(30 sec) where volume &gt; 100 group by symbol</pre><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-groupby-hints"/>5.6.2.1.Â Hints Pertaining to Group-By</h4></div></div></div><p>
						The Esper engine reclaims aggregation state agressively when it determines that a group has no data points, based on the data in the data windows. When your application data creates a large number of groups with a small or zero number of data points then performance may suffer as state is reclaimed and created anew. Esper provides the <code class="literal">@Hint('disable_reclaim_group')</code> hint that you can specify as part of an EPL statement text to avoid group reclaim.
					</p><p>
						When aggregating values over an unbound stream (i.e. no data window is specified onto the stream) and when your group-by expression returns an unlimited number of values, for example when a timestamp expression is used, 
						then please note the next hint.  
					</p><p>
						A sample statement that aggregates stock tick events by timestamp, assuming the event type offers a property by name <code class="literal">timestamp</code> that, reflects time in high resolution, for example arrival or system time:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Note the below statement could lead to an out-of-memory problem:
select symbol, sum(price) from StockTickEvent group by timestamp</pre><p>
						As the engine has no means of detecting when aggregation state (sums per symbol) can be discarded, you may use the following hints to control aggregation state lifetime.
					</p><p>
						The @Hint("<code class="literal">reclaim_group_aged=</code><span class="emphasis"><em>age_in_seconds</em></span>") hint instructs the engine to discard aggregation state that has not been 
						updated for <span class="emphasis"><em>age_in_seconds</em></span> seconds. 
					</p><p>
						The optional @Hint("<code class="literal">reclaim_group_freq=</code><span class="emphasis"><em>sweep_frequency_in_seconds</em></span>") can be used in addition to control the frequency at which the engine sweeps aggregation 
						state to determine aggregation state age and remove state that is older then <span class="emphasis"><em>age_in_seconds</em></span> seconds.
						If the hint is not specified, the frequency defaults to the same value as <span class="emphasis"><em>age_in_seconds</em></span>.
					</p><p>
						The updated sample statement with both hints:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Instruct engine to remove state older then 10 seconds and sweep every 5 seconds
@Hint('reclaim_group_aged=10,reclaim_group_freq=5')
select symbol, sum(price) from StockTickEvent group by timestamp</pre><p>
						Variables may also be used to provide values for <span class="emphasis"><em>age_in_seconds</em></span> and <span class="emphasis"><em>sweep_frequency_in_seconds</em></span>. 
					</p><p>
						This example statement uses a variable named <code class="literal">varAge</code> to control how long aggregation state remains in memory, and the engine defaults the sweep frequency to the same value as the variable provides:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Hint('reclaim_group_aged=varAge')
select symbol, sum(price) from StockTickEvent group by timestamp</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-grouping-rollup"/>5.6.3.Â Using Group-By with Rollup, Cube and Grouping Sets</h3></div></div></div><p>
				 EPL supports the SQL-standard <code class="literal">rollup</code>, <code class="literal">cube</code> and <code class="literal">grouping sets</code> keywords. These keywords are available only in the <code class="literal">group-by</code> clause and instruct the engine to compute higher-level (or super-aggregate) aggregation values, i.e. to perform multiple levels of analysis (groupings) at the same time.
			 </p><p>
				 EPL also supports the SQL-standard <code class="literal">grouping</code> and <code class="literal">grouping_id</code> functions. These functions can be used in the <code class="literal">select</code>-clause, <code class="literal">having</code>-clause or <code class="literal">order by</code>-clause to obtain information about the current row's grouping level in expressions. Please see <a class="xref" href="#epl-single-row-function-grouping" title="10.1.7.Â The Grouping Function">SectionÂ 10.1.7, âThe Grouping Functionâ</a>.
			 </p><p>
				Detailed examples and information in respect to output rate limiting can be found in <a class="xref" href="#outputspec-groupedrowpergrouprollup" title="A.7.Â Output for Fully-Aggregated, Grouped Queries With Rollup">SectionÂ A.7, âOutput for Fully-Aggregated, Grouped Queries With Rollupâ</a>.
			</p><p>
			     Use the <code class="literal">rollup</code> keyword in the <code class="literal">group-by</code> lists of expressions to compute the equivalent of an OLAP dimension or hierarchy. 
			 </p><p>
				 For example, the following statement outputs for each incoming event three rows. The first row contains the total volume per symbol and feed, the second row contains the total volume per symbol and the third row contains the total volume overall. This example aggregates across all events for each aggregation level (3 groupings) since it declares no data window:
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, tickDataFeed, sum(volume) from StockTickEvent
group by rollup(symbol, tickDataFeed)</pre><p>
				The value of <code class="literal">tickDataFeed</code> is <code class="literal">null</code> for the output row that contains the total per symbol and the output row that contains the total volume overall. 
				The value of both <code class="literal">symbol</code> and <code class="literal">tickDataFeed</code> is <code class="literal">null</code> for the output row that contains the overall total.
			</p><p>
			     Use the <code class="literal">cube</code> keyword in the <code class="literal">group-by</code> lists of expressions to compute a cross-tabulation. 
			 </p><p>
				 The following statement outputs for each incoming event four rows. The first row contains the total volume per symbol and feed, the second row contains the total volume per symbol, the third row contains the total volume per feed and the forth row contains the total volume overall (4 groupings):
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, tickDataFeed, sum(volume) from StockTickEvent
group by cube(symbol, tickDataFeed)</pre><p>
				The <code class="literal">grouping sets</code> keywords allows you to specify only the groupings you want. It can thus be used to generate the same groupings that simple <code class="literal">group-by</code> expressions, <code class="literal">rollup</code> or <code class="literal">cube</code> would produce.
			</p><p>
				 In this example each incoming event causes the engine to compute two output rows: The first row contains the total volume per symbol and the second row contains the total volume per feed (2 groupings):
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, tickDataFeed, sum(volume) from StockTickEvent
group by grouping sets(symbol, feed)</pre><p>
				Your <code class="literal">group-by</code> expression can list grouping expressions and use <code class="literal">rollup</code>, <code class="literal">cube</code> and <code class="literal">grouping sets</code> keywords in addition or in combination.
			</p><p>
				 This statement outputs the total per combination of symbol and feed and the total per symbol (2 groupings):
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, tickDataFeed, sum(volume) from StockTickEvent
group by symbol, rollup(tickDataFeed)</pre><p>
				You can specify combinations of expressions by using parenthesis.
			</p><p>
				 The next statement is equivalent and also outputs the total per symbol and feed and the total per symbol (2 groupings, note the parenthesis):
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, tickDataFeed, sum(volume) from StockTickEvent
group by grouping sets ((symbol, tickDataFeed), symbol)</pre><p>
				 Use empty parenthesis to aggregate across all dimensions.
			 </p><p>
				 This statement outputs the total per symbol, the total per feed and the total overall (3 groupings):
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, tickDataFeed, sum(volume) from StockTickEvent
group by grouping sets (symbol, tickDataFeed, ())</pre><p>
				The order of any output events for both insert and remove stream data is well-defined and exactly as indicated before. For example, specifying <code class="literal">grouping sets ((), symbol, tickDataFeed)</code> outputs a total overall, a total by symbol and a total by feed in that order. If the statement has an <code class="literal">order-by</code>-clause then the ordering criteria of the <code class="literal">order-by</code>-clause take precedence. 
			</p><p>
				You can use <code class="literal">rollup</code> and <code class="literal">cube</code> within <code class="literal">grouping sets</code>.
			</p><p>
				 This statement outputs the total per symbol and feed, the total per symbol, the total overall and the total by feed (4 groupings):
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, tickDataFeed, sum(volume) from StockTickEvent
group by grouping sets (rollup(symbol, tickDataFeed), tickDataFeed)</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
					 In order to use any of the  <code class="literal">rollup</code>, <code class="literal">cube</code> and <code class="literal">grouping sets</code> keywords the statement must be fully-aggregated.
					 All non-aggregated properties in the <code class="literal">select</code>-clause, <code class="literal">having</code>-clause or <code class="literal">order-by</code>-clause must also be listed in the <code class="literal">group by</code> clause.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-grouping-rollup-examples"/>5.6.3.1.Â Grouping Dimension Examples</h4></div></div></div><p>
					 This section provides additional examples of <code class="literal">group-by</code>-clauses and groupings or dimensions. 
					 The examples use event properties <code class="literal">a, b, c, d, e</code> to keep the examples easy to read.
					 Empty parenthesis <code class="literal">()</code> stand for aggregation overall (across all dimensions).
				 </p><p>
					 If a statement provides no <code class="literal">order-by</code> clause, its order of output events is exactly as indicated below. Otherwise <code class="literal">order-by</code> takes precedence
					 and within the same ordering criteria the order of output events is as indicated below.
				 </p><div class="table"><a id="d0e8464"/><p class="title"><b>TableÂ 5.4.Â </b></p><div class="table-contents"><table summary="" border="1"><colgroup><col/><col/></colgroup><thead><tr><th><code class="literal">Group-By</code> Clause</th><th>Grouping</th></tr></thead><tbody><tr><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">group by a, b, c</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">a, b, c</pre></td></tr><tr><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">group by rollup(a, b, c)</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">a, b, c
a, b
a
()</pre></td></tr><tr><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">group by a, rollup(b, c)</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">a, b, c
a, b
a</pre></td></tr><tr><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">group by rollup(a, b), rollup(c, d)</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">a,b,c,d
a,b,c
a,b
a,c,d
a,c
a
c,d
c
()</pre></td></tr><tr><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">group by cube(a, b, c)</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">a, b, c
a, b
a, c
a
b, c
b
c
()</pre></td></tr><tr><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">group by cube(a, b, c, d)</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">a,b,c,d
a,b,c
a,b,d
a,b
a,c,d
a,c
a,d
a
b,c,d
b,c
b,d
b
c,d
c
d
()</pre></td></tr><tr><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">group by grouping sets(a, b, c)</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">a
b
c</pre></td></tr><tr><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">group by grouping sets((a, b), rollup(c, d))</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">a,b
c,d
c
()</pre></td></tr></tbody></table></div></div><br class="table-break"/><p>
					The following table outlines sample equivalent <code class="literal">group-by</code>-clauses.
				</p><div class="table"><a id="d0e8539"/><p class="title"><b>TableÂ 5.5.Â Equivalent <code class="literal">Group-By</code>-Clause Expressions</b></p><div class="table-contents"><table summary="Equivalent Group-By-Clause Expressions" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Expression</th><th>Equivalent</th></tr></thead><tbody><tr><td>group by a, b</td><td>group by grouping sets((a, b))</td></tr><tr><td>group by rollup(a, b)</td><td>group by grouping sets((a, b), a, ())</td></tr><tr><td>group by cube(a, b)</td><td>group by grouping sets((a, b), a, b, ())</td></tr><tr><td>group by a, b, rollup(c, d)</td><td>group by grouping sets((a, b, c, d), (a, b, c), (a, b))</td></tr><tr><td>group by rollup((a, b), c)</td><td>group by grouping sets((a, b, c), (a, b), ())</td></tr><tr><td>group by grouping sets((a))</td><td>group by grouping sets(a)</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-grouping-rollup-other"/>5.6.3.2.Â Rollup Usage Notes</h4></div></div></div><p>
					 The <code class="literal">prev</code> and <code class="literal">prior</code> functions returns the previous event's property values and since they are not aggregation functions
					 return the same value for each grouping. Declared or alias expressions and correlated subqueries also receive the same value for each grouping.
				 </p><p>
					 Context partitions operate on a higher level then rollups, i.e. rollups are never across context partitions.
				 </p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-grouping-agglocal"/>5.6.4.Â Specifying Grouping for Each Aggregation Function</h3></div></div></div><p>
				EPL allows each aggregation function to specify its own grouping criteria. This is useful for aggregating across multiple dimensions.
			 </p><p>
				The syntax for the <code class="literal">group_by</code> parameter for use with aggregation functions is: 
			</p><pre class="synopsis">group_by: ( [<span class="emphasis"><em>expression</em></span> [,<span class="emphasis"><em>expression</em></span> [,...]]] )</pre><p>
				 The <code class="literal">group_by</code> identifier can occur at any place within the aggregation function parameters. It follows a colon and within parenthesis an 
				 optional list of grouping expressions. The parenthesis are not required when providing a single expression. 
				 For grouping on the top level (overall aggregation) please use <code class="literal">()</code> empty parenthesis.
			</p><p>
				The presence of <code class="literal">group_by</code> aggregation function parameters, the grouping expressions as well as the <code class="literal">group-by</code> clause 
				determine the number of output rows for queries as further described in <a class="xref" href="#">???</a>.
			</p><p>
				For un-grouped queries (without a <code class="literal">group by </code> clause), if any aggregation function specifies a <code class="literal">group_by</code> other than the <code class="literal">()</code> overall group, the query executes
				as aggregated and un-grouped.
			</p><p>
			  For example, the next statement is an aggregated (but not fully aggregated) and ungrouped query and outputs various totals for each arriving event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(price, group_by:()) as totalPriceOverall,
  sum(price, group_by:account) as totalPricePerAccount,
  sum(price, group_by:(account, feed)) as totalPricePerAccountAndFeed
from Orders</pre><p>
				For grouped queries (with a <code class="literal">group by </code> clause), if all aggregation functions specifiy either no <code class="literal">group_by</code> or <code class="literal">group_by</code> criteria that subsume the criteria in the <code class="literal">group by</code> clause, the query executes as a fully-aggregated and grouped query. Otherwise the query executes as an aggregated and grouped query.
			</p><p>
			  The next example is fully-aggregated and grouped and it computes, for the last one minute of orders, the ratio of orders per account compared to all orders:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*)/count(*, group_by:()) as ratio
from Orders#time(1 min) group by account</pre><p>
			  The next example is an aggregated (and not fully-aggregated) and grouped query that in addition outputs a count per order category:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*) as cnt, count(*, group_by:()) as cntOverall,  count(*, group_by:(category))  as cntPerCategory
from Orders#time(1 min) group by account</pre><p>
				Please note the following restrictions:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						Expressions in the <code class="literal">group_by</code> cannot contain aggregate functions.
					</p></li><li><p>
						Hints pertaining to group-by are not available when a statement specifies aggregation functions with <code class="literal">group_by</code>.
					</p></li><li><p>
						The <code class="literal">group_by</code> aggregation function parameters are not available in subqueries, match-recognize, statements that aggregate into tables using <code class="literal">into table</code> or in combination with <code class="literal">rollup</code> and <code class="literal">grouping sets</code>.
					</p></li></ol></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-grouping-aggfilter"/>5.6.5.Â Specifying a Filter Expression for Each Aggregation Function</h3></div></div></div><p>
				EPL allows each aggregation function to specify its own filter expression. This is useful for conditionally aggregating.
			 </p><p>
				The syntax for the <code class="literal">filter</code> parameter for use with aggregation functions is: 
			</p><pre class="synopsis">filter:<span class="emphasis"><em>expression</em></span></pre><p>
				 The <code class="literal">filter</code> identifier can occur at any place within the aggregation function parameters. It follows a colon and the filter expression.
				 The filter expression must return a <code class="literal">boolean</code>-type value.
			</p><p>
				If a filter expression is present, the engine evaluates the filter expression to determine whether to update the aggregation.
			</p><p>
			  For example, the next statement returns the total price of small orders (price less 100), the total price of large orders (price &gt;= 100), as well as the events themselves of each category, considering the last 10 seconds of orders:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select 
  sum(price, filter: price &lt; 100) as smallOrderTotal, 
  sum(price, filter: price &gt;= 100) as largeOrderTotal, 
  window(*, filter: price &lt; 100) as smallOrderEvents, 
  window(*, filter: price &gt;= 100) as largeOrderEvents
    from Orders#time(10)</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
					Filter expression that are parameters to aggregation functions must return reproducible results:  
					When the expression is evaluated against the same input values it should return the same result.
					Aggregation functions and subqueries are not allowed therein.
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-grouping-having"/>5.6.6.Â Selecting Groups of Events: The <span class="emphasis"><em>Having</em></span> Clause</h3></div></div></div><a id="d0e8738" class="indexterm"/><a id="d0e8741" class="indexterm"/><p>
					Use the <code class="literal">having</code> clause to pass or reject events defined by the <code class="literal">group-by</code> clause. The <code class="literal">having</code> clause sets conditions for the <code class="literal">group by</code> clause in the same way <code class="literal">where</code> sets conditions for the <code class="literal">select</code> clause, except <code class="literal">where</code> cannot include aggregate functions, while <code class="literal">having</code> often does.
				</p><p>
					This statement is an example of a <code class="literal">having</code> clause with an aggregate function. It posts the total price per symbol for the last 30 seconds of stock tick events for only those symbols in which the total price exceeds 1000. The <code class="literal">having</code> clause eliminates all symbols where the total price is equal or less then 1000.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, sum(price) 
from StockTickEvent#time(30 sec) 
group by symbol 
having sum(price) &gt; 1000</pre><p>
					To include more then one condition in the <code class="literal">having</code> clause combine the conditions with <code class="literal">and</code>, <code class="literal">or</code> or <code class="literal">not</code>.
					This is shown in the statement below which selects only groups with a total price greater then 1000 and an average volume less then 500.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, sum(price), avg(volume)
from StockTickEvent#time(30 sec) 
group by symbol 
having sum(price) &gt; 1000 and avg(volume) &lt; 500</pre><p>
					A statement with the <code class="literal">having</code> clause should also have a <code class="literal">group by</code> clause. If you omit <code class="literal">group-by</code>, all the events not excluded
					by the <code class="literal">where</code> clause return as a single group. In that case <code class="literal">having</code> acts like a <code class="literal">where</code> except that <code class="literal">having</code> can have aggregate functions. 
				</p><p>
					The <code class="literal">having</code> clause can also be used without <code class="literal">group by</code> clause as the below example shows. The example below posts events where the price is less then the current running average price of all stock tick events in the last 30 seconds.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, price, avg(price) 
from StockTickEvent#time(30 sec) 
having price &lt; avg(price)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-filter-where-grouping-having-interactions"/>5.6.7.Â How the Stream Filter, <span class="emphasis"><em>Where</em></span>, <span class="emphasis"><em>Group By</em></span> and <span class="emphasis"><em>Having</em></span>-Clauses Interact</h3></div></div></div><p>
					When you include filters, the <code class="literal">where</code> condition, the <code class="literal">group by</code> clause and the <code class="literal">having</code> condition in an EPL statement
					the sequence in which each clause affects events determines the final result:
				</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
							The event stream's filter condition, if present, dictates which events enter a window (if one is used). The filter discards any events not meeting filter criteria.
						</p></li><li><p>
							The <code class="literal">where</code> clause excludes events that do not meet its search condition.
						</p></li><li><p>
							Aggregate functions in the select list calculate summary values for each group.
						</p></li><li><p>
							The <code class="literal">having</code> clause excludes events from the final results that do not meet its search condition.
						</p></li></ol></div><p>
					The following query illustrates the use of filter, <code class="literal">where</code>, <code class="literal">group by</code> and <code class="literal">having</code> clauses in one statement with 
					a <code class="literal">select</code> clause containing an aggregate function.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select tickDataFeed, stddev(price)
from StockTickEvent(symbol='IBM')#length(10) 
where volume &gt; 1000
group by tickDataFeed 
having stddev(price) &gt; 0.8</pre><p>
					Esper filters events using the filter criteria for the event stream <code class="literal">StockTickEvent</code>. In the example above only events with symbol IBM enter the length window over the last 10 events, all other events are simply discarded. The <code class="literal">where</code> clause removes any events posted by the length window (events entering the window and event leaving the window) that do not match the condition of volume greater then 1000. Remaining events are applied to the <code class="literal">stddev</code> standard deviation aggregate function for each tick data feed as specified in the <code class="literal">group by</code> clause. Each <code class="literal">tickDataFeed</code> value generates one event. Esper applies the <code class="literal">having</code> clause and only lets events pass for <code class="literal">tickDataFeed</code> groups with a standard deviation of price greater then 0.8.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-group-by-versus-view"/>5.6.8.Â Comparing Keyed Segmented Context, the <span class="emphasis"><em>Group By</em></span> Clause and <span class="emphasis"><em>#groupwin</em></span> for Data Windows</h3></div></div></div><p>
				The keyed segmented context <span class="emphasis"><em>create context ... partition by</em></span> and the <span class="emphasis"><em>group by</em></span> clause as well as the built-in <span class="emphasis"><em>#groupwin</em></span> are similar in their ability to group events but very different in their semantics. This section explains the key differences in their behavior and use.
			</p><p>
				The keyed segmented context as declared with <span class="emphasis"><em>create context ... partition by</em></span> and <span class="emphasis"><em>context .... select ...</em></span> creates a new context partition per key value(s). The engine maintains separate data windows as well as separate aggregations per context partition; thereby the keyed segmented context applies to both. See <a class="xref" href="#context_def_keyed" title="4.2.2.Â Keyed Segmented Context">SectionÂ 4.2.2, âKeyed Segmented Contextâ</a> for additional examples.
			</p><p>
				The <span class="emphasis"><em>group by</em></span> clause works together with aggregation functions in your statement to produce an aggregation result per group. In greater detail, this means that when a new event arrives, the engine applies the expressions in the <span class="emphasis"><em>group by</em></span> clause to determine a grouping key. If the engine has not encountered that grouping key before (a new group), the engine creates a set of new aggregation results for that grouping key and performs the aggregation changing that new set of aggregation results. If the grouping key points to an existing set of prior aggregation results (an existing group), the engine performs the aggregation changing the prior set of aggregation results for that group.
			</p><p>
				The <span class="emphasis"><em>#groupwin</em></span> instructs the system to have a separate data window per group, see <a class="xref" href="#view-std-groupwin" title="13.3.15.Â Grouped Data Window (groupwin or std:groupwin)">SectionÂ 13.3.15, âGrouped Data Window (groupwin or std:groupwin)â</a>. It causes allocation of separate data window(s) for each grouping key encountered.
			</p><p>
				The table below summarizes the point:
			</p><div class="table"><a id="d0e8959"/><p class="title"><b>TableÂ 5.6.Â Grouping Options</b></p><div class="table-contents"><table summary="Grouping Options" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Option</th><th>Description</th></tr></thead><tbody><tr><td>Keyed Segmented Context</td><td>
							  <p>
							    Separate context partition per key value.
							  </p>
							  <p>
							    Affects all of data windows, aggregations, patterns, etc. (except variables which are global).
							  </p>
							</td></tr><tr><td>Grouped Data Window (<span class="emphasis"><em>#groupwin</em></span>)</td><td>
							  <p>
							    Separate data window per key value.
							  </p>
							  <p>
							    Affects only the data window that is declared next to it.
							  </p>
							</td></tr><tr><td>Group By Clause (<span class="emphasis"><em>group by</em></span>)</td><td>
							  <p>
							    Separate aggregation values per key value.
							  </p>
							  <p>
							    Affects only aggregation values.
							  </p>
							</td></tr></tbody></table></div></div><br class="table-break"/><p>
			  Please review the performance section for advice related to performance or memory-use.
			</p><p>
				The next example shows queries that produce equivalent results. The query using the <span class="emphasis"><em>group by</em></span> clause is generally preferable as is easier to read. The second form introduces the <code class="literal">#uni</code> special data window which computes univariate statistics for a given property:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, avg(price) from StockTickEvent group by symbol
// ... is equivalent to ...
select symbol, average from StockTickEvent#groupwin(symbol)#uni(price)</pre><p>
				The next example shows two queries that are NOT equivalent as the length window is ungrouped in the first query, and grouped in the second query:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, sum(price) from StockTickEvent#length(10) group by symbol
// ... NOT equivalent to ...
select symbol, sum(price) from StockTickEvent#groupwin(symbol)#length(10)</pre><p>
				The key difference between the two statements is that in the first statement the length window is ungrouped and applies to all events regardless of group. While in the second query each group gets its own length window. For example, in the second query events arriving for symbol "ABC" get a length window of 10 events, and events arriving for symbol "DEF" get their own length window of 10 events. 
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-output-rate"/>5.7.Â Stabilizing and Controlling Output: The <span class="emphasis"><em>Output</em></span> Clause</h2></div></div></div><a id="d0e9035" class="indexterm"/><a id="d0e9038" class="indexterm"/><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-output-options"/>5.7.1.Â Output Clause Options</h3></div></div></div><p>
					The <code class="literal">output</code> clause is optional in Esper and is used to control or stabilize the rate at which events are output and to suppress output events. The EPL language provides for several different ways to control output rate.
				</p><p>
					Here is the syntax for the <code class="literal">output</code> clause that specifies a rate in time interval or number of events:
				</p><pre class="synopsis">output [after <span class="emphasis"><em>suppression_def</em></span>] 
  [[all | first | last | snapshot] every <span class="emphasis"><em>output_rate</em></span> [seconds | events]]
[and when terminated]</pre><p>
					An alternate syntax specifies the time period between output as outlined in <a class="xref" href="#epl-syntax-time-periods" title="5.2.1.Â Specifying Time Periods">SectionÂ 5.2.1, âSpecifying Time Periodsâ</a> :
				</p><pre class="synopsis">output [after <span class="emphasis"><em>suppression_def</em></span>] 
  [[all | first | last | snapshot] every <span class="emphasis"><em>time_period</em></span>]
[and when terminated]</pre><p>
					A crontab-like schedule can also be specified. The schedule parameters follow the pattern observer parameters and are further described in <a class="xref" href="#pattern-timer-at" title="7.6.4.Â Crontab (timer:at)">SectionÂ 7.6.4, âCrontab (timer:at)â</a> :
				</p><pre class="synopsis">output [after <span class="emphasis"><em>suppression_def</em></span>] 
  [[all | first | last | snapshot] at 
   (<span class="emphasis"><em>minutes, hours, days of month, months, days of week [, seconds]</em></span>)]
[and when terminated]</pre><p>
					For use with contexts, in order to trigger output only when a context partition terminates, specify <code class="literal">when terminated</code> as further described in <a class="xref" href="#context_outputterminated" title="4.5.Â Output When a Context Partition Ends or Terminates">SectionÂ 4.5, âOutput When a Context Partition Ends or Terminatesâ</a>:
				</p><pre class="synopsis">output [after <span class="emphasis"><em>suppression_def</em></span>] 
  [[all | first | last | snapshot] when terminated 
  [and <span class="emphasis"><em>termination_expression</em></span>]
  [then set variable_name = assign_expression [, variable_name = assign_expression [,...]]]
  ]</pre><p>
					Last, output can be controlled by an expression that may contain variables, user-defined functions and information about the number of collected events. Output that is controlled by an expression is discussed in detail below.
				</p><p>
					The <code class="literal">after</code> keyword and <span class="emphasis"><em>suppression_def</em></span> can appear alone or together with further output conditions and suppresses output events.
				</p><p>
					For example, the following statement outputs, every 60 seconds, the total price for all orders in the 30-minute time window:		
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(price) from OrderEvent#time(30 min) output snapshot every 60 seconds</pre><p>
					The <code class="literal">all</code> keyword is the default and specifies that all events in a batch should be output, each incoming row in the batch producing an output row.
					Note that for statements that group via the <code class="literal">group by</code> clause, the <code class="literal">all</code> keyword provides special behavior as below.
				</p><p>
					The <code class="literal">first</code> keyword specifies that only the first event in an output batch is to be output.
					Using the <code class="literal">first</code> keyword instructs the engine to output the first matching event as soon as it arrives, and then ignores matching events for the time interval or number of events specified. 
					After the time interval elapsed, or the number of matching events has been reached, the next first matching event is output again and the following interval the engine again ignores matching events.
					For statements that group via the <code class="literal">group by</code> clause, the <code class="literal">first</code> keywords provides special behavior as below.
				</p><p>
					The <code class="literal">last</code> keyword specifies to only output the last event at the end of the given time interval or after the given number of matching events
					have been accumulated. Again, for statements that group via the <code class="literal">group by</code> clause the <code class="literal">last</code> keyword provides special behavior as below.
				</p><p>
					The <code class="literal">snapshot</code> keyword is often used with unbound streams and/or aggregation to output current aggregation results. While the other keywords control how a batch of events between output intervals is being considered, the <code class="literal">snapshot</code> keyword outputs current state of a statement independent of the last batch. Its output is comparable to the <code class="literal">iterator</code> method provided by a statement. More information on <code class="literal">output snapshot</code> can be found in <a class="xref" href="#epl-output-snapshot" title="5.7.1.3.Â Output Snapshot">SectionÂ 5.7.1.3, âOutput Snapshotâ</a>.
				</p><p>
					The <span class="emphasis"><em>output_rate</em></span> is the frequency at which the engine outputs events. It can be specified in terms of time or number of events. The value can be a number to denote a fixed output rate, or the name of a variable whose value is the output rate. By means of a variable the output rate can be controlled externally and changed dynamically at runtime. 
				</p><p>
					Please consult the <a class="xref" href="#appendix_outputspec" title="AppendixÂ A.Â Output Reference and Samples">AppendixÂ A, <i>Output Reference and Samples</i></a> for detailed information on insert and remove stream output for the various <code class="literal">output</code> clause keywords.
				</p><p>
				  For use with contexts you may append the keywords <code class="literal">and when terminated</code> to trigger output at the rate defined and in addition trigger output when the context partition terminates. Please see <a class="xref" href="#context_outputterminated" title="4.5.Â Output When a Context Partition Ends or Terminates">SectionÂ 4.5, âOutput When a Context Partition Ends or Terminatesâ</a> for details.
				</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
						Please see <a class="xref" href="#appendix_outputlimit" title="AppendixÂ B.Â Runtime Considerations for Output Rate Limiting">AppendixÂ B, <i>Runtime Considerations for Output Rate Limiting</i></a> for information on how the system retains input events and computes output events according to the specified output rate.
					</p></div><p>
					The time interval can also be specified in terms of minutes; the following statement is identical to the first one.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent output every 1.5 minutes</pre><p>
					A second way that output can be stabilized is by batching events until a certain number of events have been collected:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent output every 5 events</pre><p>
					Additionally, event output can be further modified by the optional <code class="literal">last</code> keyword, which causes output of only the last event to arrive into an output batch.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent output last every 5 events</pre><p>
					Using the <code class="literal">first</code> keyword you can be notified at the start of the interval. The allows to watch for situations such as a rate falling below a threshold
					and only be informed every now and again after the specified output interval, but be informed the moment it first happens. 
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TickRate where rate&lt;100 output first every 60 seconds</pre><p>
					A sample statement using the Unix "crontab"-command schedule is shown next. See <a class="xref" href="#pattern-timer-at" title="7.6.4.Â Crontab (timer:at)">SectionÂ 7.6.4, âCrontab (timer:at)â</a> for details on schedule syntax. Here, output occurs every 15 minutes from 8am to 5:45pm (hours 8 to 17 at 0, 15, 30 and 45 minutes past the hour):
				</p><pre class="synopsis">select symbol, sum(price) from StockTickEvent group by symbol output at (*/15, 8:17, *, *, *)</pre><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-output-expression"/>5.7.1.1.Â Controlling Output Using an Expression</h4></div></div></div><a id="d0e9224" class="indexterm"/><p>
						Output can also be controlled by an expression that may check variable values, use user-defined functions and query built-in properties that provide additional information. The synopsis is as follows:
					</p><pre class="synopsis">output [after <span class="emphasis"><em>suppression_def</em></span>] 
  [[all | first | last | snapshot] when <span class="emphasis"><em>trigger_expression</em></span> 
    [then set <span class="emphasis"><em>variable_name</em></span> = <span class="emphasis"><em>assign_expression</em></span> [, <span class="emphasis"><em>variable_name</em></span> = <span class="emphasis"><em>assign_expression</em></span> [,...]]]
  [and when terminated 
    [and <span class="emphasis"><em>termination_expression</em></span>]
    [then set variable_name = assign_expression [, variable_name = assign_expression [,...]]]
  ]</pre><p>
						The <code class="literal">when</code> keyword must be followed by a trigger expression returning a boolean value of true or false, indicating whether to output.
						Use the optional <code class="literal">then</code> keyword to change variable values after the trigger expression evaluates to true. An assignment expression assigns a new value to variable(s).
					</p><p>
					  For use with contexts you may append the keywords <code class="literal">and when terminated</code> to also trigger output when the context partition terminates. Please see <a class="xref" href="#context_outputterminated" title="4.5.Â Output When a Context Partition Ends or Terminates">SectionÂ 4.5, âOutput When a Context Partition Ends or Terminatesâ</a> for details. You may optionally specify a termination expression. If that expression is provided the 
					  engine evaluates the expression when the context partition terminates: The evaluation result of <code class="literal">true</code> means output occurs when the context partition terminates, <code class="literal">false</code> means no output occurs when the context partition terminates.
					  You may specify <code class="literal">then set</code> followed by a list of assignments to assign variables. Assignments are executed on context partition termination regardless of the termination expression, if present.
					</p><p>
						Lets consider an example. The next statement assumes that your application has defined a variable by name OutputTriggerVar of boolean type. The statement outputs rows only when the OutputTriggerVar variable has a boolean value of true:
					</p><pre class="synopsis">select sum(price) from StockTickEvent output when OutputTriggerVar = true</pre><p>
						The engine evaluates the trigger expression when streams and data windows (if any) post one or more insert or remove stream events after considering the <code class="literal">where</code> clause, if present. It also evaluates the trigger expression when any of the variables used in the trigger expression, if any, changes value. Thus output occurs as follows:
					</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
								When there are insert or remove stream events and the <code class="literal">when</code> trigger expression evaluates to true, the engine outputs the resulting rows.
							</p></li><li><p>
								When any of the variables in the <code class="literal">when</code> trigger expression changes value, the engine evaluates the expression and outputs results. Result output occurs within the minimum time interval of timer resolution.
							</p></li></ol></div><p>
						By adding a <code class="literal">then</code> part to the EPL, you can reset any variables after the trigger expression evaluated to true:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(price) from StockTickEvent 
  output when OutputTriggerVar = true  
  then set OutputTriggerVar = false</pre><p>
						Expressions in the <code class="literal">when</code> and <code class="literal">then</code> may, for example, use variables, user defined functions or any of the built-in named properties that are described in the below list.
					</p><p>
						The following built-in properties are available for use:
					</p><div class="table"><a id="epl-output-expression-builtin"/><p class="title"><b>TableÂ 5.7.Â Built-In Properties for Use With Output When</b></p><div class="table-contents"><table summary="Built-In Properties for Use With Output When" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Built-In Property Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">last_output_timestamp</code></td><td>Timestamp when the last output occurred for the statement; Initially set to time of statement creation</td></tr><tr><td><code class="literal">count_insert</code></td><td>Number of insert stream events</td></tr><tr><td><code class="literal">count_insert_total</code></td><td>Number of insert stream events in total (not reset when output occurs).</td></tr><tr><td><code class="literal">count_remove</code></td><td>Number of remove stream events</td></tr><tr><td><code class="literal">count_remove_total</code></td><td>Number of remove stream events in total (not reset when output occurs).</td></tr></tbody></table></div></div><br class="table-break"/><p>
						The values provided by <code class="literal">count_insert</code> and <code class="literal">count_remove</code> are non-continues: The number returned for these properties may 'jump' up rather then count up by 1.
						The counts reset to zero upon output.
					</p><p>
						The following restrictions apply to expressions used in the output rate clause:
					</p><div class="itemizedlist"><ul compact="compact"><li><p>
								Event property names cannot be used in the output clause.
							</p></li><li><p>
								Aggregation functions cannot be used in the output clause.
							</p></li><li><p>
								The <code class="literal">prev</code> previous event function and the <code class="literal">prior</code> prior event function cannot be used in the output clause.
							</p></li></ul></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-output-suppress"/>5.7.1.2.Â Suppressing Output With <code class="literal">After</code></h4></div></div></div><a id="d0e9389" class="indexterm"/><a id="d0e9394" class="indexterm"/><p>
						The <code class="literal">after</code> keyword and its time period or number of events parameters is optional and can occur after the <code class="literal">output</code> keyword, either alone or with output conditions as listed above.
					</p><p>
						The synopsis of <code class="literal">after</code> is as follows:
					</p><pre class="synopsis">output after <span class="emphasis"><em>time_period</em></span> | <span class="emphasis"><em>number</em></span> events [...]</pre><p>
						When using <code class="literal">after</code> either alone or together with further output conditions, the engine discards all output events until the time period passed as measured from the start of the statement, or until the
						number of output events are reached. The discarded events are not output and do not count towards any further output conditions if any are specified.
					</p><p>
						For example, the following statement outputs every minute the total price for all orders in the 30-minute time window but only after 30 minutes have passed:		
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(price) from OrderEvent#time(30 min) output after 30 min snapshot every 1 min</pre><p>
						An example in which <code class="literal">after</code> occur alone is below, in a statement that outputs total price for all orders in the last minute but only after 1 minute passed, each time an event arrives or leaves the data window:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(price) from OrderEvent#time(1 min) output after 1 min</pre><p>
						To demonstrate <code class="literal">after</code> when used with an event count, this statement find pairs of orders with the same id but suppresses output for the first 5 pairs:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern[every o=OrderEvent-&gt;p=OrderEvent(id=o.id)] output after 5 events</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-output-snapshot"/>5.7.1.3.Â Output Snapshot</h4></div></div></div><a id="d0e9444" class="indexterm"/><p>
						For fully aggregated and un-grouped statements, <code class="literal">output snapshot</code> outputs a single row with current aggregation value(s).
					</p><p>
						For aggregated ungrouped and grouped statements, as well as for unaggregated statements, 
						<code class="literal">output snapshot</code> considers events held by the data window and outputs a row for each event.
						If the statement specifies no data window or a join results in no rows, the output is no rows.
					</p><p>
						For fully aggregated and grouped statements that select from a single stream (or pattern, non-joining) and that do not specify a data window, 
						the engine outputs current aggregation results for all groups. For fully aggregated and grouped statements with a join and/or data windows the output consists of aggregation values 
						according to events held in the data window (single stream) or that are join results (join).
					</p><p>
						When the <code class="literal">from</code>-clause lists only tables, use <code class="literal">output snapshot</code> to output table contents. 
					</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-output-groupby"/>5.7.2.Â Aggregation, Group By, Having and Output Clause Interaction</h3></div></div></div><p>
					Remove stream events can also be useful in conjunction with aggregation and the <code class="literal">output</code> clause: When the engine posts remove stream events for fully-aggregated queries, it presents the aggregation state before the expiring event leaves the data window. Your application can thus easily obtain a delta between the new aggregation value and the prior aggregation value.
				</p><p>
					The engine evaluates the having-clause at the granularity of the data posted by data windows (if any) or when an event arrives (without a data windows). That is, if you utilize a time window and output every 10 events, the <code class="literal">having</code> clause applies to each individual event or events entering and leaving the time window (and not once per batch of 10 events).
				</p><p>
					The <code class="literal">output</code> clause interacts in two ways with the <code class="literal">group by</code> and <code class="literal">having</code> clauses. First, in the <code class="literal">output every n events </code>case, the number <code class="literal">n</code> refers to the number of events arriving into the <code class="literal">group by clause</code>. That is, if the <code class="literal">group by</code> clause outputs only 1 event per group, or if the arriving events don't satisfy the <code class="literal">having</code> clause, then the actual number of events output by the statement could be fewer than <code class="literal">n</code>.
				</p><p>
					Second, the <code class="literal">last</code>, <code class="literal">all</code> and <code class="literal">first</code> keywords have special meanings when used in a statement with aggregate functions and the <code class="literal">group by</code> clause:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							When no keyword is specified, the engine produces an output row for each row in the batch or when using group-by then an output per group only for those groups present in the batch, following <a class="xref" href="#">???</a>.
						</p></li><li><p>
							The <code class="literal">all</code> keyword (the default) specifies that the most recent data for <span class="emphasis"><em>all</em></span> groups seen so far should be output, whether or not these groups' aggregate values have just been updated
						</p></li><li><p>
							The <code class="literal">last</code> keyword specifies that only groups whose aggregate values have been updated with the most recent batch of events should be output.
						</p></li><li><p>
							The <code class="literal">first</code> keyword specifies that only groups whose aggregate values have been updated with the most recent batch of events should be output following the defined frequency, keeping frequency state for each group. 
						</p></li><li><p>
							The <code class="literal">snapshot</code> keyword does not consider the recent batch and has special behavior as discussed in <a class="xref" href="#epl-output-snapshot" title="5.7.1.3.Â Output Snapshot">SectionÂ 5.7.1.3, âOutput Snapshotâ</a>.
						</p></li></ul></div><p>
					Please consult the <a class="xref" href="#appendix_outputspec" title="AppendixÂ A.Â Output Reference and Samples">AppendixÂ A, <i>Output Reference and Samples</i></a> for detailed information on insert and remove stream output for aggregation and group-by.
				</p><p>
					By adding an output rate limiting clause to a statement that contains a <span class="emphasis"><em>group by</em></span> clause you can control output of groups to obtain one row for each group, generating an event per group at the given output frequency.
				</p><p>
				  The next statement outputs total price per symbol cumulatively (no data window was used here). As it specifies the <code class="literal">all</code> keyword, the statement outputs the current value for all groups seen so far, regardless of whether the group was updated in the last interval. Output occurs after an interval of 5 seconds passed and at the end of each subsequent interval:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, sum(price) from StockTickEvent group by symbol output all every 5 seconds</pre><p>
				  The below statement outputs total price per symbol considering events in the last 3 minutes. When events leave the 3-minute data window output also occurs as new aggregation values are computed. The <code class="literal">last</code> keyword instructs the engine to output only those groups that had changes. Output occurs after an interval of 10 seconds passed and at the end of each subsequent interval:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, sum(price) from StockTickEvent#time(3 min)
group by symbol output last every 10 seconds</pre><p>
				  This statement also outputs total price per symbol considering events in the last 3 minutes. The <code class="literal">first</code> keyword instructs the engine to output as soon as there is a new value for a group. After output for a given group the engine suppresses output for the same group for 10 seconds and does not suppress output for other groups. Output occurs again for that group after the interval when the group has new value(s):
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, sum(price) from StockTickEvent#time(3 min)
group by symbol output first every 10 seconds</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-order-by"/>5.8.Â Sorting Output: the <span class="emphasis"><em>Order By</em></span> Clause</h2></div></div></div><a id="d0e9596" class="indexterm"/><a id="d0e9599" class="indexterm"/><a id="d0e9602" class="indexterm"/><a id="d0e9605" class="indexterm"/><p>
			The <code class="literal">order by</code> clause is optional. It is used for ordering output events by their properties, or by expressions involving those properties. .				
		</p><p>
			For example, the following statement outputs batches of 5 or more stock tick events that are sorted first by price ascending and then by volume ascending:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol from StockTickEvent#time(60 sec) 
output every 5 events 
order by price, volume</pre><p>
			Here is the syntax for the <code class="literal">order by</code> clause:				
		</p><pre class="synopsis">order by <span class="emphasis"><em>expression</em></span> [asc | desc] [, <span class="emphasis"><em>expression</em></span> [asc | desc]] [, ...]</pre><p>
			If the <code class="literal">order by</code> clause is absent then the engine still makes certain guarantees about the ordering of output: 
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					If the statement is not a join, does not group via <code class="literal">group by</code> clause and does not declare grouped data windows via <code class="literal">#groupwin</code>, the order in which events are delivered to listeners and through the <code class="literal">iterator</code> pull API is the order of event arrival.
				</p></li><li><p>
					If the statement is a join or outer join, or groups, then the order in which events are delivered to listeners and through the <code class="literal">iterator</code> pull API is not well-defined. Use the <code class="literal">order by</code> clause if your application requires events to be delivered in a well-defined order.
				</p></li></ul></div><p>
			Esper places the following restrictions on the expressions in the <code class="literal">order by</code> clause:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					All aggregate functions that appear in the <code class="literal">order by</code> clause must also appear in the <code class="literal">select</code> expression.
				</p></li></ol></div><p>
			Otherwise, any kind of expression that can appear in the <code class="literal">select</code> clause, 
			as well as any name defined in the <code class="literal">select</code> clause, is also valid in the order by clause.
		</p><p>
			By default all sort operations on string values are performed via the <code class="literal">compare</code> method and are thus not locale dependent. To account for differences in language or locale, see <a class="xref" href="#config-engine-language" title="15.4.25.Â Engine Settings Related to Language and Locale">SectionÂ 15.4.25, âEngine Settings Related to Language and Localeâ</a> to change this setting.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-limit"/>5.9.Â Limiting Row Count: the <span class="emphasis"><em>Limit</em></span> Clause</h2></div></div></div><a id="d0e9695" class="indexterm"/><a id="d0e9698" class="indexterm"/><a id="d0e9701" class="indexterm"/><a id="d0e9704" class="indexterm"/><p>
			The <code class="literal">limit</code> clause is typically used together with the <code class="literal">order by</code> and <code class="literal">output</code> clause to limit your query results to those that fall within a specified range. You can use it to receive the first given number of result rows, or to receive a range of result rows. 
		</p><p>
			There are two syntaxes for the <code class="literal">limit</code> clause, each can be parameterized by integer constants or by variable names. The first syntax is shown below:				
		</p><pre class="synopsis">limit <span class="emphasis"><em>row_count</em></span> [offset <span class="emphasis"><em>offset_count</em></span>]</pre><p>
			The required <span class="emphasis"><em>row_count</em></span> parameter specifies the number of rows to output. The <span class="emphasis"><em>row_count</em></span> can be an integer constant 
			and can also be the name of the integer-type variable to evaluate at runtime.
		</p><p>
			The optional <span class="emphasis"><em>offset_count</em></span> parameter specifies the number of rows that should be skipped (offset) at the beginning of the result set. A variable can also be used for this parameter.
		</p><p>
			The next sample EPL query outputs the top 10 counts per property 'uri' every 1 minute.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select uri, count(*) from WebEvent 
group by uri 
output snapshot every 1 minute
order by count(*) desc 
limit 10</pre><p>
			The next statement demonstrates the use of the <code class="literal">offset</code> keyword. It outputs ranks 3 to 10 per property 'uri' every 1 minute:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select uri, count(*) from WebEvent 
group by uri 
output snapshot every 1 minute
order by count(*) desc 
limit 8 offset 2</pre><p>
			The second syntax for the <code class="literal">limit</code> clause is for SQL standard compatibility and specifies the offset first, followed by the row count:
		</p><pre class="synopsis">limit <span class="emphasis"><em>offset_count</em></span>[, <span class="emphasis"><em>row_count</em></span>]</pre><p>
			The following are equivalent:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">limit 8 offset 2
// ...equivalent to
limit 2, 8</pre><p>
			A negative value for <span class="emphasis"><em>row_count</em></span> returns an unlimited number or rows, and a zero value returns no rows. If variables are used, then the current variable value at the time of output dictates the row count and offset. A variable returning a null value for <span class="emphasis"><em>row_count</em></span> also returns an unlimited number or rows. 
		</p><p>
			A negative value for offset is not allowed. If your variable returns a negative or null value for offset then the value is assumed to be zero (i.e. no offset).
		</p><p>
			The <code class="literal">iterator</code> pull API also honors the <code class="literal">limit</code> clause, if present.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-insert-into"/>5.10.Â Merging Streams and Continuous Insertion: The <span class="emphasis"><em>Insert Into</em></span> Clause</h2></div></div></div><a id="d0e9798" class="indexterm"/><a id="d0e9801" class="indexterm"/><p>
			The <code class="literal">insert into</code> clause is optional in Esper. The clause can be specified to make the results of a statement available as an event stream for use
			in further statements, or to insert events into a named window or table. The clause can also be used to merge multiple event streams to form a single stream of events.
		</p><p>
			The syntax for the <code class="literal">insert into</code> clause is as follows:
		</p><pre class="synopsis">insert [istream | irstream | rstream] into <span class="emphasis"><em>event_stream_name</em></span>  [ ( [<span class="emphasis"><em>property_name</em></span> [, property_name]] ) ]</pre><p>
			The <code class="literal">istream</code> (default) and <code class="literal">rstream</code> keywords are optional. If no keyword or the <code class="literal">istream</code> keyword is specified, the engine supplies the insert stream events generated by the statement. The insert stream consists of the events entering the respective window(s) or stream(s). If the <code class="literal">rstream</code> keyword is specified, the engine supplies the remove stream events generated by the statement. The remove stream consists of the events leaving the respective window(s). 
		</p><p>
			If your application specifies <code class="literal">irstream</code>, the engine inserts into the new stream both the insert and remove stream. This is often useful in connection with the <code class="literal">istream</code> built-in function that returns an inserted/removed boolean indicator for each event, see <a class="xref" href="#epl-single-row-function-istream" title="10.1.10.Â The Istream Function">SectionÂ 10.1.10, âThe Istream Functionâ</a>.			
		</p><p>
			The <code class="literal">event_stream_name</code> is an identifier that names the event stream (and also implicitly names the types of events in the stream) generated by the engine. 
			It may also specify a named window name or a table name.
			The identifier can be used in further statements to filter and process events of that event stream, unless inserting into a table. 
			The <code class="literal">insert into</code> clause can consist of just an event stream name, or an event stream name and one or more property names.
		</p><p>
			The engine also allows listeners to be attached to a statement that contain an <code class="literal">insert into</code> clause. Listeners receive all events posted to the event stream.
		</p><p>
			To merge event streams, simply use the same <code class="literal">event_stream_name</code> identifier in all EPL statements that merge their result event streams. Make sure to use the
			same number and names of event properties and event property types match up.
		</p><p>
			Esper places the following restrictions on the <code class="literal">insert into</code> clause:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					The number of elements in the <code class="literal">select</code> clause must match the number of elements in the <code class="literal">insert into</code> clause if the clause specifies a list of event property names
				</p></li><li><p>
					If the event stream name has already been defined by a prior statement or configuration, and the event property names and/or event types do not match, an exception is thrown at statement creation time.
				</p></li></ol></div><p>
			The following sample inserts into an event stream by name CombinedEvent:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into CombinedEvent
select A.customerId as custId, A.timestamp - B.timestamp as latency
  from EventA#time(30 min) A, EventB#time(30 min) B
 where A.txnId = B.txnId</pre><p>
			Each event in the <code class="literal">CombinedEvent</code> event stream has two event properties named "custId" and "latency". The events generated by the above statement can be used in further statements, such as shown in the next statement:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select custId, sum(latency)
  from CombinedEvent#time(30 min)
 group by custId</pre><p>
			The example statement below shows the alternative form of the <code class="literal">insert into</code> clause that explicitly defines the property names to use.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into CombinedEvent (custId, latency)
select A.customerId, A.timestamp - B.timestamp 
...</pre><p>
			The <code class="literal">rstream</code> keyword can be useful to indicate to the engine to generate only remove stream events. This can be useful if you want to trigger 
			actions when events leave a window rather then when events enter a window. The statement below generates <code class="literal">CombinedEvent</code> events when
			EventA and EventB leave the window after 30 minutes.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert rstream into CombinedEvent
select A.customerId as custId, A.timestamp - B.timestamp as latency
  from EventA#time(30 min) A, EventB#time(30 min) B
 where A.txnId = B.txnId</pre><p>
			The <code class="literal">insert into</code> clause can be used in connection with patterns to provide pattern results to further statements for analysis:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into ReUpEvent
select linkUp.ip as ip 
from pattern [every linkDown=LinkDownEvent -&gt; linkUp=LinkUpEvent(ip=linkDown.ip)]</pre><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="insert-into-property-transpose"/>5.10.1.Â Transposing a Property to a Stream</h3></div></div></div><p>
				Sometimes your events may carry properties that are themselves event objects. Therefore EPL offers a special syntax to insert the value of a property itself as an event into a stream:
			</p><pre class="synopsis">insert into <span class="emphasis"><em>stream_name</em></span> select <span class="emphasis"><em>property_name</em></span>.* from ...</pre><p>
				This feature is only supported for JavaBean events and for <code class="literal">Map</code> and Object-array (<code class="literal">Object[]</code>) event types that associate an event type name with the property type. It is not supported for <code class="literal">XML</code> events. Nested property names are also not supported.
			</p><p>
				In this example, the class <code class="literal">Summary</code> with properties <code class="literal">bid</code> and <code class="literal">ask</code> that are of type <code class="literal">Quote</code> is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class Summary {
  private Quote bid;
  private Quote ask;
  ...</pre><p>
				The statement to populate a stream of <code class="literal">Quote</code> events is thus:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into MyBidStream select bid.* from Summary</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="insert-into-merging-columns"/>5.10.2.Â Merging Streams by Event Type</h3></div></div></div><p>
				The <code class="literal">insert into</code> clause allows to merge multiple event streams into a event single stream. 
				The clause names an event stream to insert into by specifing an <span class="emphasis"><em>event_stream_name</em></span>. The first statement that inserts into the named stream defines the stream's event types. Further statements that
				insert into the same event stream must match the type of events inserted into the stream as declared by the first statement.
			</p><p>
			    One approach to merging event streams specifies individual colum names either in the <code class="literal">select</code> clause or in the <code class="literal">insert into</code> clause of the statement. This approach has been shown in earlier examples.
			</p><p>
			    Another approach to merging event streams specifies the wildcard (*) in the <code class="literal">select</code> clause (or the stream wildcard) to select the underlying event. The events in the event stream must then 
			    have the same event type as generated by the <code class="literal">from</code> clause.
			</p><p>
			    Assume a statement creates an event stream named MergedStream by selecting OrderEvent events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into MergedStream select * from OrderEvent</pre><p>
			    A statement can use the stream wildcard selector to select only OrderEvent events in a join:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into MergedStream select ord.* from ItemScanEvent, OrderEvent as ord</pre><p>
			    And a statement may also use an application-supplied user-defined function to convert events to OrderEvent instances:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into MergedStream select MyLib.convert(item) from ItemScanEvent as item</pre><p>
			    Esper specifically recognizes a conversion function as follows: A conversion function must be the only selected column, and it must return either a Java object or <code class="literal">java.util.Map</code> or <code class="literal">Object[]</code> (object array).
			    Your EPL should not use the <code class="literal">as</code> keyword to assign a column name.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="insert-into-merging-types"/>5.10.3.Â Merging Disparate Types of Events: Variant Streams</h3></div></div></div><a id="d0e10019" class="indexterm"/><p>
				A <span class="emphasis"><em>variant stream</em></span> is a predefined stream into which events of multiple disparate event types can be inserted. 
			</p><p>
				A variant stream name may appear anywhere in a pattern or <code class="literal">from</code> clause. In a pattern, a filter against a variant stream matches any events of any of the event types inserted into the variant stream. 
				In a <code class="literal">from</code> clause including for named windows, data windows may hold events of any of the event types inserted into the variant stream.
			</p><p>
				A variant stream is thus useful in problems that require different types of event to be treated the same.
			</p><p>
				Variant streams can be declared by means of <code class="literal">create variant schema</code> or can be predefined via runtime or initialization-time configuration as described in <a class="xref" href="#config-variantstream" title="15.4.31.Â Variant Stream">SectionÂ 15.4.31, âVariant Streamâ</a>. Your application may declare or predefine variant streams to carry events of a limited set of event types, or you may choose the variant stream to carry any and all types of events. This choice affects what event properties are available for consuming statements or patterns of the variant stream.
			</p><p>
				Assume that an application predefined a variant stream named <code class="literal">OrderStream</code> to carry only <code class="literal">ServiceOrder</code> and <code class="literal">ProductOrder</code> events. An <code class="literal">insert into</code> clause inserts events into
				the variant stream:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into OrderStream select * from ServiceOrder</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into OrderStream select * from ProductOrder</pre><p>
				Here is a sample statement that consumes the variant stream and outputs a total price per customer id for the last 30 seconds of <code class="literal">ServiceOrder</code> and <code class="literal">ProductOrder</code> events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select customerId, sum(price) from OrderStream#time(30 sec) group by customerId</pre><p>
				If your application predefines the variant stream to hold specific type of events, as the sample above did, then all event properties that are common to all specified types are visible on the variant stream, including nested, indexed and mapped properties. For access to properties that are only available on one of the types, the dynamic property syntax must be used. In the example above, the <code class="literal">customerId</code> and <code class="literal">price</code> were properties common to both <code class="literal">ServiceOrder</code> and <code class="literal">ProductOrder</code> events.
			</p><p>
				For example, here is a consuming statement that selects a <code class="literal">service duraction</code> property that only <code class="literal">ServiceOrder</code> events have, and that must therefore be casted to double and null values removed in order to aggregate:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select customerId, sum(coalesce(cast(serviceDuraction?, double), 0)) 
from OrderStream#time(30 sec) group by customerId</pre><p>
				If your application predefines a variant stream to hold any type of events (the <code class="literal">any</code> type variance), then all event properties of the variant stream are effectively dynamic properties. 
			</p><p>
				For example, an application may define an <code class="literal">OutgoingEvents</code> variant stream to hold any type of event. The next statement is a sample consumer of the <code class="literal">OutgoingEvents</code> variant stream that looks for the <code class="literal">destination</code> property and fires for each event in which the property exists with a value of <code class="literal">'email'</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from OutgoingEvents(destination = 'email')</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="insert-into-decorated"/>5.10.4.Â Decorated Events</h3></div></div></div><a id="d0e10120" class="indexterm"/><p>
				Your <code class="literal">select</code> clause may use the '*' wildcard together with further expressions to populate a stream of events. A sample statement is:				
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into OrderStream select *, price*units as linePrice from PurchaseOrder</pre><p>
				When using wildcard and selecting additional expression results, the engine produces what is called <span class="emphasis"><em>decorating</em></span> events for the resulting stream. Decorating events add additional property values to an underlying event.
			</p><p>
				In the above example the resulting OrderStream consists of underlying PurchaseOrder events <span class="emphasis"><em>decorated</em></span> by a <code class="literal">linePrice</code> property that is a result of the <code class="literal">price*units</code> expression.
			</p><p>
				In order to use <code class="literal">insert into </code> to insert into an existing stream of decorated events, your underlying event type must match, and all additional decorating property names and types of the <code class="literal">select</code> clause must also match.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="insert-into-eventasproperty"/>5.10.5.Â Event as a Property</h3></div></div></div><a id="d0e10157" class="indexterm"/><p>
				Your <code class="literal">select</code> clause may use the stream name to populate a stream of events in which each event has properties that are itself an event. A sample statement is:				
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into CompositeStream select order, service, order.price+service.price as totalPrice 
from PurchaseOrder#lastevent as order, ServiceEvent#lastevent as service</pre><p>
				When using the stream name (or tag in patterns) in the select-clause, the engine produces composite events: One or more of the properties of the composite event are events themselves.
			</p><p>
				In the above example the resulting CompositeStream consists of 3 columns: the PurchaseOrder event, the ServiceEvent event and the <code class="literal">totalPrice</code> property that is a result of the <code class="literal">order.price+service.price</code> expression.
			</p><p>
				In order to use <code class="literal">insert into </code> to insert into an existing stream of events in which properties are themselves events, each event column's event type must match, and all additional property names and types of the <code class="literal">select</code> clause must also match.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="insert-into-populate"/>5.10.6.Â Instantiating and Populating an Underlying Event Object</h3></div></div></div><p>
				Your <code class="literal">insert into</code> clause may also directly instantiate and populate application underlying event objects or <code class="literal">Map</code> or <code class="literal">Object[]</code> event objects. This is described in greater detail in <a class="xref" href="#eventrep-insertinto" title="3.10.Â Event Objects Instantiated and Populated by Insert Into">SectionÂ 3.10, âEvent Objects Instantiated and Populated by Insert Intoâ</a>.
			</p><p>
			    If instead you have an expression that returns an event object, please read on to the next section.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="insert-into-expression"/>5.10.7.Â Transposing an Expression Result</h3></div></div></div><p>
				You can transpose an object returned as an expression result into a stream using the <code class="literal">transpose</code> function as described further in <a class="xref" href="#functionreference-transpose" title="10.4.Â Select-Clause Transpose Function">SectionÂ 10.4, âSelect-Clause Transpose Functionâ</a>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="insert-into-reconcile"/>5.10.8.Â Select-Clause Expression and Inserted-Into Column Event Type</h3></div></div></div><p>
				When you declare the inserted-into event type in advance to the statement that inserts, the engine compares the inserted-into event type information to the return type of expressions in the select-clause.
				The comparison uses the column alias assigned to each select-clause expression using the <code class="literal">as</code> keyword.
			</p><p>
				When the inserted-into column type is an event type and when using a subquery or the <code class="literal">new</code> operator, 
				the engine compares column names assigned to subquery columns or <code class="literal">new</code> operator columns.
			</p><p>
			    For example, assume a <code class="literal">PurchaseOrder</code> event type that has a property called <code class="literal">items</code> that consists of <code class="literal">Item</code> rows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema Item(name string, price double)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema PurchaseOrder(orderId string, items Item[])</pre><p>
				Declare a statement that inserts into the <code class="literal">PurchaseOrder</code> stream:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into PurchaseOrder 
select '001' as orderId, new {name='i1', price=10} as items
from TriggerEvent</pre><p>
				The alias assigned to the first and second expression in the select-clause, namely <code class="literal">orderId</code> and <code class="literal">items</code>,
				both match the event property names of the <code class="literal">Purchase Order</code> event type. The column names provided to the <code class="literal">new</code> operator 
				also both match the event property names of the <code class="literal">Item</code> event type.
			</p><p>
				When the event type declares the column as a single value (and not an array) and when the select-clause expression produces a multiple rows, 
				the engine only populate the first row.
			</p><p>
			    Consider a <code class="literal">PurchaseOrder</code> event type that has a property called <code class="literal">item</code> that consists of a single <code class="literal">Item</code> event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema PurchaseOrder(orderId string, items Item)</pre><p>
				The sample subquery below populates only the very first event, discarding remaining subquery result events, since the <code class="literal">items</code> property above is declared as holding a single <code class="literal">Item</code>-typed event only (versus <code class="literal">Item[]</code> to hold multiple <code class="literal">Item</code>-typed events).
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into PurchaseOrder select 
(select 'i1' as name, 10 as price from HistoryEvent#length(2)) as items 
from TriggerEvent</pre><p>
				Consider using a subquery with filter, or one of the enumeration methods to select a specific subquery result row.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="insert-into-typewithoutprops"/>5.10.9.Â Insert Into for Event Types Without Properties</h3></div></div></div><p>
				When using insert-into and the type information for the inserted-into stream exists and the type has no properties, specify a <code class="literal">select</code>-clause that selects a single column of value <code class="literal">null</code> and that provides no column name.
			</p><p>
				For example, the next EPL declares a <code class="literal">TriggerStream</code> type that has no event properties:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema TriggerStream ()</pre><p>
				To populate events of type <code class="literal">TriggerStream</code>, let the <code class="literal">select</code>-clause simply select <code class="literal">null</code>, like this:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into TriggerStream select null from ... </pre><p>
				This example uses a pattern to populate a <code class="literal">TrggerStream</code> event every 10 seconds:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into TriggerStream select null from pattern[every timer:interval(10 sec)]</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-subqueries"/>5.11.Â Subqueries</h2></div></div></div><a id="d0e10342" class="indexterm"/><a id="d0e10345" class="indexterm"/><p>
			A subquery is a <code class="literal">select</code> within another statement. Esper supports subqueries in the <code class="literal">select</code> clause, <code class="literal">where</code> clause, <code class="literal">having</code> clause and in stream and pattern filter expressions. Subqueries provide an alternative way to perform operations that would otherwise require complex joins. Subqueries can also make statements more readable then complex joins.
	    </p><p>
			Esper supports both simple subqueries as well as correlated subqueries. In a simple subquery, the inner query is not correlated to the outer query. Here is an example simple subquery within a <code class="literal">select</code> clause:
	    </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select assetId, (select zone from ZoneClosed#lastevent) as lastClosed from RFIDEvent</pre><p>
			If the inner query is dependent on the outer query, you will have a correlated subquery. An example of a correlated subquery is shown below. Notice the <code class="literal">where</code> clause in the inner query, where the condition involves a stream from the outer query:
	    </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from RfidEvent as RFID where 'Dock 1' = 
  (select name from Zones#unique(zoneId) where zoneId = RFID.zoneId)</pre><p>
			The example above shows a subquery in the <code class="literal">where</code> clause. The statement selects RFID events in which the zone name matches a string constant based on zone id. The statement sets <code class="literal">#unique</code> to guarantee that only the last event per zone id is retained for processing by the subquery.
		</p><p>
			The next example is a correlated subquery within a <code class="literal">select</code> clause. In this statement the <code class="literal">select</code> clause retrieves the zone name by means of a subquery against the Zones set of events correlated by zone id:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select zoneId, (select name from Zones#unique(zoneId) 
  where zoneId = RFID.zoneId) as name from RFIDEvent</pre><p>
			Note that when a simple or correlated subquery returns multiple rows, the engine returns a <code class="literal">null</code> value as the subquery result. To limit the number of events returned by a subquery consider using one of the <code class="literal">#lastevent</code>, <code class="literal">#unique</code> data windows or aggregation functions or the multi-row and multi-column-select as described below.
		</p><p>
			The <code class="literal">select</code> clause of a subquery also allows wildcard selects, which return as an event property the underlying event object of the event type as defined in the <code class="literal">from</code> clause. An example:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select (select * from MarketData#lastevent) as md 
  from pattern [every timer:interval(10 sec)]</pre><p>
			The output events to the statement above contain the underlying MarketData event in a property named "md". The statement populates the last MarketData event into a property named "md" every 10 seconds following the pattern definition, or populates a <code class="literal">null</code> value if no MarketData event has been encountered so far.
		</p><p>
			Aggregation functions may be used in the <code class="literal">select</code> clause of the subselect as this example outlines:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MarketData
where price &gt; (select max(price) from MarketData(symbol='GOOG')#lastevent)</pre><p>
			As the sub-select expression is evaluated first (by default), the query above actually never fires for the GOOG symbol, only for other symbols that have a price higher then the current maximum for GOOG. As a sidenote, the <code class="literal">insert into</code> clause can also be handy to compute aggregation results for use in multiple subqueries.
		</p><p>
			When using aggregation functions in a correlated subselect the engine computes the aggregation based on data window (if provided), named window or table contents matching the where-clause.
		</p><p>
			The following example compares the quantity value provided by the current order event against the total quantity of all order events in the last 1 hour for the same client.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from OrderEvent oe
where qty &gt; 
  (select sum(qty) from OrderEvent#time(1 hour) pd 
  where pd.client = oe.client)</pre><p>
			Filter expressions in a pattern or stream may also employ subqueries. Subqueries can be uncorrelated or can be correlated to properties of the stream or to properties of tagged events in a pattern. Subqueries may reference named windows and tables as well.
		</p><p>
			The following example filters <code class="literal">BarData</code> events that have a close price less then the last moving average (field <code class="literal">movAgv</code>) as provided by stream <code class="literal">SMA20Stream</code> (an uncorrelated subquery):
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from BarData(ticker='MSFT', closePrice &lt; 
    (select movAgv from SMA20Stream(ticker='MSFT')#lastevent))</pre><p>
			A few generic examples follow to demonstrate the point. The examples use short event and property names so they are easy to read. Assume <code class="literal">A</code> and <code class="literal">B</code> are streams and <code class="literal">DNamedWindow</code> is a named window, and <code class="literal">ETable</code> is a table and properties <code class="literal">a_id, b_id, d_id, e_id, a_val, b_val, d_val, e_val</code> respectively:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Sample correlated subquery as part of stream filter criteria
select * from A(a_val in 
  (select b_val from B#unique(b_val) as b where a.a_id = b.b_id)) as a</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Sample correlated subquery against a named window
select * from A(a_val in 
  (select d_val from DNamedWindow as d where a.a_id = d.d_id)) as a</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Sample correlated subquery in the filter criteria as part of a pattern, querying a named window
select * from pattern [
  a=A -&gt; b=B(bvalue = 
    (select d_val from DNamedWindow as d where d.d_id = b.b_id and d.d_id = a.a_id))
]</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Sample correlated subquery against a table
select * from A(a_val in 
  (select e_val from ETable as e where a.a_id = e.e_id)) as a</pre><p>
			Subquery state starts to accumulate as soon as a statement starts (and not only when a pattern-subexpression activates).
		</p><p>
			The following restrictions apply to subqueries:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					Subqueries can only consist of a <code class="literal">select</code> clause, a <code class="literal">from</code> clause, a <code class="literal">where</code> clause, a <code class="literal">group by</code> clause and a <code class="literal">having</code> clause. Joins, outer-joins and output rate limiting are not permitted within subqueries.
				</p></li><li><p>
					If using aggregation functions in a subquery, note these limitations:
				</p><div class="orderedlist"><ol><li><p>
							None of the properties of the correlated stream(s) can be used within aggregation functions.
						</p></li><li><p>
							The properties of the subselect stream must all be within aggregation functions.
						</p></li></ol></div></li><li><p>
					With the exception of subqueries against named windows and tables and subqueries that are both uncorrelated and fully-aggregated, 
					the subquery stream definition must define a data window to limit subquery results, for the purpose of identifying the events held for subquery execution.
				</p></li><li><p>
					The <code class="literal">having</code>-clause, if present, requires that properties of the selected stream are aggregated and does not allow un-aggregated properties of the selected stream.
					You may use the <code class="literal">first</code> aggregation function to obtain properties of the selected stream instead.
				</p></li></ol></div><p>
			The order of evaluation of subqueries relative to the containing statement is guaranteed: If the containing statement and its subqueries are reacting to the same type of event, the subquery will receive the
			event first before the containing statement's clauses are evaluated. This behavior can be changed via configuration. The order of evaluation of subqueries is not guaranteed between subqueries.
		</p><p>
			Performance of your statement containing one or more subqueries principally depends on two parameters. First, if your subquery correlates one or more columns in the subquery stream with the enclosing statement's streams, the engine automatically builds the appropriate indexes for fast row retrieval based on the key values correlated (joined). The second parameter is the number of rows found in the subquery stream and the complexity of the filter criteria (<code class="literal">where</code> clause), as each row in the subquery stream must evaluate against the <code class="literal">where</code> clause filter.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-subqueries-exists"/>5.11.1.Â The '<code class="literal">Exists</code>' Keyword</h3></div></div></div><p>
				The <code class="literal">exists</code> condition is considered "to be met" if the subquery returns at least one row. The <code class="literal">not exists</code> condition is considered true if the subquery returns no rows.
			</p><p>
				The synopsis for the <code class="literal">exists</code> keyword is as follows:
			</p><pre class="synopsis">exists (<span class="emphasis"><em>subquery</em></span>)</pre><p>
				Let's take a look at a simple example. The following is an EPL statement that uses the <code class="literal">exists</code> condition:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select assetId from RFIDEvent as RFID 
  where exists (select * from Asset#unique(assetId) where assetId = RFID.assetId)</pre><p>
				This select statement will return all RFID events where there is at least one event in Assets unique by asset id with the same asset id.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-subqueries-in"/>5.11.2.Â The '<code class="literal">In</code>' and '<code class="literal">Not In</code>' Keywords</h3></div></div></div><p>
				The <code class="literal">in</code> subquery condition is true if the value of an expression matches one or more of the values returned by the subquery. Consequently, the <code class="literal">not in</code> condition is true if the value of an expression matches none of the values returned by the subquery.
			</p><p>
				The synopsis for the <code class="literal">in</code> keyword is as follows:
			</p><pre class="synopsis"><span class="emphasis"><em>expression</em></span> in (<span class="emphasis"><em>subquery</em></span>)</pre><p>
				The right-hand side subquery must return exactly one column.
			</p><p>
				The next statement demonstrates the use of the <code class="literal">in</code> subquery condition: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select assetId from RFIDEvent
  where zone in (select zone from ZoneUpdate(status = 'closed')#time(10 min))</pre><p>
				The above statement demonstrated the <code class="literal">in</code> subquery to select RFID events for which the zone status is in a closed state. 
			</p><p>
				Note that if the left-hand expression yields null, or if there are no equal right-hand values and at least one right-hand row yields null, the result of the <code class="literal">in</code> construct will be null, not false (or true for <code class="literal">not-in</code>). This is in accordance with SQL's normal rules for Boolean combinations of null values.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-subqueries-anysome"/>5.11.3.Â The '<code class="literal">Any</code>' and '<code class="literal">Some</code>' Keywords</h3></div></div></div><p>
				The <code class="literal">any</code> subquery condition is true if the expression returns true for one or more of the values returned by the subquery.
			</p><p>
				The synopsis for the <code class="literal">any</code> keyword is as follows:
			</p><pre class="synopsis"><span class="emphasis"><em>expression</em></span> <span class="emphasis"><em>operator</em></span> any (<span class="emphasis"><em>subquery</em></span>)
<span class="emphasis"><em>expression</em></span> <span class="emphasis"><em>operator</em></span> some (<span class="emphasis"><em>subquery</em></span>)</pre><p>
				The left-hand expression is evaluated and compared to each row of the subquery result using the given operator, which must yield a Boolean result. The result of <code class="literal">any</code> is "true" if any true result is obtained. The result is "false" if no true result is found (including the special case where the subquery returns no rows). 
			</p><p>
				The <span class="emphasis"><em>operator</em></span> can be any of the following values: <code class="literal">=, !=, &lt;&gt;, &lt;, &lt;=, &gt;, &gt;=</code>.
			</p><p>
				The <code class="literal">some</code> keyword is a synonym for <code class="literal">any</code>. The <code class="literal">in</code> construct is equivalent to <code class="literal">= any</code>.
			</p><p>
				The right-hand side subquery must return exactly one column.
			</p><p>
				The next statement demonstrates the use of the <code class="literal">any</code> subquery condition: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from ProductOrder as ord
  where quantity &lt; any
    (select minimumQuantity from MinimumQuantity#keepall)</pre><p>
				The above query compares ProductOrder event's quantity value with all rows from the MinimumQuantity stream of events and returns only those ProductOrder events that have a quantity that is less then any of the minimum quantity values of the MinimumQuantity events.
			</p><p>
				Note that if there are no successes and at least one right-hand row yields null for the operator's result, the result of the <code class="literal">any</code> construct will be null, not false. This is in accordance with SQL's normal rules for Boolean combinations of null values. 
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-subqueries-all"/>5.11.4.Â The '<code class="literal">All</code>' Keyword</h3></div></div></div><p>
				The <code class="literal">all</code> subquery condition is true if the expression returns true for all of the values returned by the subquery.
			</p><p>
				The synopsis for the <code class="literal">all</code> keyword is as follows:
			</p><pre class="synopsis"><span class="emphasis"><em>expression</em></span> <span class="emphasis"><em>operator</em></span> all (<span class="emphasis"><em>subquery</em></span>)</pre><p>
				The left-hand expression is evaluated and compared to each row of the subquery result using the given operator, which must yield a Boolean result. The result of <code class="literal">all</code> is "true" if all rows yield true (including the special case where the subquery returns no rows). The result is "false" if any false result is found. The result is <code class="literal">null</code> if the comparison does not return false for any row, and it returns <code class="literal">null</code> for at least one row.
			</p><p>
				The <span class="emphasis"><em>operator</em></span> can be any of the following values: <code class="literal">=, !=, &lt;&gt;, &lt;, &lt;=, &gt;, &gt;=</code>.
			</p><p>
				The <code class="literal">not in</code> construct is equivalent to <code class="literal">!= all</code>.
			</p><p>
				The right-hand side subquery must return exactly one column.
			</p><p>
				The next statement demonstrates the use of the <code class="literal">all</code> subquery condition: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from ProductOrder as ord
  where quantity &lt; all
    (select minimumQuantity from MinimumQuantity#keepall)</pre><p>
				The above query compares ProductOrder event's quantity value with all rows from the MinimumQuantity stream of events and returns only those ProductOrder events that have a quantity that is less then all of the minimum quantity values of the MinimumQuantity events.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-subqueries-groupby"/>5.11.5.Â Subquery With <code class="literal">Group By</code> Clause</h3></div></div></div><p>
				The optional <code class="literal">group by</code> clause in subqueries works the same way as the group-by clause outside of subqueries,
				except that it impacts only those aggregations within the subquery.
			</p><p>
				The following restrictions apply:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						Expressions in the group-by clause cannot contain aggregate functions, subqueries or the <code class="literal">prev</code> and <code class="literal">prior</code> functions.
					</p></li><li><p>
					    Subqueries only support the fully-aggregated case when using group-by: All non-aggregated properties in the select clause must be listed in the group by clause.
					</p></li><li><p>
					    The group-by expressions cannot be correlated. All properties in the <code class="literal">group by</code> must be provided by the subselect stream.
					</p></li></ol></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-subqueries-multicolumn"/>5.11.6.Â Multi-Column Selection</h3></div></div></div><p>
				Your subquery may select multiple columns in the <code class="literal">select</code> clause including multiple aggregated values from a data window or named window or table.
			</p><p>
				The following example is a correlated subquery that selects wildcard and in addition selects the <code class="literal">bid</code> and <code class="literal">offer</code> properties of the last <code class="literal">MarketData</code> event for the same symbol as the arriving <code class="literal">OrderEvent</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select *,
  (select bid, offer from MarketData#unique(symbol) as md 
   where md.symbol = oe.symbol) as bidoffer
from OrderEvent oe</pre><p>
				Output events for the above query contain all properties of the original <code class="literal">OrderEvent</code> event. In addition each output event contains a <code class="literal">bidoffer</code> nested property that itself contains the <code class="literal">bid</code> and <code class="literal">offer</code> properties. You may retrieve the bid and offer from output events directly via the <code class="literal">bidoffer.bid</code> property name syntax for nested properties.  
			</p><p>
				The next example is similar to the above query but instead selects aggregations and selects from a named window by name <code class="literal">OrderNamedWindow</code> (creation not shown here). For each arriving <code class="literal">OrderEvent</code> it selects the total quantity and count of all order events for the same client, as currently held by the named window:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select *,
  (select sum(qty) as sumPrice, count(*) as countRows 
   from OrderNamedWindow as onw
   where onw.client = oe.client) as pastOrderTotals
from OrderEvent as oe</pre><p>
				The next EPL statement computes a prorated quantity considering the maximum and minimum quantity for the last 1 minute of order events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression subq {
  (select max(quantity) as maxq, min(quantity) as minq from OrderEvent#time(1 min))
}
select (quantity - minq) / (subq().maxq  - subq().minq) as prorated
from OrderEvent</pre><p>
				Output events for the above query contain all properties of the original <code class="literal">OrderEvent</code> event. In addition each output event contains a <code class="literal">pastOrderTotals</code> nested property that itself contains the <code class="literal">sumPrice</code> and <code class="literal">countRows</code> properties. 
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-subqueries-multirow"/>5.11.7.Â Multi-Row Selection</h3></div></div></div><p>
				While a subquery cannot change the cardinality of the selected stream, a subquery can return multiple values from the selected data window or named window or table. This section shows examples of the <code class="literal">window</code> aggregation function as well as the use of enumeration methods with subselects. 
			</p><p>
				Consider using an inner join, outer join or unidirectional join instead to achieve a 1-to-many cardinality in the number of output events.
			</p><p>
				The next example is an uncorrelated subquery that selects all current <code class="literal">ZoneEvent</code> events considering the last <code class="literal">ZoneEvent</code> per zone for each arriving <code class="literal">RFIDEvent</code>.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select assetId,
 (select window(z.*) as winzones from ZoneEvent#unique(zone) as z) as zones
 from RFIDEvent</pre><p>
				Output events for the above query contain two properties: the <code class="literal">assetId</code> property and the <code class="literal">zones</code> property. The latter property is a nested property that contains the <code class="literal">winzones</code> property. You may retrieve the zones from output events directly via the <code class="literal">zones.winzones</code> property name syntax for nested properties.  
			</p><p>
				In this example for a correlated subquery against a named window, assume that the <code class="literal">OrderNamedWindow</code> has been created and contains order events. The query returns for each <code class="literal">MarketData</code> event
				the list of order ids for orders with the same symbol:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select price,
 (select window(orderId) as winorders 
  from OrderNamedWindow onw 
  where onw.symbol = md.symbol) as orderIds
 from MarketData md</pre><p>
				Output events for the above query contain two properties: the <code class="literal">price</code> property and the <code class="literal">orderIds</code> property. The latter property is a nested property that contains the <code class="literal">winorders</code> property of type array. 
			</p><p>
				Another option to reduce selected rows to a single value is through the use of enumeration methods.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select price,
 (select *  from OrderNamedWindow onw
  where onw.symbol = md.symbol).selectFrom(v =&gt; v) as ordersSymbol
 from MarketData md</pre><p>
				Output events for the above query also contain a Collection of underlying events in the <code class="literal">ordersSymbol</code> property.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-subqueries-hints"/>5.11.8.Â Hints Related to Subqueries</h3></div></div></div><p>
				The following hints are available to tune performance and memory use of subqueries.
			</p><p>
				Use the <code class="literal">@Hint('set_noindex')</code> hint for a statement that utilizes one or more subqueries. It instructs the engine to always perform a full scan. The engine does not build an implicit index or use an explicitly-created index when this hint is provided. Use of the hint may result in reduced memory use but poor statement performance.
			</p><p>
				The following hints are available to tune performance and memory use of subqueries that select from named windows (does not apply to tables).
			</p><p>
				Named windows are globally-visible data windows. As such an application may create explicit indexes as discussed in <a class="xref" href="#named_explicit_index" title="6.9.Â Explicitly Indexing Named Windows and Tables">SectionÂ 6.9, âExplicitly Indexing Named Windows and Tablesâ</a>. The engine may also elect to create implicit indexes (no create-index EPL required) for index-based lookup of rows when executing <code class="literal">on-select</code>, <code class="literal">on-merge</code>, <code class="literal">on-update</code> and <code class="literal">on-delete</code> statements and for statements that subquery a named window.
			</p><p>
				By default and without specifying a hint, each statement that subqueries a named window also maintains its own index for looking up events held by the named window. The engine maintains the index by consuming the named window insert and remove stream. When the statement is destroyed it releases that index.
			</p><p>
				Specify the <code class="literal">@Hint('enable_window_subquery_indexshare')</code> hint to enable subquery index sharing for named windows. When using this hint, indexes for subqueries are maintained by the named window itself (and not each statement context partition), are shared between one or more statements and may also utilize explicit indexes. Specify the hint once as part of the <code class="literal">create window</code> statement.
			</p><p>
				This sample EPL statement creates a named window with subquery index sharing enabled:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Hint('enable_window_subquery_indexshare')
create window OrdersNamedWindow#keepall as OrderMapEventType</pre><p>
				When subquery index sharing is enabled, performance may increase as named window stream consumption is no longer needed for correlated subqueries. You may also expect reduced memory use especially if a large number of EPL statements perform similar subqueries against a named window. Subquery index sharing may require additional short-lived object creation and may slightly increase lock held time for named windows. 
			</p><p>
				The following statement performs a correlated subquery against the named window above. When a settlement event arrives it select the order detail for the same order id as provided by the settlement event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select 
  (select * from OrdersNamedWindow as onw 
    where onw.orderId = se.orderId) as orderDetail
  from SettlementEvent as se</pre><p>
				  With subquery index sharing enabled the engine maintains an index of order events by order id for the named window, and shares that index between additional statements until the time all utilizing statements are destroyed.
			  </p><p>
				You may disable subquery index sharing for a specific statement by specifying the <code class="literal">@Hint('disable_window_subquery_indexshare')</code> hint, as this example shows, causing the statement to maintain its own index:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Hint('disable_window_subquery_indexshare')
select 
  (select * from OrdersNamedWindow as onw 
    where onw.orderId = se.orderId) as orderDetail
  from SettlementEvent as se</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-join"/>5.12.Â Joining Event Streams</h2></div></div></div><a id="d0e10992" class="indexterm"/><a id="d0e10995" class="indexterm"/><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-join-introducing"/>5.12.1.Â Introducing Joins</h3></div></div></div><p>
				Two or more event streams can be part of the <code class="literal">from</code>-clause and thus both (all) streams determine the resulting events. This section summarizes the important concepts. The sections that follow present more detail on each topic.
			</p><p>
				The default join is an inner join which produces output events only when there is at least one match in all streams.
			</p><p>
				Consider the sample statement shown next:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TickEvent#lastevent, NewsEvent#lastevent</pre><p>
				The above statement outputs the last TickEvent and the last NewsEvent in one output event when either a TickEvent or a NewsEvent arrives. If no TickEvent was received before a NewsEvent arrives, no output occurs. Similarly when no NewsEvent was received before a TickEvent arrives, no output occurs.
			</p><p>
				The <code class="literal">where</code>-clause lists the join conditions that Esper uses to relate events in the two or more streams. 
			</p><p>
				The next example statement retains the last TickEvent and last NewsEvent per symbol, and joins the two streams based on their symbol value:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TickEvent#unique(symbol) as t, NewsEvent#unique(symbol) as n
where t.symbol = n.symbol</pre><p>
				As before, when a TickEvent arrives for a symbol that has no matching NewsEvent then there is no output event.
			</p><p>
				An outer join does not require each event in either stream to have a matching event. The full outer join is useful when output is desired when no match is found. The different outer join types (full, left, right) are explained in more detail below.
			</p><p>
				This example statement is an outer-join and also returns the last TickEvent and last NewsEvent per symbol: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TickEvent#unique(symbol) as t
full outer join NewsEvent#unique(symbol) as n on t.symbol = n.symbol</pre><p>
				In the sample statement above, when a TickEvent arrives for a symbol that has no matching NewsEvent, or when a NewsEvent arrives for a symbol that has no matching TickEvent, the statement still produces an output event with a null column value for the missing event.
			</p><p>
				Note that each of the sample queries above defines a data window. The sample queries above use the last-event data window (#lastevent) or the unique data window (#unique). A data window serves to indicate the subset of events to join from each stream and may be required depending on the join.
			</p><p>
				In above queries, when either a TickEvent arrives or when a NewsEvent arrives then the query evaluates and there is output. The same holds true if additional streams are added to the <code class="literal">from</code>-clause: Each of the streams in the <code class="literal">from</code>-clause trigger the join to evaluate.
			</p><p>
				The <code class="literal">unidirectional</code> keyword instructs the engine to evaluate the join only when an event arrives from the single stream that was marked with the <code class="literal">unidirectional</code> keyword. In this case no data window should be specified for the stream marked as <code class="literal">unidirectional</code> since the keyword implies that the current event of that stream triggers the join.
			</p><p>
				Here is the sample statement above with <code class="literal">unidirectional</code> keyword, so that output occurs only when a TickEvent arrives and not when a NewsEvent arrives:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TickEvent as t unidirectional, NewsEvent#unique(symbol) as n 
where t.symbol = n.symbol</pre><p>
				It is oftentimes the case that an aggregation (count, sum, average) only needs to be calculated in the context of an arriving event or timer. Consider using the <code class="literal">unidirectional</code> keyword when aggregating over joined streams.
			</p><p>
				An EPL pattern is a normal citizen also providing a stream of data consisting of pattern matches. A time pattern, for example, can be useful to evaluate a join and produce output upon each interval.
			</p><p>
				This sample statement includes a pattern that fires every 5 seconds and thus triggers the join to evaluate and produce output, computing an aggregated total quantity per symbol every 5 seconds:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, sum(qty) from pattern[every timer:interval(5 sec)] unidirectional, 
  TickEvent#unique(symbol) t, NewsEvent#unique(symbol) as n 
where t.symbol = n.symbol group by symbol</pre><p>
				Named windows as well as reference and historical data such as stored in your relational database, and data returned by a method/script/UDF invocation, can also be included in joins as discussed in <a class="xref" href="#histdata_overview" title="5.13.Â Accessing Relational Data via SQL">SectionÂ 5.13, âAccessing Relational Data via SQLâ</a> and <a class="xref" href="#joining_method" title="5.14.Â Accessing Non-Relational Data via Method, Script or UDF Invocation">SectionÂ 5.14, âAccessing Non-Relational Data via Method, Script or UDF Invocationâ</a>.
			</p><p>
				Related to joins are subqueries: A subquery is a <code class="literal">select</code> within another statement, see <a class="xref" href="#epl-subqueries" title="5.11.Â Subqueries">SectionÂ 5.11, âSubqueriesâ</a>
			</p><p>
				The engine performs extensive query analysis and planning, building internal indexes and strategies as required to allow fast evaluation of many types of queries.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-join-inner"/>5.12.2.Â Inner (Default) Joins</h3></div></div></div><p>
				Each point in time that an event arrives to one of the event streams, the two event streams are joined and output events are produced according to the <code class="literal">where</code> clause when matching events are found for all joined streams.
			</p><p>
				This example joins 2 event streams. The first event stream consists of fraud warning events for which it keep the last 30 minutes. The second stream is withdrawal events for which it considers the last 30 seconds. The streams are joined on account number.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select fraud.accountNumber as accntNum, fraud.warning as warn, withdraw.amount as amount,
       max(fraud.timestamp, withdraw.timestamp) as timestamp, 'withdrawlFraud' as desc
  from com.espertech.esper.example.atm.FraudWarningEvent#time(30 min) as fraud,
       com.espertech.esper.example.atm.WithdrawalEvent#time(30 sec) as withdraw
 where fraud.accountNumber = withdraw.accountNumber</pre><p>
				Joins can also include one or more pattern statements as the next example shows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from FraudWarningEvent#time(30 min) as fraud,
    pattern [every w=WithdrawalEvent -&gt; PINChangeEvent(acct=w.acct)]#lastevent as withdraw
 where fraud.accountNumber = withdraw.w.accountNumber</pre><p>
				The statement above joins the last 30 minutes of fraud warnings with a pattern. The pattern consists of every withdrawal event that is followed by a PIN change event for the same account number. It joins the two event streams on account number. The last-event window instucts the join to only consider the last pattern match.
			</p><p>
				In a join and outer join, your statement must declare a data window onto each stream. Streams that are marked as unidirectional and named windows and tables as well as database or methods in a join are an exception and do not require a data window. If you are joining an event to itself via contained-event selection, data windows also do not need to be specified. The reason that a data window must be declared is that a data window specifies which events are considered for the join (i.e. last event, last 10 events, all events, last 1 second of events etc.).
			</p><p>
				The next example joins all FraudWarningEvent events that arrived since the statement was started, with the last 20 seconds of PINChangeEvent events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from FraudWarningEvent#keepall as fraud, PINChangeEvent#time(20 sec) as pin
 where fraud.accountNumber = pin.accountNumber</pre><p>
				The above example employed the special keep-all window that retains all events.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-outerjoin"/>5.12.3.Â Outer, Left and Right Joins</h3></div></div></div><a id="d0e11118" class="indexterm"/><a id="d0e11121" class="indexterm"/><a id="d0e11124" class="indexterm"/><a id="d0e11129" class="indexterm"/><p>
				Esper supports left outer joins, right outer joins, full outer joins and inner joins in any combination between an unlimited number of event streams. Outer and inner joins can also join reference and historical data as explained in <a class="xref" href="#histdata_overview" title="5.13.Â Accessing Relational Data via SQL">SectionÂ 5.13, âAccessing Relational Data via SQLâ</a>, as well as join data returned by a method, script or UDF invocation as outlined in <a class="xref" href="#joining_method" title="5.14.Â Accessing Non-Relational Data via Method, Script or UDF Invocation">SectionÂ 5.14, âAccessing Non-Relational Data via Method, Script or UDF Invocationâ</a>.
			</p><p>
				The keywords <code class="literal">left, right, full</code> and <code class="literal">inner</code> control the type of the join between two streams. The optional <code class="literal">on</code> clause specifies one or more properties that join each stream. The synopsis is as follows:
			</p><pre class="synopsis">...from <span class="emphasis"><em>stream_def</em></span> [as name] 
  ((left|right|full outer) | inner) join <span class="emphasis"><em>stream_def</em></span> 
  [on <span class="emphasis"><em>property</em></span> = <span class="emphasis"><em>property</em></span> [and <span class="emphasis"><em>property</em></span> = <span class="emphasis"><em>property</em></span> ...] ]
  [ ((left|right|full outer) | inner) join <span class="emphasis"><em>stream_def</em></span> [on ...]]...
</pre><p>
				If the outer join is a left outer join, there will be at least one output event for each event of the stream on the left-hand side of the clause. For example, in the left outer join shown below you get output for each event in the stream RfidEvent, even if the event does not match any event in the event stream OrderList.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from RfidEvent#time(30 sec) as rfid
       left outer join
       OrderList#length(10000) as orderlist
     on rfid.itemId = orderList.itemId</pre><p>
				Similarly, if the join is a Right Outer Join, then there will be at least one output event for each event of the stream on the right-hand side of the clause. For example, in the right outer join shown below you get output for each event in the stream OrderList, even if the event does not match any event in the event stream RfidEvent.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from RfidEvent#time(30 sec) as rfid
       right outer join
       OrderList#length(10000) as orderlist
       on rfid.itemId = orderList.itemId</pre><p>
				For all types of outer joins, if the join condition is not met, the select list is computed with the event properties of the arrived event while all other event properties are considered to be null.
			</p><p>
				The next type of outer join is a full outer join. In a full outer join, each point in time that an event arrives to one of the event streams, one or more output events are produced. In the example below, when either an RfidEvent or an OrderList event arrive, one or more output event is produced. The next example shows a full outer join that joins on multiple properties:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from RfidEvent#time(30 sec) as rfid
       full outer join
       OrderList#length(10000) as orderlist
       on rfid.itemId = orderList.itemId and rfid.assetId = orderList.assetId</pre><p>
				The last type of join is an inner join. In an inner join, the engine produces at least one output event for each event of the stream on the left-hand side that matches at least one event on the right hand side considering the join properties. For example, in the inner join shown below you get output for each event in the RfidEvent stream that matches one or more events in the OrderList data window:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from RfidEvent#time(30 sec) as rfid
       inner join
       OrderList#length(10000) as orderlist
       on rfid.itemId = orderList.itemId and rfid.assetId = orderList.assetId</pre><p>
				Patterns as streams in a join follow this rule: If your query does not specify a data window for the pattern then the pattern stream retains the last match. Thus a pattern must have matched at least once for the last match to become available in a join. Multiple rows from a pattern stream may be retained by declaring a data window onto a pattern using the <code class="literal">pattern [...]#</code><span class="emphasis"><em>window_spec</em></span> syntax.
			</p><p>
				This example outer joins multiple streams. Here the RfidEvent stream is outer joined to both ProductName and LocationDescription via left outer join:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from RfidEvent#time(30 sec) as rfid
      left outer join ProductName#keepall as refprod
        on rfid.productId = refprod.prodId
      left outer join LocationDescription#keepall as refdesc
        on rfid.location = refdesc.locId</pre><p>
			  If the optional <code class="literal">on</code> clause is specified, it may only employ the <code class="literal">=</code> equals operator and property names. Any other operators must be placed in the <code class="literal">where</code>-clause.
			  The stream names that appear in the <code class="literal">on</code> clause may refer to any stream in the <code class="literal">from</code>-clause.
			</p><p>
			  Your EPL may also provide no <code class="literal">on</code> clause. This is useful when the streams that are joined do not provide any properties to join on, for example when joining with a time-based pattern. 
			</p><p>
				The next example employs a unidirectional left outer join such that the engine, every 10 seconds, outputs a count of the number of RfidEvent events in the 60-second time window.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*) from
  pattern[every timer:interval(1)] unidirectional 
  left outer join
  RfidEvent#time(60 sec)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-unidirectional"/>5.12.4.Â Unidirectional Joins</h3></div></div></div><a id="d0e11232" class="indexterm"/><a id="d0e11235" class="indexterm"/><a id="d0e11240" class="indexterm"/><p>
				In a join or outer join your statement lists multiple event streams, data windows and/or patterns in the <code class="literal">from</code> clause. As events arrive into the engine, each of the streams (data windows, patterns) provides insert and remove stream events. The engine evaluates each insert and remove stream event provided by each stream, and joins or outer joins each event against data window contents of each stream, and thus generates insert and remove stream join results.
			</p><p>
				The direction of the join execution depends on which stream or streams are currently providing an insert or remove stream event for executing the join. 
				A join is thus multidirectional, or bidirectional when only two streams are joined.
				A join can be made unidirectional if your application does not want new results when events arrive on a given stream or streams.
			</p><p>
				The <code class="literal">unidirectional</code> keyword can be used in the <code class="literal">from</code> clause to identify streams that provide the events to execute the join. If the keyword is present for a stream, all other streams in the <code class="literal">from</code> clause become passive streams. When events arrive or leave a data window of a passive stream then the join does not generate join results. 
			</p><p>
				For example, consider a use case that requires us to join stock tick events (TickEvent) and news events (NewsEvent). The <code class="literal">unidirectional</code> keyword allows to generate results only when TickEvent events arrive, and not when NewsEvent arrive or leave the 10-second time window:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TickEvent unidirectional, NewsEvent#time(10 sec) 
where tick.symbol = news.symbol</pre><p>
				Aggregation functions in a <code class="literal">unidirectional</code> join aggregate within the context of each unidirectional event evaluation and are not cumulative. Thereby aggregation functions when used with <code class="literal">unidirectional</code> may evaluate faster as they do not need to consider a remove stream (data removed from data windows or named windows).
			</p><p>
				The count function in the next query returns, for each TickEvent, the number of matching NewEvent events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*) from TickEvent unidirectional, NewsEvent#time(10 sec) 
where tick.symbol = news.symbol</pre><p>
				The following restrictions apply to unidirectional joins:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						The <code class="literal">unidirectional</code> keyword can only be specified for a single stream in the <code class="literal">from</code> clause, unless all streams are in a full outer join and all streams declare <code class="literal">unidirectional</code>.
					</p></li><li><p>
						Receiving data from a unidirectional join via the pull API (<code class="literal">iterator</code> method) is not allowed. This is because the engine holds no state for the single stream that provides the events to execute the join.
					</p></li><li><p>
						The stream that declares the <code class="literal">unidirectional</code> keyword cannot declare a data window for that stream, since remove stream events are not processed for the single stream.
					</p></li></ol></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-unidirectional-fullouterjoin"/>5.12.5.Â Unidirectional Full Outer Joins</h3></div></div></div><a id="d0e11312" class="indexterm"/><a id="d0e11315" class="indexterm"/><p>
				In a full outer join all streams can be marked as <code class="literal">unidirectional</code>. 
				This is useful for declaring multiple triggering events and for performing a union or merge of streams.
			</p><p>
				When marking more than one stream as unidirectional, all streams must be unidirectional and inner, left and right joins are not allowed. 
				This is because unidirectional streams have an undefined depth and cannot be looked-up against.
			</p><p>
				For example, consider a use case where output should occur when either a tick event or a news event arrives:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TickEvent as te unidirectional, 
  full outer join
  NewsEvent as ne unidirectional</pre><p>
				Place filter criteria for a given stream into parenthesis, for example:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TickEvent(symbol='IBM') unidirectional, 
  full outer join
  TradeEvent(symbol='IBM') unidirectional
  full outer join
  SettlementEvent(symbol='IBM') unidirectional
  where coalesce(TickEvent.price,TradeEvent.price) &gt; 100 // place common critera into a where-clause that may use coalesce</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-join-hints"/>5.12.6.Â Hints Related to Joins</h3></div></div></div><p>
				When joining 3 or more streams (including any relational or non-relational sources as below) it can sometimes help to provide the query planner instructions how to best execute the join. The engine compiles a query plan for the EPL statement at statement creation time. You can output the query plan to logging (see configuration).
			</p><p>
				An outer join that specifies only <code class="literal">inner</code> keywords for all streams is equivalent to an default (inner) join. The following two statements are equivalent:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TickEvent#lastevent, 
    NewsEvent#lastevent where tick.symbol = news.symbol</pre><p>
				Equivalent to:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TickEvent#lastevent 
	inner join NewsEvent#lastevent on tick.symbol = news.symbol</pre><p>
				For all types of joins, the query planner determines a query graph: The term is used here for all the information regarding what properties or expressions are used to join the streams. The query graph thus includes the where-clause expressions as well as outer-join on-clauses if this statement is an outer join. The query planner also computes a dependency graph which includes information about all historical data streams (relational and non-relational as below) and their input needs. 
			</p><p>
				For default (inner) joins the query planner first attempts to find a path of execution as a nested iteration. For each stream the query planner selects the best order of streams available for the nested iteration considering the query graph and dependency graph. If the full depth of the join is achievable via nested iteration for all streams without full table scan then the query planner uses that nested iteration plan. If not, then the query planner re-plans considering a merge join (Cartesian) approach instead.
			</p><p>
				Specify the @Hint('prefer_merge_join') to instruct the query planner to prefer a merge join plan instead of a nested iteration plan. Specify the @Hint('force_nested_iter') to instruct the query planner to always use a nested iteration plan. 
			</p><p>
				For example, consider the below statement. Depending on the number of matching rows in OrderBookOne and OrderBookTwo (named windows in this example, and assumed to be defined elsewhere) the performance of the join may be better using the merge join plan.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Hint('prefer_merge_join') 
select * from TickEvent#lastevent t, 
	OrderBookOne ob1, OrderBookOne ob2
where ob1.symbol = t.symbol and ob2.symbol = t.symbol 
and ob1.price between t.buy and t.sell and ob2.price between t.buy and t.sell</pre><p>
				For outer joins the query planner considers nested iteration and merge join (Cartesian) equally and above hints don't apply.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="histdata_overview"/>5.13.Â Accessing Relational Data via SQL</h2></div></div></div><a id="d0e11366" class="indexterm"/><a id="d0e11369" class="indexterm"/><a id="d0e11374" class="indexterm"/><a id="d0e11377" class="indexterm"/><p>
			For NEsper .NET also see <a class="xref" href="#appendix_dotnet_histdata_overview" title="I.13.Â .NET Accessing Relational Data via SQL">SectionÂ I.13, â.NET Accessing Relational Data via SQLâ</a>.
		</p><p>
			This chapter outlines how reference data and historical data that are stored in a relational database can be queried via SQL within EPL statements. 
		</p><p>
			Esper can access via join and outer join as well as via iterator (poll) API all types of event streams to stored data. In order for such data sources to become accessible to Esper, some configuration is required. The <a class="xref" href="#config-database-ref" title="15.4.11.Â Relational Database Access">SectionÂ 15.4.11, âRelational Database Accessâ</a> explains the required configuration for database access in greater detail, and includes information on configuring a query result cache.
		</p><p>
			Esper does not parse or otherwise inspect your SQL query. Therefore your SQL can make use of any database-specific SQL language extensions or features that your database provides.
		</p><p>
			If you have enabled query result caching in your Esper database configuration, Esper retains SQL query results in cache following the configured cache eviction policy. 
		</p><p>
			Also if you have enabled query result caching in your Esper database configuration and provide EPL <code class="literal">where</code> clause and/or <code class="literal">on</code> clause (outer join) expressions, then 
			Esper builds indexes on the SQL query results to enable fast lookup. This is especially useful if your queries return a large number of rows. For building the proper indexes, Esper inspects the expression found in your EPL query <code class="literal">where</code> clause, if present. For outer joins, Esper also inspects your EPL query <code class="literal">on</code> clause. Esper analyzes the EPL <code class="literal">on</code> clause and <code class="literal">where</code> clause expressions, if present, looking for property comparison with or without logical AND-relationships between properties. When a SQL query returns rows for caching, Esper builds and caches the appropriate index and lookup strategies for fast row matching against indexes.
		</p><p>
			Joins or outer joins in which only SQL statements or method, script and UDF invocations are listed in the <code class="literal">from</code> clause and no other event streams are termed <span class="emphasis"><em>passive</em></span> joins. A passive join does not produce an insert or remove stream and therefore does not invoke statement listeners with results. A passive join can be iterated on (polled) using a statement's <code class="literal">safeIterator</code> and <code class="literal">iterator</code> methods.
		</p><p>
			There are no restrictions to the number of SQL statements or types of streams joined. The following restrictions currently apply:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					An SQL query cannot declare data windows; That is, you cannot create a time or length window on an SQL query. Instead, use <code class="literal">insert into</code> to make join results available for further processing.
				</p></li><li><p>
					Your database software must support JDBC prepared statements that provide statement meta data at compilation time. Most major databases provide this function. A workaround is available for databases that do not provide this function.
				</p></li><li><p>
					JDBC drivers must support the getMetadata feature. A workaround is available as below for JDBC drivers that don't support getting metadata.
				</p></li></ul></div><p>
			The next sections assume basic knowledge of SQL (Structured Query Language).
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="histdata_join"/>5.13.1.Â Joining SQL Query Results</h3></div></div></div><p>
				To join an event stream against stored data, specify the <code class="literal">sql</code> keyword followed by the name of the database and a parameterized SQL query. The syntax to use in the <code class="literal">from</code> clause of an EPL statement is:
			</p><pre class="synopsis">sql:<span class="emphasis"><em>database_name</em></span> [" <span class="emphasis"><em>parameterized_sql_query</em></span> "]</pre><p>
				The engine uses the <span class="emphasis"><em>database_name</em></span> identifier to obtain configuration information in order to establish a database connection, as well as settings that control connection creation and removal. Please see <a class="xref" href="#config-database-ref" title="15.4.11.Â Relational Database Access">SectionÂ 15.4.11, âRelational Database Accessâ</a> to configure an engine for database access.
			</p><p>
				Following the database name is the SQL query to execute. The SQL query can contain one or more substitution parameters. The SQL query string is placed in single brackets <code class="literal">[</code> and <code class="literal">]</code>. The SQL query can be placed in either single quotes (') or double quotes ("). The SQL query grammer is passed to your database software unchanged, allowing you to write any SQL query syntax that your database understands, including stored procedure calls.
			</p><p>
				Substitution parameters in the SQL query string take the form <code class="literal">${</code><span class="emphasis"><em>expression</em></span><code class="literal">}</code>. The engine resolves <span class="emphasis"><em>expression</em></span> at statement execution time to the actual expression result by evaluating the events in the joined event stream or current variable values, if any event property references or variables occur in the expression. An <span class="emphasis"><em>expression</em></span> may not contain EPL substitution parameters.
			</p><p>
				The engine determines the type of the SQL query output columns by means of the result set metadata that your database software returns for the statement. The actual 
				query results are obtained via the <code class="literal">getObject</code> on <code class="literal">java.sql.ResultSet</code>.
			</p><p>
				The sample EPL statement below joins an event stream consisting of <code class="literal">CustomerCallEvent</code> events with the results of an SQL query against the database named <code class="literal">MyCustomerDB</code> and table <code class="literal">Customer</code>: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select custId, cust_name from CustomerCallEvent,
  sql:MyCustomerDB [' select cust_name from Customer where cust_id = ${custId} ']</pre><p>
				The example above assumes that <code class="literal">CustomerCallEvent</code> supplies an event property named <code class="literal">custId</code>. The SQL query selects the customer name from the Customer table. The <code class="literal">where</code> clause in the SQL matches the Customer table column <code class="literal">cust_id</code> with the value of <code class="literal">custId</code> in each <code class="literal">CustomerCallEvent</code> event. The engine executes the SQL query for each new <code class="literal">CustomerCallEvent</code> encountered.
			</p><p>
				If the SQL query returns no rows for a given customer id, the engine generates no output event. Else the engine generates one output event for each row returned by the SQL query. An outer join as described in the next section can be used to control whether the engine should generate output events even when the SQL query returns no rows.
			</p><p>
				The next example adds a time window of 30 seconds to the event stream <code class="literal">CustomerCallEvent</code>. It also renames the selected properties to customerName and customerId to demonstrate how the naming of columns in an SQL query can be used in the <code class="literal">select</code> clause in the EPL query. And the example uses explicit stream names via the <code class="literal">as</code> keyword.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select customerId, customerName from
  CustomerCallEvent#time(30 sec) as cce,
  sql:MyCustomerDB ["select cust_id as customerId, cust_name as customerName from Customer 
                  where cust_id = ${cce.custId}"] as cq</pre><p>
				Any window, such as the time window, generates insert stream (istream) events as events enter the window, and remove stream (rstream) events as events leave the window. The engine executes the given SQL query for each <code class="literal">CustomerCallEvent</code> in both the insert stream and the remove stream. As a performance optimization, the <code class="literal">istream</code> or <code class="literal">rstream</code> keywords in the <code class="literal">select</code> clause can be used to instruct the engine to only join insert stream or remove stream events, reducing the number of SQL query executions.
			</p><p>
				Since any expression may be placed within the <code class="literal">${...}</code> syntax, you may use variables or user-defined functions as well.
			</p><p>
				The next example assumes that a variable by name <code class="literal">varLowerLimit</code> is defined and that a user-defined function <code class="literal">getLimit</code> exists on the <code class="literal">MyLib</code> imported class that takes a <code class="literal">LimitEvent</code> as a parameter:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from LimitEvent le, 
  sql:MyCustomerDB [' select cust_name from Customer where 
      amount &gt; ${max(varLowerLimit, MyLib.getLimit(le))} ']</pre><p>
				The example above takes the higher of the current variable value or the value returned by the user-defined function to return only those customer names where the amount exceeds the computed limit.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="histdata_join_where"/>5.13.2.Â SQL Query and the EPL <code class="literal">Where</code> Clause</h3></div></div></div><p>
				Consider using the EPL <code class="literal">where</code> clause to join the SQL query result to your event stream. Similar to EPL joins and outer-joins that join event streams or patterns, the EPL <code class="literal">where</code> clause provides join criteria between the SQL query results and the event stream (as a side note, an SQL <code class="literal">where</code> clause is a filter of rows executed by your database on your database server before returning SQL query results).
			</p><p>
				Esper analyzes the expression in the EPL <code class="literal">where</code> clause and outer-join <code class="literal">on</code> clause, if present, and builds the appropriate indexes from that information at runtime, to ensure fast matching of event stream events to SQL query results, even if your SQL query returns a large number of rows. Your applications must ensure to configure a cache for your database using Esper configuration, as such indexes are held with regular data in a cache. If you application does not enable caching of SQL query results, the engine does not build indexes on cached data.
			</p><p>
				The sample EPL statement below joins an event stream consisting of <code class="literal">OrderEvent</code> events with the results of an SQL query against the database named <code class="literal">MyRefDB</code> and table <code class="literal">SymbolReference</code>: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, symbolDesc from OrderEvent as orders,
  sql:MyRefDB ['select symbolDesc from SymbolReference'] as reference
  where reference.symbol = orders.symbol</pre><p>
				Notice how the EPL <code class="literal">where</code> clause joins the <code class="literal">OrderEvent</code> stream to the <code class="literal">SymbolReference</code> table. In this example, the SQL query itself does not have a SQL <code class="literal">where</code> clause 
				and therefore returns all rows from table <code class="literal">SymbolReference</code>.
			</p><p>
				If your application enables caching, the SQL query fires only at the arrival of the first <code class="literal">OrderEvent</code> event. When the second <code class="literal">OrderEvent</code> arrives, the join execution uses the cached query result. If the caching policy that you specified in the Esper database configuration evicts the SQL query result from cache, then the engine fires the SQL query again to obtain a new result and places the result in cache.
			</p><p>
				If SQL result caching is enabled and your EPL <code class="literal">where</code> clause, as show in the above example, provides the properties to join, then the engine indexes the SQL query results in cache and retains the index together with the query result in cache. Thus your application can benefit from high performance index-based lookups as long as the SQL query results are found in cache. 
			</p><p>
				The SQL result caches operate on the level of all result rows for a given parameter set. For example, if your query returns 10 rows for a certain set of parameter values then the cache treats all 10 rows as a single entry keyed by the parameter values, and the expiry policy applies to all 10 rows and not to each individual row.
			</p><p>
				It is also possible to join multiple autonomous database systems in a single query, for example:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, symbolDesc from OrderEvent as orders,
  sql:My_Oracle_DB ['select symbolDesc from SymbolReference'] as reference,
  sql:My_MySQL_DB ['select orderList from orderHistory'] as history
  where reference.symbol = orders.symbol
  and history.symbol = orders.symbol </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="histdata_outerjoin"/>5.13.3.Â Outer Joins With SQL Queries</h3></div></div></div><p>
				You can use outer joins to join data obtained from an SQL query and control when an event is produced. Use a left outer join, such as in the next statement, if you need an output event for each event regardless of whether or not the SQL query returns rows. If the SQL query returns no rows, the join result populates null values into the selected properties.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select custId, custName from
  CustomerCallEvent as cce
  left outer join 
  sql:MyCustomerDB ["select cust_id, cust_name as custName 
                     from Customer where cust_id = ${cce.custId}"] as cq
  on cce.custId = cq.cust_id</pre><p>
				The statement above always generates at least one output event for each <code class="literal">CustomerCallEvent</code>, containing all columns selected by the SQL query, even if the SQL query does not return any rows. Note the <code class="literal">on</code> expression that is required for outer joins. The <code class="literal">on</code> acts as an additional filter to rows returned by the SQL query.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="histdata_polling_pattern"/>5.13.4.Â Using Patterns to Request (Poll) Data</h3></div></div></div><p>
				Pattern statements and SQL queries can also be applied together in useful ways. One such use is to poll or request data from a database at regular intervals or following the schedule of the crontab-like <code class="literal">timer:at</code>.
			</p><p>
				The next statement is an example that shows a pattern that fires every 5 seconds to query the NewOrder table for new orders:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into NewOrders
select orderId, orderAmount from
  pattern [every timer:interval(5 sec)],
  sql:MyCustomerDB ['select orderId, orderAmount from NewOrders']</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="histdata_polling"/>5.13.5.Â Polling SQL Queries via Iterator</h3></div></div></div><p>
				Usually your SQL query will take part in a join and thus be triggered by an event or pattern occurrence. Instead, your application may need to poll a SQL query and thus use Esper query execution and caching facilities and obtain event data and metadata.
			</p><p>
				Your EPL statement can specify an SQL statement without a join. Such a stand-alone SQL statement does not post new events, and may only be queried via the <code class="literal">iterator</code> poll API. Your EPL and SQL statement may still use variables.
			</p><p>
				The next statement assumes that a <code class="literal">price_var</code> variable has been declared. It selects from the relational database table named <code class="literal">NewOrder</code> all rows in which the <code class="literal">price</code> column is greater 
				then the current value of the <code class="literal">price_var</code> EPL variable:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from sql:MyCustomerDB ['select * from NewOrder where ${price_var} &gt; price']</pre><p>
				Use the <code class="literal">iterator</code> and <code class="literal">safeIterator</code> methods on <code class="literal">EPStatement</code> to obtain results. The statement does not post events to listeners, it is strictly passive in that sense.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="histdata_implementation"/>5.13.6.Â JDBC Implementation Overview</h3></div></div></div><p>
				The engine translates SQL queries into JDBC <code class="literal">java.sql.PreparedStatement</code> statements by replacing ${name} parameters with '?' placeholders. It obtains name and type of result columns from the compiled <code class="literal">PreparedStatement</code> meta data when the EPL statement is created.
			</p><p>
				The engine supplies parameters to the compiled statement via the <code class="literal">setObject</code> method on <code class="literal">PreparedStatement</code>. The engine uses the <code class="literal">getObject</code> method on the compiled statement <code class="literal">PreparedStatement</code> to obtain column values.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="histdata_nometadata"/>5.13.7.Â Oracle Drivers and No-Metadata Workaround</h3></div></div></div><p>
			   Certain JDBC database drivers are known to not return metadata for precompiled prepared SQL statements. This can be a problem as metadata is required by Esper. Esper obtains SQL result set metadata to validate an EPL statement and to provide column types for output events. JDBC drivers that do not provide metadata for precompiled SQL statements require a workaround. Such drivers do generally provide metadata for executed SQL statements, however do not provide the metadata for precompiled SQL statements.
			</p><p>
				Please consult the <a class="xref" href="#configuration" title="ChapterÂ 15.Â Configuration">ChapterÂ 15, <i>Configuration</i></a> for the configuration options available in relation to metadata retrieval.
			</p><p>
				To obtain metadata for an SQL statement, Esper can alternatively fire a SQL statement which returns the same column names and types as the actual SQL statement but without returning any rows. This kind of SQL statement is referred to as a <span class="emphasis"><em>sample</em></span> statement in below workaround description. The engine can then use the sample SQL statement to retrieve metadata for the column names and types returned by the actual SQL statement.
			</p><p>
				Applications can provide a sample SQL statement to retrieve metadata via the <code class="literal">metadatasql</code> keyword:
			</p><pre class="synopsis">sql:<span class="emphasis"><em>database_name</em></span> ["<span class="emphasis"><em>parameterized_sql_query</em></span>" metadatasql "<span class="emphasis"><em>sql_meta_query</em></span>"] </pre><p>
				The <span class="emphasis"><em>sql_meta_query</em></span> must be an SQL statement that returns the same number of columns, the same type of columns and the same column names as the 
				<span class="emphasis"><em>parameterized_sql_query</em></span>, and does not return any rows.
			</p><p>
				Alternatively, applications can choose not to provide an explicit sample SQL statement. If the EPL statement does not use the <code class="literal">metadatasql</code> syntax, the engine applies lexical analysis to the SQL statement. From the lexical analysis Esper generates a sample SQL statement adding a restrictive clause "where 1=0"  to the SQL statement.
			</p><p>
				Alternatively, you can add the following tag to the SQL statement: <code class="literal">${$ESPER-SAMPLE-WHERE}</code>. If the tag  exists in the SQL statement, the engine does not perform lexical analysis and simply replaces the 
				tag with the SQL <code class="literal">where</code> clause "where 1=0". Therefore this workaround is applicable to SQL statements that cannot be correctly lexically analyzed. The SQL text after the placeholder is not part of the sample query. For example:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select mycol from sql:myDB [
  'select mycol from mytesttable ${$ESPER-SAMPLE-WHERE} where ....'], ...</pre><p>
				If your <span class="emphasis"><em>parameterized_sql_query</em></span> SQL query contains vendor-specific SQL syntax, generation of the metadata query may fail to produce a valid SQL statement. If you experience an SQL error while fetching metadata, use any of the above workarounds with the Oracle JDBC driver. 
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="histdata_convert_cols"/>5.13.8.Â SQL Input Parameter and Column Output Conversion</h3></div></div></div><p>
			   As part of database access configuration you may optionally specify SQL type mappings. These mappings apply to all queries against the same database identified by name.
			</p><p>
			  If your application must perform SQL-query-specific or EPL-statement-specific mapping or conversion between types, the facility to register a conversion callback exists as follows.
			</p><p>
			  Use the <code class="literal">@Hook</code> instruction and <code class="literal">HookType.SQLCOL</code> as part of your EPL statement text to register a statement SQL parameter or column conversion hook. 
			  Implement the interface <code class="literal">com.espertech.esper.client.hook.SQLColumnTypeConversion</code> to perform the input parameter or column value conversion.
			</p><p>
			  A sample statement with annotation is shown:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Hook(type=HookType.SQLCOL, hook='MyDBTypeConvertor')
select * from sql:MyDB ['select * from MyEventTable]</pre><p>
			  The engine expects <code class="literal">MyDBTypeConvertor</code> to resolve to a class (considering engine imports) and instantiates one instance of MyDBTypeConvertor for each statement.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="histdata_convert_row"/>5.13.9.Â SQL Row POJO Conversion</h3></div></div></div><p>
			   Your application may also directly convert a SQL result row into a Java class which is an opportunity for your application to interrogate and transform the SQL row result data freely before packing the data into a 
			   Java class. Your application can additionally indicate to skip SQL result rows.
			</p><p>
			  Use the <code class="literal">@Hook</code> instruction and <code class="literal">HookType.SQLROW</code> as part of your EPL statement text to register a statement SQL output row conversion hook. 
			  Implement the interface <code class="literal">com.espertech.esper.client.hook.SQLOutputRowConversion</code> to perform the output row conversion.
			</p><p>
			  A sample statement with annotation is shown:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Hook(type=HookType.SQLROW, hook='MyDBRowConvertor')
select * from sql:MyDB ['select * from MyEventTable]</pre><p>
			  The engine expects <code class="literal">MyDBRowConvertor</code> to resolve to a class (considering engine imports) and instantiates one MyDBRowConvertor instance for each statement.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="joining_method"/>5.14.Â Accessing Non-Relational Data via Method, Script or UDF Invocation</h2></div></div></div><a id="d0e11871" class="indexterm"/><a id="d0e11876" class="indexterm"/><p>
			Your application may need to join data that originates from a web service, a distributed cache, an object-oriented database or simply data held in memory by your application. 
			One way to join in external data is by means of method, script or user-defined function invocation (or procedure call or function) in the <code class="literal">from</code> clause of a statement. 
		</p><p>
			The results of such a method, script or UDF invocation in the <code class="literal">from</code> clause plays the same role as a relational database table in an inner and outer join in SQL.
		</p><p>
			Esper can join and outer join an unlimited number and all types of event streams to the data returned by your invocation. In addition, Esper can be configured to cache the data returned by your method, script or UDF invocations.
		</p><p>
			Joins or outer joins in which only SQL statements or method, script or UDF invocations are listed in the <code class="literal">from</code> clause and no other event streams are termed <span class="emphasis"><em>passive</em></span> joins. A passive join does not produce an insert or remove stream and therefore does not invoke statement listeners with results. A passive join can be iterated on (polled) using a statement's <code class="literal">safeIterator</code> and <code class="literal">iterator</code> methods.
		</p><p>
			The following restrictions currently apply:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					A invocation cannot declare data windows; That is, you cannot create a time or length window on an invocation. Instead, use <code class="literal">insert into</code> to make join results available for further processing.
				</p></li></ul></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="joining_method_syntax"/>5.14.1.Â Joining Method, Script or UDF Invocation Results</h3></div></div></div><p>
				The syntax for a method, script or UDF invocation in the <code class="literal">from</code> clause of an EPL statement is:
			</p><pre class="synopsis">method: [<span class="emphasis"><em>class_or_variable_name</em></span>.]<span class="emphasis"><em>method_script_udf_name</em></span>[(<span class="emphasis"><em>parameter_expressions</em></span>)] [@type(<span class="emphasis"><em>eventtype_name</em></span>)]</pre><p>
				The <code class="literal">method</code> keyword denotes a method, script or UDF invocation. It is followed by an optional class or variable name.
				The <span class="emphasis"><em>method_script_udf_name</em></span> is the name of the method, script or user-defined function.
				If you have parameters to your method, script or UDF invocation, these are placed in 
				parentheses after the method or script name. Any expression is allowed as a parameter, and individual parameter expressions are separated by a comma. 
				Expressions may also use event properties of the joined stream. 
			</p><p>
				In case the return type of the method is <code class="literal">EventBean</code> instances, you must provide the <code class="literal">@type</code> annotation to name the event type of events returned. 
				Otherwise <code class="literal">@type</code> is not allowed.
			</p><p>
				In the sample join statement shown next, the method <code class="literal">lookupAsset</code> provided by class (or variable) <code class="literal">MyLookupLib</code> returns one or more rows based on the asset id (a property of the <code class="literal">AssetMoveEvent</code>) that is passed to the method:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from AssetMoveEvent, method:MyLookupLib.lookupAsset(assetId)</pre><p>
				The following statement demonstrates the use of the <code class="literal">where</code> clause to join events to the rows returned by an invocation, which in this example does not take parameters:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select assetId, assetDesc from AssetMoveEvent as asset, 
       method:MyLookupLib.getAssetDescriptions() as desc 
where asset.assetid = desc.assetid</pre><p>
				Your method, scipt or UDF invocation may return zero, one or many rows for each invocation. If you have caching enabled through configuration, then Esper can avoid the invocation and instead use cached results. Similar to SQL joins, Esper also indexes cached result rows such that join operations based on the <code class="literal">where</code> clause or outer-join <code class="literal">on</code> clause can be very efficient, especially if your invocation returns a large number of rows.
			</p><p>
				If the time taken by method, script or UDF invocations is critical to your application, you may configure local caches as <a class="xref" href="#config-method-invocations" title="15.4.9.Â Cache Settings for From-Clause Method Invocations">SectionÂ 15.4.9, âCache Settings for From-Clause Method Invocationsâ</a> describes.
			</p><p>
				Esper analyzes the expression in the EPL <code class="literal">where</code> clause and outer-join <code class="literal">on</code> clause, if present, and builds the appropriate indexes from that information at runtime, to ensure fast matching of event stream events to invocation results, even if your invocation returns a large number of rows. Your applications must ensure to configure a cache for your invocation using Esper configuration, as such indexes are held with regular data in a cache. If you application does not enable caching of invocation results, the engine does not build indexes on cached data.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="joining_method_polling"/>5.14.2.Â Polling Invocation Results via Iterator</h3></div></div></div><p>
				Usually your invocation will take part in a join and thus be triggered by an event or pattern occurrence. Instead, your application may need to poll an invocation and thus use Esper query execution and caching facilities and obtain event data and metadata.
			</p><p>
				Your EPL statement can specify an invocation in the <code class="literal">from</code> clause without a join. Such a stand-alone invocation does not post new events, and may only be queried via the <code class="literal">iterator</code> poll API. Your EPL statement may still use variables.
			</p><p>
				The next statement assumes that a <code class="literal">category_var</code> variable has been declared. It polls the <code class="literal">getAssetDescriptions</code> method passing the current value of the <code class="literal">category_var</code> EPL variable:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from method:MyLookupLib.getAssetDescriptions(category_var)]</pre><p>
				Use the <code class="literal">iterator</code> and <code class="literal">safeIterator</code> methods on <code class="literal">EPStatement</code> to obtain results. The statement does not post events to listeners, it is strictly passive in that sense.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="joining_method_exposing"/>5.14.3.Â Providing the Method</h3></div></div></div><p>
				You application can provide a public static method or can provide an instance method of an existing object.
				The method must accept the same number and type of parameters as listed in the parameter expression list. 
			</p><p>
				The examples herein mostly use public static methods. For a detail description of instance methods please see <a class="xref" href="#variable_eventtype" title="5.17.5.Â Class and Event-Type Variables">SectionÂ 5.17.5, âClass and Event-Type Variablesâ</a> and below example.
			</p><p>
				If your invocation returns either no row or only one row, then the return type of the method can be a Java class, <code class="literal">java.util.Map</code> or <code class="literal">Object[]</code> (object-array). If your invocation can return more then one row, then the return type of the method must be an array of Java class, array of <code class="literal">Map</code>, <code class="literal">Object[][]</code> (object-array 2-dimensional) or
				<code class="literal">Collection</code> or <code class="literal">Iterator</code> (or subtypes thereof).
			</p><p>
				If you are using a Java class, an array of Java class or a <code class="literal">Collection&lt;Class&gt;</code> or an <code class="literal">Iterator&lt;Class&gt;</code> as the return type, then the class must adhere to JavaBean conventions: it must expose properties through getter methods.
			</p><p>
				If you are using <code class="literal">java.util.Map</code> or an array of <code class="literal">Map</code> or a <code class="literal">Collection&lt;Map&gt;</code> or an <code class="literal">Iterator&lt;Map&gt;</code> as the return type, please note the following:
			</p><div class="itemizedlist"><ul><li>
					Your application must provide a second method that returns event property metadata, as the next section outlines.
				</li><li>
					Each map instance returned by your method should have <code class="literal">String</code>-type keys and object values (<code class="literal">Map&lt;String, Object&gt;</code>).
				</li></ul></div><p>
				If you are using <code class="literal">Object[]</code> (object-array) or <code class="literal">Object[][]</code> (object-array 2-dimensional) or <code class="literal">Collection&lt;Object[]&gt;</code> or <code class="literal">Iterator&lt;Object[]&gt;</code> as the return type, please note the following:
			</p><div class="itemizedlist"><ul><li>
					Your application must provide a second method that returns event property metadata, as the next section outlines.
				</li><li>
					Each object-array instance returned by your method should have the exact same array position for values as the property metadata indicates and the array length must be the same as the 
					number of properties.
				</li></ul></div><p>
				Your application method must return either of the following:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						A <code class="literal">null</code> value or an empty array to indicate an empty result (no rows).
					</p></li><li><p>
						A Java object or <code class="literal">Map</code> or <code class="literal">Object[]</code> to indicate a zero (null) or one-row result.
					</p></li><li><p>
						 Return multiple result rows by returning either:
					</p><div class="itemizedlist"><ul><li>
							An array of Java objects.
						</li><li>
							An array of <code class="literal">Map</code> instances.
						</li><li>
							An array of <code class="literal">Object[]</code> instances.
						</li><li>
							An array of <code class="literal">EventBean[]</code> instances (requires <code class="literal">@type</code>).
						</li><li>
							A <code class="literal">Collection</code> of Java objects.
						</li><li>
							A <code class="literal">Collection</code> of <code class="literal">Map</code> instances.
						</li><li>
							A <code class="literal">Collection</code> of <code class="literal">Object[]</code> instances.
						</li><li>
							An <code class="literal">Collection</code> of <code class="literal">EventBean[]</code> instances (requires <code class="literal">@type</code>).
						</li><li>
							An <code class="literal">Iterator</code> of Java objects.
						</li><li>
							An <code class="literal">Iterator</code> of <code class="literal">Map</code> instances.
						</li><li>
							An <code class="literal">Iterator</code> of <code class="literal">Object[]</code> instances.
						</li><li>
							An <code class="literal">Iterator</code> of <code class="literal">EventBean[]</code> instances (requires <code class="literal">@type</code>).
						</li></ul></div></li></ol></div><p>
				As an example, consider the method 'getAssetDescriptions' provided by class 'MyLookupLib' as discussed earlier:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select assetId, assetDesc from AssetMoveEvent as asset,
       method:com.mypackage.MyLookupLib.getAssetDescriptions() as desc 
  where asset.assetid = desc.assetid</pre><p>
				The 'getAssetDescriptions' method may return multiple rows and is therefore declared to return an array of the class 'AssetDesc'. The class AssetDesc is a POJO class (not shown here):
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyLookupLib {
  ...
  public static AssetDesc[] getAssetDescriptions() {
    ...
    return new AssetDesc[] {...};
  }</pre><p>
				The example above specifies the full Java class name of the class 'MyLookupLib' class in the EPL statement. The package name does not need to be part of the EPL if your application imports the package using the auto-import configuration through the API or XML, as outlined in <a class="xref" href="#config-class--package-imports" title="15.4.7.Â Class and Package Imports">SectionÂ 15.4.7, âClass and Package Importsâ</a>.
			</p><p>
				Alternatively the example above could return a <code class="literal">Collection</code> wherein the method declares as <code class="literal">public static Collection&lt;AssetDesc&gt; getAssetDescriptions() {...}</code> or an <code class="literal">Iterator</code> wherein the method declares as <code class="literal">public static Iterator&lt;AssetDesc&gt; getAssetDescriptions() {...}</code>.
			</p><p>
				Method overloading is allowed as long as overloaded methods return the same result type.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="joining_method_exposing_instance"/>5.14.3.1.Â Providing an Instance Method</h4></div></div></div><p>
					If you application has an existing object instance such as a service or a dependency injected bean then it must make the instance available as a variable. Please see <a class="xref" href="#variable_eventtype" title="5.17.5.Â Class and Event-Type Variables">SectionÂ 5.17.5, âClass and Event-Type Variablesâ</a>
					for more information.
				</p><p>
					For example, assuming you provided a <code class="literal">stateChecker</code> variable that points to an object instance that provides a public <code class="literal">getMatchingAssets</code> instance method
					and that returns property <code class="literal">assetIds</code>, you may use the state checker service in the <code class="literal">from</code>-clause as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select assetIds from AssetMoveEvent, method:stateChecker.getMatchingAssets(assetDesc)</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="joining_method_map"/>5.14.4.Â Using a <code class="literal">Map</code> Return Type</h3></div></div></div><p>
				Your application may return <code class="literal">java.util.Map</code> or an array of <code class="literal">Map</code> from invocations. If doing so, your application must provide metadata about each row: it must declare the property name and property type of each <code class="literal">Map</code> entry of a row. This information allows the engine to perform type checking of expressions used within the statement.
			</p><p>
				You declare the property names and types of each row by providing a method that returns property metadata. The metadata method must follow these conventions:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						The method name providing the property metadata must have same method name appended by the literal <code class="literal">Metadata</code>.
					</p></li><li><p>
						The method must have an empty parameter list and must be declared public and static.
					</p></li><li><p>
						The method providing the metadata must return a <code class="literal">Map</code> of <code class="literal">String</code> property name keys and <code class="literal">java.lang.Class</code> property name types (<code class="literal">Map&lt;String, Class&gt;</code>).
					</p></li></ol></div><p>
				In the following example, a class 'MyLookupLib' provides a method to return historical data based on asset id and asset code:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select assetId, location, x_coord, y_coord from AssetMoveEvent as asset,
       method:com.mypackage.MyLookupLib.getAssetHistory(assetId, assetCode) as history</pre><p>
				A sample implementation of the class 'MyLookupLib' is shown below. 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyLookupLib {
  ...
  // For each column in a row, provide the property name and type
  //
  public static Map&lt;String, Class&gt; getAssetHistoryMetadata() {
    Map&lt;String, Class&gt; propertyNames = new HashMap&lt;String, Class&gt;();
    propertyNames.put("location", String.class);
    propertyNames.put("x_coord", Integer.class);
    propertyNames.put("y_coord", Integer.class);
    return propertyNames;
  }
... 
  // Lookup rows based on assetId and assetCode
  // 
  public static Map&lt;String, Object&gt;[] getAssetHistory(String assetId, String assetCode) {
    Map rows = new Map[2];	// this sample returns 2 rows
    for (int i = 0; i &lt; 2; i++) {
      rows[i] = new HashMap();
      rows[i].put("location", "somevalue");
      rows[i].put("x_coord", 100);
      // ... set more values for each row
    }
    return rows;
  }</pre><p>
				In the example above, the 'getAssetHistoryMetadata' method provides the property metadata: the names and types of properties in each row.  The engine calls this method once per statement to determine event typing information.
			</p><p>
				The 'getAssetHistory' method returns an array of <code class="literal">Map</code> objects that are two rows. The implementation shown above is a simple example. The parameters to the method are the assetId and assetCode properties of the AssetMoveEvent joined to the method. The engine calls this method for each insert and remove stream event in AssetMoveEvent.
			</p><p>
				To indicate that no rows are found in a join, your application method may return either a <code class="literal">null</code> value or an array of size zero.
			</p><p>
				Alternatively the example above could return a <code class="literal">Collection</code> wherein the method declares as <code class="literal">public static Collection&lt;Map&gt; getAssetHistory() {...}</code> or an <code class="literal">Iterator</code> wherein the method declares as <code class="literal">public static Iterator&lt;Map&gt; getAssetHistory() {...}</code>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="joining_method_oa"/>5.14.5.Â Using a Object Array Return Type</h3></div></div></div><p>
				Your application may return <code class="literal">Object[]</code> (object-array) or an array of <code class="literal">Object[]</code> (object-array 2-dimensional) from invocations. If doing so, your application must provide metadata about each row: it must declare the property name and property type of each array entry of a row in the exact same order as provided by value rows. This information allows the engine to perform type checking of expressions used within the statement.
			</p><p>
				You declare the property names and types of each row by providing a method that returns property metadata. The metadata method must follow these conventions:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						The method name providing the property metadata must have same method name appended by the literal <code class="literal">Metadata</code>.
					</p></li><li><p>
						The method must have an empty parameter list and must be declared public and static.
					</p></li><li><p>
						The method providing the metadata must return a <code class="literal">LinkedHashMap</code> of <code class="literal">String</code> property name keys and <code class="literal">java.lang.Class</code> property name types (<code class="literal">Map&lt;String, Class&gt;</code>).
					</p></li></ol></div><p>
				In the following example, a class 'MyLookupLib' provides a method to return historical data based on asset id and asset code:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select assetId, location, x_coord, y_coord from AssetMoveEvent as asset,
       method:com.mypackage.MyLookupLib.getAssetHistory(assetId, assetCode) as history</pre><p>
				A sample implementation of the class 'MyLookupLib' is shown below. 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyLookupLib {
  ...
  // For each column in a row, provide the property name and type
  //
  public static LinkedHashMap&lt;String, Class&gt; getAssetHistoryMetadata() {
    LinkedHashMap&lt;String, Class&gt; propertyNames = new LinkedHashMap&lt;String, Class&gt;();
    propertyNames.put("location", String.class);
    propertyNames.put("x_coord", Integer.class);
    propertyNames.put("y_coord", Integer.class);
    return propertyNames;
  }
... 
  // Lookup rows based on assetId and assetCode
  // 
  public static Object[][] getAssetHistory(String assetId, String assetCode) {
    Object[][] rows = new Object[5][];	// this sample returns 5 rows
    for (int i = 0; i &lt; 5; i++) {
      rows[i] = new Object[2]; // single row has 2 fields
      rows[i][0]  = "somevalue";
      rows[i][1] = 100;
      // ... set more values for each row
    }
    return rows;
  }</pre><p>
				In the example above, the 'getAssetHistoryMetadata' method provides the property metadata: the names and types of properties in each row.  The engine calls this method once per statement to determine event typing information.
			</p><p>
				The 'getAssetHistory' method returns an <code class="literal">Object[][]</code> that represents five rows. The implementation shown above is a simple example. The parameters to the method are the assetId and assetCode properties of the AssetMoveEvent joined to the method. The engine calls this method for each insert and remove stream event in AssetMoveEvent.
			</p><p>
				To indicate that no rows are found in a join, your application method may return either a <code class="literal">null</code> value or an array of size zero.
			</p><p>
				Alternatively the example above could return a <code class="literal">Collection</code> wherein the method declares as <code class="literal">public static Collection&lt;Object[]&gt; getAssetHistory() {...}</code> or an <code class="literal">Iterator</code> wherein the method declares as <code class="literal">public static Iterator&lt;Object[]&gt; getAssetHistory() {...}</code>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="joining_method_eventbeanarray"/>5.14.6.Â Using an <code class="literal">EventBean</code> Return Type</h3></div></div></div><p>
				When the return type is <code class="literal">EventBean[]</code>, <code class="literal">Collection&lt;EventBean&gt;</code> or <code class="literal">Iterator&lt;EventBean&gt;</code>, you must specify the event type name using <code class="literal">@type</code>.
			</p><p>
				For example assuming the event type <code class="literal">ItemEvent</code> is declared as <code class="literal">create schema ItemEvent(p0 string)</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent, method:MyLib.myFunc() @type(ItemEvent)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public static EventBean[] myFunc(EPLMethodInvocationContext context) {
  EventBean[1] events = new EventBean[1];
  events[0] = context.getEventBeanService().adapterForMap(Collections.singletonMap("p0", "hello"), "ItemEvent");
  return events;
}</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="joining_method_script"/>5.14.7.Â Providing the Script</h3></div></div></div><p>
				Your script must declare the return type as <code class="literal">EventBean[]</code>. In the <code class="literal">@type</code> annotation you must provide an event type name.
			</p><p>
				For example assuming the event type <code class="literal">ItemEvent</code> is declared as <code class="literal">create schema ItemEvent(id string)</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select id from MyEvent, method:myItemProducerScript()</pre><p>
				The example JavaScript script is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create expression EventBean[] @type(ItemEvent) js:myItemProducerScript() [
myItemProducerScript()
function myItemProducerScript() {
  var EventBeanArray = Java.type(\"com.espertech.esper.client.EventBean[]\");
  var events = new EventBeanArray(1);
  events[0] = epl.getEventBeanService().adapterForMap(java.util.Collections.singletonMap(\"id\", \"id1\"), \"ItemEvent\");
  return events;
}]</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="joining_method_udf"/>5.14.8.Â Providing the UDF</h3></div></div></div><p>
				Your script must declare the return type of the UDF as <code class="literal">EventBean[]</code>. In the <code class="literal">@type</code> annotation you must provide an event type name.
			</p><p>
				For example assuming you have registered a user-defined function <code class="literal">myUserDefinedFunction</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select id from MyEvent, method:myUserDefinedFunction() @type(ItemEvent)</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl_createschema"/>5.15.Â Declaring an Event Type: <span class="emphasis"><em>Create Schema</em></span></h2></div></div></div><a id="d0e12502" class="indexterm"/><a id="d0e12505" class="indexterm"/><p>
			EPL allows declaring an event type via the <code class="literal">create schema</code> clause and also by means of the static or runtime configuration API <code class="literal">addEventType</code> functions. The term schema and event type has the same meaning in EPL.
		</p><p>
			Your application can declare an event type by providing the property names and types or by providing a class name. Your application may also declare a variant stream schema.
		</p><p>
			When using the <code class="literal">create schema</code> syntax to declare an event type, the engine automatically removes the event type when there are no started statements referencing the event type, including the statement that declared the event type. When using
			the configuration API, the event type stays cached even if there are no statements that refer to the event type and until explicitly removed via the runtime configuration API.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl_createschema_properties"/>5.15.1.Â Declare an Event Type by Providing Names and Types</h3></div></div></div><p>
				The synopsis of the <code class="literal">create schema</code> syntax providing property names and types is:
			</p><pre class="synopsis">create [map | objectarray | avro] schema <span class="emphasis"><em>schema_name</em></span> [as] 
    (<span class="emphasis"><em>property_name</em></span> <span class="emphasis"><em>property_type</em></span> [,<span class="emphasis"><em>property_name</em></span> <span class="emphasis"><em>property_type</em></span> [,...])
  [inherits <span class="emphasis"><em>inherited_event_type</em></span>[, <span class="emphasis"><em>inherited_event_type</em></span>] [,...]]
  [starttimestamp <span class="emphasis"><em>timestamp_property_name</em></span>]
  [endtimestamp <span class="emphasis"><em>timestamp_property_name</em></span>]
  [copyfrom <span class="emphasis"><em>copy_type_name</em></span> [, <span class="emphasis"><em>copy_type_name</em></span>] [,...]]</pre><p>				
				The <code class="literal">create</code> keyword can be followed by <code class="literal">map</code> to instruct the engine to represent events of that type by the Map event representation, or <code class="literal">objectarray</code> to denote an Object-array event type, or <code class="literal">avro</code> to denote an Avro event type. If neither the <code class="literal">map</code> or <code class="literal">objectarray</code> or <code class="literal">avro</code> keywords are provided, the engine-wide default event representation applies. 
			</p><p>				
				After <code class="literal">create schema</code> follows a <span class="emphasis"><em>schema_name</em></span>. The schema name is the event type name.
			</p><p>				
				The <span class="emphasis"><em>property_name</em></span> is an identifier providing the event property name. The <span class="emphasis"><em>property_type</em></span> is also required for each property. Valid property types are listed in <a class="xref" href="#variable_create" title="5.17.1.Â Creating Variables: The Create Variable Clause">SectionÂ 5.17.1, âCreating Variables: The Create Variable Clauseâ</a>
				and in addition include:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						 Any Java class name, fully-qualified or the simple class name if imports are configured.
					</p></li><li><p>
						 Add left and right square brackets <code class="literal">[]</code> to any type to denote an array-type event property.
					</p></li><li><p>
						Use an event type name as a property type.
					</p></li><li><p>
						The <code class="literal">null</code> keyword for a null-typed property.
					</p></li></ol></div><p>
				The optional <code class="literal">inherits</code> keywords is followed by a comma-separated list of event type names that are the supertypes to the declared type.
			</p><p>
				The optional <code class="literal">starttimestamp</code> keyword is followed by a property name. Use this to tell the engine that your event has a timestamp. The engine checks that the property name exists on the declared type and returns a date-time value.
				Declare a timestamp property if you want your events to implicitly carry a timestamp value for convenient use with interval algebra methods as a start timestamp. 
			</p><p>
				The optional <code class="literal">endtimestamp</code> keyword is followed by a property name. Use this together with starttimestamp to tell the engine that your event has a duration. The engine checks that the property name exists on the declared type and returns a date-time value.
				Declare an endtimestamp property if you want your events to implicitly carry a duration value for convenient use with interval algebra methods.
			</p><p>
				The optional <code class="literal">copyfrom</code> keyword is followed by a comma-separate list of event type names. For each event type listed, the engine looks up that type and adds all event property definitions to the newly-defined type, in addition to those listed explicitly (if any). The resulting order of properties is that copied-from properties are first (in the order of event types and their property order) and explicitly-listed properties last. 
			</p><p>
				A few example event type declarations follow:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Declare type SecurityEvent
create schema SecurityEvent as (ipAddress string, userId String, numAttempts int)
			
// Declare type AuthorizationEvent with the roles property being an array of String 
// and the hostinfo property being a POJO object
create schema AuthorizationEvent(group String, roles String[], hostinfo com.mycompany.HostNameInfo)

// Declare type CompositeEvent in which the innerEvents property is an array of SecurityEvent
create schema CompositeEvent(group String, innerEvents SecurityEvent[])

// Declare type WebPageVisitEvent that inherits all properties from PageHitEvent
create schema WebPageVisitEvent(userId String) inherits PageHitEvent

// Declare a type with start and end timestamp (i.e. event with duration).
create schema RoboticArmMovement (robotId string, startts long, endts long) 
  starttimestamp startts endtimestamp endts
  
// Create a type that has all properties of SecurityEvent plus a userName property
create schema ExtendedSecurityEvent (userName string) copyfrom SecurityEvent

// Create a type that has all properties of SecurityEvent 
create schema SimilarSecurityEvent () copyfrom SecurityEvent

// Create a type that has all properties of SecurityEvent and WebPageVisitEvent plus a userName property
create schema WebSecurityEvent (userName string) copyfrom SecurityEvent, WebPageVisitEvent</pre><p>
				  To elaborate on the <code class="literal">inherits</code> keyword, consider the following two schema definitions:
			  </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema Foo as (prop1 string)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema Bar() inherits Foo</pre><p>
			      Following above schema,  Foo is a supertype or Bar and therefore any Bar event also fulfills Foo and matches where Foo matches. An EPL statement such as <code class="literal">select * from Foo</code> 
			      returns any Foo event as well as any event that is a subtype of Foo such as all Bar events. When your EPL queries don't use any Foo events there is no cost, thus <code class="literal">inherits</code> is 
			      generally an effective way to share properties between types. The start and end timestamp are also inherited from any supertype that has the timestamp property names defined.
			  </p><p>
				  The optional <code class="literal">copyfrom</code> keyword is for defining a schema based on another schema. This keyword causes the engine to copy property definitions: There is no inherits, extends, supertype or subtype relationship between the types listed.
			  </p><p>
				  To define an event type <code class="literal">Bar</code> that has the same properties as <code class="literal">Foo</code>:
			  </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema Foo as (prop1 string)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema Bar() copyfrom Foo</pre><p>
				  To define an event type <code class="literal">Bar</code> that has the same properties as <code class="literal">Foo</code> and that adds its own property <code class="literal">prop2</code>:
			  </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema Foo as (prop1 string)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema Bar(prop2 string) copyfrom Foo</pre><p>
			    If neither the <code class="literal">map</code> or <code class="literal">objectarray</code> or <code class="literal">avro</code> keywords are provided, and if the create-schema statement provides the <code class="literal">@EventRepresentation(objectarray)</code> annotation the engine expects object array events. If the statement provides the <code class="literal">@EventRepresentation(avro)</code> annotation the engine expects Avro objects as events. If the statement provides the <code class="literal">@EventRepresentation(map)</code> annotation the engine expects Map objects as events. If neither annotation is provided, the engine uses the configured default event representation as discussed in <a class="xref" href="#config-engine-eventmeta-representation" title="15.4.14.1.Â Default Event Representation">SectionÂ 15.4.14.1, âDefault Event Representationâ</a>.
			  </p><p>
			    The following two EPL statements both instructs the engine to represent Foo events as object arrays. When sending Foo events into the engine use the <code class="literal">sendEvent(Object[] data, String typeName)</code> footprint.
			  </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create objectarray schema Foo as (prop1 string)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@EventRepresentation(objectarray) create schema Foo as (prop1 string)</pre><p>
			    The next two EPL statements both instructs the engine to represent Foo events as Maps. When sending Foo events into the engine use the <code class="literal">sendEvent(Map data, String typeName)</code> footprint.
			  </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create map schema Foo as (prop1 string)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@EventRepresentation(map) create schema Foo as (prop1 string)</pre><p>
			    The following two EPL statements both instructs the engine to represent Foo events as Avro <code class="literal">GenericData.Record</code>. When sending Foo events into the engine use the <code class="literal">sendEventAvro(Object genericDataDotRecord, String typeName)</code> footprint.
			  </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create avro schema Foo as (prop1 string)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@EventRepresentation(avro) create schema Foo as (prop1 string)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl_createschema_class"/>5.15.2.Â Declare an Event Type by Providing a Class Name</h3></div></div></div><p>
				When using Java classes as the underlying event representation your application may simply provide the class name:
			</p><pre class="synopsis">create schema <span class="emphasis"><em>schema_name</em></span> [as] <span class="emphasis"><em>class_name</em></span>
  [starttimestamp <span class="emphasis"><em>timestamp_property_name</em></span>]
  [endtimestamp <span class="emphasis"><em>timestamp_property_name</em></span>]</pre><p>				
				The <span class="emphasis"><em>class_name</em></span> must be a fully-qualified class name (including the package name) if imports are not configured. If you application configures imports then the simple class name suffices without package name.
			</p><p>
				The optional <code class="literal">starttimestamp</code> and <code class="literal">endtimestamp</code> keywords have a meaning as defined earlier.
			</p><p>
				The next example statements declare an event type based on a class:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Shows the use of a fully-qualified class name to declare the LoginEvent event type
create schema LoginEvent as com.mycompany.LoginValue

// When the configuration includes imports, the declaration does not need a package name
create schema LogoutEvent as SignoffValue</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl_createschema_variant"/>5.15.3.Â Declare a Variant Stream</h3></div></div></div><p>
				A variant stream is a predefined stream into which events of multiple disparate event types can be inserted.
				Please see <a class="xref" href="#insert-into-merging-types" title="5.10.3.Â Merging Disparate Types of Events: Variant Streams">SectionÂ 5.10.3, âMerging Disparate Types of Events: Variant Streamsâ</a> for rules regarding property visibility and additional information.
			</p><p>
				The synopsis is:
			</p><pre class="synopsis">create variant schema <span class="emphasis"><em>schema_name</em></span> [as] <span class="emphasis"><em>eventtype_name|*</em></span> [, <span class="emphasis"><em>eventtype_name|*</em></span>] [,...]</pre><p>
				Provide the <code class="literal">variant</code> keyword to declare a variant stream.
			</p><p>				
				The '<code class="literal">*</code>' wildcard character declares a variant stream that accepts any type of event inserted into the variant stream.
			</p><p>				
				Provide <span class="emphasis"><em>eventtype_name</em></span> if the variant stream should hold events of the given type only. When using <code class="literal">insert into</code> to 
				insert into the variant stream the engine checks to ensure the inserted event type or its supertypes match the required event type.
			</p><p>
				A few examples are shown below:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Create a variant stream that accepts only LoginEvent and LogoutEvent event types
create variant schema SecurityVariant as LoginEvent, LogoutEvent

// Create a variant stream that accepts any event type
create variant schema AnyEvent as *</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="split_overview"/>5.16.Â Splitting and Duplicating Streams</h2></div></div></div><p>
			EPL offers a convenient syntax to splitting, routing or duplicating events into multiple streams, and for receiving unmatched events among a set of filter criteria.
		</p><p>
		  For splitting a single event that acts as a container and expose child events as a property of itself consider the contained-event syntax as described in <a class="xref" href="#epl-containedeventselect" title="5.19.Â Contained-Event Selection">SectionÂ 5.19, âContained-Event Selectionâ</a>.
		  For generating marker events for contained-events please see below.
		</p><p>
			You may define a triggering event or pattern in the <code class="literal">on</code>-part of the statement followed by multiple <code class="literal">insert into</code>, <code class="literal">select</code> and <code class="literal">where</code> clauses.
		</p><p>
			The synopsis is:
		</p><pre class="synopsis">[context <span class="emphasis"><em>context_name</em></span>]
on <span class="emphasis"><em>event_type</em></span>[(<span class="emphasis"><em>filter_criteria</em></span>)] [as <span class="emphasis"><em>stream_name</em></span>]
insert into <span class="emphasis"><em>insert_into_def</em></span> select <span class="emphasis"><em>select_list</em></span> [where <span class="emphasis"><em>condition</em></span>]
[insert into <span class="emphasis"><em>insert_into_def</em></span> select <span class="emphasis"><em>select_list</em></span> [from <span class="emphasis"><em>contained-event-selection</em></span>] [where <span class="emphasis"><em>condition</em></span>]]
[insert into <span class="emphasis"><em>insert_into_def</em></span> select <span class="emphasis"><em>select_list</em></span> [from <span class="emphasis"><em>contained-event-selection</em></span>] [where <span class="emphasis"><em>condition</em></span>]]
[insert into...]
[output first | all]</pre><p>
			The <span class="emphasis"><em>event_type</em></span> is the name of the type of events that trigger the split stream. It is optionally
followed by <span class="emphasis"><em>filter_criteria</em></span> which are filter expressions to apply to arriving events. The optional <code class="literal">as</code> keyword
can be used to assign a stream name. Patterns and named windows can also be specified in the <code class="literal">on</code> clause.
		</p><p>
			Following the <code class="literal">on</code>-clause is one or more <span class="emphasis"><em>insert into</em></span> clauses as described in <a class="xref" href="#epl-insert-into" title="5.10.Â Merging Streams and Continuous Insertion: The Insert Into Clause">SectionÂ 5.10, âMerging Streams and Continuous Insertion: The Insert Into Clauseâ</a> and <span class="emphasis"><em>select</em></span> clauses as described in <a class="xref" href="#epl-select-list" title="5.3.Â Choosing Event Properties and Events: The Select Clause">SectionÂ 5.3, âChoosing Event Properties and Events: The Select Clauseâ</a>. 
		</p><p>
			The second and subsequent <code class="literal">insert into</code> and <code class="literal">select</code> clause pair can have a <code class="literal">from</code> clause for <span class="emphasis"><em>contained-event-selection</em></span>. 
			This is useful when your trigger events themselves contain events that must be processed individually and that may be delimited by marker events that you can define.
		</p><p>
			Each <code class="literal">select</code> clause may be followed by a <code class="literal">where</code> clause containing a condition. If the condition is true for the event, the engine transforms the event according to the <code class="literal">select</code> clause and inserts it into the corresponding stream.
		</p><p>
			At the end of the statement can be an optional <code class="literal">output</code> clause. By default the engine inserts into the first stream for which the <code class="literal">where</code> clause condition matches if one was specified, starting from the top. If you specify the <code class="literal">output all</code> keywords, then the engine inserts into each stream (not only the first stream) for which the <code class="literal">where</code> clause condition matches or that do not have a <code class="literal">where</code> clause.
		</p><p>
			If, for a given event, none of the <code class="literal">where</code> clause conditions match, the statement listener receives the unmatched event. The statement listener only receives unmatched events and does not receive any transformed or inserted events. The <code class="literal">iterator</code> method to the statement returns no events.
		</p><p>
			You may specify an optional context name to the effect that the split-stream operates according to the context dimensional information as declared for the context. See <a class="xref" href="#context" title="ChapterÂ 4.Â Context and Context Partitions">ChapterÂ 4, <i>Context and Context Partitions</i></a> for more information.
		</p><p>
			In the below sample statement, the engine inserts each <code class="literal">OrderEvent</code> into the <code class="literal">LargeOrders</code> stream if the order quantity is 100 or larger, or into the <code class="literal">SmallOrders</code> stream if the order quantity is smaller then 100:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on OrderEvent 
  insert into LargeOrders select * where orderQty &gt;= 100
  insert into SmallOrders select *</pre><p>
			The next example statement adds a new stream for medium-sized orders. The new stream receives orders that have an order quantity between 20 and 100:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on OrderEvent 
  insert into LargeOrders select orderId, customer where orderQty &gt;= 100
  insert into MediumOrders select orderId, customer where orderQty between 20 and 100
  insert into SmallOrders select orderId, customer where orderQty &gt; 0</pre><p>
			As you may have noticed in the above statement, orders that have an order quantity of zero don't match any of the conditions. The engine does not insert such order events into any stream and the listener to the statement receives these unmatched events.
		</p><p>
			By default the engine inserts into the first <code class="literal">insert into</code> stream without a <code class="literal">where</code> clause or for which the <code class="literal">where</code> clause condition matches. To change the default behavior and insert into all matching streams instead (including those without a <code class="literal">where</code> clause), add the <code class="literal">output all</code> keywords.
		</p><p>
			The sample statement below shows the use of the <code class="literal">output all</code> keywords. The statement populates both the <code class="literal">LargeOrders</code> stream with large orders as well as the <code class="literal">VIPCustomerOrders</code> stream with orders for certain customers based on customer id:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on OrderEvent 
  insert into LargeOrders select * where orderQty &gt;= 100
  insert into VIPCustomerOrders select * where customerId in (1001, 1002)
  output all</pre><p>
		  Since the <code class="literal">output all</code> keywords are present, the above statement inserts each order event into either both streams or only one stream or none of the streams, depending on order quantity and customer id of the order event. The statement delivers order events not inserted into any of the streams to the listeners and/or subscriber to the statement.
	  </p><p>
		  The following limitations apply to split-stream statements:
	  </p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					Aggregation functions and the <code class="literal">prev</code> and <code class="literal">prior</code> operators are not available in conditions and the <code class="literal">select</code>-clause.
				</p></li></ol></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="split_containedeventselect"/>5.16.1.Â Generating Marker Events for Contained Events</h3></div></div></div><p>
				When a trigger event contains properties that are themselves events, or more generally when your application needs to split the trigger event into multiple events,
				or to generate marker events (begin, end etc.) or process contained events in a defined order, you may specify a <code class="literal">from</code> clause.  
			</p><p>
				The <code class="literal">from</code> clause is only allowed for the second and subsequent <code class="literal">insert into</code> and <code class="literal">select</code> clause pair.
				It specifies how the trigger event should get unpacked into individual events and is based on the 
				<a class="xref" href="#epl-containedeventselect" title="5.19.Â Contained-Event Selection">SectionÂ 5.19, âContained-Event Selectionâ</a>.
			</p><p>
				For example, assume there is an order event that contains order items:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema OrderItem(itemId string)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema OrderEvent(orderId string, items OrderItem[])</pre><p>
				We can tell the engine that, for each order event, it should process in the following order:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Process a single <code class="literal">OrderBeginEvent</code> that holds just the order id.</p></li><li><p>Process all order items contained in an order event.</p></li><li><p>Process a single <code class="literal">OrderEndEvent</code> that holds just the order id.</p></li></ol></div><p>
				The EPL is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on OrderEvent
  insert into OrderBeginEvent select orderId
  insert into OrderItemEvent select * from [select orderId, * from items]
  insert into OrderEndEvent select orderId
  output all</pre><p>
				When an <code class="literal">OrderEvent</code> comes in, the engine first processes an <code class="literal">OrderBeginEvent</code>. The engine unpacks the order event and for each
				order item processes an <code class="literal">OrderItemEvent</code> containing the respective item. The engine last processes an <code class="literal">OrderEndEvent</code>.
			</p><p>
				Such begin and end marker events are useful to initiate and terminate an analysis using context declaration, for example.
				The next two EPL statements declare a context and perform a simple count of order items per order:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context OrderContext 
  initiated by OrderBeginEvent as obe
  terminated by OrderEndEvent(orderId = obe.orderId)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context OrderContext select count(*) as orderItemCount from OrderItemEvent output when terminated</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="variables_overview"/>5.17.Â Variables and Constants</h2></div></div></div><a id="d0e13127" class="indexterm"/><a id="d0e13130" class="indexterm"/><p>
			A <span class="emphasis"><em>variable</em></span> is a scalar, object, event or set of aggregation values that is available for use in all statements including patterns. Variables can be used in an expression anywhere in a statement as well as in the <code class="literal">output</code> clause for output rate limiting.
		</p><p>
			Variables must first be declared or configured before use, by defining each variable's type and name. Variables can be created via the <code class="literal">create variable</code> syntax or declared by runtime or static configuration. Variables can be assigned new values by using the <code class="literal">on set</code> syntax or via the <code class="literal">setVariableValue</code> methods on <code class="literal">EPRuntime</code>. The <code class="literal">EPRuntime</code> also provides method to read variable values.
		</p><p>
		  A variable can be declared constant. A constant variable always has the initial value and cannot be assigned a new value. A constant variable can be used like any other variable and can be used wherever a constant is required. By declaring a variable constant you enable the Esper engine to 
		  optimize and perform query planning knowing that the variable value cannot change.
		</p><p>
			When declaring a class-typed, event-typed or aggregation-typed variable you may read or set individual properties within the same variable.
		</p><p>
			 The engine guarantees consistency and atomicity of variable reads and writes on the level of context partition (this is a soft guarantee, see below). Variables are optimized for fast read access and are also multithread-safe.
		</p><p>
			 When you associate a context to the variable then each context partition maintains its own variable value. See <a class="xref" href="#context_variables" title="4.8.Â Context and Variables">SectionÂ 4.8, âContext and Variablesâ</a> for more information.
		</p><p>
			 Variables can also be removed, at runtime, by destroying all referencing statements including the statement that created the variable, or by means of the runtime configuration API.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="variable_create"/>5.17.1.Â Creating Variables: The <code class="literal">Create Variable</code> Clause</h3></div></div></div><p>
				The <code class="literal">create variable</code> syntax creates a new variable by defining the variable type and name. In alternative to the syntax, variables can also be declared in the runtime and engine configuration options.
			</p><p>
				The synopsis for creating a variable is as follows: 
			</p><pre class="synopsis">create [constant] variable <span class="emphasis"><em>variable_type</em></span> [[]] <span class="emphasis"><em>variable_name</em></span> [ = <span class="emphasis"><em>assignment_expression</em></span> ]</pre><p>
			  Specify the optional <code class="literal">constant</code> keyword when the variable is a constant whose associated value cannot be altered. Your EPL design should prefer constant variables over non-constant variables.
			</p><p>
				The <span class="emphasis"><em>variable_type</em></span> can be any of the following:
			</p><pre class="synopsis">variable_type
	:  string
	|  char 
	|  character
	|  bool 
	|  boolean
	|  byte
	|  short 
	|  int 
	|  integer 
	|  long 
	|  double
	|  float
	|  object
	|  <span class="emphasis"><em>enum_class</em></span>
	|  <span class="emphasis"><em>class_name</em></span>
	|  <span class="emphasis"><em>event_type_name</em></span></pre><p>
				Variable types can accept null values. The <code class="literal">object</code> type is for an untyped variable that can be assigned any value. You can provide a class name (use imports) or a fully-qualified class name to declare a variable of that Java class type including an enumeration class. You can also supply the name of an event type to declare a variable that holds an event of that type.
			</p><p>
			   Append <code class="literal">[]</code> to the variable type to declare an array variable. A limitation is that if your variable type is an event type then array is not allowed (applies to variables only and not to named windows or tables). For arrays of primitives, specify <code class="literal">[primitive]</code>, for example <code class="literal">int[primitive]</code>.
			</p><p>
				The <span class="emphasis"><em>variable_name</em></span> is an identifier that names the variable. The variable name should not already be in use by another variable.
			</p><p>				
				The <code class="literal">assignment_expression</code> is optional. Without an assignment expression the initial value for the variable is <code class="literal">null</code>. If present, it supplies the initial value for the variable.
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
					When specifying a <span class="emphasis"><em>class_name</em></span> or <span class="emphasis"><em>enum_class</em></span> class name the class must have <code class="literal">public</code> visibility.
				</p></div><p>
				The <code class="literal">EPStatement</code> object of the <code class="literal">create variable</code> statement provides access to variable values. 
				The pull API methods <code class="literal">iterator</code> and <code class="literal">safeIterator</code> return the current variable value. 
				Listeners to the <code class="literal">create variable</code> statement subscribe to changes in variable value: the engine posts new and old value of the variable to all listeners when the variable value is updated by an <code class="literal">on set</code> statement.
			</p><p>
				The example below creates a variable that provides a threshold value. The name of the variable is <code class="literal">var_threshold</code> and its type is <code class="literal">long</code>. The variable's initial value is <code class="literal">null</code> as no other value has been assigned:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create variable long var_threshold</pre><p>
				This statement creates an integer-type variable named <code class="literal">var_output_rate</code> and initializes it to the value ten (10):
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create variable integer var_output_rate = 10</pre><p>
				The next statement declares a constant string-type variable:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create constant variable string const_filter_symbol = 'GE'</pre><p>
				In addition to creating a variable via the <code class="literal">create variable</code> syntax, the runtime and engine configuration API also allows adding variables. The next code snippet illustrates the
				use of the runtime configuration API to create a string-typed variable:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epService.getEPAdministrator().getConfiguration()
  .addVariable("myVar", String.class, "init value");</pre><p>
				The following example declares a constant that is an array of string:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create constant variable string[] const_filters = {'GE', 'MSFT'}</pre><p>
				The next example declares a constant that is an array of enumeration values. It assumes the <code class="literal">Color</code> enumeration class was imported:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create constant variable Color[] const_colors = {Color.RED, Color.BLUE}</pre><p>
				For an array of primitive-type bytes, specify the <code class="literal">primitive</code> keyword in square brackets, as the next example shows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create variable byte[primitive] mybytes = SomeClass.getBytes()</pre><p>
				Use the <code class="literal">new</code> keyword to initialize object instances (the example assumes the package or class was imported):
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create constant variable AtomicInteger cnt = new AtomicInteger(1)</pre><p>
				  The engine removes the variable if the statement that created the variable is destroyed and all statements that reference the variable are also destroyed. 
				  The <code class="literal">getVariableNameUsedBy</code> and the <code class="literal">removeVariable</code> methods, both part of the runtime <code class="literal">ConfigurationOperations</code> API, provide use information and can remove a variable. If the variable was added via configuration, it can only be removed via the configuration API.
			  </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="variable_set"/>5.17.2.Â Setting Variable Values: The <code class="literal">On Set</code> Clause</h3></div></div></div><p>
				The <code class="literal">on set</code> statement assigns a new value to one or more variables when a triggering event arrives or a triggering pattern occurs. Use the <code class="literal">setVariableValue</code> methods on <code class="literal">EPRuntime</code> to assign variable values programmatically.
			</p><p>
				The synopsis for setting variable values is: 
			</p><pre class="synopsis">on <span class="emphasis"><em>event_type</em></span>[<span class="emphasis"><em>(filter_criteria)</em></span>] [as <span class="emphasis"><em>stream_name</em></span>]
  set <span class="emphasis"><em>variable_name</em></span> = <span class="emphasis"><em>expression</em></span> [, <span class="emphasis"><em>variable_name</em></span> = <span class="emphasis"><em>expression</em></span> [,...]]
</pre><p>
				The <span class="emphasis"><em>event_type</em></span> is the name of the type of events that trigger the variable assignments. It is optionally followed by <span class="emphasis"><em>filter_criteria</em></span> which are filter expressions to apply to arriving events. The optional <code class="literal">as</code> keyword can be used to assign an stream name. Patterns and named windows can also be specified in the <code class="literal">on</code> clause.
			</p><p>
				The comma-separated list of variable names and expressions set the value of one or more variables. Subqueries may by part of expressions however aggregation functions and the <code class="literal">prev</code> or <code class="literal">prior</code> function may not be used in expressions.
			</p><p>
				All new variable values are applied atomically: the changes to variable values by the <code class="literal">on set</code> statement 
				become visible to other statements all at the same time. No changes are visible to other processing threads until the <code class="literal">on set</code> statement completed processing, and at that time all changes become visible at once.
			</p><p>
				The <code class="literal">EPStatement</code> object provides access to variable values. The pull API methods <code class="literal">iterator</code> and <code class="literal">safeIterator</code> return the current variable values for each of the variables set by the statement. 
				Listeners to the statement subscribe to changes in variable values: the engine posts new variable values of all variables to any listeners.
			</p><p>
				In the following example, a variable by name <code class="literal">var_output_rate</code> has been declared previously. When a NewOutputRateEvent event arrives, the variable is updated to a new value supplied by the event property 'rate':
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on NewOutputRateEvent set var_output_rate = rate</pre><p>
				The next example shows two variables that are updated when a ThresholdUpdateEvent arrives:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on ThresholdUpdateEvent as t 
  set var_threshold_lower = t.lower,
      var_threshold_higher = t.higher</pre><p>
				The sample statement shown next counts the number of pattern matches using a variable. The pattern looks for OrderEvent events that are followed by CancelEvent events for the same order id within 10 seconds of the OrderEvent:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on pattern[every a=OrderEvent -&gt; (CancelEvent(orderId=a.orderId) where timer:within(10 sec))]
  set var_counter = var_counter + 1</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="variable_using"/>5.17.3.Â Using Variables</h3></div></div></div><p>
				A variable name can be used in any expression and can also occur in an output rate limiting clause. This section presents examples and discusses performance, consistency and atomicity attributes of variables.
			</p><p>
				The next statement assumes that a variable named 'var_threshold' was created to hold a total price threshold value. 
				The statement outputs an event when the total price for a symbol is greater then the current threshold value:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, sum(price) from TickEvent 
group by symbol 
having sum(price) &gt; var_threshold</pre><p>
				This example uses a variable to dynamically change the output rate on-the-fly. The variable 'var_output_rate' holds the current rate at which the statement posts a current count to listeners:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*) from TickEvent output every var_output_rate seconds</pre><p>
				Variables are optimized towards high read frequency and lower write frequency. Variable reads do not incur locking overhead (99% of the time) while variable writes do incur locking overhead. 
			</p><p>
				The engine softly guarantees consistency and atomicity of variables when your statement executes in response to an event or timer invocation. Variables acquire a stable value (implemented by versioning) when your statement starts executing in response to an event or timer invocation, and variables do not change value during execution. When one or more variable values are updated via <code class="literal">on set</code> statements, the changes to all updated variables become visible to statements as one unit and only when the <code class="literal">on set</code> statement completes successfully.
			</p><p>
				The atomicity and consistency guarantee is a soft guarantee. If any of your application statements, in response to an event or timer invocation, execute for a time interval longer then 15 seconds (default interval length), then the engine may use current variable values after 15 seconds passed, rather then then-current variable values at the time the statement started executing in response to an event or timer invocation.				
			</p><p>
				The length of the time interval that variable values are held stable for the duration of execution of a given statement is by default 15 seconds, but can be configured via engine default settings.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="variable_object"/>5.17.4.Â Object-Type Variables</h3></div></div></div><p>
				A variable of type <code class="literal">object</code> (or <code class="literal">java.lang.Object</code> via the API) can be assigned any value including null. When using an object-type variable in an expression, your statement may need to cast the
				value to the desired type.
			</p><p>
			  The following sample EPL creates a variable by name <code class="literal">varobj</code> of type object:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create variable object varobj</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="variable_eventtype"/>5.17.5.Â Class and Event-Type Variables</h3></div></div></div><p>
				The <code class="literal">create variable</code> syntax and the API accept a fully-qualified class name or alternatively the name of an event type. This is useful when you want a single variable to have multiple property values to read or set.
			</p><p>
			  The next statement assumes that the event type <code class="literal">PageHitEvent</code> is declared:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create variable PageHitEvent varPageHitZero</pre><p>
			  These example statements show two ways of assigning to the variable:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// You may assign the complete event
on PageHitEvent(ip='0.0.0.0') pagehit set varPageHitZero = pagehit</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Or assign individual properties of the event
on PageHitEvent(ip='0.0.0.0') pagehit set varPageHitZero.userId = pagehit.userId</pre><p>
			  Similarly statements may use properties of class or event-type variables as this example shows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from FirewallEvent(userId=varPageHitZero.userId)</pre><p>
			  Instance method can also be invoked:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create variable com.example.StateCheckerService stateChecker</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TestEvent as e where stateChecker.checkState(e)</pre><p>
				A variable that represents a service for calling instance methods could be initialized by calling a factory method. This example assumes the classes were added to imports:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create constant variable StateCheckerService stateChecker = StateCheckerServiceFactory.makeService()</pre><p>
				You can add a variable via the configuration API; an example code snippet is next:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">admin.getConfiguration().addVariable("stateChecker", StateCheckerService.class, StateCheckerServiceFactory.makeService(), true);</pre><p>
				Application objects can also be passed via transient configuration information as described in <a class="xref" href="#configuration-transientobjects" title="15.3.Â Passing Services or Transient Objects">SectionÂ 15.3, âPassing Services or Transient Objectsâ</a>.
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
				When using non-constant class or event-type variables and when your EPL intends to set property values on the variable itself (i.e. <code class="literal">set varPageHitZero.userId</code>), please note the following requirements. In order for the engine to assign property values, the underlying event type must allow writing property values. If using JavaBean event classes the class must have setter methods and a default constructor. The underlying event type must also be copy-able i.e. implement <code class="literal">Serializable</code> or configure a copy method (only for non-constant variables and when setting property values).
			</div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="create-exprglobal"/>5.18.Â Declaring Global Expressions, Aliases and Scripts: <span class="emphasis"><em>Create Expression</em></span></h2></div></div></div><a id="d0e13543" class="indexterm"/><a id="d0e13546" class="indexterm"/><a id="d0e13551" class="indexterm"/><p>
			Your application can declare an expression or script using the <code class="literal">create expression</code> clause. Such expressions or scripts become available 
			globally to any EPL statement.
		</p><p>
			The synopsis of the <code class="literal">create expression</code> syntax is:
		</p><pre class="synopsis">create expression <span class="emphasis"><em>expression_or_script</em></span></pre><p>
		  Use the <code class="literal">create expression</code> keywords and append the expression or scripts. 
		</p><p>
		  At the time your application creates the <code class="literal">create expression</code> statement the expression or script becomes globally visible.
		</p><p>
		  At the time your application destroys the <code class="literal">create expression</code> statement the expression or script are no longer visible.
		  Existing statements that use the global expression or script are unaffected.
		</p><p>
		  Expression aliases are the simplest means of sharing expressions and do not accept parameters. 
		  Expression declarations limit the expression scope to the parameters that are passed.
		</p><p>
			The engine may cache declared expression result values and reuse cache values, see <a class="xref" href="#config-engine-execution-declaredexprvaluecachesize" title="15.4.27.8.Â Declared Expression Value Cache Size">SectionÂ 15.4.27.8, âDeclared Expression Value Cache Sizeâ</a>.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="create-exprglobal-alias"/>5.18.1.Â Global Expression Aliases</h3></div></div></div><p>
				The syntax and additional examples for declaring an expression is outlined in <a class="xref" href="#epl-syntax-expression-alias" title="5.2.8.Â Expression Alias">SectionÂ 5.2.8, âExpression Aliasâ</a>,
				which discusses expression aliases that are visible within the same EPL statement i.e. visible locally only.
			</p><p>
				When using the <code class="literal">create expression</code> syntax to declare an expression the engine remembers the expression alias and expression
				and allows the alias to be referenced in all other EPL statements.
			</p><p>
				The below EPL declares a globally visible expression alias for an expression that computes the total of the mid-price which is the buy and sell price divided by two:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create expression totalMidPrice alias for { sum((buy + sell) / 2) }</pre><p>
				The next EPL returns mid-price for events for which the mid-price per symbol stays below 10:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, midPrice from MarketDataEvent group by symbol having midPrice &lt; 10</pre><p>
			  The expression name must be unique among all other expression aliases and expression declarations.
			</p><p>
			  Your application can provide an expression alias of the same name local to a given EPL statement as well as globally using <code class="literal">create expression</code>. 
			  The locally-provided expression alias overrides the global expression alias.
			</p><p>
				The engine validates global expression aliases at the time your application creates a statement that references the alias. 
				When a statement references a global alias, the engine uses the that statement's local expression scope to validate the expression.
				Expression aliases can therefore be dynamically typed and type information does not need to be the same 
				for all statements that reference the expression alias.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="create-exprglobal-expr"/>5.18.2.Â Global Expression Declarations</h3></div></div></div><p>
				The syntax and additional examples for declaring an expression is outlined in <a class="xref" href="#epl-syntax-expression-decl" title="5.2.9.Â Expression Declaration">SectionÂ 5.2.9, âExpression Declarationâ</a>,
				which discusses declaring expressions that are visible within the same EPL statement i.e. visible locally only.
			</p><p>
				When using the <code class="literal">create expression</code> syntax to declare an expression the engine remembers the expression
				and allows the expression to be referenced in all other EPL statements.
			</p><p>
				The below EPL declares a globally visible expression that computes a mid-price and that requires a single parameter:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create expression midPrice { in =&gt; (buy + sell) / 2 }</pre><p>
				The next EPL returns mid-price for each event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select midPrice(md) from MarketDataEvent as md</pre><p>
			  The expression name must be unique for global expressions. It is not possible to declare the same global expression twice with the same name.
			</p><p>
			  Your application can declare an expression of the same name local to a given EPL statement as well as globally using <code class="literal">create expression</code>. 
			  The locally-declared expression overrides the globally declared expression.
			</p><p>
				The engine validates globally declared expressions at the time your application creates a statement that references the global expression. 
				When a statement references a global expression, the engine uses that statement's type information to validate the global expressions.
				Global expressions can therefore be dynamically typed and type information does not need to be the same 
				for all statements that reference the global expression.
			</p><p>
				This example shows a sequence of EPL, that can be created in the order shown, and that demonstrates expression validation at time of referral:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create expression minPrice {(select min(price) from OrderWindow)}</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window OrderWindow#time(30) as OrderEvent</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into OrderWindow select * from OrderEvent</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Validates and incorporates the declared global expression
select minPrice() as minprice from MarketData</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="create-exprglobal-script"/>5.18.3.Â Global Scripts</h3></div></div></div><p>
				The syntax and additional examples for declaring scripts is outlined in <a class="xref" href="#script" title="ChapterÂ 18.Â Script Support">ChapterÂ 18, <i>Script Support</i></a>,
				which discusses declaring scripts that are visible within the same EPL statement i.e. visible locally only.
			</p><p>
				When using the <code class="literal">create expression</code> syntax to declare a script the engine remembers the script
				and allows the script to be referenced in all other EPL statements.
			</p><p>
				The below EPL declares a globally visible script in the JavaScript dialect that computes a mid-price:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create expression midPrice(buy, sell) [ (buy + sell) / 2 ]</pre><p>
				The next EPL returns mid-price for each event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select midPrice(buy, sell) from MarketDataEvent</pre><p>
				The engine validates globally declared scripts at the time your application creates a statement that references the global script. 
				When a statement references a global script, the engine uses that statement's type information to determine parameter types.
				Global scripts can therefore be dynamically typed and type information does not need to be the same 
				for all statements that reference the global script.
			</p><p>
			  The script name in combination with the number of parameters must be unique for global scripts. 
			  It is not possible to declare the same global script twice with the same name and number of parameters.
			</p><p>
			  Your application can declare a script of the same name and number of parameters that is local to a given EPL statement as well as globally using <code class="literal">create expression</code>. 
			  The locally-declared script overrides the globally declared script. 
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-containedeventselect"/>5.19.Â Contained-Event Selection</h2></div></div></div><p>
			Contained-event selection is for use when an event contains properties that are themselves events, or more generally when your application needs to split an event into multiple events. One example is when application events are coarse-grained structures and you need to perform bulk operations on the rows of the property graph in an event.
		</p><p>
			Use the contained-event selection syntax in a filter expression such as in a pattern, <code class="literal">from</code> clause, subselect, on-select and on-delete. This section provides the synopsis and examples.
		</p><p>
			To review, in the <code class="literal">from</code> clause a <span class="emphasis"><em>contained_selection</em></span> may appear after the event stream name and filter criteria, and before any data windows.
		</p><p>
			The synopsis for <span class="emphasis"><em>contained_selection</em></span> is as follows:
		</p><pre class="synopsis">[select <span class="emphasis"><em>select_expressions</em></span> from] 
  <span class="emphasis"><em>contained_expression</em></span> [@type(<span class="emphasis"><em>eventtype_name</em></span>)] [as <span class="emphasis"><em>alias_name</em></span>]
  [where <span class="emphasis"><em>filter_expression</em></span>]</pre><p>
			The <code class="literal">select</code> clause and <span class="emphasis"><em>select_expressions</em></span> are optional and may be used to select specific properties of contained events.
		</p><p>
			The <span class="emphasis"><em>contained_expression</em></span> is required and returns individual events. The expression can, for example, be an event property name that returns an event fragment, i.e. a property that can itself be represented as an event by the underlying event representation. The expression can also be any other expression such as a single-row function or a script that returns either an array or a <code class="literal">java.util.Collection</code> of events. Simple values such as integer or string are not fragments but can be used as well as described below.
		</p><p>
		    Provide the <code class="literal">@type(name)</code> annotation after the contained expression to name the event type of events returned by the expression. The annotation is optional and not needed when the contained-expression is an event property that returns a class or other event fragment.
		</p><p>
			The <span class="emphasis"><em>alias_name</em></span> can be provided to assign a name to the expression result value rows.
		</p><p>
			The <code class="literal">where</code> clause and <span class="emphasis"><em>filter_expression</em></span> is optional and may be used to filter out properties.
		</p><p>
			As an example event, consider a media order. A media order consists of order items as well as product descriptions. A media order event can be represented as an object graph (POJO event representation), or a structure of nested Maps (Map event representation) or a XML document (XML DOM or Axiom event representation) or other custom plug-in event representation.
		</p><p>
			To illustrate, a sample media order event in XML event representation is shown below. Also, a XML event type can optionally be strongly-typed with an explicit XML XSD schema that is not shown here. Note that Map and POJO representation can be considered equivalent for the purpose of this example.
		</p><p>
			Let us now assume the event type <code class="literal">MediaOrder</code> as being represented by the root node <code class="literal">&lt;mediaorder&gt;</code> of such XML snip:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;mediaorder&gt;
  &lt;orderId&gt;PO200901&lt;/orderId&gt;
  &lt;items&gt;
    &lt;item&gt;
      &lt;itemId&gt;100001&lt;/itemId&gt;
      &lt;productId&gt;B001&lt;/productId&gt;
      &lt;amount&gt;10&lt;/amount&gt;
      &lt;price&gt;11.95&lt;/price&gt;
    &lt;/item&gt;
  &lt;/items&gt;
  &lt;books&gt;
    &lt;book&gt;
      &lt;bookId&gt;B001&lt;/bookId&gt;
      &lt;author&gt;Heinlein&lt;/author&gt;
      &lt;review&gt;
        &lt;reviewId&gt;1&lt;/reviewId&gt;
        &lt;comment&gt;best book ever&lt;/comment&gt;
      &lt;/review&gt;
    &lt;/book&gt;
    &lt;book&gt;
      &lt;bookId&gt;B002&lt;/bookId&gt;
      &lt;author&gt;Isaac Asimov&lt;/author&gt;
    &lt;/book&gt;
  &lt;/books&gt;
&lt;/mediaorder&gt;</pre><p>
			The next query utilizes the contained-event selection syntax to return each book:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MediaOrder[books.book]</pre><p>
			The result of the above query is one event per book. Output events contain only the book properties and not any of the mediaorder-level properties.
		</p><p>
			Note that, when using listeners, the engine delivers multiple results in one invocation of each listener. Therefore listeners to the above statement can expect a single invocation passing all book events within one media order event as an array.
		</p><p>
			 To better illustrate the position of the contained-event selection syntax in a statement, consider the next two queries:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MediaOrder(orderId='PO200901')[books.book]</pre><p>
			The above query the returns each book only for media orders with a given order id. This query illustrates a contained-event selection and a data window: 
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*) from MediaOrder[books.book]#unique(bookId)</pre><p>
			The sample above counts each book unique by book id.
		</p><p>
			Contained-event selection can be staggered. When staggering multiple contained-event selections the staggered contained-event selection is relative to its parent.
		</p><p>
			This example demonstrates staggering contained-event selections by selecting each review of each book:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MediaOrder[books.book][review]</pre><p>
			Listeners to the query above receive a row for each review of each book. Output events contain only the review properties and not the book or media order properties.
		</p><p>
			The following is not valid:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// not valid
select * from MediaOrder[books.book.review]</pre><p>
			The <code class="literal">book</code> property in an indexed property (an array or collection) and thereby requires an index in order to determine which book to use. The expression <code class="literal">books.book[1].review</code> is valid and means all reviews of the second (index 1) book.
		</p><p>
			The contained-event selection syntax is part of the filter expression and may therefore occur in patterns and anywhere a filter expression is valid. 
		</p><p>
			A pattern example is below. The example assumes that a <code class="literal">Cancel</code> event type has been defined that also has an <code class="literal">orderId</code> property:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern [c=Cancel -&gt; books=MediaOrder(orderId = c.orderId)[books.book] ]</pre><p>
			When used in a pattern, a filter with a contained-event selection returns an array of events, similar to the match-until clause in patterns. The above statement returns, in the <code class="literal">books</code> property, an
			array of book events.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-containedeventselect-select"/>5.19.1.Â Select-Clause in a Contained-Event Selection</h3></div></div></div><p>
				 The optional <code class="literal">select</code> clause provides control over which fields are available in output events. The expressions in the select-clause apply only to the properties available underneath the property in the <code class="literal">from</code> clause, and the properties of the enclosing event.
			</p><p>
				 When no <code class="literal">select</code> is specified, only the properties underneath the selected property are available in output events.
			</p><p>
				 In summary, the <code class="literal">select</code> clause may contain:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						Any expressions, wherein properties are resolved relative to the property in the <code class="literal">from</code> clause.
					</p></li><li><p>
						Use the wildcard (<code class="literal">*</code>) to provide all properties that exist under the property in the <code class="literal">from</code> clause.
					</p></li><li><p>
						Use the <span class="emphasis"><em>alias_name</em></span><code class="literal">.*</code> syntax to provide all properties that exist under a property in the <code class="literal">from</code> clause.
					</p></li></ol></div><p>
				The next query's <code class="literal">select</code> clause selects each review for each book, and the order id as well as the book id of each book:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MediaOrder[select orderId, bookId from books.book][select * from review]
// ... equivalent to ...
select * from MediaOrder[select orderId, bookId from books.book][review]]</pre><p>
				Listeners to the statement above receive an event for each review of each book. Each output event has all properties of the review row, and in addition the <code class="literal">bookId</code> of each book and the <code class="literal">orderId</code> of the order.
				Thus <code class="literal">bookId</code> and <code class="literal">orderId</code> are found in each result event, duplicated when there are multiple reviews per book and order.
			</p><p>
				 The above query uses wildcard <code class="literal">(*)</code> to select all properties from reviews. As has been discussed as part of the <code class="literal">select</code> clause, the wildcard (<code class="literal">*</code>) and <span class="emphasis"><em>property_alias</em></span><code class="literal">.*</code> do not copy properties for performance reasons. The wildcard syntax instead specifies the underlying type, and additional properties are added onto that underlying type if required. Only one wildcard (<code class="literal">*</code>) and <span class="emphasis"><em>property_alias</em></span><code class="literal">.*</code> (unless used with a column rename) may therefore occur in the <code class="literal">select</code> clause list of expressions.
			</p><p>
				All the following queries produce an output event for each review of each book. The next sample queries illustrate the options available to control the fields of output events.
			</p><p>
				The output events produced by the next query have all properties of each review and no other properties available:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MediaOrder[books.book][review]</pre><p>
				The following query is not a valid query, since the order id and book id are not part of the contained-event selection:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Invalid select-clause: orderId and bookId not produced.
select orderId, bookId from MediaOrder[books.book][review]</pre><p>
				This query is valid. Note that output events carry only the <code class="literal">orderId</code> and <code class="literal">bookId</code> properties and no other data:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select orderId, bookId from MediaOrder[books.book][select orderId, bookId from review]
//... equivalent to ...
select * from MediaOrder[select orderId, bookId from books.book][review]</pre><p>
				This variation produces output events that have all properties of each book and only <code class="literal">reviewId</code> and <code class="literal">comment</code> for each review:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MediaOrder[select * from books.book][select reviewId, comment from review]
// ... equivalent to ...
select * from MediaOrder[books.book as book][select book.*, reviewId, comment from review]</pre><p>
				The output events of the next EPL have all properties of the order and only <code class="literal">bookId</code> and <code class="literal">reviewId</code> for each review:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MediaOrder[books.book as book]
    [select mediaOrder.*, bookId, reviewId from review] as mediaOrder</pre><p>
				This EPL produces output events with 3 columns: a column named <code class="literal">mediaOrder</code> that is the order itself, a column named <code class="literal">book</code> for each book and a column named <code class="literal">review</code> that holds each review:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into ReviewStream select * from MediaOrder[books.book as book]
  [select mo.* as mediaOrder, book.* as book, review.* as review from review as review] as mo</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// .. and a sample consumer of ReviewStream...
select mediaOrder.orderId, book.bookId, review.reviewId from ReviewStream</pre><p>
				Please note these limitations:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						Sub-selects, aggregation functions and the <code class="literal">prev</code> and <code class="literal">prior</code> operators are not available in contained-event selection.
					</p></li><li><p>
						Expressions in the <code class="literal">select</code> and <code class="literal">where</code> clause of a contained-event selection can only reference properties relative to the current event and property.
					</p></li></ol></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-containedeventselect-where"/>5.19.2.Â Where Clause in a Contained-Event Selection</h3></div></div></div><p>
				The optional <code class="literal">where</code> clause may be used to filter out properties at the same level that the where-clause occurs.
			</p><p>
				The properties in the filter expression must be relative to the property in the <code class="literal">from</code> clause or the enclosing event.
			</p><p>
				This query outputs all books with a given author:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MediaOrder[books.book where author = 'Heinlein']</pre><p>
				This query outputs each review of each book where a review comment contains the word 'good':
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MediaOrder[books.book][review where comment like 'good']</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-containedeventselect-join"/>5.19.3.Â Contained-Event Selection and Joins</h3></div></div></div><p>
				This section discusses contained-event selection in joins.
			</p><p>
				When joining within the same event it is not required to specify a data window. Recall, in a join or outer join there must be a data window specified that defines the subset of events available to be joined. For self-joins, no data window is required and the join
				executes against the data returned by the same event.
			</p><p>
				This query inner-joins items to books where book id matches the product id:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select book.bookId, item.itemId 
from MediaOrder[books.book] as book, 
      MediaOrder[items.item] as item 
where productId = bookId</pre><p>
				Query results for the above query when sending the media order event as shown earlier are:
			</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th>book.bookId</th><th>item.itemId</th></tr></thead><tbody><tr><td>B001</td><td>100001</td></tr></tbody></table></div><p>
				The next example query is a left outer join. It returns all books and their items, and for books without item it returns the book and a <code class="literal">null</code> value:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select book.bookId, item.itemId 
from MediaOrder[books.book] as book 
  left outer join 
    MediaOrder[items.item] as item 
  on productId = bookId</pre><p>
				Query results for the above query when sending the media order event as shown earlier are:
			</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th>book.bookId</th><th>item.itemId</th></tr></thead><tbody><tr><td>B001</td><td>100001</td></tr><tr><td>B002</td><td>null</td></tr></tbody></table></div><p>
				A full outer join combines the results of both left and right outer joins. The joined table will contain all records from both tables, and fill in <code class="literal">null</code> values for missing matches on either side.
			</p><p>
				This example query is a full outer join, returning all books as well as all items, and filling in <code class="literal">null</code> values for book id or item id if no match is found:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select orderId, book.bookId,item.itemId 
from MediaOrder[books.book] as book 
  full outer join 
     MediaOrder[select orderId, * from items.item] as item 
  on productId = bookId 
order by bookId, item.itemId asc
</pre><p>
				As in all other continuous queries, aggregation results are cumulative from the time the statement was created.
			</p><p>
				The following query counts the cumulative number of items in which the product id matches a book id:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*) 
from MediaOrder[books.book] as book, 
      MediaOrder[items.item] as item 
where productId = bookId</pre><p>
				The <code class="literal">unidirectional</code> keyword in a join indicates to the query engine that aggregation state is not cumulative. The next query counts the number of items in which the product id matches a book id for each event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*) 
from MediaOrder[books.book] as book unidirectional, 
      MediaOrder[items.item] as item 
where productId = bookId</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-containedeventselect-pojoexample"/>5.19.4.Â Sentence and Word Example</h3></div></div></div><p>
				The next example splits an event representing a sentence into multiple events in which each event represents a word. It represents all events and the logic to split events into contained events as Java code. 
				The next chapter has additional examples that use Map-type events and put contained-event logic into a separate expression or script.
			</p><p>
				The sentence event in this example is represented by a class declared as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class SentenceEvent {
  private final String sentence;

  public SentenceEvent(String sentence) {
    this.sentence = sentence;
  }

  public WordEvent[] getWords() {
    String[] split = sentence.split(" ");
    WordEvent[] words = new WordEvent[split.length];
    for (int i = 0; i &lt; split.length; i++) {
      words[i] = new WordEvent(split[i]);
    }
    return words;
  }
}</pre><p>
				The sentence event as above provides an event property <code class="literal">words</code> that returns each word event.
			</p><p>
				The declaration of word event is also a class:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class WordEvent {
  private final String word;

  public WordEvent(String word) {
    this.word = word;
  }

  public String getWord() {
    return word;
  }
}</pre><p>
				The EPL statement to populate a stream of words from a sentence event is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into WordStream select * from SentenceEvent[words]</pre><p>
				Finally, the API call to send a sentence event to the engine is shown here:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epService.getEPRuntime().sendEvent(new SentenceEvent("Hello Word Contained Events"));</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-containedeventselect-examples"/>5.19.5.Â More Examples</h3></div></div></div><p>
			  The examples herein are not based on the POJO events of the prior example. They are meant to demonstrate different types of contained-event expressions and the use of <code class="literal">@type(</code><span class="emphasis"><em>type_name</em></span><code class="literal">)</code> to identify the event type of the return values of the contained-event expression.
			</p><p>
			   The example first defines a few sample event types:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema SentenceEvent(sentence String)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema WordEvent(word String)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema CharacterEvent(char String)</pre><p>
			   The following EPL assumes that your application defined a plug-in single-row function by name <code class="literal">splitSentence</code> that returns an array of Map, producting output events that are <code class="literal">WordEvent</code> events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into WordStream select * from SentenceEvent[splitSentence(sentence)@type(WordEvent)]</pre><p>
			   The example EPL shown next invokes a JavaScript function which returns some events of type <code class="literal">WordEvent</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression Collection js:splitSentenceJS(sentence) [
  var CollectionsClazz = Java.type('java.util.Collections');
  var words = new java.util.ArrayList();
  words.add(CollectionsClazz.singletonMap('word', 'wordOne'));
  words.add(CollectionsClazz.singletonMap('word', 'wordTwo'));
  words;
]
select * from SentenceEvent[splitSentenceJS(sentence)@type(WordEvent)]</pre><p>
			   In the next example the sentence event first gets split into words and then each word event gets split into character events via an additional <code class="literal">splitWord</code> single-row function,
			   producing events of type <code class="literal">CharacterEvent</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from SentenceEvent
  [splitSentence(sentence)@type(WordEvent)]
  [splitWord(word)@type(CharacterEvent)]</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-containedeventselect-arrayofprimitive"/>5.19.6.Â Contained Expression Returning an Array of Property Values</h3></div></div></div><p>
				Your <span class="emphasis"><em>contained_expression</em></span> may return an array of property values such as an array of integer or string values.
				In this case you must specify a <code class="literal">@type(name)</code> annotation and provide an event type name that declares a single column with a type that matches the array component type.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema IdContainer(id int)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema MyEvent(ids int[])</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent[ids@type(IdContainer)]</pre><p>
				This example declares a named window and uses on-delete:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window MyWindow#keepall (id int)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on MyEvent[ids@type(IdContainer)] as my_ids 
delete from MyWindow my_window 
where my_ids.id = my_window.id</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-containedeventselect-arrayofevent"/>5.19.7.Â Contained Expression Returning an Array of EventBean</h3></div></div></div><p>
				Your <span class="emphasis"><em>contained_expression</em></span> may return an array of <code class="literal">EventBean</code> instances.
				This is handy when the expression itself must decide the type of each event to return.
			</p><p>
				For example:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema BaseEvent();</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema AEvent(pa string) inherits BaseEvent;</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema BEvent(pb string) inherits BaseEvent;</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema ValueEvent(value string);</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from ValueEvent[mySplitFunction(value) @type(BaseEvent)]</pre><p>
				Then declare <code class="literal">mySplitFunction</code> returning an array of events, such as:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public static EventBean[] mySplitFunction(String value, EPLMethodInvocationContext context) {
  EventBean[] events = new EventBean[1];
  if (value.startsWith("A")) {
    events[0] =  context.getEventBeanService().adapterForMap(Collections.singletonMap("pa", value), "AEvent");
  }
  else {
    events[0] =  context.getEventBeanService().adapterForMap(Collections.singletonMap("pb", value), "BEvent");
  }
  return events;
}</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-containedeventselect-beginend"/>5.19.8.Â Generating Marker Events Such as a Begin and End Event</h3></div></div></div><p>
				The syntax for splitting and duplicating streams can be used to generate marker events.
				Please see <a class="xref" href="#split_containedeventselect" title="5.16.1.Â Generating Marker Events for Contained Events">SectionÂ 5.16.1, âGenerating Marker Events for Contained Eventsâ</a> for more information.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-containedeventselect-restrictions"/>5.19.9.Â Contained-Event Limitations</h3></div></div></div><p>
				The following restrictions apply to contained-event selection:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						When selecting contained events from a named window in a join, the stream must be marked as <code class="literal">unidirectional</code>.
					</p></li><li><p>
						Selecting contained events from a named window in a correlated subquery is not allowed. 
					</p></li></ul></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-update"/>5.20.Â Updating an Insert Stream: The <code class="literal">Update IStream</code> Clause</h2></div></div></div><p>
			The <code class="literal">update istream</code> statement allows declarative modification of event properties of events entering a stream. Update is a pre-processing step to each new event, modifying an event before the event applies to any statements.
		</p><p>
			The synopsis of <code class="literal">update istream</code> is as follows:
		</p><pre class="synopsis">update istream <span class="emphasis"><em>event_type</em></span> [as <span class="emphasis"><em>stream_name</em></span>]
  set <span class="emphasis"><em>property_name</em></span> = <span class="emphasis"><em>set_expression</em></span> [, <span class="emphasis"><em>property_name</em></span> = <span class="emphasis"><em>set_expression</em></span>] [,...]
  [where <span class="emphasis"><em>where_expression</em></span>]
</pre><p>
			The <span class="emphasis"><em>event_type</em></span> is the name of the type of events that the <code class="literal">update</code> applies to.
			The optional <code class="literal">as</code> keyword can be used to assign a name to the event type for use with subqueries, for example.
			Following the <code class="literal">set</code> keyword is a comma-separated list of property names and expressions that provide the event properties to change and values to set.
		</p><p>
			The optional <code class="literal">where</code> clause and expression can be used to filter out events to which to apply updates.
		</p><p>
			Listeners to an <code class="literal">update</code> statement receive the updated event in the insert stream (new data) and the event prior to the update in the remove stream (old data). Note that if there are multiple update statements that all apply to the same event then the engine will ensure that the output events delivered to listeners or subscribers are consistent with the then-current updated properties of the event (if necessary making event copies, as described below, in the case that listeners are attached to update statements). Iterating over an update statement returns no events.
		</p><p>
			As an example, the below statement assumes an <code class="literal">AlertEvent</code> event type that has properties named <code class="literal">severity</code> and <code class="literal">reason</code>:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">update istream AlertEvent 
  set severity = 'High'
  where severity = 'Medium' and reason like '%withdrawal limit%'</pre><p>
			The statement above changes the value of the <code class="literal">severity</code> property to "High" for <code class="literal">AlertEvent</code> events that have a medium severity and contain a specific reason text.
		</p><p>
			Update statements apply the changes to event properties before other statements receive the event(s) for processing, e.g. "<code class="literal">select * from AlertEvent</code>" receives the updated <code class="literal">AlertEvent</code>. This is true regardless of the order in which your application creates statements.
		</p><p>
			When multiple update statements apply to the same event, the engine executes updates in the order in which update statements are created. We recommend the <code class="literal">@Priority</code> EPL annotation to define a deterministic order of processing updates, especially in the case where update statements get created and destroyed dynamically or multiple update statements update the same fields. The update statement with the highest <code class="literal">@Priority</code> value applies last.
		</p><p>
			The <code class="literal">update</code> clause can be used on streams populated via <code class="literal">insert into</code>, as this example utilizing a pattern demonstrates:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into DoubleWithdrawalStream 
select a.id, b.id, a.account as account, 0 as minimum 
from pattern [a=Withdrawal -&gt; b=Withdrawal(id = a.id)]</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">update istream DoubleWithdrawalStream set minimum = 1000 where account in (10002, 10003)</pre><p>
			When using <code class="literal">update istream</code> with named windows, any changes to event properties apply before an event enters the named window.
			The <code class="literal">update istream</code> is not available for tables.
		</p><p>
			Consider the next example (shown here with statement names in @Name EPL annotation, multiple EPL statements):
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Name("CreateWindow") create window MyWindow#time(30 sec) as AlertEvent

@Name("UpdateStream") update istream MyWindow set severity = 'Low' where reason = '%out of paper%'

@Name("InsertWindow") insert into MyWindow select * from AlertEvent

@Name("SelectWindow") select * from MyWindow</pre><p>
			The <code class="literal">UpdateStream</code> statement specifies an <code class="literal">update</code> clause that applies to all events entering the named window. Note that <code class="literal">update</code> does not apply to events already in the named window at the time an application creates the <code class="literal">UpdateStream</code> statement, it only applies to new events entering the named window (after an application created the <code class="literal">update</code> statement).
		</p><p>
			Therefore, in the above example listeners to the <code class="literal">SelectWindow</code> statement as well as the <code class="literal">CreateWindow</code> statement receive the updated event, 
			while listeners to the <code class="literal">InsertWindow</code> statement receive the original <code class="literal">AlertEvent</code> event (and not the updated event).
		</p><p>
			Subqueries can also be used in all expressions including the optional <code class="literal">where</code> clause.
		</p><p>
			This example demonstrates a correlated subquery in an assignment expression and also demonstrates the optional <code class="literal">as</code> keyword. It assigns the <code class="literal">phone</code> property of an <code class="literal">AlertEvent</code> event a new value based on the lookup within all unique <code class="literal">PhoneEvent</code> events (according to an <code class="literal">empid</code> property) correlating the <code class="literal">AlertEvent</code> property <code class="literal">reporter</code> with the <code class="literal">empid</code> property of <code class="literal">PhoneEvent</code>:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">update istream AlertEvent as ae
  set phone = 
    (select phone from PhoneEvent#unique(empid) where empid = ae.reporter)</pre><p>
			When updating indexed properties use the syntax <span class="emphasis"><em>propertyName</em></span><code class="literal">[</code><span class="emphasis"><em>index</em></span><code class="literal">] = </code><span class="emphasis"><em>value</em></span> with the index value being an integer number. 
			When updating mapped properties use the syntax <span class="emphasis"><em>propertyName</em></span><code class="literal">(</code><span class="emphasis"><em>key</em></span><code class="literal">) = </code><span class="emphasis"><em>value</em></span> with the key being a string value.
		</p><p>
			When using <code class="literal">update</code>, please note these limitations:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					Expressions may not use aggregation functions.
				</p></li><li><p>
					The <code class="literal">prev</code> and <code class="literal">prior</code> functions may not be used.
				</p></li><li><p>
					For underlying event representations that are Java objects, a event object class must implement the <code class="literal">java.io.Serializable</code> interface as discussed below.
				</p></li><li><p>
					When using an XML underlying event type, event properties in the XML document representation are not available for update.
				</p></li><li><p>
					Nested properties are not supported for update. Revision event types and variant streams may also not be updated.
				</p></li></ol></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-update-object"/>5.20.1.Â Immutability and Updates</h3></div></div></div><p>
				When updating event objects the engine maintains consistency across statements. The engine ensures that an update to an event does not impact the results of statements that look for or retain the original un-updated event. 
				As a result the engine may need to copy an event object to maintain consistency.
			</p><p>
				In the case your application utilizes Java objects as the underlying event representation and an <code class="literal">update</code> statement updates properties on an object, then in order to maintain consistency across statements 
				it is necessary for the engine to copy the object before changing properties (and thus not change the original object). 
			</p><p>
				For Java application objects, the copy operation is implemented by serialization. Your event object must therefore implement the <code class="literal">java.io.Serializable</code> interface to become eligible for update. As an alternative to serialization, you may instead configure a copy method as part of the event type configuration via <code class="literal">ConfigurationEventTypeLegacy</code>.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-grouped-delivery"/>5.21.Â Controlling Event Delivery : The <code class="literal">For</code> Clause</h2></div></div></div><p>
			The engine delivers all result events of a given statement to the statement's listeners and subscriber (if any) in a single invocation of each listener and subscriber's <code class="literal">update</code> method passing an array of result events. For example, a statement using a time-batch window may provide many result events after a time period passes, a pattern may provide multiple matching events or in a join the join cardinality could be multiple rows.
		</p><p>
			For statements that typically post multiple result events to listeners the <code class="literal">for</code> keyword controls the number of invocations of the engine to listeners and subscribers and the subset of all result events delivered by each invocation. 
			This can be useful when your application listener or subscriber code expects multiple invocations or expects that invocations only receive events that belong together by some additional criteria.
		</p><p>
			The <code class="literal">for</code> keyword is a reserved keyword. It is followed by either the <code class="literal">grouped_delivery</code> keyword for grouped delivery or the <code class="literal">discrete_delivery</code> keyword for discrete delivery. The <code class="literal">for</code> clause is valid after any EPL select statement.
		</p><p>
			The synopsis for grouped delivery is as follows:
		</p><pre class="synopsis">... for grouped_delivery (<span class="emphasis"><em>group_expression</em></span> [, <span class="emphasis"><em>group_expression</em></span>] [,...])</pre><p>
			The <span class="emphasis"><em>group_expression</em></span> expression list provides one or more expressions to apply to result events. The engine invokes listeners and subscribers once for each distinct set of values returned by <span class="emphasis"><em>group_expression</em></span> expressions passing only the events for that group.
		</p><p>
			The synopsis for discrete delivery is as follows:
		</p><pre class="synopsis">... for discrete_delivery</pre><p>
			With discrete delivery the engine invokes listeners and subscribers once for each result event passing a single result event in each invocation.
		</p><p>
			Consider the following example without <code class="literal">for</code>-clause. The time batch data window collects RFIDEvent events for 10 seconds and posts an array of result events:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from RFIDEvent#time_batch(10 sec)</pre><p>
			Let's consider an example event sequence as follows:
		</p><div class="table"><a id="d0e14582"/><p class="title"><b>TableÂ 5.8.Â Sample Sequence of Events for <code class="literal">For</code> Keyword</b></p><div class="table-contents"><table summary="Sample Sequence of Events for For Keyword" border="1"><colgroup><col/></colgroup><thead><tr><th>Event</th></tr></thead><tbody><tr><td>RFIDEvent(id:1, zone:'A')</td></tr><tr><td>RFIDEvent(id:2, zone:'B')</td></tr><tr><td>RFIDEvent(id:3, zone:'A')</td></tr></tbody></table></div></div><br class="table-break"/><p>
			Without <code class="literal">for</code>-clause and after the 10-second time period passes, the engine delivers an array of 3 events in a single invocation to listeners and the subscriber.
		</p><p>
			The next example specifies the <code class="literal">for</code>-clause and grouped delivery by zone:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from RFIDEvent#time_batch(10 sec) for grouped_delivery (zone)</pre><p>
			With grouped delivery and after the 10-second time period passes, the above statement delivers result events in two invocations to listeners and the subscriber: The first invocation delivers an array of two events that contains zone A events with id 1 and 3. The second invocation delivers an array of 1 event that contains a zone B event with id 2.
		</p><p>
			The next example specifies the <code class="literal">for</code>-clause and discrete delivery:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from RFIDEvent#time_batch(10 sec) for discrete_delivery</pre><p>
			With discrete delivery and after the 10-second time period passes, the above statement delivers result events in three invocations to listeners and the subscriber: The first invocation delivers an array of 1 event that contains the event with id 1, the second invocation delivers an array of 1 event that contains the event with id 2 and the third invocation delivers an array of 1 event that contains the event with id 3.
		</p><p>
		  Remove stream events are also delivered in multiple invocations, one for each group, if your statement selects remove stream events explicitly via <code class="literal">irstream</code> or <code class="literal">rstream</code> keywords.
		</p><p>
		  The <code class="literal">insert into</code> for inserting events into a stream is not affected by the <code class="literal">for</code>-clause.
		</p><p>
		  The delivery order respects the natural sort order or the explicit sort order as provided by the <code class="literal">order by</code> clause, if present.
		</p><p>
			The following are known limitations:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					The engine validates <span class="emphasis"><em>group_expression</em></span> expressions against the output event type, therefore all properties specified in <span class="emphasis"><em>group_expression</em></span> expressions must occur in the <code class="literal">select</code> clause.
				</p></li></ol></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="nwtable"/>ChapterÂ 6.Â EPL Reference: Named Windows and Tables</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#nwtable-overview">6.1. Overview</a></span></dt><dd><dl><dt><span class="sect2"><a href="#nwtable-overview-namedwindow">6.1.1. Named Window Overview</a></span></dt><dt><span class="sect2"><a href="#nwtable-overview-table">6.1.2. Table Overview</a></span></dt><dt><span class="sect2"><a href="#nwtable-overview-compare">6.1.3. Comparing Named Windows and Tables</a></span></dt></dl></dd><dt><span class="sect1"><a href="#nwtable-namedwindow">6.2. Named Window Usage</a></span></dt><dd><dl><dt><span class="sect2"><a href="#named_create">6.2.1. Creating Named Windows: The Create Window clause</a></span></dt><dt><span class="sect2"><a href="#named_inserting">6.2.2. Inserting Into Named Windows</a></span></dt><dt><span class="sect2"><a href="#named_selecting">6.2.3. Selecting From Named Windows</a></span></dt></dl></dd><dt><span class="sect1"><a href="#nwtable-table">6.3. Table Usage</a></span></dt><dd><dl><dt><span class="sect2"><a href="#table_create">6.3.1. Creating Tables: The Create Table Clause</a></span></dt><dt><span class="sect2"><a href="#table_agginto">6.3.2. Aggregating Into Table Rows: The Into Table Clause</a></span></dt><dt><span class="sect2"><a href="#table_keyedaccess">6.3.3. Table Column Keyed-Access Expressions</a></span></dt><dt><span class="sect2"><a href="#nwtable-insert">6.3.4. Inserting Into Tables</a></span></dt><dt><span class="sect2"><a href="#nwtable-table-selecting">6.3.5. Selecting From Tables</a></span></dt></dl></dd><dt><span class="sect1"><a href="#named_querying">6.4. Triggered Select: The On Select Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#named_querying_namedwin">6.4.1. Notes on On-Select With Named Windows</a></span></dt><dt><span class="sect2"><a href="#named_querying_table">6.4.2. Notes on On-Select With Tables</a></span></dt><dt><span class="sect2"><a href="#named_query">6.4.3. On-Select Compared to Join</a></span></dt></dl></dd><dt><span class="sect1"><a href="#named_selectdelete">6.5. Triggered Select+Delete: The On Select Delete Clause</a></span></dt><dt><span class="sect1"><a href="#named_update">6.6. Updating Data: The On Update Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#named_update_namedwin">6.6.1. Notes on On-Update With Named Windows</a></span></dt><dt><span class="sect2"><a href="#named_update_table">6.6.2. Notes on On-Update With Tables</a></span></dt></dl></dd><dt><span class="sect1"><a href="#named_delete">6.7. Deleting Data: The On Delete Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#named_delete_pattern">6.7.1. Using Patterns in the On-Delete Clause</a></span></dt><dt><span class="sect2"><a href="#named_delete_namedwin">6.7.2. Notes on On-Delete With Named Windows</a></span></dt><dt><span class="sect2"><a href="#named_delete_table">6.7.3. Notes on On-Update With Tables</a></span></dt></dl></dd><dt><span class="sect1"><a href="#named_upsert">6.8. Triggered Upsert Using the On-Merge Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#named_upsert_insertunmatched">6.8.1. On-Merge Insert</a></span></dt><dt><span class="sect2"><a href="#named_upsert_upsert">6.8.2. On-Merge Update, Delete, Select (Upsert)</a></span></dt><dt><span class="sect2"><a href="#named_merge_namedwin">6.8.3. Notes on On-Merge With Named Windows</a></span></dt><dt><span class="sect2"><a href="#named_merge_table">6.8.4. Notes on On-Merge With Tables</a></span></dt></dl></dd><dt><span class="sect1"><a href="#named_explicit_index">6.9. Explicitly Indexing Named Windows and Tables</a></span></dt><dt><span class="sect1"><a href="#nwtable-faf">6.10. Using Fire-and-Forget Queries With Named Windows and Tables</a></span></dt><dd><dl><dt><span class="sect2"><a href="#named_insertfaf">6.10.1. Inserting Data</a></span></dt><dt><span class="sect2"><a href="#named_update_faf">6.10.2. Updating Data</a></span></dt><dt><span class="sect2"><a href="#named_delete_faf">6.10.3. Deleting Data</a></span></dt></dl></dd><dt><span class="sect1"><a href="#named_versioning">6.11. Versioning and Revision Event Type Use With Named Windows</a></span></dt><dt><span class="sect1"><a href="#named-eventasproperty">6.12. Events as Property</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="nwtable-overview"/>6.1.Â Overview</h2></div></div></div><a id="d0e14669" class="indexterm"/><a id="d0e14674" class="indexterm"/><p>
			A <span class="emphasis"><em>named window</em></span> is a globally-visible data window. A <span class="emphasis"><em>table</em></span> is a globally-visible data structure organized by primary key or keys.
		</p><p>
			Named windows and tables both offer a way to share state between statements and are stateful. 
			Named windows and tables have differing capabilities and semantics. 
		</p><p>
			To query a named window or table, simply use the named window name or table name in the <code class="literal">from</code> clause of your statement, 
			including statements that contain subqueries, joins and outer-joins.
		</p><p>
			Certain clauses operate on either a named window or a table, namely the 
			<code class="literal">on-merge</code>, <code class="literal">on-update</code>, <code class="literal">on-delete</code> and <code class="literal">on-select</code> clauses. 
			The fire-and-forget queries also operate on both named windows and tables.
		</p><p>
			Both named windows and tables can have columns that hold events as column values, as further described in <a class="xref" href="#named-eventasproperty" title="6.12.Â Events as Property">SectionÂ 6.12, âEvents as Propertyâ</a>.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="nwtable-overview-namedwindow"/>6.1.1.Â Named Window Overview</h3></div></div></div><a id="d0e14715" class="indexterm"/><a id="d0e14718" class="indexterm"/><p>
				A <span class="emphasis"><em>named window</em></span> is a global data window that can take part in many statement queries, and that can be inserted-into and deleted-from by multiple statements. A named window holds events of the same type or supertype, unless used with a variant stream. 
			</p><p>
				The <code class="literal">create window</code> clause declares a new named window. The named window starts up empty unless populated from an existing named window at time of creation. Events must be inserted into the named window using the <code class="literal">insert into</code> clause. Events can also be deleted from a named window via the <code class="literal">on delete</code> clause. 
			</p><p>
				Events enter the named window by means of <code class="literal">insert into</code> clause of a <code class="literal">select</code> statement. Events leave a named window either because the expiry policy of the declared data window removes events from the named window, or through statements that use the <code class="literal">on delete</code> clause to explicitly delete from a named window.
			</p><p>
				A named window may also decorate an event to preserve original events as described in <a class="xref" href="#insert-into-decorated" title="5.10.4.Â Decorated Events">SectionÂ 5.10.4, âDecorated Eventsâ</a> and <a class="xref" href="#named-insertinto-decorated" title="6.2.2.1.Â Named Windows Holding Decorated Events">SectionÂ 6.2.2.1, âNamed Windows Holding Decorated Eventsâ</a>.
			</p><p>
				To tune subquery performance when the subquery selects from a named window, consider the hints discussed in <a class="xref" href="#epl-subqueries-hints" title="5.11.8.Â Hints Related to Subqueries">SectionÂ 5.11.8, âHints Related to Subqueriesâ</a>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="nwtable-overview-table"/>6.1.2.Â Table Overview</h3></div></div></div><a id="d0e14763" class="indexterm"/><a id="d0e14766" class="indexterm"/><p>
				A <span class="emphasis"><em>table</em></span> is a data structure that is globally visible and that holds state. 
			</p><p>
				The columns of a table can store aggregation state, allowing for co-location of event data with aggregation state. 
				Other statements can directly create and update the shared aggregation state. Statements can also query the aggregation state conveniently.
				Aggregation state can include comprehensive state such as for example a large matrix of long-type values for use in a Count-min sketch approximation.
				Common aggregation state can be updated by multiple statements.
			</p><p>
				Use the <code class="literal">create table</code> clause to declare a new table.
			</p><p>
				The atomicity guarantees under multi-threaded evaluation are as follows. For a given statement, a table row or rows either exists or do not exist, consistently, 
				for the duration of the evaluation of an event or timer against a context partition of a statement. The same is true for updates in that for a given context partition of a statement, 
				each table row is either completely updated or not updated at all for the duration of an evaluation. Stream-level filter expressions against tables are not part of statement evaluation
				and the same atomicity applies to stream-level filter expressions.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="nwtable-overview-compare"/>6.1.3.Â Comparing Named Windows and Tables</h3></div></div></div><p>
			  As a general rule-of-thumb, if you need to share a data window between statements, the named window is the right approach. 
			  If however rows are organized by primary key or hold aggregation state, a table may be preferable. EPL statements allow the combined use of both.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="nwtable-overview-compare-1"/>6.1.3.1.Â Nature of Data</h4></div></div></div><p>
					One important difference between named windows and tables is in the data that a row holds: While named windows hold events, tables can hold additional derived state.
				</p><p>
					For example, a table column can hold rich derived state such as a distinct values set and rich aggregation state such as the state of a Count-min sketch approximation aggregation (a large matrix of long-type values).
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Declare a table to hold a Count-min sketch approximate count per feed
create table AppoximateCountPerWord (feed string, approx countMinSketch())</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="nwtable-overview-compare-2"/>6.1.3.2.Â Data Organization</h4></div></div></div><p>
					A second difference between named windows and tables is the organization of rows. For named windows, the organization of rows follows the data window declaration. 
					Tables, on the other hand, can be organized by a primary key or by multiple primary keys that make up a compound key.
				</p><p>
					For example, if your declaration specifies a sliding time window to hold 10 seconds of stock tick events then the rows are held in a sliding time window, i.e. a list or queue according to arrival order. 
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Declare a named window to hold 10 seconds of stock tick events
create window TenSecOfTicksWindow#time(10 sec) as StockTickEvent</pre><p>
					An iterator for a named window returns rows in the order as provided by the data window(s) declared for the named window.
					An iterator for a table returns rows in an unpredictable order.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="nwtable-overview-compare-3"/>6.1.3.3.Â Insert and Remove Stream</h4></div></div></div><p>
					Only named windows provide an insert and remove stream to other statements. Tables do not provide an insert and remove stream.
				</p><p>
					For example, considering the <code class="literal">TenSecOfTicksWindow</code> named window declared above, 
					the following statement outputs the current count each time events enter or leave the named window.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*) from TenSecOfTicksWindow</pre><p>
					Also for example, considering the <code class="literal">AppoximateCountPerWord</code> table declared above, the following EPL does not output any rows
					when table rows gets inserted, updated or deleted and only outputs rows when the statement is iterated:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// does not continously output for table changes
select * from AppoximateCountPerWord</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="nwtable-overview-compare-4"/>6.1.3.4.Â Immutability and Copy-On-Write</h4></div></div></div><p>
					As named windows hold events and events are immutable, when an update statement updates events held in a named window, the engine performs a logical copy operation (copy-on-write, as configured for the type) of each updated event, and only modifies the newly created event, preserving the immutable original event.
				</p><p>
					Data in tables are updated in-place. There is no copy operation for table rows.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="nwtable-overview-compare-5"/>6.1.3.5.Â Removal of Rows</h4></div></div></div><p>
					For named windows, the data window declared for the named window instructs the engine to expire and remove events from the named window. 
					Events can also be removed via <code class="literal">on-merge</code>, <code class="literal">on-delete</code> and fire-and-forget <code class="literal">delete</code>.
				</p><p>
					For tables, row can only be removed via <code class="literal">on-merge</code>, <code class="literal">on-delete</code>, <code class="literal">on-select-and-delete</code> and fire-and-forget <code class="literal">delete</code>.
				</p></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="nwtable-namedwindow"/>6.2.Â Named Window Usage</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="named_create"/>6.2.1.Â Creating Named Windows: The <code class="literal">Create Window</code> clause</h3></div></div></div><p>
				The <code class="literal">create window</code> statement creates a named window by specifying a window name and one or more data windows, as well as the type of event to hold in the named window.
			</p><p>
				There are two syntaxes for creating a named window: The first syntax allows modeling a named window after an existing event type or an existing named window. The second syntax is similar to the SQL create-table syntax and provides a list of column names and column types. 
			</p><p>
				A new named window starts up empty. It must be explicitly inserted into by one or more statements, as discussed below. A named window can also be populated at time of creation from an existing named window.
			</p><p>
				If your application stops or destroys the statement that creates the named window, any consuming statements no longer receive insert or remove stream events. The named window can also not be deleted from after it was stopped or destroyed.
			</p><p>
				The <code class="literal">create window</code> statement posts to listeners any events that are inserted into the named window as new data. The statement posts all deleted events or events that expire out of the data window to listeners as the remove stream (old data). The named window contents can also be iterated on via the pull API to obtain the current contents of a named window.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="named_create_modelafter"/>6.2.1.1.Â Creation by Modeling After an Existing Type</h4></div></div></div><p>
					The benefit of modeling a named window after an existing event type is that event properties can be nested, indexed, mapped or other types that your event objects may provide as properties, including the type of the underlying event itself. Also, using the wildcard (*) operator means your EPL does not need to list each individual property explicitly.
				</p><p>
					The syntax for creating a named window by modeling the named window after an existing event type, is as follows: 
				</p><pre class="synopsis">[context <span class="emphasis"><em>context_name</em></span>] 
		create window <span class="emphasis"><em>window_name</em></span>.<span class="emphasis"><em>window_spec</em></span> 
		[as] [select <span class="emphasis"><em>list_of_properties</em></span> from] <span class="emphasis"><em>event_type_or_windowname</em></span>
		[insert [where <span class="emphasis"><em>filter_expression</em></span>]]</pre><p>
					The <span class="emphasis"><em>window_name</em></span> you assign to the named window can be any identifier. The name should not already be in use as an event type or stream name or table name.
				</p><p>
					The <span class="emphasis"><em>window_spec</em></span> are one or more data windows that define the expiry policy for removing events from the named window. Named windows must explicitly declare a data window. This is required to ensure that the policy for retaining events in the data window is well defined. To keep all events, use the keep-all window: It indicates that the named window should keep all events and only remove events from the named window that are deleted by <code class="literal">on delete</code>, <code class="literal">on merge</code> or fire-and-forget <code class="literal">delete</code>. Data windows are listed in <a class="xref" href="#epl-views" title="ChapterÂ 13.Â EPL Reference: Data Windows">ChapterÂ 13, <i>EPL Reference: Data Windows</i></a>.
				</p><p>				
					The <code class="literal">select</code> clause and <span class="emphasis"><em>list_of_properties</em></span> are optional. If present, they specify the column names and, implicitly by definition of the event type, the column types of events held by the named window. Expressions other than column names are not allowed in the <code class="literal">select</code> list of properties. Wildcards (*) and wildcards with additional properties can also be used.
				</p><p>				
					The <span class="emphasis"><em>event_type_or_windowname</em></span> is required if using the model-after syntax. It provides the name of the event type of events held in the data window, unless column names and types have been explicitly selected via <code class="literal">select</code>. The name of an (existing) other named window is also allowed here. Please find more details in <a class="xref" href="#named_populate_named" title="6.2.1.4.Â Populating a Named Window From an Existing Named Window">SectionÂ 6.2.1.4, âPopulating a Named Window From an Existing Named Windowâ</a>.
				</p><p>				
					Finally, the <code class="literal">insert</code> clause and optional <span class="emphasis"><em>filter_expression</em></span> are used if the new named window is modelled after an existing named window, and the data of the new named window is to be populated from the existing named window upon creation. The optional <span class="emphasis"><em>filter_expression</em></span> can be used to exclude events.
				</p><p>
				   You may refer to a context by specifying the <code class="literal">context</code> keyword followed by a context name. Contexts are described in more detail at <a class="xref" href="#context" title="ChapterÂ 4.Â Context and Context Partitions">ChapterÂ 4, <i>Context and Context Partitions</i></a>. The effect of referring to a context is that your named window operates according to the context dimensional information as declared for the context. For usage and limitations please see the respective chapter.
				</p><p>
					The next statement creates a named window <code class="literal">OrdersNamedWindow</code> for which the expiry policy is simply to keep all events. Assume that the event type 'OrderMapEventType' has been configured. The named window is to hold events of type 'OrderMapEventType':
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window OrdersNamedWindow#keepall as OrderMapEventType</pre><p>
					The below sample statement demonstrates the <code class="literal">select</code> syntax. It defines a named window in which each row has the three properties 'symbol', 'volume' and 'price'. This named window actively removes events from the window that are older than 30 seconds.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window OrdersTimeWindow#time(30 sec) as 
		select symbol, volume, price from OrderEvent</pre><p>
					In an alternate form, the <code class="literal">as</code> keyword can be used to rename columns, and constants may occur in the select-clause as well:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window OrdersTimeWindow#time(30 sec) as 
  select symbol as sym, volume as vol, price, 1 as alertId from OrderEvent</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
					   The <code class="literal">select</code>-clause when used with <code class="literal">create window</code> provides types information only. You must still use <code class="literal">on-merge</code> or <code class="literal">insert-into</code> to insert events.
				   </p></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="named_create_explicit"/>6.2.1.2.Â Creation By Defining Columns Names and Types</h4></div></div></div><p>
					The second syntax for creating a named window is by supplying column names and types: 
				</p><pre class="synopsis">[context <span class="emphasis"><em>context_name</em></span>] 
create window <span class="emphasis"><em>window_name</em></span>.<span class="emphasis"><em>window_spec</em></span> [as] (<span class="emphasis"><em>column_name</em></span> <span class="emphasis"><em>column_type</em></span> 
  [,<span class="emphasis"><em>column_name</em></span> <span class="emphasis"><em>column_type</em></span> [,...])</pre><p>				
					The <span class="emphasis"><em>column_name</em></span> is an identifier providing the event property name. The <span class="emphasis"><em>column_type</em></span> is also required for each column. Valid column types are listed in <a class="xref" href="#variable_create" title="5.17.1.Â Creating Variables: The Create Variable Clause">SectionÂ 5.17.1, âCreating Variables: The Create Variable Clauseâ</a>
					and are the same as for variable types.
				</p><p>
					For attributes that are array-type append <code class="literal">[]</code> (left and right brackets). 
				</p><p>
					The next statement creates a named window:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window SecurityEvent#time(30 sec) 
(ipAddress string, userId String, numAttempts int, properties String[])</pre><p>
					Named window columns can hold events by declaring the column type as the event type name. Array-type in combination with event-type is also supported.
				</p><p>
					The next two statements declare an event type and create a named window with a column of the defined event type:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema SecurityData (name String, roles String[])</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window SecurityEvent#time(30 sec) 
    (ipAddress string, userId String, secData SecurityData, historySecData SecurityData[])</pre><p>
				  Whether the named window uses a Map, Object-array or Avro event representation for the rows can be specified as follows. If the create-window statement provides the <code class="literal">@EventRepresentation(objectarray)</code> annotation the engine maintains named window rows as object array. If the statement provides the <code class="literal">@EventRepresentation(map)</code> annotation the engine maintains named window rows using Map objects. If neither annotation is provided, the engine uses the configured default event representation as discussed in <a class="xref" href="#config-engine-eventmeta-representation" title="15.4.14.1.Â Default Event Representation">SectionÂ 15.4.14.1, âDefault Event Representationâ</a>.
				</p><p>
					The following EPL statement instructs the engine to represent FooWindow rows as object arrays:
				 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@EventRepresentation(objectarray) create window FooWindow#time(5 sec) as (string prop1)</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="named_create_drop"/>6.2.1.3.Â Dropping or Removing Named Windows</h4></div></div></div><p>
					There is no syntax to drop or remove a named window.
				</p><p>
					The <code class="literal">destroy</code> method on the <code class="literal">EPStatement</code> that created the named window removes the named window. 
					When using the deployment API the engine also removes the type information associated to the named window. 
					Otherwise the named window type information remains available since further statements may continue to use that type.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="named_populate_named"/>6.2.1.4.Â Populating a Named Window From an Existing Named Window</h4></div></div></div><a id="d0e15098" class="indexterm"/><a id="d0e15101" class="indexterm"/><a id="d0e15106" class="indexterm"/><p>
					Your EPL statement may specify the name of an existing named window when creating a new named window, and may use the <code class="literal">insert</code> keyword to indicate that the new named window is to be populated from 
					the events currently held by the existing named window.
				</p><p>
					For example, and assuming the named window <code class="literal">OrdersNamedWindow</code> already exists, this statement creates a new named window <code class="literal">ScratchOrders</code> and populates all orders in <code class="literal">OrdersNamedWindow</code> into the new named window:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window ScratchOrders#keepall as OrdersNamedWindow insert</pre><p>
					The <code class="literal">where</code> keyword is also available to perform filtering, for example:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window ScratchBuyOrders#time(10) as OrdersNamedWindow insert where side = 'buy'</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="named_inserting"/>6.2.2.Â Inserting Into Named Windows</h3></div></div></div><a id="d0e15141" class="indexterm"/><a id="d0e15146" class="indexterm"/><p>
				The <code class="literal">insert into</code> clause inserts events into named windows. Your application must ensure that the column names and types match the declared column names and types of the named window to be inserted into.
			</p><p>
				  For inserting into a named window and for simultaneously checking if the inserted row already exists in the named window or for atomic update-insert operation on a named window, or for targeting a specific partition, you must use <code class="literal">on-merge</code> as described in <a class="xref" href="#named_upsert" title="6.8.Â Triggered Upsert Using the On-Merge Clause">SectionÂ 6.8, âTriggered Upsert Using the On-Merge Clauseâ</a>. On-merge
				  is similar to the SQL <code class="literal">merge</code> clause and provides what is known as an "Upsert" operation: Update existing events or if no existing event(s) are found then insert a new event, all in one atomic operation provided by a single EPL statement.
			</p><p>
				This example first creates a named window using some of the columns of an OrderEvent event type:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window OrdersWindow#keepall as select symbol, volume, price from OrderEvent</pre><p>
				The insert into the named window selects individual columns to be inserted:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into OrdersWindow(symbol, volume, price) select name, count, price from FXOrderEvent</pre><p>
			  An alternative form is shown next:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into OrdersWindow select name as symbol, vol as volume, price from FXOrderEvent</pre><p>
				Following above statement, the engine enters every FXOrderEvent arriving into the engine into the named window 'OrdersWindow'.
			</p><p>
				The following EPL statements create a named window for an event type backed by a Java class and insert into the window any 'OrderEvent' where the symbol value is IBM:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window OrdersWindow#time(30) as com.mycompany.OrderEvent</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into OrdersWindow select * from com.mycompany.OrderEvent(symbol='IBM')</pre><p>
				The last example adds one column named 'derivedPrice' to the 'OrderEvent' type by specifying a wildcard, and uses a user-defined function to populate the column:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window OrdersWindow#time(30) as select *, price as derivedPrice from OrderEvent</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into OrdersWindow select *, MyFunc.func(price, percent) as derivedPrice from OrderEvent</pre><p>
				Event representations based on Java base classes or interfaces, and subclasses or implementing classes, are compatible as these statements show:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// create a named window for the base class
create window OrdersWindow#unique(name) as select * from ProductBaseEvent</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// The ServiceProductEvent class subclasses the ProductBaseEvent class
insert into OrdersWindow select * from ServiceProductEvent</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// The MerchandiseProductEvent class subclasses the ProductBaseEvent class
insert into OrdersWindow select * from MerchandiseProductEvent</pre><p>
				To avoid duplicate events inserted in a named window and atomically check if a row already exists, use <code class="literal">on-merge</code> as outlined in <a class="xref" href="#named_upsert" title="6.8.Â Triggered Upsert Using the On-Merge Clause">SectionÂ 6.8, âTriggered Upsert Using the On-Merge Clauseâ</a>. An example:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on ServiceProductEvent as spe merge OrdersWindow as win
where win.id = spe.id when not matched then insert select *</pre><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="named-insertinto-decorated"/>6.2.2.1.Â Named Windows Holding Decorated Events</h4></div></div></div><p>
					Decorated events hold an underlying event and add additional properties to the underlying event, as described further in <a class="xref" href="#insert-into-decorated" title="5.10.4.Â Decorated Events">SectionÂ 5.10.4, âDecorated Eventsâ</a>.
				</p><p>
					This sample EPL query creates a named window that decorates OrderEvent events by adding an additional property named <code class="literal">priceTotal</code> to each OrderEvent. A matching <code class="literal">insert into</code> statement is also part of the sample:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window OrdersWindow#time(30) as select *, price as priceTotal from OrderEvent</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into OrdersWindow select *, price * unit as priceTotal from ServiceOrderEvent</pre><p>
					The property type of the additional <code class="literal">priceTotal</code> column is the property type of the existing <code class="literal">price</code> property of OrderEvent.
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="named_selecting"/>6.2.3.Â Selecting From Named Windows</h3></div></div></div><a id="d0e15241" class="indexterm"/><a id="d0e15246" class="indexterm"/><p>
				A named window can be referred to by any statement in the <code class="literal">from</code> clause of the statement. Filter criteria can also be specified. Data windows cannot be specified when selecting from a named window (the special derived-value windows are allowed however).
			</p><p>
				A statement selecting all events from a named window <code class="literal">OrdersNamedWindow</code> is shown next. The named window must first be created via the <code class="literal">create window</code> clause before use.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from OrdersNamedWindow</pre><p>
				The statement as above simply receives the unfiltered insert stream of the named window and reports that stream to its listeners. The <code class="literal">iterator</code> method returns all events in the named window, if any.
			</p><p>
				If your application desires to obtain the events removed from the named window, use the <code class="literal">rstream</code> keyword as this statement shows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select rstream * from OrdersNamedWindow</pre><p>
				The next statement derives an average price per symbol for the events held by the named window: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, avg(price) from OrdersNamedWindow group by symbol</pre><p>
				A statement that consumes from a named window, like the one above, 
				receives the insert and remove stream of the named window. The insert stream represents the events inserted into the named window. The remove stream represents the events expired from 
				the named window data window and the events explicitly deleted via <code class="literal">on-delete</code> for on-demand (fire-and-forget) <code class="literal">delete</code>.				 
			</p><p>
				Your application may create a consuming statement such as above on an empty named window, or your application may create the above statement on an already filled named window. The engine provides correct results in either case: 
				At the time of statement creation the Esper engine internally initializes the consuming statement from the current named window, also taking your declared filters into consideration. Thus, your statement deriving data from a named window does not start empty if the named window already holds one or more events. A consuming statement also sees the remove stream of an already populated named window, if any.
			</p><p>
				If you require a subset of the data in the named window, you can specify one or more filter expressions onto the named window as shown here:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, avg(price) from OrdersNamedWindow(sector='energy') group by symbol</pre><p>
				By adding a filter to the named window, the aggregation and grouping receive a filtered insert and remove stream. The above statement thus outputs, continuously, the average price per symbol for all orders in the named window that belong to a certain sector.
			</p><p>
				A side note on variables in filters filtering events from named windows: The engine initializes consuming statements at statement creation time and changes aggregation state continuously as events arrive. If the filter criteria contain variables and variable values changes, then the engine does not re-evaluate or re-build aggregation state. In such a case you may want to place variables in the <code class="literal">having</code> clause which evaluates on already-built aggregation state.
			</p><p>
				The following example further declares a custom derived-value window named <code class="literal">myplugindatawindow</code>.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from OrdersNamedWindow(volume&gt;0, price&gt;0)#myplugindatawindow()</pre><p>
				Data windows cannot be used onto named windows since named windows post insert and remove streams for the events entering and leaving the named window, thus the expiry policy and batch behavior are well defined by the data window 	declared for the named window. For example, the following is not allowed and fails at time of statement creation:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// not a valid statement
	select * from OrdersNamedWindow#time(30 sec)</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="nwtable-table"/>6.3.Â Table Usage</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="table_create"/>6.3.1.Â Creating Tables: The <code class="literal">Create Table</code> Clause</h3></div></div></div><p>
				The <code class="literal">create table</code> statement creates a table.
			</p><p>
				A new table starts up empty. It must be explicitly aggregated-into using <code class="literal">into table</code>, or populated by an <code class="literal">on-merge</code> statement, or populated by <code class="literal">insert into</code>.
			</p><p>
				The syntax for creating a table provides the table name, lists column names and types and designates primary key columns: 
			</p><pre class="synopsis">[context <span class="emphasis"><em>context_name</em></span>] 
create table <span class="emphasis"><em>table_name</em></span> [as] (<span class="emphasis"><em>column_name</em></span> <span class="emphasis"><em>column_type</em></span> [<code class="literal">primary key</code>]
  [,<span class="emphasis"><em>column_name</em></span> <span class="emphasis"><em>column_type</em></span> [<code class="literal">primary key</code>] [,...]])</pre><p>
				The <span class="emphasis"><em>table_name</em></span> you assign to the table can be any identifier. The name should not already be in use as an event type or named window name.
			</p><p>
			   You may refer to a context by specifying the <code class="literal">context</code> keyword followed by a context name. Contexts are described in more detail at <a class="xref" href="#context" title="ChapterÂ 4.Â Context and Context Partitions">ChapterÂ 4, <i>Context and Context Partitions</i></a>. The effect of referring to a context is that your table operates according to the context dimensional information as declared for the context. For usage and limitations please see the respective chapter.
			</p><p>				
				The <span class="emphasis"><em>column_name</em></span> is an identifier providing the column name.
			</p><p>				
				The <span class="emphasis"><em>column_type</em></span> is required for each column. There are two categories of column types:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						Non-aggregating column types: Valid column types are listed in <a class="xref" href="#variable_create" title="5.17.1.Â Creating Variables: The Create Variable Clause">SectionÂ 5.17.1, âCreating Variables: The Create Variable Clauseâ</a> and are the same as for variable types.
						For attributes that are array-type append <code class="literal">[]</code> (left and right brackets). 
				        Table columns can hold events by declaring the column type as the event type name. Array-type in combination with event-type is also supported.
					</p></li><li><p>
						Aggregation column types: These instruct the engine to retain aggregation state. 
					</p></li></ol></div><p>
				After each column type you may add the <code class="literal">primary key</code> keywords. This keyword designates the column as a primary key. 
				When multiple columns are designated as primary key columns the combination of column values builds a compound primary key.
				The order in which the primary key columns are listed is important.
			</p><p>
				The next statement creates a table to hold a <code class="literal">numAttempts</code> count aggregation state and a column named <code class="literal">active</code> of type boolean, per <code class="literal">ipAddress</code> and <code class="literal">userId</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table SecuritySummaryTable (
  ipAddress string primary key,
  userId String primary key, 
  numAttempts count(*),
  active boolean)</pre><p>
				The example above specifies <code class="literal">ipAddress</code> and <code class="literal">userId</code> as primary keys. This instructs the engine that the table holds a single row
				for each distinct combination of <code class="literal">ipAddress</code> and <code class="literal">userId</code>. The two values make up the compound key and there is a single row per compound key value.
			</p><p>
				If you do not designate any columns of the table as a primary key column, the table holds only one row (or no rows).
			</p><p>
				The create table statement does not provide output to its listeners. The table contents can be iterated on via the pull API to obtain the current contents of a table. 
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="nwtable-table-aggtypessql"/>6.3.1.1.Â Column Types for Aggregation Functions</h4></div></div></div><p>
					All aggregation functions can be used as column types for tables. Please simply list the aggregation function name as the column type
					and provide type information, when required.
					See <a class="xref" href="#epl-function-aggregation-std" title="10.2.1.Â SQL-Standard Functions">SectionÂ 10.2.1, âSQL-Standard Functionsâ</a> for a list of the functions and required parameter expressions for which you must provide type information.
				</p><p>
					Consider the next example that declares a table with columns for different aggregation functions (not a comprehensive example of all possible aggregation functions):
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table MyStats (
  myKey string primary key,
  myAvedev avedev(int), // column holds a mean deviation of int-typed values
  myAvg avg(double), // column holds an average of double-typed values
  myCount count(*), // column holds a count
  myMax max(int), // column holds a highest int-typed value
  myMedian median(float), // column holds the median of float-typed values
  myStddev stddev(java.math.BigDecimal), // column holds a standard deviation of BigDecimal values
  mySum sum(long), // column holds a sum of long values
  myFirstEver firstever(string), // column holds a first-ever value of type string
  myCountEver countever(*) // column holds the count-ever (regardless of data windows)
)</pre><p>
					Additional keywords such as <code class="literal">distinct</code> can be used as well. If your aggregation will be associated with a filter expression, you must add <code class="literal">boolean</code> to 
					the parameters in the column type declaration.
				</p><p>
					For example, the next EPL declares a table with aggregation-type columns that hold an average of filtered double-typed values and an average of distinct double-typed values:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table MyStatsMore (
  myKey string primary key,
  myAvgFiltered avg(double, boolean), // column holds an average of double-typed values
                      // and filtered by a boolean expression to be provided
  myAvgDistinct avg(distinct double) // column holds an average of distinct double-typed values
)</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="nwtable-table-aggtypesother"/>6.3.1.2.Â Column Types for Event Aggregation Functions</h4></div></div></div><p>
					The event aggregation functions can be used as column types for tables. 
					For event aggregation functions you must specify the event type using the <code class="literal">@type(</code><span class="emphasis"><em>name</em></span><code class="literal">)</code> annotation.
				</p><p>
					The <code class="literal">window</code> event aggregation function requires the <code class="literal">*</code> wildcard. 
					The <code class="literal">first</code> and <code class="literal">last</code> cannot be used in a declaration, please use <code class="literal">window</code> instead and access 
					as described in <a class="xref" href="#table_keyedaccess_aggregation" title="6.3.3.2.Â Accessing Aggregation State With The Dot Operator">SectionÂ 6.3.3.2, âAccessing Aggregation State With The Dot Operatorâ</a>.
				</p><p>
					The <code class="literal">sorted</code>, <code class="literal">maxbyever</code> and <code class="literal">minbyever</code> event aggregation functions require the criteria expression as a parameter. 
					The criteria expression must only use properties of the provided event type. 
					The <code class="literal">maxby</code> and <code class="literal">minby</code> cannot be used in a declaration, please use <code class="literal">sorted</code> instead and access 
					as described in <a class="xref" href="#table_keyedaccess_aggregation" title="6.3.3.2.Â Accessing Aggregation State With The Dot Operator">SectionÂ 6.3.3.2, âAccessing Aggregation State With The Dot Operatorâ</a>.
				</p><p>
					In this example the table declares sample event aggregations (not a comprehensive example of all possible aggregations):
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table MyEventAggregationTable (
  myKey string primary key,
  myWindow window(*) @type(MyEvent), // column holds a window of MyEvent events
  mySorted sorted(mySortValue) @type(MyEvent), // column holds MyEvent events sorted by mySortValue
  myMaxByEver maxbyever(mySortValue) @type(MyEvent) // column holds the single MyEvent event that 
        // provided the highest value of mySortValue ever
)</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="nwtable-table-aggtypesplugin"/>6.3.1.3.Â Column Types for Plug-In Custom Aggregation Functions</h4></div></div></div><p>
					Any custom single-function and multi-function aggregation can be used as a table column type. If the aggregation has multiple different return values and aggregations share common state, the multi-function aggregation is the preferred API.
				</p><p>
					For example, the next EPL declares a table with a single column that holds the state of the aggregation function <code class="literal">myAggregation</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table MyStatsCustom (myCustom myAggregation('some code', 100))</pre><p>
					The above example passes the values <code class="literal">some code</code> and <code class="literal">100</code> to show how to pass constants to your custom aggregation function at declaration time.
				 </p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="nwtable-table-drop"/>6.3.1.4.Â Dropping or Removing Tables</h4></div></div></div><p>
					There is no syntax to drop or remove a table.
				</p><p>
					The <code class="literal">destroy</code> method on the <code class="literal">EPStatement</code> that created the table removes the table unless it is used by another statement. 
					If your application destroys the statement that creates the table and also destroys all statements referring to the table, the engine removes the table.
					The table contents can be iterated on, by iterating over the statement that creates the table, to obtain the current contents of a table.
				</p><p>
					The <code class="literal">stop</code> method on the <code class="literal">EPStatement</code> that created the table has no effect. 
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="table_agginto"/>6.3.2.Â Aggregating Into Table Rows: The <code class="literal">Into Table</code> Clause</h3></div></div></div><p>
				Use the <code class="literal">into table</code> keywords to instruct the engine to aggregate into table columns. A given statement can only aggregate into a single table.
			</p><p>
				For example, consider a table that holds the count of intrusion events keyed by the combination of from-address and to-address:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table IntrusionCountTable (
  fromAddress string primary key,
  toAddress string primary key,
  countIntrusion10Sec count(*),
  countIntrusion60Sec count(*)
)</pre><p>
				The next sample statement updates the count considering the last 10 seconds of events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">into table IntrusionCountTable
select count(*) as countIntrusion10Sec
from IntrusionEvent#time(10)
group by fromAddress, toAddress</pre><p>
				Multiple statements can aggregate into the same table columns or different table columns. 
				The co-aggregating ability allows you to co-locate aggregation state conveniently.
			</p><p>
				The sample shown below is very similar to the previous statement except that it updates the count considering the last 60 seconds of events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">into table IntrusionCountTable
select count(*) as countIntrusion60Sec
from IntrusionEvent#time(60)
group by fromAddress, toAddress</pre><p> 
				Considering the example above, when an intrusion event arrives and a row for the group-by key values (from and to-address) does not exists, 
				the engine creates a new row and updates the aggregation-type columns.
				If the row for the group-by key values exists, the engine updates the aggregation-type columns of the existing row.
			</p><p>
				Tables can have no primary key columns. In this case a table either has a single row or is empty.
			</p><p>
				The next two EPL statements demonstrate table use without a primary key column:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table TotalIntrusionCountTable (totalIntrusions count(*))</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">into table TotalIntrusionCountTable select count(*) as totalIntrusions from IntrusionEvent</pre><p>
				In conjunction with <code class="literal">into table</code> the <code class="literal">unidirectional</code> keyword is not supported.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="table_agginto_requiregroupby"/>6.3.2.1.Â Group-By Clause Requirements</h4></div></div></div><p>
					The use of the <code class="literal">into table</code> clause requires that the <code class="literal">group by</code> clause must list group-by expressions 
					that match the table's primary key declarations in terms of the number, return type and order of group-by expressions.
					It is not necessary that table column names match group-by expression texts.
				</p><p>
					For example consider a table with a single long-type primary key column:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table MyTable (theKey long primary key, theCount count(*))</pre><p>
					The following EPL are all not valid:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Invalid: No group-by clause however the table declares a primary key
into table MyTable select count(*) as theCount from MyEvent</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Invalid: Two expressions in the group-by clause however the table declares a single primary key
into table MyTable select count(*) as theCount from MyEvent group by longPropertyOne, longPropertyTwo</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Invalid: The group-by clause expression returns a string-typed value however the table expects a long-type primary key
into table MyTable select count(*) as theCount from MyEvent group by stringProperty</pre><p>
					You may use the <code class="literal">rollup</code>, <code class="literal">cube</code> and <code class="literal">grouping sets</code> keywords in conjunction with tables.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="table_agginto_requireaggcomplete"/>6.3.2.2.Â Aggregation State Requirements</h4></div></div></div><p>
					The use of the <code class="literal">into table</code> clause requires that all aggregation state of the EPL statement resides in table columns.
				</p><p>
					For example consider a simple table as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table MyTable (theKey long primary key, theCount count(*))</pre><p>
					The following EPL is not valid:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Invalid: the sum aggregation state is not available in a table column
into table MyTable select count(*) as theCount, sum(intProperty) from MyEvent group by longProperty</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="table_agginto_requireaggfunc"/>6.3.2.3.Â Aggregation Function Requirements</h4></div></div></div><p>
					The use of the <code class="literal">into table</code> clause requires that all aggregation functions that are listed in the statement are compatible with table column types,
					and that the statement has at least one aggregation function.
				</p><p>
					For example consider a simple table as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table MyTable (theKey long primary key, theCount count(*))</pre><p>
					The following EPL is not valid:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Invalid: the sum aggregation state is not compatible with count(*) that was declared for the table column's type
into table MyTable select sum(intProperty) as theCount from MyEvent group by longProperty</pre><p>
					If declared, the <code class="literal">distinct</code> keyword and filter expressions must also match. The event type information must match for event aggregation functions.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="table_agginto_requirecolname"/>6.3.2.4.Â Column Naming Requirements</h4></div></div></div><p>
					The use of the <code class="literal">into table</code> clause requires that the aggregation functions are named.
					You can name an expression two ways. 
				</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						  First, you can name the aggregation function expression by adding it to the select-clause and by providing the <code class="literal">as</code>-keyword
						  followed by the table column name. The examples earlier use this technique.
						</p></li><li><p>
							Second, you can name the aggregation function by placing it into a declared expression that carries the same name as the table column.
						</p></li></ol></div><p>
					This example demonstrates the second method of naming an aggregation function:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression alias totalIntrusions {count(*)}
select totalIntrusions from IntrusionEvent</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="table_keyedaccess"/>6.3.3.Â Table Column Keyed-Access Expressions</h3></div></div></div><p>
				For accessing table columns by primary key, EPL provides a convenient syntax that allows you to read table column values simply by providing the table name, primary key value expressions (if required by the table) and the column name.
			</p><p>
				The synopsis for table-column access expressions is:
			</p><pre class="synopsis"><span class="emphasis"><em>table-name</em></span>[<span class="emphasis"><em>primary_key_expr</em></span> [, <span class="emphasis"><em>primary_key_expr</em></span>] [,...]][.<span class="emphasis"><em>column-name]</em></span></pre><p>
				The expression starts with the table name.
				If the table declares primary keys you must provide the <span class="emphasis"><em>primary_key_expr</em></span> value expressions for each primary key within square brackets.
				To access a specific column, add the (<code class="literal">.</code>) dot character and the column name.
			</p><p>
				For example, consider a table that holds the count of intrusion events keyed by the combination of from-address and to-address:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table IntrusionCountTable (
  fromAddress string primary key,
  toAddress string primary key,
  countIntrusion10Sec count(*)
)</pre><p>
				Assuming that a <code class="literal">FireWallEvent</code> has string-type properties named <code class="literal">from</code> and <code class="literal">to</code>, the next EPL
				statement outputs the current 10-second intrusion count as held by the <code class="literal">IntrusionCountTable</code> row for the matching combination of keys:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select IntrusionCountTable[from, to].countIntrusion10Sec from FirewallEvent</pre><p>
				The number of primary key expressions, the return type of the primary key expressions and the order in which they are provided must match
				the primary key columns that were declared for the table.
				If the table does not have any primary keys declared, you cannot provide any primary key expressions.
			</p><p>
				If a row for the primary key (or compound key) cannot be found, the engine returns a <code class="literal">null</code> value.
			</p><p>
				An example table without primary key columns is shown next:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table TotalIntrusionCountTable (totalIntrusions count(*))</pre><p>
				A sample statement that outputs the current total count every 60 seconds is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select TotalIntrusionCountTable.totalIntrusions from pattern[every timer:interval(60 sec)]</pre><p>
				Table access expressions can be used anywhere in statements except as parameter expressions for data windows, the <code class="literal">update istream</code>,
				context declarations, output limit expressions, pattern observer and guard parameters, pattern every-distinct, pattern match-until bounds, pattern followed-by max
				and <code class="literal">create window</code> insert or select expression and as a <code class="literal">create variable</code> assignment expression.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="table_keyedaccess_allcolumns"/>6.3.3.1.Â Reading All Column Values</h4></div></div></div><p>
					If your keyed-access expression emits the column name, the engine returns all current column values.
				</p><p>
					An example EPL:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select IntrusionCountTable[from, to] from FirewallEvent</pre><p>
					The engine returns each column value, or null if no row is found. For aggregation-type columns it returns the current aggregation value.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="table_keyedaccess_aggregation"/>6.3.3.2.Â Accessing Aggregation State With The Dot Operator</h4></div></div></div><p>
					Certain aggregation functions allow accessing aggregation state using the (<code class="literal">.</code>) dot operator.
					This includes the <code class="literal">window</code> and the <code class="literal">sorted</code> aggregation function as well as all other custom multi-function aggregation function.
				</p><p>
					The <code class="literal">first</code> and <code class="literal">last</code> aggregation functions can be used with table columns that declare <code class="literal">window</code>.
				</p><p>
					The <code class="literal">maxby</code> and <code class="literal">minby</code> aggregation functions can be used with table columns that declare <code class="literal">sorted</code>.
				</p><p>
					The EPL shown below declares a table that keeps an unsorted set of events and a sorted set of events. This sample table has no primary key columns:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table MyTable (
  theWindow window(*) @type(MyEvent),
  theSorted sorted(mySortValue) @type(MyEvent)
)</pre><p>
					The EPL to read the <code class="literal">first</code> and the <code class="literal">maxBy</code> value is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select MyTable.theWindow.first(), MyTable.theSorted.maxBy() from SomeOtherEvent</pre><p>
					Plug-in custom multi-function aggregations can be used the same way.
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="nwtable-insert"/>6.3.4.Â Inserting Into Tables</h3></div></div></div><a id="d0e15839" class="indexterm"/><a id="d0e15844" class="indexterm"/><p>
				The <code class="literal">insert into</code> clause inserts rows into a table. 
				Your application must ensure that the column names and types match the declared column names and types of the table to be inserted into, when provided.
			</p><p>
				  For inserting into a table and for simultaneously checking if the inserted row already exists in the table or for atomic update-insert operation on a table, or for targeting a specific partition, you must use
				  <code class="literal">on-merge</code> as described in <a class="xref" href="#named_upsert" title="6.8.Â Triggered Upsert Using the On-Merge Clause">SectionÂ 6.8, âTriggered Upsert Using the On-Merge Clauseâ</a>. On-merge
				  is similar to the SQL <code class="literal">merge</code> clause and provides what is known as an "Upsert" operation: Update existing rows or if no existing rows(s) are found then insert a new row, 
				  all in one atomic operation provided by a single EPL statement.
			</p><p>
				The following statement populates the example table declared earlier:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into IntrusionCountTable select fromAddress, toAddress from FirewallEvent</pre><p>
				Note that when a row with the same primary key values already exists, your statement may encounter a unique index violation at runtime.
				If the inserted-into table does not have primary key columns, the table holds a maximum of one row and your statement may also encounter a unique index violation upon
				attempting to insert a second row.
				Use <code class="literal">on-merge</code> to prevent inserts of duplicate rows.
			</p><p>
				Table columns that are aggregation functions cannot be inserted-into and must be updated using <code class="literal">into table</code> instead.
			</p><p>
				You may also explicitly list column names as discussed earlier in <a class="xref" href="#named_inserting" title="6.2.2.Â Inserting Into Named Windows">SectionÂ 6.2.2, âInserting Into Named Windowsâ</a>.
				For <code class="literal">insert-into</code>, the context name must be the same context name as declared for the <code class="literal">create table</code> statement or the context name must be absent for both.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="nwtable-table-selecting"/>6.3.5.Â Selecting From Tables</h3></div></div></div><a id="d0e15893" class="indexterm"/><a id="d0e15898" class="indexterm"/><p>
				A table can be referred to by any statement in the <code class="literal">from</code>-clause of the statement.
			</p><p>
				Tables do not provide an insert and remove stream. When a table appears alone in the <code class="literal">from</code>-clause (other than as part of a subquery), 
				the statement produces output only when iterated (see pull API) or when executing an on-demand (fire-and-forget) query.
			</p><p>
				Assuming you have declared a table by name <code class="literal">IntrusionCountTable</code> as shown earlier,
				the following statement only returns rows when iterated or when executing the EPL as an on-demand query or when adding an <code class="literal">output snapshot</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from IntrusionCountTable</pre><p>
				For tables, the contained-event syntax and specifying a data window is not supported.
				In a join, a table in the <code class="literal">from</code>-clause cannot be marked as <code class="literal">unidirectional</code>. You may not specify any of the retain-flags.
				Tables cannot be used in the <code class="literal">from</code>-clause of match-recognize statements, in context declarations, in pattern filter atoms and <code class="literal">update istream</code>.
			</p><p>
			    The following are examples of invalid statements:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// invalid statement examples
select * from IntrusionCountTable#time(30 sec)   // data window not allowed
select * from IntrusionCountTable unidirectional, MyEvent   // tables cannot be marked as unidirectional</pre><p>
				Tables can be used in subqueries and joins.
			</p><p>
				It follows a sample subselect and join against the table:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select
  (select * from IntrusionCountTable as intr
   where intr.fromAddress = firewall.fromAddress and intr.toAddress = firewall.toAddress) 
from IntrusionEvent as firewall</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from IntrusionCountTable as intr, IntrusionEvent as firewall
where intr.fromAddress = firewall.fromAddress and intr.toAddress = firewall.toAddress</pre><p>
				If the subselect or join specifies all of a table's primary key columns, please consider using the table-access expression instead. It offers a more concise syntax.
			</p><p>
				Note that for a subquery against a table that may return multiple rows, the information about subquery multi-row selection applies. For subselects, consider using <code class="literal">@eventbean</code>
				to preserve table type information in the output event.
			</p><p>
				Note that for joins against tables the engine does not allow specifying table filter expressions in parenthesis, in the <code class="literal">from</code> clause. 
				Filter expressions must instead be placed into the <code class="literal">where</code>-clause.
			</p><p>
				You may access aggregation state the same way as in table-access expressions, using the dot (<code class="literal">.</code>) operator.
			</p><p>
				The EPL shown below declares a table that keeps a set of events, and shows a join that selects window aggregation state:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table MyWindowTable (theWindow window(*) @type(MyEvent))</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select theWindow.first(), theWindow.last(), theWindow.window() from MyEvent, MyWindowTable</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="named_querying"/>6.4.Â Triggered Select: The <code class="literal">On Select</code> Clause</h2></div></div></div><a id="d0e15983" class="indexterm"/><a id="d0e15986" class="indexterm"/><a id="d0e15991" class="indexterm"/><p>
			The <code class="literal">on select</code> clause performs a one-time, non-continuous query on a named window or table every time a triggering event arrives or a triggering pattern matches. The query can consider all rows, or only rows that match certain criteria, or rows that correlate with an arriving event or a pattern of arriving events.
		</p><p>
			The syntax for the <code class="literal">on select</code> clause is as follows: 
		</p><pre class="synopsis">on <span class="emphasis"><em>event_type</em></span>[<span class="emphasis"><em>(filter_criteria)</em></span>] [as <span class="emphasis"><em>stream_name</em></span>]
[insert into <span class="emphasis"><em>insert_into_def</em></span>]
select <span class="emphasis"><em>select_list</em></span>
from <span class="emphasis"><em>window_or_table_name</em></span> [as <span class="emphasis"><em>stream_name</em></span>]
[where <span class="emphasis"><em>criteria_expression</em></span>]
[group by <span class="emphasis"><em>grouping_expression_list</em></span>]
[having <span class="emphasis"><em>grouping_search_conditions</em></span>]
[order by <span class="emphasis"><em>order_by_expression_list</em></span>]
</pre><p>
			The <span class="emphasis"><em>event_type</em></span> is the name of the type of events that trigger the query against the named window or table. It is optionally followed by <span class="emphasis"><em>filter_criteria</em></span> which are filter expressions to apply to arriving events. The optional <code class="literal">as</code> keyword can be used to assign a stream name. Patterns or named windows can also be specified in the <code class="literal">on</code> clause, see the samples in <a class="xref" href="#named_delete_pattern" title="6.7.1.Â Using Patterns in the On-Delete Clause">SectionÂ 6.7.1, âUsing Patterns in the On-Delete Clauseâ</a> (for a named window as a trigger only insert stream events trigger actions) (tables cannot be triggers).
		</p><p>
			The <span class="emphasis"><em>insert into</em></span> clause works as described in <a class="xref" href="#epl-insert-into" title="5.10.Â Merging Streams and Continuous Insertion: The Insert Into Clause">SectionÂ 5.10, âMerging Streams and Continuous Insertion: The Insert Into Clauseâ</a>. The <span class="emphasis"><em>select</em></span> clause is described in <a class="xref" href="#epl-select-list" title="5.3.Â Choosing Event Properties and Events: The Select Clause">SectionÂ 5.3, âChoosing Event Properties and Events: The Select Clauseâ</a>. For all clauses the semantics are equivalent to a join operation: The properties of the triggering event or events are available in the <code class="literal">select</code> clause and all other clauses.
		</p><p>
			The <span class="emphasis"><em>window_or_table_name</em></span> in the <code class="literal">from</code> clause is the name of the named window or table to select rows from. The <code class="literal">as</code> keyword is also available to assign a stream name to the table or named window. The <code class="literal">as</code> keyword is helpful in conjunction with wildcard in the <code class="literal">select</code> clause to select rows via the syntax <code class="literal">select streamname.* </code>.
		</p><p>
			The optional <code class="literal">where</code> clause contains a <span class="emphasis"><em>criteria_expression</em></span> that correlates the arriving (triggering) event to the rows to be considered from the table or named window. The <span class="emphasis"><em>criteria_expression</em></span> may also simply filter for rows to be considered by the query.
		</p><p>
			The <code class="literal">group by</code> clause, the <code class="literal">having</code> clause and the <code class="literal">order by</code> clause are all optional and work as described in earlier chapters.
		</p><p>
			Queries against tables and named windows work the same. The examples herein use the <code class="literal">OrdersNamedWindow</code> named window and the <code class="literal">SecuritySummaryTable</code> table to provide examples for each.
		</p><p>
			The sample statement below outputs, when a query event arrives, the count of all rows held by the <code class="literal">SecuritySummaryTable</code> table:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on QueryEvent select count(*) from SecuritySummaryTable</pre><p>
			This sample query outputs the total volume per symbol ordered by symbol ascending and only non-zero volumes of all rows held by the <code class="literal">OrdersNamedWindow</code> named window:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on QueryEvent
select symbol, sum(volume) from OrdersNamedWindow
group by symbol having volume &gt; 0 order by symbol</pre><p>
			 When using wildcard (*) to select from streams in an on-select clause, each stream, that is the triggering stream and the selected-upon table or named window, are selected, similar to a join. 
			 Therefore your wildcard select returns two columns: the triggering event and the selection result row, for each row.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on QueryEvent as queryEvent
select * from OrdersNamedWindow as win</pre><p>
			 The query above returns a <code class="literal">queryEvent</code> column and a <code class="literal">win</code> column for each event. 
			 If only a single stream's event is desired in the result, use <code class="literal">select win.*</code> instead.
		 </p><p>				
			Upon arrival of a QueryEvent event, this statement selects all rows in the <code class="literal">OrdersNamedWindow</code> named window:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on QueryEvent select win.* from OrdersNamedWindow as win</pre><p>
			 The engine executes the query on arrival of a triggering event, in this case a QueryEvent. It posts the query results to any listeners to the statement, in a single invocation, as the new data array.
		 </p><p>
			The <code class="literal">where</code> clause filters and correlates rows in the table or named window with the triggering event, as shown next: 
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on QueryEvent(volume&gt;0) as query
select query.symbol, query.volume, win.symbol  from OrdersNamedWindow as win
where win.symbol = query.symbol</pre><p>
			 Upon arrival of a QueryEvent, if that event has a value for the volume property that is greater than zero, the engine executes the query. The query considers all events currently held by the <code class="literal">OrdersNamedWindow</code> that match the symbol property value of the triggering QueryEvent event.
		 </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="named_querying_namedwin"/>6.4.1.Â Notes on On-Select With Named Windows</h3></div></div></div><p>
				For correlated queries that correlate triggering events with rows held by a named window, Esper internally creates efficient indexes to enable high performance querying of rows. 
				It analyzes the <code class="literal">where</code> clause to build one or more indexes for fast lookup in the named window based on the properties of the triggering event.
			</p><p>
				 To trigger an on-select when an update to the selected named window occurs or when the triggering event is the same event that is being inserted into the named window, 
				 specify the named window name as the event type.
			</p><p>
				The next query fires the select for every change to the named window OrdersNamedWindow:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on OrdersNamedWindow as trig 
select onw.symbol, sum(onw.volume) 
from OrdersNamedWindow as onw 
where onw.symbol = trig.symbol</pre><p>
				For named windows, the <code class="literal">iterator</code> of the <code class="literal">EPStatement</code> object representing the <code class="literal">on select</code> clause returns the last batch of selected events in response to the last triggering event, or null if the last triggering event did not select any rows.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="named_querying_table"/>6.4.2.Â Notes on On-Select With Tables</h3></div></div></div><p>
				For tables, the <code class="literal">iterator</code> of the <code class="literal">EPStatement</code> object representing the <code class="literal">on select</code> clause returns no events.
			</p><p>
				For correlated queries that correlate triggering events with rows held by a table, the engine utilizes either primary key columns or
				secondary explicitly-created indexes to enable high performance querying of rows, based on an analysis of the <code class="literal">where</code> clause.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="named_query"/>6.4.3.Â <code class="literal">On-Select</code> Compared to Join</h3></div></div></div><p>
				The similarities and differences between an <code class="literal">on select</code> clause and a regular or outer join (and not unidirectional) are as follows: 
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						A join is evaluated when any of the streams participating in the join have new events (insert stream) or events leaving data windows (remove stream).  A join is therefore bi-directional or multi-directional. However, the <code class="literal">on select</code> statement has one triggering event or pattern that causes the query to be evaluated and is thus uni-directional.
					</p></li><li><p>
						The query within the <code class="literal">on select</code> statement is not continuous: It executes only when a triggering event or pattern occurs. Aggregation and groups are computed anew considering the contents of the table or named window at the time the triggering event arrives.
					</p></li></ol></div><p> 
			  <code class="literal">On-select</code> and the unidirectional join can be compared as follows.
			</p><p> 
			  <code class="literal">On-select</code>, <code class="literal">on-merge</code>, <code class="literal">on-insert</code>, <code class="literal">on-delete</code>, <code class="literal">on-update</code> and <code class="literal">on-select-and-delete</code>
			  operate only on named windows or tables. Unidirectional joins however can operate on any stream. 
			  If the unidirectional join is between a single named window or table and a triggering event or pattern and that triggering event or pattern is marked unidirectional, the unidirectional join is equivalent to <code class="literal">on-select</code>.
			</p><p>
				A unidirectional join does not execute under a named window context partition lock and instead is a consumer relationship to the named window.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="named_selectdelete"/>6.5.Â Triggered Select+Delete: The <code class="literal">On Select Delete</code> Clause</h2></div></div></div><a id="d0e16277" class="indexterm"/><a id="d0e16280" class="indexterm"/><a id="d0e16285" class="indexterm"/><p>
			The <code class="literal">on select delete</code> clause performs a one-time, non-continuous query on a table or named window every time a triggering event arrives or a triggering pattern matches, similar to <code class="literal">on-select</code> as described in the previous section. In addition, any selected rows are also deleted.
		</p><p>
			The syntax for the <code class="literal">on select delete</code> clause is as follows: 
		</p><pre class="synopsis">on <span class="emphasis"><em>trigger</em></span>
select [and] delete <span class="emphasis"><em>select_list</em></span>...
... (please see on-select for <code class="literal">insert into, from, group by, having, order by</code>)...</pre><p>
			The syntax follows the syntax of <code class="literal">on-select</code> as described earlier. The <code class="literal">select</code> clause follows the optional <code class="literal">and</code> keyword and the <code class="literal">delete</code> keyword. The <code class="literal">from</code>-clause can list either a table or a named window.
		</p><p>				
			The example statement below selects and deletes all rows from <code class="literal">OrdersNamedWindow</code> named window when a QueryEvent arrives:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on QueryEvent select and delete window(win.*) as rows from OrdersNamedWindow as win</pre><p>				
			The sample EPL above also shows the use of the <code class="literal">window</code> aggregation function. It specifies the <code class="literal">window</code> aggregation function 
			to instruct the engine to output a single event, regardless of the number of rows in the named window, and that contains a column <code class="literal">rows</code> that contains a collection of the selected event's underlying objects.
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
				<code class="literal">On Select Delete</code> deletes all rows that match the where-clause. When there is no where-clause it deletes all rows regardless of what the output looks like. The <code class="literal">having</code>-clause is relevant to output only and does not narrow down the rows that are deleted.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="named_update"/>6.6.Â Updating Data: The <code class="literal">On Update</code> Clause</h2></div></div></div><a id="d0e16366" class="indexterm"/><a id="d0e16369" class="indexterm"/><a id="d0e16374" class="indexterm"/><p>
			An <code class="literal">on update</code> clause updates rows held by a table or named window. The clause can be used to update all rows, or only rows that match certain criteria, or rows that correlate with an arriving event or a pattern of arriving events.
		</p><p>
			For updating a table or named window and for simultaneously checking if the updated row exists or for atomic update-insert operation on a named window or table, consider using <code class="literal">on-merge</code> as described in <a class="xref" href="#named_upsert" title="6.8.Â Triggered Upsert Using the On-Merge Clause">SectionÂ 6.8, âTriggered Upsert Using the On-Merge Clauseâ</a>. 
			On-merge is similar to the SQL <code class="literal">merge</code> clause and provides what is known as an "Upsert" operation: 
			Update existing events or if no existing event(s) are found then insert a new event, all in one atomic operation provided by a single EPL statement.
		</p><p>
			The syntax for the <code class="literal">on update</code> clause is as follows: 
		</p><pre class="synopsis">on <span class="emphasis"><em>event_type</em></span>[<span class="emphasis"><em>(filter_criteria)</em></span>] [as <span class="emphasis"><em>stream_name</em></span>]
update <span class="emphasis"><em>window_or_table_name</em></span> [as <span class="emphasis"><em>stream_name</em></span>]
set <span class="emphasis"><em>mutation_expression</em></span> [, <span class="emphasis"><em>mutation_expression</em></span> [,...]]
[where <span class="emphasis"><em>criteria_expression</em></span>]</pre><p>
			The <span class="emphasis"><em>event_type</em></span> is the name of the type of events that trigger an update of rows in a named window. It is optionally followed by <span class="emphasis"><em>filter_criteria</em></span> which are filter expressions to apply to arriving events. The optional <code class="literal">as</code> keyword can be used to assign a name for use in expressions and the <code class="literal">where</code> clause. Patterns and named windows can also be specified in the <code class="literal">on</code> clause.
		</p><p>
			The <span class="emphasis"><em>window_or_table_name</em></span> is the name of the table or named window to update rows. 
			The <code class="literal">as</code> keyword is also available to assign a name to the named window or table.
		</p><p>
			After the <code class="literal">set</code> keyword follows a list of comma-separated <span class="emphasis"><em>mutation_expression</em></span> expressions. A mutation expression is any valid EPL expression. 
			Subqueries may by part of expressions however aggregation functions and the <code class="literal">prev</code> or <code class="literal">prior</code> function may not be used in expressions.
		</p><p>
			The below table shows some typical mutation expessions:
		</p><div class="table"><a id="d0e16468"/><p class="title"><b>TableÂ 6.1.Â Mutation Expressions in Update and Merge</b></p><div class="table-contents"><table summary="Mutation Expressions in Update and Merge" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Description</th><th>Syntax and Examples</th></tr></thead><tbody><tr><td>Assignment</td><td>
						  <pre class="synopsis"><span class="emphasis"><em>property_name</em></span> = <span class="emphasis"><em>value_expression</em></span></pre>
						  <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">price = 10, side = 'BUY'</pre>
						</td></tr><tr><td>Event Method Invocation (not available for tables)</td><td>
							<pre class="synopsis"><span class="emphasis"><em>alias_or_windowname</em></span>.<span class="emphasis"><em>methodname</em></span>(...)</pre>
						   <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">orderWindow.clear()</pre>
						</td></tr><tr><td>Property Method Invocation</td><td>
							<pre class="synopsis"><span class="emphasis"><em>property_name</em></span>.<span class="emphasis"><em>methodname</em></span>(...)</pre>
						   <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">accountMap.clear()</pre>
						</td></tr><tr><td>User-Defined Function Call</td><td>
							<pre class="synopsis"><span class="emphasis"><em>functionname</em></span>(...)</pre>
						   <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">clearQuantities(orderRow)</pre>
						</td></tr></tbody></table></div></div><br class="table-break"/><p>
			The optional <code class="literal">where</code> clause contains a <span class="emphasis"><em>criteria_expression</em></span> that correlates the arriving (triggering) event to the rows to be updated in the table or named window. The <span class="emphasis"><em>criteria_expression</em></span> may also simply filter for rows to be updated.
		</p><p>
			Queries against tables and named windows work the same. We use the term property and column interchangeably. The examples herein use the <code class="literal">OrdersNamedWindow</code> named window and the <code class="literal">SecuritySummaryTable</code> table to provide examples for each. Let's look at a couple of examples.
		</p><p>				
			In the simplest form, this statement updates all rows in the named window <code class="literal">OrdersNamedWindow</code> when any <code class="literal">UpdateOrderEvent</code> event arrives, setting the price property to zero for all rows currently held by the named window:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on UpdateOrderEvent update OrdersNamedWindow set price = 0</pre><p>
			This example demonstrates the use of a <code class="literal">where</code> clause and updates the <code class="literal">SecuritySummaryTable</code> table. 
			Upon arrival of a triggering <code class="literal">ResetEvent</code> it updates the <code class="literal">active</code> column value to false for all table rows that have an <code class="literal">active</code> column value of true:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on ResetEvent update SecuritySummaryTable set active = false where active = true</pre><p>				
			The next example shows a more complete use of the syntax, and correlates the triggering event with rows held by the <code class="literal">OrdersNamedWindow</code> named window:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on NewOrderEvent(volume&gt;0) as myNewOrders
update OrdersNamedWindow as myNamedWindow 
set price = myNewOrders.price
where myNamedWindow.symbol = myNewOrders.symbol</pre><p>				
			In the above sample statement, only if a <code class="literal">NewOrderEvent</code> event with a volume greater then zero arrives does the statement trigger. Upon triggering, all rows in the named window that have the same value for the symbol property as the triggering <code class="literal">NewOrderEvent</code> event are then updated (their price property is set to that of the arriving event). The statement also showcases the <code class="literal">as</code> keyword to assign a name for use in the <code class="literal">where</code> expression.
		</p><p>
			Your application can subscribe a listener to your <code class="literal">on update</code> statements to determine update events. The statement post any rows that are updated to all listeners attached to the statement as new data, and the events prior to the update as old data.
		</p><p>
			The following example shows the use of tags and a pattern. It sets the price value of orders to that of either a <code class="literal">FlushOrderEvent</code> or <code class="literal">OrderUpdateEvent</code> depending on which arrived:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on pattern [every ord=OrderUpdateEvent(volume&gt;0) or every flush=FlushOrderEvent] 
update OrdersNamedWindow as win
set price = case when ord.price is null then flush.price else ord.price end
where ord.id = win.id or flush.id = win.id</pre><p>
			When updating indexed properties use the syntax <span class="emphasis"><em>propertyName</em></span><code class="literal">[</code><span class="emphasis"><em>index</em></span><code class="literal">] = </code><span class="emphasis"><em>value</em></span> with the index value being an integer number. 
			When updating mapped properties use the syntax <span class="emphasis"><em>propertyName</em></span><code class="literal">(</code><span class="emphasis"><em>key</em></span><code class="literal">) = </code><span class="emphasis"><em>value</em></span> with the key being a string value.
		</p><p>
		  The engine executes assignments in the order they are listed. When performing multiple assignments, the engine takes the most recent column value according to the last assignment, if any. To instruct the engine to use the initial value before update, prefix the column name with the literal <code class="literal">initial</code>.
		</p><p>
		  The following statement illustrates:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on UpdateEvent as upd
update MyWindow as win
set field_a = 1, 
  field_b = win.field_a, // assigns the value 1 
  field_c = initial.field_a // assigns the field_a original value before update</pre><p>
		   The next example assumes that your application provides a user-defined function <code class="literal">copyFields</code> that receives 3 parameters:
		   The update event, the new row and the initial state before-update row.
		 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on UpdateEvent as upd update MyWindow as win set copyFields(win, upd, initial)</pre><p>
		   You may invoke a method on a value object, for those properties that hold value objects, as follows:
		 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on UpdateEvent update MyWindow as win set someproperty.clear()</pre><p>
		   For named windows only, you may also invoke a method on the named window event type.
		 </p><p>
		    The following example assumes that your event type provides a method by name <code class="literal">populateFrom</code> that receives the update event as a parameter:
		 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on UpdateEvent as upd update MyWindow as win set win.populateFrom(upd)</pre><p>
			The following restrictions apply:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Each property to be updated via assignment must be writable. For tables, all columns are always writable.</p></li><li><p>For underlying event representations that are Java objects, a event object class must implement the java.io.Serializable interface as discussed in <a class="xref" href="#epl-update-object" title="5.20.1.Â Immutability and Updates">SectionÂ 5.20.1, âImmutability and Updatesâ</a> and must provide setter methods for updated properties.</p></li><li><p>When using an XML underlying event type, event properties in the XML document representation are not available for update.</p></li><li><p>Nested properties are not supported for update. Revision event types and variant streams may also not be updated.</p></li></ol></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="named_update_namedwin"/>6.6.1.Â Notes on On-Update With Named Windows</h3></div></div></div><p>
				Statements that reference the named window receive the new event in the insert stream and the event prior to the update in the remove stream. 
			</p><p>				
				For correlated queries (as above) that correlate triggering events with events held by a named window, Esper internally creates efficient indexes to enable high performance update of events.
			</p><p>
				The <code class="literal">iterator</code> of the <code class="literal">EPStatement</code> object representing the <code class="literal">on update</code> clause can also be helpful: It returns the last batch of updated events in response to the last triggering event, in any order, or null if the last triggering event did not update any rows.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="named_update_table"/>6.6.2.Â Notes on On-Update With Tables</h3></div></div></div><p>
				On-Update may not update primary key columns.
			</p><p>
				For correlated queries that correlate triggering events with rows held by a table, the engine utilizes either primary key columns or
				secondary explicitly-created indexes to enable high performance querying of rows, based on an analysis of the <code class="literal">where</code> clause.
			</p><p>
				The <code class="literal">iterator</code> of the <code class="literal">EPStatement</code> object representing the <code class="literal">on update</code> clause does not return any rows.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="named_delete"/>6.7.Â Deleting Data: The <code class="literal">On Delete</code> Clause</h2></div></div></div><a id="d0e16740" class="indexterm"/><a id="d0e16743" class="indexterm"/><a id="d0e16748" class="indexterm"/><p>
			An <code class="literal">on delete</code> clause removes rows from a named window or table. The clause can be used to remove all rows, or only rows that match certain criteria, or rows that correlate with an arriving event or a pattern of arriving events.
		</p><p>
			The syntax for the <code class="literal">on delete</code> clause is as follows: 
		</p><pre class="synopsis">on <span class="emphasis"><em>event_type</em></span>[<span class="emphasis"><em>(filter_criteria)</em></span>] [as <span class="emphasis"><em>stream_name</em></span>]
delete from <span class="emphasis"><em>window_or_table_name</em></span> [as <span class="emphasis"><em>stream_name</em></span>]
[where <span class="emphasis"><em>criteria_expression</em></span>]</pre><p>
			The <span class="emphasis"><em>event_type</em></span> is the name of the type of events that trigger removal from the table or named window. It is optionally followed by <span class="emphasis"><em>filter_criteria</em></span> which are filter expressions to apply to arriving events. The optional <code class="literal">as</code> keyword can be used to assign a name for use in the <code class="literal">where</code> clause. Patterns and named windows can also be specified in the <code class="literal">on</code> clause as described in the next section.
		</p><p>
			The <span class="emphasis"><em>window_or_table_name</em></span> is the name of the named window or table to delete rows from. 
			The <code class="literal">as</code> keyword is also available to assign a name to the table or named window.
		</p><p>
			The optional <code class="literal">where</code> clause contains a <span class="emphasis"><em>criteria_expression</em></span> that correlates the arriving (triggering) event to the rows to be removed. The <span class="emphasis"><em>criteria_expression</em></span> may also simply filter for rows without correlating.
		</p><p>
			On-delete can be used against tables and named windows. The examples herein use the <code class="literal">OrdersNamedWindow</code> named window and the <code class="literal">SecuritySummaryTable</code> table to provide examples for each.
		</p><p>				
			In the simplest form, this statement deletes all rows from the <code class="literal">SecuritySummaryTable</code> table when any <code class="literal">ClearEvent</code> arrives:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on ClearEvent delete from SecuritySummaryTable</pre><p>				
			The next example shows a more complete use of the syntax, and correlates the triggering event with events held by the <code class="literal">OrdersNamedWindow</code> named window:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on NewOrderEvent(volume&gt;0) as myNewOrders
delete from OrdersNamedWindow as myNamedWindow 
where myNamedWindow.symbol = myNewOrders.symbol</pre><p>				
			In the above sample statement, only if a <code class="literal">NewOrderEvent</code> event with a volume greater then zero arrives does the statement trigger. Upon triggering, all rows in the named window that have the same value for the symbol property as the triggering <code class="literal">NewOrderEvent</code> event are removed. The statement also showcases the <code class="literal">as</code> keyword to assign a name for use in the <code class="literal">where</code> expression.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="named_delete_pattern"/>6.7.1.Â Using Patterns in the <code class="literal">On-Delete</code> Clause</h3></div></div></div><p>
				By means of patterns the <code class="literal">on delete</code> clause and <code class="literal">on select</code> clause (described below) can look for more complex conditions to occur, possibly involving multiple events or the passing of time. The syntax for <code class="literal">on delete</code> with a pattern expression is show next:
			</p><pre class="synopsis">on pattern [<span class="emphasis"><em>pattern_expression</em></span>] [as <span class="emphasis"><em>stream_name</em></span>]
delete from <span class="emphasis"><em>window_or_table_name</em></span> [as <span class="emphasis"><em>stream_name</em></span>]
[where <span class="emphasis"><em>criteria_expression</em></span>]</pre><p>
				The <span class="emphasis"><em>pattern_expression</em></span> is any pattern that matches zero or more arriving events. Tags can be used to name events in the pattern and can occur in the optional <code class="literal">where</code> clause to correlate to events to be removed from a named window.
			</p><p>
				In the next example the triggering pattern fires every 10 seconds. The effect is that every 10 seconds the statement removes all rows from the <code class="literal">SecuritySummaryTable</code> table:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on pattern [every timer:interval(10 sec)] delete from SecuritySummaryTable</pre><p>
				The following example shows the use of tags in a pattern and executes against the <code class="literal">OrdersNamedWindow</code> named window instead: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on pattern [every ord=OrderEvent(volume&gt;0) or every flush=FlushOrderEvent] 
delete from OrdersNamedWindow as win
where ord.id = win.id or flush.id = win.id</pre><p>
				The pattern above looks for OrderEvent events with a volume value greater then zero and tags such events as 'ord'. 
				The pattern also looks for FlushOrderEvent events and tags such events as 'flush'. The <code class="literal">where</code> clause deletes from the <code class="literal">OrdersNamedWindow</code> named window any rows that match in the value of the 'id' property either of the arriving events.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="named_delete_namedwin"/>6.7.2.Â Notes on On-Delete With Named Windows</h3></div></div></div><p>
				Statements that reference the named window receive the deleted event as part of the remove stream. 
			</p><p>				
				For correlated queries (as above) that correlate triggering events with rows held by a named window, Esper internally creates efficient indexes to enable high performance deletion of rows.
			</p><p>
				The <code class="literal">iterator</code> of the <code class="literal">EPStatement</code> object representing the <code class="literal">on update</code> clause can also be helpful: It returns the last batch of deleted rows in response to the last triggering event, in any order, or null if the last triggering event did not update any rows.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="named_delete_table"/>6.7.3.Â Notes on On-Update With Tables</h3></div></div></div><p>
				For correlated queries that correlate triggering events with rows held by a table, the engine utilizes either primary key columns or
				secondary explicitly-created indexes to enable high performance querying of rows, based on an analysis of the <code class="literal">where</code> clause.
			</p><p>
				The <code class="literal">iterator</code> of the <code class="literal">EPStatement</code> object representing the <code class="literal">on delete</code> clause does not return any rows.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="named_upsert"/>6.8.Â Triggered Upsert Using the <code class="literal">On-Merge</code> Clause</h2></div></div></div><a id="d0e16967" class="indexterm"/><a id="d0e16970" class="indexterm"/><a id="d0e16973" class="indexterm"/><a id="d0e16978" class="indexterm"/><a id="d0e16983" class="indexterm"/><a id="d0e16988" class="indexterm"/><p>
			The <code class="literal">on merge</code> clause is similar to the SQL <code class="literal">merge</code> clause. It provides what is known as an "Upsert" operation: Update existing rows or if no existing row(s) are found then insert a new row, all in an atomic operation provided by a single EPL statement.
		</p><p>
			The syntax for the <code class="literal">on merge</code> clause has two forms. 
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="named_upsert_insertunmatched"/>6.8.1.Â <code class="literal">On-Merge</code> Insert</h3></div></div></div><p>
				Use <code class="literal">on merge</code> with <code class="literal">insert</code> to inserts one row. This syntax is:
			</p><pre class="synopsis">on <span class="emphasis"><em>event_type</em></span>[<span class="emphasis"><em>(filter_criteria)</em></span>] [as <span class="emphasis"><em>stream_name</em></span>]
merge [into] <span class="emphasis"><em>window_or_table_name</em></span> [as <span class="emphasis"><em>stream_name</em></span>]
insert [ (<span class="emphasis"><em>property_name</em></span> [, property_name] [,...]) ] select <span class="emphasis"><em>select_expression</em></span> [, <span class="emphasis"><em>select_expression</em></span>[,...]]</pre><p>
				The <span class="emphasis"><em>event_type</em></span> is the name of the type of events that trigger the merge. It is optionally followed by <span class="emphasis"><em>filter_criteria</em></span> which are filter expressions to apply to arriving events. The optional <code class="literal">as</code> keyword can be used to assign a name for use in the <code class="literal">where</code> clause. Patterns and named windows can also be specified in the <code class="literal">on</code> clause as described in prior sections.
			</p><p>
				The <span class="emphasis"><em>window_or_table_name</em></span> is the name of the named window to insert a row into. 
				The <code class="literal">as</code> keyword is also available to assign a name to the named window or table.
			</p><p>
				It follows the <code class="literal">insert</code> keyword and optionally the <code class="literal">into</code> keyword. Optionally you can provide a list of property names in parenthesis.
			</p><p>
				It follows the required <code class="literal">select</code> keyword and one or more select-clause expressions. The wildcard (<code class="literal">*</code>) is available in the select-clause as well. 
			</p><p>
				On-merge can be used with tables and named windows. This examples uses the <code class="literal">SecuritySummaryTable</code> table that was defined earlier.
			</p><p>
				This example statement inserts a row into the <code class="literal">SecuritySummaryTable</code> table when a <code class="literal">SecuritySummary</code> arrives:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on SecuritySummary merge SecuritySummaryTable insert select ipAddress, userId</pre><p>
				The following EPL is equivalent to the query above and uses the upsert syntax instead, described next.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on SecuritySummary merge SecuritySummaryTable where 1=2 when not matched then insert select ipAddress, userId</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="named_upsert_upsert"/>6.8.2.Â <code class="literal">On-Merge</code> Update, Delete, Select (Upsert)</h3></div></div></div><p>
				The syntax for <code class="literal">on merge</code> for update-insert (upsert) is as follows: 
			</p><pre class="synopsis">on <span class="emphasis"><em>event_type</em></span>[<span class="emphasis"><em>(filter_criteria)</em></span>] [as <span class="emphasis"><em>stream_name</em></span>]
merge [into] <span class="emphasis"><em>window_or_table_name</em></span> [as <span class="emphasis"><em>stream_name</em></span>]
[where <span class="emphasis"><em>criteria_expression</em></span>]
  when [not] matched [and <span class="emphasis"><em>search_condition</em></span>]
    then [
      insert [into <span class="emphasis"><em>streamname</em></span>]
          [ (<span class="emphasis"><em>property_name</em></span> [, property_name] [,...]) ] 
          select <span class="emphasis"><em>select_expression</em></span> [, <span class="emphasis"><em>select_expression</em></span>[,...]]
          [where <span class="emphasis"><em>filter_expression</em></span>]
      |
      update set <span class="emphasis"><em>mutation_expression</em></span> [, <span class="emphasis"><em>mutation_expression</em></span> [,...]]
          [where <span class="emphasis"><em>filter_expression</em></span>]
      |
      delete
          [where <span class="emphasis"><em>filter_expression</em></span>]
    ]
    [then [insert|update|delete]] [,then ...]
  [when ...  then ... [...]] </pre><p>
				The <span class="emphasis"><em>event_type</em></span> is the name of the type of events that trigger the merge. It is optionally followed by <span class="emphasis"><em>filter_criteria</em></span> which are filter expressions to apply to arriving events. The optional <code class="literal">as</code> keyword can be used to assign a name for use in the <code class="literal">where</code> clause. Patterns and named windows can also be specified in the <code class="literal">on</code> clause as described in prior sections.
			</p><p>
				The <span class="emphasis"><em>window_or_table_name</em></span> is the name of the named window or table to insert, update or delete rows. 
				The <code class="literal">as</code> keyword is also available to assign a name to the named window or table.
			</p><p>
				The optional <code class="literal">where</code> clause contains a <span class="emphasis"><em>criteria_expression</em></span> that correlates the arriving (triggering) event to the rows to be considered of the table or named window.
				We recommend specifying a criteria expression that is as specific as possible.
			</p><p>
				Following the <code class="literal">where</code> clause is one or more <code class="literal">when matched</code> or <code class="literal">when not matched</code> clauses in any order. Each may have an additional search condition associated.
			</p><p>
				After each <code class="literal">when [not] matched</code> follow one or more <code class="literal">then</code> clauses that each contains the action to take: Either an <code class="literal">insert</code>, <code class="literal">update</code> or <code class="literal">delete</code> keyword. 
			</p><p>
				After <code class="literal">when not matched</code> only <code class="literal">insert</code> action(s) are available. After <code class="literal">when matched</code> any <code class="literal">insert</code>, <code class="literal">update</code> and <code class="literal">delete</code> action(s) are available.
			</p><p>
				After <code class="literal">insert</code> follows, optionally, the <code class="literal">into</code> keyword followed by the stream name or named window to insert-into. If no <code class="literal">into</code> and stream name is specified, the insert applies to the current table or named window. It follows an optional list of columns inserted. It follows the required <code class="literal">select</code> keyword and one or more select-clause expressions. The wildcard (<code class="literal">*</code>) is available in the select-clause as well. It follows an optional where-clause that may return Boolean false to indicate that the action should not be applied. 
			</p><p>
				 After <code class="literal">update</code> follows the <code class="literal">set</code> keyword and one or more mutation expressions. For mutation expressions please see <a class="xref" href="#named_update" title="6.6.Â Updating Data: The On Update Clause">SectionÂ 6.6, âUpdating Data: The On Update Clauseâ</a>.
				 It follows an optional where-clause that may return Boolean false to indicate that the action should not be applied. 			     
			</p><p>
				 After <code class="literal">delete</code> follows an optional where-clause that may return Boolean false to indicate that the action should not be applied. 
			</p><p>
			  When according to the where-clause <span class="emphasis"><em>criteria_expression</em></span> the engine finds no rows in the named window or table that match the condition, the engine evaluates each <span class="emphasis"><em>when not matched</em></span> clause. If the optional search condition returns true or no search condition was provided then the engine performs all of the actions listed after each <code class="literal">then</code>.
			</p><p>
			  When according to the where-clause <span class="emphasis"><em>criteria_expression</em></span> the engine finds one or more rows in the named window or table that match the condition, the engine evaluates each <span class="emphasis"><em>when matched</em></span> clause. If the optional search condition returns true or no search condition was provided the engine performs all of the actions listed after each <code class="literal">then</code>.
			</p><p>
				The engine executes <code class="literal">when matched</code> and <code class="literal">when not matched</code> in the order specified. If the optional search condition returns true or no search condition was specified then the engine takes the associated action (or multiple actions for multiple <code class="literal">then</code> keywords). When the block of actions completed the engine proceeds to the next matching row, if any. After completing all matching rows the engine continues to the next triggering event if any.
			</p><p>
				On-merge can be used with tables and named windows. The examples herein declare a <code class="literal">ProductWindow</code> named window and also use the <code class="literal">SecuritySummaryTable</code> table to provide examples for each.
			</p><p>
				This example statement updates the <code class="literal">SecuritySummaryTable</code> table when a <code class="literal">ResetEvent</code> arrives setting the <code class="literal">active</code> column's value to false:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on ResetEvent merge SecuritySummaryTable
when matched and active = true then update set active = false</pre><p>
				A longer example utilizing a named window follows. You start by declaring a schema that provides a product id and that holds a total price:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema ProductTotalRec as (productId string, totalPrice double)</pre><p>
				We create a named window that holds a row for each unique product:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window ProductWindow#unique(productId) as ProductTotalRec</pre><p>
				The events for this example are order events that hold an order id, product id, price, quantity and deleted-flag declared by the next schema:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema OrderEvent as (orderId string, productId string, price double, 
    quantity int, deletedFlag boolean)</pre><p>				
				The following EPL statement utilizes <code class="literal">on-merge</code> to total up the price for each product based on arriving order events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on OrderEvent oe
  merge ProductWindow pw
  where pw.productId = oe.productId
  when matched
    then update set totalPrice = totalPrice + oe.price
  when not matched 
    then insert select productId, price as totalPrice</pre><p>
				In the above example, when an order event arrives, the engine looks up in the product named window the matching row or rows for the same product id as the arriving event. In this example the engine always finds no row or one row as the product named window is declared with a unique data window based on product id. 
				If the engine finds a row in the named window, it performs the update action adding up the price as defined under <code class="literal">when matched</code>. If the engine does not find a row in the named window it performs the insert action as defined under <code class="literal">when not matched</code>, inserting a new row.
			</p><p>
				The <code class="literal">insert</code> keyword may be followed by a list of columns as shown in this EPL snippet:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// equivalent to the insert shown in the last 2 lines in above EPL
...when not matched 
    then insert(productId, totalPrice) select productId, price</pre><p>
				The second example demonstrates the use of a select-clause with wildcard, a search condition and the <code class="literal">delete</code> keyword. It creates a named window that holds order events and employs on-merge to insert order events for which no corresponding order id was found, update quantity to the quantity provided by the last arriving event and delete order events that are marked as deleted:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window OrderWindow#keepall as OrderEvent</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on OrderEvent oe
  merge OrderWindow pw
  where pw.orderId = oe.orderId
  when not matched 
    then insert select *
  when matched and oe.deletedFlag=true
    then delete
  when matched
    then update set pw.quantity = oe.quantity, pw.price = oe.price</pre><p>
				In the above example the <code class="literal">oe.deletedFlag=true</code> search condition instructs the engine to take the delete action only if the deleted-flag is set.
			</p><p>
				You may specify multiple actions by providing multiple <code class="literal">then</code> keywords each followed by an action. Each of the <code class="literal">insert</code>, <code class="literal">update</code> and <code class="literal">delete</code> actions can itself have a where-clause as well.
				If a where-clause exists for an action, the engine evaluates the where-clause and applies the action only if the where-clause returns Boolean true.
			</p><p>
				This example specifies two update actions and uses the where-clause to trigger different update behavior depending on whether the order event price is less than zero.
				This example assumes that the host application defined a <code class="literal">clearorder</code> user-defined function, to demonstrate calling a user-defined function as part of the update mutation expressions: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on OrderEvent oe
  merge OrderWindow pw
  where pw.orderId = oe.orderId
  when matched
    then update set clearorder(pw) where oe.price &lt; 0
    then update set pw.quantity = oe.quantity, pw.price = oe.price where oe.price &gt;= 0</pre><p>
				To insert events into another stream and not the named window, use <code class="literal">insert</code> <code class="literal">into</code> <span class="emphasis"><em>streamname</em></span>.
			</p><p>
				In the next example each matched-clause contains two actions, one action to insert a log event and a second action to insert, delete or update:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on OrderEvent oe
  merge OrderWindow pw
  where pw.orderId = oe.orderId
  when not matched 
    then insert into LogEvent select 'this is an insert' as name
    then insert select *
  when matched and oe.deletedFlag=true
    then insert into LogEvent select 'this is a delete' as name
    then delete
  when matched
    then insert into LogEvent select 'this is a update' as name
    then update set pw.quantity = oe.quantity, pw.price = oe.price</pre><p>
				While the engine evaluates and executes all actions listed under the same matched-clause in order, you may not rely on updated field values of an earlier action to trigger the where-clause of a later action. Similarly you should avoid simultaneous update and delete actions for the same match: the engine does not guarantee whether the update or the delete take final affect.
			</p><p>
				Your application can subscribe a listener to <code class="literal">on merge</code> statements to determine inserted, updated and removed events. Statements post any events that are inserted to, updated or deleted from a named window to all listeners attached to the statement as new data and removed data. 
			</p><p>
			  The following limitations apply to on-merge statements:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						Aggregation functions and the <code class="literal">prev</code> and <code class="literal">prior</code> operators are not available in conditions and the <code class="literal">select</code>-clause.
					</p></li></ol></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="named_merge_namedwin"/>6.8.3.Â Notes on On-Merge With Named Windows</h3></div></div></div><p>
				Statements that reference the named window receive an insert and remove stream represening the insertions, changes and deletions to named window rows.
			</p><p>				
			For correlated queries (as above) that correlate triggering events with rows held by a named window, Esper internally creates efficient indexes to enable high performance update and removal of events especially from named windows that hold large numbers of events.
			</p><p>
				Upon iteration, the statement provides the last inserted events, if any.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="named_merge_table"/>6.8.4.Â Notes on On-Merge With Tables</h3></div></div></div><p>
				On-Merge may not update primary key columns.
			</p><p>
				For correlated queries that correlate triggering events with rows held by a table, the engine utilizes either primary key columns or
				secondary explicitly-created indexes to enable high performance querying of rows, based on an analysis of the <code class="literal">where</code> clause.
			</p><p>
				The <code class="literal">iterator</code> of the <code class="literal">EPStatement</code> object representing the <code class="literal">on merge</code> clause does not return any rows.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="named_explicit_index"/>6.9.Â Explicitly Indexing Named Windows and Tables</h2></div></div></div><a id="d0e17471" class="indexterm"/><a id="d0e17476" class="indexterm"/><a id="d0e17481" class="indexterm"/><a id="d0e17486" class="indexterm"/><a id="d0e17491" class="indexterm"/><p>
			You may explicitly create an index on a table or a named window. 
			The engine considers explicitly-created as well as implicitly-allocated indexes (named windows only) in query planning and execution of the following
			types of usages of tables and named windows:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>On-demand (fire-and-forget, non-continuous) queries as described in <a class="xref" href="#api-ondemand" title="14.5.Â On-Demand Fire-and-Forget Query Execution">SectionÂ 14.5, âOn-Demand Fire-and-Forget Query Executionâ</a>.</p></li><li><p>
				  <code class="literal">On-select</code>, <code class="literal">on-merge</code>, <code class="literal">on-update</code>, <code class="literal">on-delete</code> and <code class="literal">on-insert</code>.
			  </p></li><li><p>
				  Subqueries against tables and named windows.
			  </p></li><li><p>
				  For joins (including outer joins) with named windows the engine considers the filter criteria listed in parenthesis using the syntax </p><pre class="synopsis"><span class="emphasis"><em>name_window_name</em></span>(<span class="emphasis"><em>filter_criteria</em></span>)</pre><p> for index access.
			  </p></li><li><p>
				  For joins with tables the engine considers the primary key columns (if any) as well as any table indexes.
			  </p></li></ol></div><p>
			The syntax to create an explicit index on a named window or table is:
		</p><pre class="synopsis">create [unique] index <span class="emphasis"><em>index_name</em></span> on <span class="emphasis"><em>window_or_table_name</em></span> (
  <span class="emphasis"><em>column_expression</em></span> [hash|btree|<span class="emphasis"><em>index_type_expression</em></span>] 
  [, <span class="emphasis"><em>column_expression</em></span>] [hash|btree|<span class="emphasis"><em>index_type_expression</em></span>] 
  [,...]
)</pre><p>
			The optional <span class="emphasis"><em>unique</em></span> keyboard indicates that the column expressions uniquely identify rows. If <span class="emphasis"><em>unique</em></span> is not specified
			the index allows duplicate rows.
		</p><p>
			The <span class="emphasis"><em>index_name</em></span> is the name assigned to the index. The name uniquely identifies the index and is used in engine query plan logging.
		</p><p>
			The <span class="emphasis"><em>window_or_table_name</em></span> is the name of an existing table or named window. If the named window or table has rows already, the engine builds an index for the rows.
		</p><p>
			After the table name or named window name follows a list of pairs of <span class="emphasis"><em>column_expression</em></span> column expression and index type.
		</p><p>
			A column expression is the expression that is subject to index building. 
			Typically a column expression is an event property or column name. 
			For special application-provided or spatial indexes other column expressions are allowed and such indexes may allow multiple columns to be combined.
		</p><p>
			Following each column expression you may specify the index type by providing the optional <code class="literal">hash</code> or <code class="literal">btree</code> keywords or an <span class="emphasis"><em>index_type_expression</em></span>. 
			For special application-provided or spatial indexes please use the <span class="emphasis"><em>index_type_expression</em></span>.
		</p><p>
			If you specify no keyword or the <code class="literal">hash</code> keyword for a property, the index will be a hash-based (unsorted) index in respect to that property. If you specify the <code class="literal">btree</code> keyword, the index will be a binary-tree-based sorted index in respect to that property.
			You may combine <code class="literal">hash</code> and <code class="literal">btree</code> properties for the same index.
			Specify <code class="literal">btree</code> for a property if you expect to perform numerical or string comparison using relational operators (&lt;, &gt;, &gt;=, &lt;=), the <code class="literal">between</code> or the <code class="literal">in</code> keyword for ranges and inverted ranges. Use <code class="literal">hash</code> (the default) instead of <code class="literal">btree</code> if you expect to perform exact comparison using <code class="literal">=</code>.
		</p><p>
			For <code class="literal">hash</code> and <code class="literal">btree</code> index types the column expression must be an event property or column name. Expressions such as <code class="literal">col+1</code> are not currently supported for 
			<code class="literal">hash</code> and <code class="literal">btree</code> index types but are supported for other index types.
		</p><p>
			The <code class="literal">create table</code> syntax is the same for tables and named windows. The examples herein create a new <code class="literal">UserProfileWindow</code> named window and also use the <code class="literal">SecuritySummaryTable</code> table.
		</p><p>
			This sample EPL creates an non-unique index on the <code class="literal">active</code> column of table <code class="literal">SecuritySummaryTable</code>:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create index MyIndex on SecuritySummaryTable(active)</pre><p>
			We list a few example EPL statements next that create a named window and create a single index:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// create a named window
create window UserProfileWindow#time(1 hour) select * from UserProfile</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// create a non-unique index (duplicates allowed) for the user id property only
create index UserProfileIndex on UserProfileWindow(userId)</pre><p>
			Next, execute an on-demand fire-and-forget query as shown below; this sample uses the prepared version to demonstrate:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String query = "select * from UserProfileWindow where userId='Joe'";
EPOnDemandPreparedQuery prepared = epRuntime.prepareQuery(query);
// query performance excellent in the face of large number of rows
EPOnDemandQueryResult result = prepared.execute();
// ...later ...
prepared.execute();	// execute a second time</pre><p>
		  A unique index is generally preferable over non-unique indexes. For named windows, if your data window declares a unique data window (<code class="literal">#unique</code>, <code class="literal">#firstunique</code>, including intersections and grouped unique data windows) it is not necessary to create a unique index unless index sharing is enabled, since the engine considers the unique data window declaration in query planning. 
		</p><p>
		  The engine enforces uniqueness (e.g. unique constraint) for unique indexes. If your application inserts a duplicate row the engine raises a runtime exception when processing the statement and discards the row. The default error handler logs such an exception and continues.
		</p><p>
			For example, if the user id together with the profile id uniquely identifies an entry into the named window, your application can create a unique index as shown below:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// create a unique index on user id and profile id
create unique index UserProfileIndex on UserProfileWindow(userId, profileId)</pre><p>
			By default, the engine builds a hash code -based index useful for direct comparison via equals (=). Filter expressions that look for ranges or use <code class="literal">in, between </code> do not benefit from the hash-based index and should use the <code class="literal">btree</code> keyword. For direct comparison via equals (=) then engine does not use <code class="literal">btree</code> indexes.
		</p><p>
			The next example creates a composite index over two fields <code class="literal">symbol</code> and <code class="literal">buyPrice</code>:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// create a named window
create window TickEventWindow#time(1 hour) as (symbol string, buyPrice double)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// create a non-unique index 
create index idx1 on TickEventWindow(symbol hash, buyPrice btree)</pre><p>
			A sample fire-and-forget query is shown below (this time the API calls are not shown):
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// query performance excellent in the face of large number of rows
select * from TickEventWindow where symbol='GE' and buyPrice between 10 and 20</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>A table that does not declare one or more primary key columns cannot have a secondary index, as the table holds a maximum of one row.</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="nwtable-faf"/>6.10.Â Using Fire-and-Forget Queries With Named Windows and Tables</h2></div></div></div><p>
			Fire-and-Forget queries can be run against both tables and named windows. We use the term <span class="emphasis"><em>property</em></span> and <span class="emphasis"><em>column</em></span> interchangeably.
		</p><p>
			For selecting from named windows and tables, please see the examples in <a class="xref" href="#api-ondemand" title="14.5.Â On-Demand Fire-and-Forget Query Execution">SectionÂ 14.5, âOn-Demand Fire-and-Forget Query Executionâ</a>.
		</p><p>
			For data manipulation (insert, update, delete) queries, the on-demand query API returns the inserted, updated or deleted rows when the query executes against a named window. 
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="named_insertfaf"/>6.10.1.Â Inserting Data</h3></div></div></div><a id="d0e17743" class="indexterm"/><a id="d0e17746" class="indexterm"/><a id="d0e17751" class="indexterm"/><a id="d0e17756" class="indexterm"/><p>
				Your application can insert rows into a table or named window using on-demand (fire-and-forget, non-continuous) queries as described in <a class="xref" href="#api-ondemand" title="14.5.Â On-Demand Fire-and-Forget Query Execution">SectionÂ 14.5, âOn-Demand Fire-and-Forget Query Executionâ</a>.
			</p><p>
				The engine allows the standard SQL syntax and <code class="literal">values</code> keyword and also supports using <code class="literal">select</code> to provide values.
			</p><p>
				The syntax using the <code class="literal">values</code> keyword is:
			</p><pre class="synopsis">insert into <span class="emphasis"><em>window_or_table_name</em></span> [(<span class="emphasis"><em>property_names</em></span>)]
values (<span class="emphasis"><em>value_expressions</em></span>)</pre><p>
				The syntax using <code class="literal">select</code> is as follows: 
			</p><pre class="synopsis">insert into <span class="emphasis"><em>window_or_table_name</em></span> [(<span class="emphasis"><em>property_names</em></span>)]
select <span class="emphasis"><em>value_expressions</em></span></pre><p>
				The <span class="emphasis"><em>window_or_table_name</em></span> is the name of the table or named window to insert rows into.
			</p><p>
				After the named window or table name you can optionally provide a comma-separated list of property names. 
			</p><p>
				When providing property names, the order of value expressions in the values list or select clause must match the order of property names specified. Column names provided in the select-clause, if specified, are ignored.
			</p><p>
				When not providing property names and when specifying the <code class="literal">values</code> keyword, the order of values must match the order of properties
				declared for the named window or table.
				When not providing property names and when specifying the select-clause, expressions must name the properties to be inserted into 
				by assigning a column name using the <code class="literal">as</code> keyword.
			</p><p>
				The example code snippet inserts a new order row into the <code class="literal">OrdersWindow</code> named window:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String query = 
  "insert into OrdersWindow(orderId, symbol, price) values ('001', 'GE', 100)";
epService.getEPRuntime().executeQuery(query);</pre><p>
				Instead of the <code class="literal">values</code> keyword you may specify a select-clause as this example shows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String query = 
  "insert into OrdersWindow(orderId, symbol, price) select '001', 'GE', 100";
epService.getEPRuntime().executeQuery(query);</pre><p>
				The following EPL inserts the same values as above but specifies property names as part of the select-clause expressions:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into OrdersWindow
select '001' as orderId, 'GE' as symbol, 100 as price</pre><p>
				The next EPL inserts the same values as above and does not specify property names thereby 
				populating the first 3 properties of the type of the named window:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into OrdersWindow values ('001', 'GE', 100)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="named_update_faf"/>6.10.2.Â Updating Data</h3></div></div></div><a id="d0e17848" class="indexterm"/><a id="d0e17851" class="indexterm"/><a id="d0e17856" class="indexterm"/><a id="d0e17861" class="indexterm"/><p>
				Your application can update table and named window rows using on-demand (fire-and-forget, non-continuous) queries as described in <a class="xref" href="#api-ondemand" title="14.5.Â On-Demand Fire-and-Forget Query Execution">SectionÂ 14.5, âOn-Demand Fire-and-Forget Query Executionâ</a>.
			</p><p>
				The syntax for the <code class="literal">update</code> clause is as follows: 
			</p><pre class="synopsis">update <span class="emphasis"><em>window_or_table_name</em></span> [as <span class="emphasis"><em>stream_name</em></span>]
set <span class="emphasis"><em>mutation_expression</em></span> [, <span class="emphasis"><em>mutation_expression</em></span> [,...]]
[where <span class="emphasis"><em>criteria_expression</em></span>]</pre><p>
				The <span class="emphasis"><em>window_or_table_name</em></span> is the name of the table or named window to remove rows from. 
				The <code class="literal">as</code> keyword is also available to assign a name to the table or named window.
			</p><p>
				After the <code class="literal">set</code> keyword follows a comma-separated list of mutation expressions. For fire-and-forget queries the following restriction applies: Subqueries, aggregation functions and the <code class="literal">prev</code> or <code class="literal">prior</code> function may not be used in expressions. Mutation expressions are detailed in <a class="xref" href="#named_update" title="6.6.Â Updating Data: The On Update Clause">SectionÂ 6.6, âUpdating Data: The On Update Clauseâ</a>.
			</p><p>
				The optional <code class="literal">where</code> clause contains a <span class="emphasis"><em>criteria_expression</em></span> that identifies rows to be updated.
			</p><p>				
				The example code snippet updates those rows of the named window that have a negative value for volume:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String query = "update OrdersNamedWindow set volume = 0 where volumne = 0";
epService.getEPRuntime().executeQuery(query);</pre><p>
			  To instruct the engine to use the initial property value before update, prefix the property name with the literal <code class="literal">initial</code>. 
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="named_delete_faf"/>6.10.3.Â Deleting Data</h3></div></div></div><a id="d0e17935" class="indexterm"/><a id="d0e17938" class="indexterm"/><a id="d0e17943" class="indexterm"/><a id="d0e17948" class="indexterm"/><p>
				Your application can delete rows from a named window or table using on-demand (fire-and-forget, non-continuous) queries as described in <a class="xref" href="#api-ondemand" title="14.5.Â On-Demand Fire-and-Forget Query Execution">SectionÂ 14.5, âOn-Demand Fire-and-Forget Query Executionâ</a>.
			</p><p>
				The syntax for the <code class="literal">delete</code> clause is as follows: 
			</p><pre class="synopsis">delete from <span class="emphasis"><em>window_or_table_name</em></span> [as <span class="emphasis"><em>stream_name</em></span>]
	[where <span class="emphasis"><em>criteria_expression</em></span>]</pre><p>
				The <span class="emphasis"><em>window_or_table_name</em></span> is the name of the named window or table to delete rows from. 
				The <code class="literal">as</code> keyword is also available to assign a name to the named window or table.
			</p><p>
				The optional <code class="literal">where</code> clause contains a <span class="emphasis"><em>criteria_expression</em></span> that identifies rows to be removed from the named window or table.
			</p><p>				
				The example code snippet deletes from a named window all rows that have a negative value for volume:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String query = "delete from OrdersNamedWindow where volume &lt;= 0";
epService.getEPRuntime().executeQuery(query);</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="named_versioning"/>6.11.Â Versioning and Revision Event Type Use With Named Windows</h2></div></div></div><a id="d0e17998" class="indexterm"/><p>
			As outlined in <a class="xref" href="#eventrep-update" title="3.8.Â Updating, Merging and Versioning Events">SectionÂ 3.8, âUpdating, Merging and Versioning Eventsâ</a>, revision event types process updates or new versions of events held by a named window.
		</p><p>
			A revision event type is simply one or more existing pre-configured event types whose events are related, as configured by static configuration, by event properties that provide same key values. The purpose of key values is to 
			indicate that arriving events are related: An event amends, updates or adds properties to an earlier event that shares the same key values. No additional EPL is needed when using revision event types for merging event data.
		</p><p>
			Revision event types can be useful in these situations:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					Some of your events carry only partial information that is related to a prior event and must be merged together.
				</p></li><li><p>
					Events arrive that add additional properties or change existing properties of prior events.
				</p></li><li><p>
					Events may carry properties that have null values or properties that do no exist (for example events backed by Map or XML), and for such properties the earlier value must be used instead.
				</p></li></ol></div><p>
			To better illustrate, consider a revision event type that represents events for creation and updates to user profiles. Let's assume the user profile creation events carry the user id and a full profile. The profile update events indicate only the user id and the individual properties that actually changed. The user id property shall serve as a key value relating profile creation events and update events.
		</p><p>
			A revision event type must be configured to instruct the engine which event types participate and what their key properties are. Configuration is described in <a class="xref" href="#config-revisionevent" title="15.4.30.Â Revision Event Type">SectionÂ 15.4.30, âRevision Event Typeâ</a> and is not shown here.
		</p><p>				
			Assume that an event type <code class="literal">UserProfileRevisions</code> has been configured to hold profile events, i.e. creation and update events related by user id. This statement creates a named window to hold the last 1 hour of current profiles per user id:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window UserProfileWindow#time(1 hour) select * from UserProfileRevisions</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into UserProfileWindow select * from UserProfileCreation</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into UserProfileWindow select * from UserProfileUpdate</pre><p>				
			In revision event types, the term <span class="emphasis"><em>base</em></span> event is used to describe events that are subject to update. Events that update, amend or add additional properties to base events are termed <span class="emphasis"><em>delta</em></span> events. 
			In the example, base events are profile creation events and delta events are profile update events. 
		</p><p>				
			Base events are expected to arrive before delta events. In the case where a delta event arrives and is not related by key value to a base event or a revision of the base event currently held by the named window the engine ignores the delta event. Thus, considering the example, profile update events for a user id that does not have an existing profile in the named window are not applied.
		</p><p>
			When a base or delta event arrives, the insert and remove stream output by the named window are the current and the prior version of the event. Let's come back to the example. As creation events arrive that are followed by update events or more creation events for the same user id, the engine posts the current version of the profile as insert stream (new data) and the prior version of the profile as remove stream (old data).
		</p><p>				
			Base events are also implicitly delta events. That is, if multiple base events of the same key property values arrive, then each base event provides a new version. In the example, if multiple profile creation events arrive for the same user id then new versions of the current profile for that user id are output by the engine for each base event, as it does for delta events.
		</p><p>				
			The expiry policy as specified by data window definitions applies to each distinct key value, or multiple distinct key values for composite keys. An expiry policy re-evaluates when new versions arrive. In the example, user profile events expire from the time window when no creation or update event for a given user id has been received for 1 hour.
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>
				It usually does not make sense to configure a revision event type without delta event types. Use the unique data window (<code class="literal">#unique</code>) or unique data window in intersection with other data windows
				instead (i.e. <code class="literal">#unique(field)#time(1 hour)</code>).
			</p></div><p>				
			Several strategies are available for merging or overlaying events as the configuration chapter describes in greater detail.
		</p><p>				
			Any of the Map, XML and JavaBean event representations as well as plug-in event representations may participate in a revision event type. For example, profile creation events could be JavaBean events, while profile update events could be <code class="literal">java.util.Map</code> events.
		</p><p>				
			Delta events may also add properties to the revision event type. For example, you could add a new event type with security information to the revision event type and such security-related properties become available on the resulting revision event type.
		</p><p>
			The following restrictions apply to revision event types:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					Nested properties are only supported for the JavaBean event representation. Nested properties are not individually versioned; they are instead versioned by the containing property.
				</p></li><li><p>
					Dynamic, indexed and mapped properties are only supported for nested properties and not as properties of the revision event type itself.
				</p></li></ul></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="named-eventasproperty"/>6.12.Â Events as Property</h2></div></div></div><p>
			Columns in a named window and table may also hold an event or multiple events. More information on the <code class="literal">insert into</code> clause providing event columns is in <a class="xref" href="#insert-into-eventasproperty" title="5.10.5.Â Event as a Property">SectionÂ 5.10.5, âEvent as a Propertyâ</a>.
		</p><p>
			A sample declaration for a named window and a table is:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema InnerData (value string)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table ContainerTable (innerdata InnerData)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window ContainerWindow#time(30) as (innerdataArray InnerData[]) // array of events</pre><p>
			The second sample creates a named window that specifies two columns: A column that holds an OrderEvent, and a column by name <code class="literal">priceTotal</code>. A matching <code class="literal">insert into</code> statement is also part of the sample:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window OrdersWindow#time(30) as select this, price as priceTotal from OrderEvent</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into OrdersWindow select order, price * unit as priceTotal  
from ServiceOrderEvent as order</pre><p>
			Note that the <code class="literal">this</code> proprerty must exist on the event and must return the event class itself (JavaBean events only). The property type of the additional <code class="literal">priceTotal</code> column is the property type of the existing <code class="literal">price</code> property.
		</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="event_patterns"/>ChapterÂ 7.Â EPL Reference: Patterns</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#event-pattern-intro">7.1. Event Pattern Overview</a></span></dt><dt><span class="sect1"><a href="#pattern-how-to-use">7.2. How to Use Patterns</a></span></dt><dd><dl><dt><span class="sect2"><a href="#pattern-howto-syntax">7.2.1. Pattern Syntax</a></span></dt><dt><span class="sect2"><a href="#pattern-in-eql">7.2.2. Patterns in EPL</a></span></dt><dt><span class="sect2"><a href="#patterns-howto-subscribe">7.2.3. Subscribing to Pattern Events</a></span></dt><dt><span class="sect2"><a href="#pattern-howto-pull-data">7.2.4. Pulling Data From Patterns</a></span></dt><dt><span class="sect2"><a href="#pattern-errorreporting">7.2.5. Pattern Error Reporting</a></span></dt><dt><span class="sect2"><a href="#patterns-howto-suppress">7.2.6. Suppressing Same-Event Matches</a></span></dt><dt><span class="sect2"><a href="#patterns-howto-discard">7.2.7. Discarding Partially Completed Patterns</a></span></dt></dl></dd><dt><span class="sect1"><a href="#pattern-op-precedence">7.3. Operator Precedence</a></span></dt><dt><span class="sect1"><a href="#pattern-filter">7.4. Filter Expressions in Patterns</a></span></dt><dd><dl><dt><span class="sect2"><a href="#pattern-filter-performance">7.4.1. Filter Expressions and Filter Indexes</a></span></dt><dt><span class="sect2"><a href="#pattern-filter-consumption">7.4.2. Controlling Event Consumption</a></span></dt><dt><span class="sect2"><a href="#pattern-filter-namedwindow">7.4.3. Use With Named Windows and Tables</a></span></dt></dl></dd><dt><span class="sect1"><a href="#pattern-operators">7.5. Pattern Operators</a></span></dt><dd><dl><dt><span class="sect2"><a href="#pattern-logical-every">7.5.1. Every</a></span></dt><dt><span class="sect2"><a href="#pattern-logical-everydistinct">7.5.2. Every-Distinct</a></span></dt><dt><span class="sect2"><a href="#pattern-repeat">7.5.3. Repeat</a></span></dt><dt><span class="sect2"><a href="#pattern-repeatuntil">7.5.4. Repeat-Until</a></span></dt><dt><span class="sect2"><a href="#pattern-logical-and">7.5.5. And</a></span></dt><dt><span class="sect2"><a href="#pattern-logical-or">7.5.6. Or</a></span></dt><dt><span class="sect2"><a href="#pattern-logical-not">7.5.7. Not</a></span></dt><dt><span class="sect2"><a href="#pattern-temporal-followed-by">7.5.8. Followed-By</a></span></dt><dt><span class="sect2"><a href="#pattern-guards">7.5.9. Pattern Guards</a></span></dt></dl></dd><dt><span class="sect1"><a href="#pattern-atoms">7.6. Pattern Atoms</a></span></dt><dd><dl><dt><span class="sect2"><a href="#pattern-atom-filter">7.6.1. Filter Atoms</a></span></dt><dt><span class="sect2"><a href="#pattern-atom-time">7.6.2. Observer Atoms Overview</a></span></dt><dt><span class="sect2"><a href="#pattern-timer-interval">7.6.3. Interval (timer:interval)</a></span></dt><dt><span class="sect2"><a href="#pattern-timer-at">7.6.4. Crontab (timer:at)</a></span></dt><dt><span class="sect2"><a href="#pattern-timer-schedule">7.6.5. Schedule (timer:schedule)</a></span></dt></dl></dd><dt><span class="sect1"><a href="#pattern-walkthrough">7.7. Event Pattern Walkthrough</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="event-pattern-intro"/>7.1.Â Event Pattern Overview</h2></div></div></div><a id="d0e18128" class="indexterm"/><p>
			Event patterns match when an event or multiple events occur that match the pattern's definition. Patterns can also be time-based.
         </p><p>
			Pattern expressions consist of pattern atoms and pattern operators:
         </p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					Pattern <span class="emphasis"><em>atoms</em></span> are the basic building blocks of patterns. Atoms are filter expressions, observers for time-based events and plug-in custom observers that observe external events not under the control of the engine.
                </p></li><li><p>
					Pattern <span class="emphasis"><em>operators</em></span> control expression lifecycle and combine atoms logically or temporally.  
                </p></li></ol></div><p>
			The below table outlines the different pattern atoms available:
		</p><div class="table"><a id="d0e18152"/><p class="title"><b>TableÂ 7.1.Â Pattern Atoms</b></p><div class="table-contents"><table summary="Pattern Atoms" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Pattern Atom</th><th>Example</th></tr></thead><tbody><tr><td>Filter expressions specify an event to look for.</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">StockTick(symbol='ABC', price &gt; 100)</pre></td></tr><tr><td>Time-based event observers specify time intervals or time schedules.</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">timer:interval(10 seconds)</pre>
									<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">timer:at(*, 16, *, *, *)</pre>
									<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">timer:schedule(....)</pre>
						</td></tr><tr><td>Custom plug-in observers can add pattern language syntax for observing application-specific events.</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">myapplication:myobserver("http://someResource")</pre>
						</td></tr></tbody></table></div></div><br class="table-break"/><p>
			There are 4 types of pattern operators:
         </p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					Operators that control pattern sub-expression repetition: <code class="literal">every</code>, <code class="literal">every-distinct</code>, <code class="literal">[num]</code> and <code class="literal">until</code>
				</p></li><li><p>
					Logical operators: <code class="literal">and</code>, <code class="literal">or</code>, <code class="literal">not</code>
				</p></li><li><p>
					Temporal operators that operate on event order: <code class="literal">-&gt;</code> (followed-by)
				</p></li><li><p>
					Guards are where-conditions that control the lifecycle of subexpressions. Examples are <code class="literal">timer:within</code>, <code class="literal">timer:withinmax</code> and <code class="literal">while</code>-expression. Custom plug-in guards may also be used.
				</p></li></ol></div><p>
			Pattern expressions can be nested arbitrarily deep by including the nested expression(s) in <code class="literal">()</code> round parenthesis.
         </p><p>
			Underlying the pattern matching is a hierarchical finite state machine and behavior tree that allocates, transitions and destroys branch and leaf nodes of state based on arriving events and based on time advancing. A single event or advancing time may 
			cause a reaction in multiple parts of your active pattern state. Patterns are stateful as the engine maintains pattern state.
			There is a walkthrough of how a sample pattern behaves in <a class="xref" href="#pattern-walkthrough" title="7.7.Â Event Pattern Walkthrough">SectionÂ 7.7, âEvent Pattern Walkthroughâ</a>.
         </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="pattern-how-to-use"/>7.2.Â How to Use Patterns</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-howto-syntax"/>7.2.1.Â Pattern Syntax</h3></div></div></div><p>
				This is an example pattern expression that matches on every <code class="literal">ServiceMeasurement</code> events in which the
				value of the <code class="literal">latency</code> event property is over 20 seconds, and on every <code class="literal">ServiceMeasurement</code> event in which the
				<code class="literal">success</code> property is false. Either one or the other condition must be true for this pattern to match.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every spike=ServiceMeasurement(latency&gt;20000) 
 or every error=ServiceMeasurement(success=false)</pre><p>
				In the example above, the pattern expression <code class="literal">or</code> operator indicates that the pattern should fire when either of the 
				filter expressions fire. The <code class="literal">every</code> operator indicates to fire for every matching event and not just the first
				matching event.
				The left hand of the <code class="literal">or</code> operator filters for events with a high latency value. 
				The right hand of the <code class="literal">or</code> operator filters for events with error status. 
				Filter expressions are explained in <a class="xref" href="#pattern-filter" title="7.4.Â Filter Expressions in Patterns">SectionÂ 7.4, âFilter Expressions in Patternsâ</a>.
			</p><p>
				The example above assigned the tags <code class="literal">spike</code> and <code class="literal">error</code> to the events in the pattern. The tags are important since the
				engine only places tagged events into the output event(s) that a pattern generates, and that the engine supplies to listeners of the pattern statement. The tags can
				further be selected in the select-clause of an EPL statement as discussed in <a class="xref" href="#epl-from-clause-patterns" title="5.4.2.Â Pattern-Based Event Streams">SectionÂ 5.4.2, âPattern-Based Event Streamsâ</a>.
			</p><p>
				Patterns can also contain comments within the pattern as outlined in <a class="xref" href="#epl-syntax-comments" title="5.2.2.Â Using Comments">SectionÂ 5.2.2, âUsing Commentsâ</a>.
			</p><p>
				Pattern statements are created via the <code class="literal">EPAdministrator</code> interface. The <code class="literal">EPAdministrator</code> interface allows to create pattern statements in two ways:
				Pattern statements that want to make use of the EPL <code class="literal">select</code> clause or any other EPL constructs use the <code class="literal">createEPL</code> method to create a statement that specifies one or more pattern expressions. EPL statements that use patterns are described in more detail in <a class="xref" href="#epl-from-clause-patterns" title="5.4.2.Â Pattern-Based Event Streams">SectionÂ 5.4.2, âPattern-Based Event Streamsâ</a>. Use the syntax as shown in below example.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPAdministrator admin = EPServiceProviderManager.getDefaultProvider().getEPAdministrator();

String eventName = ServiceMeasurement.class.getName();

EPStatement myTrigger = admin.createEPL("select * from pattern [" +
  "every spike=" + eventName + "(latency&gt;20000) or every error=" + eventName + "(success=false)]");
</pre><p>
				Pattern statements that do not need to make use of the EPL <code class="literal">select</code> clause or any other EPL constructs can use the <code class="literal">createPattern</code> method, as in below example.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPStatement myTrigger = admin.createPattern(
  "every spike=" + eventName + "(latency&gt;20000) or every error=" + eventName + "(success=false)");
</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-in-eql"/>7.2.2.Â Patterns in EPL</h3></div></div></div><p>
				A pattern may appear anywhere in the <code class="literal">from</code> clause of an EPL statement including joins and subqueries. Patterns may therefore be used in combination with the <code class="literal">where</code> clause, <code class="literal">group by</code> clause, <code class="literal">having</code> clause as well as output rate limiting and <code class="literal">insert into</code>.
			</p><p>
				In addition, you may use data window with a pattern. A data window declared for a pattern only serves to retain pattern matches, for use in joins or for iterating via the iterator API. A data window declared onto a pattern does not limit, cancel, remove or delete intermediate pattern matches of the pattern when pattern matches leave the data window.
			</p><p>
				This example statement demonstrates the idea by selecting a total price per customer over pairs of events (ServiceOrder followed by a ProductOrder event for the same customer id within 1 minute), occurring in the last 2 hours, in which the sum of price is greater than 100, and using a <code class="literal">where</code> clause to filter on name:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select a.custId, sum(a.price + b.price)
from pattern [every a=ServiceOrder -&gt; 
    b=ProductOrder(custId = a.custId) where timer:within(1 min)]#time(2 hour) 
where a.name in ('Repair', b.name)
group by a.custId
having sum(a.price + b.price) &gt; 100</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="patterns-howto-subscribe"/>7.2.3.Â Subscribing to Pattern Events</h3></div></div></div><p>			
				When a pattern fires it publishes one or more events to any listeners to the pattern statement. 
				The listener interface is the <code class="literal">com.espertech.esper.client.UpdateListener</code> interface.
			</p><p>            
				The example below shows an anonymous implementation of the <code class="literal">com.espertech.esper.client.UpdateListener</code> interface.
				The example adds the anonymous listener implementation to the <code class="literal">myPattern</code> statement created earlier. 
				The listener code simply extracts the underlying event class.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">myPattern.addListener(new UpdateListener() {
  public void update(EventBean[] newEvents, EventBean[] oldEvents) {
    ServiceMeasurement spike = (ServiceMeasurement) newEvents[0].get("spike");
    ServiceMeasurement error = (ServiceMeasurement) newEvents[0].get("error");
    ... // either spike or error can be null, depending on which occurred
    ... // add more logic here
  }
});</pre><p>            
				Listeners receive an array of <code class="literal">EventBean</code> instances in the <code class="literal">newEvents</code> parameter.
				There is one <code class="literal">EventBean</code> instance passed to the listener for each combination of events that matches
				the pattern expression. At least one <code class="literal">EventBean</code> instance is always passed to the listener.
			</p><p>
				The properties of each <code class="literal">EventBean</code> instance contain the underlying events that caused the
				pattern to fire, if events have been named in the filter expression via the <code class="literal">name=eventType</code> syntax.
				The property name is thus the name supplied in the pattern expression, while the property type is the type of the underlying class, 
				in this example <code class="literal">ServiceMeasurement</code>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-howto-pull-data"/>7.2.4.Â Pulling Data From Patterns</h3></div></div></div><p>
				Data can also be obtained from pattern statements via the <code class="literal">safeIterator()</code> and <code class="literal">iterator()</code> methods on <code class="literal">EPStatement</code> (the pull API)
				If the pattern had fired at least once and the <code class="literal">@IterableUnbound</code> annotation is declared for the statement, then the iterator returns the last event for which it fired.
				The <code class="literal">hasNext()</code> method can then be used to determine if the pattern had fired.				 				
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">if (myPattern.iterator().hasNext()) {
	ServiceMeasurement event = (ServiceMeasurement) statement.iterator().next().get("alert");
    ... // some more code here to process the event
}
else {
    ... // no matching events at this time
}</pre><p>
				Further, if a data window is defined onto a pattern, the iterator returns the pattern matches according to the data window expiry policy.
			</p><p>
				This pattern specifies a length window of 10 elements that retains the last 10 matches of A and B events, for use via iterator or for use in a join or subquery:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern [every (A or B)]#length(10)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-errorreporting"/>7.2.5.Â Pattern Error Reporting</h3></div></div></div><p>
			  While the pattern compiler analyzes your pattern and verifies its integrity, it may not detect certain pattern errors that may occur at runtime. Sections of this pattern documentation
			  point out common cases where the pattern engine will log a runtime error. We recommend turning on the log warning level at project development time to inspect and report on warnings logged.
			  If a statement name is assigned to a statement then the statement name is logged as well.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="patterns-howto-suppress"/>7.2.6.Â Suppressing Same-Event Matches</h3></div></div></div><p>
			  Any given event can contribute to multiple matches.
           </p><p>
			  For example, consider the following pattern:
           </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every a=A -&gt; B</pre><p>
			  Given this sequence of events:
           </p><p>
				A<sub>1</sub> Â 
				A<sub>2</sub> Â 
				B<sub>1</sub> Â 
            </p><p>
				When event B<sub>1</sub> arrives the pattern matches for both the combination {A<sub>1</sub>, B<sub>1</sub>} 
				and the combination {A<sub>2</sub>, B<sub>1</sub>}. 
				The engine indicates both matches to the listener or subscriber by delivering an array containing both matches in a single listener or subscriber invocation.
			</p><p>
				Use the <code class="literal">@SuppressOverlappingMatches</code> pattern-level annotation to instruct the engine to discard all but the first match among multiple overlapping matches.
			</p><p>
			    The same example with the pattern-level annotation is:
           </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern @SuppressOverlappingMatches [every a=A -&gt; b=B]</pre><p>
				When event B<sub>1</sub> arrives the pattern outputs only the first combination that matches, namely the combination {A<sub>1</sub>, B<sub>1</sub>}.
				The engine discards the second combination ({A<sub>2</sub>, B<sub>1</sub>}) that matches as it detects that event B<sub>1</sub> 
				overlaps between the first and the second match.
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><div class="itemizedlist"><ul><li>The engine only considers tagged events for detecting overlap.</li><li>Suppression takes place among multiple simultaneously occurring matches as a result of a single event arriving or time advancing.</li><li>Partially completed patterns are not impacted and existing pattern state does not change as a result of suppression.</li><li>Limitation: The annotation cannot be used with patterns in joins.</li></ul></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="patterns-howto-discard"/>7.2.7.Â Discarding Partially Completed Patterns</h3></div></div></div><p>
			  Partially-completed patterns are incomplete matches that are not yet indicated by the engine because the complete pattern condition is not satisfied.
			  Any given event can be part of multiple partially-completed patterns.
           </p><p>
			  For example, consider the following pattern:
           </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every a=A -&gt; B and C(id=a.id)</pre><p>
			  Given this sequence of events:
           </p><p>
				A<sub>1</sub>{id='id1'} Â 
				A<sub>2</sub>{id='id2'} Â 
				B<sub>1</sub> Â 
            </p><p>
				According to the sequence above there are no matches. The pattern is partially completed waiting for C events. 
				The combination {A<sub>1</sub>, B<sub>1</sub>} is waiting for a C{id='id1'} event before the pattern match is complete for that combination.
				The combination {A<sub>2</sub>, B<sub>1</sub>} is waiting for a C{id='id2'} event before the pattern match is complete for that combination.
			</p><p>
				Assuming event C<sub>1</sub>{id='id1') arrives the pattern outputs the combination {A<sub>1</sub>, B<sub>1</sub>, C<sub>1</sub>}.
				Assuming event C<sub>2</sub>{id='id2') arrives the pattern outputs the combination {A<sub>2</sub>, B<sub>1</sub>, C<sub>2</sub>}.
				Note that event B<sub>1</sub> is part of both partially-completed patterns.
			</p><p>
				Use the <code class="literal">@DiscardPartialsOnMatch</code> pattern-level annotation to instruct the engine that when any matches occur to discard partially completed patterns that overlap in terms of the events that 
				make up the match (or matches if there are multiple matches).
			</p><p>
			    The same example using the <code class="literal">@DiscardPartialsOnMatch</code> pattern-level annotation is:
           </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern @DiscardPartialsOnMatch [every a=A -&gt; B and C(id=a.id)]</pre><p>
				When event C<sub>1</sub>{id='id1') arrives the pattern outputs the match combination {A<sub>1</sub>, B<sub>1</sub>, C<sub>1</sub>}.
				Upon indication of the match the engine discards all partially-completed patterns that refer to either of the A<sub>1</sub>, B<sub>1</sub> and C<sub>1</sub> events.
				Since event B<sub>1</sub> is part of a partially-completed pattern waiting for C{id='id2'}, the engine discards that partially-completed pattern.
				Therefore when C<sub>2</sub>{id='id2'} arrives the engine outputs no matches.
			</p><p>
			  When specifying both <code class="literal">@DiscardPartialsOnMatch</code> and <code class="literal">@SuppressOverlappingMatches</code> the engine discards the partially-completed patterns that overlap all matches including suppressed matches.
           </p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><div class="itemizedlist"><ul><li>The engine only considers tagged events for detecting overlap.</li><li>Only partially completed patterns are impacted.</li><li>Limitation: The annotation cannot be used with patterns in joins.</li><li>Limitation: Removing partially completed patterns is not an undo operation. 
					There is no reversal in truth-value, i.e. past matches are not retracted or indicated as a remove stream.
					The <code class="literal">not</code> operator can change truth value to permanently false.
					The change in truth-value does not get reversed when a match removes the event that caused the <code class="literal">not</code> operator to become permanently false.
					</li></ul></div></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="pattern-op-precedence"/>7.3.Â Operator Precedence</h2></div></div></div><a id="d0e18644" class="indexterm"/><p>
			The operators at the top of this table take precedence over operators lower on the table. 
		</p><div class="table"><a id="d0e18651"/><p class="title"><b>TableÂ 7.2.Â Pattern Operator Precedence</b></p><div class="table-contents"><table summary="Pattern Operator Precedence" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th>Precedence</th><th>Operator</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td>1</td><td>guard postfix</td><td><code class="literal">where timer:within</code> and <code class="literal">while (expression)</code> (incl. withinmax and plug-in pattern guard)</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">MyEvent where timer:within(1 sec)</pre>
									<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">a=MyEvent while (a.price between 1 and 10)</pre>
						</td></tr><tr><td>2</td><td>unary</td><td><code class="literal">every, not, every-distinct</code></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every MyEvent
timer:interval(5 min) and not MyEvent</pre></td></tr><tr><td>3</td><td>repeat</td><td><code class="literal">[num]</code>, <code class="literal">until</code></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[5] MyEvent</pre>
									<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[1..3] MyEvent until MyOtherEvent</pre>
						</td></tr><tr><td>4</td><td>and</td><td><code class="literal">and</code></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every (MyEvent and MyOtherEvent)</pre></td></tr><tr><td>5</td><td>or</td><td><code class="literal">or</code></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every (MyEvent or MyOtherEvent)</pre></td></tr><tr><td>6</td><td>followed-by</td><td><code class="literal">-&gt;</code></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every (MyEvent -&gt; MyOtherEvent)</pre></td></tr></tbody></table></div></div><br class="table-break"/><p>
			If you are not sure about the precedence, please consider placing parenthesis <code class="literal">()</code> around your subexpressions. Parenthesis can also help make
			expressions easier to read and understand.
		</p><p>
			The following table outlines sample equivalent expressions, with and without the use of parenthesis for subexpressions.
		</p><div class="table"><a id="d0e18760"/><p class="title"><b>TableÂ 7.3.Â Equivalent Pattern Expressions</b></p><div class="table-contents"><table summary="Equivalent Pattern Expressions" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Expression</th><th>Equivalent</th><th>Reason</th></tr></thead><tbody><tr><td>every A or B</td><td>(every A) or B</td><td>The <code class="literal">every</code> operator has higher precedence then the <code class="literal">or</code> operator.</td></tr><tr><td>every A -&gt; B or C</td><td>(every A) -&gt; (B or C)</td><td>The <code class="literal">or</code> operator has higher precedence then the <code class="literal">followed-by</code> operator.</td></tr><tr><td>A -&gt; B or B -&gt; A</td><td>A -&gt; (B or B) -&gt; A</td><td>The <code class="literal">or</code> operator has higher precedence then the <code class="literal">followed-by</code> operator,
						  specify as (A -&gt; B) or (B -&gt; A) instead.
						 </td></tr><tr><td>A and B or C</td><td>(A and B) or C</td><td>The <code class="literal">and</code> operator has higher precedence then the <code class="literal">or</code> operator.</td></tr><tr><td>A -&gt; B until C -&gt; D</td><td>A -&gt; (B until C) -&gt; D</td><td>The <code class="literal">until</code> operator has higher precedence then the <code class="literal">followed-by</code> operator.</td></tr><tr><td>[5] A or B </td><td>([5] A) or B</td><td>The <code class="literal">[num]</code> repeat operator has higher precedence then the <code class="literal">or</code> operator.</td></tr><tr><td>every A where timer:within(10)</td><td>every (A where timer:within(10))</td><td>The <code class="literal">where</code> postfix has higher precedence then the <code class="literal">every</code> operator.</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="pattern-filter"/>7.4.Â Filter Expressions in Patterns</h2></div></div></div><a id="d0e18870" class="indexterm"/><p>
			The simplest form of filter is a filter for events of a given type without any conditions on the event property values. This filter matches any event of that type regardless of the event's properties. The example below is such a filter. Note that this event pattern would stop firing as soon as the first RfidEvent is encountered.
		 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">com.mypackage.myevents.RfidEvent</pre><p>
			 To make the event pattern fire for every RfidEvent and not just the first event, use the <code class="literal">every</code> keyword.
		 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every com.mypackage.myevents.RfidEvent</pre><p>
			 The example above specifies the fully-qualified Java class name as the event type. Via configuration, the event pattern above can be simplified by using the name
			 that has been defined for the event type.
		 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every RfidEvent</pre><p>
			 Interfaces and superclasses are also supported as event types. In the below example <code class="literal">IRfidReadable</code> is an interface class, and the statement matches any event that implements this interface:
		 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every org.myorg.rfid.IRfidReadable</pre><p>
			The filtering criteria to filter for events with certain event property values are placed within parenthesis after the event type name:
		 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">RfidEvent(category="Perishable")</pre><p>
			All expressions can be used in filters, including static method invocations that return a boolean value:
		 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">RfidEvent(com.mycompany.MyRFIDLib.isInRange(x, y) or (x&lt;0 and y &lt; 0))</pre><p>
			Filter expressions can be separated via a single comma '<code class="literal">,</code>'. The comma represents a logical AND between expressions:
		 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">RfidEvent(zone=1, category=10)
...is equivalent to...
RfidEvent(zone=1 and category=10)</pre><p>
			For more information on filters please see <a class="xref" href="#epl-from-clause-filter" title="5.4.1.Â Filter-Based Event Streams">SectionÂ 5.4.1, âFilter-Based Event Streamsâ</a>. Contained-event selection on filters in patterns is further described in <a class="xref" href="#epl-containedeventselect" title="5.19.Â Contained-Event Selection">SectionÂ 5.19, âContained-Event Selectionâ</a>.
		</p><p>
			Filter criteria can also refer to events matching prior named events in the same expression. Below pattern is an example in which the pattern
			matches once for every RfidEvent that is preceded by an RfidEvent with the same asset id.
		 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every e1=RfidEvent -&gt; e2=RfidEvent(assetId=e1.assetId)</pre><p>
			The syntax shown above allows filter criteria to reference prior results by specifying the event name tag of the prior event, and the event property name. The tag names in the above example were <code class="literal">e1</code> and <code class="literal">e2</code>. This syntax can be used in all filter operators or expressions including ranges and the <code class="literal">in</code> set-of-values check:
		 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every e1=RfidEvent -&gt; 
  e2=RfidEvent(MyLib.isInRadius(e1.x, e1.y, x, y) and zone in (1, e1.zone))</pre><p>
			An arriving event changes the truth value of all expressions that look for the event. Consider the pattern as follows:
		 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every (RfidEvent(zone &gt; 1) and RfidEvent(zone &lt; 10))</pre><p>
			The pattern above is satisfied as soon as only one event with zone in the interval [2, 9] is received.
		 </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-filter-performance"/>7.4.1.Â Filter Expressions and Filter Indexes</h3></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>
					A detailed description of how filters become active and are indexed engine-wide is provided at <a class="xref" href="#processingmodel_indexes_filterindexes_pattern" title="2.18.2.2.Â Filter Index Pattern Example">SectionÂ 2.18.2.2, âFilter Index Pattern Exampleâ</a>.
				</p><p>
					An expression such as <code class="literal">a=A -&gt; B(id=a.id)</code> (A followed-by B with the same id as A) is not just a state change, in fact the engine registers new B-filter instances dynamically and in engine-wide shared filter indexes.
					This means that while such a pattern seems to be slow if you are sending A-events, the engine can filter, match or discard B-events very fast as for B-events it only needs to perform a lookup in filter indexes.
					If you are looking for best performance and don't expect to need filter indexes, or if you compare to another technology that doesn't have the concept of filter indexes, please use match-recognize instead.
				</p></div><p>
				The engine analyzes all filter expressions within a pattern and determines the filter indexes to use or to create. Indexing filter values to match event properties of incoming events enables the engine to match incoming events faster to pattern subexpressions. 
			</p><p>
				More information on filter indexes in general can be found at <a class="xref" href="#processingmodel_indexes_filterindexes" title="2.18.2.Â Filter Indexes">SectionÂ 2.18.2, âFilter Indexesâ</a>.
			</p><p>
				More information on the operators relevant to filter indexes can be found at <a class="xref" href="#epl-filter-criteria" title="5.4.1.2.Â Specifying Filter Criteria">SectionÂ 5.4.1.2, âSpecifying Filter Criteriaâ</a>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-filter-consumption"/>7.4.2.Â Controlling Event Consumption</h3></div></div></div><a id="d0e18967" class="indexterm"/><p>
				An arriving event applies to all filter expressions for which the event matches. In other words, an arriving event is not consumed by any specify filter expression(s) but applies to all active filter expressions of all pattern sub-expressions.
			 </p><p>
				You may provide the <code class="literal">@consume</code> annotation as part of a filter expression to control consumption of an arriving event. If an arriving event matches the filter expression marked with <code class="literal">@consume</code> it
				is no longer available to other filter expressions of the same pattern that also match the arriving event.
			 </p><p>
				 The <code class="literal">@consume</code> can include a level number in parenthesis. A higher level number consumes the event first. The default level number is 1. Multiple filter expressions with the same level number for <code class="literal">@consume</code> all match the event.
			 </p><p>
			   Consider the next sample pattern:
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">a=RfidEvent(zone='Z1') and b=RfidEvent(assetId='0001')</pre><p>
				 This pattern fires when a single RfidEvent event arrives that has zone 'Z1' and assetId '0001'. The pattern also matches
				 when two RfidEvent events arrive, in any order, wherein one has zone 'Z1' and the other has assetId '0001'.
			 </p><p>
			      Mark a filter expression with <code class="literal">@consume</code> to indicate that if an arriving event matches multiple filter expressions that the engine prefers the marked filter expression and does not match any other filter expression.
			  </p><p>
			      This updated pattern statement uses <code class="literal">@consume</code> to indicate that a match against zone is preferred:
			  </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">a=RfidEvent(zone='Z1')@consume and b=RfidEvent(assetId='0001')</pre><p>
				 This pattern no longer fires when a single RfidEvent arrives that has zone 'Z1' and assetId '0001', because when the first filter expression matches the pattern engine consumes the event.
				 The pattern only matches when two RfidEvent events arrive in any order. One event must have zone 'Z1' and the other event must have a zone other than 'Z1' and an assetId '0001'.
			 </p><p>
			   The next sample pattern provides a level number for each <code class="literal">@consume</code>:
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">a=RfidEvent(zone='Z1')@consume(2) 
  or b=RfidEvent(assetId='0001')@consume(1) 
  or c=RfidEvent(category='perishable'))</pre><p>
				  The pattern fires when an RfidEvent arrives with zone 'Z1'. In this case the output event populates property 'a' but not properties 'b' and 'c'.
				  The pattern also fires when an RfidEvent arrives with a zone other than 'Z1' and an asset id of '0001'. In this case the output event populates property 'b' but not properties 'a' and 'c'.
				  The pattern also fires when an RfidEvent arrives with a zone other than 'Z1' and an asset id other than '0001' and a category of 'perishable'. In this case the output event populates property 'c' but not properties 'a' and 'b'.
			  </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-filter-namedwindow"/>7.4.3.Â Use With Named Windows and Tables</h3></div></div></div><a id="d0e19022" class="indexterm"/><a id="d0e19027" class="indexterm"/><p>
				When your filter expression provides the name of a named window then the filter expression matches each time an event is inserted into the named window that matches the filter conditions.
			 </p><p>
			   For example, assume a named window that holds the last order event per order id:
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window LastOrderWindow#unique(orderId) as OrderEvent</pre><p>
			   Assume that all order events are inserted into the named window using insert-into:
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into LastOrderWindow select * from OrderEvent</pre><p>
			  This sample pattern fires 10 seconds after an order event with a price greater then 100 was inserted:
			  </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern [every o=LastOrderWindow(price &gt;= 100) -&gt; timer:interval(10 sec)]</pre><p>
			   The pattern above fires only for events inserted-into the <code class="literal">LastOrderWindow</code> named window and does not fire when an order event was updated using on-update or merged using on-merge.
			 </p><p>
				 If your application would like to have the pattern fire for any change to the named window events including updates and merges, you must select from the named window as follows:
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into OrderWindowChangeStream select * from LastOrderWindow</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern [every o=OrderWindowChangeStream(price &gt;= 100) -&gt; timer:interval(10 sec)]</pre><p>
				A table cannot be listed as part of a pattern filter, however any filter EPL expressions can have tables access expressions and subqueries against tables.
			 </p><p>
			  Assuming that <code class="literal">MyTable</code> is a table, the following is not allowed:
			  </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// not allowed
select * from pattern [every MyTable -&gt; timer:interval(10 sec)]</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="pattern-operators"/>7.5.Â Pattern Operators</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-logical-every"/>7.5.1.Â Every</h3></div></div></div><a id="d0e19072" class="indexterm"/><a id="d0e19077" class="indexterm"/><p>				
				The <code class="literal">every</code> operator indicates that the pattern sub-expression should restart when the subexpression qualified by the <code class="literal">every</code> keyword evaluates to true or false.
				Without the <code class="literal">every</code> operator the pattern sub-expression stops when the pattern sub-expression evaluates to true or false.
            </p><p>				
				As a side note, please be aware that a single invocation to the <code class="literal">UpdateListener</code> interface may deliver multiple events in one invocation, since the interface accepts an array of values.
            </p><p>
				Thus the <code class="literal">every</code> operator works like a factory for the pattern sub-expression contained within. When the pattern sub-expression within it fires and thus quits checking for events, the <code class="literal">every</code> causes the start of a new pattern sub-expression listening for more occurrences of the same
				event or set of events.
            </p><p>
				Every time a pattern sub-expression within an <code class="literal">every</code> operator turns true the engine starts a new active subexpression looking 
				for more event(s) or timing conditions that match the pattern sub-expression. If the <code class="literal">every</code> operator is not specified for a subexpression, 
				the subexpression stops after the first match was found.
            </p><p>
				This pattern fires when encountering an A event and then stops looking.
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">A</pre><p>
				This pattern keeps firing when encountering A events, and doesn't stop looking.
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every A</pre><p>
				When using <code class="literal">every</code> operator with the <code class="literal">-&gt;</code> followed-by operator, each time the <code class="literal">every</code> operator restarts it also starts a new subexpression instance looking for events in the followed-by subexpression.
            </p><p>
				Let's consider an example event sequence as follows.
            </p><p>
				A<sub>1</sub> Â 
				B<sub>1</sub> Â   
				C<sub>1</sub> Â 
				B<sub>2</sub>  Â 
				A<sub>2</sub>  Â 
				D<sub>1</sub>  Â 
				A<sub>3</sub>  Â 
				B<sub>3</sub>  Â 
				E<sub>1</sub>  Â 
				A<sub>4</sub>  Â 
				F<sub>1</sub>  Â 
				B<sub>4</sub> 
            </p><div class="table"><a id="pattern-every-samples"/><p class="title"><b>TableÂ 7.4.Â <code class="literal">Every</code> Operator Examples</b></p><div class="table-contents"><table summary="Every Operator Examples" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Example</th><th>Description</th></tr></thead><tbody><tr><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every ( A -&gt; B )</pre></td><td>
								<p>
									Detect an A event followed by a B event. 
									At the time when B occurs the pattern matches, then the pattern matcher restarts and looks for the next A event.
								</p>
								<div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
											Matches on B<sub>1</sub> for combination {A<sub>1</sub>, B<sub>1</sub>}
										</p></li><li><p>
											Matches on B<sub>3</sub> for combination {A<sub>2</sub>, B<sub>3</sub>}	
										</p></li><li><p>
											Matches on B<sub>4</sub> for combination {A<sub>4</sub>, B<sub>4</sub>}
										</p></li></ol></div>
							</td></tr><tr><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every A -&gt; B</pre></td><td>
								<p>
									The pattern fires for every A event followed by a B event.
								</p>
								<div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
											Matches on B<sub>1</sub> for combination {A<sub>1</sub>, B<sub>1</sub>}
										</p></li><li><p>
											Matches on B<sub>3</sub> for combination {A<sub>2</sub>, B<sub>3</sub>}
											and {A<sub>3</sub>, B<sub>3</sub>}
										</p></li><li><p>
											Matches on B<sub>4</sub> for combination {A<sub>4</sub>, B<sub>4</sub>}
										</p></li></ol></div>
							</td></tr><tr><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">A -&gt; every B</pre></td><td>
								<p>
									The pattern fires for an A event followed by every B event.
								</p>
								<div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
											Matches on B<sub>1</sub> for combination {A<sub>1</sub>, B<sub>1</sub>}.
										</p></li><li><p>
											Matches on B<sub>2</sub> for combination {A<sub>1</sub>, B<sub>2</sub>}.
										</p></li><li><p>
											Matches on B<sub>3</sub> for combination {A<sub>1</sub>, B<sub>3</sub>}
										</p></li><li><p>
											Matches on B<sub>4</sub> for combination {A<sub>1</sub>, B<sub>4</sub>}
										</p></li></ol></div>
							</td></tr><tr><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every A -&gt; every B</pre></td><td>
								<p>
									The pattern fires for every A event followed by every B event.
								</p>
								<div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
											Matches on B<sub>1</sub> for combination {A<sub>1</sub>, B<sub>1</sub>}.
										</p></li><li><p>
											Matches on B<sub>2</sub> for combination {A<sub>1</sub>, B<sub>2</sub>}.
										</p></li><li><p>
											Matches on B<sub>3</sub> for combination {A<sub>1</sub>, B<sub>3</sub>}
											and {A<sub>2</sub>, B<sub>3</sub>} and {A<sub>3</sub>, B<sub>3</sub>}
										</p></li><li><p>
											Matches on B<sub>4</sub> for combination {A<sub>1</sub>, B<sub>4</sub>}
											and {A<sub>2</sub>, B<sub>4</sub>} and {A<sub>3</sub>, B<sub>4</sub>}
											and {A<sub>4</sub>, B<sub>4</sub>}
										</p></li></ol></div>
							</td></tr></tbody></table></div></div><br class="table-break"/><p>
				The examples show that it is possible that a pattern fires for multiple combinations of events that match a pattern expression.
				Each combination is posted as an <code class="literal">EventBean</code> instance to the <code class="literal">update</code> method in the <code class="literal">UpdateListener</code> implementation.
            </p><p>
				Let's consider the <code class="literal">every</code> operator in conjunction with a subexpression that matches 3 events that follow each other:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every (A -&gt; B -&gt; C)</pre><p>
				The pattern first looks for A events. When an A event arrives, it looks for a B event. After the B event arrives, the pattern looks for a C event. Finally, when the C event arrives the pattern fires. The engine then starts looking for an A event again.
            </p><p>
				Assume that between the B event and the C event a second A<sub>2</sub> event arrives. The pattern would ignore the A<sub>2</sub> event entirely since it's then looking for a C event.
				As observed in the prior example, the <code class="literal">every</code> operator restarts the subexpression <code class="literal">A -&gt; B -&gt; C</code> only when the subexpression fires.
            </p><p>
				In the next statement the <code class="literal">every</code> operator applies only to the A event, not the whole subexpression:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every A -&gt; B -&gt; C</pre><p>
				This pattern now matches for each A event that is followed by a B event and then a C event, regardless of when the A event arrives. Note that for each A event that arrives the pattern engine starts a new subexpression looking for a B event and then a C event, outputting each combination of matching events.
            </p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-every-equivanence"/>7.5.1.1.Â <code class="literal">Every</code> Operator Equivalence</h4></div></div></div><p>
					A pattern that only has the <code class="literal">every</code> operator and a single filter expression is equivalent to selecting the same filter in the <code class="literal">from</code> clause:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent(symbol='GE')	     // Prefer this
// ... equivalent to ...
select * from pattern[every StockTickEvent(symbol='GE')]</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-every-ending-subexp"/>7.5.1.2.Â Limiting Subexpression Lifetime</h4></div></div></div><p>
					As the introduction of the <code class="literal">every</code> operator states, the operator starts new subexpression instances and can cause multiple matches to occur for a single arriving event.
				</p><p>
					New subexpressions also take a very small amount of system resources and thereby your application should carefully consider when subexpressions must end when designing patterns. Use the <code class="literal">timer:within</code> construct and the <code class="literal">and not</code> constructs to end active subexpressions. The data window onto a pattern stream does not serve to limit pattern sub-expression lifetime.
				</p><p>
					Lets look at a concrete example. Consider the following sequence of events arriving:
				</p><p>
					A<sub>1</sub> Â 
					A<sub>2</sub> Â   
					B<sub>1</sub> Â 
				</p><p>
					This pattern matches on arrival of B<sub>1</sub> and outputs two events (an array of length 2 if using a listener). The two events are the combinations {A<sub>1</sub>, B<sub>1</sub>} and {A<sub>2</sub>, B<sub>1</sub>}:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every a=A -&gt; b=B</pre><p>
					The <code class="literal">and not</code> operators are used to end an active subexpression.
				</p><p>
					The next pattern matches on arrival of B<sub>1</sub> and outputs only the last A event which is the combination {A<sub>2</sub>, B<sub>1</sub>}:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every a=A -&gt; (b=B and not A)</pre><p>
					The <code class="literal">and not</code> operators cause the subexpression looking for {A<sub>1</sub>, B?} to end when A<sub>2</sub> arrives.
				</p><p>
					Similarly, in the pattern below the engine starts a new subexpression looking for a B event every 1 second. After 5 seconds there are 5 subexpressions active looking for a B event and 5 matches occur at once if a B event arrives after 5 seconds.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every timer:interval(1 sec) -&gt; b=B</pre><p>
					Again the <code class="literal">and not</code> operators can end subexpressions that are not intended to match any longer:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every timer:interval(1 sec) -&gt; (b=B and not timer:interval(1 sec))
// equivalent to
every timer:interval(1 sec) -&gt; (b=B where timer:within(1 sec))</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-every-sample1"/>7.5.1.3.Â <code class="literal">Every</code> Operator Example</h4></div></div></div><p>
					This example considers a generic pattern in which the pattern must match for each A event followed by a B event and followed by a C event, in which both the B event and the C event must arrive within 1 hour of the A event. The first approach to the pattern is as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every A  -&gt; (B -&gt; C) where timer:within(1 hour)</pre><p>
					Consider the following sequence of events arriving:
				</p><p>
					A<sub>1</sub> Â 
					A<sub>2</sub> Â   
					B<sub>1</sub> Â 
					C<sub>1</sub> Â   
					B<sub>2</sub> Â 
					C<sub>2</sub>
				</p><p>
					First, the pattern as above never stops looking for A events since the <code class="literal">every</code> operator instructs the pattern to keep looking for A events.
				</p><p>
					When A<sub>1</sub> arrives, the pattern starts a new subexpression that keeps A<sub>1</sub> in memory and looks for any B event. At the same time, it also keeps looking for more A events. 
				</p><p>
					When A<sub>2</sub> arrives, the pattern starts a new subexpression that keeps A<sub>2</sub> in memory and looks for any B event. At the same time, it also keeps looking for more A events. 
				</p><p>
					After the arrival of A<sub>2</sub>, there are 3 subexpressions active:
				</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
							The first active subexpression with A<sub>1</sub> in memory, looking for any B event.
						</p></li><li><p>
							The second active subexpression with A<sub>2</sub> in memory, looking for any B event.
						</p></li><li><p>
							A third active subexpression, looking for the next A event.
						</p></li></ol></div><p>
					In the pattern above, there is a 1-hour lifetime for subexpressions looking for B and C events. Thus, if no B and no C event arrive within 1 hour after A<sub>1</sub>, the first subexpression goes away. If no B and no C event arrive within 1 hour after A<sub>2</sub>, the second subexpression goes away. The third subexpression however stays around looking for more A events.
				</p><p>
					The pattern as shown above thus matches on arrival of C<sub>1</sub> for combination {A<sub>1</sub>, B<sub>1</sub>, C<sub>1</sub>} and
					for combination {A<sub>2</sub>, B<sub>1</sub>, C<sub>1</sub>}, provided that B<sub>1</sub> and C<sub>1</sub> arrive within an hour of A<sub>1</sub> and A<sub>2</sub>.
				</p><p>
					You may now ask how to match on {A<sub>1</sub>, B<sub>1</sub>, C<sub>1</sub>} and {A<sub>2</sub>, B<sub>2</sub>, C<sub>2</sub>} instead, since 
					you may need to correlate on a given property.					
				</p><p>
					The pattern as discussed above matches every A event followed by the first B event followed by the next C event, and doesn't specifically qualify the B or C events to look for based on the A event.  To look for specific B and C events in relation to a given A event, specify correlating properties of the A event, for example:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every a=A -&gt; (B(id=a.id) -&gt; C(id=a.id)) where timer:within(1 hour)</pre><p>
					The pattern as shown above thus matches on arrival of C<sub>1</sub> for combination {A<sub>1</sub>, B<sub>1</sub>, C<sub>1</sub>} and
					on arrival of C<sub>2</sub> for combination {A<sub>2</sub>, B<sub>2</sub>, C<sub>2</sub>}.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-every-sample2"/>7.5.1.4.Â Sensor Example</h4></div></div></div><p>
					This example looks at temperature sensor events named Sample. The pattern detects when 3 sensor events indicate a temperature of more then 50 degrees uninterrupted within 90 seconds of the first event, considering events for the same sensor only.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every sample=Sample(temp &gt; 50) -&gt;
( (Sample(sensor=sample.sensor, temp &gt; 50) and not Sample(sensor=sample.sensor, temp &lt;= 50))   
  -&gt;
  (Sample(sensor=sample.sensor, temp &gt; 50) and not Sample(sensor=sample.sensor, temp &lt;= 50))   
 ) where timer:within(90 seconds))</pre><p>
					The pattern starts a new subexpression in the round braces after the first followed-by operator for each time a sensor indicated more then 50 degrees. Each subexpression then lives a maximum of 90 seconds. Each subexpression ends if a temperature of 50 degress or less is encountered for the same sensor. Only if 3 temperature events in a row indicate more then 50 degrees, and within 90 seconds of the first event, and for the same sensor, does this pattern fire.
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-logical-everydistinct"/>7.5.2.Â Every-Distinct</h3></div></div></div><a id="d0e19760" class="indexterm"/><a id="d0e19765" class="indexterm"/><p>				
				Similar to the <code class="literal">every</code> operator in most aspects, the <code class="literal">every-distinct</code> operator indicates that the pattern sub-expression should restart when the subexpression qualified by the <code class="literal">every-distinct</code> keyword evaluates to true or false. In addition, the <code class="literal">every-distinct</code> eliminates duplicate results received from an active subexpression according to its distinct-value expressions.
            </p><p>
				The synopsis for the <code class="literal">every-distinct</code> pattern operator is:
            </p><pre class="synopsis">every-distinct(<span class="emphasis"><em>distinct_value_expr </em></span>[, <span class="emphasis"><em>distinct_value_exp</em></span>[...][, <span class="emphasis"><em>expiry_time_period</em></span>])</pre><p>
				Within parenthesis are one or more <span class="emphasis"><em>distinct_value_expr</em></span> expressions that return the values by which to remove duplicates.
            </p><p>
				You may optionally specify an <span class="emphasis"><em>expiry_time_period</em></span> time period. If present, the pattern engine expires and removes distinct key values that are older then the time period, removing their associated memory and allowing such distinct values to match again.
				When your distinct value expressions return an unlimited number of values, for example when your distinct value is a timestamp or auto-increment column, you should always specify an expiry time period.
            </p><p>
				When specifying properties in the distinct-value expression list, you must ensure that the event types providing properties are tagged. Only properties of event types within filter expressions that are sub-expressions to the <code class="literal">every-distinct</code> may be specified.
            </p><p>
				For example, this pattern keeps firing for every A event with a distinct value for its <code class="literal">aprop</code> property:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every-distinct(a.aprop) a=A</pre><p>
				Note that the pattern above assigns the <code class="literal">a</code> tag to the A event and uses <code class="literal">a.prop</code> to identify the <code class="literal">prop</code> property as a value of the <code class="literal">a</code> event  A.
            </p><p>
				A pattern that returns the first Sample event for each sensor, assuming sensor is a field that returns a unique id identifying the sensor that originated the Sample event, is:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every-distinct(s.sensor) s=Sample</pre><p>
				The next pattern looks for pairs of A and B events and returns only the first pair for each combination of <code class="literal">aprop</code> of an A event and <code class="literal">bprop</code> of a B event:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every-distinct(a.aprop, b.bprop) (a=A and b=B)</pre><p>
				The following pattern looks for A events followed by B events for which the value of the <code class="literal">aprop</code> of an A event is the same value of the <code class="literal">bprop</code> of a B event but only for each distinct value of <code class="literal">aprop</code> of an A event:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every-distinct(a.aprop) a=A -&gt; b=B(bprop = a.aprop)</pre><p>
				When specifying properties as part of distinct-value expressions, properties must be available from tagged event types in sub-expressions to the <code class="literal">every-distinct</code>.
            </p><p>
				The following patterns are not valid:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Invalid: event type in filter not tagged
every-distinct(aprop) A
			
// Invalid: property not from a sub-expression of every-distinct
a=A -&gt; every-distinct(a.aprop) b=B</pre><p>
				When an active subexpression to <code class="literal">every-distinct</code> becomes permanently false, the distinct-values seen from the active subexpression are removed and the sub-expression within is restarted.
            </p><p>
				For example, the below pattern detects each A event distinct by the value of <code class="literal">aprop</code>.
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every-distinct(a.aprop) (a=A and not B)</pre><p>
				In the pattern above, when a B event arrives, the subexpression becomes permanently false and is restarted anew, detecting each A event distinct by the value of <code class="literal">aprop</code> without considering prior values.
            </p><p>
              When your distinct key is a timestamp or other non-unique property, specify an expiry time period.
            </p><p>
              The following example returns every distinct A event according to the timestamp property on the A event, retaining each timestamp value for 10 seconds:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every-distinct(a.timestamp, 10 seconds) a=A</pre><p>
				In the example above, if for a given A event and its timestamp value the same timestamp value occurs again for another A event before 10 seconds passed, the A event is not a match. If 10 seconds passed the pattern indicates a second match.
			</p><p>
              You may not use every-distinct with a timer-within guard to expire keys: The expiry time notation as above is the recommended means to expire keys.
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// This is not the same as above; It does not expire transaction ids and is not recommended
every-distinct(a.timestamp) a=A where timer:within(10 sec)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-repeat"/>7.5.3.Â Repeat</h3></div></div></div><p>
			   The repeat operator fires when a pattern sub-expression evaluates to true a given number of times. The synopsis is as follows:
		   </p><pre class="synopsis">[<span class="emphasis"><em>match_count</em></span>] <span class="emphasis"><em>repeating_subexpr</em></span></pre><p>
			   The repeat operator is very similar to the <code class="literal">every</code> operator in that it restarts the <span class="emphasis"><em>repeating_subexpr</em></span> pattern sub-expression up to a given number of times.
		   </p><p>
			   <span class="emphasis"><em>match_count</em></span> is a positive number that specifies how often the <span class="emphasis"><em>repeating_subexpr</em></span> pattern sub-expression must evaluate to true before the repeat expression itself evaluates to true, after which the engine may indicate a match.
		   </p><p>
			   For example, this pattern fires when the last of five A events arrives:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[5] A</pre><p>
			   Parenthesis must be used for nested pattern sub-expressions. This pattern fires when the last of a total of any five A or B events arrives:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[5] (A or B)</pre><p>
			   Without parenthesis the pattern semantics change, according to the operator precedence described earlier. This pattern fires when the last of a total of five A events arrives or a single B event arrives, whichever happens first:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[5] A or B</pre><p>
			   Tags can be used to name events in filter expression of pattern sub-expressions. The next pattern looks for an A event followed by a B event, and a second A event followed by a second B event. The output event provides indexed and array properties of the same name:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[2] (a=A -&gt; b=B)</pre><p>
			   Using tags with repeat is further described in <a class="xref" href="#pattern-repeat-tags" title="7.5.4.6.Â Tags and the Repeat Operator">SectionÂ 7.5.4.6, âTags and the Repeat Operatorâ</a>.
		   </p><p>
			   Consider the following pattern that demonstrates the behavior when a pattern sub-expression becomes permanently false:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[2] (a=A and not C)</pre><p>
			   In the case where a C event arrives before 2 A events arrive, the pattern above becomes permanently false.
		   </p><p>
			   Lets add an <code class="literal">every</code> operator to restart the pattern and thus keep matching for all pairs of A events that arrive without a C event in between each pair:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every [2] (a=A and not C)</pre><p>
			   Since pattern matches return multiple A events, your select clause should use tag <code class="literal">a</code> as an array, for example:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select a[0].id, a[1].id from pattern [every [2] (a=A and not C)]</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-repeatuntil"/>7.5.4.Â Repeat-Until</h3></div></div></div><p>
			   The repeat <code class="literal">until</code> operator provides additional control over repeated matching.
		   </p><p>
			   The repeat until operator takes an optional range, a pattern sub-expression to repeat, the <code class="literal">until</code> keyword and a second pattern sub-expression that ends the repetition. The synopsis is as follows:
		   </p><pre class="synopsis">[<span class="emphasis"><em>range</em></span>] <span class="emphasis"><em>repeated_pattern_expr</em></span> until <span class="emphasis"><em>end_pattern_expr</em></span></pre><p>
				Without a <span class="emphasis"><em>range</em></span>, the engine matches the <span class="emphasis"><em>repeated_pattern_expr</em></span> pattern sub-expression until the <span class="emphasis"><em>end_pattern_expr</em></span> evaluates to true, at which time the expression turns true.
			</p><p>
				An optional <span class="emphasis"><em>range</em></span> can be used to indicate the minimum number of times that the <span class="emphasis"><em>repeated_pattern_expr</em></span> pattern sub-expression must become true.
			</p><p>
				The optional <span class="emphasis"><em>range</em></span> can also specify a maximum number of times that <span class="emphasis"><em>repeated_pattern_expr</em></span> pattern sub-expression evaluates to true and retains tagged events. When this number is reached, the engine stops the <span class="emphasis"><em>repeated_pattern_expr</em></span> pattern sub-expression.
			</p><p>
			    The <code class="literal">until</code> keyword is always required when specifying a range and is not required if specifying a fixed number of repeat as discussed in the section before.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-repeatuntil-norange"/>7.5.4.1.Â Unbound Repeat</h4></div></div></div><p>
				In the unbound repeat, without a <span class="emphasis"><em>range</em></span>, the engine matches the <span class="emphasis"><em>repeated_pattern_expr</em></span> pattern sub-expression until the <span class="emphasis"><em>end_pattern_expr</em></span> evaluates to true, at which time the expression turns true. The synopsis is:
			</p><pre class="synopsis"><span class="emphasis"><em>repeated_pattern_expr</em></span> until <span class="emphasis"><em>end_pattern_expr</em></span></pre><p>
				   This is a pattern that keeps looking for A events until a B event arrives:
			   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">A until B</pre><p>
				   Nested pattern sub-expressions must be placed in parenthesis since the <code class="literal">until</code> operator has precedence over most operators. This example collects all A or B events for 10 seconds and places events received in indexed properties 'a' and 'b':
			   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">(a=A or b=B) until timer:interval(10 sec)</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-repeatuntil-range"/>7.5.4.2.Â Bound Repeat Overview</h4></div></div></div><p>
				   The synopsis for the optional <span class="emphasis"><em>range</em></span> qualifier is:
			   </p><pre class="synopsis">[ [<span class="emphasis"><em>low_endpoint</em></span>] : [<span class="emphasis"><em>high_endpoint</em></span>] ]</pre><p>
				   <span class="emphasis"><em>low_endpoint</em></span> is an optional number that appears on the left of a colon (:), after which follows an optional <span class="emphasis"><em>high_endpoint</em></span> number.
			   </p><p>
				   A range thus consists of a <span class="emphasis"><em>low_endpoint</em></span> and a <span class="emphasis"><em>high_endpoint</em></span> in square brackets and separated by a colon (:) characters. Both endpoint values are optional but either one or both must be supplied. The <span class="emphasis"><em>low_endpoint</em></span> can be omitted to denote a range that starts at zero. The <span class="emphasis"><em>high_endpoint</em></span> can be omitted to denote an open-ended range.
			   </p><p>
				   Some examples for valid ranges might be:
			   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[3 : 10]
[:3]    // range starts at zero
[2:]    // open-ended range</pre><p>
				   The <span class="emphasis"><em>low_endpoint</em></span>, if specified, defines the minimum number of times that the <span class="emphasis"><em>repeated_pattern_expr</em></span> pattern sub-expression must become true in order for the expression to become true.
			   </p><p>
				   The <span class="emphasis"><em>high_endpoint</em></span>, if specified, is the maximum number of times that the <span class="emphasis"><em>repeated_pattern_expr</em></span> pattern sub-expression becomes true. If the number is reached, the engine stops the <span class="emphasis"><em>repeated_pattern_expr</em></span> pattern sub-expression.
			   </p><p>
				   In all cases, only at the time that the <span class="emphasis"><em>end_pattern_expr</em></span> pattern sub-expression evaluates to true does the expression become true. If <span class="emphasis"><em>end_pattern_expr</em></span> pattern sub-expression evaluates to false, then the expression evaluates to false.
			   </p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-repeatuntil-range-openended"/>7.5.4.3.Â Bound Repeat - Open Ended Range</h4></div></div></div><p>
				   An open-ended range specifies only a low endpoint and not a high endpoint.
			   </p><p>
				   Consider the following pattern which requires at least three A events to match:
			   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[3:] A until B</pre><p>
				   In the pattern above, if a B event arrives before 3 A events occurred, the expression ends and evaluates to false. 
			   </p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-repeatuntil-range-nolow"/>7.5.4.4.Â Bound Repeat - High Endpoint Range</h4></div></div></div><p>
				   A high-endpoint range specifies only a high endpoint and not a low endpoint.
			   </p><p>
				   In this sample pattern the engine will be looking for a maximum of 3 A events. The expression turns true as soon as a single B event arrives regardless of the number of A events received:
			   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[:3] A until B</pre><p>
				   The next pattern matches when a C or D event arrives, regardless of the number of A or B events that occurred:
			   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[:3] (a=A or b=B) until (c=C or d=D)</pre><p>
				   In the pattern above, if more then 3 A or B events arrive, the pattern stops looking for additional A or B events. The 'a' and 'b' tags retain only the first 3 (combined) matches among A and B events. The output event contains these tagged events as indexed properties.
			   </p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-repeatuntil-range-bounded"/>7.5.4.5.Â Bound Repeat - Bounded Range</h4></div></div></div><p>
				   A bounded range specifies a low endpoint and a high endpoint.
			   </p><p>
				   The next pattern matches after at least one A event arrives upon the arrival of a single B event:
			   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[1:3] a=A until B</pre><p>
				   If a B event arrives before the first A event, then the pattern does not match. Only the first 3 A events are returned by the pattern.
			   </p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-repeat-tags"/>7.5.4.6.Â Tags and the Repeat Operator</h4></div></div></div><p>
				   The tags assigned to events in filter subexpressions within a repeat operator are available for use in filter expressions and also in any EPL clause.
			   </p><p>
					This sample pattern matches 2 A events followed by a B event. Note the filter on B events: only a B event that has a value for the "beta" property that equals any of the "id" property values of the two A events is considered:
			   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[2] A -&gt; B(beta in (a[0].id, a[1].id))</pre><p>
					The next EPL statement returns pairs of A events:
			   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select a, a[0], a[0].id, a[1], a[1].id
from pattern [ every [2] a=A ] </pre><p>
					The <code class="literal">select</code> clause of the statement above showcases different ways of accessing tagged events:
			   </p><div class="itemizedlist"><ul><li><p>
							The tag itself can be used to select an array of underlying events. For example, the 'a' expression above returns an array of underlying events of event type A.
						</p></li><li><p>
							The tag as an indexed property returns the underlying event at that index. For instance, the 'a[0]' expression returns the first underlying A event, or null if no such A event was matched by the repeat operator.
						</p></li><li><p>
							The tag as a nested, indexed property returns a property of the underlying event at that index. For example, the 'a[1].id' expression returns the 'id' property value of the second A event, or null if no such second A event was matched by the repeat operator.
						</p></li></ul></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-repeatuntil-index"/>7.5.4.7.Â Note on Indexed Tags</h4></div></div></div><p>
					You may not use indexed tags defined in the sub-expression to the repeat operator in the same subexpression. For example, in the following pattern the subexpression to the repeat operator is <code class="literal">(a=A() -&gt; b=B(id=a[0].id))</code> and the tag <code class="literal">a</code>  cannot be used in its indexed form in the filter for event B:
			   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// invalid
every [2] (a=A() -&gt; b=B(id=a[0].id))</pre><p>
					You can use tags without an index:
			   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// valid
every [2] (a=A() -&gt; b=B(id=a.id))</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-logical-and"/>7.5.5.Â And</h3></div></div></div><a id="d0e20212" class="indexterm"/><a id="d0e20217" class="indexterm"/><p>
				Similar to the Java &amp;&amp; operator the <code class="literal">and</code> operator requires both nested pattern expressions to turn 
				true before the whole expression turns true (a join pattern).
            </p><p>
				This pattern matches when both an A event and a B event arrive, at the time the last of the two events arrive:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">A and B</pre><p>
				This pattern matches on any sequence of an A event followed by a B event and then a C event followed by a D event, or a C event followed by a D and an A event followed by a B event:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">(A -&gt; B) and (C -&gt; D)</pre><p>
				Note that in an <code class="literal">and</code> pattern expression it is not possible to correlate events based on event property values. For example, this is an invalid pattern:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// This is NOT valid
a=A and B(id = a.id)</pre><p>
				The above expression is invalid as it relies on the order of arrival of events, however in an <code class="literal">and</code> expression the order of events is not specified and events fulfill an <code class="literal">and</code> condition in any order. The above expression can be changed to use the followed-by operator: 
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// This is valid
a=A -&gt; B(id = a.id)
// another example using 'and'...
a=A -&gt; (B(id = a.id) and C(id = a.id))</pre><p>
				Consider a pattern that looks for the same event:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">A and A</pre><p>
				The pattern above fires when a single A event arrives. The first arriving A event triggers a state transition in both the left and the right hand side expression.
            </p><p>
				In order to match after two A events arrive in any order, there are two options to express this pattern. The followed-by operator is one option and the repeat operator is the second option, as the next two patterns show:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">A -&gt; A
// ... or ...
[2] A</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-logical-or"/>7.5.6.Â Or</h3></div></div></div><a id="d0e20265" class="indexterm"/><a id="d0e20270" class="indexterm"/><p>
				Similar to the Java â||â operator the <code class="literal">or</code> operator requires either one of the expressions 
				to turn true before the whole expression turns true.
            </p><p>
			   Look for either an A event or a B event. As always, A and B can itself be nested expressions as well.
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">A or B</pre><p>
				The next EPL outputs all A and B events:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every A or every B</pre><p>
				Elaborating further, the expression <code class="literal">every A or every B</code> is equivalent to <code class="literal">every (A or B)</code>. 
				Prefer <code class="literal">every A or every B</code> as the <code class="literal">every</code> keyword lets the engine know that filters for A and B can remain active.
				Consider the expression <code class="literal">every A or every timer:interval(10 sec)</code> which is not equivalent to <code class="literal">every (A or timer:interval(10 sec))</code>. 
				This is because in the latter expression when an A event arrives the interval restarts.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-logical-not"/>7.5.7.Â Not</h3></div></div></div><a id="d0e20311" class="indexterm"/><a id="d0e20316" class="indexterm"/><p>
				The <code class="literal">not</code> operator negates the truth value of an expression. Pattern expressions prefixed with <code class="literal">not</code> are automatically 
				defaulted to true upon start, and turn permanently false when the expression within turns true.
            </p><p>
				The <code class="literal">not</code> operator is generally used in conjunction with the <code class="literal">and</code> operator or subexpressions as the below examples show.
            </p><p>
				This pattern matches only when an A event is encountered followed by a B event but only if no C event was encountered before either an A event and a B event, counting from the time the pattern is started:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">(A -&gt; B) and not C</pre><p>
				Assume we'd like to detect when an A event is followed by a D event, without any B or C events between the A and D events:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">A -&gt; (D and not (B or C))</pre><p>
				It may help your understanding to discuss a pattern that uses the <code class="literal">or</code> operator and the <code class="literal">not</code> operator together:				
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">a=A -&gt; (b=B or not C)</pre><p>
				In the pattern above, when an A event arrives then the engine starts the subexpression <code class="literal">B or not C</code>. As soon as the subexpression starts, the <code class="literal">not</code> operator turns to true. The <code class="literal">or</code> expression turns true and thus your listener receives an invocation providing the A event in the property 'a'. The subexpression does not end and continues listening for B and C events. Upon arrival of a B event your listener receives a second invocation. If instead a C event arrives, the <code class="literal">not</code> turns permanently false however that does not affect the <code class="literal">or</code> operator (but would end an <code class="literal">and</code> operator).
            </p><p>
				To test for absence of an event, use <code class="literal">timer:interval</code> together with <code class="literal">and not</code> operators. The sample statement reports each 10-second interval during which no A event occurred:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every (timer:interval(10 sec) and not A)</pre><p>
				In many cases the <code class="literal">not</code> operator, when used alone, does not make sense. The following example is invalid and will log a warning when the engine is started:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// not a sensible pattern
(not a=A) -&gt; B(id=a.id)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-temporal-followed-by"/>7.5.8.Â Followed-By</h3></div></div></div><a id="d0e20395" class="indexterm"/><a id="d0e20400" class="indexterm"/><a id="d0e20405" class="indexterm"/><p>
				The followed by <code class="literal">-&gt;</code> operator specifies that first the left hand expression must turn true and only 
				then is the right hand expression evaluated for matching events.
            </p><p>
				Look for an A event and if encountered, look for a B event. As always, A and B can itself be nested event pattern expressions.
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">A -&gt; B</pre><p>
				This is a pattern that fires when 2 status events indicating an error occur one after the other.
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">StatusEvent(status='ERROR') -&gt; StatusEvent(status='ERROR')</pre><p>
				A pattern that takes all A events that are not followed by a B event within 5 minutes:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every A -&gt; (timer:interval(5 min) and not B)</pre><p>
				A pattern that takes all A events that are not preceded by B within 5 minutes:
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every (timer:interval(5 min) and not B -&gt; A)</pre><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-temporal-followed-by-max"/>7.5.8.1.Â Limiting Sub-Expression Count</h4></div></div></div><p>
					The followed-by <code class="literal">-&gt;</code> operator can optionally be provided with an expression that limits the number of sub-expression instances of the right-hand side pattern sub-expression. 
				</p><p>
					The synopsis for the followed-by operator with limiting expression is:
				</p><pre class="synopsis"><span class="emphasis"><em>lhs_expression</em></span> -[<span class="emphasis"><em>limit_expression</em></span>]&gt; <span class="emphasis"><em>rhs_expression</em></span></pre><p>
					Each time the <span class="emphasis"><em>lhs_expression</em></span> pattern sub-expression turns true the pattern engine starts a new <span class="emphasis"><em>rhs_expression</em></span> pattern sub-expression.
					The <span class="emphasis"><em>limit_expression</em></span> returns an integer value that defines a maximum number of pattern sub-expression instances that can simultaneously be present for the same <span class="emphasis"><em>rhs_expression</em></span>.
				</p><p>
					When the limit is reached the pattern engine issues a <code class="literal">com.espertech.esper.client.hook.ConditionPatternSubexpressionMax</code> notification object to any condition handlers registered with the engine as described in <a class="xref" href="#api-condition" title="14.11.Â Condition Handling">SectionÂ 14.11, âCondition Handlingâ</a> and does not start a new pattern sub-expression instance for the right-hand side pattern sub-expression.
				</p><p>
					For example, consider the following pattern which returns for every A event the first B event that matches the <code class="literal">id</code> field value of the A event:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every a=A -&gt; b=B(id = a.id)</pre><p>
					In the above pattern, every time an A event arrives (lhs) the pattern engine starts a new pattern sub-expression (rhs) consisting of a filter for the first B event that has the same value for the <code class="literal">id</code> field as the A event.
				</p><p>
					In some cases your application may want to limit the number of right-hand side sub-expressions because of memory concerns or to reduce output. You may add a limit expression returning an integer value 
					as part of the operator.
				</p><p>
					This example employs the followed-by operator with a limit expression to indicate that maximally 2 filters for B events (the right-hand side pattern sub-expression) may be active at the same time:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every a=A -[2]&gt; b=B(id = a.id)</pre><p>
					Note that the limit expression in the example above is not a limit per value of <code class="literal">id</code> field, but a limit counting all right-hand side pattern sub-expression instances that are managed by that followed-by sub-expression instance.					
				</p><p>
					If your followed-by operator lists multiple sub-expressions with limits, each limit applies to the immediate right-hand side. For example, the pattern below limits the number of filters for B events to 2 and the number of filters for C events to 3:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every a=A -[2]&gt; b=B(id = a.id) -[3]&gt; c=C(id = a.id)</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-temporal-followed-by-engine-max"/>7.5.8.2.Â Limiting Engine-wide Sub-Expression Count</h4></div></div></div><p>
			     Esper allows setting a maximum number of pattern sub-expressions in the configuration, applicable to all followed-by operators of all statements. 
			   </p><p>
			     If your application has patterns in multiple EPL statements and all such patterns should count towards a total number of pattern sub-expression counts, you may consider setting a maximum number of pattern sub-expression instances, engine-wide, via the 
			     configuration described in <a class="xref" href="#config-engine-patterns-max" title="15.4.18.1.Â Followed-By Operator Maximum Subexpression Count">SectionÂ 15.4.18.1, âFollowed-By Operator Maximum Subexpression Countâ</a>.
			   </p><p>
				  When the limit is reached the pattern engine issues a notification object  to any condition handlers registered with the engine as described in <a class="xref" href="#api-condition" title="14.11.Â Condition Handling">SectionÂ 14.11, âCondition Handlingâ</a>. Depending on your configuration the engine can prevent the start of a new pattern sub-expression instance for the right-hand side pattern sub-expression, until pattern sub-expression instances end or statements are stopped or destroyed.
				</p><p>
				  The notification object issued to condition handlers is an instance of <code class="literal">com.espertech.esper.client.hook.ConditionPatternEngineSubexpressionMax</code>. The notification object contains information which statement triggered the limit and the pattern counts per statement for all statements.
				</p><p>
				  For information on static and runtime configuration, please consult <a class="xref" href="#config-engine-patterns-max" title="15.4.18.1.Â Followed-By Operator Maximum Subexpression Count">SectionÂ 15.4.18.1, âFollowed-By Operator Maximum Subexpression Countâ</a>. The limit can be changed and disabled or enabled at runtime via the runtime configuration API.
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-guards"/>7.5.9.Â Pattern Guards</h3></div></div></div><a id="d0e20523" class="indexterm"/><p>
				Guards are where-conditions that control the lifecycle of subexpressions. Custom guard functions can also be used. The section <a class="xref" href="#extension" title="ChapterÂ 17.Â Integration and Extension">ChapterÂ 17, <i>Integration and Extension</i></a> outlines guard plug-in development in greater detail.
			</p><p>
				The pattern guard where-condition has no relationship to the EPL <code class="literal">where</code> clause that filters sets of events.
			</p><p>
				Take as an example the following pattern expression:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">MyEvent where timer:within(10 sec)</pre><p>
				In this pattern the <code class="literal">timer:within</code> guard controls the subexpression that is looking for MyEvent events. The guard terminates the subexpression looking for MyEvent events after 10 seconds after start of the pattern. Thus the pattern alerts only once when the first MyEvent event arrives within 10 seconds after start of the pattern.
			</p><p>
				The <code class="literal">every</code> keyword requires additional discussion since it also controls subexpression lifecycle. Let's add the <code class="literal">every</code> keyword to the example pattern:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every MyEvent where timer:within(10 sec)</pre><p>
				The difference to the pattern without <code class="literal">every</code> is that each MyEvent event that arrives now starts a new subexpression, including a new guard, looking for a further MyEvent event. The result is that, when a MyEvent arrives within 10 seconds after pattern start, the pattern execution will look for the next MyEvent event to arrive within 10 seconds after the previous one.
			</p><p>
				By placing parentheses around the <code class="literal">every</code> keyword and its subexpression, you can have the <code class="literal">every</code> under the control of the guard:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">(every MyEvent) where timer:within(10 sec)</pre><p>
				In the pattern above, the guard terminates the subexpression looking for all MyEvent events after 10 seconds after start of the pattern. This pattern alerts for all MyEvent events arriving within 10 seconds after pattern start, and then stops.
			</p><p>
				Guards do not change the truth value of the subexpression of which the guard controls the lifecycle, and therefore do not cause a restart of the subexpression when used with the <code class="literal">every</code> operator. For example, the next pattern stops returning matches after 10 seconds unless a match occurred within 10 seconds after pattern start:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every ( (A and B) where timer:within(10 sec) )</pre><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-guards-timerwithin"/>7.5.9.1.Â The <code class="literal">timer:within</code> Pattern Guard</h4></div></div></div><a id="d0e20584" class="indexterm"/><a id="d0e20589" class="indexterm"/><p>
					The <code class="literal">timer:within</code> guard acts like a stopwatch. 
					If the associated pattern expression does not turn true within the specified time period it is stopped and permanently false.					
				</p><p>
					The synopsis for <code class="literal">timer:within</code> is as follows:
				</p><pre class="synopsis">timer:within(<span class="emphasis"><em>time_period_expression</em></span>)</pre><p>
					The <span class="emphasis"><em>time_period_expression</em></span> is a time period (see <a class="xref" href="#epl-syntax-time-periods" title="5.2.1.Â Specifying Time Periods">SectionÂ 5.2.1, âSpecifying Time Periodsâ</a>) or an expression providing a number of seconds as a parameter. The interval expression may
					contain references to properties of prior events in the same pattern as well as variables and substitution parameters.
				</p><p>
					This pattern fires if an A event arrives within 5 seconds after statement creation.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">A where timer:within (5 seconds)</pre><p>
					This pattern fires for all A events that arrive within 5 seconds. After 5 seconds, this pattern stops matching even if more A events arrive.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">(every A) where timer:within (5 seconds)</pre><p>
					This pattern matches for any one A or B event in the next 5 seconds.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">( A or B ) where timer:within (5 sec)</pre><p>
					This pattern matches for any 2 errors that happen 10 seconds within each other.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every (StatusEvent(status='ERROR') -&gt; StatusEvent(status='ERROR') where timer:within (10 sec))</pre><p>
					The following guards are equivalent:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">timer:within(2 minutes 5 seconds)
timer:within(125 sec)
timer:within(125)</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-guards-timerwithinmax"/>7.5.9.2.Â The <code class="literal">timer:withinmax</code> Pattern Guard</h4></div></div></div><a id="d0e20642" class="indexterm"/><a id="d0e20647" class="indexterm"/><p>
					The <code class="literal">timer:withinmax</code> guard is similar to the <code class="literal">timer:within</code> guard and acts as a stopwatch that additionally has a counter that counts the number of matches. It ends the subexpression when either the stopwatch ends or the match counter maximum value is reached.
				</p><p>
					The synopsis for <code class="literal">timer:withinmax</code> is as follows:
				</p><pre class="synopsis">timer:withinmax(<span class="emphasis"><em>time_period_expression</em></span>, <span class="emphasis"><em>max_count_expression</em></span>)</pre><p>
					The <span class="emphasis"><em>time_period_expression</em></span> is a time period (see <a class="xref" href="#epl-syntax-time-periods" title="5.2.1.Â Specifying Time Periods">SectionÂ 5.2.1, âSpecifying Time Periodsâ</a>) or an expression providing a number of seconds.
				</p><p>
					The <span class="emphasis"><em>max_count_expression</em></span> provides the maximum number of matches before the guard ends the subexpression.
				</p><p>
					Each parameter expression may also contain references to properties of prior events in the same pattern as well as variables and substitution parameters.
				</p><p>
					This pattern fires for every A event that arrives within 5 seconds after statement creation but only up to the first two A events:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">(every A) where timer:withinmax (5 seconds, 2)</pre><p>
					If the result of the <span class="emphasis"><em>max_count_expression</em></span> is 1, the guard ends the subexpression after the first match and indicates the first match.
				</p><p>
					This pattern fires for the first A event that arrives within 5 seconds after statement creation:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">(every A) where timer:withinmax (5 seconds, 1)</pre><p>
					If the result of the <span class="emphasis"><em>max_count_expression</em></span> is zero, the guard ends the subexpression upon the first match and does no indicate any matches.
				</p><p>
					This example receives every A event followed by every B event (as each B event arrives) until the 5-second subexpression timer ends or X number of B events have arrived (assume X was declared as a variable):
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every A -&gt; (every B) where timer:withinmax (5 seconds, X)</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-guards-while"/>7.5.9.3.Â The <code class="literal">while</code> Pattern Guard</h4></div></div></div><a id="d0e20715" class="indexterm"/><a id="d0e20720" class="indexterm"/><p>
					The <code class="literal">while</code> guard is followed by an expression that the engine evaluates for every match reported by the guard pattern sub-expression. When the expression returns false the pattern sub-expression ends.
				</p><p>
					The synopsis for <code class="literal">while</code> is as follows:
				</p><pre class="synopsis">while (<span class="emphasis"><em>guard_expression</em></span>)</pre><p>
					The <span class="emphasis"><em>guard_expression</em></span> is any expression that returns a boolean true or false. The expression may contain references to properties of prior events in the same pattern as well as variables and substitution parameters.
				</p><p>
					Each time the subexpression indicates a match, the engine evaluates <span class="emphasis"><em>guard_expression</em></span> and if true, passes the match and when false, ends the subexpression.
				</p><p>
					This pattern fires for every A event until an A event arrives that has a value of zero or less for its <code class="literal">size</code> property (assuming A events have an integer <code class="literal">size</code> property).
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">(every a=A) while (a.size &gt; 0)</pre><p>
					Note the parenthesis around the <code class="literal">every</code> subexpression. They ensure that, following precedence rules, the guard applies to the <code class="literal">every</code> operator as well.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-guards-timeparameters"/>7.5.9.4.Â Guard Time Interval Expressions</h4></div></div></div><p>
					The <code class="literal">timer:within</code> and <code class="literal">timer:withinmax</code> guards may be parameterized by an expression that contains one or more references to properties of prior events in the same pattern.
				</p><p>
					As a simple example, this pattern matches every A event followed by a B event that arrives within <code class="literal">delta</code> seconds after the A event: 
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every a=A -&gt; b=B where timer:within (a.delta seconds)</pre><p>
					Herein A event is assumed to have a <code class="literal">delta</code> property that provides the number of seconds to wait for B events. Each arriving A event may have a different value for <code class="literal">delta</code>
					and the guard is therefore parameterized dynamically based on the prior A event received.
				</p><p>
					When multiple events accumulate, for example when using the match-until or repeat pattern elements, an index must be provided:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[2] a=A -&gt; b=B where timer:within (a[0].delta + a[1].delta)</pre><p>
					The above pattern matches after 2 A events arrive followed by a B event within a time interval after the A event that is defined by the sum of the <code class="literal">delta</code> properties of both A events.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-guards-combining"/>7.5.9.5.Â Combining Guard Expressions</h4></div></div></div><p>
					You can combine guard expression by using parenthesis around each subexpression.
				</p><p>
					The below pattern matches for each A event while A events of size greater then zero arrive and only within the first 20 seconds:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">((every a=A) while (a.size &gt; 0)) where timer:within(20)</pre></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="pattern-atoms"/>7.6.Â Pattern Atoms</h2></div></div></div><a id="d0e20815" class="indexterm"/><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-atom-filter"/>7.6.1.Â Filter Atoms</h3></div></div></div><p>
				Filter atoms have been described in section <a class="xref" href="#pattern-filter" title="7.4.Â Filter Expressions in Patterns">SectionÂ 7.4, âFilter Expressions in Patternsâ</a>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-atom-time"/>7.6.2.Â Observer Atoms Overview</h3></div></div></div><p>
		   Observers observe time-based events for which the thread-of-control originates by the engine timer or external timer event. 
		   Custom observers can also be developed that observe timer events or other engine-external application events such as a file-exists check. 
		   The section <a class="xref" href="#extension" title="ChapterÂ 17.Â Integration and Extension">ChapterÂ 17, <i>Integration and Extension</i></a> outlines observer plug-in development in greater detail.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-timer-interval"/>7.6.3.Â Interval (<code class="literal">timer:interval</code>)</h3></div></div></div><a id="d0e20838" class="indexterm"/><a id="d0e20843" class="indexterm"/><p>
				The <code class="literal">timer:interval</code> pattern observer waits for the defined time before the truth value of the observer turns true.
				The observer takes a time period (see <a class="xref" href="#epl-syntax-time-periods" title="5.2.1.Â Specifying Time Periods">SectionÂ 5.2.1, âSpecifying Time Periodsâ</a>) as a parameter, or an expression that returns the number of seconds.
			</p><p>
				The observer may be parameterized by an expression that contains one or more references to properties of prior events in the same pattern, or may also reference variables, substitution parameters or any other expression returning 
				a numeric value.
			</p><p>
				After an A event arrived wait 10 seconds then indicate that the pattern matches.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">A -&gt; timer:interval(10 seconds) </pre><p>
				The pattern below fires every 20 seconds.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every timer:interval(20 sec)</pre><p>
				The next example pattern fires for every A event that is not followed by a B event within 60 seconds after the A event arrived. The B event must have the same "id" property
				value as the A event.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every a=A -&gt; (timer:interval(60 sec) and not B(id=a.id)) </pre><p>
				Consider the next example, which assumes that the A event has a property <code class="literal">waittime</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every a=A -&gt; (timer:interval(a.waittime + 2) and not B(id=a.id))</pre><p>
				In the above pattern the logic waits for 2 seconds plus the number of seconds provided by the value of the <code class="literal">waittime</code> property of the A event.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-timer-at"/>7.6.4.Â Crontab (<code class="literal">timer:at</code>)</h3></div></div></div><a id="d0e20887" class="indexterm"/><a id="d0e20892" class="indexterm"/><p>
				The <code class="literal">timer:at</code> pattern observer is similar in function to the Unix âcrontabâ command. At a specified time the 
				expression turns true. The <code class="literal">at</code> operator can also be made to pattern match at regular intervals by using an <code class="literal">every</code> operator 
				in front of the <code class="literal">timer:at</code> operator. 
			</p><p>
				The syntax is: <code class="literal">timer:at (minutes, hours, days of month, months, days of week [, seconds [, time zone]]).</code>
			</p><p>
				The value for seconds and time zone is optional. Each element allows wildcard <code class="literal">*</code> values. Ranges can be specified 
				by means of lower bounds then a colon â:â then the upper bound. The division operator <code class="literal">*/x</code> can be used to 
				specify that every x<sub>th</sub> value is valid. Combinations of these operators can be used by placing these into square brackets ([]).
			</p><p>
				The <code class="literal">timer:at</code> observer may also be parameterized by an expression that contains one or more references to properties of prior events in the same pattern, or may also reference variables, substitution parameters or any other expression returning a numeric value. The frequency division operator <code class="literal">*/x</code> and parameters lists within brackets ([]) are an exception: they may only contain variables, substitution parameters or numeric values.
			</p><p>
				This expression pattern matches every 5 minutes past the hour.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every timer:at(5, *, *, *, *)</pre><p>
				The below <code class="literal">timer:at</code> pattern matches every 15 minutes from 8am to 5:45pm (hours 8 to 17 at 0, 15, 30 and 45 minutes past the hour) on even numbered days of the month as well as on the 
				first day of the month.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">timer:at (*/15, 8:17, [*/2, 1], *, *)</pre><p>
				The below table outlines the fields, valid values and keywords available for each field:
			</p><div class="table"><a id="d0e20948"/><p class="title"><b>TableÂ 7.5.Â Crontab Fields</b></p><div class="table-contents"><table summary="Crontab Fields" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th>Field Name</th><th>Mandatory?</th><th>Allowed Values</th><th>Additional Keywords</th></tr></thead><tbody><tr><td>Minutes</td><td>yes</td><td>0 - 59</td><td>Â </td></tr><tr><td>Hours</td><td>yes</td><td>0 - 23</td><td>Â </td></tr><tr><td>Days Of Month</td><td>yes</td><td>1 - 31</td><td>last, weekday, lastweekday</td></tr><tr><td>Months</td><td>yes</td><td>1 - 12</td><td>Â </td></tr><tr><td>Days Of Week</td><td>yes</td><td>0 (Sunday) - 6 (Saturday)</td><td>last</td></tr><tr><td>Seconds</td><td>no (required if specifying a time zone)</td><td>0 - 59</td><td>Â </td></tr><tr><td>Time Zone</td><td>no</td><td>any string (not validated, see TimeZone javadoc)</td><td>Â </td></tr></tbody></table></div></div><br class="table-break"/><p>
				The keyword <code class="literal">last</code> used in the days-of-month field means the last day of the month (current month). To specify the last day of another month, you must provide a value for the month field. For example: <code class="literal">timer:at(*, *, last,2,*)</code> is the last day of February. 
			</p><p>
				The <code class="literal">last</code> keyword in the day-of-week field by itself simply means Saturday. If used in the day-of-week field after another value, it means "the last xxx day of the month" - for example "5 last" means "the last Friday of the month". 
				So the last Friday of the current month will be: <code class="literal">timer:at(*, *, *, *, 5 last)</code>. And the last Friday of June: <code class="literal">timer:at(*, *, *, 6, 5 last)</code>.
			</p><p>
				The keyword <code class="literal">weekday</code> is used to specify the weekday (Monday-Friday) nearest the given day. Variant could include month like in: <code class="literal">timer:at(*, *, 30 weekday, 9, *)</code> which for year 2007 is Friday September 28th (no jump over month).
			</p><p>
				The keyword <code class="literal">lastweekday</code> is a combination of two parameters, the <code class="literal">last</code> and the <code class="literal">weekday</code> keywords. A typical example could be: <code class="literal">timer:at(*, *, *, lastweekday, 9, *)</code> which will define Friday September 28th (example year is 2007).
			</p><p>
				The time zone is a string-type value that specifies the time zone of the schedule. You must specify a value for seconds when specifying a time zone. Esper relies on the <code class="literal">java.util.TimeZone</code> to interpret the time zone value. Note that <code class="literal">TimeZone</code> does not validate time zone strings. 
			</p><p>
				The following <code class="literal">timer:at</code> pattern matches at 5:00 pm Pacific Standard Time (PST): 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">timer:at (0, 17, *, *, *, *, 'PST')</pre><p>
				Any expression may occur among the parameters. This example invokes a user-defined function <code class="literal">computeHour</code> to return an hour:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">timer:at (0, computeHour(), *, *, *, *)</pre><p>
				The following restrictions apply to crontab parameters:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						It is not possible to specify both Days Of Month and Days Of Week.
					</p></li></ul></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-timer-at-every"/>7.6.4.1.Â timer:at and the <code class="literal">every</code> Operator</h4></div></div></div><p>
					When using <code class="literal">timer:at</code> with the <code class="literal">every</code> operator the crontab-like timer computes the next time at which the timer should fire based on the specification and the current time. When using <code class="literal">every</code>, the current time is the time the timer fired or the statement start time if the timer has not fired once.
				</p><p>
					For example, this pattern fires every 1 minute starting at 1:00pm and ending at 1:59pm, every day:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every timer:at(*, 13, *, *, *)</pre><p>
					Assume the above statement gets started at 1:05pm and 20 seconds. In such case the above pattern fires every 1 minute starting at 1:06pm and ending at 1:59pm for that day and 1:00pm to 1:59pm every following day.
				</p><p>
					To get the pattern to fire only once at 1pm every day, explicitly specify the minute to start. The pattern below fires every day at 1:00pm:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every timer:at(0, 13, *, *, *)</pre><p>
					By specifying a second resolution the timer can be made to fire every second, for instance:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every timer:at(*, *, *, *, *, *)</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="pattern-timer-schedule"/>7.6.5.Â Schedule (<code class="literal">timer:schedule</code>)</h3></div></div></div><a id="d0e21131" class="indexterm"/><a id="d0e21136" class="indexterm"/><p>
				The <code class="literal">timer:schedule</code> observer is a flexible observer for scheduling.
			</p><p>
				The observer implements relevant parts of the ISO 8601 specification however it is not necessary to use ISO 8601 formats.
				The ISO 8601 standard is an international standard covering the exchange of date and time-related data.
				The standard specifies a date format, a format for time periods and a format for specifying the number of repetitions.
				Please find more information on ISO 8601 at <a class="link" href="http://en.wikipedia.org/wiki/ISO_8601" target="">Wikipedia</a>.
			</p><p>
				The observer takes the following named parameters:
			</p><div class="table"><a id="d0e21153"/><p class="title"><b>TableÂ 7.6.Â Timer Schedule Parameters</b></p><div class="table-contents"><table summary="Timer Schedule Parameters" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">iso</code></td><td>An expression returning a string-type ISO 8601 formatted date, time period and/or number of repetitions.</td></tr><tr><td><code class="literal">repetitions</code></td><td>An expression returning a numeric value that specifies a number of repetitions. Provide a value of <code class="literal">-1</code> for an unlimited number of repetitions.
							If unspecified, the number of repetitions is one.</td></tr><tr><td><code class="literal">date</code></td><td>An expression returning a string-type ISO 8601 formatted date, or an expression that returns any of these types: 
							<code class="literal">long</code>, <code class="literal">Date</code>, <code class="literal">Calendar</code>, <code class="literal">LocalDateTime</code>, <code class="literal">ZonedDateTime</code>.</td></tr><tr><td><code class="literal">period</code></td><td>An expression returning a time period, see <a class="xref" href="#epl-syntax-time-periods" title="5.2.1.Â Specifying Time Periods">SectionÂ 5.2.1, âSpecifying Time Periodsâ</a></td></tr></tbody></table></div></div><br class="table-break"/><p>
				In summary, for example, the below pattern schedules two callbacks: The first callback 2008-03-01 at 13:00:00 UTC and the second callback on 2009-05-11 at 15:30:00 UTC.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern[every timer:schedule(iso: 'R2/2008-03-01T13:00:00Z/P1Y2M10DT2H30M')]</pre><p>
				The number of repetitions, date and period can be separated and do not have to be ISO 8601 strings, allowing each part to be an own expression.
			</p><p>
				This example specifies separate expressions. The equivalent schedule to the above example is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern[every timer:schedule(repetitions: 2, date: '2008-03-01T13:00:00Z', period: 1 year 2 month 10 days 2 hours 30 minutes)]</pre><p>
				When providing the <code class="literal">iso</code> parameter, it must be the only parameter. The <code class="literal">repetitions</code> parameter is only allowed in conjunction with other parameters.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-timer-schedule-specify"/>7.6.5.1.Â Specifying ISO8601 Dates, Periods and Repetition</h4></div></div></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="pattern-timer-schedule-date"/>7.6.5.1.1.Â Specifying Dates</h5></div></div></div><p>
					   The complete document for ISO 8601, the international standard for the representation of dates and times, can be found at 
					   <a class="link" href="http://www.w3.org/TR/NOTE-datetime" target="">http://www.w3.org/TR/NOTE-datetime</a>. 
				   </p><p>
					   The supported ISO 8601 date formats are:
				   </p><div class="table"><a id="d0e21241"/><p class="title"><b>TableÂ 7.7.Â ISO 8601 Period Examples</b></p><div class="table-contents"><table summary="ISO 8601 Period Examples" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Description</th><th>Format</th><th>Example</th></tr></thead><tbody><tr><td>Complete date plus hours, minutes and seconds (zero milliseconds, zero microseconds):</td><td><code class="literal">YYYY-MM-DDThh:mm:ssTZD</code></td><td>
										<p><code class="literal">1997-07-16T19:20:30Z</code></p> <p>(i.e. GMT+00:00, UTC)</p>
										<p><code class="literal">1997-07-16T19:20:30+01:00</code></p> <p>(i.e. GMT+01:00)</p>
										<p><code class="literal">1997-07-16T19:20:30</code></p> <p>(i.e. local time zone)</p>
									</td></tr><tr><td>Complete date plus hours, minutes, seconds and a decimal fraction of a second (zero microseconds)</td><td><code class="literal">YYYY-MM-DDThh:mm:ss.sTZD</code></td><td>
										<p><code class="literal">1997-07-16T19:20:30.45Z</code></p> <p>(i.e. GMT+00:00, UTC)</p>
										<p><code class="literal">1997-07-16T19:20:30.45+01:00</code></p> <p>(i.e. GMT+01:00)</p>
										<p><code class="literal">1997-07-16T19:20:30.45</code></p> <p>(i.e. local time zone)</p>
									</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="pattern-timer-schedule-periods"/>7.6.5.1.2.Â Specifying Periods</h5></div></div></div><p>
					   In ISO 8601, periods are specified by a <code class="literal">P</code> and an optional year, month, week and day count. If there is a time part, add <code class="literal">T</code> and optionally provide the hour, minute and seconds. The format does not have any whitespace. The synopsis is:
				   </p><pre class="synopsis">P [<span class="emphasis"><em>n</em></span>Y] [<span class="emphasis"><em>n</em></span>M] [<span class="emphasis"><em>n</em></span>W] [<span class="emphasis"><em>n</em></span>D] [T [<span class="emphasis"><em>n</em></span>H [<span class="emphasis"><em>n</em></span>M] [<span class="emphasis"><em>n</em></span>S] ]</pre><p>
					   The <code class="literal">Y</code> stands for years, the <code class="literal">M</code> for month as well as minutes, the <code class="literal">W</code> for weeks and the D for days.
					   The <code class="literal">H</code> stands for hours and the <code class="literal">S</code> means seconds.
				   </p><div class="table"><a id="d0e21366"/><p class="title"><b>TableÂ 7.8.Â ISO 8601 Period Examples</b></p><div class="table-contents"><table summary="ISO 8601 Period Examples" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Example</th><th>Description</th></tr></thead><tbody><tr><td>P10M</td><td>10 months</td></tr><tr><td>PT10M</td><td>10 minutes</td></tr><tr><td>P1Y3M12D</td><td>1 year, 3 month and 12 days</td></tr><tr><td>P10DT5M</td><td>10 days and 5 minutes</td></tr><tr><td>P1Y2M3DT4H5M6S</td><td>1 year, 2 month, 3 days, 4 hours, 5 minutes, 6 seconds</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="pattern-timer-schedule-repetition"/>7.6.5.1.3.Â Specifying Repetitions</h5></div></div></div><p>
					   In ISO 8601, repetition is specified by an <code class="literal">R</code> and an optional number of repetitions without any white space. The synopsis is:
				   </p><pre class="synopsis">R [<span class="emphasis"><em>nn</em></span>]</pre><p>
					   For example <code class="literal">R5</code> means 5 repetitions, and just <code class="literal">R</code> means unlimited repetitions.
				   </p></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-timer-schedule-scheduleatdate"/>7.6.5.2.Â Scheduling a Callback to Occur for a Given Date (Non-Repeating)</h4></div></div></div><p>
				   To instruct the engine to observe a date, provide a date to the observer. 
				   When time advances to the specified date, the pattern subexpression fires.
			   </p><p>
					For example, this pattern fires once when time reaches 2012-10-01 at 5:52:00 (UTC):
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">timer:schedule(iso:'2012-10-01T05:52:00Z')</pre><p>
					This equivalent pattern specifies separate expressions:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every timer:schedule(date: '2012-10-01T05:52:00Z')</pre><p>
					When the observer fires, the pattern subexpression becomes permanently false and the engine does not restart the observer.
				</p><p>
					If the provided date is a past date as compared to engine time, the pattern subexpression becomes permanently false on start.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-timer-schedule-scheduleafterperiod"/>7.6.5.3.Â Scheduling a Callback to Occur After a Given Period (Non-Repeating)</h4></div></div></div><p>
				   To instruct the engine to observe a period starting from the current engine time, provide a period.
				   When time advances to the current engine time plus the specified period, the pattern subexpression fires.
			   </p><p>
					Assuming the current engine time is 2012-10-01 at 5:52:00 (UTC), this pattern fires once when time reaches 5:53:00:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">timer:schedule(iso:'PT1M')</pre><p>
					This equivalent pattern specifies separate expressions:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every timer:schedule(period: 1 minute)</pre><p>
					When the observer fires, the pattern subexpression becomes permanently false and the engine does not restart the observer.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-timer-schedule-scheduleafterdateandperiod"/>7.6.5.4.Â Scheduling a Callback to Occur After a Given Date and Period (Non-Repeating)</h4></div></div></div><p>
				   To instruct the engine to observe a period starting from a given date, provide a date and a period.
				   When time advances to the date plus the specified period, the pattern subexpression fires.
			   </p><p>
					Assuming the current engine time is 5:52:00 (UTC), this pattern fires once when time reaches 2012-10-01 at 5:53:00:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">timer:schedule(iso:'2012-10-01T05:52:00Z/PT1M')</pre><p>
					This equivalent pattern specifies separate expressions:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every timer:schedule(date: '2012-10-01T05:52:00Z', period: 1 minute)</pre><p>
					When the observer fires, the pattern subexpression becomes permanently false and the engine does not restart the observer.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-timer-schedule-scheduleperiodicallyanchorenginetime"/>7.6.5.5.Â Scheduling a Callback to Occur Periodically (Repeating)</h4></div></div></div><p>
				   To instruct the engine to observe a period starting from the current engine time and repeatedly thereafter anchored to current engine time, 
				   provide a number of repetitions and a period (see synopsis provided earlier), like this:
			   </p><pre class="synopsis"><span class="emphasis"><em>repetitions</em></span>/<span class="emphasis"><em>period</em></span></pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">timer:schedule(iso: 'R2/PT1M')</pre><p>
				   When time advances to the current engine time plus the specified period, the pattern subexpression fires for the first time.
				   Repeatedly when time advances to the current engine time plus a multiple of the specified period, the pattern subexpression fires, up to the number of repetitions specified (if any). 
			   </p><p>
					This pattern specifies a repetition of two. Assuming the current engine time is 2012-10-01 at 5:52:00 (UTC), it fires when time reaches 5:53:00 and again when time reaches 5:54:00:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every timer:schedule(iso: 'R2/PT1M')</pre><p>
					This equivalent pattern specifies separate expressions:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every timer:schedule(repetitions: 2, period: 1 minute)</pre><p>
					All schedule computations are relative to (i.e. anchored to) current engine time at observer start.
					Once the number of repetitions is reached relative to the current engine time at observer start, the pattern subexpression becomes permanently false and the engine does not restart the observer.
				</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
						Please specify the <code class="literal">every</code> operator for repeating schedules.
					</p></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-timer-schedule-scheduleperiodicallyanchordate"/>7.6.5.6.Â Scheduling a Callback to Occur Periodically Starting From a Given Date (Repeating)</h4></div></div></div><p>
				   To instruct the engine to observe a period starting from a given date and repeatedly thereafter anchored to the provide date, 
				   provide a number of repetitions and a date and a period (see synopsis provided earlier), like this:
			   </p><pre class="synopsis"><span class="emphasis"><em>repetitions</em></span>/<span class="emphasis"><em>date</em></span>/<span class="emphasis"><em>period</em></span></pre><p>
				   When time advances to the date, the pattern subexpression fires for the first time.
				   You may specify a date older than current engine time as an anchor.
				   Repeatedly when time advances to the date plus a multiple of the specified period, the pattern subexpression fires, up to the number of repetitions specified (if any). 
			   </p><p>
					This pattern specifies a repetition of two. The pattern fires when time reaches 2012-10-01 at 5:52:00 (UTC) and again when time reaches 5:53:00.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every timer:schedule(iso: 'R2/2012-10-01T05:52:00Z/PT1M')</pre><p>
					This equivalent pattern specifies separate expressions:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every timer:schedule(repetitions: 2, date:'2012-10-01T05:52:00Z', period: 1 minute)</pre><p>
					All schedule computations are relative to (i.e. anchored to) the provided date.
					Once the number of repetitions is reached relative to the provided date, the pattern subexpression becomes permanently false and the engine does not restart the observer.
				</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
						Please specify the <code class="literal">every</code> operator for repeating schedules.
					</p></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-timer-schedule-examples"/>7.6.5.7.Â Additional Usage Examples</h4></div></div></div><p>
				   The pattern below outputs every <code class="literal">MyEvent</code> event after the MyEvent arrived and upon the next round 15 seconds:
			   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern[every e=MyEvent -&gt; timer:schedule(iso: 'R/1980-01-01T00:00:00Z/PT15S']</pre><p>
				   Assuming a <code class="literal">MyEvent</code> event arrives on 2012-10-01 at 5:51:07 the output for that event occurs at 5:51:15.
			   </p><p>
				   All parameters can be expressions. The <code class="literal">date</code> parameter could, for example, be used with <code class="literal">current_timestamp</code>
				   to compute a schedule:
			   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern[date: current_timestamp.withTime(9, 0, 0, 0)]</pre><p>
				   The above statement fires only at 9am and not after 9am on the same day (one repetition).
			   </p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-timer-schedule-equivalent"/>7.6.5.8.Â Samples With Equivalent EPL</h4></div></div></div><p>
				   The following EPL is equivalent:
			   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern[every timer:schedule(iso: 'R2/2008-03-01T13:00:00Z/P1Y2M10DT2H30M')]</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern[every (timer:schedule(iso: '2008-03-01T13:00:00Z') or timer:schedule(iso: '2009-05-11T15:30:00Z'))]</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern[every (timer:schedule(iso: '2008-03-01T13:00:00Z') or timer:schedule(iso: '2008-03-01T13:00:00Z/P1Y2M10DT2H30M'))]</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="pattern-timer-schedule-implementation"/>7.6.5.9.Â Implementation Notes</h4></div></div></div><p>
				   Your environment should have the JAXB date parser available. The engine uses <code class="literal">javax.xml.datatype.DatatypeFactory.newInstance().newXMLGregorianCalendar(dateText).toGregorianCalendar()</code> for date parsing.
			   </p></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="pattern-walkthrough"/>7.7.Â Event Pattern Walkthrough</h2></div></div></div><a id="d0e21584" class="indexterm"/><p>
			This walkthrough discusses the following pattern:
         </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every a=LoginEvent -&gt; (timer:interval(1 min) and not LogoutEvent(userId=a.userId))]</pre><p>
			This pattern detects when a <code class="literal">LoginEvent</code> is not followed by a <code class="literal">LogoutEvent</code> arriving within 1 minute of the <code class="literal">LoginEvent</code>.
		</p><p>
			The engine parses the pattern expression and builds a expression tree. At the root of the expression tree, for this specific pattern, is the followed-by (<code class="literal">-&gt;</code>) operator as followed-by has the lowest precedence (see precedence).
		</p><p>
			The pattern expression tree looks like this.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
Followed-by operator (-&gt;)
  |
  | ---- Every
  |       |
  |       | ---- a=LoginEvent
  |
  | ---- And
          |
          | ---- timer:interval(1 min)
          |                  
          | ---- Not
                 |
                 | ---- LogoutEvent(userId=a.userId)</pre><p>
		  The followed-by  (<code class="literal">-&gt;</code>) operator has two subexpressions that it manages, the <code class="literal">Every</code> expression that itself has the <code class="literal">a=LoginEvent</code> subexpression as a child, and the <code class="literal">And</code> expression that itself has two subexpressions as children.
		</p><p>
			When the engine activates a pattern or pattern subexpression, it activates it from a top-down direction. In this example the engine activates the followed-by  (<code class="literal">-&gt;</code>) expression.
			The followed-by expression activates only its own left-most subexpression, which is the <code class="literal">Every</code> expression. The <code class="literal">Every</code> expression in turn activates the <code class="literal">a=LoginEvent</code> subexpression which registers a filter looking for a <code class="literal">LoginEvent</code> in the global filter index (see <a class="xref" href="#processingmodel_indexes_filterindexes" title="2.18.2.Â Filter Indexes">SectionÂ 2.18.2, âFilter Indexesâ</a>).
		</p><p>
			In this example, the <code class="literal">And</code> subexpression and its subexpressions do not get activated. Therefore after this pattern initially activates there is no 
			filter active time looking for <code class="literal">LogoutEvent</code> event and there is no time tracking of any kind at this point.
		</p><p>
			Let time t<sub>0</sub> be the time of EPL statement creation. As discussed, upon creation of the EPL statement the engine activates the pattern subexpression <code class="literal">every a=LoginEvent</code> only. At this time there is 1 active subexpression:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					<code class="literal">every a=LoginEvent</code>
				</p></li></ol></div><p>
		  As you can see, the tree of active subexpressions (the tree of states) is not the same as the tree of expressions. After the pattern activated there are no active subexpressions (no states) for the <code class="literal">And</code>-part of the example expression tree.
		</p><p>
			Let's assume that at time t<sub>1</sub> a <code class="literal">LoginEvent</code> with user id 10 arrives. 
			This causes the <code class="literal">a=LoginEvent</code> subexpression to become true. In turn, this causes the <code class="literal">Every</code> subexpression to become true. This causes the left-hand-side of the followed-by subexpression to become true. This in turn causes activation of the <code class="literal">And</code> subexpression.
		</p><p>
			The activation of the <code class="literal">And</code>-subexpression causes activation of both <code class="literal">timer:interval(1 min)</code> (from t<sub>1</sub>) and the <code class="literal">Not</code>-subexpression.
			The activation of the <code class="literal">And</code>-subexpression registers a filter looking for a <code class="literal">LogoutEvent</code> that has a user id value of 10 in the global filter index
			and registers a timer callback for t<sub>1</sub>+1 minute.
		</p><p>
		  The engine does not terminate the subexpression <code class="literal">a=LoginEvent</code> as it lives under an <code class="literal">Every</code> operator which means it should keep looking for 
		  more <code class="literal">LoginEvent</code> events.
		</p><p>
			There now are 2 active subexpressions:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					<code class="literal">every a=LoginEvent</code>
				</p></li><li><p>
					<code class="literal">timer:interval(t1+1 min) and not LogoutEvent(userId=10)</code>
				</p></li></ol></div><p>
			Let's assume that at time t<sub>2</sub> another <code class="literal">LoginEvent</code> with user id 20 arrives (assume t<sub>2</sub> â t<sub>1</sub> &lt; 1 min). 
			This again causes the <code class="literal">a=LoginEvent</code> subexpression to become true. In turn, this causes the <code class="literal">Every</code> subexpression to become true. This causes the left-hand-side of the followed-by subexpression to become true. This in turn causes activation of the <code class="literal">And</code> subexpression.
		</p><p>
			The activation of the <code class="literal">And</code>-subexpression causes activation of both <code class="literal">timer:interval(1 min)</code> (from t<sub>2</sub>) and the <code class="literal">Not</code>-subexpression.
			The activation of the <code class="literal">And</code>-subexpression registers a filter looking for a <code class="literal">LogoutEvent</code> that has a user id value of 20 in the global filter index 
			and registers a timer callback for t<sub>2</sub>+1 minute.
		</p><p>
			There now are 3 active subexpressions:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					<code class="literal">every a=LoginEvent</code>
				</p></li><li><p>
					<code class="literal">timer:interval(t1+1 min) and not LogoutEvent(userId=10)</code>
				</p></li><li><p>
					<code class="literal">timer:interval(t2+1 min) and not LogoutEvent(userId=20)</code>
				</p></li></ol></div><p>
			In this scenario at time t<sub>3</sub> one minute has passed since t<sub>1</sub> and a matching <code class="literal">LogoutEvent</code> was not received.
		</p><p>
			The subexpression <code class="literal">timer:interval(t1+1 min)</code> becomes true. In turn, this causes the <code class="literal">And</code>-subexpression to become true as the <code class="literal">Not</code>-subexpression is already true on start. In turn, this causes the followed-by subexpression to become true. In turn, this causes an output of the pattern match. 
		</p><p>
		    The engine terminates the subexpression <code class="literal">not LogoutEvent(userId=10)</code> which unregisters the filter looking for a <code class="literal">LogoutEvent</code> that has a user id value of 10 from the global filter index.
		</p><p>
			There now are 2 active subexpressions:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					<code class="literal">every a=LoginEvent</code>
				</p></li><li><p>
					<code class="literal">timer:interval(t2+1 min) and not LogoutEvent(userId=20)</code>
				</p></li></ol></div><p>
			Let's assume that at time t<sub>4</sub> a <code class="literal">LogoutEvent</code> with user id 20 arrives (assume t<sub>4</sub> â t<sub>2</sub> &lt; 1 min). 
			This again causes the <code class="literal">LogoutEvent(userId=20)</code> subexpression to become true. In turn, this causes the <code class="literal">Not</code> subexpression to become permanently false (as <code class="literal">Not</code> reverses the truth value). This causes the <code class="literal">And</code>-subexpression to become permanently false. 
			This causes the pattern subexpression <code class="literal">timer:interval(t2+1 min) and not LogoutEvent(userId=20)</code> to terminate which causes the timer callback t<sub>2</sub>+1 minute to unregister.
		</p><p>
			Finally there is 1 active subexpression remaining:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					<code class="literal">every a=LoginEvent</code>
				</p></li></ol></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="match-recognize"/>ChapterÂ 8.Â EPL Reference: Match Recognize</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#match-recognize-intro">8.1. Overview</a></span></dt><dt><span class="sect1"><a href="#match-recognize-compare-pattern">8.2. Comparison of Match Recognize and EPL Patterns</a></span></dt><dt><span class="sect1"><a href="#match-recognize-syntax">8.3. Syntax</a></span></dt><dd><dl><dt><span class="sect2"><a href="#match-recognize-syntax-example">8.3.1. Syntax Example</a></span></dt></dl></dd><dt><span class="sect1"><a href="#match-recognize-patternops">8.4. Pattern and Pattern Operators</a></span></dt><dd><dl><dt><span class="sect2"><a href="#match-recognize-patternops-precedence">8.4.1. Operator Precedence</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-concatenation">8.4.2. Concatenation</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-alternation">8.4.3. Alternation</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-quantifiers">8.4.4. Quantifiers Overview</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-permutation">8.4.5. Permutations</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-singletonvars">8.4.6. Variables Can Be Singleton or Group</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-iterator">8.4.7. Eliminating Duplicate Matches</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-quantifiers-reluctant">8.4.8. Greedy or Reluctant</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-quantifiers-oneormore">8.4.9. Quantifier - One or More (+ and +?)</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-quantifiers-zeroormore">8.4.10. Quantifier - Zero or More (* and *?)</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-quantifiers-zeroorone">8.4.11. Quantifier - Zero or One (? and ??)</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-quantifiersrepeat-exactlyn">8.4.12. Repetition - Exactly N Matches</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-quantifiersrepeat-n_or_more">8.4.13. Repetition - N or More Matches</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-quantifiersrepeat-between_n_and_m">8.4.14. Repetition - Between N and M Matches</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-quantifiersrepeat-">8.4.15. Repetition - Between Zero and M Matches</a></span></dt><dt><span class="sect2"><a href="#match-recognize-patternops-repeat-equiv">8.4.16. Repetition Equivalence</a></span></dt></dl></dd><dt><span class="sect1"><a href="#match-recognize-define">8.5. Define Clause</a></span></dt><dd><dl><dt><span class="sect2"><a href="#match-recognize-define-prev">8.5.1. The Prev Operator</a></span></dt></dl></dd><dt><span class="sect1"><a href="#match-recognize-measure">8.6. Measure Clause</a></span></dt><dt><span class="sect1"><a href="#match-recognize-datawindow">8.7. Datawindow-Bound</a></span></dt><dt><span class="sect1"><a href="#match-recognize-interval">8.8. Interval</a></span></dt><dt><span class="sect1"><a href="#match-recognize-intervalorterminated">8.9. Interval-or-Terminated</a></span></dt><dt><span class="sect1"><a href="#match-recognize-variant">8.10. Use With Different Event Types</a></span></dt><dt><span class="sect1"><a href="#match-recognize-state-max">8.11. Limiting Engine-Wide State Count</a></span></dt><dt><span class="sect1"><a href="#match-recognize-limitations">8.12. Limitations</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="match-recognize-intro"/>8.1.Â Overview</h2></div></div></div><a id="d0e21899" class="indexterm"/><p>
			Using <span class="emphasis"><em>match recognize</em></span> patterns are defined in the familiar syntax of regular expressions. 
		</p><p>
			The match recognize syntax presents an alternative way to specify pattern detection as compared to the EPL pattern language described in the previous chapter. A comparison of match recognize and EPL patterns is below.
		</p><p>
			The match recognize syntax is a proposal for incorporation into the SQL standard. It is thus subject to change as the standard evolves and finalizes (it has not finalized yet). Please consult "row-pattern-recogniton-11-public.pdf" for further information.
		</p><p>
			You may be familiar with regular expressions in the context of finding text of interest in a string, such as particular characters, words, or patterns of characters. Instead of matching characters, match recognize matches sequences of events of interest.
		</p><p>
			Esper can apply match-recognize patterns in real-time upon arrival of new events in a stream of events (also termed incrementally,  streaming or continuous). Esper can also match patterns on-demand via the <code class="literal">iterator</code> pull-API, if specifying a named window or data window on a stream (tables cannot be used in the <code class="literal">from</code>-clause with match-recognize). The engine maintains state for partial pattern matches and match-recognize patterns are therefore stateful constructs.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="match-recognize-compare-pattern"/>8.2.Â Comparison of Match Recognize and EPL Patterns</h2></div></div></div><a id="d0e21926" class="indexterm"/><p>
			This section compares pattern detection via match recognize and via the EPL pattern language.
         </p><div class="table"><a id="d0e21933"/><p class="title"><b>TableÂ 8.1.Â Comparison Match Recognize to EPL Patterns</b></p><div class="table-contents"><table summary="Comparison Match Recognize to EPL Patterns" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Category</th><th>EPL Patterns</th><th>Match Recognize</th></tr></thead><tbody><tr><td>Purpose</td><td>Pattern detection in sequences of events.</td><td>Same.</td></tr><tr><td>Standards</td><td>Not standardized, similar to Rapide pattern language.</td><td>Proposal for incorporation into the SQL standard.</td></tr><tr><td>Real-time Processing</td><td>Yes.</td><td>Yes.</td></tr><tr><td>On-Demand query via Iterator</td><td>No.</td><td>Yes.</td></tr><tr><td>Language</td><td>Nestable expressions consisting of boolean <code class="literal">AND</code>, <code class="literal">OR</code>, <code class="literal">NOT</code> and time or arrival-based constructs such as <code class="literal">-&gt;</code> (followed-by), <code class="literal">timer:within</code> and <code class="literal">timer:interval</code>.</td><td>Regular expression consisting of variables each representing conditions on events.</td></tr><tr><td>Event Types</td><td>An EPL pattern may react to multiple different types of events.</td><td>The input is a single type of event (unless used with variant streams).</td></tr><tr><td>Data Window Interaction</td><td>Disconnected, i.e. an event leaving a data window does not change pattern state.</td><td>Connected, i.e. an event leaving a data window removes the event from match selection.</td></tr><tr><td>Semantic Evaluation</td><td>Truth-value based: A EPL pattern such as <code class="literal">(A and B) </code> can fire when a single event arrives that satisfies both A and B conditions.</td><td>Sequence-based: A regular expression <code class="literal">(A B)</code> requires at least two events to match.</td></tr><tr><td>Time Relationship Between Events</td><td>The <code class="literal">timer:within</code>, <code class="literal">timer:interval</code> and <code class="literal">NOT</code> operator can expressively search for absence of events or other more complex timing relationships.</td><td>Some support for detecting absence of events using the <code class="literal">interval</code> clause.</td></tr><tr><td>Extensibility</td><td>Custom pattern objects, user-defined functions.</td><td>User-defined functions, custom aggregation functions.</td></tr><tr><td>Memory Use</td><td>Likely between 500 bytes to 2k per open sequence, depends on pattern.</td><td>Likely between 100 bytes to 1k per open sequence, depends on pattern.</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="match-recognize-syntax"/>8.3.Â Syntax</h2></div></div></div><p>
			The synopsis is as follows:
        </p><pre class="synopsis">match_recognize (
  [ partition by <span class="emphasis"><em>partition_expression</em></span> [, <span class="emphasis"><em>partition_expression</em></span>] [,...]  ]
  measures  <span class="emphasis"><em>measure_expression</em></span> <code class="literal">as</code> <span class="emphasis"><em>col_name</em></span> [, <span class="emphasis"><em>measure_expression</em></span> <code class="literal">as</code> <span class="emphasis"><em>col_name</em></span> ] [,...]
  [ all matches ]
  [ after match skip (past last row | to next row | to current row) ]
  pattern ( <span class="emphasis"><em>variable_regular_expr</em></span> [, <span class="emphasis"><em>variable_regular_expr</em></span>] [,...] )
  [ interval <span class="emphasis"><em>time_period</em></span> [or terminated] ]
  [ define  <span class="emphasis"><em>variable</em></span> as <span class="emphasis"><em>variable_condition</em></span> [, <span class="emphasis"><em>variable</em></span> as <span class="emphasis"><em>variable_condition]</em></span>  [,...] ]
)</pre><p>
			The <code class="literal">match_recognize</code> keyword starts the match recognize definition and occurs right after the <code class="literal">from</code> clause in an EPL <code class="literal">select</code> statement. It is followed by parenthesis that surround the match recognize definition.
        </p><p>
			<code class="literal">Partition by</code> is optional and may be used to specify that events are to be partitioned by one or more event properties or expressions. If there is no <code class="literal">Partition by</code> then all rows of the table constitute a single partition. The regular expression applies to events in the same partition and not across partitions.
        </p><p>
			The <code class="literal">measures</code> clause defines columns that contain expressions over the pattern variables. The expressions can reference partition columns, singleton variables, aggregates as well as indexed properties on the group variables. Each <span class="emphasis"><em>measure_expression</em></span> expression must be followed by the <code class="literal">as</code> keyword and a <span class="emphasis"><em>col_name</em></span> column name.
		</p><p>
			The <code class="literal">all matches</code> keywords are optional and instructs the engine to find all possible matches. By default matches are ranked and the engine returns a single match following an algorithm to eliminate duplicate matches, as described below. When specifying <code class="literal">all matches</code>, matches may overlap and may start at the same row.
		</p><p>
			The <code class="literal">after match skip</code> keywords are optional and serve to determine the resumption point of pattern matching after a match has been found. By default the behavior is <code class="literal">after match skip past last row</code>. This means that after eliminating duplicate matches, the logic skips to resume pattern matching at the next event after the last event of the current match.
		</p><p>
			The <code class="literal">pattern</code> component is used to specify a regular expression. The regular expression is built from variable names, and may use quantifiers such as <code class="literal">*</code>, <code class="literal">+</code>, <code class="literal">?</code>, <code class="literal">*?</code>, <code class="literal">+?</code>, <code class="literal">??</code>, <code class="literal">{repetition}</code> and <code class="literal">|</code> alteration (concatenation is indicated by the absence of any operator sign between two successive items in a pattern).
		</p><p>
			With the optional <code class="literal">interval</code> keyword, time period and <code class="literal">or terminated</code> you can control how long the engine should wait for further events to arrive that may be part of a matching event sequence, before indicating a match (or matches) (not applicable to on-demand pattern matching).
		</p><p>
			<code class="literal">Define</code> is optional and is used to specify the boolean condition(s) that define some or all variable names that are declared in the pattern. A variable name does not require a definition and if there is no definition, the default is a predicate that is always true. Such a variable name can be used to match any row.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="match-recognize-syntax-example"/>8.3.1.Â Syntax Example</h3></div></div></div><p>
				For illustration, the examples in this chapter use the <code class="literal">TemperatureSensorEvent</code> event. Each event has 3 properties: the <code class="literal">id</code> property is a unique event id, the <code class="literal">device</code> is a sensor device number and the <code class="literal">temp</code> property is a temperature reading. An event described as <code class="literal">"id=E1, device=1, temp=100"</code> is a <code class="literal">TemperatureSensorEvent</code> event with id "E1" for device 1 with a reading of 100.
			</p><p>
				This example statement looks for two <code class="literal">TemperatureSensorEvent</code> events from the same device, directly following each other, that indicate a jump in temperature of 10 or more between the two events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TemperatureSensorEvent
match_recognize (
  partition by device
  measures A.id as a_id, B.id as b_id, A.temp as a_temp, B.temp as b_temp
  pattern (A B)
  define 
    B as Math.abs(B.temp - A.temp) &gt;= 10
)</pre><p>
			  The <code class="literal">partition by</code> ensures that the regular expression applies to sequences of events from the same device.
			</p><p>
			  The <code class="literal">measures</code> clause provides a list of properties or expressions to be selected from matching events. Each property name must be prefixed by the variable name.
			</p><p>
			  In the <code class="literal">pattern</code> component the statement declares two variables: <code class="literal">A</code> and <code class="literal">B</code>. As a matter of convention, variable names are uppercase characters.
			</p><p>
			  The <code class="literal">define</code> clause specifies no condition for variable A. This means that A defaults to true and any event matches A. Therefore, the pattern can start at any event.
			</p><p>
			  The pattern <code class="literal">A B</code> indicates to look for a pattern in which an event that fulfills the condition for variable A is immediately followed by an event that fulfills the condition for variable B.
			  A pattern thus defines the sequence (or sequences) of conditions that must be met for the pattern to fire.
			</p><p>
			  Below table is an example sequence of events and output of the pattern:
			</p><div class="table"><a id="d0e22268"/><p class="title"><b>TableÂ 8.2.Â Example</b></p><div class="table-contents"><table summary="Example" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Arrival Time</th><th>Tuple</th><th>Output Event (if any)</th></tr></thead><tbody><tr><td>1000</td><td>id=E1, device=1, temp=50</td><td>Â </td></tr><tr><td>2000</td><td>id=E2, device=1, temp=55</td><td>Â </td></tr><tr><td>3000</td><td>id=E3, device=1, temp=60</td><td>Â </td></tr><tr><td>4000</td><td>id=E4, device=1, temp=70</td><td>a_id = E3, b_id = E4, a_temp = 60, b_temp = 70</td></tr><tr><td>5000</td><td>id=E5, device=1, temp=85</td><td>Â </td></tr><tr><td>6000</td><td>id=E6, device=1, temp=85</td><td>Â </td></tr><tr><td>7000</td><td>id=E7, device=2, temp=100</td><td>Â </td></tr></tbody></table></div></div><br class="table-break"/><p>
				At time 4000 when event with id <code class="literal">E4</code> (or event E4 or just E4 for short) arrives the pattern matches and produces an output event. Matching then skips past the last event of the current match (E4) and begins at event E5 (the default skip clause is past last row). Therefore events E4 and E5 do not constitute a match.
			</p><p>
				At time 3000, events E1 and E3 do not constitute a match as E3 does not immediately follow E, since there is E2 in between.
			</p><p>
				At time 7000, event E7 does not constitute a match as it is from device 2 and thereby not in the same partition as prior events.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="match-recognize-patternops"/>8.4.Â Pattern and Pattern Operators</h2></div></div></div><p>
			The <code class="literal">pattern</code> specifies the pattern to be recognized in the ordered sequence of events in a partition using regular expression syntax. Each variable name in a pattern corresponds to a boolean condition, which is specified later
			using the <code class="literal">define</code> component of the syntax. Thus the <code class="literal">pattern</code>  can be regarded as implicitly declaring one or more variable names; the definition of those variable names appears later in the
			syntax. If a variable is not defined the variable defaults to true.
		</p><p>
			It is permitted for a variable name to occur more than once in a pattern, for example <code class="literal">pattern (A B A)</code>.					
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="match-recognize-patternops-precedence"/>8.4.1.Â Operator Precedence</h3></div></div></div><a id="d0e22358" class="indexterm"/><p>
				The operators at the top of this table take precedence over operators lower on the table. 
			</p><div class="table"><a id="d0e22365"/><p class="title"><b>TableÂ 8.3.Â Match Recognize Regular Expression Operator Precedence</b></p><div class="table-contents"><table summary="Match Recognize Regular Expression Operator Precedence" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th>Precedence</th><th>Operator</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td>1</td><td>Grouping</td><td><code class="literal">()</code></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">(A B)</pre></td></tr><tr><td>2</td><td>Quantifiers</td><td><code class="literal">* + ? {repetition}</code></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">A* B+ C?</pre></td></tr><tr><td>3</td><td>Concatenation</td><td>(no operator)</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">A B</pre></td></tr><tr><td>4</td><td>Alternation</td><td><code class="literal">|</code></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">A | B</pre></td></tr></tbody></table></div></div><br class="table-break"/><p>
				If you are not sure about the precedence, please consider placing parenthesis <code class="literal">()</code> around your groups. Parenthesis can also help make
				expressions easier to read and understand.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="match-recognize-patternops-concatenation"/>8.4.2.Â Concatenation</h3></div></div></div><p>
				The concatenation is indicated by the absence of any operator sign between two successive items in a pattern.
			</p><p>
				In below pattern the two items A and B have no operator between them. The pattern matches for any event immediately followed by an event from the same device that indicates a jump in temperature over 10:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TemperatureSensorEvent
match_recognize (
  partition by device
  measures A.id as a_id, B.id as b_id, A.temp as a_temp, B.temp as b_temp
  pattern (A B)
  define 
    B as Math.abs(B.temp - A.temp) &gt;= 10
)</pre><p>
				Please see the <a class="xref" href="#match-recognize-syntax-example" title="8.3.1.Â Syntax Example">SectionÂ 8.3.1, âSyntax Exampleâ</a> for a sample event sequence.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="match-recognize-patternops-alternation"/>8.4.3.Â Alternation</h3></div></div></div><p>
				The alternation operator is a vertical bar (<code class="literal"> | </code>).
			</p><p>
				The alternation operator has the lowest precedence of all operators. It tells the engine to match either everything to the left of the vertical bar, or everything to the right of the vertical bar. If you want to limit the reach of the alternation, you will need to use parentheses for grouping.
			</p><p>
				This example pattern looks for a sequence of an event with a temperature over 50 followed immediately by either an event with a temperature less than 45 or an event that indicates the temperature jumped by 10 (all for the same device):
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TemperatureSensorEvent
match_recognize (
  partition by device
  measures A.id as a_id, B.id as b_id, C.id as c.id
  pattern (A (B | C))
  define 
    A as A.temp &gt;= 50,
    B as B.temp &lt;= 45,
    C as Math.abs(C.temp - A.temp) &gt;= 10)</pre><p>
			  Below table is an example sequence of events and output of the pattern:
			</p><div class="table"><a id="d0e22461"/><p class="title"><b>TableÂ 8.4.Â Example</b></p><div class="table-contents"><table summary="Example" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Arrival Time</th><th>Tuple</th><th>Output Event (if any)</th></tr></thead><tbody><tr><td>1000</td><td>id=E1, device=1, temp=50</td><td>Â </td></tr><tr><td>2000</td><td>id=E2, device=1, temp=45</td><td>a_id=E1, b_id=E2, c_id=null</td></tr><tr><td>3000</td><td>id=E3, device=1, temp=46</td><td>Â </td></tr><tr><td>4000</td><td>id=E4, device=1, temp=48</td><td>Â </td></tr><tr><td>5000</td><td>id=E5, device=1, temp=50</td><td>Â </td></tr><tr><td>6000</td><td>id=E6, device=1, temp=60</td><td>a_id = E5, b_id = null, c_id=E6</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="match-recognize-patternops-quantifiers"/>8.4.4.Â Quantifiers Overview</h3></div></div></div><p>
				Quantifiers are postfix operators with the following choices:
			</p><div class="table"><a id="d0e22520"/><p class="title"><b>TableÂ 8.5.Â Quantifiers</b></p><div class="table-contents"><table summary="Quantifiers" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Quantifier</th><th>Meaning</th></tr></thead><tbody><tr><td>*</td><td>Zero or more matches (greedy).</td></tr><tr><td>+</td><td>One or more matches (greedy).</td></tr><tr><td>?</td><td>Zero or one match (greedy).</td></tr><tr><td>*?</td><td>Zero or more matches (reluctant).</td></tr><tr><td>+?</td><td>One or more matches (reluctant).</td></tr><tr><td>??</td><td>Zero or one match (reluctant).</td></tr></tbody></table></div></div><br class="table-break"/><p>
				Quantifiers that control the number of repetitions are:
			</p><div class="table"><a id="d0e22565"/><p class="title"><b>TableÂ 8.6.Â Quantifiers</b></p><div class="table-contents"><table summary="Quantifiers" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Quantifier</th><th>Meaning</th></tr></thead><tbody><tr><td>{n}</td><td>Exactly <span class="emphasis"><em>n</em></span> matches.</td></tr><tr><td>{n, }</td><td><span class="emphasis"><em>n</em></span> or more matches.</td></tr><tr><td>{n, m}</td><td>Between <span class="emphasis"><em>n</em></span> and <span class="emphasis"><em>m</em></span> matches (inclusive).</td></tr><tr><td>{ ,m}</td><td>Between zero and <span class="emphasis"><em>m</em></span> matches (inclusive).</td></tr></tbody></table></div></div><br class="table-break"/><p>Repetition quantifiers can be combined with other quantifiers and grouping. For example <code class="literal">A?{2}</code> or <code class="literal">(A B){2}</code> are valid.</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="match-recognize-patternops-permutation"/>8.4.5.Â Permutations</h3></div></div></div><p>
				To detect patterns that consist of a permutation of variables you may use <code class="literal">match_recognize_permute</code>. 
				It is possible to express a permutation as alternations but it becomes clumsy when many variables are involved. 
				For example, if all permutations of three variables A B C are needed you could express it as: (A B C | A C B | B A C | B C A | C A B | C B A).
			</p><p>
				You may use <code class="literal">match_recognize_permute</code> followed by a comma-separated list of variables, grouping, alternations or concatenations.
			</p><p>
				The following table outlines sample equivalent permutations.
			</p><div class="table"><a id="d0e22635"/><p class="title"><b>TableÂ 8.7.Â Equivalent Pattern Expressions</b></p><div class="table-contents"><table summary="Equivalent Pattern Expressions" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Pattern</th><th>Equivalent</th></tr></thead><tbody><tr><td>match_recognize_permute(A)</td><td>A</td></tr><tr><td>match_recognize_permute(A,B)</td><td>(A B|B A)</td></tr><tr><td>match_recognize_permute(A,B,C)</td><td>A B C|A C B|B A C|B C A|C A B|C B A</td></tr><tr><td>match_recognize_permute((A B), C)</td><td>(A B) C|C (A B)</td></tr><tr><td>A match_recognize_permute(B,C) D</td><td>A (B C|C B) D</td></tr><tr><td>match_recognize_permute(A, match_recognize_permute(B, C))</td><td>A (B C|C B)|(B C|C B) A</td></tr></tbody></table></div></div><br class="table-break"/><p>
				This sample pattern looks for either an event with temperature less than 100 and then an event with temperature greater or equal to 100,
				or an event with temperature greater or equal to 100 and then an event with temperature less than 100.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TemperatureSensorEvent
match_recognize (
  partition by device
  measures A.id as a_id, B.id as b_id
  pattern (match_recognize_permute(A, B))
  define 
    A as A.temp &lt; 100, 
    B as B.temp &gt;= 100)</pre><p>
				An example sequence of events that matches the pattern above is:
			</p><div class="table"><a id="d0e22685"/><p class="title"><b>TableÂ 8.8.Â Example</b></p><div class="table-contents"><table summary="Example" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Arrival Time</th><th>Tuple</th><th>Output Event (if any)</th></tr></thead><tbody><tr><td>1000</td><td>id=E1, device=1, temp=99</td><td>Â </td></tr><tr><td>2000</td><td>id=E2, device=1, temp=100</td><td>a_id = E1, b_id = E2</td></tr><tr><td>3000</td><td>id=E3, device=1, temp=100</td><td>Â </td></tr><tr><td>4000</td><td>id=E4, device=1, temp=99</td><td>a_id = E4, b_id = E3</td></tr><tr><td>5000</td><td>id=E5, device=1, temp=98</td><td>Â </td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="match-recognize-patternops-singletonvars"/>8.4.6.Â Variables Can Be Singleton or Group</h3></div></div></div><p>
				A <span class="emphasis"><em>singleton variable</em></span> is a variable in a pattern that does not have a quantifier or has a zero-or-one quantifier (<code class="literal">?</code> or <code class="literal">??</code>) and occurs only once in the pattern (except with alteration).
				In the <code class="literal">measures</code> clause a singleton variable can be selected as: 
			</p><pre class="synopsis">variableName.propertyName</pre><p>
				Variables with a zero-or-more or one-or-more quantifier, or variables that occur multiple places in a pattern (except when using alteration), may match multiple events and are <span class="emphasis"><em>group variables</em></span>.
				In the <code class="literal">measures</code> clause a group variable must be selected either by providing an index or via any of the aggregation functions, such as <code class="literal">first</code>, <code class="literal">last</code>, <code class="literal">count</code> and <code class="literal">sum</code>:
			</p><pre class="synopsis">variableName[<span class="emphasis"><em>index</em></span>].propertyName</pre><pre class="synopsis">last(variableName.propertyName)</pre><p>
				Enumeration methods can also be applied to group variables. An example is provided in <a class="xref" href="#enumeration-ds-matchrecog" title="11.4.11.Â Match-Recognize Group Variable">SectionÂ 11.4.11, âMatch-Recognize Group Variableâ</a>.
			</p><p>
				Please find examples of singleton and group variables and example <code class="literal">measures</code> and <code class="literal">define</code> clauses below.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="match-recognize-patternops-singletonvars-aggfunc"/>8.4.6.1.Â Additional Aggregation Functions</h4></div></div></div><p>
						For group variables all existing aggregation functions can be used and in addition the following aggregation functions may be used (<code class="literal">measures</code>-clause only):
					</p><div class="table"><a id="match-recognize-patternops-singletonvars-aggfunc-table"/><p class="title"><b>TableÂ 8.9.Â Syntax and Results of Aggregate Functions</b></p><div class="table-contents"><table summary="Syntax and Results of Aggregate Functions" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Aggregate Function</th><th>Result</th></tr></thead><tbody><tr><td>first([all|distinct] <span class="emphasis"><em>expression</em></span>)</td><td>
										<p>
											Returns the first value.
										</p>
									</td></tr><tr><td>last([all|distinct] <span class="emphasis"><em>expression</em></span>)</td><td>
										<p>
											Returns the last value.
										</p>
									</td></tr></tbody></table></div></div><br class="table-break"/></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="match-recognize-patternops-iterator"/>8.4.7.Â Eliminating Duplicate Matches</h3></div></div></div><p>
				The execution of match recognize is continuous and real-time by default. This means that every arriving event, or batch of events if using batching, evaluates against the pattern and matches are immediately indicated. Elimination of duplicate matches occurs between all matches of the arriving events (or batch of events) at a given time.
			</p><p>
				As an alternative, and if your application does not require continuous pattern evaluation, you may use the <code class="literal">iterator</code> API to perform on-demand matching of the pattern. For the purpose of indicating to the engine to not
				generate continuous results, specify the <code class="literal">@Hint('iterate_only')</code> hint.
			</p><p>
				When using one-or-more, zero-or-more or zero-or-one quantifiers (<code class="literal">?, +, *, ??, +?, *?</code>), the output of the real-time continuous query can differ from the output of the on-demand <code class="literal">iterator</code> execution: The continuous query will output a match (or multiple matches) as soon as matches are detected at a given time upon arrival of events (not knowing what further events may arrive). The on-demand execution, since it knows all possible events in advance, can determine the longest match(es). Thus elimination of duplicate matches can lead to different results between real-time and on-demand use.
			</p><p>
				If the <code class="literal">all matches</code> keywords are specified, then all matches are returned as the result and no elimination of duplicate matches as below occurs.
			</p><p>
				Otherwise matches to a pattern in a partition are ordered by preferment. Preferment is given to matches based on the following priorities:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						A match that begins at an earlier row is preferred over a match that begins at a later row.
					</p></li><li><p>
						Of two matches matching a greedy quantifier, the longer match is preferred.
					</p></li><li><p>
						Of two matches matching a reluctant quantifier, the shorter match is preferred.
					</p></li></ol></div><p>
				After ranking matches by preferment, matches are chosen as follows:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						The first match by preferment is taken.
					</p></li><li><p>
						The pool of matches is reduced as follows based on the SKIP TO clause: If SKIP PAST LAST ROW is specified, all matches that overlap the first match are discarded from the pool. If SKIP TO NEXT ROW is specified, then all matches that overlap the first row
of the first match are discarded. If SKIP TO CURRENT ROW is specified, then no matches are discarded.
					</p></li><li><p>
						The first match by preferment of the ones remaining is taken.
					</p></li><li><p>
						Step 2 is repeated to remove more matches from the pool.
					</p></li><li><p>
						Steps 3 and 4 are repeated until there are no remaining matches in the pool.
					</p></li></ol></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="match-recognize-patternops-quantifiers-reluctant"/>8.4.8.Â Greedy or Reluctant</h3></div></div></div><p>
				Reluctant quantifiers are indicated by an additional question mark (<code class="literal">*?, +?, ??,</code>). Reluctant quantifiers try to match as few rows as possible, whereas non-reluctant quantifiers are greedy and try to match as many rows
as possible.
			</p><p>
				Greedy and reluctant come into play only for match selection among multiple possible matches. When specifying <code class="literal">all matches</code> there is no difference between greedy and reluctant quantifiers.
			</p><p>
				Consider the below example. The conditions may overlap: an event with a temperature reading of 105 and over matches both A and B conditions:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TemperatureSensorEvent
match_recognize (
  partition by device
  measures A.id as a_id, B.id as b_id
  pattern (A?? B?)
  define 
    A as A.temp &gt;= 100
    B as B.temp &gt;= 105)</pre><p>
				A sample sequence of events and pattern matches:
			</p><div class="table"><a id="d0e22909"/><p class="title"><b>TableÂ 8.10.Â Example</b></p><div class="table-contents"><table summary="Example" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Arrival Time</th><th>Tuple</th><th>Output Event (if any)</th></tr></thead><tbody><tr><td>1000</td><td>id=E1, device=1, temp=99</td><td>Â </td></tr><tr><td>2000</td><td>id=E2, device=2, temp=106</td><td>a_id=null, b_id=E2</td></tr><tr><td>3000</td><td>id=E3, device=1, temp=100</td><td>a_id=E3, b_id=null</td></tr></tbody></table></div></div><br class="table-break"/><p>
				As the <code class="literal">?</code> qualifier on condition B is greedy, event E2 matches the pattern and is indicated as a B event by the <code class="literal">measure</code> clause (and not as an A event therefore <code class="literal">a_id</code> is null).
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="match-recognize-patternops-quantifiers-oneormore"/>8.4.9.Â Quantifier - One or More (+ and +?)</h3></div></div></div><p>
				The one-or-more quantifier (+) must be matched one or more times by events. The operator is greedy and the reluctant version is <code class="literal">+?</code>.
			</p><p>
				In the below example with <code class="literal">pattern (A+ B+)</code> the pattern consists of two variable names, A and B, each of which is quantified with <code class="literal">+</code>, indicating that they must be matched one or more times.
			</p><p>
				The pattern looks for one or more events in which the temperature is over 100 followed by one or more events indicating a higher temperature:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TemperatureSensorEvent
match_recognize (
  partition by device
  measures first(A.id) as first_a, last(A.id) as last_a, B[0].id as b0_id, B[1].id as b1_id
  pattern (A+ B+)
  define 
	A as A.temp &gt;= 100,
	B as B.temp &gt; A.temp)</pre><p>
				An example sequence of events that matches the pattern above is:
			</p><div class="table"><a id="d0e22978"/><p class="title"><b>TableÂ 8.11.Â Example</b></p><div class="table-contents"><table summary="Example" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Arrival Time</th><th>Tuple</th><th>Output Event (if any)</th></tr></thead><tbody><tr><td>1000</td><td>id=E1, device=1, temp=99</td><td>Â </td></tr><tr><td>2000</td><td>id=E2, device=1, temp=100</td><td>Â </td></tr><tr><td>3000</td><td>id=E3, device=1, temp=100</td><td>Â </td></tr><tr><td>4000</td><td>id=E4, device=1, temp=101</td><td>first_a = E2, last_a = E3, b0_id = E4, b1_id = null</td></tr><tr><td>5000</td><td>id=E5, device=1, temp=102</td><td>Â </td></tr></tbody></table></div></div><br class="table-break"/><p>
				Note that for continuous queries, there is no match that includes event E5 since after the pattern matches for E4 the pattern skips to start fresh at E5 (by default skip clause). When performing on-demand matching via <code class="literal">iterator</code>, event E5 gets included in the match 
				and the output is <code class="literal">first_a = E2, last_a = E3, b0_id = E4, b1_id = E5</code>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="match-recognize-patternops-quantifiers-zeroormore"/>8.4.10.Â Quantifier - Zero or More (* and *?)</h3></div></div></div><p>
				The zero-or-more quantifier (*) must be matched zero or more times by events. The operator is greedy and the reluctant version is <code class="literal">*?</code>.
			</p><p>
				The pattern looks for a sequence of events in which the temperature starts out below 50 and then stays between 50 and 60 and finally comes over 60:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TemperatureSensorEvent
match_recognize (
  partition by device
  measures A.id as a_id, count(B.id) as count_b, C.id as c_id
  pattern (A B* C)
  define 
	A as A.temp &lt; 50,
	B as B.temp between 50 and 60,
	C as C.temp &gt; 60)</pre><p>
				An example sequence of events that matches the pattern above is:
			</p><div class="table"><a id="d0e23047"/><p class="title"><b>TableÂ 8.12.Â Example</b></p><div class="table-contents"><table summary="Example" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Arrival Time</th><th>Tuple</th><th>Output Event (if any)</th></tr></thead><tbody><tr><td>1000</td><td>id=E1, device=1, temp=55</td><td>Â </td></tr><tr><td>2000</td><td>id=E2, device=1, temp=52</td><td>Â </td></tr><tr><td>3000</td><td>id=E3, device=1, temp=49</td><td>Â </td></tr><tr><td>4000</td><td>id=E4, device=1, temp=51</td><td>Â </td></tr><tr><td>5000</td><td>id=E5, device=1, temp=55</td><td>Â </td></tr><tr><td>6000</td><td>id=E5, device=1, temp=61</td><td>a_id=E3, count_b=2, c_id=E6</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="match-recognize-patternops-quantifiers-zeroorone"/>8.4.11.Â Quantifier - Zero or One (? and ??)</h3></div></div></div><p>
				The zero-or-one quantifier (?) must be matched zero or one time by events. The operator is greedy and the reluctant version is <code class="literal">??</code>.
			</p><p>
				The pattern looks for a sequence of events in which the temperature is below 50 and then dips to over 50 and then to under 50 before indicating a value over 55:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TemperatureSensorEvent
match_recognize (
  partition by device
  measures A.id as a_id, B.id as b_id, C.id as c_id, D.id as d_id
  pattern (A B? C? D)
  define 
	A as A.temp &lt; 50,
	B as B.temp &gt; 50,
	C as C.temp &lt; 50,
	D as D.temp &gt; 55)</pre><p>
				An example sequence of events that matches the pattern above is:
			</p><div class="table"><a id="d0e23114"/><p class="title"><b>TableÂ 8.13.Â Example</b></p><div class="table-contents"><table summary="Example" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Arrival Time</th><th>Tuple</th><th>Output Event (if any)</th></tr></thead><tbody><tr><td>1000</td><td>id=E1, device=1, temp=44</td><td>Â </td></tr><tr><td>2000</td><td>id=E2, device=1, temp=49</td><td>Â </td></tr><tr><td>3000</td><td>id=E3, device=1, temp=51</td><td>Â </td></tr><tr><td>4000</td><td>id=E4, device=1, temp=49</td><td>Â </td></tr><tr><td>5000</td><td>id=E5, device=1, temp=56</td><td>a_id=E2, b_id=E3, c_id=E4, d_id=E5</td></tr><tr><td>6000</td><td>id=E5, device=1, temp=61</td><td>Â </td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="match-recognize-patternops-quantifiersrepeat-exactlyn"/>8.4.12.Â Repetition - Exactly N Matches</h3></div></div></div><p>
				The exactly-n quantifier ({n}) must be matched exactly N times. The repetition quantifier can be combined with other non-repetition quantifiers and can be used with grouping.
			</p><p>
				In the below example the <code class="literal">pattern (A{2})</code> consists of one variable names, A, quantified with <code class="literal">{2}</code>, indicating that the condition must match exactly two times.
			</p><p>
				This sample pattern looks for two events in which the temperature is over 100:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TemperatureSensorEvent
match_recognize (
  partition by device
  measures A[0].id as a0_id, A[1].id as a1_id
  pattern (A{2})
  define 
	A as A.temp &gt;= 100)</pre><p>
				An example sequence of events that matches the pattern above is:
			</p><div class="table"><a id="d0e23186"/><p class="title"><b>TableÂ 8.14.Â Example</b></p><div class="table-contents"><table summary="Example" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Arrival Time</th><th>Tuple</th><th>Output Event (if any)</th></tr></thead><tbody><tr><td>1000</td><td>id=E1, device=1, temp=99</td><td>Â </td></tr><tr><td>2000</td><td>id=E2, device=1, temp=100</td><td>Â </td></tr><tr><td>3000</td><td>id=E3, device=1, temp=100</td><td>a0_id = E2, a1_id = E3</td></tr><tr><td>4000</td><td>id=E4, device=1, temp=101</td><td>Â </td></tr><tr><td>5000</td><td>id=E5, device=1, temp=102</td><td>a0_id = E4, a1_id = E5</td></tr></tbody></table></div></div><br class="table-break"/><p>
				The next sample applies the quantifier to a group. This sample pattern looks for a four events in which the temperature is, in sequence, 100, 101, 100 and 101:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TemperatureSensorEvent
match_recognize (
  partition by device
  measures A[0].id as a0_id, A[1].id as a1_id
  pattern (A B){2}
  define 
	A as A.temp = 100,
	B as B.temp = 101)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="match-recognize-patternops-quantifiersrepeat-n_or_more"/>8.4.13.Â Repetition - N or More Matches</h3></div></div></div><p>
				The quantifier <code class="literal">{n, }</code> must be matched N or more times. The repetition quantifier can be combined with other non-repetition quantifiers and can be used with grouping.
			</p><p>
				In the below example the <code class="literal">pattern (A{2,} B)</code> consists of two variable names, A and B. The condition A must match two or more times and the B condition must match once.
			</p><p>
				This sample pattern looks for two or more events in which the temperature is over 100 and thereafter an event with a temperature over 102:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TemperatureSensorEvent
match_recognize (
  partition by device
  measures A[0].id as a0_id, A[1].id as a1_id, A[2].id as a2_id, B.id as b_id
  pattern (A{2,} B)
  define 
	A as A.temp &gt;= 100,
	B as B.temp &gt;= 102)</pre><p>
				An example sequence of events that matches the pattern above is:
			</p><div class="table"><a id="d0e23257"/><p class="title"><b>TableÂ 8.15.Â Example</b></p><div class="table-contents"><table summary="Example" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Arrival Time</th><th>Tuple</th><th>Output Event (if any)</th></tr></thead><tbody><tr><td>1000</td><td>id=E1, device=1, temp=99</td><td>Â </td></tr><tr><td>2000</td><td>id=E2, device=1, temp=100</td><td>Â </td></tr><tr><td>3000</td><td>id=E3, device=1, temp=100</td><td>Â </td></tr><tr><td>4000</td><td>id=E4, device=1, temp=101</td><td>Â </td></tr><tr><td>5000</td><td>id=E5, device=1, temp=102</td><td>a0_id = E2, a1_id = E3, a2_id = E4, b_id = E5</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="match-recognize-patternops-quantifiersrepeat-between_n_and_m"/>8.4.14.Â Repetition - Between N and M Matches</h3></div></div></div><p>
				The quantifier <code class="literal">{n, m}</code> must be matched between N and M times. The repetition quantifier can be combined with other non-repetition quantifiers and can be used with grouping.
			</p><p>
				In the below example the <code class="literal">pattern (A{2,3} B)</code> consists of two variable names, A and B. The condition A must match two or three times and the B condition must match once.
			</p><p>
				This sample pattern looks for two or three events in which the temperature is over 100 and thereafter an event with a temperature over 102:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TemperatureSensorEvent
match_recognize (
  partition by device
  measures A[0].id as a0_id, A[1].id as a1_id, A[2].id as a2_id, B.id as b_id
  pattern (A{2,3} B)
  define 
	A as A.temp &gt;= 100,
	B as B.temp &gt;= 102)</pre><p>
				An example sequence of events that matches the pattern above is:
			</p><div class="table"><a id="d0e23323"/><p class="title"><b>TableÂ 8.16.Â Example</b></p><div class="table-contents"><table summary="Example" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Arrival Time</th><th>Tuple</th><th>Output Event (if any)</th></tr></thead><tbody><tr><td>1000</td><td>id=E1, device=1, temp=99</td><td>Â </td></tr><tr><td>2000</td><td>id=E2, device=1, temp=100</td><td>Â </td></tr><tr><td>3000</td><td>id=E3, device=1, temp=100</td><td>Â </td></tr><tr><td>4000</td><td>id=E4, device=1, temp=101</td><td>Â </td></tr><tr><td>5000</td><td>id=E5, device=1, temp=102</td><td>a0_id = E2, a1_id = E3, a2_id = E4, b_id = E5</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="match-recognize-patternops-quantifiersrepeat-"/>8.4.15.Â Repetition - Between Zero and M Matches</h3></div></div></div><p>
				The quantifier <code class="literal">{, m}</code> must be matched between zero and M times. The repetition quantifier can be combined with other non-repetition quantifiers and can be used with grouping.
			</p><p>
				In the below example the <code class="literal">pattern (A{, 2} B)</code> consists of two variable names, A and B. The condition A must match zero, once or twice and the B condition must match once.
			</p><p>
				This sample pattern looks for between zero and two events in which the temperature is over 100 and thereafter an event with a temperature over 102:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TemperatureSensorEvent
match_recognize (
  partition by device
  measures A[0].id as a0_id, A[1].id as a1_id, B.id as b_id
  pattern (A{,2} B)
  define 
	A as A.temp &gt;= 100,
	B as B.temp &gt;= 102)</pre><p>
				An example sequence of events that matches the pattern above is:
			</p><div class="table"><a id="d0e23389"/><p class="title"><b>TableÂ 8.17.Â Example</b></p><div class="table-contents"><table summary="Example" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Arrival Time</th><th>Tuple</th><th>Output Event (if any)</th></tr></thead><tbody><tr><td>1000</td><td>id=E1, device=1, temp=99</td><td>Â </td></tr><tr><td>2000</td><td>id=E2, device=1, temp=100</td><td>Â </td></tr><tr><td>3000</td><td>id=E3, device=1, temp=100</td><td>Â </td></tr><tr><td>4000</td><td>id=E4, device=1, temp=101</td><td>Â </td></tr><tr><td>5000</td><td>id=E5, device=1, temp=102</td><td>a0_id = E3, a1_id = E4, b_id = E5</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="match-recognize-patternops-repeat-equiv"/>8.4.16.Â Repetition Equivalence</h3></div></div></div><p>
				The following table outlines sample equivalent patterns.
			</p><div class="table"><a id="d0e23441"/><p class="title"><b>TableÂ 8.18.Â Equivalent Pattern Expressions</b></p><div class="table-contents"><table summary="Equivalent Pattern Expressions" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Expression</th><th>Equivalent</th></tr></thead><tbody><tr><td>Atom Examples</td><td>Â </td></tr><tr><td>A{2}</td><td>A A</td></tr><tr><td>A{2, }</td><td>A A A*</td></tr><tr><td>A{2, 4}</td><td>A A A? A?</td></tr><tr><td>A{, 2}</td><td>A? A?</td></tr><tr><td>Group Examples</td><td>Â </td></tr><tr><td>(A B){2}</td><td>(A B) (A B)</td></tr><tr><td>(A B){2, }</td><td>(A B) (A B) (A B)*</td></tr><tr><td>(A B){2, 4}</td><td>(A B) (A B) (A B)? (A B)?</td></tr><tr><td>(A B){, 2}</td><td>(A B)? (A B)?</td></tr><tr><td>Quantifier Examples</td><td>Â </td></tr><tr><td>A+{2, }</td><td>A+ A+ A*</td></tr><tr><td>A?{2, }</td><td>A? A? A*</td></tr><tr><td>A+{2, 4}</td><td>A+ A+ A* A*</td></tr><tr><td>A+{, 2}</td><td>A* A*</td></tr></tbody></table></div></div><br class="table-break"/></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="match-recognize-define"/>8.5.Â <code class="literal">Define</code> Clause</h2></div></div></div><p>
			Within <code class="literal">define</code> are listed the boolean conditions that defines a variable name that is declared in the pattern. 
		</p><p>
			A variable name does not require a definition and if there is no definition, the default is a predicate
			that is always true. Such a variable name can be used to match any row.
		</p><p>
			The definitions of variable names may reference the same or other variable names as prior examples have shown. 
		</p><p>
			If a variable in your condition expression is a singleton variable, then only individual columns may be referenced. If the variable is not matched by an event, a <code class="literal">null</code> value is returned.
        </p><p>
			If a variable in your condition expression is a group variable, then only indexed columns may be referenced. If the variable is not matched by an event, a <code class="literal">null</code> value is returned.
        </p><p>
			Aggregation functions are not allowed within expressions of the <code class="literal">define</code> clause. However <code class="literal">define</code>-clause expressions can utilize enumeration methods.
        </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="match-recognize-define-prev"/>8.5.1.Â The <code class="literal">Prev</code> Operator</h3></div></div></div><p>
				The <code class="literal">prev</code> function may be used in a <code class="literal">define</code> expression to access columns of the previous row of a variable name. If there is no previous row, the null value is returned. 
			</p><p>
				The <code class="literal">prev</code> function can accept an optional non-negative integer argument indicating the offset to the previous rows. That argument must be a constant. In this case, the engine returns the property from the
N-th row preceding the current row, and if the row doesnât exist, it returns <code class="literal">null</code>.
			</p><p>
				This function can access variables currently defined, for example:				
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Y as Y.price &lt; prev(Y.price, 2)</pre><p>
				It is not legal to use <code class="literal">prev</code> with another variable then the one being defined:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// not allowed
Y as Y.price &lt; prev(X.price, 2)</pre><p>
				The <code class="literal">prev</code> function returns properties of events in the same partition. Also, it returns properties of events according to event order-of-arrival. When using data windows or deleting events from a named window, the remove stream does not remove events from the <code class="literal">prev</code> function.
			</p><p>
				The pattern looks for an event in which the temperature is greater or equal 100 and that, relative to that event, has an event preceding it by 2 events that also had a temperature greater or equal 100:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TemperatureSensorEvent
match_recognize (
  partition by device
  measures A.id as a_id
  pattern (A)
  define 
	A as A.temp &gt; 100 and prev(A.temp, 2) &gt; 100)</pre><p>
				An example sequence of events that matches the pattern above is:
			</p><div class="table"><a id="d0e23606"/><p class="title"><b>TableÂ 8.19.Â Example</b></p><div class="table-contents"><table summary="Example" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Arrival Time</th><th>Tuple</th><th>Output Event (if any)</th></tr></thead><tbody><tr><td>1000</td><td>id=E1, device=1, temp=98</td><td>Â </td></tr><tr><td>2000</td><td>id=E2, device=1, temp=101</td><td>Â </td></tr><tr><td>3000</td><td>id=E3, device=1, temp=101</td><td>Â </td></tr><tr><td>4000</td><td>id=E4, device=1, temp=99</td><td>Â </td></tr><tr><td>5000</td><td>id=E5, device=1, temp=101</td><td>a_id=E5</td></tr></tbody></table></div></div><br class="table-break"/></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="match-recognize-measure"/>8.6.Â <code class="literal">Measure</code> Clause</h2></div></div></div><p>
			The <code class="literal">measures</code> clause defines exported columns that contain expressions over the pattern variables. The expressions can reference partition columns, singleton variables and
			any aggregation functions including <code class="literal">last</code> and <code class="literal">first</code> on the group variables. 
        </p><p>
			Expressions in the <code class="literal">measures</code> clause must use the <code class="literal">as</code> keyword to assign a column name.
        </p><p>
			If a variable is a singleton variable then only individual columns may be referenced, not aggregates. If the variable is not matched by an event, a <code class="literal">null</code> value is returned.
        </p><p>
			If a variable is a group variable and used in an aggregate, then the aggregate is performed over all  rows that have matched the variable. If a group variable is not in an aggregate function, its variable name must be post-fixed with an index. 
			See <a class="xref" href="#match-recognize-patternops-singletonvars" title="8.4.6.Â Variables Can Be Singleton or Group">SectionÂ 8.4.6, âVariables Can Be Singleton or Groupâ</a> for more information.
        </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="match-recognize-datawindow"/>8.7.Â Datawindow-Bound</h2></div></div></div><p>
			When using match recognize with a named window or stream bound by a data window, all events removed from the named window or data window also removed the match-in-progress that includes the event(s) removed.
        </p><p>
			The next example looks for four sensor events from the same device immediately following each other and indicating a rising temperature, but only events that arrived in the last 10 seconds are considered:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TemperatureSensorEvent#time(10 sec)
match_recognize (
partition by device
measures A.id as a_id
pattern (A B C D)
define 
B as B.temp &gt; A.temp,
C as C.temp &gt; B.temp,
D as D.temp &gt; C.temp)</pre><p>
			An example sequence of events that matches the pattern above is:
		</p><div class="table"><a id="d0e23697"/><p class="title"><b>TableÂ 8.20.Â Example</b></p><div class="table-contents"><table summary="Example" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Arrival Time</th><th>Tuple</th><th>Output Event (if any)</th></tr></thead><tbody><tr><td>1000</td><td>id=E1, device=1, temp=80</td><td>Â </td></tr><tr><td>2000</td><td>id=E2, device=1, temp=81</td><td>Â </td></tr><tr><td>3000</td><td>id=E3, device=1, temp=82</td><td>Â </td></tr><tr><td>4000</td><td>id=E4, device=1, temp=81</td><td>Â </td></tr><tr><td>7000</td><td>id=E5, device=1, temp=82</td><td>Â </td></tr><tr><td>9000</td><td>id=E6, device=1, temp=83</td><td>Â </td></tr><tr><td>13000</td><td>id=E7, device=1, temp=84</td><td>a_id=E4, a_id=E5, a_id=E6, a_id=E7</td></tr><tr><td>15000</td><td>id=E8, device=1, temp=84</td><td>Â </td></tr><tr><td>20000</td><td>id=E9, device=1, temp=85</td><td>Â </td></tr><tr><td>21000</td><td>id=E10, device=1, temp=86</td><td>Â </td></tr><tr><td>26000</td><td>id=E11, device=1, temp=87</td><td>Â </td></tr></tbody></table></div></div><br class="table-break"/><p>
			Note that E8, E9, E10 and E11 doe not constitute a match since E8 leaves the data window at 25000.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="match-recognize-interval"/>8.8.Â Interval</h2></div></div></div><p>
			With the optional <code class="literal">interval</code> keyword and time period you can control how long the engine should wait for further events to arrive that may be part of a matching event sequence, before indicating a match (or matches). This is not applicable to on-demand pattern matching.
		</p><p>
			The interval timer starts are the arrival of the first event matching a sequence for a partition. When the time interval passes and an event sequence matches, duplicate matches are eliminated and output occurs. 
        </p><p>
			The next example looks for sensor events indicating a temperature of over 100 waiting for any number of additional events with a temperature of over 100 for 5 seconds before indicating a match:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TemperatureSensorEvent
match_recognize (
partition by device
measures A.id as a_id, count(B.id) as count_b, first(B.id) as first_b, last(B.id) as last_b
pattern (A B*)
interval 5 seconds
define 
  A as A.temp &gt; 100,
  B as B.temp &gt; 100)</pre><p>
			An example sequence of events that matches the pattern above is:
		</p><div class="table"><a id="d0e23798"/><p class="title"><b>TableÂ 8.21.Â Example</b></p><div class="table-contents"><table summary="Example" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Arrival Time</th><th>Tuple</th><th>Output Event (if any)</th></tr></thead><tbody><tr><td>1000</td><td>id=E1, device=1, temp=98</td><td>Â </td></tr><tr><td>2000</td><td>id=E2, device=1, temp=101</td><td>Â </td></tr><tr><td>3000</td><td>id=E3, device=1, temp=102</td><td>Â </td></tr><tr><td>4000</td><td>id=E4, device=1, temp=104</td><td>Â </td></tr><tr><td>5000</td><td>id=E5, device=1, temp=104</td><td>Â </td></tr><tr><td>7000</td><td>Â </td><td>a_id=E2, count_b=3, first_b=E3, last_b=E5</td></tr></tbody></table></div></div><br class="table-break"/><p>
			Notice that the engine waits 5 seconds (5000 milliseconds) after the arrival time of the first event E2 of the match at 2000, to indicate the match at 7000.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="match-recognize-intervalorterminated"/>8.9.Â Interval-or-Terminated</h2></div></div></div><p>
			The <code class="literal">interval</code> keyword and time period can be followed by <code class="literal">or terminated</code> keywords. When or-terminated is specified, the engine detects when a pattern state cannot match further and outputs matching event sequences collected so far that are otherwise only output at the end of the interval. This is not applicable to on-demand pattern matching.
		</p><p>
			Same as for <code class="literal">interval</code> alone, the interval timer starts are the arrival of the first event matching a sequence for a partition. 
			Event arrival can terminate the interval and lead to immediate output as follows:
        </p><div class="itemizedlist"><ul><li>
				When an event arrives in the sequence that causes pattern state to terminate because no further match is possible, the event sequence matches, duplicate matches are eliminated and output occurs
			immediately (and not at the end of the interval), for the affected event sequence(s).
			</li><li>
			Otherwise, when the time interval passes and an event sequence matches, duplicate matches are eliminated and output occurs. 				
			</li></ul></div><p>
			The next example looks for sensor events indicating a temperature of over 100, waiting for any number of additional events with a temperature of over 100 for 5 seconds 
			or when the temperature falls to equal or below 100, whichever happens first:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TemperatureSensorEvent
match_recognize (
partition by device
measures A.id as a_id, count(B.id) as count_b, first(B.id) as first_b, last(B.id) as last_b
pattern (A B*)
interval 5 seconds or terminated
define 
  A as A.temp &gt; 100,
  B as B.temp &gt; 100)</pre><p>
			An example sequence of events that matches the pattern above is:
		</p><div class="table"><a id="d0e23879"/><p class="title"><b>TableÂ 8.22.Â Example</b></p><div class="table-contents"><table summary="Example" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Arrival Time</th><th>Tuple</th><th>Output Event (if any)</th></tr></thead><tbody><tr><td>1000</td><td>id=E1, device=1, temp=98</td><td>Â </td></tr><tr><td>2000</td><td>id=E2, device=1, temp=101</td><td>Â </td></tr><tr><td>3000</td><td>id=E3, device=1, temp=102</td><td>Â </td></tr><tr><td>4000</td><td>id=E4, device=1, temp=101</td><td>Â </td></tr><tr><td>5000</td><td>id=E5, device=1, temp=100</td><td>a_id=E2, count_b=2, first_b=E3, last_b=E4</td></tr><tr><td>7000</td><td>Â </td><td>(no further output)</td></tr></tbody></table></div></div><br class="table-break"/><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
				<code class="literal">Interval</code> and <code class="literal">Interval</code> with <code class="literal">or terminated</code> make most sense for open-ended patterns such as, 
				for example, <code class="literal">pattern (A B*)</code> or <code class="literal">pattern (A B C+)</code>.
			</p><p>
				For patterns that terminate when a given event arrives, for example, <code class="literal">pattern (A B)</code>, an <code class="literal">Interval</code> in combination with <code class="literal">or terminated</code> should not be specified
				and if specified have no effect on matching.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="match-recognize-variant"/>8.10.Â Use With Different Event Types</h2></div></div></div><p>
			You may match different types of events using match-recognize by following any of these strategies:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
                    Declare a variant stream.
                </p></li><li><p>
                    Declare a supertype for your event types in the <code class="literal">create schema</code> syntax.
                </p></li><li><p>
                    Have you event classes implement a common interface or extend a common base class. 
                </p></li></ol></div><p>
			 A short example that demonstrates variant streams and match-recognize is listed below:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Declare one sample type
create schema S0 as (col string)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Declare second sample type
create schema S1 as (col string)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Declare variant stream holding either type
create variant schema MyVariantStream as S0, S1</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Populate variant stream
insert into MyVariantStream select * from S0</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Populate variant stream
insert into MyVariantStream select * from S1</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Simple pattern to match S0 S1 pairs
select * from MyVariantType#time(1 min)
match_recognize (
  measures A.id? as a, B.id? as b
  pattern (A B)
  define
    A as typeof(A) = 'S0',
    B as typeof(B) = 'S1'
)</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="match-recognize-state-max"/>8.11.Â Limiting Engine-Wide State Count</h2></div></div></div><p>
		 Esper allows setting a maximum number of states in the configuration, applicable to all match-recognize constructs of all statements. 
	   </p><p>
		 If your application uses match-recognize in multiple EPL statements and all such match-recognize constructs should count towards a total number of states counts, you may consider setting a maximum number of states, engine-wide, via the configuration described in <a class="xref" href="#config-engine-matchrecognize-max" title="15.4.19.1.Â Maximum State Count">SectionÂ 15.4.19.1, âMaximum State Countâ</a>.
	   </p><p>
		  When the limit is reached the match-recognize engine issues a notification object to any condition handlers registered with the engine as described in <a class="xref" href="#api-condition" title="14.11.Â Condition Handling">SectionÂ 14.11, âCondition Handlingâ</a>. Depending on your configuration the engine can prevent the allocation of a new state instance, until states are discarded or statements are stopped or destroyed or context partitions are terminated.
		</p><p>
		  The notification object issued to condition handlers is an instance of <code class="literal">com.espertech.esper.client.hook.ConditionMatchRecognizeStatesMax</code>. The notification object contains information which statement triggered the limit and the state counts per statement for all statements.
		</p><p>
		  For information on static and runtime configuration, please consult <a class="xref" href="#config-engine-matchrecognize-max" title="15.4.19.1.Â Maximum State Count">SectionÂ 15.4.19.1, âMaximum State Countâ</a>. The limit can be changed and disabled or enabled at runtime via the runtime configuration API.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="match-recognize-limitations"/>8.12.Â Limitations</h2></div></div></div><p>
			Please note the following limitations:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					Subqueries are not allowed in expressions within <code class="literal">match_recognize</code>.
				</p></li><li><p>
					Joins and outer joins are not allowed in the same statement as <code class="literal">match_recognize</code>.
				</p></li><li><p>
					<code class="literal">match_recognize</code> may not be used within <code class="literal">on-select</code> or <code class="literal">on-insert</code> statements.
				</p></li><li><p>
					When using <code class="literal">match_recognize</code> on unbound streams (no data window provided) the <code class="literal">iterator</code> pull API returns no rows.
				</p></li></ol></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-operator"/>ChapterÂ 9.Â EPL Reference: Operators</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#epl-operator-ref-arithmetic">9.1. Arithmetic Operators</a></span></dt><dt><span class="sect1"><a href="#epl-operator-ref-logical">9.2. Logical and Comparison Operators</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-operator-ref-logical-null">9.2.1. Null-Value Comparison Operators</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-operator-ref-string">9.3. Concatenation Operators</a></span></dt><dt><span class="sect1"><a href="#epl-operator-ref-binary">9.4. Binary Operators</a></span></dt><dt><span class="sect1"><a href="#epl-operator-ref-array">9.5. Array Definition Operator</a></span></dt><dt><span class="sect1"><a href="#epl-operator-ref-dot">9.6. Dot Operator</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-operator-ref-dot-duck">9.6.1. Duck Typing</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-operator-ref-keyword-in">9.7. The 'In' Keyword</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-operator-ref-keyword-in-range">9.7.1. 'In' for Range Selection</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-operator-ref-keyword-between">9.8. The 'Between' Keyword</a></span></dt><dt><span class="sect1"><a href="#epl-operator-ref-keyword-like">9.9. The 'Like' Keyword</a></span></dt><dt><span class="sect1"><a href="#epl-operator-ref-keyword-regexp">9.10. The 'Regexp' Keyword</a></span></dt><dt><span class="sect1"><a href="#epl-operator-anysome">9.11. The 'Any' and 'Some' Keywords</a></span></dt><dt><span class="sect1"><a href="#epl-operator-all">9.12. The 'All' Keyword</a></span></dt><dt><span class="sect1"><a href="#epl-operator-new">9.13. The 'New' Keyword</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-operator-new-datastructure">9.13.1. Using 'New' to Populate a Data Structure</a></span></dt><dt><span class="sect2"><a href="#epl-operator-new-instance">9.13.2. Using 'New' to Instantiate an Object</a></span></dt></dl></dd></dl></div><p>
			Esper arithmetic and logical operator precedence follows Java standard arithmetic and logical operator precedence.
		</p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-operator-ref-arithmetic"/>9.1.Â Arithmetic Operators</h2></div></div></div><a id="d0e24062" class="indexterm"/><a id="d0e24065" class="indexterm"/><p>
				The below table outlines the arithmetic operators available.
			</p><div class="table"><a id="epl-arith-operators"/><p class="title"><b>TableÂ 9.1.Â Syntax and Results of Arithmetic Operators</b></p><div class="table-contents"><table summary="Syntax and Results of Arithmetic Operators" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Operator</th><th>Description</th></tr></thead><tbody><tr><td>+, -</td><td>
								<p>As unary operators they denote a positive or negative expression. As binary operators they add or subtract.</p>
							</td></tr><tr><td>*, /</td><td>
								<p>Multiplication and division are binary operators.</p>
							</td></tr><tr><td>%</td><td>
								<p>Modulo binary operator.</p>
							</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-operator-ref-logical"/>9.2.Â Logical and Comparison Operators</h2></div></div></div><a id="d0e24112" class="indexterm"/><a id="d0e24115" class="indexterm"/><p>
				The below table outlines the logical and comparison operators available.
			</p><div class="table"><a id="epl-log-operators"/><p class="title"><b>TableÂ 9.2.Â Syntax and Results of Logical and Comparison Operators</b></p><div class="table-contents"><table summary="Syntax and Results of Logical and Comparison Operators" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Operator</th><th>Description</th></tr></thead><tbody><tr><td>NOT</td><td>
								<p>Returns true if the following condition is false, returns false if it is true.</p>
							</td></tr><tr><td>OR</td><td>
								<p>Returns true if either component condition is true, returns false if both are false.</p>
							</td></tr><tr><td>AND</td><td>
								<p>Returns true if both component conditions are true, returns false if either is false.</p>
							</td></tr><tr><td>=, !=, &lt;, &gt; &lt;=, &gt;=, is, is not</td><td>
								<p>Comparison.</p>
							</td></tr></tbody></table></div></div><br class="table-break"/><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-operator-ref-logical-null"/>9.2.1.Â Null-Value Comparison Operators</h3></div></div></div><p>
					The <code class="literal">null</code> value is a special value, see <a class="link" href="http://en.wikipedia.org/wiki/Null_%28SQL%29" target="">http://en.wikipedia.org/wiki/Null_(SQL)</a> (source:Wikipedia) for more information.
				</p><p>
				  Thereby the following expressions all return <code class="literal">null</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">2 != null</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">null = null</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">2 != null or 1 = 2</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">2 != null and 2 = 2</pre><p>
				  Use the <code class="literal">is</code> and <code class="literal">is not</code> operators for comparing values that can be null.
				</p><p>
				  The following expressions all return <code class="literal">true</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">2 is not null</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">null is not 2</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">null is null</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">2 is 2</pre><p>
					The engine allows <code class="literal">is</code> and <code class="literal">is not</code> with any expression, not only in connection with the <code class="literal">null</code> constant.
				</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-operator-ref-string"/>9.3.Â Concatenation Operators</h2></div></div></div><a id="d0e24226" class="indexterm"/><a id="d0e24229" class="indexterm"/><p>
				The below table outlines the concatenation operators available.
			</p><div class="table"><a id="epl-concat-operators"/><p class="title"><b>TableÂ 9.3.Â Syntax and Results of Concatenation Operators</b></p><div class="table-contents"><table summary="Syntax and Results of Concatenation Operators" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Operator</th><th>Description</th></tr></thead><tbody><tr><td>||</td><td>
								<p>Concatenates character strings</p>
							</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-operator-ref-binary"/>9.4.Â Binary Operators</h2></div></div></div><a id="d0e24260" class="indexterm"/><a id="d0e24263" class="indexterm"/><p>
				The below table outlines the binary operators available.
			</p><div class="table"><a id="epl-binary-operators"/><p class="title"><b>TableÂ 9.4.Â Syntax and Results of Binary Operators</b></p><div class="table-contents"><table summary="Syntax and Results of Binary Operators" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Operator</th><th>Description</th></tr></thead><tbody><tr><td>&amp;</td><td>
								<p>Bitwise AND if both operands are numbers; conditional AND if both operands are boolean.</p>
							</td></tr><tr><td>|</td><td>
								<p>Bitwise OR if both operands are numbers; conditional OR if both operands are boolean.</p>
							</td></tr><tr><td>^</td><td>
								<p>Bitwise exclusive OR (XOR).</p>
							</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-operator-ref-array"/>9.5.Â Array Definition Operator</h2></div></div></div><a id="d0e24310" class="indexterm"/><a id="d0e24313" class="indexterm"/><p>
				The <code class="literal">{</code> and <code class="literal">}</code> curly braces are array definition operators following the Java array initialization syntax. Arrays can be useful to pass to user-defined functions or to select array data in a select clause.
			</p><p>
				Array definitions consist of zero or more expressions within curly braces. Any type of expression is allowed within array definitions including constants, arithmetic expressions or event properties. This is the syntax of an array definition:
			</p><pre class="synopsis"><span class="emphasis"><em>{</em></span> [<span class="emphasis"><em>expression</em></span> [,<span class="emphasis"><em>expression</em></span>...]] }</pre><p>
				Consider the next statement that returns an event property named <code class="literal">actions</code>. The engine populates the <code class="literal">actions</code> property as an array of <code class="literal">java.lang.String</code> values with a length of 2 elements. The first element of the array contains the <code class="literal">observation</code> property value and the second element the <code class="literal">command</code> property value of <code class="literal">RFIDEvent</code> events.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select {observation, command} as actions from RFIDEvent</pre><p>
				The engine determines the array type based on the types returned by the expressions in the array definiton. For example, if all expressions in the array definition return integer values then the type of the array is <code class="literal">java.lang.Integer[]</code>. If the types returned by all expressions are compatible number types, such as integer and double values, the engine coerces the array element values and returns a suitable type, <code class="literal">java.lang.Double[]</code> in this example.
				The type of the array returned is <code class="literal">Object[]</code> if the types of expressions cannot be coerced or return object values. Null values can also be used in an array definition.
			</p><p>
				Arrays can come in handy for use as parameters to user-defined functions:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from RFIDEvent where Filter.myFilter(zone, {1,2,3})</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-operator-ref-dot"/>9.6.Â Dot Operator</h2></div></div></div><a id="d0e24378" class="indexterm"/><a id="d0e24381" class="indexterm"/><a id="d0e24386" class="indexterm"/><p>
				You can use the dot operator to invoke a method on the result of an expression. The dot operator uses the dot (<code class="literal">.</code>) or period character.
			</p><p>
				The dot-operator is relevant with enumeration methods: Enumeration methods perform tasks such as transformation, filtering, aggregation, sequence-matching, sorting and others on subquery results, named windows, tables, event properties or inputs that are or can be projected to a collection of events, scalar values or objects. See <a class="xref" href="#enumerationreference" title="ChapterÂ 11.Â EPL Reference: Enumeration Methods">ChapterÂ 11, <i>EPL Reference: Enumeration Methods</i></a>
			</p><p>
				Further the dot-operator is relevant to date-time methods. Date-time methods work on date-time values to add or subtract time periods, set or round calendar fields or query fields, among other tasks. See <a class="xref" href="#datetimereference" title="ChapterÂ 12.Â EPL Reference: Date-Time Methods">ChapterÂ 12, <i>EPL Reference: Date-Time Methods</i></a>.
			</p><p>
				The dot-operator is also relevant to spatial methods and the use of spatial indexes. See <a class="xref" href="#spatial" title="ChapterÂ 19.Â EPL Reference: Spatial Methods and Indexes">ChapterÂ 19, <i>EPL Reference: Spatial Methods and Indexes</i></a>.
			</p><p>
				This section only describes the dot-operator in relation to property instance methods, the special <code class="literal">get</code> and <code class="literal">size</code> indexed-property methods and duck typing.
			</p><p>
				The synopsis for the dot operator is as follows
			</p><pre class="synopsis"><span class="emphasis"><em>expression</em></span>.<span class="emphasis"><em>method</em></span>([<span class="emphasis"><em>parameter</em></span> [,...]])[.<span class="emphasis"><em>method</em></span>(...)][...]</pre><p>
				The expression to evaluate by the dot operator is in parenthesis. After the dot character follows the method name and method parameters in parenthesis.
			</p><p>
				You may use the dot operator when your expression returns an object that you want to invoke a method on. The dot operator allows duck typing and convenient array and collection access methods.
			</p><p>
				This example statement invokes the <code class="literal">getZones</code> method of the RFID event class by referring to the stream name assigned in the <code class="literal">from</code>-clause:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select rfid.getZones() from RFIDEvent as rfid</pre><p>
				The <code class="literal">size()</code> method can be used to return the array length or collection size. Use the <code class="literal">get</code> method to return the value at a given index for an array or collection.
			</p><p>
			  The next statement selects array size and returns the last array element:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select arrayproperty.size() as arraySize, 
  arrayproperty.get((arrayproperty).size - 1) as lastInArray 
  from ProductEvent</pre><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-operator-ref-dot-duck"/>9.6.1.Â Duck Typing</h3></div></div></div><p>
				   Duck typing is when the engine checks at runtime for the existence of a method regardless of object class inheritance hierarchies. This can be useful, for example, when a dynamic property returns an object which may or may not provide a method to return the desired value.
				</p><p>
				  Duck typing is disabled in the default configuration to consistently enforce strong typing. Please enable duck typing via engine expression settings as described in <a class="xref" href="#config-engine-expression" title="15.4.26.Â Engine Settings Related to Expression Evaluation">SectionÂ 15.4.26, âEngine Settings Related to Expression Evaluationâ</a>.
				</p><p>
				  The statement below selects a dynamic property by name <code class="literal">productDesc</code> and invokes the <code class="literal">getCounter()</code> method if that method exists on the property value, or returns the null value if the method does not exist for the dynamic property value of if the dynamic property value itself is null:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select (productDesc?).getCounter() as arraySize from ProductEvent</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-operator-ref-keyword-in"/>9.7.Â The '<code class="literal">In</code>' Keyword</h2></div></div></div><a id="d0e24480" class="indexterm"/><a id="d0e24485" class="indexterm"/><p>
				The <code class="literal">in</code> keyword determines if a given value matches any value in a list. The syntax of the keyword is:	
			</p><pre class="synopsis"><span class="emphasis"><em>test_expression</em></span> [not] in (<span class="emphasis"><em>expression</em></span> [,<span class="emphasis"><em>expression</em></span>...] )</pre><p>
				The <span class="emphasis"><em>test_expression</em></span> is any valid expression. The keyword is followed by a list of expressions to test for a match. The optional <code class="literal">not</code> keyword specifies that the result of the predicate be negated.
			</p><p>
				The result of an <code class="literal">in</code> expression is of type <code class="literal">Boolean</code>. If the value of <span class="emphasis"><em>test_expression</em></span> is equal to any expression from the comma-separated list, the result value is <code class="literal">true</code>. Otherwise, the result value is <code class="literal">false</code>. 
			</p><p>
				The next example shows how the <code class="literal">in</code> keyword can be applied to select certain command types of RFID events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from RFIDEvent where command in ('OBSERVATION', 'SIGNAL')</pre><p>
				The statement is equivalent to:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from RFIDEvent where command = 'OBSERVATION' or command = 'SIGNAL'</pre><p>
				<span class="emphasis"><em>Expression</em></span> may also return an array, a <code class="literal">java.util.Collection</code> or a <code class="literal">java.util.Map</code>. Thus event properties that are lists, sets or maps may provide values to compare against <span class="emphasis"><em>test_expression</em></span>.
			</p><p>
				All expressions must be of the same type or a compatible type to <span class="emphasis"><em>test_expression</em></span>. The <code class="literal">in</code> keyword may coerce number values to compatible types. If <span class="emphasis"><em>expression</em></span> returns an array, then the component type of the array must be compatible, unless the component type of the array is <code class="literal">Object</code>.
			</p><p>
				If <span class="emphasis"><em>expression</em></span> returns an array of component type <code class="literal">Object</code>, the operation compares each element of the array, applying <code class="literal">equals</code> semantics.
			</p><p>
				If <span class="emphasis"><em>expression</em></span> returns a <code class="literal">Collection</code>, the operation determines if the collection contains the value returned by <span class="emphasis"><em>test_expression</em></span>,  applying <code class="literal">contains</code> semantics. 
			</p><p>
				If <span class="emphasis"><em>expression</em></span> returns a <code class="literal">Map</code>, the operation determines if the map contains the key value returned by <span class="emphasis"><em>test_expression</em></span>, applying <code class="literal">containsKey</code> semantics.
			</p><p>
				 Constants, arrays, <code class="literal">Collection</code> and <code class="literal">Map</code> expressions or event properties can be used combined.
			</p><p>
				 For example, and assuming a property named 'mySpecialCmdList'  exists that contains a list of command strings:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from RFIDEvent where command in ( 'OBSERVATION', 'SIGNAL', mySpecialCmdList)</pre><p>
				 When using prepared statements and substitution parameters with the <code class="literal">in</code> keyword, make sure to retain the parenthesis. Substitution values may also be arrays, <code class="literal">Collection</code> and <code class="literal">Map</code> values:
			</p><pre class="synopsis"><span class="emphasis"><em>test_expression</em></span> [not] in (? [,?...] )</pre><p>
				Note that if there are no successes and at least one right-hand row yields null for the operator's result, the result of the any construct will be null, not false. This is in accordance with SQL's normal rules for Boolean combinations of null values.
			</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-operator-ref-keyword-in-range"/>9.7.1.Â '<code class="literal">In</code>' for Range Selection</h3></div></div></div><p>
					The <code class="literal">in</code> keyword can be used to specify ranges, including open, half-closed, half-open and inverted ranges.
				</p><p>
					Ranges come in the following 4 varieties. The round <code class="literal">()</code> or square <code class="literal">[]</code> bracket indicate whether an endpoint is included or excluded. The low point and the high-point of the range are separated by the colon <code class="literal">:</code> character.
				 </p><div class="itemizedlist"><ul compact="compact"><li><p>
							Open ranges that contain neither endpoint <code class="literal">(low:high)</code>
						</p></li><li><p>
							Closed ranges that contain both endpoints <code class="literal">[low:high]</code>. The equivalent 'between' keyword also defines a closed range.
						</p></li><li><p>
							Half-open ranges that contain the low endpoint but not the high endpoint <code class="literal">[low:high)</code>
						</p></li><li><p>
							Half-closed ranges that contain the high endpoint but not the low endpoint <code class="literal">(low:high]</code>
						</p></li></ul></div><p>
					The following statement two statements are equivalent: Both statements select orders where the price is in the range of zero and 10000 (endpoints inclusive):
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from OrderEvent where price in [0:10000]</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from OrderEvent where price between 0 and 10000</pre><p>
					The next statement selects order events where the price is greater then 100 and less-or-equal to 2000:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from OrderEvent where price in (100:2000]</pre><p>
					Use the <code class="literal">not in</code> keywords to specify an inverted range.
				</p><p>
					The following statement selects an inverted range by selecting all order events where the price is less then zero or the price is greater or equal to 10000:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from OrderEvent where price not in (0:10000]</pre><p>
					In case the value of low endpoint is less then the value of high endpoint the <code class="literal">in</code> operator reverses the range.
				</p><p>
					The following two statements are also equivalent:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from OrderEvent where price in [10000:0]</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from OrderEvent where price &gt;= 0 and price &lt;= 1000</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-operator-ref-keyword-between"/>9.8.Â The '<code class="literal">Between</code>' Keyword</h2></div></div></div><a id="d0e24721" class="indexterm"/><a id="d0e24726" class="indexterm"/><p>
				The <code class="literal">between</code> keyword specifies a range to test. The syntax of the keyword is:	
			</p><pre class="synopsis"><span class="emphasis"><em>test_expression</em></span> [not] between <span class="emphasis"><em>begin_expression</em></span> and <span class="emphasis"><em>end_expression</em></span></pre><p>
				The <span class="emphasis"><em>test_expression</em></span> is any valid expression and is the expression to test for in the range defined by <span class="emphasis"><em>begin_expression</em></span> and <span class="emphasis"><em>end_expression</em></span>. The <code class="literal">not</code> keyword specifies that the result of the predicate be negated. 
			</p><p>
				The result of a <code class="literal">between</code> expression is of type <code class="literal">Boolean</code>. If the value of <span class="emphasis"><em>test_expression</em></span> is greater then or equal to the value of <span class="emphasis"><em>begin_expression</em></span> and less than or equal to the value of <span class="emphasis"><em>end_expression</em></span>, the result is <code class="literal">true</code>. 
			</p><p>
				The next example shows how the <code class="literal">between</code> keyword can be used to select events with a price between 55 and 60 (endpoints inclusive).
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent where price between 55 and 60</pre><p>
				The equivalent expression without <code class="literal">between</code> is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent where price &gt;= 55 and price &lt;= 60</pre><p>
				And also equivalent to:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent where price between 60 and 55</pre><p>
				While the <code class="literal">between</code> keyword always includes the endpoints of the range, the <code class="literal">in</code> operator allows finer control of endpoint inclusion.
			</p><p>
				In case the value of <span class="emphasis"><em>begin_expression</em></span> is less then the value of <span class="emphasis"><em>end_expression</em></span> the <code class="literal">between</code> operator reverses the range.
			</p><p>
				The following two statements are also equivalent:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent where price between 60 and 55</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent where price &gt;= 55 and price &lt;= 60</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-operator-ref-keyword-like"/>9.9.Â The '<code class="literal">Like</code>' Keyword</h2></div></div></div><a id="d0e24829" class="indexterm"/><a id="d0e24834" class="indexterm"/><p>
				The <code class="literal">like</code> keyword provides standard SQL pattern matching. SQL pattern matching allows you to use <code class="literal">'_'</code> to match any single character and <code class="literal">'%'</code> to match an arbitrary number of characters (including zero characters). In Esper, SQL patterns are case-sensitive by default. The syntax of <code class="literal">like</code> is:	
			</p><pre class="synopsis"><span class="emphasis"><em>test_expression</em></span> [not] like <span class="emphasis"><em>pattern_expression</em></span> [escape <span class="emphasis"><em>string_literal</em></span>]</pre><p>
				The <span class="emphasis"><em>test_expression</em></span> is any valid expression yielding a String-type or a numeric result. The optional <code class="literal">not</code> keyword specifies that the result of the predicate be negated. The <code class="literal">like</code> keyword is followed by any valid standard SQL <span class="emphasis"><em>pattern_expression</em></span> yielding a String-typed result. The optional <code class="literal">escape</code> keyword signals the escape character to escape <code class="literal">'_'</code> and <code class="literal">'%'</code> values in the pattern. The default escape character is backslash (<code class="literal">\</code>).
			</p><p>
				The result of a <code class="literal">like</code> expression is of type <code class="literal">Boolean</code>. If the value of <span class="emphasis"><em>test_expression</em></span> matches the <span class="emphasis"><em>pattern_expression</em></span>, the result value is <code class="literal">true</code>. Otherwise, the result value is <code class="literal">false</code>.
			</p><p>
				An example for the <code class="literal">like</code> keyword is below.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from PersonLocationEvent where name like '%Jack%'</pre><p>
				The escape character can be defined as follows. In this example the where-clause matches events where the suffix property is a single <code class="literal">'_'</code> character.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from PersonLocationEvent where suffix like '!_' escape '!'</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-operator-ref-keyword-regexp"/>9.10.Â The '<code class="literal">Regexp</code>' Keyword</h2></div></div></div><a id="d0e24930" class="indexterm"/><a id="d0e24935" class="indexterm"/><p>
				The <code class="literal">regexp</code> keyword is a form of pattern matching based on regular expressions implemented through the Java <code class="literal">java.util.regex</code> package. The syntax of <code class="literal">regexp</code> is:	
			</p><pre class="synopsis"><span class="emphasis"><em>test_expression</em></span> [not] regexp <span class="emphasis"><em>pattern_expression</em></span></pre><p>
				The <span class="emphasis"><em>test_expression</em></span> is any valid expression yielding a String-type or a numeric result. The optional <code class="literal">not</code> keyword specifies that the result of the predicate be negated. The <code class="literal">regexp</code> keyword is followed by any valid regular expression <span class="emphasis"><em>pattern_expression</em></span> yielding a String-typed result.
			</p><p>
				The result of a <code class="literal">regexp</code> expression is of type <code class="literal">Boolean</code>. If the value of <span class="emphasis"><em>test_expression</em></span> matches the regular expression <span class="emphasis"><em>pattern_expression</em></span>, the result value is <code class="literal">true</code>. Otherwise, the result value is <code class="literal">false</code>.
			</p><p>
				An example for the <code class="literal">regexp</code> keyword is below.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from PersonLocationEvent where name regexp '.*Jack.*'</pre><p>
			  The <code class="literal">rexexp</code> function matches the entire region against the pattern via <code class="literal">java.util.regex.Matcher.matches()</code> method. Please consult the Java API documentation for more information or refer to <a class="ulink" href="http://www.regular-expressions.info/refflavors.html">Regular Expression Flavors</a>.
			 </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-operator-anysome"/>9.11.Â The '<code class="literal">Any</code>' and '<code class="literal">Some</code>' Keywords</h2></div></div></div><p>
				The <code class="literal">any</code> operator is true if the expression returns true for one or more of the values returned by a list of expressions including array, <code class="literal">Collection</code> and <code class="literal">Map</code> values.
			</p><p>
				The synopsis for the <code class="literal">any</code> keyword is as follows:
			</p><pre class="synopsis"><span class="emphasis"><em>expression</em></span> <span class="emphasis"><em>operator</em></span> any (<span class="emphasis"><em>expression</em></span> [,<span class="emphasis"><em>expression</em></span>...] )</pre><p>
				The left-hand expression is evaluated and compared to each expression result using the given operator, which must yield a Boolean result. The result of <code class="literal">any</code> is "true" if any true result is obtained. The result is "false" if no true result is found (including the special case where the expressions are collections that return no rows). 
			</p><p>
				The <span class="emphasis"><em>operator</em></span> can be any of the following values: <code class="literal">=, !=, &lt;&gt;, &lt;, &lt;=, &gt;, &gt;=</code>.
			</p><p>
				The <code class="literal">some</code> keyword is a synonym for <code class="literal">any</code>. The <code class="literal">in</code> construct is equivalent to <code class="literal">= any</code>.
			</p><p>
				<span class="emphasis"><em>Expression</em></span> may also return an array, a <code class="literal">java.util.Collection</code> or a <code class="literal">java.util.Map</code>. Thus event properties that are lists, sets or maps may provide values to compare against.
			</p><p>
				All expressions must be of the same type or a compatible type. The <code class="literal">any</code> keyword coerces number values to compatible types. If <span class="emphasis"><em>expression</em></span> returns an array, then the component type of the array must be compatible, unless the component type of the array is <code class="literal">Object</code>.
			</p><p>
				If <span class="emphasis"><em>expression</em></span> returns an array, the operation compares each element of the array.
			</p><p>
				If <span class="emphasis"><em>expression</em></span> returns a <code class="literal">Collection</code>, the operation determines if the collection contains the value returned by the left-hand expression,  applying <code class="literal">contains</code> semantics. 
				When using relationship operators <code class="literal">&lt;, &lt;=, &gt;, &gt;=</code> the operator applies to each element in the collection, and non-numeric elements are ignored.
			</p><p>
				If <span class="emphasis"><em>expression</em></span> returns a <code class="literal">Map</code>, the operation determines if the map contains the key value returned by the left-hand expression, applying <code class="literal">containsKey</code> semantics.
				When using relationship operators <code class="literal">&lt;, &lt;=, &gt;, &gt;=</code> the operator applies to each key in the map, and non-numeric map keys are ignored.
			</p><p>
				 Constants, arrays, <code class="literal">Collection</code> and <code class="literal">Map</code> expressions or event properties can be used combined.
			</p><p>
				The next statement demonstrates the use of the <code class="literal">any</code> operator: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from ProductOrder where category != any (categoryArray)</pre><p>
				The above query selects ProductOrder event that have a category field and a category array, and returns only those events in which the category value is not in the array.
			</p><p>
				Note that if there are no successes and at least one right-hand row yields null for the operator's result, the result of the <code class="literal">any</code> construct will be null, not false. This is in accordance with SQL's normal rules for Boolean combinations of null values. 
			</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-operator-all"/>9.12.Â The '<code class="literal">All</code>' Keyword</h2></div></div></div><p>
				The <code class="literal">all</code> operator is true if the expression returns true for all of the values returned by a list of expressions including array, <code class="literal">Collection</code> and <code class="literal">Map</code> values.
			</p><p>
				The synopsis for the <code class="literal">all</code> keyword is as follows:
			</p><pre class="synopsis"><span class="emphasis"><em>expression</em></span> <span class="emphasis"><em>operator</em></span> all (<span class="emphasis"><em>expression</em></span> [,<span class="emphasis"><em>expression</em></span>...] )</pre><p>
				The left-hand expression is evaluated and compared to each expression result using the given operator, which must yield a Boolean result. The result of <code class="literal">all</code> is "true" if all rows yield true (including the special case where the expressions are collections that returns no rows). The result is "false" if any false result is found. The result is <code class="literal">null</code> if the comparison does not return false for any row, and it returns <code class="literal">null</code> for at least one row.
			</p><p>
				The <span class="emphasis"><em>operator</em></span> can be any of the following values: <code class="literal">=, !=, &lt;&gt;, &lt;, &lt;=, &gt;, &gt;=</code>.
			</p><p>
				The <code class="literal">not in</code> construct is equivalent to <code class="literal">!= all</code>.
			</p><p>
				<span class="emphasis"><em>Expression</em></span> may also return an array, a <code class="literal">java.util.Collection</code> or a <code class="literal">java.util.Map</code>. Thus event properties that are lists, sets or maps may provide values to compare against.
			</p><p>
				All expressions must be of the same type or a compatible type. The <code class="literal">all</code> keyword coerces number values to compatible types. If <span class="emphasis"><em>expression</em></span> returns an array, then the component type of the array must be compatible, unless the component type of the array is <code class="literal">Object</code>.
			</p><p>
				If <span class="emphasis"><em>expression</em></span> returns an array, the operation compares each element of the array.
			</p><p>
				If <span class="emphasis"><em>expression</em></span> returns a <code class="literal">Collection</code>, the operation determines if the collection contains the value returned by the left-hand expression,  applying <code class="literal">contains</code> semantics. 
				When using relationship operators <code class="literal">&lt;, &lt;=, &gt;, &gt;=</code> the operator applies to each element in the collection, and non-numeric elements are ignored.
			</p><p>
				If <span class="emphasis"><em>expression</em></span> returns a <code class="literal">Map</code>, the operation determines if the map contains the key value returned by the left-hand expression, applying <code class="literal">containsKey</code> semantics.
				When using relationship operators <code class="literal">&lt;, &lt;=, &gt;, &gt;=</code> the operator applies to each key in the map, and non-numeric map keys are ignored.
			</p><p>
				 Constants, arrays, <code class="literal">Collection</code> and <code class="literal">Map</code> expressions or event properties can be used combined.
			</p><p>
				The next statement demonstrates the use of the <code class="literal">all</code> operator: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from ProductOrder where category = all (categoryArray)</pre><p>
				The above query selects ProductOrder event that have a category field and a category array, and returns only those events in which the category value matches all values in the array.
			</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-operator-new"/>9.13.Â The '<code class="literal">New</code>' Keyword</h2></div></div></div><a id="d0e25292" class="indexterm"/><a id="d0e25295" class="indexterm"/><p>
				The <code class="literal">new</code> has two uses:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						Populate a new data structure by evaluating column names and assignment expressions.
					</p></li><li><p>
						Instantiate an object of a given class by its constructor.
					</p></li></ol></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-operator-new-datastructure"/>9.13.1.Â Using '<code class="literal">New</code>' to Populate a Data Structure</h3></div></div></div><p>
					The <code class="literal">new</code> data structure operator populates a new data structure by evaluating column names and assignment expressions. This is useful when an expression should return multiple results, for performing a transformation or inside enumeration method lambda expressions. 
				</p><p>
					The synopsis is as follows:
				</p><pre class="synopsis">new { <span class="emphasis"><em>column_name</em></span> = [<span class="emphasis"><em>assignment_expression</em></span>] [,<span class="emphasis"><em>column_name</em></span>...] }</pre><p>
					The result of the new-operator is a map data structure that contains <span class="emphasis"><em>column_name</em></span> keys and values. If an assignment expression is provided for a column, the operator evaluates the expression and assigns the result to the column name. If no assignment expression is provided, the column name is assumed to be an event property name and the value is the event property value.
				</p><p>
					The next statement demonstrates the use of the <code class="literal">new</code> operator: 
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select new {category, price = 2*price} as priceInfo from ProductOrder</pre><p>
					The above query returns a single property <code class="literal">priceInfo</code> for each arriving ProductOrder event. The property value is itself a map that contains two entries: For the key name <code class="literal">category</code> the value of the category property and for the key name <code class="literal">price</code> the value of the price property multiplied by two. 
				</p><p>
					The next EPL is an example of the <code class="literal">new</code> operator within an expression definition and a <code class="literal">case</code>-statement (one EPL statement not multiple):
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression calcPrice {
  productOrder =&gt; case
    when category = 'fish' then new { sterialize = 'XRAY', priceFactor = 1.01 }
    when category = 'meat' then new { sterialize = 'UVL', priceFactor = 1 }
  end
}  

select calcPrice(po) as priceDetail from ProductOrder po</pre><p>
					In above example the expression <code class="literal">calcPrice</code> returns both a <code class="literal">sterialize</code> string value and a <code class="literal">priceFactor</code> double value. The expression is evaluated as part of the <code class="literal">select</code>-clause and the map-type result placed in the <code class="literal">priceDetail</code> property of output events.
				</p><p>
					When used within the <code class="literal">case</code> operator, the operator validates that the data structure is compatible between each case-when result in terms of column names and types. The default value for <code class="literal">else</code> in <code class="literal">case</code> is <code class="literal">null</code>.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-operator-new-instance"/>9.13.2.Â Using '<code class="literal">New</code>' to Instantiate an Object</h3></div></div></div><p>
				The <code class="literal">new</code> instantiation operator can instantiate an object of the given class. 
			</p><p>
				The synopsis is as follows:
			</p><pre class="synopsis">new <span class="emphasis"><em>class-name</em></span>([<span class="emphasis"><em>parameter</em></span> [, <span class="emphasis"><em>parameter</em></span> [,...]]])</pre><p>
				The <span class="emphasis"><em>class-name</em></span> is the name of the class to instantiate an object for. The classname can either be fully-qualified or you can add the package or classname to the 
				engine imports.
			</p><p>
				After the classname follow parenthesis and any number of parameter expressions. The engine expects that the class declares a public constructor 
				matching the number and return types of parameter expressions. 
			</p><p>
				Assuming that <code class="literal">OrderHolder</code> is an imported class, the next statement demonstrates the use of the <code class="literal">new</code> operator: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select new OrderHolder(po) as orderHolder from ProductOrder as po</pre></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="functionreference"/>ChapterÂ 10.Â EPL Reference: Functions</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#epl-single-row-function-ref">10.1. Single-Row Function Reference</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-single-row-function-ref-case">10.1.1. The Case Control Flow Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-cast">10.1.2. The Cast Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-ref-coalesce">10.1.3. The Coalesce Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-ref-currentevaluationcontext">10.1.4. The Current_Evaluation_Context Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-ref-currenttime">10.1.5. The Current_Timestamp Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-exists">10.1.6. The Exists Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-grouping">10.1.7. The Grouping Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-groupingid">10.1.8. The Grouping_Id Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-instanceof">10.1.9. The Instance-Of Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-istream">10.1.10. The Istream Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-ref-minmax">10.1.11. The Min and Max Functions</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-ref-previous">10.1.12. The Previous Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-ref-previoustail">10.1.13. The Previous-Tail Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-ref-previouswindow">10.1.14. The Previous-Window Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-ref-previouscount">10.1.15. The Previous-Count Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-ref-prior">10.1.16. The Prior Function</a></span></dt><dt><span class="sect2"><a href="#epl-single-row-function-typeof">10.1.17. The Type-Of Function</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-function-aggregation">10.2. Aggregation Functions</a></span></dt><dd><dl><dt><span class="sect2"><a href="#epl-function-aggregation-std">10.2.1. SQL-Standard Functions</a></span></dt><dt><span class="sect2"><a href="#epl-function-aggregation-event">10.2.2. Event Aggregation Functions</a></span></dt><dt><span class="sect2"><a href="#epl-function-aggregation-approx">10.2.3. Approximation Aggregation Functions</a></span></dt><dt><span class="sect2"><a href="#epl-function-aggregation-add">10.2.4. Additional Aggregation Functions</a></span></dt></dl></dd><dt><span class="sect1"><a href="#epl-function-user-defined">10.3. User-Defined Functions</a></span></dt><dt><span class="sect1"><a href="#functionreference-transpose">10.4. Select-Clause Transpose Function</a></span></dt><dd><dl><dt><span class="sect2"><a href="#functionreference-transpose-insert-into">10.4.1. Transpose with Insert-Into</a></span></dt></dl></dd></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-single-row-function-ref"/>10.1.Â Single-Row Function Reference</h2></div></div></div><p>
			Single-row functions return a single value for every single result row generated by your statement. These functions can appear anywhere where expressions are allowed.
		</p><a id="d0e25449" class="indexterm"/><a id="d0e25452" class="indexterm"/><a id="d0e25457" class="indexterm"/><p>
			Esper allows static Java library methods as single-row functions, and also features built-in single-row functions. In addition, Esper allows instance method invocations on named streams.
		</p><p>
			You may also register your own single-row function name with the engine so that your EPL statements become less cluttered. This is described in detail in <a class="xref" href="#custom-singlerow-function" title="17.3.Â Single-Row Function">SectionÂ 17.3, âSingle-Row Functionâ</a>. Single-row functions that return an object can be chained.
		</p><p>
			Esper auto-imports the following Java library packages:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					java.lang.*
				</p></li><li><p>
					java.math.*
				</p></li><li><p>
					java.text.*
				</p></li><li><p>
					java.util.*
				</p></li></ul></div><p>
			Thus Java static library methods can be used in all expressions as shown in below example:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, Math.round(volume/1000)
from StockTickEvent#time(30 sec)</pre><p>
			In general, arbitrary Java class names have to be fully qualified (e.g. java.lang.Math) but Esper provides a mechanism 
for user-controlled imports of classes and packages as outlined in <a class="xref" href="#config-class--package-imports" title="15.4.7.Â Class and Package Imports">SectionÂ 15.4.7, âClass and Package Importsâ</a>.
		</p><p>
			The below table outlines the built-in single-row functions available.
		</p><div class="table"><a id="epl-single-row-func"/><p class="title"><b>TableÂ 10.1.Â Syntax and Results of Single-Row Functions</b></p><div class="table-contents"><table summary="Syntax and Results of Single-Row Functions" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Single-row Function</th><th>Result</th></tr></thead><tbody><tr><td><pre class="synopsis">case <span class="emphasis"><em>value</em></span> 
  when <span class="emphasis"><em>compare_value</em></span> then <span class="emphasis"><em>result</em></span>
  [when <span class="emphasis"><em>compare_value</em></span> then <span class="emphasis"><em>result</em></span> ...] 
  [else <span class="emphasis"><em>result</em></span>] 
  end </pre></td><td>
							<p>
								Returns <code class="literal">result</code> where the first <code class="literal">value</code> equals <code class="literal">compare_value</code>. 
							</p>
						</td></tr><tr><td><pre class="synopsis">case 
  when <span class="emphasis"><em>condition</em></span> then <span class="emphasis"><em>result</em></span>
  [when <span class="emphasis"><em>condition</em></span> then <span class="emphasis"><em>result</em></span> ...] 
  [else <span class="emphasis"><em>result</em></span>] 
  end</pre></td><td>
							<p>
								Returns the <code class="literal">result</code> for the first condition that is true.
							</p>
						</td></tr><tr><td><pre class="synopsis">cast(<span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>type_name</em></span>)</pre></td><td>
							<p>
								Casts the result of an expression to the given type. 
							</p>
						</td></tr><tr><td><pre class="synopsis">coalesce(<span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>expression</em></span> [, <span class="emphasis"><em>expression</em></span> ...])</pre></td><td>
							<p>
								Returns the first non-<code class="literal">null</code> value in the list, or <code class="literal">null</code> if there are no non-<code class="literal">null</code> values.
							</p>
						</td></tr><tr><td><pre class="synopsis">current_evaluation_context()</pre></td><td>
							<p>
								Returns an object containing the engine URI, EPL statement name and context partition id (when applicable).
							</p>
						</td></tr><tr><td><pre class="synopsis">current_timestamp[()]</pre></td><td>
							<p>
								Returns the current engine time as a <code class="literal">long</code> value. Reserved keyword with optional parenthesis.
							</p>
						</td></tr><tr><td><pre class="synopsis">exists(<span class="emphasis"><em>dynamic_property_name</em></span>)</pre></td><td>
							<p>
								Returns true if the dynamic property exists for the event, or false if the property does not exist.
							</p>
						</td></tr><tr><td><pre class="synopsis">instanceof(<span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>type_name</em></span> [, <span class="emphasis"><em>type_name</em></span> ...])</pre></td><td>
							<p>
								Returns true if the expression returns an object whose type is one of the types listed.
							</p>
						</td></tr><tr><td><pre class="synopsis">istream()</pre></td><td>
							<p>
								Returns true if the event is part of the insert stream and false if the event is part of the remove stream.
							</p>
						</td></tr><tr><td><pre class="synopsis">max(<span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>expression</em></span> [, <span class="emphasis"><em>expression</em></span> ...])</pre></td><td>
							<p>
								Returns the highest numeric value among the 2 or more comma-separated expressions.
							</p>
						</td></tr><tr><td><pre class="synopsis">min(<span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>expression</em></span> [, <span class="emphasis"><em>expression</em></span> ...])</pre></td><td>
							<p>
								Returns the lowest numeric value among the 2 or more comma-separated expressions.
							</p>
						</td></tr><tr><td><pre class="synopsis">prev(<span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>event_property)</em></span></pre></td><td>
							<p>
								Returns a property value or all properties of a previous event, relative to the event order within a data window, or according to an optional index parameter (N) the positional Nth-from-last value.
							</p>
						</td></tr><tr><td><pre class="synopsis">prevtail(<span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>event_property)</em></span></pre></td><td>
							<p>
								Returns a property value or all properties of the first event in a data window relative to the event order within a data window, or according to an optional index parameter (N) the positional Nth-from-first value.
							</p>
						</td></tr><tr><td><pre class="synopsis">prevwindow(<span class="emphasis"><em>event_property</em></span>)</pre></td><td>
							<p>
								Returns a single property value of all events or all properties of all events in a data window in the order that reflects the sort order of the data window.
							</p>
						</td></tr><tr><td><pre class="synopsis">prevcount(<span class="emphasis"><em>event_property</em></span>)</pre></td><td>
							<p>
								Returns the count of events (number of data points) in a data window.
							</p>
						</td></tr><tr><td><pre class="synopsis">prior(<span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>event_property)</em></span></pre></td><td>
							<p>
								Returns a property value of a prior event, relative to the natural order of arrival of events
							</p>
						</td></tr><tr><td><pre class="synopsis">typeof(<span class="emphasis"><em>expression</em></span>)</pre></td><td>
							<p>
								If expression is a stream name, returns the event type name of the evaluated event, often used with variant streams. 
								If expression is a property name or expression, returns the name of the expression result type.
							</p>
						</td></tr></tbody></table></div></div><br class="table-break"/><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-single-row-function-ref-case"/>10.1.1.Â The <code class="literal">Case</code> Control Flow Function</h3></div></div></div><a id="d0e25789" class="indexterm"/><a id="d0e25792" class="indexterm"/><p>
				The <code class="literal">case</code> control flow function has two versions. The first version takes a value and a list of compare values to compare against, and returns the result where the first value equals the compare value. The second version takes a list of conditions and returns the result for the first condition that is true.
			</p><p>
				The return type of a <code class="literal">case</code> expression is the compatible aggregated type of all return values.
			</p><p>
				The <code class="literal">case</code> expression is sometimes used with the <code class="literal">new</code> operator to return multiple results, see <a class="xref" href="#epl-operator-new" title="9.13.Â The 'New' Keyword">SectionÂ 9.13, âThe 'New' Keywordâ</a>.
			</p><p>
				The example below shows the first version of a <code class="literal">case</code> statement. It has a <code class="literal">String</code> return type and returns the value 'one'.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select case myexpression when 1 then 'one' when 2 then 'two' else 'more' end from ...</pre><p>
				The second version of the <code class="literal">case</code> function takes a list of conditions. The next example has a <code class="literal">Boolean</code> return type and returns the boolean value true.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select case when 1&gt;0 then true else false end from ...</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-single-row-function-cast"/>10.1.2.Â The <code class="literal">Cast</code> Function</h3></div></div></div><a id="d0e25843" class="indexterm"/><a id="d0e25846" class="indexterm"/><p>
				The <code class="literal">cast</code> function casts the return type of an expression to a designated type. The function accepts two parameters: 
				The first parameter is the property name or expression that returns the value to be casted. The second parameter is the type to cast to.
				You can use the <code class="literal">as</code> keyword instead of comma (<code class="literal">,</code>) to separate parameters.
			</p><p>
				Valid parameters for the second (type) parameter are:
			</p><div class="itemizedlist"><ul><li><p>
						Any of the Java built-in types: <code class="literal">int, long, byte, short, char, double, float, string, BigInteger, BigDecimal</code>, where <code class="literal">string</code>  is a short notation for <code class="literal">java.lang.String</code> and <code class="literal">BigInteger</code> as well as <code class="literal">BigDecimal</code> are the classes in <code class="literal">java.math</code>. The type name is not case-sensitive. For example:
						</p><pre class="synopsis">cast(price, double)</pre><p>
					</p></li><li><p>
						The fully-qualified class name of the class to cast to, for example: </p><pre class="synopsis">cast(product as org.myproducer.Product)</pre><p>
					</p></li><li><p>
						For parsing date-time values, any of the date-time types: <code class="literal">date, calendar, long, localdatetime, zoneddatetime, localdate, localtime</code>. For these types the <code class="literal">dateformat</code> parameter is required as discussed below.
					</p></li></ul></div><p>
				The <code class="literal">cast</code> function is often used to provide a type for dynamic (unchecked) properties. Dynamic properties are properties whose type is not known at compile type. 
				These properties are always of type <code class="literal">java.lang.Object</code>. 
			</p><p>
				The <code class="literal">cast</code> function as shown in the next statement casts the dynamic "price" property of an "item" in the OrderEvent to a double value.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select cast(item.price?, double) from OrderEvent</pre><p>
				The <code class="literal">cast</code> function returns a <code class="literal">null</code> value if the expression result cannot be casted to the desired type, or if the expression result itself is <code class="literal">null</code>.
			</p><p>
				The <code class="literal">cast</code> function adheres to the following type conversion rules:
			</p><div class="itemizedlist"><ul><li><p>
						For all numeric types, the <code class="literal">cast</code> function utilitzes <code class="literal">java.lang.Number</code> to convert numeric types, if required. 
					</p></li><li><p>
						For casts to <code class="literal">string</code> or <code class="literal">java.lang.String</code>, the function calls <code class="literal">toString</code> on the expression result.
					</p></li><li><p>
						For casts to other objects including application objects, the <code class="literal">cast</code> function considers a Java class's superclasses as well as all directly or indirectly-implemented interfaces by superclasses.
					</p></li></ul></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-single-row-function-cast-parsedate"/>10.1.2.1.Â The <code class="literal">Cast</code> Function For Parsing Dates</h4></div></div></div><a id="d0e25969" class="indexterm"/><p>
					The <code class="literal">cast</code> function can parse string-type date-time values to long-type milliseconds, <code class="literal">Date</code>, <code class="literal">Calendar</code>, <code class="literal">LocalDateTime</code>, <code class="literal">ZonedDateTime</code>, <code class="literal">LocalDate</code> and <code class="literal">LocalTime</code> objects.
				</p><p>
					You must provide the <code class="literal">dateformat</code> named parameter as the last parameter to the <code class="literal">cast</code> function. 
					The <code class="literal">dateformat</code> parameter expression must return a <code class="literal">String</code>-typed value, a <code class="literal">SimpleDateFormat</code>-type value or a <code class="literal">DateTimeFormatter</code>-type value. 
					Return a <code class="literal">SimpleDateFormat</code> for <code class="literal">long</code>/<code class="literal">Date</code>/<code class="literal">Calendar</code>.
					Return a <code class="literal">DateTimeFormatter</code> for <code class="literal">LocalDateTime</code>/<code class="literal">ZonedDateTime</code>/<code class="literal">LocalDate</code>/<code class="literal">LocalTime</code>.
				</p><p>
					The next EPL outputs the date May 2, 2010 as a <code class="literal">Date</code>-type value:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select cast('20100502', date, dateformat: 'yyyyMMdd') from OrderEvent</pre><p>
					You may use date-time methods when <code class="literal">cast</code> is returning a date-time value. Expressions can be any expression and do not need to be string constants.
				</p><p>
					You may parse dates that are ISO 8601-formatted dates by specifying <code class="literal">iso</code> as the date format. The ISO 8601 date format is described in <a class="xref" href="#pattern-timer-schedule-date" title="7.6.5.1.1.Â Specifying Dates">SectionÂ 7.6.5.1.1, âSpecifying Datesâ</a>.
				</p><p>
					For example, assuming the <code class="literal">orderDate</code> property is a ISO 8601 formatted date, the engine can convert it to a long millisecond value like this:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select cast(orderDate, long, dateformat: 'iso') from OrderEvent</pre><p>
					The next table shows the recognized date types available:
				</p><div class="table"><a id="epl-single-row-function-cast-parsedate-types"/><p class="title"><b>TableÂ 10.2.Â Date Types for Casting/Parsing</b></p><div class="table-contents"><table summary="Date Types for Casting/Parsing" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Value provided to Cast as the second parameter</th><th>Result Type</th></tr></thead><tbody><tr><td><code class="literal">date</code>, <code class="literal">java.util.Date</code></td><td><code class="literal">java.util.Date</code></td></tr><tr><td><code class="literal">calendar</code>, <code class="literal">java.util.Calendar</code></td><td><code class="literal">java.util.Calendar</code></td></tr><tr><td><code class="literal">long</code>, <code class="literal">java.lang.Long</code></td><td><code class="literal">long</code></td></tr><tr><td><code class="literal">localdatetime</code>, <code class="literal">java.time.LocalDateTime</code></td><td><code class="literal">java.time.LocalDateTime</code></td></tr><tr><td><code class="literal">localdate</code>, <code class="literal">java.time.LocalDate</code></td><td><code class="literal">java.time.LocalDate</code></td></tr><tr><td><code class="literal">localtime</code>, <code class="literal">java.time.LocalTime</code></td><td><code class="literal">java.time.LocalTime</code></td></tr><tr><td><code class="literal">zoneddatetime</code>, <code class="literal">java.time.ZonedDateTime</code></td><td><code class="literal">java.time.ZonedDateTime</code></td></tr></tbody></table></div></div><br class="table-break"/></div><p>
				Additional examples are:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select cast(orderDate, localdatetime, dateformat:java.time.format.DateTimeFormatter.ISO_DATE_TIME) from OrderEvent</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select cast(orderDate, calendar, dateformat:SimpleDateFormat.getInstance()) from OrderEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-single-row-function-ref-coalesce"/>10.1.3.Â The <code class="literal">Coalesce</code> Function</h3></div></div></div><a id="d0e26167" class="indexterm"/><a id="d0e26170" class="indexterm"/><p>
				The result of the <code class="literal">coalesce</code> function is the first expression in a list of expressions that returns a non-null value. The return type is the compatible aggregated type of all return values.
			</p><p>
				This example returns a String-typed result of value 'foo':
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select coalesce(null, 'foo') from ...</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-single-row-function-ref-currentevaluationcontext"/>10.1.4.Â The <code class="literal">Current_Evaluation_Context</code> Function</h3></div></div></div><a id="d0e26190" class="indexterm"/><a id="d0e26193" class="indexterm"/><p>
				The <code class="literal">current_evaluation_context</code> function takes no parameters and returns expression evaluation contextual information as an object of type
				<code class="literal">com.espertech.esper.client.hook.EPLExpressionEvaluationContext</code>. The object provides the engine URI, the statement name and the context partition id of 
				the currently-evaluated expression.
			</p><p>
				For example:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select current_evaluation_context().getEngineURI() as engineURI from MyEvent</pre><p>
				The context partition id will be <code class="literal">-1</code> when the statement is not associated to a context.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-single-row-function-ref-currenttime"/>10.1.5.Â The <code class="literal">Current_Timestamp</code> Function</h3></div></div></div><a id="d0e26221" class="indexterm"/><a id="d0e26224" class="indexterm"/><p>
				The <code class="literal">current_timestamp</code> function is a reserved keyword and requires no parameters. The result of the <code class="literal">current_timestamp</code> function is the <code class="literal">long</code>-type value of the current engine system time.
			</p><p>
				The function returns the current engine timestamp at the time of expression evaluation. When using external-timer events, the function provides the last value of the externally-supplied time at the time of expression evaluation.
			</p><p>
				This example selects the current engine time:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select current_timestamp from MyEvent
// equivalent to
select current_timestamp() from MyEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-single-row-function-exists"/>10.1.6.Â The <code class="literal">Exists</code> Function</h3></div></div></div><a id="d0e26252" class="indexterm"/><a id="d0e26255" class="indexterm"/><p>
				The <code class="literal">exists</code> function returns a boolean value indicating whether the dynamic property, provided as a parameter to the function, exists on the event. The <code class="literal">exists</code> function accepts a single dynamic property name as its only parameter. 
			</p><p>
				The <code class="literal">exists</code> function is for use with dynamic (unchecked) properties. Dynamic properties are properties whose type is not known at compile type. Dynamic properties return a null value
				if the dynamic property does not exists on an event, or if the dynamic property exists but the value of the dynamic property is null. 
			</p><p>
				The <code class="literal">exists</code> function as shown next returns true if the "item" property contains an object that has a "serviceName" property. It returns false if the "item" property is null, or if the "item" property does not 
				contain an object that has a property named "serviceName" :
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select exists(item.serviceName?) from OrderEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-single-row-function-grouping"/>10.1.7.Â The <code class="literal">Grouping</code> Function</h3></div></div></div><a id="d0e26286" class="indexterm"/><a id="d0e26289" class="indexterm"/><p>
				The <code class="literal">grouping</code> function is a SQL-standard function useful in statements that have a <code class="literal">group by</code>-clause and that utilize one of the <code class="literal">rollup</code>, <code class="literal">cube</code> or <code class="literal">grouping sets</code> keywords. The function can be used only in the <code class="literal">select</code>-clause, <code class="literal">having</code>-clause and <code class="literal">order by</code>-clauses.
			</p><p>
				The function takes a single expression as a parameter and returns an integer value of zero or one indicating whether a specified expression in a <code class="literal">group-by</code>-clause is aggregated or not. 
				The function returns 1 for aggregated or 0 for not aggregated. 
			</p><p>
				The <code class="literal">grouping</code> function can help you distinguish null values returned because of the output row's aggregation level from null values returned by event properties or other expressions. 
			</p><p>
				The parameter expression must match exactly one of the expressions in the <code class="literal">group-by</code>-clause.
			</p><p>
				Please see an example in the next section.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-single-row-function-groupingid"/>10.1.8.Â The <code class="literal">Grouping_Id</code> Function</h3></div></div></div><a id="d0e26343" class="indexterm"/><a id="d0e26346" class="indexterm"/><p>
				The <code class="literal">grouping_id</code> function is a SQL-standard function useful in statements that have a <code class="literal">group by</code>-clause and that utilize one of the <code class="literal">rollup</code>, <code class="literal">cube</code> or <code class="literal">grouping sets</code> keywords. The function can be used only in the <code class="literal">select</code>-clause, <code class="literal">having</code>-clause and <code class="literal">order by</code>-clauses.
			</p><p>
				The function takes one or more expressions as a parameter and returns an integer value indicating grouping level. The engine computes the grouping level by taking the results of multiple <code class="literal">grouping</code> functions and concatenating them into a bit vector (a string of ones and zeros).
			</p><p>
				Assume a car event that has a property for name, place and number of cars:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema CarEvent(name string, place string, numcars int)</pre><p>
				The next EPL computes the total number of cars for each of the following groupings: per name and place, per name, per place and overall.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select name, place, sum(numcars), grouping(name), grouping(place), grouping_id(name, place)
from CarEvent group by grouping sets((name, place),name, place,())</pre><p>
				Assume your application processes a car event with properties like so: <code class="literal">CarEvent={name='skoda', place='france', numcars=100}</code>.
			</p><p>
				The engine outputs 4 rows as shown in the next table:
			</p><div class="table"><a id="epl-single-row-function-grouping-out1"/><p class="title"><b>TableÂ 10.3.Â Example Output for <code class="literal">Grouping</code> and <code class="literal">Grouping_id</code> Functions (CarEvent 1)</b></p><div class="table-contents"><table summary="Example Output for Grouping and Grouping_id Functions (CarEvent 1)" border="1"><colgroup><col/><col/><col/><col/><col/><col/></colgroup><thead><tr><th>name</th><th>place</th><th>sum(numcars)</th><th>grouping(name)</th><th>grouping(place)</th><th>grouping_id(name, place)</th></tr></thead><tbody><tr><td>skoda</td><td>france</td><td>100</td><td>0</td><td>0</td><td>0</td></tr><tr><td>skoda</td><td>null</td><td>100</td><td>0</td><td>1</td><td>1</td></tr><tr><td>null</td><td>france</td><td>100</td><td>1</td><td>0</td><td>2</td></tr><tr><td>null</td><td>null</td><td>100</td><td>1</td><td>1</td><td>3</td></tr></tbody></table></div></div><br class="table-break"/><p>
				Assume your application processes a second car event: <code class="literal">CarEvent={name='skoda', place='germany', numcars=75}</code>.
			</p><p>
				The engine outputs 4 rows as shown in the next table:
			</p><div class="table"><a id="epl-single-row-function-grouping-out2"/><p class="title"><b>TableÂ 10.4.Â Example Output for <code class="literal">Grouping</code> and <code class="literal">Grouping_id</code> Functions (CarEvent 2)</b></p><div class="table-contents"><table summary="Example Output for Grouping and Grouping_id Functions (CarEvent 2)" border="1"><colgroup><col/><col/><col/><col/><col/><col/></colgroup><thead><tr><th>name</th><th>place</th><th>sum(numcars)</th><th>grouping(name)</th><th>grouping(place)</th><th>grouping_id(name, place)</th></tr></thead><tbody><tr><td>skoda</td><td>germany</td><td>75</td><td>0</td><td>0</td><td>0</td></tr><tr><td>skoda</td><td>null</td><td>175</td><td>0</td><td>1</td><td>1</td></tr><tr><td>null</td><td>germany</td><td>75</td><td>1</td><td>0</td><td>2</td></tr><tr><td>null</td><td>null</td><td>175</td><td>1</td><td>1</td><td>3</td></tr></tbody></table></div></div><br class="table-break"/><p>
				The parameter expressions must match exactly to expressions in the <code class="literal">group-by</code>-clause.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-single-row-function-instanceof"/>10.1.9.Â The <code class="literal">Instance-Of</code> Function</h3></div></div></div><a id="d0e26581" class="indexterm"/><a id="d0e26584" class="indexterm"/><p>
				The <code class="literal">instanceof</code> function returns a boolean value indicating whether the type of value returned by the expression is one of the given types. The first parameter to the <code class="literal">instanceof</code> function is an expression to evaluate. The second and subsequent parameters are Java type names.
			</p><p>
				The function determines the return type of the expression at runtime by evaluating the expression, and compares the type of object returned by the expression to the defined types. 
				If the type of object returned by the expression matches any of the given types, the function returns <code class="literal">true</code>. If the expression returned <code class="literal">null</code> or a type that does not
				match any of the given types, the function returns <code class="literal">false</code>.
			</p><p>
				The <code class="literal">instanceof</code> function is often used in conjunction with dynamic (unchecked) properties. Dynamic properties are properties whose type is not known at compile type. 
			</p><p>
				This example uses the <code class="literal">instanceof</code> function to select different properties based on the type:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select case when instanceof(item, com.mycompany.Service) then serviceName?
  when instanceof(item, com.mycompany.Product) then productName? end 
  from OrderEvent</pre><p>
				The <code class="literal">instanceof</code> function returns <code class="literal">false</code> if the expression tested by instanceof returned null.
			</p><p>
				Valid parameters for the type parameter list are:
			</p><div class="itemizedlist"><ul><li><p>
						Any of the Java built-in types: <code class="literal">int, long, byte, short, char, double, float, string</code>, where <code class="literal">string</code>  is a short notation for <code class="literal">java.lang.String</code>. The type name is not case-sensitive. For example, the next function tests if the dynamic "price" property is either of type float or type double:
						</p><pre class="synopsis">instanceof(price?, double, float)</pre><p>
					</p></li><li><p>
						The fully-qualified class name of the class to cast to, for example: </p><pre class="synopsis">instanceof(product, org.myproducer.Product)</pre><p>
					</p></li></ul></div><p>
				The function considers an event class's superclasses as well as all the directly or indirectly-implemented interfaces by superclasses.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-single-row-function-istream"/>10.1.10.Â The <code class="literal">Istream</code> Function</h3></div></div></div><a id="d0e26660" class="indexterm"/><a id="d0e26663" class="indexterm"/><p>
				The <code class="literal">istream</code> function returns a boolean value indicating whether within the context of expression evaluation the current event or set of events (joins) are part of the insert stream (true) or part of the remove stream (false). The function takes no parameters.
			</p><p>
				Use the <code class="literal">istream</code> function with data windows and <code class="literal">select irstream</code> and <code class="literal">insert irstream into</code>. 
			</p><p>
				In the following example the <code class="literal">istream</code> function always returns boolean true since no data window is declared:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream *, istream() from OrderEvent</pre><p>
				The next example declares a data window. For newly arriving events the function returns boolean true, for events that expire after 10 seconds the function returns boolean false:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream *, istream() from OrderEvent#time(10 sec)</pre><p>
			   The <code class="literal">istream</code> function returns true for all cases where insert or remove stream does not apply, such as when used in parameter expressions to data windows
			   or in stream filter expressions.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-single-row-function-ref-minmax"/>10.1.11.Â The <code class="literal">Min</code> and <code class="literal">Max</code> Functions</h3></div></div></div><a id="d0e26709" class="indexterm"/><a id="d0e26712" class="indexterm"/><a id="d0e26717" class="indexterm"/><a id="d0e26720" class="indexterm"/><p>
				The <code class="literal">min</code> and <code class="literal">max</code> function take two or more parameters that itself can be expressions. The <code class="literal">min</code> function returns the lowest numeric value among the 2 or more comma-separated expressions, while the <code class="literal">max</code> function returns the highest numeric value.
				The return type is the compatible aggregated type of all return values.
			</p><p>
				The next example shows the <code class="literal">max</code> function that has a <code class="literal">Double</code> return type and returns the value 1.1.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select max(1, 1.1, 2 * 0.5) from ...</pre><p>
				The <code class="literal">min</code> function returns the lowest value. The statement below uses the function to determine the smaller of two timestamp values.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, min(ticks.timestamp, news.timestamp) as minT
	from StockTickEvent#time(30 sec) as ticks, NewsEvent#time(30 sec) as news
	where ticks.symbol = news.symbol</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-single-row-function-ref-previous"/>10.1.12.Â The <code class="literal">Previous</code> Function</h3></div></div></div><a id="d0e26762" class="indexterm"/><a id="d0e26765" class="indexterm"/><p>
				The <code class="literal">prev</code> function returns the property value or all event properties of a previous event. For data windows that introduce a sort order other than the order of arrival, such as the sorted data window and the time order data window,  the function returns the event at the specified position.
			</p><p>
				The <code class="literal">prev</code> function is not an aggregation function and therefore does not return results per group when used with <code class="literal">group by</code>. Please consider the <code class="literal">last</code>, <code class="literal">lastever</code> or <code class="literal">first</code> aggregation functions instead as described in <a class="xref" href="#epl-function-aggregation-event" title="10.2.2.Â Event Aggregation Functions">SectionÂ 10.2.2, âEvent Aggregation Functionsâ</a>. You must use an aggregation function instead of <code class="literal">prev</code> when querying a named window or table.
			</p><p>
				The first parameter to the <code class="literal">prev</code> function is an index parameter and denotes the i-th previous event, in the order established by the data window. If no index is provided, the default index is 1 and the function returns the previous event.
				The second parameter is a property name or stream name. If specifying a property name, the function returns the value for the previous event property value. If specifying a stream name, the function returns the previous event underlying object.
			</p><p>
				This example selects the value of the <code class="literal">price</code> property of the 2nd-previous event from the current Trade event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prev(2, price) from Trade#length(10)</pre><p>
				By using the stream alias in the <code class="literal">previous</code> function, the next example selects the trade event itself that is immediately previous to the current Trade event
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prev(1, trade) from Trade#length(10) as trade</pre><p>
				Since the <code class="literal">prev</code> function takes the order established by the data window into account, the function works well with sorted windows.
			</p><p>
				In the following example the statement selects the symbol of the 3 Trade events that had the largest, second-largest and third-largest volume.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prev(0, symbol), prev(1, symbol), prev(2, symbol)
  from Trade#sort(3, volume desc)</pre><p>
				The i-th previous event parameter can also be an expression returning an Integer-type value. The next statement joins the Trade data window with an <code class="literal">RankSelectionEvent</code> event that provides a <code class="literal">rank</code> property used to look up a certain position in the sorted Trade data window:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prev(rank, symbol) from Trade#sort(10, volume desc), RankSelectionEvent unidirectional</pre><p>
				Use the <code class="literal">prev</code> function in combination with a grouped data window to access a previous event per grouping criteria.
			</p><p>
				The example below returns the price of the previous Trade event for the same symbol, or <code class="literal">null</code> if for that symbol there is no previous Trade event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prev(1, price) from Trade#groupwin(symbol)#length(2)</pre><p>
				The <code class="literal">prev</code> function returns a <code class="literal">null</code> value if the data window does not currently hold the i-th previous event. The example below illustrates this using a time batch window. Here the <code class="literal">prev</code>  
				function returns a null value for any events in which the previous event is not in the same batch of events. Note that the <code class="literal">prior</code> function as discussed below can be used if a null value is not the desired result.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prev(1, symbol) from Trade#time_batch(1 min)</pre><p>
				An alternative form of the <code class="literal">prev</code> function allows the index to not appear or appear after the property name if the index value is a constant and not an expression:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prev(1, symbol) from Trade
// ... equivalent to ...
select prev(symbol) from Trade
// ... and ...
select prev(symbol, 1) from Trade</pre><p>
				The combination of the <code class="literal">prev</code> function and <code class="literal">#groupwin</code> returns the property value for a previous event in the given data window group. 
			</p><p>
				The following example returns for each event the current smallest price per symbol:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, prev(0, price) as topPricePerSymbol 
from Trade#groupwin(symbol)#sort(1, price asc)</pre><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-single-row-function-ref-prev-restrictions"/>10.1.12.1.Â Restrictions</h4></div></div></div><p>
						The following restrictions apply to the <code class="literal">prev</code> functions and its results:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							The function always returns a <code class="literal">null</code> value for remove stream (old data) events.
						</p></li><li><p>
							The function requires a data window, or <code class="literal">#groupwin</code> and a data window. See <a class="xref" href="#win-views" title="13.3.Â Data Windows">SectionÂ 13.3, âData Windowsâ</a> for data windows.
						</p></li></ul></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-single-row-function-ref-prev-prior"/>10.1.12.2.Â Comparison to the <code class="literal">Prior</code> Function</h4></div></div></div><p>
					The <code class="literal">prev</code> function is similar to the <code class="literal">prior</code> function. The key differences between the two functions are as follows:				 
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							The <code class="literal">prev</code> function returns previous events in the order provided by the data window, while the <code class="literal">prior</code> function returns prior events in the order of arrival as posted by a stream's declared windows.
						</p></li><li><p>
							The <code class="literal">prev</code> function requires a data window while the <code class="literal">prior</code> function does not have any such requirement.
						</p></li><li><p>
							The <code class="literal">prev</code> function returns the previous event grouped by a criteria by combining the <code class="literal">#groupwin</code> and a data window. The <code class="literal">prior</code> function returns prior events posted regardless of data window grouping.
						</p></li><li><p>
							The <code class="literal">prev</code> function returns a <code class="literal">null</code> value for remove stream events, i.e. for events leaving a data window. 
							The <code class="literal">prior</code> function does not have this restriction.
						</p></li></ul></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-single-row-function-ref-previoustail"/>10.1.13.Â The <code class="literal">Previous-Tail</code> Function</h3></div></div></div><a id="d0e26968" class="indexterm"/><a id="d0e26971" class="indexterm"/><p>
				The <code class="literal">prevtail</code> function returns the property value or all event properties of the positional-first event in a data window. For data windows that introduce a sort order other than the order of arrival, such as the sorted data window and the time order data window, the function returns the first event at the specified position.
			</p><p>
				The <code class="literal">prevtail</code> function is not an aggregation function and therefore does not return results per group when used with <code class="literal">group by</code>. Please consider the <code class="literal">first</code>, <code class="literal">firstever</code> or <code class="literal">window</code> aggregation functions instead as described in <a class="xref" href="#epl-function-aggregation-event" title="10.2.2.Â Event Aggregation Functions">SectionÂ 10.2.2, âEvent Aggregation Functionsâ</a>. You must use an aggregation function instead of <code class="literal">prevtail</code> when querying a named window or table.
			</p><p>
				The first parameter is an index parameter and denotes the i-th from-first event in the order established by the data window. If no index is provided the default is zero and the function returns the first event in the data window.
				The second parameter is a property name or stream name. If specifying a property name, the function returns the value for the previous event property value. If specifying a stream name, the function returns the previous event underlying object.
			</p><p>
				This example selects the value of the <code class="literal">price</code> property of the first (oldest) event held in the length window:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prevtail(price) from Trade#length(10)</pre><p>
				By using the stream alias in the <code class="literal">prevtail</code> function, the next example selects the trade event itself that is the second event held in the length window:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prevtail(1, trade) from Trade#length(10) as trade</pre><p>
				Since the <code class="literal">prevtail</code> function takes the order established by the data window into account, the function works well with sorted windows.
			</p><p>
				In the following example the statement selects the symbol of the 3 Trade events that had the smallest, second-smallest and third-smallest volume.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prevtail(0, symbol), prevtail(1, symbol), prevtail(2, symbol)
  from Trade#sort(3, volume asc)</pre><p>
				The i-th previous event parameter can also be an expression returning an Integer-type value. The next statement joins the Trade data window with an <code class="literal">RankSelectionEvent</code> event that provides a <code class="literal">rank</code> property used to look up a certain position in the sorted Trade data window:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prevtail(rank, symbol) from Trade#sort(10, volume asc), RankSelectionEvent unidirectional</pre><p>
				The <code class="literal">prev</code> function returns a <code class="literal">null</code> value if the data window does not currently holds positional-first or the Nth-from-first event. For batch data windows the value returned is relative to the current batch.
			</p><p>
				The following example returns the first and second symbol value in the batch:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prevtail(0, symbol), prevtail(1, symbol) from Trade#time_batch(1 min)</pre><p>
				An alternative form of the <code class="literal">prevtail</code> function allows the index to not appear or appear after the property name if the index value is a constant and not an expression:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prevtail(1, symbol) from Trade
// ... equivalent to ...
select prevtail(symbol) from Trade
// ... and ...
select prevtail(symbol, 1) from Trade</pre><p>
				The combination of the <code class="literal">prevtail</code> function and <code class="literal">#groupwin</code> returns the property value for a positional first event in the given data window group. 
			</p><p>
				Let's look at an example. This statement outputs the oldest price per symbol retaining the last 10 prices per symbol:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, prevtail(0, price) as oldestPrice
from Trade#groupwin(symbol)#length(10)</pre><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-single-row-function-ref-prevtail-restrictions"/>10.1.13.1.Â Restrictions</h4></div></div></div><p>
						The following restrictions apply to the <code class="literal">prev</code> functions and its results:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							The function always returns a <code class="literal">null</code> value for remove stream (old data) events.
						</p></li><li><p>
							The function requires a data window, or a <code class="literal">#groupwin</code> and a data window. See <a class="xref" href="#win-views" title="13.3.Â Data Windows">SectionÂ 13.3, âData Windowsâ</a> for built-in data windows.
						</p></li></ul></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-single-row-function-ref-previouswindow"/>10.1.14.Â The <code class="literal">Previous-Window</code> Function</h3></div></div></div><a id="d0e27098" class="indexterm"/><a id="d0e27101" class="indexterm"/><p>
				The <code class="literal">prevwindow</code> function returns property values or all event properties for all events in a data window. For data windows that introduce a sort order other than the order of arrival, such as the sorted data window and the time order data window, the function returns the event data sorted in that order, otherwise it returns the events sorted by order of arrival with the newest arriving event first.
			</p><p>
				The <code class="literal">prevwindow</code> function is not an aggregation function and therefore does not return results per group when used with <code class="literal">group by</code>. Please consider the <code class="literal">window</code> aggregation function instead as described in <a class="xref" href="#epl-function-aggregation-event" title="10.2.2.Â Event Aggregation Functions">SectionÂ 10.2.2, âEvent Aggregation Functionsâ</a>. You must use an aggregation function instead of <code class="literal">prevwindow</code> when querying a named window or table.
			</p><p>
				The single parameter is a property name or stream name. If specifying a property name, the function returns the value of the event property for all events held by the data window. If specifying a stream name, the function returns the event underlying object for all events held by the data window.
			</p><p>
				This example selects the value of the <code class="literal">price</code> property of all events held in the length window:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prevwindow(price) from Trade#length(10)</pre><p>
				By using the stream alias in the <code class="literal">prevwindow</code> function, the next example selects all trade events held in the length window:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prevwindow(trade) from Trade#length(10) as trade</pre><p>
				When used with a data window that introduces a certain sort order, the <code class="literal">prevwindow</code> function returns events sorted according to that sort order.
			</p><p>
			  The next statement outputs for every arriving event the current 10 underying trade event objects that have the largest volume:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prevwindow(trade) from Trade#sort(10, volume desc) as trade</pre><p>
				The <code class="literal">prevwindow</code> function returns a <code class="literal">null</code> value if the data window does not currently hold any events.
			</p><p>
				The combination of the <code class="literal">prevwindow</code> function and <code class="literal">#groupwin</code> returns the property value(s) for all events in the given data window group. 
			</p><p>
				This example statement outputs all prices per symbol retaining the last 10 prices per symbol:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, prevwindow(price) from Trade#groupwin(symbol)#length(10)</pre><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-single-row-function-ref-prevwindow-restrictions"/>10.1.14.1.Â Restrictions</h4></div></div></div><p>
					The following restrictions apply to the <code class="literal">prev</code> functions and its results:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							The function always returns a <code class="literal">null</code> value for remove stream (old data) events.
						</p></li><li><p>
							The function requires a data window, or <code class="literal">#groupwin</code> and a data window. See <a class="xref" href="#win-views" title="13.3.Â Data Windows">SectionÂ 13.3, âData Windowsâ</a> for built-in data windows.
						</p></li></ul></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-single-row-function-ref-previouscount"/>10.1.15.Â The <code class="literal">Previous-Count</code> Function</h3></div></div></div><a id="d0e27201" class="indexterm"/><a id="d0e27204" class="indexterm"/><p>
				The <code class="literal">prevcount</code> function returns the number of events held in a data window.
			</p><p>
				The <code class="literal">prevcount</code> function is not an aggregation function and therefore does not return results per group when used with <code class="literal">group by</code>. Please consider the <code class="literal">count(*)</code> or <code class="literal">countever</code> aggregation functions instead as described in <a class="xref" href="#epl-function-aggregation" title="10.2.Â Aggregation Functions">SectionÂ 10.2, âAggregation Functionsâ</a>. You must use an aggregation function instead of <code class="literal">prevcount</code> when querying a named window or table.
			</p><p>
				The single parameter is a property name or stream name of the data window to return the count for.
			</p><p>
				This example selects the number of data points for the <code class="literal">price</code> property held in the length window:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prevcount(price) from Trade#length(10)</pre><p>
				By using the stream alias in the <code class="literal">prevcount</code> function the next example selects the count of trade events held in the length window:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prevcount(trade) from Trade#length(10) as trade</pre><p>
				The combination of the <code class="literal">prevcount</code> function and <code class="literal">#groupwin</code> returns the count of events in the given data window group. 
			</p><p>
				This example statement outputs the number of events retaining the last 10 events per symbol:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, prevcount(price) from Trade#groupwin(symbol)#length(10)</pre><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-single-row-function-ref-prevcount-restrictions"/>10.1.15.1.Â Restrictions</h4></div></div></div><p>
					The following restrictions apply to the <code class="literal">prev</code> functions and its results:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							The function always returns a <code class="literal">null</code> value for remove stream (old data) events.
						</p></li><li><p>
							The function requires a data window, or a <code class="literal">#groupwin</code> and a data window. See <a class="xref" href="#win-views" title="13.3.Â Data Windows">SectionÂ 13.3, âData Windowsâ</a> for built-in data windows.
						</p></li></ul></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-single-row-function-ref-prior"/>10.1.16.Â The <code class="literal">Prior</code> Function</h3></div></div></div><a id="d0e27290" class="indexterm"/><a id="d0e27293" class="indexterm"/><p>
				The <code class="literal">prior</code> function returns the property value of a prior event. 
				The first parameter is an expression returning a constant integer-typed value that denotes the i-th prior event in the natural order of arrival. 
				The second parameter is a property name for which the function returns the value for the prior event.
				The second parameter is a property name or stream name. If specifying a property name, the function returns the property value for the prior event. If specifying a stream name, the function returns the prior event underlying object.
			</p><p>
				This example selects the value of the <code class="literal">price</code> property of the 2nd-prior event to the current Trade event.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prior(2, price) from Trade</pre><p>
				By using the stream alias in the <code class="literal">prior</code> function, the next example selects the trade event itself that is immediately prior to the current Trade event
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prior(1, trade) from Trade as trade</pre><p>
				The <code class="literal">prior</code> function can be used on any event stream and does not require declaring a data window.  The function operates on the order of arrival of events by the event stream that provides the events.
			</p><p>
				The next statement uses a time batch window to compute an average volume for 1 minute of Trade events, posting results every minute. The select-clause 
				employs the <code class="literal">prior</code> function to select the current average and the average before the current average:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select average, prior(1, average) 
    from TradeAverages#time_batch(1 min)#uni(volume)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-single-row-function-typeof"/>10.1.17.Â The <code class="literal">Type-Of</code> Function</h3></div></div></div><a id="d0e27335" class="indexterm"/><a id="d0e27338" class="indexterm"/><p>
				The <code class="literal">typeof</code> function, when parameterized by a stream name, returns the event type name of the evaluated event which can be useful with variant streams. When parameterized by an expression or property name, the function returns the type name of the expression result or <code class="literal">null</code> if the expression result is null.
			</p><p>
				In summary, the function determines the return type of the expression at runtime by evaluating the expression and returns the type name of the expression result.
			</p><p>
				The <code class="literal">typeof</code> function is often used in conjunction with variant streams. A variant stream is a predefined stream into which events of multiple disparate event types can be inserted. The <code class="literal">typeof</code> function, when passed a stream name alias, returns the name of the event type of each event in the stream.
			</p><p>
			    The following example elaborates on the use of variant streams with <code class="literal">typeof</code>. The first statement declares a variant stream <code class="literal">SequencePatternStream</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create variant schema SequencePatternStream as *</pre><p>
			    The next statement inserts all order events and is followed by a statement to insert all product events: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into SequencePatternStream select * from OrderEvent;</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into SequencePatternStream select * from PriceEvent;</pre><p>
				This example statement returns the event type name for each event in the variant stream:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select typeof(sps) from SequencePatternStream as sps</pre><p>
				The next example statement detects a pattern by utilizing the <code class="literal">typeof</code> function to find pairs of order event immediately followed by product event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from SequencePatternStream match_recognize(
  measures A as a, B as b
  pattern (A B)
  define A as typeof(A) = "OrderEvent",
         B as typeof(B) = "ProductEvent"
  )</pre><p>
				When passing a property name to the <code class="literal">typeof</code> function, the function evaluates whether the property type is event type (a fragment event type). If the property type is event type, the function returns the type name of the event in the property value or <code class="literal">null</code> if not provided. 
				If the property type is not event type, the function returns the simple class name of the property value.
			</p><p>
				When passing an expression to the <code class="literal">typeof</code> function, the function evaluates the expression and returns the simple class name of the expression result value or <code class="literal">null</code> if the expression result value is null.
			</p><p>
				This example statement returns the simple class name of the value of the dynamic property <code class="literal">prop</code> of events in stream <code class="literal">MyStream</code>, or a <code class="literal">null</code> value if the property is not found for an event or the property value itself is <code class="literal">null</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select typeof(prop?) from MyStream</pre><p>
			    When using subclasses or interface implementations as event classes or when using Map-event type inheritance, the function returns the event type name provided when the class or Map-type event was registered, or if the event type was not registered, the function returns the fully-qualified class name.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-function-aggregation"/>10.2.Â Aggregation Functions</h2></div></div></div><a id="d0e27425" class="indexterm"/><p>
			Aggregation functions are stateful and consider sets of events or value points. The <code class="literal">group by</code> clause is often used in conjunction with aggregation functions to group the result-set by one or more columns.
		</p><p>
			Aggregation functions can be a column type for table declarations. This allows easy sharing of aggregated state, co-location of aggregations and other data 
			as well as co-aggregation by multiple statements into the same aggregation state.			
			Please see <a class="xref" href="#nwtable-overview-table" title="6.1.2.Â Table Overview">SectionÂ 6.1.2, âTable Overviewâ</a> for details.
		</p><p>
			The EPL language extends the standard SQL aggregation functions by allowing filters and by further useful aggregation functions that can track a data window or compute event rates, for example. Your application may also add its own aggregation function as <a class="xref" href="#custom-aggregation-function" title="17.5.Â Aggregation Function">SectionÂ 17.5, âAggregation Functionâ</a> describes.
		</p><p>
			The EPL language allows each aggregation function to specify its own grouping criteria. Please find further information in <a class="xref" href="#epl-grouping-agglocal" title="5.6.4.Â Specifying Grouping for Each Aggregation Function">SectionÂ 5.6.4, âSpecifying Grouping for Each Aggregation Functionâ</a>.
		</p><p>
			The EPL language allows each aggregation function to specify its own filter criteria. Please find further information in <a class="xref" href="#epl-grouping-aggfilter" title="5.6.5.Â Specifying a Filter Expression for Each Aggregation Function">SectionÂ 5.6.5, âSpecifying a Filter Expression for Each Aggregation Functionâ</a>.
		</p><p>
			Aggregation values are always computed incrementally: Insert and remove streams result in aggregation value changes. The exceptions are on-demand queries and joins when using the <code class="literal">unidirectional</code> keyword. Aggregation functions are optimized to retain the minimal
				information necessary to compute the aggregated result, and to share aggregation state between eligible other aggregation functions in the same statement so that same-kind aggregation state is
				never held multiple times unless required.
		</p><p>
			Most aggregation functions can also be used with unbound streams when no data window is specified. A few aggregation functions require a data window or named window as documented below.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-function-aggregation-std"/>10.2.1.Â SQL-Standard Functions</h3></div></div></div><p>
				The SQL-standard aggregation functions are shown in below table.
			</p><div class="table"><a id="epl-grouping-aggregate-func-table-SQL"/><p class="title"><b>TableÂ 10.5.Â Syntax and Results of SQL-Standard Aggregation Functions</b></p><div class="table-contents"><table summary="Syntax and Results of SQL-Standard Aggregation Functions" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Aggregate Function</th><th>Result</th></tr></thead><tbody><tr><td><pre class="synopsis">avedev([all|distinct] <span class="emphasis"><em>expression</em></span> [, <span class="emphasis"><em>filter_expr</em></span>])</pre></td><td>
								<p>
									Mean deviation of the (distinct) values in the expression, returning a value of <code class="literal">double</code> type.
								</p>
								<p>
									The optional filter expression limits the values considered for computing the mean deviation.
								</p>
							</td></tr><tr><td><pre class="synopsis">avg([all|distinct] <span class="emphasis"><em>expression</em></span> [, <span class="emphasis"><em>filter_expr</em></span>])</pre></td><td>
								<p>
									Average of the (distinct) values in the expression, returning a value of <code class="literal">double</code> type.
								</p>
								<p>
									The optional filter expression limits the values considered for computing the average.
								</p>
							</td></tr><tr><td><pre class="synopsis">count([all|distinct] <span class="emphasis"><em>expression</em></span> [, <span class="emphasis"><em>filter_expr</em></span>])</pre></td><td>
								<p>
									Number of the (distinct) non-null values in the expression, returning a value of <code class="literal">long</code> type.
								</p>
								<p>
									The optional filter expression limits the values considered for the count.
								</p>
							</td></tr><tr><td><pre class="synopsis">count(* [, <span class="emphasis"><em>filter_expr</em></span>])</pre></td><td>
								<p>
									Number of events, returning a value of <code class="literal">long</code> type.
								</p>
								<p>
									The optional filter expression limits the values considered for the count.
								</p>
							</td></tr><tr><td>
								<p>
									</p><pre class="synopsis">max([all|distinct] <span class="emphasis"><em>expression</em></span>)</pre><p>
								</p>
								<p>
									</p><pre class="synopsis">fmax([all|distinct] <span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>filter_expr</em></span>)</pre><p>
								</p>
							</td><td>
								<p>
									Highest (distinct) value in the expression, returning a value of the same type as the expression itself returns.
								</p>
								<p>
									Use <code class="literal">fmax</code> to provide a filter expression that limits the values considered for computing the maximum.
								</p>
								<p>
								    Consider using <code class="literal">maxby</code> instead if return values must include additional properties.
								</p>
							</td></tr><tr><td>
								<p>
									</p><pre class="synopsis">maxever([all|distinct] <span class="emphasis"><em>expression</em></span>)</pre><p>
								</p>
								<p>
									</p><pre class="synopsis">fmaxever([all|distinct] <span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>filter_expr</em></span>)</pre><p>
								</p>
							</td><td>
								<p>
									Highest (distinct) value - ever - in the expression, returning a value of the same type as the expression itself returns.
								</p>
								<p>
									Use <code class="literal">fmaxever</code> to provide a filter expression that limits the values considered for computing the maximum.
								</p>
								<p>
								    Consider using <code class="literal">maxbyever</code> instead if return values must include additional properties.
								</p>
							</td></tr><tr><td><pre class="synopsis">median([all|distinct] <span class="emphasis"><em>expression</em></span> [, <span class="emphasis"><em>filter_expr</em></span>])</pre></td><td>
								<p>
									Median (distinct) value in the expression, returning a value of <code class="literal">double</code> type. Double Not-a-Number (NaN) values are ignored in the median computation.
								</p>
								<p>
									The optional filter expression limits the values considered for computing the median.
								</p>
							</td></tr><tr><td>
								<p>
									</p><pre class="synopsis">min([all|distinct] <span class="emphasis"><em>expression</em></span>)</pre><p>
								</p>
								<p>
									</p><pre class="synopsis">fmin([all|distinct] <span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>filter_expr</em></span>)</pre><p>
								</p>
							</td><td>
								<p>
									Lowest (distinct) value in the expression, returning a value of the same type as the expression itself returns.
								</p>
								<p>
									Use <code class="literal">fmin</code> to provide a filter expression that limits the values considered for computing the maximum.
								</p>
								<p>
								    Consider using <code class="literal">minby</code> instead if return values must include additional properties.
								</p>
							</td></tr><tr><td>
								<p>
									</p><pre class="synopsis">minever([all|distinct] <span class="emphasis"><em>expression</em></span>)</pre><p>
								</p>
								<p>
									</p><pre class="synopsis">fminever([all|distinct] <span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>filter_expr</em></span>)</pre><p>
								</p>
							</td><td>
								<p>
									Lowest (distinct) value - ever - in the expression, returning a value of the same type as the expression itself returns.
								</p>
								<p>
									Use <code class="literal">fminever</code> to provide a filter expression that limits the values considered for computing the maximum.
								</p>
								<p>
								    Consider using <code class="literal">minbyever</code> instead if return values must include additional properties.
								</p>
							</td></tr><tr><td><pre class="synopsis">stddev([all|distinct] <span class="emphasis"><em>expression</em></span> [, <span class="emphasis"><em>filter_expr</em></span>])</pre></td><td>
								<p>
									Standard deviation of the (distinct) values in the expression, returning a value of <code class="literal">double</code> type.
								</p>
								<p>
									The optional filter expression limits the values considered for computing the standard deviation.
								</p>
							</td></tr><tr><td><pre class="synopsis">sum([all|distinct] <span class="emphasis"><em>expression</em></span> [, <span class="emphasis"><em>filter_expr</em></span>])</pre></td><td>
								<p>
									Totals the (distinct) values in the expression, returning a value of <code class="literal">long, double, float or integer</code> type depending on the expression.
								</p>
								<p>
									The optional filter expression limits the values considered for computing the total.
								</p>
							</td></tr></tbody></table></div></div><br class="table-break"/><p>
				If your application provides double-type values to an aggregation function, avoid using Not-a-Number (NaN) and infinity. Also when using double-type values, round-off errors (or rounding errors) may occur due to double-type precision. Consider rounding your result value to the desired precision.
			</p><p>
			  Each of the aggregation functions above takes an optional filter expression as a parameter. The filter expression must return a boolean-type value and applies to the events considered for the aggregation. 
			  If a filter expression is provided, then only if the filter expression returns a value of true does the engine update the aggregation for that event or combination of events. 
			</p><p>
			  Consider the following example, which computes the quantity fraction of buy orders among all orders:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(quantity, side='buy') / sum(quantity) as buy_fraction from Orders</pre><p>
				Use the <code class="literal">fmin</code> and <code class="literal">fmax</code> aggregation functions instead of the <code class="literal">min</code> and <code class="literal">max</code> aggregation functions when providing a filter expression (the <code class="literal">min</code> and <code class="literal">max</code> functions are also single-row functions).
			</p><p>
			  The next example computes the minimum quantity for buy orders and a separate minimum quantity for sell orders:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select fmin(quantity, side='buy'), fmin(quantity, side = 'sell') from Orders</pre><p>
			  This sample statement demonstrates specifying grouping criteria for an aggregation function using the <code class="literal">group_by</code> named parameter.
			  It computes, for the last one minute of orders, the ratio of orders per account compared to all orders:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*)/count(*, group_by:()) as ratio from Orders#time(1 min) group by account</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-function-aggregation-event"/>10.2.2.Â Event Aggregation Functions</h3></div></div></div><p>
				The event aggregation functions return one or more events or event properties. When used with <code class="literal">group by</code> the event aggregation functions 
				return one or more events or event properties per group.
			</p><p>
			  The <code class="literal">sorted</code> and the <code class="literal">window</code> event aggregation functions require that a data window or named window is declared for the applicable stream.
			  They cannot be used on unbound streams.
			</p><p>
				The below table summarizes the event aggregation functions available:
			</p><div class="table"><a id="event_aggregation_func_table"/><p class="title"><b>TableÂ 10.6.Â Event Aggregation Functions</b></p><div class="table-contents"><table summary="Event Aggregation Functions" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Function</th><th>Result</th></tr></thead><tbody><tr><td>first(...)</td><td>
								<p>
									Returns the first event or an event property value of the first event.
								</p>
								<p>
									<a class="xref" href="#epl-function-aggregation-event-first" title="10.2.2.1.Â First Aggregation Function">SectionÂ 10.2.2.1, âFirst Aggregation Functionâ</a>.
								</p>
							</td></tr><tr><td>last(...)</td><td>
								<p>
									Returns the last event or an event property value of the last event.
								</p>
								<p>
									<a class="xref" href="#epl-function-aggregation-event-last" title="10.2.2.2.Â Last Aggregation Function">SectionÂ 10.2.2.2, âLast Aggregation Functionâ</a>.
								</p>
							</td></tr><tr><td>maxby(criteria)</td><td>
								<p>
									Returns the event with the highest sorted value according to criteria expressions.
								</p>
								<p>
									<a class="xref" href="#epl-function-aggregation-event-maxby" title="10.2.2.3.Â Maxby Aggregation Function">SectionÂ 10.2.2.3, âMaxby Aggregation Functionâ</a>.
								</p>
							</td></tr><tr><td>maxbyever(criteria)</td><td>
								<p>
									Returns the event with the highest sorted value, ever, according to criteria expressions.
								</p>
								<p>
									<a class="xref" href="#epl-function-aggregation-event-maxbyever" title="10.2.2.4.Â Maxbyever Aggregation Function">SectionÂ 10.2.2.4, âMaxbyever Aggregation Functionâ</a>.
								</p>
							</td></tr><tr><td>minby(criteria)</td><td>
								<p>
									Returns the event with the lowest sorted value according to criteria expressions.
								</p>
								<p>
									<a class="xref" href="#epl-function-aggregation-event-minby" title="10.2.2.5.Â Minby Aggregation Function">SectionÂ 10.2.2.5, âMinby Aggregation Functionâ</a>.
								</p>
							</td></tr><tr><td>minbyever(criteria)</td><td>
								<p>
									Returns the event with the lowest sorted value, ever, according to criteria expressions.
								</p>
								<p>
									<a class="xref" href="#epl-function-aggregation-event-minbyever" title="10.2.2.6.Â Minbyever Aggregation Function">SectionÂ 10.2.2.6, âMinbyever Aggregation Functionâ</a>.
								</p>
							</td></tr><tr><td>sorted(criteria)</td><td>
								<p>
									Returns events sorted according to criteria expressions.
								</p>
								<p>
									<a class="xref" href="#epl-function-aggregation-event-sorted" title="10.2.2.7.Â Sorted Aggregation Function">SectionÂ 10.2.2.7, âSorted Aggregation Functionâ</a>.
								</p>
							</td></tr><tr><td>window(...)</td><td>
								<p>
									Returns all events or all event's property values.
								</p>
								<p>
									<a class="xref" href="#epl-function-aggregation-event-window" title="10.2.2.8.Â Window Aggregation Function">SectionÂ 10.2.2.8, âWindow Aggregation Functionâ</a>.
								</p>
							</td></tr></tbody></table></div></div><br class="table-break"/><p>
				   In connection with named windows and tables, event aggregation functions can also be used in <code class="literal">on-select</code>, 
				   selects with named window or table in the <code class="literal">from</code> clause, subqueries against named windows or tables and on-demand fire-and-forget queries.
				</p><p>
				   The event aggregation functions are often useful in connection with enumeration methods and they can provide input events for enumeration. Please see <a class="xref" href="#enumerationreference" title="ChapterÂ 11.Â EPL Reference: Enumeration Methods">ChapterÂ 11, <i>EPL Reference: Enumeration Methods</i></a> for more information. 
				</p><p>
					When comparing the <code class="literal">last</code> aggregation function to the <code class="literal">prev</code> function, the differences are as follows. The <code class="literal">prev</code> function is not an aggregation function and thereby not sensitive to the presence of <code class="literal">group by</code>. The <code class="literal">prev</code> function accesses data window contents directly and respects the sort order of the data window. The <code class="literal">last</code> aggregation function returns results based on arrival order and tracks data window contents in a separate shared data structure.
				</p><p>
					When comparing the <code class="literal">first</code> aggregation function to the <code class="literal">prevtail</code> function, the differences are as follows. The <code class="literal">prevtail</code> function is not an aggregation function and thereby not sensitive to the presence of <code class="literal">group by</code>. The <code class="literal">prevtail</code> function accesses data window contents directly and respects the sort order of the data window. The <code class="literal">first</code> aggregation function returns results based on arrival order and tracks data window contents in a separate shared data structure.
				</p><p>
					When comparing the <code class="literal">window</code> aggregation function to the <code class="literal">prevwindow</code> function, the differences are as follows. The <code class="literal">prevwindow</code> function is not an aggregation function and thereby not sensitive to the presence of <code class="literal">group by</code>. The <code class="literal">prevwindow</code> function accesses data window contents directly and respects the sort order of the data window. The <code class="literal">window</code> aggregation function returns results based on arrival order and tracks data window contents in a separate shared data structure.
				</p><p>
					When comparing the <code class="literal">count</code> aggregation function to the <code class="literal">prevcount</code> function, the differences are as follows. The <code class="literal">prevcount</code> function is not an aggregation function and thereby not sensitive to the presence of <code class="literal">group by</code>.
				</p><p>
					When comparing the <code class="literal">last</code> aggregation function to the <code class="literal">nth</code> aggregation function, the differences  are as follows. The <code class="literal">nth</code> aggregation function does not consider out-of-order deletes (for example with on-delete and sorted windows) and does not revert to the prior expression value when the last event or nth-event was deleted from a data window. The <code class="literal">last</code> aggregation function tracks the data window and reflects out-of-order deletes.
				</p><p>
					From an implementation perspective, the <code class="literal">first</code>, <code class="literal">last</code> and <code class="literal">window</code> aggregation functions share a common data structure for each stream. 
					The <code class="literal">sorted</code>, <code class="literal">minby</code> and <code class="literal">maxby</code> aggregation functions share a common data structure for each stream. 
				</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-function-aggregation-event-first"/>10.2.2.1.Â <code class="literal">First</code> Aggregation Function</h4></div></div></div><p>
					The synopsis for the <code class="literal">first</code> aggregation function is:
				</p><pre class="synopsis"><code class="literal">first(</code>*|<span class="emphasis"><em>stream</em></span>.*|<span class="emphasis"><em>value_expression</em></span> [, <span class="emphasis"><em>index_expression</em></span>] [, filter:<span class="emphasis"><em>filter_expression</em></span>])</pre><p>
					The <code class="literal">first</code> aggregation function returns properties of the very first event. When used with <code class="literal">group by</code>, it returns properties of the first event for each group. When specifying an index expression, the function returns properties of the Nth-subsequent event to the first event, all according to order of arrival.
				</p><p>
					The first parameter to the function is required and defines the event properties or expression result to return. The second parameter is an optional <span class="emphasis"><em>index_expression</em></span> that must return an integer value used as an index to evaluate the Nth-subsequent event to the first event.
				</p><p>
					You may specify the wildcard (<code class="literal">*</code>) character in which case the function returns the underlying event of the single selected stream. When selecting a single stream you may specify no parameter instead of wildcard. For joins and subqueries you must use the stream wildcard syntax below.
				</p><p>
					You may specify the stream name and wildcard (<code class="literal">*</code>) character in the <span class="emphasis"><em>stream</em></span><code class="literal">.*</code> syntax. This returns the underlying event for the specified stream.
				</p><p>
					You may specify a <span class="emphasis"><em>value_expression</em></span> to evaluate for the first event. The value expression may not select properties from multiple streams.
				</p><p>
				    The <span class="emphasis"><em>index_expression</em></span> is optional. If no index expression is provided, the function returns the first event. If present, the function evaluates the index expression to determine the value for N, and evaluates the Nth-subsequent event to the first event. A value of zero returns the first event and a value of 1 returns 
				    the event subsequent to the first event. You may not specify event properties in the index expression.
				</p><p>
					The function returns <code class="literal">null</code> if there are no events or when the index is larger than the number of events held. When used with <code class="literal">group by</code>, it returns <code class="literal">null</code> if there are no events for that group or when the index is larger than the number of events held for that group.
				</p><p>
					To explain, consider the statement below which selects the underlying event of the first sensor event held by the length window of 2 events.  
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select first(*) from SensorEvent#length(2) </pre><p>
				   Assume event E1, event E2 and event E3 are of type SensorEvent. When event E1 arrives the statement outputs the underlying event E1. When event E2 arrives the statement again outputs the underlying event E1. When event E3 arrives the statement outputs the underlying event E2, since 
				   event E1 has left the data window.
				</p><p>
					The stream wildcard syntax is useful for joins and subqueries. This example demonstrates a subquery that returns the first SensorEvent when a DoorEvent arrives:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select (select first(se.*) from SensorEvent#length(2) as se) from DoorEvent </pre><p>
					The following example shows the use of an index expression. The output value for <code class="literal">f1</code> is the temperature property value of the first event, the value for <code class="literal">f2</code> is the temperature property value of the second event:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select first(temperature, 0) as f1, first(temperature, 1) as f2
from SensorEvent#time(10 sec)</pre><p>
					You may use dot-syntax to invoke a method on the first event. You may also append a property name using dot-syntax.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-function-aggregation-event-last"/>10.2.2.2.Â <code class="literal">Last</code> Aggregation Function</h4></div></div></div><p>
					The synopsis for the <code class="literal">last</code> aggregation function is:
				</p><pre class="synopsis"><code class="literal">last(</code>*|<span class="emphasis"><em>stream</em></span>.*|<span class="emphasis"><em>value_expression</em></span> [, <span class="emphasis"><em>index_expression</em></span>][, filter:<span class="emphasis"><em>filter_expression</em></span>])</pre><p>
					The <code class="literal">last</code> aggregation function returns properties of the very last event. When used with <code class="literal">group by</code>, it returns properties of the last event for each group. When specifying an index expression, the function returns properties of the Nth-prior event to the last event, all according to order of arrival.
				</p><p>
					Similar to the <code class="literal">first</code> aggregation function described above, you may specify the wildcard (<code class="literal">*</code>) character, no parameter or stream name and wildcard (<code class="literal">*</code>) character or a <span class="emphasis"><em>value_expression</em></span> to evaluate for the last event.
				</p><p>
				    The <span class="emphasis"><em>index_expression</em></span> is optional. If no index expression is provided, the function returns the last event. If present, the function evaluates the index expression to determine the value for N, and evaluates the Nth-prior event to the last event.  A value of zero returns the last event and a value of 1 returns 
				    the event prior to  the last event.
				    You may not specify event properties in the index expression.
				</p><p>
					The function returns <code class="literal">null</code> if there are no events or when the index is larger than the number of events held. When used with <code class="literal">group by</code>, it returns <code class="literal">null</code> if there are no events for that group or when the index is larger than the number of events held for that group.
				</p><p>
					The next statement selects the underlying event of the first and last sensor event held by the time window of 10 seconds:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select first(*), last(*) from SensorEvent#time(10 sec) </pre><p>
					The statement shown next selects the last temperature (<code class="literal">f1</code>) and the prior-to-last temperature (<code class="literal">f1</code>) of sensor events in the last 10 seconds:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select last(temperature, 0) as f1, select last(temperature, 1) as f2
from SensorEvent#time(10 sec)</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-function-aggregation-event-maxby"/>10.2.2.3.Â <code class="literal">Maxby</code> Aggregation Function</h4></div></div></div><a id="d0e28258" class="indexterm"/><p>
					The synopsis for the <code class="literal">maxby</code> aggregation function is:
				</p><pre class="synopsis"><code class="literal">maxby</code>(<span class="emphasis"><em>sort_criteria_expression</em></span> [asc/desc][, <span class="emphasis"><em>sort_criteria_expression</em></span> [asc/desc]...][, filter:<span class="emphasis"><em>filter_expression</em></span>])</pre><p>
					The <code class="literal">maxby</code> aggregation function returns the greatest of all events, compared by using criteria expressions.
					When used with <code class="literal">group by</code>, it returns the greatest of all events per group.
				</p><p>
					This example statement returns the sensor id and the temperature of the sensor event that had the highest temperature among all sensor events:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select maxby(temperature).sensorId, maxby(temperature).temperature from SensorEvent</pre><p>
					The next EPL returns the sensor event that had the highest temperature and the sensor event that had the lowest temperature, per zone, among the last 10 seconds of sensor events:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select maxby(temperature), minby(temperature) from SensorEvent#time(10 sec) group by zone</pre><p>
					Your EPL may specify multiple criteria expressions. If the sort criteria expression is descending please append the <code class="literal">desc</code> keyword.
				</p><p>
					The following EPL returns the sensor event with the highest temperature and if there are multiple sensor events with the highest temperature the query
					returns the sensor event that has the newest timestamp value:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select maxby(temperature asc, timestamp desc) from SensorEvent</pre><p>
				  Event properties that are listed in criteria expressions must refer to the same event stream and cannot originate from different event streams.
				</p><p>
				  If your query does not define a data window and does not refer to a named window, the semantics of <code class="literal">maxby</code> are the same as <code class="literal">maxbyever</code>.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-function-aggregation-event-maxbyever"/>10.2.2.4.Â <code class="literal">Maxbyever</code> Aggregation Function</h4></div></div></div><p>
					The synopsis for the <code class="literal">maxbyever</code> aggregation function is:
				</p><pre class="synopsis"><code class="literal">maxbyever</code>(<span class="emphasis"><em>sort_criteria_expression</em></span> [asc/desc][, <span class="emphasis"><em>sort_criteria_expression</em></span> [asc/desc]...][, filter:<span class="emphasis"><em>filter_expression</em></span>])</pre><p>
					The <code class="literal">maxbyever</code> aggregation function returns the greatest of all events that ever occurred, compared by using criteria expressions.
					When used with <code class="literal">group by</code>, it returns the greatest of all events that ever occurred per group.
				</p><p>
					Compared to the <code class="literal">maxby</code> aggregation function the <code class="literal">maxbyever</code> does not consider the data window or named window contents
					and instead considers all arriving events.
				</p><p>
					The next EPL computes the difference, per zone, between the maximum temperature considering all events and the maximum temperature considering
					only the events in the last 10 seconds:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select maxby(temperature).temperature - maxbyever(temperature).temperature 
from SensorEvent#time(10) group by zone</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-function-aggregation-event-minby"/>10.2.2.5.Â <code class="literal">Minby</code> Aggregation Function</h4></div></div></div><a id="d0e28362" class="indexterm"/><p>
					The synopsis for the <code class="literal">minby</code> aggregation function is:
				</p><pre class="synopsis"><code class="literal">minby</code>(<span class="emphasis"><em>sort_criteria_expression</em></span> [asc/desc][, <span class="emphasis"><em>sort_criteria_expression</em></span> [asc/desc]...][, filter:<span class="emphasis"><em>filter_expression</em></span>])</pre><p>
					Similar to the <code class="literal">maxby</code> aggregation function, the <code class="literal">minby</code> aggregation function returns the lowest of all events, compared by using criteria expressions.
					When used with <code class="literal">group by</code>, it returns the lowest of all events per group.
				</p><p>
					Please review the section on <code class="literal">maxby</code> for more information.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-function-aggregation-event-minbyever"/>10.2.2.6.Â <code class="literal">Minbyever</code> Aggregation Function</h4></div></div></div><p>
					Similar to the <code class="literal">maxbyever</code> aggregation function, the <code class="literal">minbyever</code> aggregation function returns the lowest of all events that ever occurred, compared by using criteria expressions.
					When used with <code class="literal">group by</code>, it returns the lowest of all events per group that ever occured.
				</p><p>
					Please review the section on <code class="literal">maxbyever</code> for more information.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-function-aggregation-event-sorted"/>10.2.2.7.Â <code class="literal">Sorted</code> Aggregation Function</h4></div></div></div><a id="d0e28425" class="indexterm"/><a id="d0e28428" class="indexterm"/><p>
					The synopsis for the <code class="literal">sorted</code> aggregation function is:
				</p><pre class="synopsis"><code class="literal">sorted</code>(<span class="emphasis"><em>sort_criteria_expression</em></span> [asc/desc][, <span class="emphasis"><em>sort_criteria_expression</em></span> [asc/desc]...][, filter:<span class="emphasis"><em>filter_expression</em></span>])</pre><p>
					The <code class="literal">sorted</code> aggregation function maintains a list of events sorted according to criteria expressions.
					When used with <code class="literal">group by</code>, it maintains a list of events sorted according to criteria expressions per group.
				</p><p>
					The sample EPL listed next returns events sorted according to temperature ascending for the same zone:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sorted(temperature) from SensorEvent group by zone</pre><p>
					Your EPL may specify multiple criteria expressions. If the sort criteria expression is descending please append the <code class="literal">desc</code> keyword.
				</p><p>
					Enumeration methods can be useful in connection with <code class="literal">sorted</code> as the function provides the sorted events as input.
				</p><p>
				    This EPL statement finds the sensor event that when sorted according to temperature is the first sensor event for a Friday timestamp among sensor events for the same zone:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sorted(temperature).first(v =&gt; timestamp.getDayOfWeek()=6)
from SensorEvent</pre><p>
				  Event properties that are listed in criteria expressions must refer to the same event stream and cannot originate from different event streams.
				</p><p>
				  If used in a regular select statement, the use of <code class="literal">sorted</code> requires that your EPL defines a data window for the stream or utilizes a named window.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-function-aggregation-event-window"/>10.2.2.8.Â <code class="literal">Window</code> Aggregation Function</h4></div></div></div><p>
					The synopsis for the <code class="literal">window</code> aggregation function is:
				</p><pre class="synopsis"><code class="literal">window(</code>*|<span class="emphasis"><em>stream</em></span>.*|<span class="emphasis"><em>value_expression</em></span> [, filter:<span class="emphasis"><em>filter_expression</em></span>])</pre><p>
					The <code class="literal">window</code> aggregation function returns all rows. When used with <code class="literal">group by</code>, it returns the rows for each group.
				</p><p>
					Similar to the <code class="literal">first</code> aggregation function described above, you may specify the wildcard (<code class="literal">*</code>) character or stream name and wildcard (<code class="literal">*</code>) character or a <span class="emphasis"><em>value_expression</em></span> to evaluate for all events.
				</p><p>
					The function returns <code class="literal">null</code> if there are no rows. When used with <code class="literal">group by</code>, it returns <code class="literal">null</code> if there are no rows for that group.
				</p><p>
					The next statement selects the underlying event of all events held by the time window of 10 seconds:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select window(*) from SensorEvent#time(10 sec) </pre><p>
					If used in a regular select statement, the <code class="literal">window</code> aggregation function requires that your stream is bound by a data window or a named window. You may not use the <code class="literal">window</code> aggregation function on unbound streams with the exception of on-demand queries or subqueries.
				</p><p>
					This example statement assumes that the <code class="literal">OrderWindow</code> named window exists. For each event entering or leaving the <code class="literal">OrderWindow</code> named window
					it outputs the total amount removing negative amounts:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select window(*).where(v =&gt; v.amount &gt; 0).aggregate(0d, (r, v) =&gt; r + v.amount) from OrderWindow </pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-function-aggregation-approx"/>10.2.3.Â Approximation Aggregation Functions</h3></div></div></div><p>
				Approximation aggregation functions are aggregations that perform approximate analysis. Compared to the previously-introduced aggregation functions,
				the functions discussed here have a degree of accuracy and probabilistic behavior.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-function-aggregation-approx-countminsketch"/>10.2.3.1.Â Count-Min Sketch</h4></div></div></div><p>
				  Count-min sketch (or CM sketch) is a probabilistic sub-linear space streaming algorithm (source: Wikipedia).
				  Count-min sketch computes an approximate frequency, without retaining distinct values in memory, making the algorithm suitable for summarizing very large spaces of distinct values.
				  The estimated count can be used for estimated top-K and estimated heavy-hitters, for example.
				</p><p> 
					The original and detail of the algorithm is described in the paper by Graham Cormode and S. Muthukrishnan. An improved data stream summary: 
					The Count-min sketch and its applications (2004. 10.1016/j.jalgor.2003.12.001).
				</p><p>
					Count-min sketch can only be used with tables and is not available as an aggregation function other than in a table declaration.
				</p><p>
					Count-min sketch does not consider events leaving a data window and does not process a remove stream.
				</p><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="epl-function-aggregation-approx-countminsketch-declare"/>10.2.3.1.1.Â Declaration</h5></div></div></div><p>
						The table column type for Count-min sketch is <code class="literal">countMinSketch</code>. 
					</p><p>
						For example, the next EPL declares a table that holds a Count-min sketch (does not provision a top-K):
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table WordCountTable(wordcms countMinSketch())</pre><p>
						You can parameterize the algorithm by providing a JSON-format structure to the declaration.
						The available parameters are all optional:
					</p><div class="table"><a id="countminsketch_params"/><p class="title"><b>TableÂ 10.7.Â Count-min Sketch Parameters</b></p><div class="table-contents"><table summary="Count-min Sketch Parameters" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">epsOfTotalCount</code></td><td>
										<p>
											Specifies the accuracy (number of values counted * accuracy &gt;= number of errors) of type double.
										</p>
										<p>
											This value defaults to 0.0001.
										</p>
									</td></tr><tr><td><code class="literal">confidence</code></td><td>
										<p>
											Provides the certainty with which you reach the accuracy of type double.
										</p>
										<p>
											The default is 0.99.
										</p>
									</td></tr><tr><td><code class="literal">seed</code></td><td>
										<p>
											A seed value for computing hash codes of type integer.
										</p>
										<p>
											This default is 123456.
										</p>
									</td></tr><tr><td><code class="literal">topk</code></td><td>
										<p>
											The number of top-K values as an integer. If null, the algorithm maintains no top-K list.
										</p>
										<p>
											This value defaults to null (no top-K available).
										</p>
									</td></tr><tr><td><code class="literal">agent</code></td><td>
										<p>
											The agent is an extension API class that can interact with Count-min sketch state and also receives the value objects.
											The agent defines the type of the values that can be counted. The default agent only allows string-type values
											and utilizes UTF-16 charset encoding.
										</p>
										<p>
											The default agent is <code class="literal">com.espertech.esper.client.util.CountMinSketchAgentStringUTF16</code>.
										</p>
									</td></tr></tbody></table></div></div><br class="table-break"/><p>
						The next example EPL declares all available parameters:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table WordCountTable (wordcms countMinSketch({
  epsOfTotalCount: 0.000002,
  confidence: 0.999,
  seed: 38576,
  topk: 20,
  agent: 'com.mycompany.CountMinSketchCustomAgent'
}))</pre><p>
						The default for the <code class="literal">topk</code> parameter is <code class="literal">null</code>. Thereby the engine by default does not compute top-K.
						By specifying a positive integer value for <code class="literal">topk</code> the algorithm maintains a list of values representing the top estimated counts.
					</p><p>
						By default, the Count-min sketch group of aggregation functions operates on string-type values only. 						
						The aggregation function allows registering an agent that can handle any other type of value objects and that allows overriding behavior. 
						The agent class must implement the interface <code class="literal">com.espertech.esper.client.util.CountMinSketchAgent</code>.
						Please see the JavaDoc for implementing an agent. The agent API is an extension API and is subject to change between versions.
					</p></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="epl-function-aggregation-approx-countminsketch-add"/>10.2.3.1.2.Â Counting Values</h5></div></div></div><p>
						The <code class="literal">countMinSketchAdd</code> function counts value(s). It expects a single parameter expression returning the value(s) to be counted.
						The function can only be used with statements that utilize <code class="literal">into table</code> and can accept a <code class="literal">filter:</code> filter expression as a parameter.
					</p><p>
						This example EPL counts words:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">into table WordCountTable select countMinSketchAdd(word) as wordcms from WordEvent</pre></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="epl-function-aggregation-approx-countminsketch-freq"/>10.2.3.1.3.Â Estimating Current Count</h5></div></div></div><p>
						The <code class="literal">countMinSketchFrequency</code> function returns an estimated count for a given value.
						It expects a single parameter expression returning the value(s) for which to estimate and return the long-type count.
						The function can only be used as a table-access function against a table column that declares the aggregation <code class="literal">countMinSketch</code>.
					</p><p>
						The next example EPL returns, when a <code class="literal">EstimateWordCountEvent</code> event arrives, the estimated frequency of a given word:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select WordCountTable.wordcms.countMinSketchFrequency(word) from EstimateWordCountEvent</pre></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="epl-function-aggregation-approx-countminsketch-topk"/>10.2.3.1.4.Â Obtaining Top-K</h5></div></div></div><p>
						The <code class="literal">countMinSketchTopK</code> function returns top-K. The function expects no parameters.
						The function can only be used as a table-access function against a table column that declares the aggregation <code class="literal">countMinSketch</code>
						and only if the Count-min sketch was parameterized with a non-null <code class="literal">topk</code> parameter (the default is <code class="literal">null</code>, see declaration above).
					</p><p>
						The function returns an array of <code class="literal">com.espertech.esper.client.util.CountMinSketchTopK</code>.
					</p><p>
						The following EPL outputs top-K every 10 seconds:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select WordCountTable.wordcms.countMinSketchTopk() from pattern[every timer:interval(10 sec)]</pre></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="epl-function-aggregation-approx-agent"/>10.2.3.1.5.Â Agent API Example</h5></div></div></div><p>
						We provide a sample agent code that handles String-type values below. The complete code is available for class <code class="literal">CountMinSketchAgentStringUTF16</code> as part of sources.
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class CountMinSketchAgentStringUTF16 implements CountMinSketchAgent {
  public Class[] getAcceptableValueTypes() {
    return new Class[] {String.class};
  }

  public void add(CountMinSketchAgentContextAdd ctx) {
    String text = (String) ctx.getValue();
    if (text == null) {
      return;
    }
    byte[] bytes = toBytesUTF16(text);
    ctx.getState().add(bytes, 1);  // increase count by 1
  }

  public Long estimate(CountMinSketchAgentContextEstimate ctx) {
    String text = (String) ctx.getValue();
    if (text == null) {
      return null;
    }
    byte[] bytes = toBytesUTF16(text);
    return ctx.getState().frequency(bytes);
  }
}</pre></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-function-aggregation-add"/>10.2.4.Â Additional Aggregation Functions</h3></div></div></div><p>
				Esper provides the following additional aggregation functions beyond those in the SQL standard:
			</p><div class="table"><a id="epl-grouping-aggregate-func-table-ext"/><p class="title"><b>TableÂ 10.8.Â Syntax and Results of EPL Aggregation Functions</b></p><div class="table-contents"><table summary="Syntax and Results of EPL Aggregation Functions" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Aggregate Function</th><th>Result</th></tr></thead><tbody><tr><td>
								<p>
									countever(<span class="emphasis"><em>*</em></span> [, <span class="emphasis"><em>filter_expr</em></span>])
								</p>
								<p>
									countever(<span class="emphasis"><em>expression</em></span> [, <span class="emphasis"><em>filter_expr</em></span>])
								</p>
							</td><td>
								<p>
									The <code class="literal">countever</code> aggregation function returns the number of events ever. 
									When used with <code class="literal">group by</code> it returns the number of events ever for that group.
								</p>				
								<p>
									When used with a data window, the result of the function does not change as data points leave a data window. Use the <code class="literal">count(*)</code> or <code class="literal">prevcount</code> function to return counts relative to a data window.
								</p>
								<p>
									The optional filter expression limits the values considered for counting rows. The <code class="literal">distinct</code> keyword is not allowed. When an expression is provided
									instead of wildcard, counts the non-null values.
								</p>
								<p>
									The next example statement outputs the count-ever for sell orders:
								</p>
								<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select countever(*, side='sell') from Order</pre>
							</td></tr><tr><td>firstever(<span class="emphasis"><em>expression</em></span> [, <span class="emphasis"><em>filter_expr</em></span>])</td><td>
								<p>
									The <code class="literal">firstever</code> aggregation function returns the very first value ever. When used with <code class="literal">group by</code> it returns the first value ever for that group.
								</p>				
								<p>
									When used with a data window, the result of the function does not change as data points leave a data window. Use the <code class="literal">first</code> or <code class="literal">prevtail</code> function to return values relative to a data window.
								</p>
								<p>
									The optional filter expression limits the values considered for retaining the first-ever value.
								</p>
								<p>
									The next example statement outputs the first price ever for sell orders:
								</p>
								<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select firstever(price, side='sell') from Order</pre>
							</td></tr><tr><td>lastever(<span class="emphasis"><em>expression</em></span> [, <span class="emphasis"><em>filter_expr</em></span>])</td><td>
								<p>
									Returns the last value or last value per group, when used with <code class="literal">group by</code>.
								</p>
								<p>
									This sample statement outputs the total price, the first price and the last price per symbol for the last 30 seconds of events and every 5 seconds:
								</p>
								<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, sum(price), lastever(price), firstever(price)
from StockTickEvent#time(30 sec) 
group by symbol
output every 5 sec</pre>
								<p>
									When used with a data window, the result of the function does not change as data points leave a data window (for example when all data points leave the data window). Use the <code class="literal">last</code> or <code class="literal">prev</code> function to return values relative to a data window.
								</p>
								<p>
									The optional filter expression limits the values considered for retaining the last-ever value.
								</p>
								<p>
									The next example statement outputs the last price (ever) for sell orders:
								</p>
								<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select lastever(price, side='sell') from Order</pre>
							</td></tr><tr><td>leaving([filter:<span class="emphasis"><em>filter_expression</em></span>])</td><td>
								<p>
									Returns true when any remove stream data has passed, for use in the <code class="literal">having</code> clause to output only when a data window has filled.
								</p>
								<p>
									The <code class="literal">leaving</code> aggregation function is useful when you want to trigger output after a data window has a remove stream data point. Use the <code class="literal">output after</code> syntax as an alternative to output after a time interval.
								</p>
								<p>
									This sample statement uses <code class="literal">leaving()</code> to output after the first data point leaves the data window, ignoring the first datapoint:
								</p>
								<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, sum(price) 
from StockTickEvent#time(30 sec) 
having leaving()</pre>
							</td></tr><tr><td>nth(<span class="emphasis"><em>expression</em></span>, <span class="emphasis"><em>N_index</em></span> [, filter:<span class="emphasis"><em>filter_expression</em></span>])</td><td>
								<p>
									Returns the Nth oldest element; If N=0 returns the most recent value. If N=1 returns the value before the most recent value. If N is larger than the events held in the data window for this group, returns null.
								</p>
								<p>
									A maximum N historical values are stored, so it can be safely used to compare
									recent values in data windows with a large number of events without incurring excessive overhead.
								</p>
								<p>
									As compared to the <code class="literal">prev</code> row function, this aggregation function works within the current <code class="literal">group by</code> group, see <a class="xref" href="#">???</a>.
								</p>
								<p>
									This statement outputs every 2 seconds the groups that have new data and their last price and the previous-to-last price:
								</p>
								<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, nth(price, 1), last(price) 
from StockTickEvent 
group by symbol
output last every 2 sec</pre>
							</td></tr><tr><td>
								<p>
									rate(<span class="emphasis"><em>number_of_seconds</em></span> [, filter:<span class="emphasis"><em>filter_expression</em></span>])
								</p>
							</td><td>
								<p>
									Returns an event arrival rate per second over the provided number of seconds, computed based on engine time.								
								</p>
								<p>
									Returns null until events fill the number of seconds. Useful with <code class="literal">output snapshot</code> to output a current rate. This function footprint is for use without a data window onto the stream(s).
								</p>
								<p>
									A sample statement to output, every 2 seconds, the arrival rate per second considering the last 10 seconds of events is shown here:
								</p>
								<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select rate(10) from StockTickEvent
output snapshot every 2 sec</pre>
								<p>
									The aggregation function retains an engine timestamp value for each arriving event.
								</p>
							</td></tr><tr><td>
								<p>
									rate(<span class="emphasis"><em>timestamp_property</em></span>[, <span class="emphasis"><em>accumulator</em></span>] [, filter:<span class="emphasis"><em>filter_expression</em></span>])
								</p>
							</td><td>
								<p>
									Returns an event arrival rate over the data window including the last remove stream event. The <span class="emphasis"><em>timestamp_property</em></span>
									is the name of a long-type property of the event that provides a timestamp value.
								</p>
								<p>
									The first parameter is a property name or expression providing millisecond timestamp values.
								</p>
								<p>
									The optional second parameter is a property or expression for computing an accumulation rate: If a value is provided as a second parameter then the accumulation rate for that quantity is returned (e.g. turnover in dollars per second).
								</p>
								<p>
									This footprint is designed for use with a data window and requires a data window declared onto the stream. Returns null until events start leaving the window.
								</p>
								<p>
									This sample statement outputs event rate for each group (symbol) with fixed sample size of four events 
									(and considering the last event that left). The <code class="literal">timestamp</code> event property must be part of the event for this to work.
								</p>
								<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select colour, rate(timestamp) as rate 
from StockTickEvent#groupwin(symbol)#length(4) 
group by symbol</pre>
							</td></tr></tbody></table></div></div><br class="table-break"/><p>
				Built-in aggregation functions can be disabled via configuration (see <a class="xref" href="#config-engine-expression-extendedagg" title="15.4.26.4.Â Extended Built-in Aggregation Functions">SectionÂ 15.4.26.4, âExtended Built-in Aggregation Functionsâ</a>). A custom aggregation function of the same name as a built-on function may be registered to override the built-in function.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-function-user-defined"/>10.3.Â User-Defined Functions</h2></div></div></div><a id="d0e29057" class="indexterm"/><a id="d0e29060" class="indexterm"/><a id="d0e29065" class="indexterm"/><p>
			 A user-defined function (UDF) is a single-row function that can be invoked anywhere as an expression itself or within an expresson. The function must simply be a public static method
			 that the classloader can resolve at statement creation time. The engine resolves the function reference at statement creation time and verifies parameter types.
		 </p><p>
		  For information on calling external services via instance method invocation, please see <a class="xref" href="#variable_eventtype" title="5.17.5.Â Class and Event-Type Variables">SectionÂ 5.17.5, âClass and Event-Type Variablesâ</a>. For invoking methods on events, please see <a class="xref" href="#epl-from-clause-stream-name" title="5.4.5.Â Using the Stream Name">SectionÂ 5.4.5, âUsing the Stream Nameâ</a>
		</p><p>
			You may register your own function name for the user-defined function. Please see the instructions in <a class="xref" href="#custom-singlerow-function" title="17.3.Â Single-Row Function">SectionÂ 17.3, âSingle-Row Functionâ</a> for registering a function name for a user-defined single-row function.
		</p><p>
			A single-row function that has been registered with a function name can simply be referenced as <span class="emphasis"><em>function_name</em></span><code class="literal">(</code><span class="emphasis"><em>parameters</em></span><code class="literal">)</code> thus EPL statements can be less cluttered as no class name is required. 
			The engine also optimizes evaluation of such registered single-row functions when used in filter predicate expressions as described in <a class="xref" href="#custom-single-filter-optimizable" title="17.3.4.Â Single-Row Functions in Filter Predicate Expressions">SectionÂ 17.3.4, âSingle-Row Functions in Filter Predicate Expressionsâ</a>.
		</p><p>
			An example EPL statement that utilizes the <code class="literal">discount</code> function is shown next (assuming that function has been registered).
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select discount(quantity, price) from OrderEvent</pre><p>
			When selecting from a single stream, use the wildcard <code class="literal">(*)</code> character to pass the underlying event:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select discount(*) from OrderEvent</pre><p>
			Alternatively use the stream alias or EPL pattern tag to pass an event:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select discount(oe) from OrderEvent as oe</pre><p>
			 User-defined functions can be also be invoked on instances of an event: Please see <a class="xref" href="#epl-from-clause-stream-name" title="5.4.5.Â Using the Stream Name">SectionÂ 5.4.5, âUsing the Stream Nameâ</a> to invoke event instance methods on a named stream.
		 </p><p>
			 Note that user-defined functions (not single-row functions) are candidate for caching their return result if the parameters passed are constants and they are not used chained. Please see below for details and configuration.
		 </p><p>
			 The example below assumes a class <code class="literal">MyClass</code> that exposes a public static method <code class="literal">myFunction</code> accepting 2 parameters, and
			 returing a numeric type such as <code class="literal">double</code>.
		 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select 3 * com.mycompany.MyClass.myFunction(price, volume) as myValue 
from StockTick#time(30 sec)</pre><p>
			 User-defined functions also take array parameters as this example shows. The section on <a class="xref" href="#epl-operator-ref-array" title="9.5.Â Array Definition Operator">SectionÂ 9.5, âArray Definition Operatorâ</a> outlines in more detail the types of arrays produced.
		 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from RFIDEvent where com.mycompany.rfid.MyChecker.isInZone(zone, {10, 20, 30})</pre><p>
			Java class names have to be fully qualified (e.g. java.lang.Math) but Esper provides a mechanism for user-controlled imports of classes and packages as outlined in <a class="xref" href="#config-class--package-imports" title="15.4.7.Â Class and Package Imports">SectionÂ 15.4.7, âClass and Package Importsâ</a>.
		</p><p>
			 User-defined functions can return any value including <code class="literal">null</code>, Java objects or arrays. Therefore user-defined functions can serve to transform, convert or map events, or to extract information and assemble further events.
		 </p><p>
			 The following statement is a simple pattern that looks for events of type E1 that are followed by events of type E2. It assigns the tags "e1" and "e2" that the function can use to assemble a final event for output:
		 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select MyLib.mapEvents(e1, e2) from pattern [every e1=E1 -&gt; e2=E2]</pre><p>
			 User-defined functions may also be chained: If a user-defined function returns an object then the object can itself be the target of the next function call and so on.
		 </p><p>
			 Assume that there is a <code class="literal">calculator</code> function in the <code class="literal">MyLib</code> class that returns a class which provides the <code class="literal">search</code> method taking two parameters. The EPL
			 that takes the result of the <code class="literal">calculator</code> function and that calls the <code class="literal">search</code> method on the result and returns its return value is shown below:
		 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select MyLib.calculator().search(zonevariable, zone) from RFIDEvent]</pre><p>
			 A user-defined function should be implemented thread-safe. 
		 </p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-function-user-defined-converting"/>10.3.1.Â Event Type Conversion via User-Defined Function</h4></div></div></div><p>
				 A function that converts from one event type to another event type is shown in the next example. The first statement declares a stream that consists of MyEvent events. The second statement employs a conversion function to convert MyOtherEvent events to events of type MyEvent:
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into MyStream select * from MyEvent
	insert into MyStream select MyLib.convert(other) from MyOtherEvent as other</pre><p>
				 In the example above, assuming the event classes MyEvent and MyOtherEvent are Java classes, the static method should have the following footprint:
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public static MyEvent convert(MyOtherEvent otherEvent)</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-function-user-defined-cached"/>10.3.2.Â User-Defined Function Result Cache</h4></div></div></div><p>
				 For user-defined functions that take no parameters or only constants as parameters the engine automatically caches the return result of the function, and invokes the function only once. This is beneficial to performance 
				 if your function indeed returns the same result for the same input parameters.
			</p><p>
				 You may disable caching of return values of user-defined functions via configuration as described in <a class="xref" href="#config-engine-expression-udfcache" title="15.4.26.3.Â User-Defined Function or Static Method Cache">SectionÂ 15.4.26.3, âUser-Defined Function or Static Method Cacheâ</a>.
			</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-function-user-defined-matching"/>10.3.3.Â Parameter Matching</h4></div></div></div><p>
				 EPL follows Java standards in terms of widening, performing widening automatically in cases where widening type conversion is allowed without loss of precision, for both boxed and primitive types.				 
			 </p><p>
				 When user-defined functions are overloaded, the function with the best match is selected based on how well the arguments to a function can match up with the parameters, giving preference to the function that requires the least number of widening conversions.
			 </p><p>
				 User-defined functions that can receive an arbitrary number of parameter values can use <span class="emphasis"><em>varargs</em></span>, i.e. can define a function such as <code class="literal">function(T arg1, T... args) {...}</code>.
			 </p><p>
				 Boxing and unboxing of arrays is not supported in UDF as it is not supported in Java. For example, an array of <code class="literal">Integer</code> and an array of <code class="literal">int</code> are not compatible types.
			 </p><p>
			  When passing the event or underlying event to your method, either declare the parameter to take <code class="literal">EventBean</code> (i.e. <code class="literal">myfunc(EventBean event)</code>) 
			  or as the underlying event type (i.e. <code class="literal">myfunc(OrderEvent event)</code>).
			</p><p>
				 When using <code class="literal">{}</code> array syntax in EPL, the resulting type is always a boxed type: <code class="literal">"{1, 2}"</code> is an array of <code class="literal">Integer</code> (and not <code class="literal">int</code> since it may contain null values), <code class="literal">"{1.0, 2d}"</code> is an array of <code class="literal">Double</code> and <code class="literal">"{'A', "B"}"</code> is an array of <code class="literal">String</code>, while <code class="literal">"{1, "B", 2.0}"</code> is an array of <code class="literal">Object</code> (<code class="literal">Object[]</code>).
			 </p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="epl-function-user-defined-receivectx"/>10.3.4.Â Receiving a Context Object</h4></div></div></div><p>
			  Esper can pass an object containing contextual information such as statement name, function name, engine URI and context partition id to your
			  method. The container for this information is <code class="literal">EPLMethodInvocationContext</code> in package <code class="literal">com.espertech.esper.client.hook</code>.
			  Please declare your method to take <code class="literal">EPLMethodInvocationContext</code> as the last parameter. The engine then passes the information along.
			</p><p> 
			  A sample method footprint and EPL are shown below:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public static double computeSomething(double number, EPLMethodInvocationContext context) {...}</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select MyLib.computeSomething(10) from MyEvent</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="functionreference-transpose"/>10.4.Â Select-Clause <code class="literal">Transpose</code> Function</h2></div></div></div><p>
		  The <code class="literal">transpose</code> function is only valid in the select-clause and indicates that the result of the parameter expression should become the underlying event object of the output event.
		</p><p>
		  The <code class="literal">transpose</code> function takes a single expression as a parameter. The result object of the parameter expression is subject to transposing as described below.
		</p><p>
		  The function can be useful with <code class="literal">insert into</code> to allow an object returned by an expression to become the event itself in the output stream.
		</p><p>
		  Any expression returning a Java object can be used with the <code class="literal">transpose</code> function. Typical examples for expressions are a static method invocation, the result of an enumeration method, a plug-in single row function or a subquery. 
		</p><p>
		  The examples herein assume that a single-row function by name <code class="literal">makeEvent</code> returns an <code class="literal">OrderEvent</code> instance (a POJO object, not shown).
		</p><p>
		  The following EPL takes the result object of the invocation of the <code class="literal">makeEvent</code> method (assumed to be an OrderEvent instance) and returns the OrderEvent instance as the underlying event of the output event:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select transpose(makeEvent(oi)) from OrderIndication oi</pre><p>
		  Your select-clause can select additional properties or expressions. In this case the output event underlying object is a pair of the expression result object and the additional properties.
		</p><p>
		  The next EPL also selects the <code class="literal">origin</code> property of the order indication event. The output event is a pair of the OrderEvent instance and a map containing the property name and value of origin:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select origin, transpose(makeEvent(oi)) from OrderIndication oi</pre><p>
		  If the <code class="literal">transpose</code> function is not a top-level function, i.e. if it occurs within another expression or within any other clause then the select-clause, the function simply returns the expression result of the parameter expression.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="functionreference-transpose-insert-into"/>10.4.1.Â Transpose with Insert-Into</h3></div></div></div><p>
				  You may insert transposed output events into another stream.
			</p><p>
				  If the stream name in the insert-into clause is already associated to an event type, the engine checks whether the event type associated to the stream name provided in the insert-into clause matches the event type associated to the object returned by the expression. If the stream name in the insert-into clause is not already associated to an existing event type the engine associates a new event type using the stream name provided in the insert-into clause.
			</p><p>
				The type returned by the expression must match the event representation that is defined for the stream, i.e. must be a subtype or implementation of the respective class (POJO, object-array or Map).
			</p><p>
				For example, the next statement associates the stream name <code class="literal">OrderEvent</code> with a class. Alternatively this association can be achieved via static or runtime configuration API:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema OrderEvent as com.mycompany.OrderEvent</pre><p>
				An EPL statement can insert into the <code class="literal">OrderEvent</code> stream the <code class="literal">OrderEvent</code> instance returned by the <code class="literal">makeEvent</code> method, as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into OrderEvent select transpose(makeEvent(oi)) from OrderIndication oi</pre><p>
				It is not valid to select additional properties or expressions in this case, as they would not be part of the output event. The following is not valid:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// not valid
insert into OrderEvent select origin, transpose(makeEvent(oi)) from OrderIndication oi</pre></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="enumerationreference"/>ChapterÂ 11.Â EPL Reference: Enumeration Methods</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#enumeration-intro">11.1. Overview</a></span></dt><dt><span class="sect1"><a href="#enumeration-exampledata">11.2. Example Events</a></span></dt><dt><span class="sect1"><a href="#enumeration-howtouse">11.3. How to Use</a></span></dt><dd><dl><dt><span class="sect2"><a href="#enumeration-howtouse-synopsis">11.3.1. Syntax</a></span></dt><dt><span class="sect2"><a href="#enumeration-howtouse-example">11.3.2. Introductory Examples</a></span></dt><dt><span class="sect2"><a href="#enumeration-howtouse-output">11.3.3. Input, Output and Limitations</a></span></dt></dl></dd><dt><span class="sect1"><a href="#enumeration-inputs">11.4. Inputs</a></span></dt><dd><dl><dt><span class="sect2"><a href="#enumeration-ds-subquery">11.4.1. Subquery Results</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-namedwindow">11.4.2. Named Window</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-table">11.4.3. Table</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-property">11.4.4. Event Property and Insert-Into With @eventbean</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-accessagg">11.4.5. Event Aggregation Function</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-prev">11.4.6. Prev, Prevwindow and Prevtail Single-Row Functions as Input</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-udf">11.4.7. Single-Row Function, User-Defined Function and Enum Types</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-lambda">11.4.8. Declared Expression</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-variable">11.4.9. Variables</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-substitution">11.4.10. Substitution Parameters</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-matchrecog">11.4.11. Match-Recognize Group Variable</a></span></dt><dt><span class="sect2"><a href="#enumeration-ds-eplpattern">11.4.12. Pattern Repeat and Repeat-Until Operators</a></span></dt></dl></dd><dt><span class="sect1"><a href="#enumeration-example">11.5. Example</a></span></dt><dt><span class="sect1"><a href="#enumeration-method">11.6. Reference</a></span></dt><dd><dl><dt><span class="sect2"><a href="#enumeration-method-aggregate">11.6.1. Aggregate</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-allof">11.6.2. AllOf</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-anyof">11.6.3. AnyOf</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-average">11.6.4. Average</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-countof">11.6.5. CountOf</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-distinctof">11.6.6. DistinctOf</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-except">11.6.7. Except</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-firstof">11.6.8. FirstOf</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-groupby">11.6.9. GroupBy</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-intersect">11.6.10. Intersect</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-lastof">11.6.11. LastOf</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-leastfrequent">11.6.12. LeastFrequent</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-max">11.6.13. Max</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-maxby">11.6.14. MaxBy</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-min">11.6.15. Min</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-minby">11.6.16. MinBy</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-mostfrequent">11.6.17. MostFrequent</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-orderby">11.6.18. OrderBy and OrderByDesc</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-reverse">11.6.19. Reverse</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-selectfrom">11.6.20. SelectFrom</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-sequenceequal">11.6.21. SequenceEqual</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-sumof">11.6.22. SumOf</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-take">11.6.23. Take</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-takelast">11.6.24. TakeLast</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-takewhile">11.6.25. TakeWhile</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-takewhilelast">11.6.26. TakeWhileLast</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-tomap">11.6.27. ToMap</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-union">11.6.28. Union</a></span></dt><dt><span class="sect2"><a href="#enumeration-method-where">11.6.29. Where</a></span></dt></dl></dd></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="enumeration-intro"/>11.1.Â Overview</h2></div></div></div><a id="d0e29377" class="indexterm"/><p>
			EPL provides enumeration methods that work with lambda expressions to perform common tasks on subquery results, named windows, tables, event properties or inputs that are or can be projected to a collection of events, scalar values or objects.
		</p><p>
			Enumeration methods are stateless and the use of enumeration methods alone does not cause the engine to retain any events or other state (with the possible exception of short-lived caching of evaluation results).
		</p><p>
			A lambda expression is an anonymous expression.  Lambda expressions are useful for encapsulating user-defined expressions that are applied to each element in a collection. This section discusses built-in enumeration methods and their lambda expression parameters.
		</p><p>
			Lambda expressions use the lambda operator <code class="literal">=&gt;</code>, which is read as "goes to" (<code class="literal">-&gt;</code> may be used and is equivalent). The left side of the lambda operator specifies the lambda expression input parameter(s) (if any) and the right side holds the expression. The lambda expression x =&gt; x * x is read "x goes to x times x.". 
			Lambda expressions are also used for expression declaration as discussed in <a class="xref" href="#epl-syntax-expression-decl" title="5.2.9.Â Expression Declaration">SectionÂ 5.2.9, âExpression Declarationâ</a>.
		</p><p>
			When writing lambdas, you do not have to specify a type for the input parameter(s) or output result(s) because the engine can infer all types based on the input and the expression body. So if you are querying an RFIDEvent, for example, then the input variable is inferred to be an RFIDEvent event, which means you have access to its properties and methods.
		</p><p>
			The term <span class="emphasis"><em>element</em></span> in respect to enumeration methods means a single event, scalar value or object in a collection that is the input to an enumeraton method. The term <span class="emphasis"><em>collection</em></span> means a sequence or group of elements.
		</p><p>
			The below table summarizes the built-in enumeration methods available:
		</p><div class="table"><a id="enumeration_method_table"/><p class="title"><b>TableÂ 11.1.Â Enumeration Methods</b></p><div class="table-contents"><table summary="Enumeration Methods" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Method</th><th>Result</th></tr></thead><tbody><tr><td>aggregate(seed, accumulator lambda)</td><td>
							<p>
								Aggregate elements by using seed as an initial accumulator value and applying an accumulator expression.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-aggregate" title="11.6.1.Â Aggregate">SectionÂ 11.6.1, âAggregateâ</a>.
							</p>
						</td></tr><tr><td>allof(predicate lambda)</td><td>
							<p>
								Return true when all elements satisfy a condition.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-allof" title="11.6.2.Â AllOf">SectionÂ 11.6.2, âAllOfâ</a>.
							</p>
						</td></tr><tr><td>anyof(predicate lambda)</td><td>
							<p>
								Return true when any element satisfies a condition.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-anyof" title="11.6.3.Â AnyOf">SectionÂ 11.6.3, âAnyOfâ</a>.
							</p>
						</td></tr><tr><td>average()</td><td>
							<p>
								Computes the average of values obtained from numeric elements.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-average" title="11.6.4.Â Average">SectionÂ 11.6.4, âAverageâ</a>.
							</p>
						</td></tr><tr><td>average(projection lambda)</td><td>
							<p>
								Computes the average of values obtained from elements by invoking a projection expression on each element.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-average" title="11.6.4.Â Average">SectionÂ 11.6.4, âAverageâ</a>.
							</p>
						</td></tr><tr><td>countof()</td><td>
							<p>
								Returns the number of elements.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-countof" title="11.6.5.Â CountOf">SectionÂ 11.6.5, âCountOfâ</a>.
							</p>
						</td></tr><tr><td>countof(predicate lambda)</td><td>
							<p>
								Returns the number of elements that satisfy a condition.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-countof" title="11.6.5.Â CountOf">SectionÂ 11.6.5, âCountOfâ</a>.
							</p>
						</td></tr><tr><td>distinctOf()</td><td>
							<p>
								Returns distinct elements according to default hash and equals semantics.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-distinctof" title="11.6.6.Â DistinctOf">SectionÂ 11.6.6, âDistinctOfâ</a>.
							</p>
						</td></tr><tr><td>distinctOf(key-selector lambda)</td><td>
							<p>
								Returns distinct elements according using the key function provided.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-distinctof" title="11.6.6.Â DistinctOf">SectionÂ 11.6.6, âDistinctOfâ</a>.
							</p>
						</td></tr><tr><td>except(source)</td><td>
							<p>
								Produces the set difference of the two collections.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-except" title="11.6.7.Â Except">SectionÂ 11.6.7, âExceptâ</a>.
							</p>
						</td></tr><tr><td>firstof()</td><td>
							<p>
								Returns the first element.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-firstof" title="11.6.8.Â FirstOf">SectionÂ 11.6.8, âFirstOfâ</a>.
							</p>
						</td></tr><tr><td>firstof(predicate lambda)</td><td>
							<p>
								Returns the first element that satisfies a condition.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-firstof" title="11.6.8.Â FirstOf">SectionÂ 11.6.8, âFirstOfâ</a>.
							</p>
						</td></tr><tr><td>groupby(key-selector lambda)</td><td>
							<p>
								Groups the elements according to a specified key-selector expression.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-groupby" title="11.6.9.Â GroupBy">SectionÂ 11.6.9, âGroupByâ</a>.
							</p>
						</td></tr><tr><td>groupby(key-selector lambda, value-selector lambda)</td><td>
							<p>
								Groups the elements according to a key-selector expression mapping each element to a value according to a value-selector.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-groupby" title="11.6.9.Â GroupBy">SectionÂ 11.6.9, âGroupByâ</a>.
							</p>
						</td></tr><tr><td>intersect(source)</td><td>
							<p>
								Produces the set intersection of the two collections.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-intersect" title="11.6.10.Â Intersect">SectionÂ 11.6.10, âIntersectâ</a>.
							</p>
						</td></tr><tr><td>lastof()</td><td>
							<p>
								Returns the last element.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-lastof" title="11.6.11.Â LastOf">SectionÂ 11.6.11, âLastOfâ</a>.
							</p>
						</td></tr><tr><td>lastof(predicate lambda)</td><td>
							<p>
								Returns the last element that satisfies a condition.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-lastof" title="11.6.11.Â LastOf">SectionÂ 11.6.11, âLastOfâ</a>.
							</p>
						</td></tr><tr><td>leastFrequent()</td><td>
							<p>
								Returns the least frequent value among a collection of values.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-leastfrequent" title="11.6.12.Â LeastFrequent">SectionÂ 11.6.12, âLeastFrequentâ</a>.
							</p>
						</td></tr><tr><td>leastFrequent(transform lambda)</td><td>
							<p>
								Returns the least frequent value returned by the transform expression when applied to each element.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-leastfrequent" title="11.6.12.Â LeastFrequent">SectionÂ 11.6.12, âLeastFrequentâ</a>.
							</p>
						</td></tr><tr><td>max()</td><td>
							<p>
								Returns the maximum value among a collection of elements.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-max" title="11.6.13.Â Max">SectionÂ 11.6.13, âMaxâ</a>.
							</p>
						</td></tr><tr><td>max(value-selector lambda)</td><td>
							<p>
								Returns the maximum value returned by the value-selector expression when applied to each element.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-max" title="11.6.13.Â Max">SectionÂ 11.6.13, âMaxâ</a>.
							</p>
						</td></tr><tr><td>maxby(value-selector lambda)</td><td>
							<p>
								Returns the element that provides the maximum value returned by the value-selector expression when applied to each element.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-maxby" title="11.6.14.Â MaxBy">SectionÂ 11.6.14, âMaxByâ</a>.
							</p>
						</td></tr><tr><td>min()</td><td>
							<p>
								Returns the minimum value among a collection of elements.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-max" title="11.6.13.Â Max">SectionÂ 11.6.13, âMaxâ</a>.
							</p>
						</td></tr><tr><td>min(value-selector lambda)</td><td>
							<p>
								Returns the minimum value returned by the value-selector expression when applied to each element.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-min" title="11.6.15.Â Min">SectionÂ 11.6.15, âMinâ</a>.
							</p>
						</td></tr><tr><td>minby(value-selector lambda)</td><td>
							<p>
								Returns the element that provides the minimum value returned by the value-selector expression when applied to each element..
							</p>
							<p>
								<a class="xref" href="#enumeration-method-minby" title="11.6.16.Â MinBy">SectionÂ 11.6.16, âMinByâ</a>.
							</p>
						</td></tr><tr><td>mostFrequent()</td><td>
							<p>
								Returns the most frequent value among a collection of values.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-mostfrequent" title="11.6.17.Â MostFrequent">SectionÂ 11.6.17, âMostFrequentâ</a>.
							</p>
						</td></tr><tr><td>mostFrequent(transform lambda)</td><td>
							<p>
								Returns the most frequent value returned by the transform expression when applied to each element.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-mostfrequent" title="11.6.17.Â MostFrequent">SectionÂ 11.6.17, âMostFrequentâ</a>.
							</p>
						</td></tr><tr><td>orderBy()</td><td>
							<p>
								Sorts the elements in ascending order.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-orderby" title="11.6.18.Â OrderBy and OrderByDesc">SectionÂ 11.6.18, âOrderBy and OrderByDescâ</a>.
							</p>
						</td></tr><tr><td>orderBy(key-selector lambda)</td><td>
							<p>
								Sorts the elements in ascending order according to a key.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-orderby" title="11.6.18.Â OrderBy and OrderByDesc">SectionÂ 11.6.18, âOrderBy and OrderByDescâ</a>.
							</p>
						</td></tr><tr><td>orderByDesc()</td><td>
							<p>
								Sorts the elements in descending order.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-orderby" title="11.6.18.Â OrderBy and OrderByDesc">SectionÂ 11.6.18, âOrderBy and OrderByDescâ</a>.
							</p>
						</td></tr><tr><td>orderByDesc(key-selector lambda)</td><td>
							<p>
								Sorts the elements in descending order according to a key.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-orderby" title="11.6.18.Â OrderBy and OrderByDesc">SectionÂ 11.6.18, âOrderBy and OrderByDescâ</a>.
							</p>
						</td></tr><tr><td>reverse</td><td>
							<p>
								Reverses the order of elements.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-reverse" title="11.6.19.Â Reverse">SectionÂ 11.6.19, âReverseâ</a>.
							</p>
						</td></tr><tr><td>selectFrom(transform lambda)</td><td>
							<p>
								Transforms each element resulting in a collection of transformed elements.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-selectfrom" title="11.6.20.Â SelectFrom">SectionÂ 11.6.20, âSelectFromâ</a>.
							</p>
						</td></tr><tr><td>sequenceEqual(second)</td><td>
							<p>
								Determines whether two collections are equal by comparing each element (<code class="literal">equals</code> semantics apply).
							</p>
							<p>
								<a class="xref" href="#enumeration-method-sequenceequal" title="11.6.21.Â SequenceEqual">SectionÂ 11.6.21, âSequenceEqualâ</a>.
							</p>
						</td></tr><tr><td>sumOf()</td><td>
							<p>
								Computes the sum from a collection of numeric elements.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-sumof" title="11.6.22.Â SumOf">SectionÂ 11.6.22, âSumOfâ</a>.
							</p>
						</td></tr><tr><td>sumOf(projection lambda)</td><td>
							<p>
								Computes the sum by invoking a projection expression on each element.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-sumof" title="11.6.22.Â SumOf">SectionÂ 11.6.22, âSumOfâ</a>.
							</p>
						</td></tr><tr><td>take(numElements)</td><td>
							<p>
								Returns a specified number of contiguous elements from the start.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-take" title="11.6.23.Â Take">SectionÂ 11.6.23, âTakeâ</a>.
							</p>
						</td></tr><tr><td>takeLast(numElements)</td><td>
							<p>
								Returns a specified number of contiguous elements from the end.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-takelast" title="11.6.24.Â TakeLast">SectionÂ 11.6.24, âTakeLastâ</a>.
							</p>
						</td></tr><tr><td>takeWhile(predicate lambda)</td><td>
							<p>
								Returns elements from the start as long as a specified condition is true.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-takewhile" title="11.6.25.Â TakeWhile">SectionÂ 11.6.25, âTakeWhileâ</a>.
							</p>
						</td></tr><tr><td>takeWhile( (predicate, index) lambda)</td><td>
							<p>
								Returns elements from the start as long as a specified condition is true, allowing each element's index to be used in the logic of the predicate expression.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-takewhile" title="11.6.25.Â TakeWhile">SectionÂ 11.6.25, âTakeWhileâ</a>.
							</p>
						</td></tr><tr><td>takeWhileLast(predicate)</td><td>
							<p>
								Returns elements from the end as long as a specified condition is true.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-takewhilelast" title="11.6.26.Â TakeWhileLast">SectionÂ 11.6.26, âTakeWhileLastâ</a>.
							</p>
						</td></tr><tr><td>takeWhileLast( (predicate,index) lambda)</td><td>
							<p>
								Returns elements from the end as long as a specified condition is true, allowing each element's index to be used in the logic of the predicate expression.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-takewhilelast" title="11.6.26.Â TakeWhileLast">SectionÂ 11.6.26, âTakeWhileLastâ</a>.
							</p>
						</td></tr><tr><td>toMap(key-selector lambda, value-selector lambda)</td><td>
							<p>
								Returns a Map according to specified key selector and value-selector expressions.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-tomap" title="11.6.27.Â ToMap">SectionÂ 11.6.27, âToMapâ</a>.
							</p>
						</td></tr><tr><td>union(source)</td><td>
							<p>
								Forms a union of the input elements with source elements.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-union" title="11.6.28.Â Union">SectionÂ 11.6.28, âUnionâ</a>.
							</p>
						</td></tr><tr><td>where(predicate lambda)</td><td>
							<p>
								Filters elements based on a predicate.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-where" title="11.6.29.Â Where">SectionÂ 11.6.29, âWhereâ</a>.
							</p>
						</td></tr><tr><td>where( (predicate,index) lambda)</td><td>
							<p>
								Filters elements based on a predicate, allowing each element's index to be used in the logic of the predicate expression.
							</p>
							<p>
								<a class="xref" href="#enumeration-method-where" title="11.6.29.Â Where">SectionÂ 11.6.29, âWhereâ</a>.
							</p>
						</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="enumeration-exampledata"/>11.2.Â Example Events</h2></div></div></div><p>
			The examples in this section come out of the domain of location report (aka. RFID, asset tracking etc.) processing: 
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					The <code class="literal">Item</code> event is a report of the location of a certain item. An item can be either a piece of luggage or a passenger. 
				</p></li><li><p>
					The <code class="literal">LocationReport</code> event contains a list of <code class="literal">Item</code> items for which it reports location. 
				</p></li><li><p>
					The <code class="literal">Zone</code> event describes areas that items may move through.
				</p></li></ol></div><p>
			The examples use example single-row functions for computing the distance (<code class="literal">distance</code>) and for determining if a location falls within a rectangle (<code class="literal">inrect</code>) that are not provided by the EPL language. These example UDF functions are not enumeration methods
			and are used in EPL statements to provide a sensible example.
		</p><p>
			The <code class="literal">Item</code> event contains an <code class="literal">assetId</code> id, a (x,y) <code class="literal">location</code>, a <code class="literal">luggage</code> flag to indicate whether the item represents a luggage (true) or passenger (false), and the <code class="literal">assetIdPassenger</code> that holds the asset id of the associated passenger when the item is a piece of luggage.
		</p><p>
			The <code class="literal">Item</code> event is defined as follows (access methods not shown for brevity):
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class Item {
  String assetId;             // passenger or luggage asset id
  Location location;          // (x,y) location
  boolean luggage;            // true if this item is a luggage piece
  String assetIdPassenger;    // if the item is luggage, contains passenger associated
...</pre><p>
			The <code class="literal">LocationReport</code> event contains a list of <code class="literal">Item</code> items for which it reports events.
		</p><p>
			The <code class="literal">LocationReport</code> event is defined as follows:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class LocationReport {
  List&lt;Item&gt; items;
...</pre><p>
			The <code class="literal">Zone</code> event contains a zone <code class="literal">name</code> and (x1, y1, x2, y2) <code class="literal">rectangle</code>.
		</p><p>
			The <code class="literal">Zone</code> event is defined as follows:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class Zone {
  String name;
  Rectangle rectangle;
...</pre><p>
			The <code class="literal">Location</code> object is a nested object to <code class="literal">Item</code> and provides the current (x,y) location:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class Location {
  int x;
  int y;
...</pre><p>
			The <code class="literal">Rectangle</code> object is a nested object to <code class="literal">Zone</code> and provides a zone rectangle(x1,y1,x2,y2):
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class Rectangle {
  int x1;
  int y1;
  int x2;
  int y2;
...</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="enumeration-howtouse"/>11.3.Â How to Use</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-howtouse-synopsis"/>11.3.1.Â Syntax</h3></div></div></div><p>
				The syntax for enumeration methods is the same syntax as for any chained invocation:
			</p><pre class="synopsis"><span class="emphasis"><em>input_coll</em></span>.<span class="emphasis"><em>enum_method_name</em></span>( [<span class="emphasis"><em>method_parameter</em></span> [, <span class="emphasis"><em>method_parameter</em></span> [,...]]])
	  .[ [<span class="emphasis"><em>enum_method_name</em></span>(...) [...]] | <span class="emphasis"><em>property_name</em></span>] </pre><p>
				Following the <span class="emphasis"><em>input_coll</em></span> input collection (options outlined below), is the <code class="literal">.</code> (dot) operator and the <span class="emphasis"><em>enum_method_name</em></span> enumeration method name. It follows in parenthesis a comma-separated list of method parameter expressions. Additional enumeration methods can be chained thereafter. An event property name can follow for those enumeration methods returning an event-typed (non-scalar) element.
			</p><p>
				If the method parameter is a lambda expression with a single lambda-parameter, specify the lambda-parameter name followed by the <code class="literal">=&gt;</code> lambda operator and followed by the expression. The synopsis for use with a single lambda-parameter is:
			</p><pre class="synopsis">method_parameter: <span class="emphasis"><em>lamda_param</em></span> =&gt; <span class="emphasis"><em>lamda_expression</em></span></pre><p>
				If the method parameter is a lambda expression with two or more lambda-parameters, specify the lambda parameter names in parenthesis followed by the =&gt; lambda operator followed by the expression. The synopsis for use with multiple lambda-parameters is:
			</p><pre class="synopsis">method_parameter: (<span class="emphasis"><em>lamda_param</em></span> [,<span class="emphasis"><em>lamda_param</em></span> [,...]]) =&gt; <span class="emphasis"><em>lamda_expression</em></span></pre><p>
				Generally for lambda expressions, the engine applies the lambda expression to each element in the input collection. The expression yields a result that, depending on the particular enumeration method, is used for aggregation, as a filter or for output, for example.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-howtouse-example"/>11.3.2.Â Introductory Examples</h3></div></div></div><p>
				Let's look at an EPL statement that employs the <code class="literal">where</code> enumeration method and a lambda expression. This example returns items that have a (x, y) location of (0, 0):
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.where(i =&gt; i.location.x = 0 and i.location.y = 0) as zeroloc
from LocationReport</pre><p>
				As enumeration methods can be chained, this selection is equivalent:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.where(i =&gt; i.location.x = 0).where(i =&gt; i.location.y = 0) as zeroloc
from LocationReport</pre><p>
				According to above statement the engine outputs in field <code class="literal">zeroloc</code> a collection of <code class="literal">Item</code> objects matching the condition. 
			</p><p>
				The <code class="literal">where</code> enumeration method has a second version that has two lambda-parameters. The second parameter is the name of the index property which represents the current index of the element within the collection.
			</p><p>
				This sample query returns a collection that consists of the first 3 items. This sample query does not use the <code class="literal">item</code> lambda parameter:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.where( (item, indexElement) =&gt; indexElement &lt; 3) as firstThreeItems
from LocationReport</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-howtouse-output"/>11.3.3.Â Input, Output and Limitations</h3></div></div></div><p>
				It is not necessary to use classes for event representation. The example above applies the same to Object-array, Map or XML underlying events.
			</p><p>
			   For most enumeration methods the input can be any collection of events, scalar values or objects. For some enumeration methods limitations apply that are documented below. For example, the <code class="literal">sumOf</code> enumeration method requires a collection of numeric scalar values if used without parameters.
			   If the input to <code class="literal">sumOf</code> is a collection of events or scalar values the enumeration method requires a lambda expression as parameter that yields the numeric value to use to compute the sum.
			</p><p>
				Many examples of this section operate on the collection returned by the event property <code class="literal">items</code> in the <code class="literal">LocationReport</code> event class. 
				There are many other inputs yielding collections as listed below. Most examples herein use an event property as a input simply because the example can thus be brief and does not need to refer to a subquery, named window, table or other concept.
			</p><p>
				For enumeration methods that return a collection, for example <code class="literal">where</code> and <code class="literal">orderBy</code>, the engine outputs an implementation of the <code class="literal">Collection</code> interface that contains the selected value(s). The collection returned must be considered read-only. As Java does not allow resettable iterators, the <code class="literal">Collection</code> interface allows more flexibility to query size and navigate among collection elements. We recommend against down-casting a collection returned by the engine to a more specific subclass of the <code class="literal">Collection</code> interface.
			</p><p>
				For enumeration methods that return an element, for example <code class="literal">firstOf</code>, <code class="literal">lastOf</code>, <code class="literal">minBy</code> and <code class="literal">maxBy</code> the engine outputs the scalar value or the underlying event if operating on events. You may add an event property name after the enumeration method to return a property value.
			</p><p>
				Enumeration methods generally retain the order of elements provided by the collection.
			</p><p>
				The following restrictions apply to enumeration methods:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						Enumeration methods returning a collection return a read-only implementation of the <code class="literal">Collection</code> interface. You may not use any of the write-methods such as <code class="literal">add</code> or <code class="literal">remove</code> on a result collection.
					</p></li></ol></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="enumeration-inputs"/>11.4.Â Inputs</h2></div></div></div><p>
			The input of data for built-in enumeration methods is a collection of scalar values, events or other objects. Input can originate from any of the following:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					A subquery.
				</p></li><li><p>
					A named window.
				</p></li><li><p>
					A table.
				</p></li><li><p>
					A property of an event that is itself a collection of events or classes, for example indexed properties, or selected properties when using insert-into and <code class="literal">@eventbean</code>.
				</p></li><li><p>
					Any of the event aggregation functions (<code class="literal">window</code>, <code class="literal">first</code>, <code class="literal">last</code>, <code class="literal">sorted</code>, <code class="literal">maxby</code>, <code class="literal">minby</code>, <code class="literal">maxbyever</code>, <code class="literal">minbyever</code>).
				</p></li><li><p>
					The special <code class="literal">prevwindow</code>, <code class="literal">prev</code> and <code class="literal">prevtail</code> single-row functions.
				</p></li><li><p>
					A plug-in single-row function, a user-defined function, a script or an enum type.
				</p></li><li><p>
					A declared expression.
				</p></li><li><p>
					Another enumeration method that returns a collection.
				</p></li><li><p>
					An array returned by the <code class="literal">{}</code> array operator.
				</p></li><li><p>
					A collection or array returned by a method call on an event or a method call on a variable.
				</p></li><li><p>
					A variable. Usually variables declared as an array.
				</p></li><li><p>
					A substitution parameter value provided by a prepared statement.
				</p></li><li><p>
					In a match-recognize pattern, a group variable.
				</p></li><li><p>
					In an EPL pattern, events collected in a repeat (<code class="literal">[...]</code>) and a repeat-until (<code class="literal">... until ...</code>).
				</p></li></ol></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-ds-subquery"/>11.4.1.Â Subquery Results</h3></div></div></div><p>
				Subqueries can return the rows of another stream's data window or rows from a named window or table. By providing a where-clause the rows returned by a subquery can be correlated to data provided by stream(s) in the from-clause. See <a class="xref" href="#epl-subqueries" title="5.11.Â Subqueries">SectionÂ 5.11, âSubqueriesâ</a>.
			</p><p>
				A subquery that selects <code class="literal">(*)</code> wildcard provides a collection of events as input. A subquery that selects a single value expression provides a collection of scalar values as input. Subqueries that selects multiple value expressions are not allowed as input to enumeration methods.
			</p><p>
				The following example uses a subquery to retrieve all zones for each location report item where the location falls within the rectangle of the zone. Please see a description of example events and functions above.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select assetId,
  (select * from Zone#unique(name)).where(z =&gt; inrect(z.rectangle, location)) as zones
from Item</pre><p>
				You may place the subquery in an expression declaration to reuse the subquery in multiple places of the same EPL statement.
			</p><p>
				This sample EPL declares the same query as above in an expression declaration:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression myquery {itm =&gt;
  (select * from Zone#unique(name)).where(z =&gt; inrect(z.rectangle, itm.location))
}
select assetId, myquery(item) as subq, 
    myquery(item).where(z =&gt; z.zone = 'Z01') as assetItem
from Item as item</pre><p>
				The above query also demonstrates how an enumeration method, in the example the <code class="literal">where</code>-method, can be run across the results returned by a subquery in an expression declaration.
			</p><p>
				Place a single column in the subquery select-clause to provide a collection of scalar values as input.
			</p><p>
				The next example selects all names of zones and orders the names returning an order collection of string names every 30 seconds:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select (select name from Zone#unique(name)).orderBy() as orderedZones
from pattern[every timer:interval(30)]</pre><p>
			  The next example utilizes a subquery that counts zone events per name and finds those that have a count greater than 1:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select (select name, count(*) as cnt from Zone#keepall group by name)
  .where(v =&gt; cnt &gt; 1) from LocationReport]</pre><p>
				When the subquery selects a single column that is itself an event, the result of the subquery is a collection of events of that type and can provide
				input to enumeration methods.
			</p><p>
			  For example:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema SettlementEvent (symbol string);</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema PriceEvent (symbol string, price double);</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema OrderEvent (orderId string, pricedata PriceEvent);</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select (select pricedata from OrderEvent#unique(orderId))
  .anyOf(v =&gt; v.symbol = 'GE') as has_ge from SettlementEvent(symbol = 'GE')</pre><p>
				Note that the engine can cache intermediate results thereby is not forced to re-evaluate the subquery for each occurrence in the <code class="literal">select</code>-clause.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-ds-namedwindow"/>11.4.2.Â Named Window</h3></div></div></div><p>
				Named windows are globally-visible data windows. See <a class="xref" href="#nwtable-namedwindow" title="6.2.Â Named Window Usage">SectionÂ 6.2, âNamed Window Usageâ</a>.
			</p><p>
				You may specify the named window name as input for an enumeration method and can optionally provide a correlation where-clause. The syntax is equivalent to a sub-query against a named window but much shorter.
			</p><p>
				Synopsis:
			</p><pre class="synopsis"><span class="emphasis"><em>named-window-name</em></span>[(<span class="emphasis"><em>correlation-expression</em></span>)].<span class="emphasis"><em>enum-method-name</em></span>(...)</pre><p>
				When selecting all events in a named window you do not need the <span class="emphasis"><em>correlation-expression</em></span>. To select a subset of data in the named window, specify a <span class="emphasis"><em>correlation-expression</em></span>.
				From the perspective of best runtime performance, a correlation expression is preferred to reduce the number of rows returned.
			</p><p>
				The following example first declares a named window to hold the last zone event per zone name:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window ZoneWindow#unique(name) as Zone</pre><p>
				Then you create a statement to insert zone events that arrive to the named window:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into ZoneWindow select * from Zone</pre><p>
				Finally this statement queries the named window to retrieve all zones for each location report item where the location falls within the rectangle of the zone:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select ZoneWindow.where(z =&gt; inrect(z.rectangle, location)) as zones from Item</pre><p>
				If you have a filter or correlation expression, append the expression to the named window name and place in parenthesis.
			</p><p>
				This slightly modified query is the example above except that it adds a filter expression such that only zones with name Z1, Z2 or Z3 are considered:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select ZoneWindow(name in ('Z1', 'Z2', 'Z3')).where(z =&gt; inrect(z.rectangle, location)) as zones 
from Item</pre><p>
				You may prefix property names provided by the named window with the name to disambiguate property names.
			</p><p>
				This sample query prefixed the <code class="literal">name</code> property and returns the count of matching zones:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select ZoneWindow(ZoneWindow.name in ('Z1', 'Z2', 'Z3')).countof()) as zoneCount
from Item</pre><p>
				The engine internally interprets the shortcut syntax and creates a subquery from it. Thus all indexing and query planning for subqueries against named windows apply here as well.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-ds-table"/>11.4.3.Â Table</h3></div></div></div><p>
				Tables are globally-visible data structures. See <a class="xref" href="#nwtable-table" title="6.3.Â Table Usage">SectionÂ 6.3, âTable Usageâ</a>.
			</p><p>
				Tables can hold aggregation state such as the <code class="literal">window</code> and <code class="literal">sorted</code> aggregation state.
			</p><p>
				The example EPL below declares a table to hold StockTick events in a column named <code class="literal">theTicks</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table MyTable(theTicks window(*) @type(StockTick))</pre><p>
				The table column can be input to an enumeration method, for example:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select MyTable.theTicks.anyOf(v=&gt; price &gt; 100) from MyEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-ds-property"/>11.4.4.Â Event Property and Insert-Into With <code class="literal">@eventbean</code></h3></div></div></div><p>
				Event properties that are a collection, array or iterable of scalar values or objects can be an input to enumeration methods. 
				Event properties that hold a collection or array of events can be an input to enumeration methods. Use <code class="literal">@eventbean</code> in the <code class="literal">select</code>-clause with <code class="literal">insert into</code> to select events.
			</p><p>
				The <code class="literal">LocationReport</code> event from the example contains a list of <code class="literal">Item</code> events. Any indexed property (list, array, collection, iterable) is eligible for use as input  to an enumeration method. If the indexed property contains non-scalar objects the objects are treated as events and can be used as input to enumeration methods as a collection of events.
			</p><p>
			   The next sample query returns items that are less than 20 units away from the center, taking the <code class="literal">items</code> event property provided by each <code class="literal">LocationReport</code> event as input:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.where(p =&gt; distance(0, 0, p.location.x, p.location.y) &lt; 20) as centeritems
from LocationReport</pre><p>
			   The next three EPL statements declare an <code class="literal">OrderEvent</code> type that contains <code class="literal">OrderDetail</code> events and a query that enumerates order detail:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema OrderDetail(itemId string)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema OrderEvent(details OrderDetail[])</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select details.where(i =&gt; i.itemId = '001') from OrderEvent</pre><p>
			   The first query in this two-query explanation selects the events that have a <code class="literal">price</code> of greater than 100 from a 10-second time window if the count of events is at least 10. It inserts the
			   events into stream <code class="literal">TicksLarge</code>. The use of <code class="literal">@eventbean</code> means that the event property <code class="literal">ticksLargePrice</code> holds events (and not underlying objects).
			   The second query further filters the events and returns a collection of events that have <code class="literal">price</code> of less than 100.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into TicksLarge select window(*).where(e =&gt; e.price &gt; 100) @eventbean as ticksLargePrice
from StockTick#time(10) having count(*) &gt; 10</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select ticksLargePrice.where(e =&gt; e.price &lt; 200) as ticksLargeLess200 from TicksLarge</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-ds-accessagg"/>11.4.5.Â Event Aggregation Function</h3></div></div></div><p>
				Event aggregation functions return an event or multiple events. They are aggregation functions and as such sensitive to the presence of <code class="literal">group by</code>. See <a class="xref" href="#epl-function-aggregation-event" title="10.2.2.Â Event Aggregation Functions">SectionÂ 10.2.2, âEvent Aggregation Functionsâ</a>.
			</p><p>
				You can use <code class="literal">window</code>, <code class="literal">first</code> or <code class="literal">last</code> event aggregation functions as input to an enumeration method. Specify the <code class="literal">*</code> wildcard as the parameter to the event aggregation function to provide a collection of events as input. Or specify a property name as the parameter to event aggregation function to provide a collection of scalar values as input. 
			</p><p>
				You can use the <code class="literal">sorted</code>, <code class="literal">maxby</code>, <code class="literal">minby</code>, <code class="literal">maxbyever</code> or <code class="literal">minbyever</code> event aggregation functions as input to an enumeration method. Specify one or more criteria expressions that provide the sort order as parameters to the event aggregation function. 
			</p><p>
				In this example query the <code class="literal">window(*)</code> aggregation function returns the last 10 seconds of item location reports for the same asset id as the incoming event. Among that last 10 seconds of events for the same asset id, the 
				enumeration method returns those item location reports where the distance to center is less than 20, for each arriving Item event.
			</p><p>
				Sample query:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select window(*).where(p =&gt; distance(0, 0, p.location.x, p.location.y) &lt; 20) as centeritems
from Item(type='P')#time(10) group by assetId</pre><p>
				The next sample query instead selects the asset id property of all events and returns an ordered collection:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select window(assetId).orderBy() as orderedAssetIds
from Item#time(10) group by assetId</pre><p>
				The following example outputs the 5 highest prices per symbol among the last 10 seconds of stock ticks:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sorted(price desc).take(5) as highest5PricesPerSymbol
from StockTick#time(10) group by symbol</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-ds-prev"/>11.4.6.Â <code class="literal">Prev</code>, <code class="literal">Prevwindow</code> and <code class="literal">Prevtail</code> Single-Row Functions as Input</h3></div></div></div><p>
				The <code class="literal">prev</code>, <code class="literal">prevwindow</code> and <code class="literal">prevtail</code> single-row functions allow access into a stream's data window however are not aggregation functions and and as such not sensitive to the presence of <code class="literal">group by</code>. See <a class="xref" href="#epl-single-row-function-ref-previouswindow" title="10.1.14.Â The Previous-Window Function">SectionÂ 10.1.14, âThe Previous-Window Functionâ</a>.
			</p><p>
				When using any of the <code class="literal">prev</code> single-row functions as input to a built-in enumeration method you can specify the stream name as a parameter to the function or an event property. The input to the enumeration method is a collection of events if you specify the stream name, or a collection of scalar value if you specify an event property.
			</p><p>
				In this example query the <code class="literal">prevwindow(stream)</code> single-row function returns the last 10 seconds of item location reports, among which the 
				enumeration method filters those item location reports where the distance to center is less than 20, for each Item event that arrived in the last 10 seconds considering passenger-type Item events only (see filter type = 'P').
			</p><p>
				Sample query:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prevwindow(items)
    .where(p =&gt; distance(0, 0, p.location.x, p.location.y) &lt; 20) as centeritems
from Item(type='P')#time(10) as items</pre><p>
				This sample query demonstrates the use of the <code class="literal">prevwindow</code> function to return a collection of scalar values (collection of asset id) as input to <code class="literal">orderby</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prevwindow(assetId).orderBy() as orderedAssetIds
from Item#time(10) as items</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-ds-udf"/>11.4.7.Â Single-Row Function, User-Defined Function and Enum Types</h3></div></div></div><p>
				Your single-row or user-defined function can return either an array or any collection that implements either the <code class="literal">Collection</code> or <code class="literal">Iterable</code> interface. For arrays, the array component type and for collections, the collection or iterable generic type should be the class providing event properties.
			</p><p>
				As an example, assume a <code class="literal">ZoneFactory</code> class exists and a static method <code class="literal">getZones()</code> returns a list of zones to filter items, for example:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class ZoneFactory {
  public static Iterable&lt;Zone&gt; getZones() {
    List&lt;Zone&gt; zones = new ArrayList&lt;Zone&gt;();
    zones.add(new Zone("Z1", new Rectangle(0, 0, 20, 20)));
    return zones;
  }
}</pre><p>
				Import the class through runtime or static configuration, or add the method above as a plug-in single-row function.
			</p><p>
				The following query returns for each Item event all zones that the item belongs to:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select ZoneFactory.getZones().where(z =&gt; inrect(z.rectangle, item.location)) as zones
from Item as item</pre><p>
				If the class and method were registered as a plug-in single-row function, you can leave the class name off, for example:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select getZones().where(z =&gt; inrect(z.rectangle, item.location)) as zones
from Item as item</pre><p>
				Your single-row or user-defined function can also return an array, collection or iterable or scalar values.
			</p><p>
				For example, the static method <code class="literal">getZoneNames()</code> returns a list of zone names:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public static String[] getZoneNames() { 
  return new String[] { "Z1", "Z2"};
}</pre><p>
				The following query returns zone names every 30 seconds and excludes zone Z1:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select getZoneNames().where(z =&gt; z != "Z1")
from pattern[every timer:interval(30)]</pre><p>
				An enum type can also be a useful source for enumerable values.
			</p><p>
				The following sample Java declares an enum type <code class="literal">EnumOfZones</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public enum EnumOfZones {
  ZONES_OUTSIDE(new String[] {"z1", "z2"}),
  ZONES_INSIDE(new String[] {"z3", "z4"})

  private final String[] zones;

  private EnumOfZones(String[] zones) {
	  this.zones = zones;
  }

  public String[] getZones() {
    return zones;
  }
}</pre><p>
				A sample statement that utilizes the enum type is shown next:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select EnumOfZones.ZONES_OUTSIDE.getZones().anyOf(v =&gt; v = zone) from Item</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-ds-lambda"/>11.4.8.Â Declared Expression</h3></div></div></div><p>
				A declared expression may return input data for an enumeration method.
			</p><p>
				The below query declares an expression that returns all passenger location reports among the items in the location report event in a column named <code class="literal">passengerCollection</code>. The query uses the result returned by the declared expression
				a second time to filter through the list returning the passenger location report where the asset id is a given value in a column named <code class="literal">passengerP01</code>.
			</p><p>
				Sample query:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression passengers {
  lr =&gt; lr.items.where(l =&gt; l.type='P')
}
select passengers(lr) as passengerCollection,
  passengers(lr).where(x =&gt; assetId = 'P01') as passengerP01
from LocationReport lr</pre><p>
				The engine applies caching techniques to avoid re-evaluating the declared expression multiple times.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-ds-variable"/>11.4.9.Â Variables</h3></div></div></div><p>
				A variable may provide input data for an enumeration method.
			</p><p>
				This constant of array type carries a list of invalid zones:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create constant variable string[] invalid_zones = { 'Z1', 'Z2' };</pre><p>
				Sample query:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select invalid_zones.anyOf(v =&gt; v = name) as flagged from Zone</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-ds-substitution"/>11.4.10.Â Substitution Parameters</h3></div></div></div><p>
				A substitution paramater may provide input data for an enumeration method. The value of the parameter must be array-typed.
			</p><p>
				Sample query:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select ?.anyOf(v =&gt; v = name) as flagged from Zone</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-ds-matchrecog"/>11.4.11.Â Match-Recognize Group Variable</h3></div></div></div><p>
				In a match-recognize pattern, the term <span class="emphasis"><em>group variables</em></span> refers to identifiers that can collect multiple events.
			</p><p>
				This example assumes an order event type and each order has an item id.
				This sample match-recognize pattern finds a sequence of order events that concludes with an item id matching any of the collected item ids since the last pattern match:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from Order
match_recognize (
  measures A as a_array, B as b
  pattern (A* B)
  define
  B as A.anyOf(v=&gt; v.itemId = B.itemId)
)</pre><p>
				Both the <code class="literal">define</code> and the <code class="literal">measures</code> clause can contain expressions utilizing enumeration methods.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-ds-eplpattern"/>11.4.12.Â Pattern Repeat and Repeat-Until Operators</h3></div></div></div><p>
				In an EPL pattern, the repeat and repeat-until pattern operators may collect multiple events.
			</p><p>
				The following pattern fires when two order events arrive followed by an order amendment event that has an amount larger than the largest amount of any of the preceding order events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern [
  ([2] a=Order) -&gt; b=OrderAmendment(amount &gt; a.max(i =&gt; i.amount))
]</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="enumeration-example"/>11.5.Â Example</h2></div></div></div><p>
			Following the RFID asset tracking example as introduced earlier, this section introduces two use cases solved by enumeration methods.
		</p><p>
			The first use case requires us to find any luggage that is more then 20 units away from the passenger that the luggage belongs to.
			The declared expression <code class="literal">lostLuggage</code> solves this question.
		</p><p>
			The second question to answer is: For each of such lost luggage what single other passenger is nearest to that luggage.
			The declared expression <code class="literal">nearestOwner</code> which uses <code class="literal">lostLuggage</code> answers this question.
		</p><p>
			Below is the complete EPL statement (one statement not multiple):
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// expression to return a collection of lost luggage
expression lostLuggage {
  lr =&gt; lr.items.where(l =&gt; l.type='L' and
    lr.items.some(p =&gt; p.type='P' and p.assetId=l.assetIdPassenger 
      and LRUtil.distance(l.location.x, l.location.y, p.location.x, p.location.y) &gt; 20))
}

// expression to return all passengers
expression passengers {
  lr =&gt; lr.items.where(l =&gt; l.type='P')
}

// expression to find the nearest owner
expression nearestOwner {
  lr =&gt; lostLuggage(lr).toMap(key =&gt; key.assetId,
    value =&gt; passengers(lr).minBy(
        p =&gt; LRUtil.distance(value.location.x, value.location.y, p.location.x, p.location.y))
    )
}

select lostLuggage(lr) as val1, nearestOwner(lr) as val2 from LocationReport lr</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="enumeration-method"/>11.6.Â Reference</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-aggregate"/>11.6.1.Â Aggregate</h3></div></div></div><p>
				The <code class="literal">aggregate</code> enumeration method takes an expression providing the initialization value (seed) and an accumulator lambda expression. The return value is the final accumulator value. 
			</p><p>
				Via the <code class="literal">aggregate</code> method you may perform a calculation over elements. The method initializes the aggregated value by evaluating the expression provided in the first parameter. The method then calls the lambda expression of the second parameter once for each element in the input. The lambda expression receives the last aggregated value and the element from the input. The result of the expression replaces the previous aggregated value and returns the final result after completing all elements.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3}.aggregate(0, (result, value) =&gt; result + value)  // Returns 6</pre><p>
				The example below aggregates price of each OrderEvent in the last 10 seconds computing a total price:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Initialization value is zero.
// Aggregate by adding up the price.
select window(*).aggregate(0, (result, order) =&gt; result + order.price) as totalPrice
from OrderEvent#time(10)</pre><p>
				In the query above, the initialization value is zero, <code class="literal">result</code> is used for the last aggregated value and <code class="literal">order</code> denotes the element that the expression adds the value of the price property.
			</p><p>
				This example aggregation builds a comma-separated list of all asset ids of all items:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.aggregate('', 
  (result, item) =&gt; result || (case when result='' then '' else ',' end) || item.assetId) as assets			
from LocationReport</pre><p>
				In above query, the empty string <code class="literal">''</code> represents the initialization value. The name <code class="literal">result</code> is used for the last aggregated value and the name <code class="literal">item</code> is used to denote the element.
			</p><p>
				The type value returned by the initialization expression must match to the type of value returned by the accumulator lambda expression. 
			</p><p>
				If the input is null the method returns null. If the input is empty the method returns the initialization value.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-allof"/>11.6.2.Â AllOf</h3></div></div></div><p>
				The <code class="literal">allof</code> enumeration method determines whether all elements satisfy the predicate condition.
			</p><p>
				The method takes a single parameter: The predicate lambda expression that must yield a Boolean result. The enumeration method applies the lambda expression to each element and if the expression returns true for all elements, the method returns true.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3}.allOf(v =&gt; v &gt; 0)    // Returns true as all values are &gt; 0
{1, 2, 3}.allOf(v =&gt; v &gt; 1)    // Returns false</pre><p>
				The EPL statement below returns true when all items are within 1000 unit distance of center:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.allof(i =&gt; distance(i.location.x, i.location.y, 0, 0) &lt; 1000) as centered			
from LocationReport</pre><p>
				If the input is null the method returns null. If the input is empty the method returns true.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-anyof"/>11.6.3.Â AnyOf</h3></div></div></div><p>
				The <code class="literal">anyof</code> enumeration method determines whether any element satisfies the predicate condition.
			</p><p>
				The only parameter is the predicate lambda expression that must yield a Boolean result. The enumeration method applies the lambda expression to each element and if the expression returns true for all elements, the method returns true.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3}.anyOf(v =&gt; v &gt; 0)    // Returns true
{1, 2, 3}.anyOf(v =&gt; v &gt; 1)    // Returns true
{1, 2, 3}.anyOf(v =&gt; v &gt; 3)    // Returns false</pre><p>
				The EPL statement below return true when any of the items are within 10 unit distance of center:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.anyof(i =&gt; distance(i.location.x, i.location.y, 0, 0) &lt; 10) as centered			
from LocationReport</pre><p>
				If the input is null the method returns null. If the input is empty the method returns false.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-average"/>11.6.4.Â Average</h3></div></div></div><p>
				The <code class="literal">average</code> enumeration method computes the average of scalar values. If passing a projection lambda expression the method computes the average obtained by invoking the projection lambda expression on each element.
			</p><p>
				The method takes a projection lambda expression yielding a numeric value as a parameter. It applies the lambda expression to each element and computes the average of the result, returning a Double value. A BigDecimal is returned for expressions returning BigInteger or BigDecimal.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3}.average()    // Returns 2</pre><p>
				The EPL statement as shown next computes the average distance from center among all items in the location report event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.average(i =&gt; distance(i.location.x, i.location.y, 0, 0)) as avgdistance
from LocationReport</pre><p>
				If the input is null the method returns null. If the input is empty the method returns double zero or BigDecimal zero. For BigDecimal precision and rounding, please see <a class="xref" href="#config-engine-expression-mathcontext" title="15.4.26.6.Â Math Context">SectionÂ 15.4.26.6, âMath Contextâ</a>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-countof"/>11.6.5.Â CountOf</h3></div></div></div><p>
				The <code class="literal">countof</code> enumeration method returns the number of elements, or the number of elements that satisfy a condition.
			</p><p>
				The enumeration method has two versions: The first version takes no parameters and computes the number of elements. The second version takes a predicate lambda expression that must yield Boolean true or false, and computes the number of elements that satisfy the condition.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3}.countOf()    // Returns 3
{1, 2, 3}.countOf(v =&gt; v &lt; 2)    // Returns 1</pre><p>
				The next sample statement counts the number of items:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.countOf() as cnt from LocationReport</pre><p>
				This example statement counts the number of items that have a distance to center that is less than 20 units:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.countOf(i =&gt; distance(i.location.x, i.location.y, 0, 0) &lt; 20) as cntcenter
from LocationReport</pre><p>
				If the input is null the method returns null. If the input is empty the method returns integer zero.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-distinctof"/>11.6.6.Â DistinctOf</h3></div></div></div><p>
				The <code class="literal">distinctOf</code> enumeration method returns distinct elements.
			</p><p>
				The enumeration method can take a single key-selector lambda expression as parameter and returns distinct elements according to the key yielded by the expression. 
				For same-value keys, distinct returns the first element for that key.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{2, 3, 2, 1}.distinctOf()   // Returns {2, 3, 1}</pre><p>
				This example returns items distinct by item id returning the first item for each distinct item id:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.distinctOf(i =&gt; itemId) as itemsNearFirst
from LocationReport</pre><p>
				The key-selector lambda expression, when provided, must return a comparable type: Any primitive or boxed or <code class="literal">Comparable</code> type is permitted.
			</p><p>
				If the input is null the method returns null. If the input is empty the method returns an empty collection.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-except"/>11.6.7.Â Except</h3></div></div></div><p>
				The <code class="literal">except</code> enumeration method forms a set difference of the input elements with the elements that the parameter expression yields.
			</p><p>
				The enumeration method takes a single parameter that must itself return a collection of events, objects or scalar values. The method returns the elements of the first collection that do not appear in the second collection.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3}.except({1})   // Returns {2, 3}</pre><p>
				The following statement compares the items of the last location report against all items in the previous 10 location reports, and reports for each combination only those items in the current item report that are not also in the location report compared to:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select za.items.except(zb.items) as itemsCompared 
from LocationReport as za unidirectional, LocationReport#length(10) as zb</pre><p>
				If the input is null the method returns null. For scalar values and objects equals-semantics apply.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-firstof"/>11.6.8.Â FirstOf</h3></div></div></div><p>
				The <code class="literal">firstOf</code> enumeration method returns the first element or the first element that satisfies a condition.
			</p><p>
				The method has two versions: The first version takes no parameters and returns the first element. The second version takes a predicate lambda expression yielding true or false. It applies the lambda expression to each element and returns the first element for which the expression returns true. The return type is the element itself and not a collection. You may append a property name to return the property value for the first element.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3}.firstOf()   // Returns 1
{1, 2, 3}.firstOf(v =&gt; v / 2 &gt; 1)   // Returns 3</pre><p>
				In the following EPL sample the query returns the first item that has a distance to center that is less than 20 units:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.firstof(i =&gt; distance(i.location.x, i.location.y, 0, 0) &lt; 20) as firstcenter
from LocationReport</pre><p>
				The next sample EPL returns the first item's asset id:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.firstof().assetId as firstAssetId from LocationReport</pre><p>
				If the input is null, empty or if none of the elements match the condition the method returns null.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-groupby"/>11.6.9.Â GroupBy</h3></div></div></div><p>
				The <code class="literal">groupby</code> enumeration method groups the elements according to a specified key-selector lambda expression. There are two version of the <code class="literal">groupby</code> method.
			</p><p>
				The first version of the method takes a key-selector lambda expression and returns a Map of key with each value a list of objects, one for each distinct key that was encountered. The result is a <code class="literal">Map&lt;Object, Collection&lt;Object&gt;&gt;</code> wherein object is the event underlying object.
			</p><p>
				The second version of the method takes a key-selector lambda expression and value-selector lambda expression and returns a Map of key with each value a list of values, one for each distinct key that was encountered. The result is a <code class="literal">Map&lt;Object, Collection&lt;Object&gt;&gt;</code> wherein object is the result of applying the value-selector expression.
			</p><p>
				The next query filters out all luggage items using a <code class="literal">where</code> method and then groups by the luggage's passenger asset id. It returns a map of
				passenger asset id and the collection of luggage items for each passenger:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.where(type='L').groupby(i =&gt; assetIdPassenger) as luggagePerPerson
from LocationReport</pre><p>
				The query shown below generates a map of item asset id and distance to center:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.groupby(
    k =&gt; assetId, v =&gt; distance(v.location.x, v.location.y, 0, 0)) as distancePerItem
from LocationReport</pre><p>
				If the input is null the method returns null. Null values as key and value are allowed.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-intersect"/>11.6.10.Â Intersect</h3></div></div></div><p>
				The <code class="literal">intersect</code> enumeration method forms a set intersection of the input elements with the elements that the parameter expression yields.
			</p><p>
				The enumeration method takes a single parameter that must itself return a collection of events, objects or scalar values. The method returns the elements of the first collection that also appear in the second collection.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3}.intersect({2, 3})   // Returns {2, 3}</pre><p>
				The following statement compares the items of the last location report against all items in the previous 10 location reports, and reports for each combination all items in the current item report that also occur in the other location report:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select za.items.intersect(zb.items) as itemsCompared 
from LocationReport as za unidirectional, LocationReport#length(10) as zb</pre><p>
				If the input is null the method returns null. For scalar values and objects equals-semantics apply.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-lastof"/>11.6.11.Â LastOf</h3></div></div></div><p>
				The <code class="literal">lastOf</code> enumeration method returns the last element or the last element that satisfies a condition.
			</p><p>
				The method has two versions: The first version takes no parameters and returns the last element. The second version takes a predicate lambda expression yielding true or false. It applies the lambda expression to each element and returns the last element for which the expression returns true. The return type is the element itself and not a collection. You may append a property name to return the property value for the last element.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3}.lastOf()   // Returns 3
{1, 2, 3}.lastOf(v =&gt; v &lt; 3)   // Returns 2</pre><p>
				In the following EPL sample the query returns the last item that has a distance to center that is less than 20 units:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.lastof(i =&gt; distance(i.location.x, i.location.y, 0, 0) &lt; 20) as lastcenter 
from LocationReport</pre><p>
				The next sample EPL returns the last item's asset id:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.lastof().assetId as lastAssetId from LocationReport</pre><p>
				If the input is null, empty or if none of the elements match the condition the method returns null.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-leastfrequent"/>11.6.12.Â LeastFrequent</h3></div></div></div><p>
				The <code class="literal">leastFrequent</code> enumeration method returns the least frequent value among a collection of values, or the least frequent value after applying a transform expression to each element.
			</p><p>
				The method has two versions: The first version takes no parameters and returns the least frequent value. The second version takes a transform lambda expression yielding the value to count occurrences for. The method applies the lambda expression to each element and returns the expression result value with the least number of occurrences. The return type is the type of value in the collection or the type of value returned by the transform lambda expression if one was provided.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3, 2, 1}.leastFrequent()   // Returns 3</pre><p>
				The example EPL below returns the least frequent item type, counting the distinct item types among all items for the current LocationReport event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.leastFrequent(i =&gt; type) as leastFreqType from LocationReport</pre><p>
				If the input is null or empty the method returns null. The transform expression may also yield null. A null value can be returned as the most frequent value if the most frequent value is null. If multiple values have the same number of occurrences the method returns the first value with the least number of occurrences considering the ordering of the collection.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-max"/>11.6.13.Â Max</h3></div></div></div><p>
				The <code class="literal">max</code> enumeration method returns the maximum value among a collection of values.
			</p><p>
				If no value-selector lambda expression is provided, the method finds the maximum.
			</p><p>
				If a value-selector lambda expression is provided, the enumeration method invokes a value-selector lambda expression on each element and returns the maximum value. The type of value returned follows the return type of the lambda expression that was provided as parameter.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3, 2, 1}.max()   // Returns 3</pre><p>
				The next query returns the maximum distance of any item from center:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.max(i =&gt; distance(i.location.x, i.location.y, 0, 0)) as maxcenter 
from LocationReport</pre><p>
				The value-selector lambda expression must return a comparable type: Any primitive or boxed type or <code class="literal">Comparable</code> type is permitted.
			</p><p>
				If the input is null, empty or if none of the elements when transformed return a non-null value the method returns null.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-maxby"/>11.6.14.Â MaxBy</h3></div></div></div><p>
				The <code class="literal">maxBy</code> enumeration method returns the element that provides the maximum value returned by the value-selector lambda expression when applied to each element.
			</p><p>
				The enumeration method returns the element itself. You may append an event property name to return a property value of the element.
			</p><p>
				The next query returns the first item with the maximum distance to center:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.maxBy(i =&gt; distance(i.location.x, i.location.y, 0, 0)) as maxItemCenter 
from LocationReport</pre><p>
				The next sample returns the type of the item with the largest asset id (string comparison) among all items:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.maxBy(i =&gt; assetId).type as minAssetId from LocationReport</pre><p>
				The transform expression must return a comparable type: Any primitive or boxed type or <code class="literal">Comparable</code> type is permitted.
			</p><p>
				If the input is null, empty or if none of the elements when transformed return a non-null value the method returns null.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-min"/>11.6.15.Â Min</h3></div></div></div><p>
				The <code class="literal">min</code> enumeration method returns the minimum value among a collection of values.
			</p><p>
				If no value-selector lambda expression is provided, the method finds the minimum.
			</p><p>
				If a value-selector lambda expression is provided, the enumeration method invokes a value-selector lambda expression on each element and returns the minimum value. The type of value returned follows the return type of the lambda expression that was provided as parameter.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3, 2, 1}.min()   // Returns 1</pre><p>
				The next query returns the minimum distance of any item to center:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.min(i =&gt; distance(i.location.x, i.location.y, 0, 0)) as mincenter 
from LocationReport</pre><p>
				The transform expression must return a comparable type: Any primitive or boxed type or <code class="literal">Comparable</code> type is permitted.
			</p><p>
				If the input is null, empty or if none of the elements when transformed return a non-null value the method returns null.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-minby"/>11.6.16.Â MinBy</h3></div></div></div><p>
				The <code class="literal">minBy</code> enumeration method returns the element that provides the minimum value returned by the value-selector lambda expression when applied to each element.				
			</p><p>
				The enumeration method returns the element itself. You may append an event property name to return a property value of the element.
			</p><p>
				The next query returns the first item with the minimum distance to center:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.minBy(i =&gt; distance(i.location.x, i.location.y, 0, 0)) as minItemCenter 
from LocationReport</pre><p>
				The next sample returns the type of the item with the smallest asset id (string comparison) among all items:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.minBy(i =&gt; assetId).type as minAssetId from LocationReport</pre><p>
				The transform expression must return a comparable type: Any primitive or boxed or <code class="literal">Comparable</code> type is permitted.
			</p><p>
				If the input is null, empty or if none of the elements when transformed return a non-null value the method returns null.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-mostfrequent"/>11.6.17.Â MostFrequent</h3></div></div></div><p>
				The <code class="literal">mostFrequent</code> enumeration method returns the most frequent value among a collection of values, or the most frequent value after applying a transform expression to each element.
			</p><p>
				The method has two versions: The first version takes no parameters and returns the most frequent value. The second version takes a transform lambda expression yielding the value to count occurrences for. The method applies the lambda expression to each element and returns the expression result value with the most number of occurrences. The return type is the type of value in the collection or the type of value returned by the transform lambda expression if one was provided.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3, 2, 1, 2}.mostFrequent()   // Returns 2</pre><p>
				The example EPL below returns the least frequent item type, counting the distinct item types among all items for the current LocationReport event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.leastFrequent(i =&gt; type) as leastFreqType from LocationReport</pre><p>
				If the input is null or empty the method returns null. The transform expression may also yield null. A null value can be returned as the most frequent value if the most frequent value is null. If multiple values have the same number of occurrences the method returns the first value with the most number of occurrences considering the ordering of the collection.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-orderby"/>11.6.18.Â OrderBy and OrderByDesc</h3></div></div></div><p>
				The <code class="literal">orderBy</code> enumeration method sorts elements in ascending order according to a key. The <code class="literal">orderByDesc</code> enumeration method sorts elements in descending order according to a key.
			</p><p>
				The enumeration method takes a single key-selector lambda expression as parameter and orders elements according to the key yielded by the expression. For same-value keys, it maintains the existing order.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{2, 3, 2, 1}.orderBy()   // Returns {1, 2, 2, 3}</pre><p>
				This example orders all items from a location report according to their distance from center:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.orderBy(i =&gt; distance(i.location.x, i.location.y, 0, 0)) as itemsNearFirst,
  items.orderByDesc(i =&gt; distance(i.location.x, i.location.y, 0, 0)) as itemsFarFirst
from LocationReport</pre><p>
				The key-selector lambda expression must return a comparable type: Any primitive or boxed or <code class="literal">Comparable</code> type is permitted.
			</p><p>
				If the input is null the method returns null. If the input is empty the method returns an empty collection.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-reverse"/>11.6.19.Â Reverse</h3></div></div></div><p>
				The <code class="literal">reverse</code> enumeration method simply reverses the order of elements returning a collection.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{2, 3, 2, 1}.reverse()   // Returns {1, 2, 3, 2}</pre><p>
				The following EPL reverses the items:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.reverse() as reversedItems from LocationReport</pre><p>
				If the input is null the method returns null. If the input is empty the method returns an empty collection.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-selectfrom"/>11.6.20.Â SelectFrom</h3></div></div></div><p>
				The <code class="literal">selectFrom</code> enumeration method transforms each element resulting in a collection of transformed elements.
			</p><p>
				The enumeration method applies a transformation lambda expression to each element and returns the result of each transformation as a collection. Use the <code class="literal">new</code> operator to yield multiple values for each element, see <a class="xref" href="#epl-operator-new" title="9.13.Â The 'New' Keyword">SectionÂ 9.13, âThe 'New' Keywordâ</a>.
			</p><p>
				The next EPL query returns a collection of asset ids:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.selectFrom(i =&gt; assetId) as itemAssetIds from LocationReport</pre><p>
				This sample EPL query evaluates each item and returns the asset id as well as the distance from center for each item:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.selectFrom(i =&gt; 
  new {
    assetId, 
    distanceCenter = distance(i.location.x, i.location.y, 0, 0)
  } ) as itemInfo from LocationReport</pre><p>
				If the input is null the method returns null. If the input is empty the method returns an empty collection.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-sequenceequal"/>11.6.21.Â SequenceEqual</h3></div></div></div><p>
				The <code class="literal">sequenceEqual</code> enumeration method determines whether two collections are equal by comparing each element.
			</p><p>
				The method enumerates the two source collections in parallel and compares corresponding elements by using the <code class="literal">equals</code> method to compare. The method takes a single parameter expression that must return a collection containing elements of the same type as the input. The method returns true if the two source sequences are of equal length and their corresponding elements are equal.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3}.sequenceEqual({1})   // Returns false
{1, 2, 3}.sequenceEqual({1, 2, 3})   // Returns true</pre><p>
				The following example compares the asset id of all items to the asset ids returned by a method <code class="literal">ItemUtil.redListed()</code> which is assumed to return a list of asset id of string type:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.selectFrom(i =&gt; assetId).sequenceEquals(ItemUtil.redListed()) from LocationReport</pre><p>
				If the input is null the method returns null.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-sumof"/>11.6.22.Â SumOf</h3></div></div></div><p>
				The <code class="literal">sumOf</code> enumeration method computes the sum. If a projection lambda expression is provided, the method invokes the projection lambda expression on each element and computes the sum on each returned value.
			</p><p>
				The projection lambda expression should yield a numeric value, BigDecimal or BigInteger value. Depending on the type returned by the projection lambda expression the method returns either Integer, Long, Double, BigDecimal or BigInteger.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3}.sumOf()   // Returns 6</pre><p>
				The following example computes the sum of the distance of each item to center:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.sum(i =&gt; distance(i.location.x, i.location.y, 0, 0) as totalAllDistances
from LocationReport</pre><p>
				If the input is null or empty the method returns null.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-take"/>11.6.23.Â Take</h3></div></div></div><p>
				The <code class="literal">take</code> enumeration method returns a specified number of contiguous elements from the start.
			</p><p>
				The enumeration method takes a single size (non-lambda) expression that returns an Integer value.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3}.take(2)   // Returns {1, 2}</pre><p>
				The following example returns the first 5 items:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.take(5) as first5Items from LocationReport</pre><p>
				If the input is null the method returns null. If the input is empty the method returns an empty collection.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-takelast"/>11.6.24.Â TakeLast</h3></div></div></div><p>
				The <code class="literal">takeLast</code> enumeration method returns a specified number of contiguous elements from the end.
			</p><p>
				The enumeration method takes a single size (non-lambda) expression that returns an Integer value.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3}.takeLast(2)   // Returns {2, 3}</pre><p>
				The following example returns the last 5 items:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.takeLast(5) as last5Items from LocationReport</pre><p>
				If the input is null the method returns null. If the input is empty the method returns an empty collection.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-takewhile"/>11.6.25.Â TakeWhile</h3></div></div></div><p>
				The <code class="literal">takeWhile</code> enumeration method returns elements from the start as long as a specified condition is true.
			</p><p>
				The enumeration method has two versions. The first version takes a predicate lambda expression and the second version takes a predicate lambda expression and index for use within the predicate expression. Both versions return elements from the start as long as the specified condition is true.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3}.takeWhile(v =&gt; v &lt; 3)   // Returns {1, 2}
{1, 2, 3}.takeWhile((v,ind) =&gt; ind &gt; 2)   // Returns {1, 2}
{1, 2, -1, 4, 5, 6}.takeWhile((v,ind) =&gt; ind &lt; 5 and v &gt; 0)  // Returns {1, 2} (Take while index&lt;5 amd value&gt;0)</pre><p>
				This example selects all items from a location report in the order provided until the first item that has a distance to center greater than 20 units:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.takeWhile(i =&gt; distance(i.location.x, i.location.y, 0, 0) &lt; 20)
from LocationReport</pre><p>
				The second version of the <code class="literal">where</code> represents the index of the input element starting at zero for the first element.
			</p><p>
				The next example is similar to the query above but also limits the result to the first 10 items:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.takeWhile((i, ind) =&gt; distance(i.location.x, i.location.y, 0, 0) &lt; 20) and ind &lt; 10)
from LocationReport</pre><p>
				If the input is null the method returns null. If the input is empty the method returns an empty collection.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-takewhilelast"/>11.6.26.Â TakeWhileLast</h3></div></div></div><p>
				The <code class="literal">takeWhileLast</code> enumeration method returns elements from the end as long as a specified condition is true.
			</p><p>
				The enumeration method has two versions. The first version takes a predicate lambda expression and the second version takes a predicate lambda expression and index for use within the predicate expression. Both versions return elements from the end as long as the specified condition is true.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3}.takeWhileLast(v =&gt; v &lt; 3)   // Returns {} (empty collection)
{1, 2, 3}.takeWhileLast(v =&gt; v &gt; 1)   // Returns {2, 3}
{1, 2, 3}.takeWhileLast((v,ind) =&gt; ind &gt; 2)   // Returns {2, 3}
{1, 2, -1, 4, 5, 6}.takeWhileLast((v,ind) =&gt; ind &lt; 5 and v &gt; 0)  // Returns {4, 5, 6} (Take while index&lt;5 amd value&gt;0)</pre><p>
				This example selects all items from a location report, starting from the last element and proceeding backwards, until the first item that has a distance to center greater than 20 units:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.takeWhile(i =&gt; distance(i.location.x, i.location.y, 0, 0) &lt; 20)
from LocationReport</pre><p>
				The second version provides the index of the input element starting at zero for the last element (reverse index).
			</p><p>
				The next example is similar to the query above but also limits the result to the last 10 items:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.takeWhile((i, ind) =&gt; distance(i.location.x, i.location.y, 0, 0) &lt; 20) and ind &lt; 10)
from LocationReport</pre><p>
				If the input is null the method returns null. If the input is empty the method returns an empty collection.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-tomap"/>11.6.27.Â ToMap</h3></div></div></div><p>
				The <code class="literal">toMap</code> enumeration method returns a Map according to specified key-selector lambda expression and value-selector lambda expression.
			</p><p>
				The enumeration method takes a key-selector expression and a value-selector expression. For each element the method applies the key-selector expression to determine the map key and the value-selector expression to determine the map value. If the key already exists in the map the value is overwritten.
			</p><p>
				The next example EPL outputs a map of item asset id and distance to center for each item:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.toMap(k =&gt; k.assetId, v =&gt; distance(v.location.x, v.location.y, 0, 0)) as assetDistance
from LocationReport</pre><p>
				If the input is null the method returns null. If the input is empty the method returns an empty map.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-union"/>11.6.28.Â Union</h3></div></div></div><p>
				The <code class="literal">union</code> enumeration method forms a union of the input elements with the elements that the parameter expression yields.
			</p><p>
				The enumeration method takes a single parameter that must itself return a collection of events (input), objects or scalar values. It appends the collection to the input elements and returns the appended collection of elements.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3}.union({4, 5})   // Returns {1, 2, 3, 4, 5}</pre><p>
				This example selects a union of all items that have an asset id of L001 or that are of type passenger:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.where(i =&gt; i.assetId = 'L001')
    .union(items.where(i =&gt; i.type = 'P')) as itemsUnion
from LocationReport</pre><p>
				If the input is null the method returns null.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="enumeration-method-where"/>11.6.29.Â Where</h3></div></div></div><p>
				The <code class="literal">where</code> enumeration method filters elements based on a predicate.
			</p><p>
				The enumeration method has two versions. The first version takes a predicate lambda expression and the second version takes a predicate lambda expression and index for use within the predicate expression. Both version returns all elements for which the predicate expression is true.
			</p><p>
				An expression example with scalar values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{1, 2, 3}.where(v =&gt; v != 2)   // Returns {1, 3}</pre><p>
				This example selects all items from a location report that are passenger-type:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.where(p =&gt; p.type = 'P') from LocationReport</pre><p>
				The second version of the <code class="literal">where</code> represents the index of the input element starting at zero for the first element.
			</p><p>
				The example below selects all items from a location report that are passenger-type but ignores the first 3 elements:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select items.where((p, ind) =&gt; p.type = 'P' and ind &gt; 2) from LocationReport</pre><p>
				If the input is null the method returns null. If the input is empty the method returns an empty collection.
			</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="datetimereference"/>ChapterÂ 12.Â EPL Reference: Date-Time Methods</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#datetime-intro">12.1. Overview</a></span></dt><dt><span class="sect1"><a href="#datetime-howtouse">12.2. How to Use</a></span></dt><dd><dl><dt><span class="sect2"><a href="#datetime-howtouse-synopsis">12.2.1. Syntax</a></span></dt></dl></dd><dt><span class="sect1"><a href="#datetime-method-calref">12.3. Calendar and Formatting Reference</a></span></dt><dd><dl><dt><span class="sect2"><a href="#datetime-method-between">12.3.1. Between</a></span></dt><dt><span class="sect2"><a href="#datetime-method-format">12.3.2. Format</a></span></dt><dt><span class="sect2"><a href="#datetime-method-get">12.3.3. Get (By Field)</a></span></dt><dt><span class="sect2"><a href="#datetime-method-getitem">12.3.4. Get (By Name) </a></span></dt><dt><span class="sect2"><a href="#datetime-method-minus">12.3.5. Minus</a></span></dt><dt><span class="sect2"><a href="#datetime-method-plus">12.3.6. Plus</a></span></dt><dt><span class="sect2"><a href="#datetime-method-roundceiling">12.3.7. RoundCeiling</a></span></dt><dt><span class="sect2"><a href="#datetime-method-roundfloor">12.3.8. RoundFloor</a></span></dt><dt><span class="sect2"><a href="#datetime-method-roundhalf">12.3.9. RoundHalf</a></span></dt><dt><span class="sect2"><a href="#datetime-method-set">12.3.10. Set (By Field)</a></span></dt><dt><span class="sect2"><a href="#datetime-method-withdate">12.3.11. WithDate</a></span></dt><dt><span class="sect2"><a href="#datetime-method-withmin">12.3.12. WithMax</a></span></dt><dt><span class="sect2"><a href="#datetime-method-withmax">12.3.13. WithMin</a></span></dt><dt><span class="sect2"><a href="#datetime-method-withtime">12.3.14. WithTime</a></span></dt><dt><span class="sect2"><a href="#datetime-method-tocal">12.3.15. ToCalendar</a></span></dt><dt><span class="sect2"><a href="#datetime-method-todate">12.3.16. ToDate</a></span></dt><dt><span class="sect2"><a href="#datetime-method-tomsec">12.3.17. ToMillisec</a></span></dt></dl></dd><dt><span class="sect1"><a href="#datetime-method-intervalref">12.4. Interval Algebra Reference</a></span></dt><dd><dl><dt><span class="sect2"><a href="#datetime-method-examples">12.4.1. Examples</a></span></dt><dt><span class="sect2"><a href="#datetime-method-parameters">12.4.2. Interval Algebra Parameters</a></span></dt><dt><span class="sect2"><a href="#datetime-method-performance">12.4.3. Performance</a></span></dt><dt><span class="sect2"><a href="#datetime-method-limitations">12.4.4. Limitations</a></span></dt><dt><span class="sect2"><a href="#datetime-method-after">12.4.5. After</a></span></dt><dt><span class="sect2"><a href="#datetime-method-before">12.4.6. Before</a></span></dt><dt><span class="sect2"><a href="#datetime-method-coincides">12.4.7. Coincides</a></span></dt><dt><span class="sect2"><a href="#datetime-method-during">12.4.8. During</a></span></dt><dt><span class="sect2"><a href="#datetime-method-finishes">12.4.9. Finishes</a></span></dt><dt><span class="sect2"><a href="#datetime-method-finishedby">12.4.10. Finished By</a></span></dt><dt><span class="sect2"><a href="#datetime-method-includes">12.4.11. Includes</a></span></dt><dt><span class="sect2"><a href="#datetime-method-meets">12.4.12. Meets</a></span></dt><dt><span class="sect2"><a href="#datetime-method-metby">12.4.13. Met By</a></span></dt><dt><span class="sect2"><a href="#datetime-method-overlaps">12.4.14. Overlaps</a></span></dt><dt><span class="sect2"><a href="#datetime-method-overlappedby">12.4.15. Overlapped By</a></span></dt><dt><span class="sect2"><a href="#datetime-method-starts">12.4.16. Starts</a></span></dt><dt><span class="sect2"><a href="#datetime-method-startedby">12.4.17. Started By</a></span></dt></dl></dd></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="datetime-intro"/>12.1.Â Overview</h2></div></div></div><a id="d0e31575" class="indexterm"/><p>
			EPL date-time methods work on date-time values to perform common tasks such as comparing times and time periods, adding or subtracting time periods, setting or rounding calendar fields and querying fields.
		</p><p>
			Date-time methods operate on:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
                    Any expression or event property that returns one of the below values:
                </p><div class="orderedlist"><ol><li><p>
							A long-type millisecond or microsecond value.
						</p></li><li><p>
							A <code class="literal">java.util.Calendar</code> object including subclasses.
						</p></li><li><p>
							A <code class="literal">java.util.Date</code> object including subclasses.
						</p></li><li><p>
							A <code class="literal">java.time.LocalDateTime</code> object including subclasses.
						</p></li><li><p>
							A <code class="literal">java.time.ZonedDateTime</code> object including subclasses.
						</p></li></ol></div></li><li><p>
                    Any event for which the event type declares a start timestamp property name and optionally also an end timestamp property name. Date-time methods operate on events by means of the <span class="emphasis"><em>stream-alias</em></span>.<span class="emphasis"><em>method-name</em></span> syntax.
                </p></li></ol></div><p>
			The below table summarizes the built-in date-time methods available:
		</p><div class="table"><a id="datetime_method_table"/><p class="title"><b>TableÂ 12.1.Â Date-Time Methods</b></p><div class="table-contents"><table summary="Date-Time Methods" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Method</th><th>Result</th></tr></thead><tbody><tr><td>after(event or timestamp)</td><td>
							<p>
								Returns true if an event happens after another event, or a timestamp is after another timestamp.
							</p>
							<p>
								<a class="xref" href="#datetime-method-after" title="12.4.5.Â After">SectionÂ 12.4.5, âAfterâ</a>.
							</p>
						</td></tr><tr><td>before(event or timestamp)</td><td>
							<p>
								Returns true if an event happens before another event, or a timestamp is before another timestamp.
							</p>
							<p>
								<a class="xref" href="#datetime-method-before" title="12.4.6.Â Before">SectionÂ 12.4.6, âBeforeâ</a>.
							</p>
						</td></tr><tr><td>between(timestamp, timestamp, boolean, boolean)</td><td>
							<p>
								Returns true if a timestamp is between two timestamps. 
							</p>
							<p>
								<a class="xref" href="#datetime-method-between" title="12.3.1.Â Between">SectionÂ 12.3.1, âBetweenâ</a>.
							</p>
						</td></tr><tr><td>coincides(event or timestamp)</td><td>
							<p>
								Returns true if an event and another event happen at the same time, or two timestamps are the same value.
							</p>
							<p>
								<a class="xref" href="#datetime-method-coincides" title="12.4.7.Â Coincides">SectionÂ 12.4.7, âCoincidesâ</a>.
							</p>
						</td></tr><tr><td>during(event or timestamp)</td><td>
							<p>
								Returns true if an event happens during the occurrence of another event, or when a timestamps falls within the occurrence of an event.
							</p>
							<p>
								<a class="xref" href="#datetime-method-during" title="12.4.8.Â During">SectionÂ 12.4.8, âDuringâ</a>.
							</p>
						</td></tr><tr><td>finishes(event or timestamp)</td><td>
							<p>
								Returns true if an event starts after another event starts and the event ends at the same time as the other event.
							</p>
							<p>
								<a class="xref" href="#datetime-method-finishes" title="12.4.9.Â Finishes">SectionÂ 12.4.9, âFinishesâ</a>.
							</p>
						</td></tr><tr><td>finishedBy(event or timestamp)</td><td>
							<p>
								Returns true if an event starts before another event starts and ends at the same time as the other event.
							</p>
							<p>
								<a class="xref" href="#datetime-method-finishedby" title="12.4.10.Â Finished By">SectionÂ 12.4.10, âFinished Byâ</a>.
							</p>
						</td></tr><tr><td>
							<p>format()</p>
							<p>format(format)</p>
						</td><td>
							<p>
								Formats the date-time returning a string.
							</p>
							<p>
								<a class="xref" href="#datetime-method-format" title="12.3.2.Â Format">SectionÂ 12.3.2, âFormatâ</a>.
							</p>
						</td></tr><tr><td>get(field)</td><td>
							<p>
								Returns the value of the given date-time value field.
							</p>
							<p>
								<a class="xref" href="#datetime-method-get" title="12.3.3.Â Get (By Field)">SectionÂ 12.3.3, âGet (By Field)â</a>.
							</p>
						</td></tr><tr><td><p>getMillisOfSecond()</p>
<p>getSecondOfMinute()</p>
<p>getMinuteOfHour()</p>
<p>getHourOfDay()</p>
<p>getDayOfWeek()</p>
<p>getDayOfMonth()</p>
<p>getDayOfYear()</p>
<p>getWeekyear()</p>
<p>getMonthOfYear()</p>
<p>getYear()</p>
<p>getEra()</p></td><td>
							<p>
								Returns the value of the given date-time value field.
							</p>
							<p>
								<a class="xref" href="#datetime-method-getitem" title="12.3.4.Â Get (By Name)">SectionÂ 12.3.4, âGet (By Name) â</a>.
							</p>
						</td></tr><tr><td>includes(event or timestamp)</td><td>
							<p>
								Returns true if the parameter event happens during the occurrence of the event, or when a timestamps falls within the occurrence of an event.
							</p>
							<p>
								<a class="xref" href="#datetime-method-includes" title="12.4.11.Â Includes">SectionÂ 12.4.11, âIncludesâ</a>.
							</p>
						</td></tr><tr><td>meets(event or timestamp)</td><td>
							<p>
								Returns true if the event's end time is the same as another event's start time.
							</p>
							<p>
								<a class="xref" href="#datetime-method-meets" title="12.4.12.Â Meets">SectionÂ 12.4.12, âMeetsâ</a>.
							</p>
						</td></tr><tr><td>metBy(event or timestamp)</td><td>
							<p>
								Returns true if the event's start time is the same as another event's end time.
							</p>
							<p>
								<a class="xref" href="#datetime-method-metby" title="12.4.13.Â Met By">SectionÂ 12.4.13, âMet Byâ</a>.
							</p>
						</td></tr><tr><td>minus(duration-millis)</td><td>
							<p>
								Returns a date-time with the specified duration in long-type milliseconds taken away.
							</p>
							<p>
								<a class="xref" href="#datetime-method-minus" title="12.3.5.Â Minus">SectionÂ 12.3.5, âMinusâ</a>.
							</p>
						</td></tr><tr><td>minus(time-period)</td><td>
							<p>
								Returns a date-time with the specified duration in time-period syntax taken away.
							</p>
							<p>
								<a class="xref" href="#datetime-method-minus" title="12.3.5.Â Minus">SectionÂ 12.3.5, âMinusâ</a>.
							</p>
						</td></tr><tr><td>overlaps(event or timestamp)</td><td>
							<p>
								Returns true if the event starts before another event starts and finishes after the other event starts, but before the other event finishes (events have an overlapping period of time).
							</p>
							<p>
								<a class="xref" href="#datetime-method-overlaps" title="12.4.14.Â Overlaps">SectionÂ 12.4.14, âOverlapsâ</a>.
							</p>
						</td></tr><tr><td>overlappedBy(event or timestamp)</td><td>
							<p>
								Returns true if the parameter event starts before the input event starts and the parameter event finishes after the input event starts, but before the input event finishes (events have an overlapping period of time).
							</p>
							<p>
								<a class="xref" href="#datetime-method-overlappedby" title="12.4.15.Â Overlapped By">SectionÂ 12.4.15, âOverlapped Byâ</a>.
							</p>
						</td></tr><tr><td>plus(duration-millis)</td><td>
							<p>
								Returns a date-time with the specified duration in long-type milliseconds added.
							</p>
							<p>
								<a class="xref" href="#datetime-method-plus" title="12.3.6.Â Plus">SectionÂ 12.3.6, âPlusâ</a>.
							</p>
						</td></tr><tr><td>plus(time-period)</td><td>
							<p>
								Returns a date-time with the specified duration in time-period syntax added.
							</p>
							<p>
								<a class="xref" href="#datetime-method-plus" title="12.3.6.Â Plus">SectionÂ 12.3.6, âPlusâ</a>.
							</p>
						</td></tr><tr><td>roundCeiling(field)</td><td>
							<p>
								Returns a date-time rounded to the highest whole unit of the date-time field.
							</p>
							<p>
								<a class="xref" href="#datetime-method-roundceiling" title="12.3.7.Â RoundCeiling">SectionÂ 12.3.7, âRoundCeilingâ</a>.
							</p>
						</td></tr><tr><td>roundFloor(field)</td><td>
							<p>
								Returns a date-time rounded to the lowest whole unit of the date-time field.
							</p>
							<p>
								<a class="xref" href="#datetime-method-roundfloor" title="12.3.8.Â RoundFloor">SectionÂ 12.3.8, âRoundFloorâ</a>.
							</p>
						</td></tr><tr><td>roundHalf(field)</td><td>
							<p>
								Returns a date-time rounded to the nearest whole unit of the date-time field.
							</p>
							<p>
								<a class="xref" href="#datetime-method-roundhalf" title="12.3.9.Â RoundHalf">SectionÂ 12.3.9, âRoundHalfâ</a>.
							</p>
						</td></tr><tr><td>set(field, value)</td><td>
							<p>
								Returns a date-time with the specified field set to the value returned by a value expression.
							</p>
							<p>
								<a class="xref" href="#datetime-method-set" title="12.3.10.Â Set (By Field)">SectionÂ 12.3.10, âSet (By Field)â</a>.
							</p>
						</td></tr><tr><td>starts(event or timestamp)</td><td>
							<p>
								Returns true if an event and another event start at the same time and the event's end happens before the other event's end.
							</p>
							<p>
								<a class="xref" href="#datetime-method-starts" title="12.4.16.Â Starts">SectionÂ 12.4.16, âStartsâ</a>.
							</p>
						</td></tr><tr><td>startedBy(event or timestamp)</td><td>
							<p>
									Returns true if an event and another event start at the same time and the other event's end happens before the input event's end.
							</p>
							<p>
								<a class="xref" href="#datetime-method-startedby" title="12.4.17.Â Started By">SectionÂ 12.4.17, âStarted Byâ</a>.
							</p>
						</td></tr><tr><td>withDate(year,month,day)</td><td>
							<p>
								Returns a date-time with the specified date, retaining the time fields.
							</p>
							<p>
								<a class="xref" href="#datetime-method-withdate" title="12.3.11.Â WithDate">SectionÂ 12.3.11, âWithDateâ</a>.
							</p>
						</td></tr><tr><td>withMax(field)</td><td>
							<p>
								Returns a date-time with the field set to the maximum value for the field.
							</p>
							<p>
								<a class="xref" href="#datetime-method-withmin" title="12.3.12.Â WithMax">SectionÂ 12.3.12, âWithMaxâ</a>.
							</p>
						</td></tr><tr><td>withMin(field)</td><td>
							<p>
								Returns a date-time with the field set to the minimum value for the field.
							</p>
							<p>
								<a class="xref" href="#datetime-method-withmax" title="12.3.13.Â WithMin">SectionÂ 12.3.13, âWithMinâ</a>.
							</p>
						</td></tr><tr><td>withTime(hour,minute,sec,msec)</td><td>
							<p>
								Returns a date-time with the specified time, retaining the date fields.
							</p>
							<p>
								<a class="xref" href="#datetime-method-withtime" title="12.3.14.Â WithTime">SectionÂ 12.3.14, âWithTimeâ</a>.
							</p>
						</td></tr><tr><td>toCalendar()</td><td>
							<p>
								Returns the <code class="literal">Calendar</code> object for this date-time value.
							</p>
							<p>
								<a class="xref" href="#datetime-method-tocal" title="12.3.15.Â ToCalendar">SectionÂ 12.3.15, âToCalendarâ</a>.
							</p>
						</td></tr><tr><td>toDate()</td><td>
							<p>
								Returns the <code class="literal">Date</code> object for this date-time value.
							</p>
							<p>
								<a class="xref" href="#datetime-method-todate" title="12.3.16.Â ToDate">SectionÂ 12.3.16, âToDateâ</a>.
							</p>
						</td></tr><tr><td>toMillisec()</td><td>
							<p>
								Returns the long-type milliseconds value for this date-time value.
							</p>
							<p>
								<a class="xref" href="#datetime-method-tomsec" title="12.3.17.Â ToMillisec">SectionÂ 12.3.17, âToMillisecâ</a>.
							</p>
						</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="datetime-howtouse"/>12.2.Â How to Use</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-howtouse-synopsis"/>12.2.1.Â Syntax</h3></div></div></div><p>
				The syntax for date-time methods is the same syntax as for any chained invocation:
			</p><pre class="synopsis"><span class="emphasis"><em>input_val</em></span>.<span class="emphasis"><em>datetime_method_name</em></span>( [<span class="emphasis"><em>method_parameter</em></span> [, <span class="emphasis"><em>method_parameter</em></span> [,...]]])
	  .[ <span class="emphasis"><em>datetime_method_name</em></span>(...) [...]] </pre><p>
				Following the <span class="emphasis"><em>input_val</em></span> input value is the <code class="literal">.</code> (dot) operator and the <span class="emphasis"><em>datetime_method_name</em></span> date-time method name. It follows in parenthesis a comma-separated list of method parameter expressions. Additional date-time methods can be chained thereafter.
			</p><p>
				The input value can be any expression or event property that returns a value of type long or <code class="literal">java.util.Calendar</code> or <code class="literal">java.util.Date</code> or <code class="literal">java.time.LocalDateTime</code> or <code class="literal">java.time.ZonedDateTime</code>. If the input value is null, the expression result is also null.
			</p><p>
				The input value can also be an event. In this case the event type of the event must have the start timestamp property name defined and optionally also the end timestamp property name. 
			</p><p>
				The following example EPL statement employs the <code class="literal">withTime</code> date-time method. This example returns the current engine time with the time-part set to 1 am:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select current_timestamp.withTime(1, 0, 0, 0) as time1am from MyEvent</pre><p>
				As date-time methods can be chained, this EPL is equivalent:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select current_timestamp.set('hour', 1).set('min', 0).set('sec', 0).set('msec', 0) as time1am
from MyEvent</pre><p>
				The statement above outputs in field <code class="literal">time1am</code> a long-type value (milliseconds or microseconds) reflecting 1am on the same date as engine time. Since the input value is provided by the built-in <code class="literal">current_timestamp</code> function which returns current engine date as a long-type value the output is also a long-type value.
			</p><p>
				You may apply a date-time method to an event property.
			</p><p>
				Assume that the <code class="literal">RFIDEvent</code> event type has a <code class="literal">Date</code>-type property by name <code class="literal">timeTaken</code>. The following query rounds each time-taken value down to the nearest minute and outputs a <code class="literal">Date</code>-type value in column <code class="literal">timeTakenRounded</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.roundFloor('min') as timeTakenRounded from RFIDEvent</pre><p>
				You may apply a date-time method to events. This example assumes that the RFIDEvent and WifiEvent event types both have a timestamp property defined. The EPL compares the timestamps of the RFIDEvent and the WifiEvent: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select rfid.after(wifi) as isAfter 
from RFIDEvent#lastevent rfid, WifiEvent#lastevent wifi</pre><p>
			   For comparing date-time values and considering event duration (event start and end timestamps) we recommend any of the interval algebra methods. You may also compare long-type values using the <code class="literal">between</code> or <code class="literal">in</code> ranges and inverted ranges or relational operators (<code class="literal">&gt; , &lt;, &gt;=, &lt;=)</code>.
			</p><p>
				From a performance perspective, the date-time method evaluation ensures that for each unique chain of date-time methods only a single calendar objects is copied or created when necessary.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="datetime-method-calref"/>12.3.Â Calendar and Formatting Reference</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-between"/>12.3.1.Â Between</h3></div></div></div><p>
				The <code class="literal">between</code> date-time method compares the input date-time value to the two date-time values passed in and returns true if the input value falls between the two parameter values.
			</p><p>
				The synopsis is:
			</p><pre class="synopsis"><span class="emphasis"><em>input_val</em></span>.<span class="emphasis"><em>between</em></span>(<span class="emphasis"><em>range_start</em></span>, <span class="emphasis"><em>range_end</em></span> [, <span class="emphasis"><em>include_start</em></span>, <span class="emphasis"><em>include_end</em></span>])</pre><p>
				The method takes either 2 or 4 parameters. The first two parameters <span class="emphasis"><em>range_start</em></span> and <span class="emphasis"><em>range_end</em></span> are expressions or properties that yield either a long-typed, Date-typed or Calendar-typed range start and end value.
			</p><p>
				The next two parameters <span class="emphasis"><em>include_start</em></span> and <span class="emphasis"><em>include_end</em></span> are optional. If not specified, the range start value and range end value are included in the range i.e. specify a closed range where both endpoints are included. If specified, the expressions must return a boolean-value indicating whether to include the range start value and range end value in the range. 
			</p><p>
				The example below outputs true when the time-taken property value of the RFID event falls between the time-start property value and the time-end property value (closed range includes endpoints):
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.between(timeStart, timeEnd) from RFIDEvent</pre><p>
				The example below performs the same test as above but does not include endpoints (open range includes neither endpoint):
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.between(timeStart, timeEnd, false, false) from RFIDEvent</pre><p>
				If the range end value is less then the range start value, the algorithm reverses the range start and end value.
			</p><p>
				If the input date-time value or any of the parameter values evaluate to null the method returns a null result value.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-format"/>12.3.2.Â Format</h3></div></div></div><p>
				The <code class="literal">format</code> date-time method formats the date-time returning a string. 
			</p><p>
				The method takes either no parameter or a single format parameter.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="datetime-method-format-default"/>12.3.2.1.Â Format with Default Formatter</h4></div></div></div><p>
					When passing no parameter, the method returns the date-time value formatted using the default formatter as follows:
				</p><div class="table"><a id="datetime-method-format-table"/><p class="title"><b>TableÂ 12.2.Â RoundHalf Examples</b></p><div class="table-contents"><table summary="RoundHalf Examples" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Input</th><th>String Formatter</th></tr></thead><tbody><tr><td><code class="literal">long, Date, Calendar</code></td><td><code class="literal">new SimpleDateFormat()</code></td></tr><tr><td><code class="literal">java.time.LocalTimeDate</code></td><td><code class="literal">DateTimeFormatter.ISO_DATE_TIME</code></td></tr><tr><td><code class="literal">java.time.ZonedTimeDate</code></td><td><code class="literal">DateTimeFormatter.ISO_ZONED_DATE_TIME</code></td></tr></tbody></table></div></div><br class="table-break"/><p>
					The example below outputs the time-taken property value of the RFID event:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.format() as timeTakenStr from RFIDEvent</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="datetime-method-format-provided"/>12.3.2.2.Â Providing a Format</h4></div></div></div><p>
					For input values that are <code class="literal">long</code>-typed, <code class="literal">Date</code>-typed or <code class="literal">Calendar</code>-typed you must provide an expression that returns either:
				</p><div class="itemizedlist"><ul><li><p>
							A <code class="literal">String</code>-type format that adheres to <code class="literal">SimpleDateFormat</code> rules.
						</p></li><li><p>
							A <code class="literal">DateFormat</code> instance.
						</p></li></ul></div><p>
					For input values that are <code class="literal">LocalDateTime</code>-typed or <code class="literal">ZonedDateTime</code>-typed you must provide an expression that returns either:
				</p><div class="itemizedlist"><ul><li><p>
							A <code class="literal">String</code>-type format that adheres to <code class="literal">DateTimeFormatter</code> rules.
						</p></li><li><p>
						A <code class="literal">DateTimeFormatter</code> instance.
					</p></li></ul></div><p>
					The engine evaluates the format expression at statement compilation time therefore the format expression must return a value that is not computed from time or events.
				</p><p>
					For example:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.format('yyyy.MM.dd G 'at' HH:mm:ss') from RFIDEvent</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.format(SimpleDateFormat.getDateInstance()) from RFIDEvent</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select localDateTime.format(java.time.format.DateTimeFormatter.BASIC_ISO_DATE) from RFIDEvent</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-get"/>12.3.3.Â Get (By Field)</h3></div></div></div><p>
				The <code class="literal">get</code> date-time method returns the value of the given date-time value field.
			</p><p>
				The method takes a single string-constant field name as parameter. Please see <a class="xref" href="#epl-syntax-time-periods" title="5.2.1.Â Specifying Time Periods">SectionÂ 5.2.1, âSpecifying Time Periodsâ</a> for a list of recognized keywords (not case-sensitive).
			</p><p>
				The method returns the numeric value of the field within the date-time value. The value returned adheres to <code class="literal">Calendar</code>-class semantics: For example, the value for <code class="literal">month</code> starts at zero and has a maximum of 11 (Note: for <code class="literal">LocalDateTime</code> and <code class="literal">ZonedDateTime</code> the range for month is 1 to 12).
			</p><p>
				The example below outputs the month value of the time-taken property value of the RFID event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.get('month') as timeTakenMonth from RFIDEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-getitem"/>12.3.4.Â Get (By Name) </h3></div></div></div><p>
				The following list of getter-methods are available:  <code class="literal">getMillisOfSecond()</code>, <code class="literal">getSecondOfMinute()</code>, <code class="literal">getMinuteOfHour()</code>, <code class="literal">getHourOfDay()</code>, <code class="literal">getDayOfWeek()</code>, <code class="literal">getDayOfMonth()</code>, <code class="literal">getDayOfYear()</code>, <code class="literal">getWeekYear()</code>, <code class="literal">getMonthOfYear()</code>, <code class="literal">getYear()</code> and <code class="literal">getEra()</code>.
			</p><p>
				All get-methods take no parameter and return the numeric value of the field within the date-time value. The value returned adheres to <code class="literal">Calendar</code>-class semantics: For example, the value for <code class="literal">month</code> starts at zero and has a maximum of 11 (Note: for <code class="literal">LocalDateTime</code> and <code class="literal">ZonedDateTime</code> the range for month is 1 to 12).
			</p><p>
				The example below outputs the month value of the time-taken property value of the RFID event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.getMonthOfYear() as timeTakenMonth from RFIDEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-minus"/>12.3.5.Â Minus</h3></div></div></div><p>
				The <code class="literal">minus</code> date-time method returns a date-time with the specified duration taken away.
			</p><p>
				The method has two versions: The first version takes the duration as a long-type millisecond value. The second version takes the duration as a time-period expression, see <a class="xref" href="#epl-syntax-time-periods" title="5.2.1.Â Specifying Time Periods">SectionÂ 5.2.1, âSpecifying Time Periodsâ</a>.
			</p><p>
				The example below  demonstrates the time-period parameter to subtract two minutes from the time-taken property value of the RFID event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.minus(2 minutes) as timeTakenMinus2Min from RFIDEvent</pre><p>
				The next example is equivalent but passes a millisecond-value instead:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.minus(2*60*1000) as timeTakenMinus2Min from RFIDEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-plus"/>12.3.6.Â Plus</h3></div></div></div><p>
				The <code class="literal">plus</code> date-time method returns a date-time with the specified duration added.
			</p><p>
				The method has two versions: The first version takes the duration as a long-type millisecond value. The second version takes the duration as a time-period expression, see <a class="xref" href="#epl-syntax-time-periods" title="5.2.1.Â Specifying Time Periods">SectionÂ 5.2.1, âSpecifying Time Periodsâ</a>.
			</p><p>
				The next example adds two minutes to the time-taken property value of the RFID event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.plus(2 minutes) as timeTakenPlus2Min from RFIDEvent</pre><p>
				The next example is equivalent but passes a millisecond-value instead:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.plus(2*60*1000) as timeTakenPlus2Min from RFIDEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-roundceiling"/>12.3.7.Â RoundCeiling</h3></div></div></div><p>
				The <code class="literal">roundCeiling</code> date-time method rounds to the highest whole unit of the date-time field.
			</p><p>
				The method takes a single string-constant field name as parameter. Please see <a class="xref" href="#epl-syntax-time-periods" title="5.2.1.Â Specifying Time Periods">SectionÂ 5.2.1, âSpecifying Time Periodsâ</a> for a list of recognized keywords (not case-sensitive).
			</p><p>
				The next example rounds-to-ceiling the minutes of the time-taken property value of the RFID event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.roundCeiling('min') as timeTakenRounded from RFIDEvent</pre><p>
				If the input time is <code class="literal">2002-05-30 09:01:23.050</code>, for example, the output is <code class="literal">2002-05-30 09:02:00.000</code> (example timestamps are in format <code class="literal">yyyy-MM-dd HH:mm:ss.SSS</code>).
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-roundfloor"/>12.3.8.Â RoundFloor</h3></div></div></div><p>
				The <code class="literal">roundFloor</code> date-time method rounds to the lowest whole unit of the date-time field.
			</p><p>
				The method takes a single string-constant field name as parameter. Please see <a class="xref" href="#epl-syntax-time-periods" title="5.2.1.Â Specifying Time Periods">SectionÂ 5.2.1, âSpecifying Time Periodsâ</a> for a list of recognized keywords (not case-sensitive).
			</p><p>
				The next example rounds-to-floor the minutes of the time-taken property value of the RFID event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.roundFloor('min') as timeTakenRounded from RFIDEvent</pre><p>
				If the input time is <code class="literal">2002-05-30 09:01:23.050</code>, for example, the output is <code class="literal">2002-05-30 09:01:00.000</code> (example timestamps are in format <code class="literal">yyyy-MM-dd HH:mm:ss.SSS</code>).
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-roundhalf"/>12.3.9.Â RoundHalf</h3></div></div></div><p>
				The <code class="literal">roundFloor</code> date-time method rounds to the nearest whole unit of the date-time field.
			</p><p>
				The method takes a single string-constant field name as parameter. Please see <a class="xref" href="#epl-syntax-time-periods" title="5.2.1.Â Specifying Time Periods">SectionÂ 5.2.1, âSpecifying Time Periodsâ</a> for a list of recognized keywords (not case-sensitive).
			</p><p>
				The next example rounds the minutes of the time-taken property value of the RFID event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.roundHalf('min') as timeTakenRounded from RFIDEvent</pre><p>
				The following table provides a few examples of the rounding (example timestamps are in format <code class="literal">yyyy-MM-dd HH:mm:ss.SSS</code>):
			</p><div class="table"><a id="datetime_roundhalf"/><p class="title"><b>TableÂ 12.3.Â RoundHalf Examples</b></p><div class="table-contents"><table summary="RoundHalf Examples" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Input</th><th>Output</th></tr></thead><tbody><tr><td>2002-05-30 09:01:23.050</td><td>2002-05-30 09:01:00.000</td></tr><tr><td>2002-05-30 09:01:29.999</td><td>2002-05-30 09:01:00.000</td></tr><tr><td>2002-05-30 09:01:30.000</td><td>2002-05-30 09:02:00.000</td></tr></tbody></table></div></div><br class="table-break"/><p>
				This method is not support for <code class="literal">LocalDateTime</code> and <code class="literal">ZonedDateTime</code> input values.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-set"/>12.3.10.Â Set (By Field)</h3></div></div></div><p>
				The <code class="literal">set</code> date-time method returns a date-time with the specified field set to the value returned by an expression.
			</p><p>
				The method takes a string-constant field name and an expression returning an integer-value as parameters. Please see <a class="xref" href="#epl-syntax-time-periods" title="5.2.1.Â Specifying Time Periods">SectionÂ 5.2.1, âSpecifying Time Periodsâ</a> for a list of recognized keywords (not case-sensitive).
			</p><p>
				The method returns the new date-time value with the field set to the provided value. Note that value adheres to <code class="literal">Calendar</code>-class semantics: For example, the value for <code class="literal">month</code> starts at zero and has a maximum of 11 (Note: for <code class="literal">LocalDateTime</code> and <code class="literal">ZonedDateTime</code> the range for month is 1 to 12).
			</p><p>
				The example below outputs the time-taken with the value for month set to April:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.set('month', 3) as timeTakenMonth from RFIDEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-withdate"/>12.3.11.Â WithDate</h3></div></div></div><p>
				The <code class="literal">withDate</code> date-time method returns a date-time with the specified date, retaining the time fields.
			</p><p>
				The method takes three expressions as parameters: An expression for year, month and day.
			</p><p>
				The method returns the new date-time value with the date fields set to the provided values. For expressions returning null the method ignores the field for which null is returned. Note the <code class="literal">Calendar</code>-class semantics: For example, the value for <code class="literal">month</code> starts at zero and has a maximum of 11.
			</p><p>
				The example below outputs the time-taken with the date set to May 30, 2002:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.withDate(2002, 4, 30) as timeTakenDated from RFIDEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-withmin"/>12.3.12.Â WithMax</h3></div></div></div><p>
				The <code class="literal">withMax</code> date-time method returns a date-time with the field set to the maximum value for the field.
			</p><p>
				The method takes a string-constant field name as parameter. Please see <a class="xref" href="#epl-syntax-time-periods" title="5.2.1.Â Specifying Time Periods">SectionÂ 5.2.1, âSpecifying Time Periodsâ</a> for a list of recognized keywords (not case-sensitive).
			</p><p>
				The method returns the new date-time value with the specific date field set to the maximum value.
			</p><p>
				The example below outputs the time-taken property value with the second-part as 59 seconds:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.withMax('sec') as timeTakenMaxSec from RFIDEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-withmax"/>12.3.13.Â WithMin</h3></div></div></div><p>
				The <code class="literal">withMin</code> date-time method returns a date-time with the field set to the minimum value for the field.
			</p><p>
				The method takes a string-constant field name as parameter. Please see <a class="xref" href="#epl-syntax-time-periods" title="5.2.1.Â Specifying Time Periods">SectionÂ 5.2.1, âSpecifying Time Periodsâ</a> for a list of recognized keywords (not case-sensitive).
			</p><p>
				The method returns the new date-time value with the specific date field set to the minimum value.
			</p><p>
				The example below outputs the time-taken property value with the second-part as 0 seconds:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.withMin('sec') as timeTakenMaxSec from RFIDEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-withtime"/>12.3.14.Â WithTime</h3></div></div></div><p>
				The <code class="literal">withTime</code> date-time method returns a date-time with the specified time, retaining the date fields.
			</p><p>
				The method takes four expressions as parameters: An expression for hour, minute, second and millisecond.
			</p><p>
				The method returns the new date-time value with the time fields set to the provided values. For expressions returning null the method ignores the field for which null is returned.
			</p><p>
				The example below outputs the time-taken with the time set to 9am:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.withTime(9, 0, 0, 0) as timeTakenDated from RFIDEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-tocal"/>12.3.15.Â ToCalendar</h3></div></div></div><p>
				The <code class="literal">toCalendar</code> date-time method returns the <code class="literal">Calendar</code> object for this date-time value.
			</p><p>
				The method takes no parameters.
			</p><p>
				The example below outputs the time-taken as a <code class="literal">Calendar</code> object:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.toCalendar() as timeTakenCal from RFIDEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-todate"/>12.3.16.Â ToDate</h3></div></div></div><p>
				The <code class="literal">toDate</code> date-time method returns the <code class="literal">Date</code> object for this date-time value.
			</p><p>
				The method takes no parameters.
			</p><p>
				The example below outputs the time-taken as a <code class="literal">Date</code> object:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.toDate() as timeTakenDate from RFIDEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-tomsec"/>12.3.17.Â ToMillisec</h3></div></div></div><p>
				The <code class="literal">toMillisec</code> date-time method returns the long-typed millisecond value for this date-time value.
			</p><p>
				The method takes no parameters.
			</p><p>
				The example below outputs the time-taken as a long-typed <code class="literal">millisecond</code> value:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select timeTaken.toMillisec() as timeTakenLong from RFIDEvent</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="datetime-method-intervalref"/>12.4.Â Interval Algebra Reference</h2></div></div></div><p>
			Interval algebra methods compare start and end timestamps of events or timestamps in general.
		</p><p>
		  When the expression input is only a timestamp value, such as a long-type value or a <code class="literal">Date</code> or <code class="literal">Calendar</code> object, the start and end timestamp represented by that value are the same timestamp value.
		</p><p>
		  When expression input is an event stream alias, the engine determine the event type for the stream. If the event type declares a start timestamp property name, the engine uses that start timestamp property to determine the start timestamp for the event. If the event type also declares an end timestamp property name, the engine uses that end timestamp property to determine the end timestamp for the event (i.e. an event with duration). If an end timestamp property name is not declared, the start and end timestamp for each event is the same value and the event is considered to have zero duration (i.e. a point-in-time event).
		</p><p>
			Interval algebra methods all return <code class="literal">Boolean</code>-type value. When the input value start timestamp is null, or the end timestamp (if declared for the event type) is null or any of the start timestamp and end timestamp (if declared for the event type) values of the first parameter is null, the result value is null.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-examples"/>12.4.1.Â Examples</h3></div></div></div><p>
			  The examples in this section simply use <code class="literal">A</code> and <code class="literal">B</code> as event type names. The alias <code class="literal">a</code> is used to represent <code class="literal">A</code>-type events and respectively the alias <code class="literal">b</code> represents <code class="literal">B</code>-type events.
		   </p><p>
		     The <code class="literal">create-schema</code> for types <code class="literal">A</code> and <code class="literal">B</code> is shown next. The two types are declared the same. The example declares the property providing start timestamp values as <code class="literal">startts</code> and the property providing end timestamp values as <code class="literal">endts</code>:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema A as (startts long, endts long) starttimestamp 'startts' endtimestamp 'endts'</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema B as (startts long, endts long) starttimestamp 'startts' endtimestamp 'endts'</pre><p>
		     The sample EPL below joins the last A and the last B event. It detects A-B event combinations for which, when comparing timestamps, the last A event that occurs before the last B event. The example employs the <code class="literal">before</code> method:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.before(b)</pre><p>
			  For simplicity, the examples in this section refer to <code class="literal">A</code> and the alias <code class="literal">a</code> as the input event. The examples refer to <code class="literal">B</code> and the alias <code class="literal">b</code> as the parameter event.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-parameters"/>12.4.2.Â Interval Algebra Parameters</h3></div></div></div><p>
			  The first parameter of each interval algebra methods is the event or timestamp to compare to.
		   </p><p>
		     All remaining parameters to interval algebra methods are intervals and can be any of the following:
		   </p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						A constant, an event property or more generally any expression returning a numeric value that is the number of seconds. For example, in the expression <code class="literal">a.before(b, 2)</code> the parameter 2 is interpreted to mean 2 seconds. The expression <code class="literal">a.before(b, myIntervalProperty)</code> is interpreted to mean <code class="literal">myIntervalProperty</code> seconds.
					</p></li><li><p>
						A time period expression as described in <a class="xref" href="#datetime-method-includes" title="12.4.11.Â Includes">SectionÂ 12.4.11, âIncludesâ</a>. For example: <code class="literal">a.before(b, 1 hour 2 minutes)</code>.
					</p></li></ol></div><p>
				When an interval parameter is provided and is null, the method result value is null.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-performance"/>12.4.3.Â Performance</h3></div></div></div><p>
			  The engine analyzes interval algebra methods as well as the <code class="literal">between</code> date-time method in the where-clause and builds a query plan for execution of joins and subqueries. The query plan can include hash and btree index lookups using the start and end timestamps as computed by expressions or provided by events as applicable. Consider turning on query plan logging to obtain information on the query plan used.
		   </p><p>
		     The query planning is generally most effective when no additional thresholds or ranges are provided to interval algebra methods, as the query planner may not consider an interval algebra method that it cannot plan.
		   </p><p>
		     The query planner may also not optimally plan the query execution if events or expressions return different types of date representation. Query planning works best if all date representations use the same long, Date or Calendar types.
		   </p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-limitations"/>12.4.4.Â Limitations</h3></div></div></div><p>
			  Date-time method that change date or time fields, such as <code class="literal">withTime</code>, <code class="literal">withDate</code>, <code class="literal">set</code> or <code class="literal">round</code> methods set the end timestamp to the start timestamp.
		   </p><p>
		      For example, in the following expression the parameter to the <code class="literal">after</code> method has a zero duration, and not the end timestamp that the event B <code class="literal">endts</code> property provides.
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">a.after(b.withTime(9, 0, 0, 0))</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-after"/>12.4.5.Â After</h3></div></div></div><p>
				The <code class="literal">after</code> date-time method returns true if an event happens after another event, or a timestamp is after another timestamp.
			</p><p>
				The method compares the input value's start timestamp (a.startTimestamp) to the first parameter's end timestamp (b.endTimestamp) to determine whether A happens after B.
			</p><p>
				If used with one parameter, for example in <code class="literal">a.after(b)</code>, the method returns true if A starts after B ends.
			</p><p>
				Sample EPL: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.after(b)
// Above matches when:
//   a.startTimestamp - b.endTimestamp &gt; 0</pre><p>
				If providing two parameters, for example in <code class="literal">a.after(b, 5 sec)</code>, the method returns true if A starts at least 5 seconds after B ends.
			</p><p>
				Sample EPL: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.after(b, 5 sec)
// Above matches when:
//   a.startTimestamp - b.endTimestamp &gt;= 5 seconds</pre><p>
				If providing three parameters, for example in <code class="literal">a.after(b, 5 sec, 10 sec)</code>, the method returns true if A starts at least 5 seconds but no more then 10 seconds after B ends.
			</p><p>
				Sample EPL: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.after(b, 5 sec, 10 sec)
// Above matches when:
//   5 seconds &lt;= a.startTimestamp - b.endTimestamp &lt;= 10 seconds</pre><p>
			    Negative values for the range are allowed. For example in <code class="literal">a.after(b, -5 sec, -10 sec)</code>, the method returns true if A starts at least 5 seconds but no more then 10 seconds before B ends.
			</p><p>
				If the range low endpoint is greater than the range high endpoint, the engine automatically reverses them. Thus <code class="literal">a.after(b, 10 sec, 5 sec)</code> is the same semantics as <code class="literal">a.after(b, 5 sec, 10 sec)</code>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-before"/>12.4.6.Â Before</h3></div></div></div><p>
				 The <code class="literal">before</code> date-time method returns true if an event happens before another event, or a timestamp is before another timestamp.
			 </p><p>
				The method compares the input value's end timestamp (a.endTimestamp) and the first parameter's start timestamp (b.startTimestamp) to determine whether A happens before B.
			</p><p>
				If used with one parameter, for example in <code class="literal">a.before(b)</code>, the method returns true if A ends before B starts. 
			</p><p>
				Sample EPL: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.before(b)
// Above matches when:
//   b.startTimestamp - a.endTimestamp &gt; 0</pre><p>
				If providing two parameters, for example in <code class="literal">a.before(b, 5 sec)</code>, the method returns true if A ends at least 5 seconds before B starts.
			</p><p>
				Sample EPL: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.before(b, 5 sec)
// Above matches when:
//   b.startTimestamp - a.endTimestamp &gt;= 5 seconds</pre><p>
				If providing three parameters, for example in <code class="literal">a.before(b, 5 sec, 10 sec)</code>, the method returns true if A ends at least 5 seconds but no more then 10 seconds before B starts.
			</p><p>
				Sample EPL: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.before(b, 5 sec, 10 sec)
// Above matches when:
//   5 seconds &lt;= b.startTimestamp - a.endTimestamp &lt;= 10 seconds</pre><p>
			    Negative values for the range are allowed. For example in <code class="literal">a.before(b, -5 sec, -10 sec)</code>, the method returns true if A starts at least 5 seconds but no more then 10 seconds after B starts.
			</p><p>
				If the range low endpoint is greater than the range high endpoint, the engine automatically reverses them. Thus <code class="literal">a.before(b, 10 sec, 5 sec)</code> is the same semantics as <code class="literal">a.before(b, 5 sec, 10 sec)</code>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-coincides"/>12.4.7.Â Coincides</h3></div></div></div><p>
				The <code class="literal">coincides</code> date-time method returns true if an event and another event happen at the same time, or two timestamps are the same value.
			</p><p>
				The method compares the input value's start and end timestamp with the first parameter's start and end timestamp and determines if they equal.
			</p><p>
				If used with one parameter, for example in <code class="literal">a.coincides(b)</code>, the method returns true if the start timestamp of A and B are the same and the end timestamps of A and B are also the same.
			</p><p>
				Sample EPL: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.coincides(b)
// Above matches when:
//   a.startTimestamp = b.startTimestamp and a.endTimestamp = b.endTimestamp</pre><p>
				If providing two parameters, for example in <code class="literal">a.coincides(b, 5 sec)</code>, the method returns true if the difference between the start timestamps of A and B is equal to or less then 5 seconds and the difference between the end timestamps of A and B is also equal to or less then 5 seconds.
			</p><p>
				Sample EPL: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.coincides(b, 5 sec)
// Above matches when:
//   abs(a.startTimestamp - b.startTimestamp) &lt;= 5 sec and 
//   abs(a.endTimestamp - b.endTimestamp) &lt;= 5 sec</pre><p>
				If providing three parameters, for example in <code class="literal">a.coincides(b, 5 sec, 10 sec)</code>, the method returns true if the difference between the start timestamps of A and B is equal to or less then 5 seconds and the difference between the end timestamps of A and B is equal to or less then 10 seconds. 
			</p><p>
				Sample EPL: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.coincides(b, 5 sec, 10 sec)
// Above matches when:
//   abs(a.startTimestamp - b.startTimestamp) &lt;= 5 seconds and 
//   abs(a.endTimestamp - b.endTimestamp) &lt;= 10 seconds</pre><p>
			  A negative value for interval parameters is not allowed. If your interval parameter is itself an expression that returns a negative value the engine logs a warning message and returns null.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-during"/>12.4.8.Â During</h3></div></div></div><p>
				The <code class="literal">during</code> date-time method returns true if an event happens during the occurrence of another event, or when a timestamps falls within the occurrence of an event..
			</p><p>
				The method determines whether the input value's start and end timestamp are during the first parameter's start and end timestamp. The symmetrical opposite is <a class="xref" href="#datetime-method-includes" title="12.4.11.Â Includes">SectionÂ 12.4.11, âIncludesâ</a>.
			</p><p>
				If used with one parameter, for example in <code class="literal">a.during(b)</code>, the method returns true if the start timestamp of A is after the start timestamp of B and the end timestamp of A is before the end timestamp of B.
			</p><p>
				Sample EPL: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.during(b)
// Above matches when:
//   b.startTimestamp &lt; a.startTimestamp &lt;= a.endTimestamp &lt; b.endTimestamp</pre><p>
				If providing two parameters, for example in <code class="literal">a.during(b, 5 sec)</code>, the method returns true if the difference between the start timestamps of A and B is equal to or less then 5 seconds and the difference between the end timestamps of A and B is also equal to or less then 5 seconds.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.during(b, 5 sec)
// Above matches when:
//   0 &lt; a.startTimestamp - b.startTimestamp &lt;= 5 sec and 
//   0 &lt; a.endTimestamp - b.endTimestamp &lt;= 5 sec</pre><p>
				If providing three parameters, for example in <code class="literal">a.during(b, 5 sec, 10 sec)</code>, the method returns true if the difference between the start timestamps of A and B and the difference between the end timestamps of A and B is between 5 and 10 seconds.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.during(b, 5 sec, 10 sec)
// Above matches when:
//   5 seconds &lt;= a.startTimestamp - b.startTimestamp &lt;= 10 seconds and 
//   5 seconds &lt;= a.endTimestamp - b.endTimestamp &lt;= 10 seconds</pre><p>
				If providing five parameters, for example in <code class="literal">a.during(b, 5 sec, 10 sec, 20 sec, 30 sec)</code>, the method returns true if the difference between the start timestamps of A and B is between 5 seconds and 10 seconds and the difference between the end timestamps of A and B is between 20 seconds and 30 seconds.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b
  where a.during(b, 5 sec, 10 sec, 20 sec, 30 sec)
// Above matches when:
//   5 seconds &lt;= a.startTimestamp - b.startTimestamp &lt;= 10 seconds and 
//   20 seconds &lt; a.endTimestamp - b.endTimestamp &lt;= 30 seconds</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-finishes"/>12.4.9.Â Finishes</h3></div></div></div><p>
				The <code class="literal">finishes</code> date-time method returns true if an event starts after another event starts and the event ends at the same time as the other event.
			</p><p>
				The method determines whether the input value's start timestamp is after the first parameter's start timestamp and the end timestamp of the input value and the first parameter are the same. The symmetrical opposite is <a class="xref" href="#datetime-method-finishedby" title="12.4.10.Â Finished By">SectionÂ 12.4.10, âFinished Byâ</a>.
			</p><p>
				If used with one parameter, for example in <code class="literal">a.finishes(b)</code>, the method returns true if the start timestamp of A is after the start timestamp of B and the end timestamp of A and B are the same.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.finishes(b)
// Above matches when:
//   b.startTimestamp &lt; a.startTimestamp and a.endTimestamp = b.endTimestamp</pre><p>
				If providing two parameters, for example in <code class="literal">a.finishes(b, 5 sec)</code>, the method returns true if the start timestamp of A is after the start timestamp of B and the difference between the end timestamps of A and B is equal to or less then 5 seconds.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.finishes(b, 5 sec)
// Above matches when:
//   b.startTimestamp &lt; a.startTimestamp and 
//   abs(a.endTimestamp - b.endTimestamp ) &lt;= 5 seconds</pre><p>
			  A negative value for interval parameters is not allowed. If your interval parameter is itself an expression that returns a negative value the engine logs a warning message and returns null.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-finishedby"/>12.4.10.Â Finished By</h3></div></div></div><p>
				The <code class="literal">finishedBy</code> date-time method returns true if an event starts before another event starts and the event ends at the same time as the other event.
			</p><p>
				The method determines whether the input value's start timestamp happens before the first parameter's start timestamp and the end timestamp of the input value and the first parameter are the same. The symmetrical opposite is <a class="xref" href="#datetime-method-finishes" title="12.4.9.Â Finishes">SectionÂ 12.4.9, âFinishesâ</a>.
			</p><p>
				If used with one parameter, for example in <code class="literal">a.finishedBy(b)</code>, the method returns true if the start timestamp of A is before the start timestamp of B and the end timestamp of A and B are the same.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.finishedBy(b)
// Above matches when:
//   a.startTimestamp &lt; b.startTimestamp and a.endTimestamp = b.endTimestamp</pre><p>
				If providing two parameters, for example in <code class="literal">a.finishedBy(b, 5 sec)</code>, the method returns true if the start timestamp of A is before the start timestamp of B and the difference between the end timestamps of A and B is equal to or less then 5 seconds.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.finishedBy(b, 5 sec)
// Above matches when:
//   a.startTimestamp &lt; b.startTimestamp and 
//   abs(a.endTimestamp - b.endTimestamp ) &lt;= 5 seconds</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-includes"/>12.4.11.Â Includes</h3></div></div></div><p>
				The <code class="literal">includes</code> date-time method returns true if the parameter event happens during the occurrence of the input event, or when a timestamps falls within the occurrence of an event.
			</p><p>
				The method determines whether the first parameter's start and end timestamp are during the input value's start and end timestamp. The symmetrical opposite is <a class="xref" href="#datetime-method-during" title="12.4.8.Â During">SectionÂ 12.4.8, âDuringâ</a>.
			</p><p>
				If used with one parameter, for example in <code class="literal">a.includes(b)</code>, the method returns true if the start timestamp of B is after the start timestamp of A and the end timestamp of B is before the end timestamp of A.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.includes(b)
// Above matches when:
//   a.startTimestamp &lt; b.startTimestamp &lt;= b.endTimestamp &lt; a.endTimestamp </pre><p>
				If providing two parameters, for example in <code class="literal">a.includes(b, 5 sec)</code>, the method returns true if the difference between the start timestamps of A and B is equal to or less then 5 seconds and the difference between the end timestamps of A and B is also equal to or less then 5 seconds.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.includes(b, 5 sec)
// Above matches when:
//   0 &lt; b.startTimestamp - a.startTimestamp &lt;= 5 sec and 
//   0 &lt; a.endTimestamp - b.endTimestamp &lt;= 5 sec</pre><p>
				If providing three parameters, for example in <code class="literal">a.includes(b, 5 sec, 10 sec)</code>, the method returns true if the difference between the start timestamps of A and B and the difference between the end timestamps of A and B is between 5 and 10 seconds.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.includes(b, 5 sec, 10 sec)
// Above matches when:
//   5 seconds &lt;= a.startTimestamp - b.startTimestamp &lt;= 10 seconds and 
//   5 seconds &lt;= a.endTimestamp - b.endTimestamp &lt;= 10 seconds</pre><p>
				If providing five parameters, for example in <code class="literal">a.includes(b, 5 sec, 10 sec, 20 sec, 30 sec)</code>, the method returns true if the difference between the start timestamps of A and B is between 5 seconds and 10 seconds and the difference between the end timestamps of A and B is between 20 seconds and 30 seconds.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b
  where a.includes(b, 5 sec, 10 sec, 20 sec, 30 sec)
// Above matches when:
//   5 seconds &lt;= a.startTimestamp - b.startTimestamp &lt;= 10 seconds and 
//   20 seconds &lt;= a.endTimestamp - b.endTimestamp &lt;= 30 seconds</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-meets"/>12.4.12.Â Meets</h3></div></div></div><p>
				The <code class="literal">meets</code> date-time method returns true if the event's end time is the same as another event's start time.
			</p><p>
				The method compares the input value's end timestamp and the first parameter's start timestamp and determines whether they equal.
			</p><p>
				If used with one parameter, for example in <code class="literal">a.meets(b)</code>, the method returns true if the end timestamp of A is the same as the start timestamp of B.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.meets(b)
// Above matches when:
//   a.endTimestamp = b.startTimestamp</pre><p>
				If providing two parameters, for example in <code class="literal">a.meets(b, 5 sec)</code>, the method returns true if the difference between the end timestamp of A and the start timestamp of B is equal to or less then 5 seconds.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.meets(b, 5 sec)
// Above matches when:
//   abs(b.startTimestamp - a.endTimestamp) &lt;= 5 seconds</pre><p>
			  A negative value for the interval parameter is not allowed. If your interval parameter is itself an expression that returns a negative value the engine logs a warning message and returns null.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-metby"/>12.4.13.Â Met By</h3></div></div></div><p>
				The <code class="literal">metBy</code> date-time method returns true if the event's start time is the same as another event's end time.
			</p><p>
				The method compares the input value's start timestamp and the first parameter's end timestamp and determines whether they equal.
			</p><p>
				If used with one parameter, for example in <code class="literal">a.metBy(b)</code>, the method returns true if the start timestamp of A is the same as the end timestamp of B.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.metBy(b)
// Above matches when:
//   a.startTimestamp = b.endTimestamp</pre><p>
				If providing two parameters, for example in <code class="literal">a.metBy(b, 5 sec)</code>, the method returns true if the difference between the end timestamps of B and the start timestamp of A is equal to or less then 5 seconds.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.metBy(b, 5 sec)
// Above matches when:
//   abs(a.startTimestamp - b.endTimestamp) &lt;= 5 seconds</pre><p>
			  A negative value for the interval parameter is not allowed. If your interval parameter is itself an expression that returns a negative value the engine logs a warning message and returns null.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-overlaps"/>12.4.14.Â Overlaps</h3></div></div></div><p>
				The <code class="literal">overlaps</code> date-time method returns true if the event starts before another event starts and finishes after the other event starts, but before the other event finishes (events have an overlapping period of time).
			</p><p>
				The method determines whether the input value's start and end timestamp indicate an overlap with the first parameter's start and end timestamp, such that A starts before B starts and A ends after B started but before B ends.
			</p><p>
				If used with one parameter, for example in <code class="literal">a.overlaps(b)</code>, the method returns true if the start timestamp of A is before the start timestamp of B and the end timestamp of A and is before the end timestamp of B.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.overlaps(b)
// Above matches when:
//   a.startTimestamp &lt; b.startTimestamp &lt; a.endTimestamp &lt; b.endTimestamp</pre><p>
				If providing two parameters, for example in <code class="literal">a.overlaps(b, 5 sec)</code>, the method returns true if, in addition, the difference between the end timestamp of A and the start timestamp of B is equal to or less then 5 seconds.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.overlaps(b, 5 sec)
// Above matches when:
//   a.startTimestamp &lt; b.startTimestamp &lt; a.endTimestamp &lt; b.endTimestamp and 
//   0 &lt;= a.endTimestamp - b.startTimestamp &lt;= 5 seconds</pre><p>
				If providing three parameters, for example in <code class="literal">a.overlaps(b, 5 sec, 10 sec)</code>, the method returns true if, in addition, the difference between the end timestamp of A and the start timestamp of B is between 5 and 10 seconds.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.overlaps(b, 5 sec, 10 sec)
// Above matches when:
//   a.startTimestamp &lt; b.startTimestamp &lt; a.endTimestamp &lt; b.endTimestamp and 
//   5 seconds &lt;= a.endTimestamp - b.startTimestamp &lt;= 10 seconds</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-overlappedby"/>12.4.15.Â Overlapped By</h3></div></div></div><p>
				The <code class="literal">overlappedBy</code> date-time method returns true if the parameter event starts before the input event starts and the parameter event finishes after the input event starts, but before the input event finishes (events have an overlapping period of time).
			</p><p>
				The method determines whether the input value's start and end timestamp indicate an overlap with the first parameter's start and end timestamp, such that B starts before A starts and B ends after A started but before A ends.
			</p><p>
				If used with one parameter, for example in <code class="literal">a.overlappedBy(b)</code>, the method returns true if the start timestamp of B is before the start timestamp of A and the end timestamp of B and is before the end timestamp of A.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.overlappedBy(b)
// Above matches when:
//   b.startTimestamp &lt; a.startTimestamp &lt; b.endTimestamp &lt; a.endTimestamp</pre><p>
				If providing two parameters, for example in <code class="literal">a.overlappedBy(b, 5 sec)</code>, the method returns true if, in addition, the difference between the end timestamp of B and the start timestamp of A is equal to or less then 5 seconds.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.overlappedBy(b, 5 sec)
// Above matches when:
//   b.startTimestamp &lt; a.startTimestamp &lt; b.endTimestamp &lt; a.endTimestamp and 
//   0 &lt;= b.endTimestamp - a.startTimestamp &lt;= 5 seconds</pre><p>
				If providing three parameters, for example in <code class="literal">a.overlappedBy(b, 5 sec, 10 sec)</code>, the method returns true if, in addition, the difference between the end timestamp of B and the start timestamp of A is between 5 and 10 seconds. 
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.overlappedBy(b, 5 sec, 10 sec)
// Above matches when:
//   b.startTimestamp &lt; a.startTimestamp &lt; b.endTimestamp &lt; a.endTimestamp and 
//   5 seconds &lt;= b.endTimestamp - a.startTimestamp &lt;= 10 seconds</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-starts"/>12.4.16.Â Starts</h3></div></div></div><p>
				The <code class="literal">starts</code> date-time method returns true if an event and another event start at the same time and the event's end happens before the other event's end.
			</p><p>
				The method determines whether the start timestamps of the input value and the first parameter are the same and the end timestamp of the input value is before the end timestamp of the first parameter.
			</p><p>
				If used with one parameter, for example in <code class="literal">a.starts(b)</code>, the method returns true if the start timestamp of A and B are the same and the end timestamp of A is before the end timestamp of B.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.starts(b)
// Above matches when:
//   a.startTimestamp = b.startTimestamp and a.endTimestamp &lt; b.endTimestamp</pre><p>
				If providing two parameters, for example in <code class="literal">a.starts(b, 5 sec)</code>, the method returns true if the difference between the start timestamps of A and B is between is equal to or less then 5 seconds.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.starts(b, 5 sec)
// Above matches when:
//   abs(a.startTimestamp - b.startTimestamp) &lt;= 5 seconds and 
//   a.endTimestamp &lt; b.endTimestamp</pre><p>
			  A negative value for the interval parameter is not allowed. If your interval parameter is itself an expression that returns a negative value the engine logs a warning message and returns null.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="datetime-method-startedby"/>12.4.17.Â Started By</h3></div></div></div><p>
				The <code class="literal">startedBy</code> date-time method returns true if an event and another event start at the same time and the other event's end happens before the input event's end.
			</p><p>
				The method determines whether the start timestamp of the input value and the first parameter are the same and the end timestamp of the first parameter is before the end timestamp of the input value.
			</p><p>
				If used with one parameter, for example in <code class="literal">a.startedBy(b)</code>, the method returns true if the start timestamp of A and B are the same and the end timestamp of B is before the end timestamp of A.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.startedBy(b)
// Above matches when:
//   a.startTimestamp = b.startTimestamp and b.endTimestamp &lt; a.endTimestamp</pre><p>
				If providing two parameters, for example in <code class="literal">a.startedBy(b, 5 sec)</code>, the method returns true if the difference between the start timestamps of A and B is between is equal to or less then 5 seconds.
			</p><p>
				Sample EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#lastevent as a, B#lastevent as b where a.startedBy(b, 5 sec)
// Above matches when:
//   abs(a.startTimestamp - b.startTimestamp) &lt;= 5 seconds and 
//    b.endTimestamp &lt; a.endTimestamp</pre><p>
			  A negative value for the interval parameter is not allowed. If your interval parameter is itself an expression that returns a negative value the engine logs a warning message and returns null.
			</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-views"/>ChapterÂ 13.Â EPL Reference: Data Windows</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#view-parameters">13.1. A Note on Data Window Name and Parameters</a></span></dt><dt><span class="sect1"><a href="#view-batchwindows">13.2. A Note on Batch Windows</a></span></dt><dt><span class="sect1"><a href="#win-views">13.3. Data Windows</a></span></dt><dd><dl><dt><span class="sect2"><a href="#view-win-length">13.3.1. Length Window (length or win:length)</a></span></dt><dt><span class="sect2"><a href="#view-win-length-batch">13.3.2. Length Batch Window (length_batch or win:length_batch)</a></span></dt><dt><span class="sect2"><a href="#view-win-time">13.3.3. Time Window (time or win:time)</a></span></dt><dt><span class="sect2"><a href="#view-win-ext_time">13.3.4. Externally-timed Window (ext_timed or win:ext_timed)</a></span></dt><dt><span class="sect2"><a href="#view-win-time-batch">13.3.5. Time batch Window (time_batch or win:time_batch)</a></span></dt><dt><span class="sect2"><a href="#view-win-ext-time-batch">13.3.6. Externally-timed Batch Window (ext_timed_batch or win:ext_timed_batch)</a></span></dt><dt><span class="sect2"><a href="#view-win-time-length-batch">13.3.7. Time-Length Combination Batch Window (time_length_batch or win:time_length_batch)</a></span></dt><dt><span class="sect2"><a href="#view-win-time-accumulating">13.3.8. Time-Accumulating Window (time_accum or win:time_accum)</a></span></dt><dt><span class="sect2"><a href="#view-win-keepall">13.3.9. Keep-All Window (keepall or win:keepall)</a></span></dt><dt><span class="sect2"><a href="#view-win-firstlength">13.3.10. First Length Window(firstlength or win:firstlength)</a></span></dt><dt><span class="sect2"><a href="#view-win-firsttime">13.3.11. First Time Window (firsttime or win:firsttime)</a></span></dt><dt><span class="sect2"><a href="#view-win-expr">13.3.12. Expiry Expression Window (expr or win:expr)</a></span></dt><dt><span class="sect2"><a href="#view-win-exprbatch">13.3.13. Expiry Expression Batch Window (expr_batch or win:expr_batch)</a></span></dt><dt><span class="sect2"><a href="#view-std-unique">13.3.14. Unique Window (unique or std:unique)</a></span></dt><dt><span class="sect2"><a href="#view-std-groupwin">13.3.15. Grouped Data Window (groupwin or std:groupwin)</a></span></dt><dt><span class="sect2"><a href="#view-std-last">13.3.16. Last Event Window (std:lastevent)</a></span></dt><dt><span class="sect2"><a href="#view-std-first">13.3.17. First Event Window (firstevent or std:firstevent)</a></span></dt><dt><span class="sect2"><a href="#view-std-firstunique">13.3.18. First Unique Window (firstunique or std:firstunique)</a></span></dt><dt><span class="sect2"><a href="#view-ext-sort">13.3.19. Sorted Window (sort or ext:sort)</a></span></dt><dt><span class="sect2"><a href="#view-ext-rank">13.3.20. Ranked Window (rank or ext:rank)</a></span></dt><dt><span class="sect2"><a href="#view-time-order">13.3.21. Time-Order Window (time_order or ext:time_order)</a></span></dt><dt><span class="sect2"><a href="#view-timetolive">13.3.22. Time-To-Live Window (timetolive or ext:timetolive)</a></span></dt></dl></dd><dt><span class="sect1"><a href="#stat-views">13.4. Special Derived-Value Windows</a></span></dt><dd><dl><dt><span class="sect2"><a href="#view-std-size">13.4.1. Size Derived-Value Window (size) or std:size)</a></span></dt><dt><span class="sect2"><a href="#view-stat-uni">13.4.2. Univariate Statistics Derived-Value Window (uni or stat:uni)</a></span></dt><dt><span class="sect2"><a href="#view-stat-linest">13.4.3. Regression Derived-Value Window (linest or stat:linest)</a></span></dt><dt><span class="sect2"><a href="#view-stat-correl">13.4.4. Correlation Derived-Value Window (correl or stat:correl)</a></span></dt><dt><span class="sect2"><a href="#view-stat-weightedavg">13.4.5. Weighted Average Derived-Value Window (weighted_avg or stat:weighted_avg)</a></span></dt></dl></dd></dl></div><a id="d0e33430" class="indexterm"/><p>
            This chapter outlines the data windows that are built into Esper.
			The section on <a class="xref" href="#processingmodel" title="ChapterÂ 2.Â Basic Concepts">ChapterÂ 2, <i>Basic Concepts</i></a> provides additional information on the relationship of filtering, windows and aggregation. Please also see <a class="xref" href="#epl-from-clause-window-spec" title="5.4.3.Â Specifying Data Windows">SectionÂ 5.4.3, âSpecifying Data Windowsâ</a> for the use of windows in the <code class="literal">from</code> clause with streams, patterns and named windows.
        </p><p>
            Data windows retain incoming events until an expiry policy indicates to release events. Thus data windows are a means of indicating what subset of events to analyze.
        </p><p>
            Two or more data windows can be combined. This allows a sets of events retained by one data window to be placed into a union or an intersection with the set of events retained by one or more other data windows. Please see <a class="xref" href="#epl-from-clause-view-multidatawindow" title="5.4.4.Â Multiple Data Windows">SectionÂ 5.4.4, âMultiple Data Windowsâ</a> for more detail.
        </p><p>
			The keep-all data window counts as a data window but has no expiry policy: it retains all events received. The grouped-window declaration allocates a new data window per grouping criteria and thereby counts as a data window, but cannot appear alone.
        </p><p>
            The next table summarizes data windows:
        </p><div class="table"><a id="d0e33454"/><p class="title"><b>TableÂ 13.1.Â Built-in Data Windows</b></p><div class="table-contents"><table summary="Built-in Data Windows" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Data Window</th><th>Syntax</th><th>Description</th></tr></thead><tbody><tr><td>Length Window</td><td><code class="literal">length(</code><span class="emphasis"><em>size</em></span><code class="literal">)</code></td><td>Sliding length window extending the specified number of elements into the past.</td></tr><tr><td>Length Batch Window</td><td><code class="literal">length_batch(</code><span class="emphasis"><em>size</em></span><code class="literal">)</code></td><td>Tumbling window that batches events and releases them when a given minimum number of events has been collected.</td></tr><tr><td>Time Window</td><td><code class="literal">time(</code><span class="emphasis"><em>time period</em></span><code class="literal">)</code></td><td>Sliding time window extending the specified time interval into the past.</td></tr><tr><td>Externally-timed Window</td><td><code class="literal">ext_timed(</code><span class="emphasis"><em>timestamp expression</em></span>, <span class="emphasis"><em>time period</em></span><code class="literal">)</code></td><td>Sliding time window, based on the long-type time value supplied by an expression.</td></tr><tr><td>Time Batch Window</td><td><code class="literal">time_batch(</code><span class="emphasis"><em>time period</em></span>[,<span class="emphasis"><em>optional reference point</em></span>] [, <span class="emphasis"><em>flow control</em></span>]<code class="literal">)</code></td><td>Tumbling window that batches events and releases them every specified time interval, with flow control options.</td></tr><tr><td>Externally-timed Batch Window</td><td><code class="literal">ext_timed_batch(</code><span class="emphasis"><em>timestamp expression</em></span>, <span class="emphasis"><em>time period</em></span>[,<span class="emphasis"><em>optional reference point</em></span>]<code class="literal">)</code></td><td>Tumbling window that batches events and releases them every specified time interval based on the long-type value supplied by an expression.</td></tr><tr><td>Time-Length Combination Batch Window</td><td><code class="literal">time_length_batch(</code><span class="emphasis"><em>time period, size [, flow control]</em></span><code class="literal">)</code></td><td>Tumbling multi-policy time and length batch window with flow control options.</td></tr><tr><td>Time-Accumulating Window</td><td><code class="literal">time_accum(</code><span class="emphasis"><em>time period</em></span><code class="literal">)</code></td><td>Sliding time window accumulates events until no more events arrive within a given time interval.</td></tr><tr><td>Keep-All Window</td><td><code class="literal">keepall</code></td><td>The keep-all data window simply retains all events.</td></tr><tr><td>Sorted Window</td><td><code class="literal">sort(</code><span class="emphasis"><em>size, sort criteria</em></span><code class="literal">)</code></td><td>Sorts by values returned by sort criteria expressions and keeps only the top events up to the given size.</td></tr><tr><td>Ranked Window</td><td><code class="literal">rank(</code><span class="emphasis"><em>unique criteria(s), size, sort criteria(s)</em></span><code class="literal">)</code></td><td>Retains only the most recent among events having the same value for the criteria expression(s) sorted by sort criteria expressions and keeps only the top events up to the given size.</td></tr><tr><td>Time-Order Window</td><td><code class="literal">time_order(</code><span class="emphasis"><em>timestamp expression, time period</em></span><code class="literal">)</code></td><td>Orders events that arrive out-of-order, using an expression providing timestamps to be ordered.</td></tr><tr><td>Time-To-Live Window</td><td><code class="literal">timetolive(</code><span class="emphasis"><em>timestamp expression</em></span><code class="literal">)</code></td><td>Retains events until the time returned by the timestamp expression.</td></tr><tr><td>Unique Window</td><td><code class="literal">unique(</code><span class="emphasis"><em>unique criteria(s)</em></span><code class="literal">)</code></td><td>Retains only the most recent among events having the same value for the criteria expression(s). Acts as a length window of size 1 for each distinct expression value.</td></tr><tr><td>Grouped Data Window</td><td><code class="literal">groupwin(</code><span class="emphasis"><em>grouping criteria(s)</em></span><code class="literal">)</code></td><td>Groups events into sub-data-windows by the value of the specified expression(s), generally used to provide a separate data window per group.</td></tr><tr><td>Last Event Window</td><td><code class="literal">lastevent</code></td><td>Retains the last event, acts as a length window of size 1.</td></tr><tr><td>First Event Window</td><td><code class="literal">firstevent</code></td><td>Retains the very first arriving event, disregarding all subsequent events.</td></tr><tr><td>First Unique Window</td><td><code class="literal">firstunique(</code><span class="emphasis"><em>unique criteria(s)</em></span><code class="literal">)</code></td><td>Retains only the very first among events having the same value for the criteria expression(s), disregarding all subsequent events for same value(s).</td></tr><tr><td>First Length Window</td><td><code class="literal">firstlength(</code><span class="emphasis"><em>size</em></span><code class="literal">)</code></td><td>Retains the first <span class="emphasis"><em>size</em></span> events, disregarding all subsequent events.</td></tr><tr><td>First Time Window</td><td><code class="literal">firsttime(</code><span class="emphasis"><em>time period</em></span><code class="literal">)</code></td><td>Retains the events arriving until the time interval has passed, disregarding all subsequent events.</td></tr><tr><td>Expiry Expression Window</td><td><code class="literal">expr(</code><span class="emphasis"><em>expiry expression</em></span><code class="literal">)</code></td><td>Expire events based on the result of an expiry expression passed as a parameter.</td></tr><tr><td>Expiry Expression Batch Window</td><td><code class="literal">expr_batch(</code><span class="emphasis"><em>expiry expression</em></span><code class="literal">)</code></td><td>Tumbling window that batches events and releases them based on the result of an expiry expression passed as a parameter.</td></tr></tbody></table></div></div><br class="table-break"/><a id="d0e33742" class="indexterm"/><p>
			There is a special kind of data window that is used less frequently, and is called a derived-value window. They are windows that derive a new value from event streams and post the result as events of a new type.
			The table below summarizes these special derived-value windows.
        </p><div class="table"><a id="d0e33749"/><p class="title"><b>TableÂ 13.2.Â Built-in Derived-Value Data Windows</b></p><div class="table-contents"><table summary="Built-in Derived-Value Data Windows" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Data Window</th><th>Syntax</th><th>Description</th></tr></thead><tbody><tr><td>Size</td><td><code class="literal">size(</code>[<span class="emphasis"><em>expression</em></span>, ...]<code class="literal">)</code></td><td>Derives a count of the number of events in a data window, or in an insert stream if used without a data window, and optionally provides additional event properties as listed in parameters.</td></tr><tr><td>Univariate statistics</td><td><code class="literal">uni(</code><span class="emphasis"><em>value expression</em></span> [,<span class="emphasis"><em>expression</em></span>, ...]<code class="literal">)</code></td><td>Calculates univariate statistics on the values returned by the expression.</td></tr><tr><td>Regression</td><td><code class="literal">linest(</code><span class="emphasis"><em>value expression, value expression</em></span> [,<span class="emphasis"><em>expression</em></span>, ...]<code class="literal">)</code></td><td>Calculates regression on the values returned by two expressions.</td></tr><tr><td>Correlation</td><td><code class="literal">correl(</code><span class="emphasis"><em>value expression, value expression</em></span> [,<span class="emphasis"><em>expression</em></span>, ...]<code class="literal">)</code></td><td>Calculates the correlation value on the values returned by two expressions.</td></tr><tr><td>Weighted average</td><td><code class="literal">weighted_avg(</code><span class="emphasis"><em>value expression, value expression</em></span> [,<span class="emphasis"><em>expression</em></span>, ...]<code class="literal">)</code></td><td>Calculates weighted average given a weight expression and an expression to compute the average for.</td></tr></tbody></table></div></div><br class="table-break"/><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="view-parameters"/>13.1.Â A Note on Data Window Name and Parameters</h2></div></div></div><p>
			   The syntax for data windows starts with data window name and is followed by optional parameter expressions in parenthesis:
		   </p><pre class="synopsis"><span class="emphasis"><em>name</em></span>(<span class="emphasis"><em>window_parameters</em></span>)</pre><p>
			   This example specifies a time window of 5 seconds:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#time(5 sec)</pre><p>
			  Esper organizes built-in data windows in namespaces and names. Windows that provide sliding or tumbling data windows are in the <code class="literal">win</code> namespace. Other most commonly used windows are in the <code class="literal">std</code> namespace. The <code class="literal">ext</code> namespace are window that order events. The <code class="literal">stat</code> namespace is used for windows that derive statistical data.
			</p><p>
			   Alternatively you may specify the namespace name and <code class="literal">:</code> colon character.			
		   </p><pre class="synopsis"><span class="emphasis"><em>namespace</em></span>:<span class="emphasis"><em>name</em></span>(<span class="emphasis"><em>window_parameters</em></span>)</pre><p>
			   The below examples all specify a time window of 5 seconds:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#time(5 sec)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#win:time(5 sec)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent.win:time(5 sec)</pre><p>
			   All expressions are allowed as parameters to data windows, including expressions that contain variables or substitution parameters for prepared statements. Subqueries, the special <code class="literal">prior</code> and <code class="literal">prev</code> functions and aggregations (with the exception of the expression window and expression batch window) are not allowed as data window parameters.
		   </p><p>
			   For example, assuming a variable by name <code class="literal">VAR_WINDOW_SIZE</code> is defined:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#time(VAR_WINDOW_SIZE)</pre><p>
			   The system evaluates expression parameters for data windows at the time of context partition instantiation with the exception of the expression window (<code class="literal">expr</code>) and expression batch window (<code class="literal">expr_batch</code>). 
		   </p><p>
			   Also consider multiple data windows in intersection or union (keywords <code class="literal">retain-intersection</code> and <code class="literal">retain-union</code>). Consider writing a custom plug-in data window if your application requires behavior that is not yet provided by any of the built-in windows.
		   </p><p>
			   If a window takes no parameters you may leave parenthesis off or the use empty parenthesis <code class="literal">()</code>.
		   </p><p>
			   The below examples all specify a keep-all window:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#keepall</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#keepall()</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent.win:keepall()</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent.win:keepall</pre><p>
			   Expression parameters can reference context-provided properties. For example:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema ParameterEvent(windowSize int)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context MyContext initiated by ParameterEvent as params terminated after 1 year</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context MyContext select * from StockTickEvent#length(context.params.windowSize)</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="view-batchwindows"/>13.2.Â A Note on Batch Windows</h2></div></div></div><p>
			   Batch windows buffer events until a certain threshold is reached and then release the batched events for processing. 
			   The released events become the insert stream events and the previous batch of events constitutes the remove stream events.
			   Batch windows thus retain the current and the last batch of events in memory.
		   </p><p>
			   It is often desirable to aggregate without retaining events in memory, or with just keeping the current events in memory (and not also the last batch of events). 
			   You can declare a context and define what starts and ends a "batch" instead.
			   Contexts provide a large degree of freedom in allowing batches to overlap, in allowing batches to span multiple statements and in allowing batches to have complex start and end conditions.
			   They are further described in <a class="xref" href="#context" title="ChapterÂ 4.Â Context and Context Partitions">ChapterÂ 4, <i>Context and Context Partitions</i></a>.
		   </p><p>
			   This example declares a non-overlapping context that spans a time interval of 3 seconds (i.e. a batch of 3 seconds):
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context IntervalSpanning3Seconds start @now end after 3 sec</pre><p>
			   The next example EPL aggregates events without retaining events in memory and outputs at the end of each interval:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context IntervalSpanning3Seconds select count(*) from Events output snapshot when terminated</pre><p>
			   Here is an example that outputs all events when at least 10 events, in the 3-second interval, have collected:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context IntervalSpanning3Seconds select window(*) from Events#keepall having count(*) &gt;= 10</pre><p>
				For the examples above, at the end of each 3-second interval, the engine discards all data windows and aggregation state.
				If your application would like 3-second intervals keyed by some fields please consider a nested context declaration with a keyed segmented context, for example:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context PerSymbolInterval3Sec 
  context ById partition by symbol from StockTick, 
  context Interval3Sec start @now end after 3 sec</pre><p>
				Batch windows keep not only the current batch in memory but also the previous batch of events. 
				For example, let's say at time 0 an event arrives and enters the batch window. 
				At time 3 seconds (3-second batch window) the event becomes an insert-stream event and the engine now updates aggregations for that batch (i.e. count goes up to 1). 
				At time 6 seconds the event becomes a remove-stream event and the engine now updates aggregations for that batch (i.e. count goes down to 0).
				Since the engine continually updates aggregations from insert and remove stream events, and does not re-compute aggregations, batch windows follow the same paradigm. 
			</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="win-views"/>13.3.Â Data Windows</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-win-length"/>13.3.1.Â Length Window (<code class="literal">length</code> or <code class="literal">win:length</code>)</h3></div></div></div><a id="d0e33989" class="indexterm"/><a id="d0e33992" class="indexterm"/><p>
					This window is a moving (sliding) length window extending the specified number of elements into the past. The window takes a single expression as a parameter providing a numeric size value that defines the window size:
				</p><pre class="synopsis">length(<span class="emphasis"><em>size_expression</em></span>)</pre><p>
					The below example sums the price for the last 5 stock ticks for symbol GE.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(price) from StockTickEvent(symbol='GE')#length(5)</pre><p>
					The next example keeps a length window of 10 events of stock trade events, with a separate window for each symbol. The
					sum of price is calculated only for the last 10 events for each symbol and aggregates per symbol:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(price) from StockTickEvent#groupwin(symbol)#length(10) group by symbol</pre><p>
					A length window of 1 is equivalent to the last event window <code class="literal">lastevent</code>. The <code class="literal">lastevent</code> data window is the preferred notation:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#lastevent	// Prefer this
// ... equivalent to ...
select * from StockTickEvent#length(1)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-win-length-batch"/>13.3.2.Â Length Batch Window (<code class="literal">length_batch</code> or <code class="literal">win:length_batch</code>)</h3></div></div></div><a id="d0e34031" class="indexterm"/><a id="d0e34034" class="indexterm"/><p>
					This window buffers events (tumbling window) and releases them when a given minimum number of events has been collected. Provide an expression defining the number of events to batch as a parameter:
				</p><pre class="synopsis">length_batch(<span class="emphasis"><em>size_expression</em></span>)</pre><p>
					The next statement buffers events until a minimum of 10 events have collected. Listeners to updates posted by this window receive updated information only when 10 or more events have collected.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#length_batch(10)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-win-time"/>13.3.3.Â Time Window (<code class="literal">time</code> or <code class="literal">win:time</code>)</h3></div></div></div><a id="d0e34059" class="indexterm"/><a id="d0e34062" class="indexterm"/><p>
					This window is a moving (sliding) time window extending the specified time interval into the past based on the system time.
					Provide a time period (see <a class="xref" href="#epl-syntax-time-periods" title="5.2.1.Â Specifying Time Periods">SectionÂ 5.2.1, âSpecifying Time Periodsâ</a>) or an expression defining the number of seconds as a parameter:
				</p><pre class="synopsis">time(<span class="emphasis"><em>time period</em></span>)</pre><pre class="synopsis">time(<span class="emphasis"><em>seconds_interval_expression</em></span>)</pre><p>
					For the GE stock tick events in the last 1 second, calculate a sum of price.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(price) from StockTickEvent(symbol='GE')#time(1 sec)</pre><p>
					The following time windows are equivalent specifications:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">time(2 minutes 5 seconds)
time(125 sec)
time(125)
time(MYINTERVAL)  // MYINTERVAL defined as a variable</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-win-ext_time"/>13.3.4.Â Externally-timed Window (<code class="literal">ext_timed</code> or <code class="literal">win:ext_timed</code>)</h3></div></div></div><a id="d0e34098" class="indexterm"/><a id="d0e34101" class="indexterm"/><p>
					Similar to the time window, this window is a moving (sliding) time window extending the specified time interval into the past, but based on the long-type
					time value supplied by a timestamp expression. The window takes two parameters: the expression to return long-typed timestamp values,
					and a time period or expression that provides a number of seconds:
				</p><pre class="synopsis">ext_timed(<span class="emphasis"><em>timestamp_expression</em></span>, <span class="emphasis"><em>time_period</em></span>)</pre><pre class="synopsis">ext_timed(<span class="emphasis"><em>timestamp_expression</em></span>, <span class="emphasis"><em>seconds_interval_expression</em></span>)</pre><p>
					The key difference comparing the externally-timed window to the regular time window is that the window slides not based on the engine time, 
					but strictly based on the result of the timestamp expression when evaluated against the events entering the window.
				</p><p>
					The algorithm underlying the window compares the timestamp value returned by the expression when the oldest event arrived with the timestamp value returned by the expression for the newest arriving event on event arrival. 
					If the time interval between the timestamp values is larger then the timer period parameter, 
					then the algorithm removes all oldest events tail-first until the difference between the oldest and newest event is within the time interval. The window
					therefore slides only when events arrive and only considers each event's timestamp property (or other expression value returned) and not engine time.
				</p><p>
					This window holds stock tick events of the last 10 seconds based on the timestamp property in <code class="literal">StockTickEvent</code>.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#ext_timed(timestamp, 10 seconds)</pre><p>
					The externally-timed data window expects strict ordering of the timestamp values returned by the timestamp expression. The window is not useful for ordering events in time order, please use the time-order window instead.
				</p><p>
				  On a related subject, engine time itself can be entirely under control of the application as described in <a class="xref" href="#api-controlling-time" title="14.8.Â Controlling Time-Keeping">SectionÂ 14.8, âControlling Time-Keepingâ</a>, allowing control over all time-based aspects of processing
				  in one place.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-win-time-batch"/>13.3.5.Â Time batch Window (<code class="literal">time_batch</code> or <code class="literal">win:time_batch</code>)</h3></div></div></div><a id="d0e34150" class="indexterm"/><a id="d0e34153" class="indexterm"/><p>
					This window buffers events (tumbling window) and releases them every specified time interval in one update. The window takes a time period or an expression providing a number of seconds as a parameter, plus optional parameters described next.
				</p><pre class="synopsis">time_batch(<span class="emphasis"><em>time_period</em></span> [,<span class="emphasis"><em>optional_reference_point</em></span>] [,<span class="emphasis"><em>flow_control</em></span>])</pre><pre class="synopsis">time_batch(<span class="emphasis"><em>seconds_interval_expression</em></span> [,<span class="emphasis"><em>optional_reference_point</em></span>] [,<span class="emphasis"><em>flow_control</em></span>])</pre><p>
					The time batch window takes a second, optional parameter that serves as a reference point to batch flush times. If not specified, the arrival of the first event into the batch window sets the 
					reference point. Therefore if the reference point is not specified and the first event arrives at time t<sub>1</sub>, then the batch flushes at time t<sub>1</sub> plus <span class="emphasis"><em>time_period</em></span> and every <span class="emphasis"><em>time_period</em></span> thereafter.
				</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
						Please see <a class="xref" href="#view-batchwindows" title="13.2.Â A Note on Batch Windows">SectionÂ 13.2, âA Note on Batch Windowsâ</a> for information on what a batch window is and how to best to compute over intervals. 
					</p><p>
						Note that using this window means that the engine keeps events in memory until the time is up: Consider your event arrival rate and determine if this is the behavior you want. Use context declaration or output rate limiting such as <code class="literal">output snapshot</code> as an alternative.
					</p></div><p>
					The below example batches events into a 5 second window releasing new batches every 5 seconds. Listeners to updates
					posted by this window receive updated information only every 5 seconds.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#time_batch(5 sec)</pre><p>
					By default, if there are no events arriving in the current interval (insert stream), and no events remain from the prior batch (remove stream), then the window does not post results to listeners. The window allows overriding this
					default behavior via flow control keywords.
				</p><p>
					The synopsis with flow control parameters is:
				</p><pre class="synopsis">time_batch(<span class="emphasis"><em>time_period or seconds_interval_expr</em></span> [,<span class="emphasis"><em>optional_reference_point</em></span>] 
    [, "flow-control-keyword [, keyword...]"] )</pre><p>
					The FORCE_UPDATE flow control keyword instructs the window to post an empty result set to listeners if there is no
					data to post for an interval. When using this keyword the <code class="literal">irstream</code> keyword should be used in the <code class="literal">select</code> clause to ensure the remove stream is also output. 
					Note that FORCE_UPDATE is for use with listeners to the same statement and not for use with named windows. Consider output rate limiting instead.
				</p><p>
					The START_EAGER flow control keyword instructs the window to post empty result sets even before the first event
					arrives, starting a time interval at statement creation time. As when using FORCE_UPDATE, the window also posts an
					empty result set to listeners if there is no data to post for an interval, however it starts doing so at time of statement
					creation rather then at the time of arrival of the first event.
				</p><p>
					Taking the two flow control keywords in one sample statement, this example presents a window that waits for 10
					seconds. It posts empty result sets after one interval after the statement is created, and keeps posting an empty result set as no events arrive during intervals:					
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#time_batch(10 sec, "FORCE_UPDATE, START_EAGER")</pre><p>
				  The optional reference point is provided as a long-value of milliseconds (or microseconds for microsecond engine time unit) relative to January 1, 1970 and time 00:00:00.
				</p><p>
				  The following example statement sets the reference point to 5 seconds and the batch size to 1 hour, so that each batch output is 5 seconds after each hour:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from OrderSummaryEvent#time_batch(1 hour, 5000L)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-win-ext-time-batch"/>13.3.6.Â Externally-timed Batch Window (<code class="literal">ext_timed_batch</code> or <code class="literal">win:ext_timed_batch</code>)</h3></div></div></div><a id="d0e34251" class="indexterm"/><a id="d0e34254" class="indexterm"/><p>
				    Similar to the time batch window, this window buffers events (tumbling) and releases them every specified time interval in one update, 
				    but based on the long-type time value supplied by a timestamp expression.
					The window has two required parameters taking an expression that returns long-typed timestamp values and a time period or constant-value expression that provides a number of seconds:
				</p><pre class="synopsis">ext_timed_batch(<span class="emphasis"><em>timestamp_expression</em></span>, <span class="emphasis"><em>time_period</em></span> [,<span class="emphasis"><em>optional_reference_point</em></span>])</pre><pre class="synopsis">ext_timed_batch(<span class="emphasis"><em>timestamp_expression</em></span>, <span class="emphasis"><em>seconds_interval_expression</em></span> [,<span class="emphasis"><em>optional_reference_point</em></span>])</pre><p>
					The externally-timed batch window takes a third, optional parameter that serves as a reference point to batch flush times. If not specified, the arrival of the first event into the batch window sets the 
					reference point. Therefore if the reference point is not specified and the first event arrives at time t<sub>1</sub>, then the batch flushes at time t<sub>1</sub> plus <span class="emphasis"><em>time_period</em></span> and every <span class="emphasis"><em>time_period</em></span> thereafter.
				</p><p>
				   The key difference comparing the externally-timed batch window to the regular time batch window is that the window tumbles not based on the engine time, 
				   but strictly based on the result of the timestamp expression when evaluated against the events entering the window.
				</p><p>
					The algorithm underlying the window compares the timestamp value returned by the expression when the oldest event arrived with the timestamp value returned by the expression for the 
					newest arriving event on event arrival. If the time interval between the timestamp values is larger then the timer period parameter, then the algorithm posts the current batch of events. 
					The window therefore posts batches only when events arrive and only considers each event's timestamp property (or other expression value returned) and not engine time.
				</p><p>
					Note that using this window means that the engine keeps events in memory until the time is up: Consider your event arrival rate and determine if this is the behavior you want. Use context declaration or output rate limiting such as <code class="literal">output snapshot</code> as an alternative.
				</p><p>
					The below example batches events into a 5 second window releasing new batches every 5 seconds. Listeners to updates
					posted by this window receive updated information only when event arrive with timestamps that indicate the start of a new batch:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#ext_timed_batch(timestamp, 5 sec)</pre><p>
				  The optional reference point is provided as a long-value of milliseconds (or microseconds) relative to January 1, 1970 and time 00:00:00.
				</p><p>
				  The following example statement sets the reference point to 5 seconds and the batch size to 1 hour, so that each batch output is 5 seconds after each hour:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from OrderSummaryEvent#ext_timed_batch(timestamp, 1 hour, 5000L)</pre><p>
				  The externally-timed data window expects strict ordering of the timestamp values returned by the timestamp expression. 
				  The window is not useful for ordering events in time order, please use the time-order window instead.
				</p><p>
				  On a related subject, engine time itself can be entirely under control of the application as described in <a class="xref" href="#api-controlling-time" title="14.8.Â Controlling Time-Keeping">SectionÂ 14.8, âControlling Time-Keepingâ</a>, allowing control over all time-based aspects of processing
				  in one place.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-win-time-length-batch"/>13.3.7.Â Time-Length Combination Batch Window (<code class="literal">time_length_batch</code> or <code class="literal">win:time_length_batch</code>)</h3></div></div></div><a id="d0e34331" class="indexterm"/><a id="d0e34334" class="indexterm"/><p>
					This data window is a combination of time and length batch (tumbling) windows. Similar to the time and length batch windows, this batches events and releases the batched events when either one of the 
following conditions occurs, whichever occurs first: the data window has collected a given number of events, or a given time interval has passed.
				</p><p>
					The parameters take 2 forms. The first form accepts a time period or an expression providing a number of seconds, and an expression for the number of events:
				</p><pre class="synopsis">time_length_batch(<span class="emphasis"><em>time_period</em></span>, <span class="emphasis"><em>number_of_events_expression</em></span>)</pre><pre class="synopsis">time_length_batch(<span class="emphasis"><em>seconds_interval_expression</em></span>, <span class="emphasis"><em>number_of_events_expression</em></span>)</pre><p>
					The next example shows a time-length combination batch window that batches up to 100 events or all events arriving within a 1-second time interval, whichever condition occurs first:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""> select * from MyEvent#time_length_batch(1 sec, 100)</pre><p>
					In this example, if 100 events arrive into the window before a 1-second time interval passes, the window posts the batch of 100 events. If less then 100 events arrive within a 1-second interval,
					the window posts all events that arrived within the 1-second interval at the end of the interval.
				</p><p>
					By default, if there are no events arriving in the current interval (insert stream), and no events remain from the prior batch (remove stream), then the window does not post results to listeners. This
					window allows overriding this default behavior via flow control keywords.
				</p><p>
					The synopsis of the window with flow control parameters is:
				</p><pre class="synopsis">time_length_batch(<span class="emphasis"><em>time_period or seconds_interval_expression</em></span>, <span class="emphasis"><em>number_of_events_expression</em></span>, 
    "<span class="emphasis"><em>flow control keyword [, keyword...]</em></span>")</pre><p>
					The <code class="literal">FORCE_UPDATE</code> flow control keyword instructs the window to post an empty result set to listeners if there is no data to post for an interval. The window begins posting no later then after one time interval passed after the first event arrives. When using this keyword the <code class="literal">irstream</code> keyword should be used in the <code class="literal">select</code> clause to ensure the remove stream is also output. 
				</p><p>
					The <code class="literal">START_EAGER</code> flow control keyword instructs the window to post empty result sets even before the first event arrives, starting a time interval at statement creation time. As when using <code class="literal">FORCE_UPDATE</code>, the window also posts an empty result set to listeners if there is no data to post for an interval, however it starts doing so at time of statement creation rather then at the time of arrival of the first event.
				</p><p>
					Taking the two flow control keywords in one sample statement, this example presents a window that waits for 10 seconds or reacts when the 5th event arrives, whichever comes first. It posts empty result sets after one interval after the statement is created, and keeps posting an empty result set as no events arrive during intervals: 
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""> select * from MyEvent#time_length_batch(10 sec, 5, "FORCE_UPDATE, START_EAGER")</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-win-time-accumulating"/>13.3.8.Â Time-Accumulating Window (<code class="literal">time_accum</code> or <code class="literal">win:time_accum</code>)</h3></div></div></div><a id="d0e34412" class="indexterm"/><a id="d0e34415" class="indexterm"/><p>
					This data window is a specialized moving (sliding) time window that differs from the regular time window in that it accumulates events until no more events arrive within a given time interval, and only then releases the accumulated events as a remove stream.
				</p><p>
					The window accepts a single parameter: the time period or seconds-expression specifying the length of the time interval during which no events must arrive until the window releases accumulated events. The synopsis is as follows:
				</p><pre class="synopsis">time_accum(<span class="emphasis"><em>time_period</em></span>)</pre><pre class="synopsis">time_accum(<span class="emphasis"><em>seconds_interval_expression</em></span>)</pre><p>
					The next example shows a time-accumulating window that accumulates events, and then releases events if within the time interval no more events arrive:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""> select * from MyEvent#time_accum(10 sec)</pre><p>
					This example accumulates events, until when for a period of 10 seconds no more MyEvent events arrive, at which time it posts all accumulated MyEvent events.
				</p><p>
					Your application may only be interested in the batches of events as events leave the data window. This can be done simply by selecting the remove stream of this data window, populated by the engine as accumulated events leave the data window all-at-once when no events arrive during the time interval following the time the last event arrived:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""> select rstream * from MyEvent#time_accum(10 sec)</pre><p>
					If there are no events arriving, then the window does not post results to listeners. 
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-win-keepall"/>13.3.9.Â Keep-All Window (<code class="literal">keepall</code> or <code class="literal">win:keepall</code>)</h3></div></div></div><a id="d0e34455" class="indexterm"/><a id="d0e34458" class="indexterm"/><p>
					This keep-all data window simply retains all events. The window does not remove events from the data window, unless used with a named window and the <code class="literal">on delete</code> clause.
				</p><p>
					The window accepts no parameters. The synopsis is as follows:
				</p><pre class="synopsis">keepall</pre><p>
					The next example shows a keep-all window that accumulates all events received into the window:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""> select * from MyEvent#keepall</pre><p>
					Note that since the window does not release events, care must be taken to prevent retained events from using all available resources.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-win-firstlength"/>13.3.10.Â First Length Window(<code class="literal">firstlength</code> or <code class="literal">win:firstlength</code>)</h3></div></div></div><a id="d0e34487" class="indexterm"/><a id="d0e34490" class="indexterm"/><p>
					The <code class="literal">firstlength</code> window retains the very first <span class="emphasis"><em>size_expression</em></span> events.
				</p><p>
					The synopsis is:
				</p><pre class="synopsis">firstlength(<span class="emphasis"><em>size_expression</em></span>)</pre><p>
					If used within a named window and an <code class="literal">on-delete</code> clause deletes events, the window accepts further arriving events until the number of retained events reaches the size of <span class="emphasis"><em>size_expression</em></span>.
				</p><p>
					The below example creates a window that retains only the first 10 events:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#firstlength(10)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-win-firsttime"/>13.3.11.Â First Time Window (<code class="literal">firsttime</code> or <code class="literal">win:firsttime</code>)</h3></div></div></div><a id="d0e34531" class="indexterm"/><a id="d0e34534" class="indexterm"/><p>
					The <code class="literal">firsttime</code> window retains all events arriving within a given time interval after statement start.
				</p><p>
					The synopsis is:
				</p><pre class="synopsis">firsttime(<span class="emphasis"><em>time_period</em></span>)</pre><pre class="synopsis">firsttime(<span class="emphasis"><em>seconds_interval_expression</em></span>)</pre><p>
					The below example creates a window that retains only those events arriving within 1 minute and 10 seconds of statement start:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#firsttime(1 minute 10 seconds)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-win-expr"/>13.3.12.Â Expiry Expression Window (<code class="literal">expr</code> or <code class="literal">win:expr</code>)</h3></div></div></div><a id="d0e34569" class="indexterm"/><a id="d0e34572" class="indexterm"/><p>
					The <code class="literal">expr</code> data window applies an expiry expression and removes events from the data window when the expression returns false.
				</p><p>
				   Use this window to implement rolling and dynamically shrinking or expanding time, length or other windows. Rolling can, for example, be controlled based on event properties of arriving events, based on aggregation values or based on the return result of user-defined functions. Use this window to accumulate events until a value changes or other condition occurs based on arriving events or change of a variable value.
				 </p><p>
					The synopsis is:
				</p><pre class="synopsis">expr(<span class="emphasis"><em>expiry_expression</em></span>)</pre><p>
					The expiry expression can be any expression including expressions on event properties, variables, aggregation functions or user-defined functions. The window applies this expression to the oldest event(s) currently in the window, as described next.
				</p><p>
					When a new event arrives or when a variable value referenced by the expiry expression changes then the window applies the expiry expression starting from the oldest event in the data window.
					If the expiry expression returns false for the oldest event, the window removes the event from the data window. The window then applies the expression to the next oldest event.
					If the expiry expression returns true for the oldest event, no further evaluation takes place and the window indicates any new and expired events through insert and remove stream.
				</p><p>
					By using variables in the expiry expression it is possible to change the behavior of the window dynamically at runtime. When one or more variables used in the expression are updated the window evaluates the expiry expression starting from the oldest event.
				</p><p>
					Aggregation functions, if present in the expiry expression, are continuously updated as events enter and leave the data window. Use the grouped data window with this window to compute aggregations per group.
				</p><p>
					The engine makes the following built-in properties available to the expiry expression:
				</p><div class="table"><a id="d0e34601"/><p class="title"><b>TableÂ 13.3.Â Built-in Properties of the Expiry Expression Data Window</b></p><div class="table-contents"><table summary="Built-in Properties of the Expiry Expression Data Window" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">current_count</code></td><td>int</td><td>The number of events in the data window including the currently-arriving event.</td></tr><tr><td><code class="literal">expired_count</code></td><td>int</td><td>The number of events expired during this evaluation.</td></tr><tr><td><code class="literal">newest_event</code></td><td>(same event type as arriving events)</td><td>The last-arriving event itself.</td></tr><tr><td><code class="literal">newest_timestamp</code></td><td>long</td><td>The engine timestamp associated with the last-arriving event.</td></tr><tr><td><code class="literal">oldest_event</code></td><td>(same event type as arriving events)</td><td>The currently-evaluated event itself.</td></tr><tr><td><code class="literal">oldest_timestamp</code></td><td>long</td><td>The engine timestamp associated with the currently-evaluated event.</td></tr><tr><td><code class="literal">view_reference</code></td><td>Object</td><td>The object handle to this data window.</td></tr></tbody></table></div></div><br class="table-break"/><p>
					This EPL declares an expiry expression that retains the last 2 events:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#expr(current_count &lt;= 2)</pre><p>
					The following example implements a dynamically-sized length window by means of a SIZE variable. As the SIZE variable value changes 
					the window retains the number of events according to the current value of SIZE:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create variable int SIZE = 1000</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#expr(current_count &lt;= SIZE)</pre><p>
					The next EPL retains the last 2 seconds of events:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#expr(oldest_timestamp &gt; newest_timestamp - 2000)</pre><p>
					The following example implements a dynamically-sized time window. As the SIZE long-type variable value changes 
					the window retains a time interval accordingly:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create variable long SIZE = 1000</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#expr(newest_timestamp - oldest_timestamp &lt; SIZE)</pre><p>
					The following example declares a KEEP variable and flushes all events from the data window when the variable turns false:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create variable boolean KEEP = true</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#expr(KEEP)</pre><p>
					The next example specifies a rolling window that removes the oldest events from the window until the total price of all events in the window is less then 1000:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#expr(sum(price) &lt; 1000)</pre><p>
					This example retains all events that have the same value of the <code class="literal">flag</code> event property. When the <code class="literal">flag</code> value changes,
					the data window expires all events with the old <code class="literal">flag</code> value and retains only the most recent event of the new <code class="literal">flag</code> value:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#expr(newest_event.flag = oldest_event.flag)</pre><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="view-win-expr-limit"/>13.3.12.1.Â Limitations</h4></div></div></div><p>
						You may not use subqueries or the <code class="literal">prev</code> and <code class="literal">prior</code> functions as part of the expiry expression. Consider using a named window and <code class="literal">on-delete</code> or <code class="literal">on-merge</code> instead.
					</p><p>
					  When using variables in the expiry expression, the thread that updates the variable does not evaluate the window. The thread that updates the variable instead schedules a reevaluation and window evaluates by timer execution.
					</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-win-exprbatch"/>13.3.13.Â Expiry Expression Batch Window (<code class="literal">expr_batch</code> or <code class="literal">win:expr_batch</code>)</h3></div></div></div><a id="d0e34747" class="indexterm"/><a id="d0e34750" class="indexterm"/><p>					
					The <code class="literal">expr_batch</code> buffers events (tumbling window) and releases them when a given expiry expression returns true.
				</p><p>
				  Use this window to implement dynamic or custom batching behavior, such as for dynamically shrinking or growing time, length or other batches, for batching based on event properties of arriving events, aggregation values or for batching based on a user-defined function.
				</p><p>
					The synopsis is:
				</p><pre class="synopsis">expr_batch(<span class="emphasis"><em>expiry_expression</em></span>, [<span class="emphasis"><em>include_triggering_event</em></span>])</pre><p>
					The expiry expression can be any expression including expressions on event properties, variables, aggregation functions or user-defined functions. The window applies this expression to arriving event(s), as described next.
				</p><p>
					The optional second parameter <span class="emphasis"><em>include_triggering_event</em></span> defines whether to include the event that triggers the batch in the current batch (<code class="literal">true</code>, the default) or in the next batch (<code class="literal">false</code>).
				</p><p>
					When a new event arrives or when a variable value referenced by the expiry expression changes or when events get removed from the data window then the window applies the expiry expression. 
					If the expiry expression returns true the data window posts the collected events as the insert stream and the last batch of events as remove stream.
				</p><p>
					By using variables in the expiry expression it is possible to change the behavior of the window dynamically at runtime. When one or more variables used in the expression are updated the window evaluates the expiry expression as well.
				</p><p>
					Aggregation functions, if present in the expiry expression, are continuously updated as events enter the data window and reset when the engine posts a batch of events. Use the grouped data window with this window to compute aggregations per group.
				</p><p>
					The engine makes the following built-in properties available to the expiry expression:
				</p><div class="table"><a id="d0e34793"/><p class="title"><b>TableÂ 13.4.Â Built-in Properties of the Expiry Expression Data Window</b></p><div class="table-contents"><table summary="Built-in Properties of the Expiry Expression Data Window" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">current_count</code></td><td>int</td><td>The number of events in the data window including the currently-arriving event.</td></tr><tr><td><code class="literal">newest_event</code></td><td>(same event type as arriving events)</td><td>The last-arriving event itself.</td></tr><tr><td><code class="literal">newest_timestamp</code></td><td>long</td><td>The engine timestamp associated with the last-arriving event.</td></tr><tr><td><code class="literal">oldest_event</code></td><td>(same event type as arriving events)</td><td>The currently-evaluated event itself.</td></tr><tr><td><code class="literal">oldest_timestamp</code></td><td>long</td><td>The engine timestamp associated with the currently-evaluated event.</td></tr><tr><td><code class="literal">view_reference</code></td><td>Object</td><td>The object handle to this window.</td></tr></tbody></table></div></div><br class="table-break"/><p>
					This EPL declares an expiry expression that posts event batches consisting of 2 events:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#expr_batch(current_count &gt;= 2)</pre><p>
					The following example implements a dynamically-sized length batch window by means of a SIZE variable. As the SIZE variable value changes 
					the window accumulates and posts the number of events according to the current value of SIZE:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create variable int SIZE = 1000</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#expr_batch(current_count &gt;= SIZE)</pre><p>
					The following example accumulates events until an event arrives that has a value of <code class="literal">postme</code> for property <code class="literal">myvalue</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#expr_batch(myvalue = 'postme')</pre><p>
					The following example declares a POST variable and posts a batch of events when the variable turns true:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create variable boolean POST = false</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#expr_batch(POST)</pre><p>
					The next example specifies a tumbling window that posts a batch of events when the total price of all events in the window is greater then 1000:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#expr_batch(sum(price) &gt; 1000)</pre><p>
				  Specify the second parameter as <code class="literal">false</code> when you want the triggering event not included in the current batch.
				</p><p>
					This example batches all events that have the same value of the <code class="literal">flag</code> event property. When the <code class="literal">flag</code> value changes,
					the data window releases the batch of events collected for the old <code class="literal">flag</code> value. The data window collects the most recent event and the future arriving events of the same new <code class="literal">flag</code> value:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#expr_batch(newest_event.flag != oldest_event.flag, false)</pre><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="view-win-exprbatch-limit"/>13.3.13.1.Â Limitations</h4></div></div></div><p>
						You may not use subqueries or the <code class="literal">prev</code> and <code class="literal">prior</code> functions as part of the expiry expression. Consider using a named window and <code class="literal">on-delete</code> or <code class="literal">on-merge</code> instead.
					</p><p>
					  When using variables in the expiry expression, the thread that updates the variable does not evaluate the window. The thread that updates the variable instead schedules a reevaluation and window evaluates by timer execution.
					</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-std-unique"/>13.3.14.Â Unique Window (<code class="literal">unique</code> or <code class="literal">std:unique</code>)</h3></div></div></div><a id="d0e34936" class="indexterm"/><a id="d0e34939" class="indexterm"/><p>
					The <code class="literal">unique</code> window is a window that includes only the most recent among events having the same value(s) for the result of the specified expression or list of expressions.
				</p><p>
					The synopsis is:
				</p><pre class="synopsis">unique(<span class="emphasis"><em>unique_expression</em></span> [, <span class="emphasis"><em>unique_expression</em></span> ...])</pre><p>
					The window acts as a length window of size 1 for each distinct value returned by an expression, or combination of values returned by multiple expressions. It thus posts as old events the prior event of the same value(s), if any.
				</p><p>
					An expression may return a <code class="literal">null</code> value. The engine treats a <code class="literal">null</code> value as any other value. An expression can also return a custom application object, whereby the application class should implement the <code class="literal">hashCode</code> and <code class="literal">equals</code> methods.
				</p><p>
					The below example creates a window that retains only the last event per symbol.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#unique(symbol)</pre><p>
					The next example creates a window that retains the last event per symbol and feed.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#unique(symbol, feed)</pre><p>
					When using <code class="literal">unique</code> the engine plans queries applying an implicit unique index, where applicable. 
					Specify <code class="literal">@Hint('disable_unique_implicit_idx')</code> to force the engine to plan queries using a non-unique index.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-std-groupwin"/>13.3.15.Â Grouped Data Window (<code class="literal">groupwin</code> or <code class="literal">std:groupwin</code>)</h3></div></div></div><a id="d0e35000" class="indexterm"/><a id="d0e35003" class="indexterm"/><p>
					Specifying <code class="literal">#groupwin</code> groups events into sub-data-window by the value returned by the specified expression or the combination of values returned by a list of expressions. The <code class="literal">#groupwin</code> takes a single expression to supply the group criteria values, or a list of expressions as parameters, as the synopsis shows:
				</p><pre class="synopsis">groupwin(<span class="emphasis"><em>grouping_expression</em></span> [, <span class="emphasis"><em>grouping_expression</em></span> ...])</pre><p>
					The <span class="emphasis"><em>grouping_expression</em></span> expression(s) return one or more group keys, by which it creates a separate data window for each distinct group key. Note that the expression should not return an unlimited number of values: the grouping expression should not
					return a time value or otherwise unlimited key. 
				</p><p>
					An expression may return a <code class="literal">null</code> value. The engine treats a <code class="literal">null</code> value as any other value. An expression can also return a custom application object, whereby the application class should implement the <code class="literal">hashCode</code> and <code class="literal">equals</code> methods.
				</p><p>
					You can specify a single <code class="literal">groupwin</code> per stream. Multiple <code class="literal">groupwin</code> declarations for the same stream are not allowed.
				</p><p>
					Use <code class="literal">group by</code> instead of the grouped data window to control how aggregations are grouped.
				</p><p>
					A grouped data window with a length window of 1 is equivalent to the unique data window <code class="literal">unique</code>. The <code class="literal">unique</code> data window is the preferred notation:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#unique(symbol)	// Prefer this
// ... equivalent to ...
select * from StockTickEvent#groupwin(symbol)#length(1)</pre><p>
					This example computes the total price for the last 5 events considering the last 5 events per each symbol, aggregating the price across all symbols (since no <code class="literal">group by</code> clause is specified the aggregation is across all symbols):
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, sum(price) from StockTickEvent#groupwin(symbol)#length(5)</pre><p>
					The @Hint("<code class="literal">reclaim_group_aged=</code><span class="emphasis"><em>age_in_seconds</em></span>") hint instructs the engine to discard grouped data window state that has not been updated for <span class="emphasis"><em>age_in_seconds</em></span> seconds. 
					The optional @Hint("<code class="literal">reclaim_group_freq=</code><span class="emphasis"><em>sweep_frequency_in_seconds</em></span>") can be specified in addition to control the frequency at which the engine sweeps data window state.
					If the hint is not specified, the frequency defaults to the same value as <span class="emphasis"><em>age_in_seconds</em></span>. Use the hints when your group criteria returns a changing or unlimited number of values. By default and without hints the data window does not reclaim or remove data windows for group criteria values.
				</p><p>
					The updated sample statement with both hints:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Remove data window for symbols not updated for 10 seconds or more and sweep every 30 seconds
@Hint('reclaim_group_aged=10,reclaim_group_freq=30')
select symbol, sum(price) from StockTickEvent#groupwin(symbol)#length(5)</pre><p>
					Reclaim executes when an event arrives and not in the timer thread. In the example above reclaim can occur up to 40 seconds of engine time after the newest event arrives.
					Reclaim may affect iteration order for the statement and iteration order becomes indeterministic with reclaim.
				</p><p>
					To compute the total price for the last 5 events considering the last 5 events per each symbol and outputting a price per symbol, add the <code class="literal">group by</code> clause:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, sum(price) from StockTickEvent#groupwin(symbol)#length(5) group by symbol</pre><p>
					The <code class="literal">groupwin</code> grouped-window can also take multiple expressions that provide values to group by. This example computes the total price for each symbol and feed for the last 10 events per symbol and feed combination:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(price) from StockTickEvent#groupwin(symbol, feed)#length(10)</pre><p>
					The order in which the <code class="literal">groupwin</code> grouped-window appears controls the data the engine derives from events for each group. The next 2 statements demonstrate this using a length window.
				</p><p>
					Without the <code class="literal">groupwin</code> declaration query the same query returns the total price per symbol for only the last 10 events across all symbols. Here the engine allocates only one length window for all events:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(price) from StockTickEvent#length(10)</pre><p>
					We have learned that by placing the <code class="literal">groupwin</code> grouped-window before other data windows, these other data windows become part of the grouped set of windows. The engine dynamically allocates a new window instance for each, every time it encounters a new group key such as a new value for symbol. Therefore, in <code class="literal">groupwin(symbol)#length(10)</code> the engine allocates a new length window for each distinct symbol. However in <code class="literal">length(10)</code> alone the engine maintains a single length window.
				</p><p>
					The <code class="literal">groupwin</code> can be used with multiple data windows to achieve a grouped intersection or union policy.
				</p><p>
					The next query retains the last 4 events per symbol and only those events that are also not older then 10 seconds:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#groupwin(symbol)#length(4)#time(10)</pre><p>
					Last, considers a grouped data window for two group criteria. Here, the query results are total price per symbol and feed for the last 100 events per symbol and feed.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(price) from StockTickEvent#groupwin(symbol, feed)#length(100)</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
					  A note on grouped time windows: When using grouped-window with time windows, note that whether the engine retains 5 minutes of events or retains 5 minutes of events per group, the result is the same from the perspective of retaining events as both policies retain, considering all groups, the same set of events. Therefore please specify the time window alone (ungrouped).
					</p><p>
						For example:
					</p><pre xmlns="" class="">// Use this:
select sum(price) from StockTickEvent#time(1 minute)

// is equivalent to (don't use this):
// select sum(price) from StockTickEvent#groupwin(symbol)#time(1 minute)

// Use the group-by clause for grouping aggregation by symbol.</pre></div><p>
					For advanced users: There is an optional declaration that can control how the <code class="literal">groupwin</code> grouped-window gets evaluated and that is <code class="literal">#merge</code>. 
					The merge can only occur after a <code class="literal">groupwin</code> grouped-window. It controls the end of the grouped declaration. 
				</p><p>
					Compare the following statements:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from Market#groupwin(ticker)#length(1000000)
    #weighted_avg(price, volume)#merge(ticker)
// ... and ...
select * from Market#groupwin(ticker)#length(1000000)#merge(ticker)
    #weighted_avg(price, volume)</pre><p>
					If your statement does not specify the optional <code class="literal">#merge</code>, the semantics are the same as the first statement.
				</p><p>
					The first statement, in which the <code class="literal">#merge</code>is added to the end (same as no merge), computes weighted average per ticker, considering, per-ticker, the last 1M Market events for each ticker.
					The second statement, in which the merge is added to the middle, computes weighted average considering, per-ticker, the last 1M Market events, computing the weighted average for all such events using a single data window rather then multiple data window instances with one window per ticker. 
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-std-last"/>13.3.16.Â Last Event Window (<code class="literal">std:lastevent</code>)</h3></div></div></div><a id="d0e35185" class="indexterm"/><a id="d0e35188" class="indexterm"/><p>
					This window exposes the last element:
				</p><pre class="synopsis">lastevent</pre><p>
					The window acts as a length window of size 1. It thus posts as old events the prior event in the stream, if any.
				</p><p>
					This example statement retains the last stock tick event for the symbol GE. 
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent(symbol='GE')#lastevent</pre><p>
					If you want to output the last event within a sliding window, please see <a class="xref" href="#epl-single-row-function-ref-previous" title="10.1.12.Â The Previous Function">SectionÂ 10.1.12, âThe Previous Functionâ</a>. That function accepts a relative (count) or absolute index and returns event properties or an event in the context of the specified data window.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-std-first"/>13.3.17.Â First Event Window (<code class="literal">firstevent</code> or <code class="literal">std:firstevent</code>)</h3></div></div></div><a id="d0e35216" class="indexterm"/><a id="d0e35219" class="indexterm"/><p>
					This window retains only the first arriving event:
				</p><pre class="synopsis">firstevent</pre><p>
					All events arriving after the first event are discarded.
				</p><p>
					If used within a named window and an <code class="literal">on-delete</code> clause deletes the first event, the window resets and will retain the next arriving event.
				</p><p>
					An example of a statement that retains the first <code class="literal">ReferenceData</code> event arriving is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from ReferenceData#firstevent</pre><p>
					If you want to output the first event within a sliding window, please see <a class="xref" href="#epl-single-row-function-ref-previous" title="10.1.12.Â The Previous Function">SectionÂ 10.1.12, âThe Previous Functionâ</a>. That function accepts a relative (count) or absolute index and returns event properties or an event in the context of the specified data window.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-std-firstunique"/>13.3.18.Â First Unique Window (<code class="literal">firstunique</code> or <code class="literal">std:firstunique</code>)</h3></div></div></div><a id="d0e35255" class="indexterm"/><a id="d0e35258" class="indexterm"/><p>
					The <code class="literal">firstunique</code> window retains only the very first among events having the same value for the specified expression or list of expressions.
				</p><p>
					The synopsis is:
				</p><pre class="synopsis">firstunique(<span class="emphasis"><em>unique_expression</em></span> [, <span class="emphasis"><em>unique_expression</em></span> ...])</pre><p>
					If used within a named window and an <code class="literal">on-delete</code> clause deletes events, the window resets and will retain the next arriving event for the expression result value(s) of the deleted events.
				</p><p>
					The below example creates a window that retains only the first event per category:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from ReferenceData#firstunique(category)</pre><p>
					When using <code class="literal">firstunique</code> the engine plans queries applying an implicit unique index, where applicable. 
					Specify <code class="literal">@Hint('disable_unique_implicit_idx')</code> to force the engine to plan queries using a non-unique index.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-ext-sort"/>13.3.19.Â Sorted Window (<code class="literal">sort</code> or <code class="literal">ext:sort</code>)</h3></div></div></div><a id="d0e35304" class="indexterm"/><a id="d0e35307" class="indexterm"/><p>					
					This window sorts by values returned by the specified expression or list of expressions and keeps only the top (or bottom) events up to the given size. 
				</p><p>					
					This window retains all events in the stream that fall into the sort range. Use the ranked window as described next to retain events per unique key(s) and sorted.
				</p><p>
					The syntax is as follows:
				</p><pre class="synopsis">sort(<span class="emphasis"><em>size_expression</em></span>, 
    <span class="emphasis"><em>sort_criteria_expression</em></span> [asc/desc][, <span class="emphasis"><em>sort_criteria_expression</em></span> [asc/desc]...]) </pre><p>					
					An expression may be followed by the optional <code class="literal">asc</code> or <code class="literal">desc</code> keywords to indicate that the values returned by that expression are sorted in ascending or descending sort order.
				</p><p>
					The window below retains only those events that have the highest 10 prices considering all events (and not only the last event per symbol, see rank below) and reports a total price:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(price) from StockTickEvent#sort(10, price desc)</pre><p>
					The following example sorts events first by price in descending order, and then by symbol name in ascending (alphabetical) order, keeping only the 10
events with the highest price (with ties resolved by alphabetical order of symbol).
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#sort(10, price desc, symbol asc)</pre><p>
					The sorted window is often used with the <code class="literal">prev</code>, <code class="literal">prevwindow</code> or <code class="literal">prevtail</code> single-row functions to output properties of events at a certain position or to output the complete data window according to sort order.
				</p><p>
					Use the grouped window to retain a separate sort window for each group. For example, the windows <code class="literal">groupwin(market)#sort(10, price desc)</code> instruct the engine to retain, per market,  the highest 10 prices.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-ext-rank"/>13.3.20.Â Ranked Window (<code class="literal">rank</code> or <code class="literal">ext:rank</code>)</h3></div></div></div><a id="d0e35370" class="indexterm"/><a id="d0e35373" class="indexterm"/><p>					
					This window retains only the most recent among events having the same value for the criteria expression(s), sorted by sort criteria expressions and keeps only the top events up to the given size.
				</p><p>					
					This window is similar to the sorted window in that it keeps only the top (or bottom) events up to the given size, however the window also retains only the most recent among events having the same value(s) for the specified uniqueness expression(s).
				</p><p>
					The syntax is as follows:
				</p><pre class="synopsis">rank(<span class="emphasis"><em>unique_expression</em></span> [, <span class="emphasis"><em>unique_expression</em></span> ...],
    <span class="emphasis"><em>size_expression</em></span>, 
    <span class="emphasis"><em>sort_criteria_expression</em></span> [asc/desc][, <span class="emphasis"><em>sort_criteria_expression</em></span> [asc/desc]...]) </pre><p>
					Specify the expressions returning unique key values first. Then specify a constant value that is the size of the ranked window. Then specify the expressions returning sort criteria values. The sort criteria expressions may be followed by the optional <code class="literal">asc</code> or <code class="literal">desc</code> keywords to indicate that the values returned by that expression are sorted in ascending or descending sort order.
				</p><p>
					The window below retains only those events that have the highest 10 prices considering only the last event per symbol and reports a total price:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(price) from StockTickEvent#rank(symbol, 10, price desc)</pre><p>
					The following example retains, for the last event per market and symbol, those events that sort by price and quantity ascending into the first 10 ranks:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#rank(market, symbol, 10, price, quantity)</pre><p>
					The ranked window is often used with the <code class="literal">prev</code>, <code class="literal">prevwindow</code> or <code class="literal">prevtail</code> single-row functions to output properties of events at a certain position or to output the complete data window according to sort order.
				</p><p>
					This example outputs every 5 seconds the top 10 events according to price descending and considering only the last event per symbol:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select prevwindow(*) from StockTickEvent#rank(symbol, 10, price desc)
  output snapshot every 5 seconds limit 1  // need only 1 row</pre><p>
					Use the grouped window to retain a separate rank for each group. For example, the windows <code class="literal">groupwin(market)#rank(symbol, 10, price desc)</code> instruct the engine to retain, per market,  the highest 10 prices considering the last event per symbol.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-time-order"/>13.3.21.Â Time-Order Window (<code class="literal">time_order</code> or <code class="literal">ext:time_order</code>)</h3></div></div></div><a id="d0e35446" class="indexterm"/><a id="d0e35449" class="indexterm"/><p>
					This window orders events that arrive out-of-order, using timestamp-values provided by an expression, and by comparing that timestamp value to engine time.
				</p><p>
					The syntax for this window is as follows.
				</p><pre class="synopsis">time_order(<span class="emphasis"><em>timestamp_expression</em></span>, <span class="emphasis"><em>time_period</em></span>)</pre><pre class="synopsis">time_order(<span class="emphasis"><em>timestamp_expression</em></span>, <span class="emphasis"><em>seconds_interval_expression</em></span>)</pre><p>
					The first parameter to the window is the expression that supplies timestamp values. The timestamp is expected to be a long-typed value that denotes an event's time of consideration by the window (or other expression). This is typically the time of arrival. The second parameter is a number-of-seconds expression or the time period specifying the time interval that an arriving event should maximally be held, in order to consider older events arriving at a later time.
				</p><p>
					Since the window compares timestamp values to engine time, the window requires that the timestamp values and engine time are both following the same clock. Therefore, to the extend that the clocks that originated both timestamps differ, the window may produce inaccurate results.
				</p><p>
					As an example, the next statement uses the <code class="literal">arrival_time</code> property of <code class="literal">MyTimestampedEvent</code> events to order and release events by arrival time:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert rstream into ArrivalTimeOrderedStream
select rstream * from MyTimestampedEvent#time_order(arrival_time, 10 sec)</pre><p>
					In the example above, the <code class="literal">arrival_time</code> property holds a long-typed timestamp value. On arrival of an event, the engine compares the timestamp value of each event to the tail-time of the window. The tail-time of the window is, in this example, 10 seconds before engine time (continuously sliding). If the timestamp value indicates that the event is older then the tail-time of the time window, the event is released immediately in the remove stream. If the timestamp value indicates that the event is newer then the tail-time of the window, the window retains the event until engine time moves such that the event timestamp is older then tail-time.
				</p><p>
					The examples thus holds each arriving event in memory anywhere from zero seconds to 10 seconds, to allow for older events (considering arrival time timestamp) to arrive. In other words, the window holds an event with an arrival time equal to engine time for 10 seconds. The window holds an event with an arrival time that is 2 seconds older then engine time for 8 seconds. The window holds an event with an arrival time that is 10 or more seconds older then engine time for zero seconds, and releases such (old) events immediately into the remove stream. 
				</p><p>
					The insert stream of this sliding window consists of all arriving events. The remove stream of the window is ordered by timestamp value: The event that has the oldest timestamp value is released first, followed by the next newer events. Note the statement above uses the <code class="literal">rstream</code> keyword in both the <code class="literal">insert into</code> clause and the <code class="literal">select</code> clause to select ordered events only. It uses the <code class="literal">insert into</code> clause to makes such ordered stream available for subsequent statements to use.
				</p><p>
					It is up to your application to populate the timestamp property into your events or use a sensible expression that returns timestamp values for consideration by the window. The window also works well if you use externally-provided time via timer events. 
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-timetolive"/>13.3.22.Â Time-To-Live Window (<code class="literal">timetolive</code> or <code class="literal">ext:timetolive</code>)</h3></div></div></div><a id="d0e35520" class="indexterm"/><a id="d0e35523" class="indexterm"/><p>
					This window retains events until engine time reaches the value returned by the given timestamp expression.
				</p><p>
					The syntax for this window is as follows:
				</p><pre class="synopsis">timetolive(<span class="emphasis"><em>timestamp_expression</em></span>)</pre><p>
					The only parameter to the window is the expression that supplies timestamp values. The timestamp is expected to be a long-typed value that denotes an event's time-to-live. 
				</p><p>
					Since the window compares timestamp values to engine time, the window requires that the timestamp values and engine time are both following the same clock.
				</p><p>
					On arrival of an event, the engine evaluates the timestamp expression and obtains a long-type timestamp. The engine compares that timestamp value to engine time:
				</p><div class="itemizedlist"><ul><li><p>If the timestamp is older than engine time or the same as engine time, the engine releases the event immediately into the remove stream and does not retain the event at all.</p></li><li><p>If the timestamp value is newer than the engine time, the data window retains the event until engine time moves forward such that the timestamp is the same or older than engine time.</p></li></ul></div><p>
					As an example, the next statement uses the <code class="literal">arrival_time</code> property of <code class="literal">MyTimestampedEvent</code> events to release events by arrival time:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert rstream into ArrivalTimeOrderedStream
select rstream * from MyTimestampedEvent#timetolive(arrival_time)</pre><p>
					For example, assume engine time is <code class="literal">8:00:00</code> (8 am).
				</p><div class="itemizedlist"><ul><li><p>
							If the <code class="literal">arrival_time</code> timestamp is <code class="literal">8:00:00</code> or older (such as <code class="literal">7:59:00</code>), the data window does not retain the event at all, i.e.
							the engine releases the event into the remove stream upon arrival.
						</p></li><li><p>
							If the <code class="literal">arrival_time</code> timestamp is after <code class="literal">8:00:00</code> the data window retains the event.
							Let's say the <code class="literal">arrival_time</code> timestamp is <code class="literal">8:02:00</code> the engine retains the event until engine time is <code class="literal">8:02:00</code> or newer.
						</p></li></ul></div><p>
					The engine evaluates the expression only once at the arrival of each event to determine that event's time-to-live.
				</p><p>
					The insert stream of this sliding window consists of all arriving events. The remove stream of the window is ordered by timestamp value: The event that has the oldest timestamp value is released first, followed by the next newer events. Note the statement above uses the <code class="literal">rstream</code> keyword in both the <code class="literal">insert into</code> clause and the <code class="literal">select</code> clause to select ordered events only. It uses the <code class="literal">insert into</code> clause to makes such ordered stream available for subsequent statements to use.
				</p><p>
					It is up to your application to populate the timestamp property into your events or use a sensible expression that returns timestamp values for consideration by the window. 
					The window also works well if you use externally-provided time via timer events and if you have engine time track watermarks. 
				</p><p>
					The time-to-live data window is fully equivalent to the time-order data window with a zero value for the time period.
				</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="stat-views"/>13.4.Â Special Derived-Value Windows</h2></div></div></div><p>
			   The derived-value windows can be used combined with data windows or alone. Very similar to aggregation functions, these windows aggregate or derive information from an event stream. As compared to aggregation functions,
			   statistics windows can post multiple derived fields all-in-one including properties from the last event that was received. The derived fields and event properties are available for querying in the <code class="literal">where</code>-clause and are often compared to prior values using the <code class="literal">prior</code> function. Derived-value window do not retain events.
           </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-std-size"/>13.4.1.Â Size Derived-Value Window (<code class="literal">size</code>) or <code class="literal">std:size</code>)</h3></div></div></div><a id="d0e35636" class="indexterm"/><a id="d0e35639" class="indexterm"/><p>
					This window posts the number of events received from a stream or window plus any additional event properties or expression values listed as parameters. The synopsis is:
				</p><pre class="synopsis">size([<span class="emphasis"><em>expression</em></span>, ...] [ * ])</pre><p>					
					The window posts a single long-typed property named <code class="literal">size</code>. The window posts the prior size as old data, and the current size as new data to update listeners of the window. Via the <code class="literal">iterator</code> method of the statement the size value can also be polled (read). The window only posts output events when the <code class="literal">size</code> count changes and does not stay the same.
				</p><p>
					As optional parameters the window takes a list of expressions that the window evaluates against the last arriving event and provides along the <code class="literal">size</code> field. You may also provide the <code class="literal">*</code> wildcard selector to have the window output all event properties.
				</p><p>					
					An alternative to receiving a data window event count is the <code class="literal">prevcount</code> function. Compared to the <code class="literal">size</code> window the <code class="literal">prevcount</code> function requires a data window while the <code class="literal">size</code> window does not. The related <code class="literal">count(...)</code> aggregation function provides a count per group when used with <code class="literal">group by</code>.
				</p><p>
					When combined with a data window, the size window  reports the current number of events in the data window in the insert stream and the prior number of events in the data window as the remove stream. This example reports the number of tick events within the last 1 minute:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select size from StockTickEvent#time(1 min)#size</pre><p>
					To select additional event properties you may add each event property to output as a parameter to the window. 
				</p><p>
					The next example selects the symbol and feed event properties in addition to the <code class="literal">size</code> property:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select size, symbol, feed from StockTickEvent#time(1 min)#size(symbol, feed)</pre><p>
					This example selects all event properties in addition to the <code class="literal">size</code> property:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#time(1 min)#size(*)</pre><p>
					The size window is also useful in conjunction with a <code class="literal">groupwin</code> grouped-window to count the number of events per group. The EPL below returns the number of events per symbol.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select size from StockTickEvent#groupwin(symbol)#size</pre><p>
					When used without a data window, the window simply counts the number of events:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select size from StockTickEvent#size</pre><p>
					All windows can be used with pattern statements as well. The next EPL snippet shows a pattern that looks for tick events followed by trade events for the same symbol. The size window counts the number of occurrences of the pattern.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select size from pattern[every s=StockTickEvent -&gt; TradeEvent(symbol=s.symbol)]#size</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-stat-uni"/>13.4.2.Â Univariate Statistics Derived-Value Window (<code class="literal">uni</code> or <code class="literal">stat:uni</code>)</h3></div></div></div><a id="d0e35734" class="indexterm"/><a id="d0e35737" class="indexterm"/><p>
					This window calculates univariate statistics on a numeric expression. The window takes a single value expression as a parameter plus any number of optional additional expressions to return properties of the last event. The value expression must return a numeric value:
				</p><pre class="synopsis">uni(<span class="emphasis"><em>value_expression</em></span> [,<span class="emphasis"><em>expression</em></span>, ...] [ * ])</pre><p>
					After the value expression you may optionally list additional expressions or event properties to evaluate for the stream and return their value based on the last arriving event. You may also provide the <code class="literal">*</code> wildcard selector to have the window output all event properties.
				</p><div class="table"><a id="view-stat-uni-table"/><p class="title"><b>TableÂ 13.5.Â Univariate Statistics Derived Properties</b></p><div class="table-contents"><table summary="Univariate Statistics Derived Properties" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Property Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">datapoints</code></td><td>Number of values, equivalent to <code class="literal">count(*)</code> for the stream</td></tr><tr><td><code class="literal">total</code></td><td>Sum of values</td></tr><tr><td><code class="literal">average</code></td><td>Average of values</td></tr><tr><td><code class="literal">variance</code></td><td>Variance</td></tr><tr><td><code class="literal">stddev</code></td><td>Sample standard deviation (square root of variance) </td></tr><tr><td><code class="literal">stddevpa</code></td><td>Population standard deviation</td></tr></tbody></table></div></div><br class="table-break"/><p>
					The below example selects the standard deviation on price for stock tick events for the last 10 events.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select stddev from StockTickEvent#length(10)#uni(price)</pre><p>
					To add properties from the event stream you may simply add all additional properties as parameters to the window.
				</p><p>
					This example selects all of the derived values, based on the price property, plus the values of the symbol and feed event properties:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#length(10)#uni(price, symbol, feed)</pre><p>
					The following example selects all of the derived values plus all event properties:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#length(10)#uni(price, symbol, *)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-stat-linest"/>13.4.3.Â Regression Derived-Value Window (<code class="literal">linest</code> or <code class="literal">stat:linest</code>)</h3></div></div></div><a id="d0e35832" class="indexterm"/><a id="d0e35835" class="indexterm"/><p>
					This window calculates regression and related intermediate results on the values returned by two expressions. The window takes two value expressions as parameters plus any number of optional additional expressions to return properties of the last event. The value expressions must return a numeric value:
				</p><pre class="synopsis">linest(<span class="emphasis"><em>value_expression</em></span>, <span class="emphasis"><em>value_expression</em></span> [,<span class="emphasis"><em>expression</em></span>, ...] [ * ])</pre><p>
					After the two value expressions you may optionally list additional expressions or event properties to evaluate for the stream and return their value based on the last arriving event. You may also provide the <code class="literal">*</code> wildcard selector to have the window output all event properties.
				</p><div class="table"><a id="view-stat-linest-table"/><p class="title"><b>TableÂ 13.6.Â Regression Derived Properties</b></p><div class="table-contents"><table summary="Regression Derived Properties" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Property Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">slope</code></td><td>Slope.</td></tr><tr><td><code class="literal">YIntercept</code></td><td>Y intercept.</td></tr><tr><td><code class="literal">XAverage</code></td><td>X average.</td></tr><tr><td><code class="literal">XStandardDeviationPop</code></td><td>X standard deviation population.</td></tr><tr><td><code class="literal">XStandardDeviationSample</code></td><td>X standard deviation sample.</td></tr><tr><td><code class="literal">XSum</code></td><td>X sum.</td></tr><tr><td><code class="literal">XVariance</code></td><td>X variance.</td></tr><tr><td><code class="literal">YAverage</code></td><td>X average.</td></tr><tr><td><code class="literal">YStandardDeviationPop</code></td><td>Y standard deviation population.</td></tr><tr><td><code class="literal">YStandardDeviationSample</code></td><td>Y standard deviation sample.</td></tr><tr><td><code class="literal">YSum</code></td><td>Y sum.</td></tr><tr><td><code class="literal">YVariance</code></td><td>Y variance.</td></tr><tr><td><code class="literal">dataPoints</code></td><td>Number of data points.</td></tr><tr><td><code class="literal">n</code></td><td>Number of data points.</td></tr><tr><td><code class="literal">sumX</code></td><td>Sum of X (same as X Sum).</td></tr><tr><td><code class="literal">sumXSq</code></td><td>Sum of X squared.</td></tr><tr><td><code class="literal">sumXY</code></td><td>Sum of X times Y.</td></tr><tr><td><code class="literal">sumY</code></td><td>Sum of Y (same as Y Sum).</td></tr><tr><td><code class="literal">sumYSq</code></td><td>Sum of Y squared.</td></tr></tbody></table></div></div><br class="table-break"/><p>
					The next example calculates regression and returns the slope and y-intercept on price and offer for all events in the last 10 seconds.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select slope, YIntercept from StockTickEvent#time(10 seconds)#linest(price, offer)</pre><p>
					To add properties from the event stream you may simply add all additional properties as parameters to the window.
				</p><p>
					This example selects all of the derived values, based on the price and offer properties, plus the values of the symbol and feed event properties:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#time(10 seconds)#linest(price, offer, symbol, feed)</pre><p>
					The following example selects all of the derived values plus all event properties:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent#time(10 seconds)#linest(price, offer, *)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-stat-correl"/>13.4.4.Â Correlation Derived-Value Window (<code class="literal">correl</code> or <code class="literal">stat:correl</code>)</h3></div></div></div><a id="d0e36008" class="indexterm"/><a id="d0e36011" class="indexterm"/><p>
					This window calculates the correlation value on the value returned by two expressions. The window takes two value expressions as parameters plus any number of optional additional expressions to return properties of the last event. The value expressions must be return a numeric value:
				</p><pre class="synopsis">correl(<span class="emphasis"><em>value_expression</em></span>, <span class="emphasis"><em>value_expression</em></span> [,<span class="emphasis"><em>expression</em></span>, ...] [ * ])</pre><p>
					After the two value expressions you may optionally list additional expressions or event properties to evaluate for the stream and return their value based on the last arriving event. You may also provide the <code class="literal">*</code> wildcard selector to have the window output all event properties.
				</p><div class="table"><a id="view-stat-correl-table"/><p class="title"><b>TableÂ 13.7.Â Correlation Derived Properties</b></p><div class="table-contents"><table summary="Correlation Derived Properties" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Property Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">correlation</code></td><td>Correlation between two event properties</td></tr></tbody></table></div></div><br class="table-break"/><p>
					The next example calculates correlation on price and offer over all stock tick events for GE:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select correlation from StockTickEvent(symbol='GE')#correl(price, offer)</pre><p>
					To add properties from the event stream you may simply add all additional properties as parameters to the window.
				</p><p>
					This example selects all of the derived values, based on the price and offer property, plus the values of the feed event property:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent(symbol='GE')#correl(price, offer, feed)</pre><p>
					The next example selects all of the derived values plus all event properties:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTickEvent(symbol='GE')#correl(price, offer, *)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="view-stat-weightedavg"/>13.4.5.Â Weighted Average Derived-Value Window (<code class="literal">weighted_avg</code> or <code class="literal">stat:weighted_avg</code>)</h3></div></div></div><a id="d0e36076" class="indexterm"/><a id="d0e36079" class="indexterm"/><p>
					This window returns the weighted average given an expression returning values to compute the average for and an expression returning weight. The window takes two value expressions as parameters plus any number of optional additional expressions to return properties of the last event. The value expressions must return numeric values:
				</p><pre class="synopsis">weighted_avg(<span class="emphasis"><em>value_expression_field</em></span>, <span class="emphasis"><em>value_expression_weight</em></span> [,<span class="emphasis"><em>expression</em></span>, ...] [ * ])</pre><p>
					After the value expression you may optionally list additional expressions or event properties to evaluate for the stream and return their value based on the last arriving event. You may also provide the <code class="literal">*</code> wildcard selector to have the window output all event properties.
				</p><div class="table"><a id="view-stat-weightedavg-table"/><p class="title"><b>TableÂ 13.8.Â Weighted Average Derived Properties</b></p><div class="table-contents"><table summary="Weighted Average Derived Properties" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Property Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">average</code></td><td>Weighted average</td></tr></tbody></table></div></div><br class="table-break"/><p>
					A statement that derives the volume-weighted average price for the last 3 seconds for a given symbol is shown below:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select average 
from StockTickEvent(symbol='GE')#time(3 seconds)#weighted_avg(price, volume)</pre><p>
					To add properties from the event stream you may simply add all additional properties as parameters to the window.
				</p><p>
					This example selects all of the derived values, based on the price and volume properties, plus the values of the symbol and feed event properties:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select *
from StockTickEvent#time(3 seconds)#weighted_avg(price, volume, symbol, feed)</pre><p>
					The next example selects all of the derived values plus the values of all event properties:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select *
from StockTickEvent#time(3 seconds)#weighted_avg(price, volume, *)</pre><p>
					Aggregation functions could instead be used to compute the weighted average as well. The next example also posts weighted average per symbol considering the last 3 seconds of stock tick data:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, sum(price*volume)/sum(volume)
from StockTickEvent#time(3 seconds) group by symbol</pre><p>
					The following example computes weighted average keeping a separate data window per symbol considering the last 5 events of each symbol:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, average
from StockTickEvent#groupwin(symbol)#length(5)#weighted_avg(price, volume)</pre></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api"/>ChapterÂ 14.Â API Reference</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#api-reference-intro">14.1. API Overview</a></span></dt><dt><span class="sect1"><a href="#api-engine-instances">14.2. The Service Provider Interface</a></span></dt><dt><span class="sect1"><a href="#api-administrative">14.3. The Administrative Interface</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-admin-creating">14.3.1. Creating Statements</a></span></dt><dt><span class="sect2"><a href="#api-receive-results">14.3.2. Receiving Statement Results</a></span></dt><dt><span class="sect2"><a href="#api-admin-subscriber">14.3.3. Setting a Subscriber Object</a></span></dt><dt><span class="sect2"><a href="#api-admin-listeners">14.3.4. Adding Listeners</a></span></dt><dt><span class="sect2"><a href="#api-admin-iterators">14.3.5. Using Iterators</a></span></dt><dt><span class="sect2"><a href="#api-admin-mgmt-stmt">14.3.6. Managing Statements</a></span></dt><dt><span class="sect2"><a href="#api-admin-atomic">14.3.7. Atomic Statement Management</a></span></dt><dt><span class="sect2"><a href="#api-admin-runtime-config">14.3.8. Runtime Configuration</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-runtime">14.4. The Runtime Interface</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-runtime-eventsender">14.4.1. Event Sender</a></span></dt><dt><span class="sect2"><a href="#api-runtime-unmatched">14.4.2. Receiving Unmatched Events</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-ondemand">14.5. On-Demand Fire-and-Forget Query Execution</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-ondemand-single">14.5.1. On-Demand Query Single Execution</a></span></dt><dt><span class="sect2"><a href="#api-ondemand-prepared">14.5.2. On-Demand Query Prepared Unparameterized Execution</a></span></dt><dt><span class="sect2"><a href="#api-ondemand-preparedparameterized">14.5.3. On-Demand Query Prepared Parameterized Execution</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-event">14.6. Event and Event Type</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-eventtype">14.6.1. Event Type Metadata</a></span></dt><dt><span class="sect2"><a href="#api-eventbean">14.6.2. Event Object</a></span></dt><dt><span class="sect2"><a href="#api-eventtype-query">14.6.3. Query Example</a></span></dt><dt><span class="sect2"><a href="#api-eventtype-pattern">14.6.4. Pattern Example</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-threading">14.7. Engine Threading and Concurrency</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-threading-advanced">14.7.1. Advanced Threading</a></span></dt><dt><span class="sect2"><a href="#api-processingorder">14.7.2. Processing Order</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-controlling-time">14.8. Controlling Time-Keeping</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-controlling-time-span">14.8.1. Controlling Time Using Time Span Events</a></span></dt><dt><span class="sect2"><a href="#api-time-resolution">14.8.2. Time Resolution and Time Unit</a></span></dt><dt><span class="sect2"><a href="#api-time-internal">14.8.3. Internal Timer Based on JVM System Time</a></span></dt><dt><span class="sect2"><a href="#api-controlling-time-spi">14.8.4. Additional Time-Related APIs</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-isolatedservice">14.9. Service Isolation</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-isolatedservice-overview">14.9.1. Overview</a></span></dt><dt><span class="sect2"><a href="#api-isolatedruntime-suspend">14.9.2. Example: Suspending a Statement</a></span></dt><dt><span class="sect2"><a href="#api-isolatedruntime-catchup">14.9.3. Example: Catching Up a Statement From Historical Data</a></span></dt><dt><span class="sect2"><a href="#api-isolatedruntime-insertinto">14.9.4. Isolation for Insert-Into</a></span></dt><dt><span class="sect2"><a href="#api-isolatedruntime-namedwindowtable">14.9.5. Isolation for Named Windows and Tables</a></span></dt><dt><span class="sect2"><a href="#api-isolatedruntime-runtime">14.9.6. Runtime Considerations</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-exception">14.10. Exception Handling</a></span></dt><dt><span class="sect1"><a href="#api-condition">14.11. Condition Handling</a></span></dt><dt><span class="sect1"><a href="#api-soda">14.12. Statement Object Model</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-soda-building-step1">14.12.1. Building an Object Model</a></span></dt><dt><span class="sect2"><a href="#api-soda-building-step2">14.12.2. Building Expressions</a></span></dt><dt><span class="sect2"><a href="#api-soda-building-step3">14.12.3. Building a Pattern Statement</a></span></dt><dt><span class="sect2"><a href="#api-soda-building-step4">14.12.4. Building a Select Statement</a></span></dt><dt><span class="sect2"><a href="#api-soda-building-step5">14.12.5. Building a Create-Variable and On-Set Statement</a></span></dt><dt><span class="sect2"><a href="#api-soda-building-step6">14.12.6. Building Create-Window, On-Delete and On-Select Statements</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-prepared">14.13. Prepared Statement and Substitution Parameters</a></span></dt><dt><span class="sect1"><a href="#api-instrumentation">14.14. Engine and Statement Metrics Reporting</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-instrumentation-enginemetrics">14.14.1. Engine Metrics</a></span></dt><dt><span class="sect2"><a href="#api-instrumentation-statementmetrics">14.14.2. Statement Metrics</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-output-rendering">14.15. Event Rendering to XML and JSON</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-output-rendering-json">14.15.1. JSON Event Rendering Conventions and Options</a></span></dt><dt><span class="sect2"><a href="#api-output-rendering-xml">14.15.2. XML Event Rendering Conventions and Options</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-plugin">14.16. Plug-In Loader</a></span></dt><dt><span class="sect1"><a href="#api-annotation">14.17. Interrogating EPL Annotations</a></span></dt><dt><span class="sect1"><a href="#api-contextpartitionselection">14.18. Context Partition Selection</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-contextpartitionselection-selectors">14.18.1. Selectors</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-contextpartitionadmin">14.19. Context Partition Administration</a></span></dt><dt><span class="sect1"><a href="#api-testing">14.20. Test and Assertion Support</a></span></dt><dd><dl><dt><span class="sect2"><a href="#api-testing-assertion">14.20.1. EPAssertionUtil Summary</a></span></dt><dt><span class="sect2"><a href="#api-testing-listener">14.20.2. SupportUpdateListener Summary</a></span></dt><dt><span class="sect2"><a href="#api-testing-usage">14.20.3. Usage Example</a></span></dt></dl></dd><dt><span class="sect1"><a href="#api-osgi">14.21. OSGi, Class Loader, Class-For-Name</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-reference-intro"/>14.1.Â API Overview</h2></div></div></div><p>
			Esper has the following primary interfaces:
        </p><div class="itemizedlist"><ul><li><p>
                    The event and event type interfaces are described in <a class="xref" href="#api-event" title="14.6.Â Event and Event Type">SectionÂ 14.6, âEvent and Event Typeâ</a>.
                </p></li><li><p>
                    The administrative interface to create and manage EPL and pattern statements, and set runtime configurations, is described in <a class="xref" href="#api-administrative" title="14.3.Â The Administrative Interface">SectionÂ 14.3, âThe Administrative Interfaceâ</a>.
                </p></li><li><p>
			        The runtime interface to send events into the engine, set and get variable values and execute on-demand queries, is described in <a class="xref" href="#api-runtime" title="14.4.Â The Runtime Interface">SectionÂ 14.4, âThe Runtime Interfaceâ</a>.
                </p></li></ul></div><p>
          For EPL introductory information please see <a class="xref" href="#epl-intro" title="5.1.Â EPL Introduction">SectionÂ 5.1, âEPL Introductionâ</a> and patterns are described at <a class="xref" href="#event-pattern-intro" title="7.1.Â Event Pattern Overview">SectionÂ 7.1, âEvent Pattern Overviewâ</a>.
        </p><p>
			The JavaDoc documentation is also a great source for API information.
        </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-engine-instances"/>14.2.Â The Service Provider Interface</h2></div></div></div><a id="d0e36178" class="indexterm"/><p>
			The <code class="literal">EPServiceProvider</code> interface represents an engine instance. Each instance of an Esper engine is completely independent of other engine instances and has its own administrative and runtime interface.
        </p><p>
			An instance of the Esper engine is obtained via static methods on the <code class="literal">EPServiceProviderManager</code> class.
			The <code class="literal">getDefaultProvider</code> method and the <code class="literal">getProvider(String providerURI)</code> methods return an instance of the Esper engine.
			The latter can be used to obtain multiple instances of the engine for different provider URI values. The <code class="literal">EPServiceProviderManager</code>
			determines if the provider URI matches all prior provider URI values and returns the same engine instance for the same provider URI value. If the provider URI has not been seen before, it creates a new engine instance.
        </p><p>
			The code snipped below gets the default instance Esper engine. Subsequent calls to get the default engine instance return the same instance.
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPServiceProvider epService = EPServiceProviderManager.getDefaultProvider();</pre><p>
			This code snippet gets an Esper engine for the provider URI <code class="literal">RFIDProcessor1</code>. Subsequent calls to get an engine with the same provider URI return the same instance.
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPServiceProvider epService = EPServiceProviderManager.getProvider("RFIDProcessor1");</pre><p>
			Since the <code class="literal">getProvider</code> methods return the same cached engine instance for each URI, there is no need to statically cache an engine instance in your application.
        </p><p>
			An existing Esper engine instance can be reset via the <code class="literal">initialize</code> method on the <code class="literal">EPServiceProvider</code> instance. This operation stops and removes all statements and 
			resets the engine to the configuration provided when the engine instance for that URI was obtained. If no configuration is provided, an empty (default) configuration applies.
        </p><p>
			After <code class="literal">initialize</code> your application must obtain new administrative and runtime services. Any administrative and runtime services obtained before the initialize are invalid and have undefined behavior.
        </p><p>
			The next code snippet outlines a typical sequence of use: 
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Configure the engine, this is optional
Configuration config = new Configuration();
config.configure("configuration.xml");	// load a configuration from file
config.set....(...);    // make additional configuration settings

// Obtain an engine instance
EPServiceProvider epService = EPServiceProviderManager.getDefaultProvider(config);

// Optionally, use initialize if the same engine instance has been used before to start clean
epService.initialize();

// Optionally, make runtime configuration changes
epService.getEPAdministrator().getConfiguration().add...(...);

// Destroy the engine instance when no longer needed, frees up resources
epService.destroy();</pre><p>
			An existing Esper engine instance can be destroyed via the <code class="literal">destroy</code> method on the <code class="literal">EPServiceProvider</code> instance. This stops and removes all statements
			as well as frees all resources held by the instance. After a <code class="literal">destroy</code> the engine can no longer be used.
        </p><p>
			The <code class="literal">EPServiceStateListener</code> interface may be implemented by your application to receive callbacks when an engine instance is about to be destroyed and after an engine instance has been initialized. Listeners are registered via the <code class="literal">addServiceStateListener</code> method. The <code class="literal">EPStatementStateListener</code> interface is used to receive callbacks when a new statement gets created and when a statement gets started, stopped or destroyed. Listeners are registered via the <code class="literal">addStatementStateListener</code> method.
        </p><p>
			When destroying an engine instance your application must make sure that threads that are sending events into the engine have completed their work. More generally, the engine should not be currently in use during or after the destroy operation.
        </p><p>
			As engine instances are completely independent, your application may not send <code class="literal">EventBean</code> instances obtained from one engine instance into a second engine instance since the event type space between two engine instances is not shared.
        </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-administrative"/>14.3.Â The Administrative Interface</h2></div></div></div><a id="d0e36268" class="indexterm"/><a id="d0e36271" class="indexterm"/><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-admin-creating"/>14.3.1.Â Creating Statements</h3></div></div></div><p>
				Create event pattern expression and EPL  statements via the administrative interface <code class="literal">EPAdministrator</code>.
			</p><p>
				For managing one or more related statements as a module, please consider the deployment administrative API and EPL modules as further described in <a class="xref" href="#devlifecycle-packagedeploy" title="16.4.Â Packaging and Deploying Overview">SectionÂ 16.4, âPackaging and Deploying Overviewâ</a>.
			</p><p>
				This code snippet gets an Esper engine then creates an event pattern and an EPL  statement.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPServiceProvider epService = EPServiceProviderManager.getDefaultProvider();
EPAdministrator admin = epService.getEPAdministrator();

EPStatement 10secRecurTrigger = admin.createPattern(
  "every timer:at(*, *, *, *, *, */10)");

EPStatement countStmt = admin.createEPL(
  "select count(*) from MarketDataBean#time(60 sec)");
</pre><p>
				Note that event pattern expressions can also occur within EPL  statements. This is outlined in more detail in <a class="xref" href="#epl-from-clause-patterns" title="5.4.2.Â Pattern-Based Event Streams">SectionÂ 5.4.2, âPattern-Based Event Streamsâ</a>.
			</p><p>
				The <code class="literal">create</code> methods on <code class="literal">EPAdministrator</code> are overloaded and allow an optional statement name to be passed to the engine. A statement name can be useful for retrieving a statement
				by name from the engine at a later time. The engine assigns a statement name if no statement name is supplied on statement creation.
			</p><p>
				The <code class="literal">createPattern</code> and <code class="literal">createEPL</code> methods return <code class="literal">EPStatement</code> instances. Statements are automatically started and active when created. A statement can also be stopped and started again via the <code class="literal">stop</code> and <code class="literal">start</code> methods shown in the code snippet below.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">countStmt.stop();
countStmt.start();</pre><p>
				The <code class="literal">create</code> methods on <code class="literal">EPAdministrator</code> also accept a user object.  
				The user object is associated with a statement at time of statement creation and is a single, unnamed field that is stored with every statement.
				Applications may put arbitrary objects in this field. Use the <code class="literal">getUserObject</code> method on <code class="literal">EPStatement</code> to obtain the user object of a statement
				and <code class="literal">StatementAwareUpdateListener</code> for listeners.
			</p><p>
				Your application may create new statements or stop and destroy existing statements using any thread and also within listener or subscriber code. If using POJO events, your application may not create or manage statements in the event object itself while the same event is currently being processed by a statement.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-receive-results"/>14.3.2.Â Receiving Statement Results</h3></div></div></div><a id="d0e36343" class="indexterm"/><p>
				For NEsper .NET also see <a class="xref" href="#appendix_dotnet_api_receive_results" title="I.14.Â .NET API - Receiving Statement Results">SectionÂ I.14, â.NET API - Receiving Statement Resultsâ</a>.
			</p><p>
				Esper provides three choices for your application to receive statement results. Your application can use all three mechanisms alone or in any combination for each statement. The choices are:
			</p><div class="table"><a id="api-admin-receive-results"/><p class="title"><b>TableÂ 14.1.Â Choices For Receiving Statement Results</b></p><div class="table-contents"><table summary="Choices For Receiving Statement Results" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Name</th><th>Methods on <code class="literal">EPStatement</code></th><th>Description</th></tr></thead><tbody><tr><td>Listener Callbacks</td><td><code class="literal">addListener</code> and <code class="literal">removeListener</code></td><td>
								<p> 
									Your application provides implementations of the <code class="literal">UpdateListener</code> or the <code class="literal">StatementAwareUpdateListener</code> interface to the statement. 
									Listeners receive <code class="literal">EventBean</code> instances containing statement results.
								</p>
								<p>The engine continuously indicates results to all listeners as soon they occur, and following output rate limiting clauses if specified.</p>
                            </td></tr><tr><td>Subscriber Object</td><td><code class="literal">setSubscriber</code></td><td>
                                <p>
                                    Your application provides a POJO (plain Java object) that exposes methods to receive statement results.
                                </p>
                                <p>
                                    The name of the method that a subscriber object provides to receive results is <code class="literal">update</code>, unless your call to <code class="literal">setSubscriber</code> provides 
                                    another method name.
                                </p>
                                <p>The engine continuously indicates results to the single subscriber as soon they occur, and following output rate limiting clauses if specified.</p>
                                <p>
                                    This is the fastest method to receive statement results, as the engine delivers strongly-typed results directly to your application objects without the need for
                                    building an <code class="literal">EventBean</code> result set as in the Listener Callback choice.
                                </p>
                                <p>
                                    There can be at most 1 Subscriber Object registered per statement. If you require more than one listener, use the Listener Callback instead (or in addition).
                                    The Subscriber Object is bound to the statement with a strongly typed support which ensure direct delivery of new events without type conversion. This optimization
                                    is made possible because there can only be 0 or 1 Subscriber Object per statement.
                                </p>
                            </td></tr><tr><td>Pull API</td><td><code class="literal">safeIterator</code> and <code class="literal">iterator</code></td><td>
                                <p>Your application asks the statement for results and receives a set of events via <code class="literal">java.util.Iterator&lt;EventBean&gt;</code>.</p>
                                <p>This is useful if your application does not need continuous indication of new results in real-time.</p>
                             </td></tr></tbody></table></div></div><br class="table-break"/><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>
				The engine calls application-provided update listeners and subscribers for output. These commonly encapsulate the actions to take when there is output.
				This design decouples EPL statements from actions and places actions outside of EPL. It allows actions to change independently from statements: A statement 
				does not need to be updated when its associated action(s) change.
			</p><p>
				While action-taking, in respect to the code or script taking the action, is not a part of the EPL language, here are a few noteworthy points. 
				Through the use of EPL annotations you can attach information to EPL that can be used by applications to flexibly determine actions.
				The convenient <code class="literal">StatementAwareUpdateListener</code> interface is a listener that receives the statement itself and subscribers can accept <code class="literal">EPStatement</code> as a parameter.
				The <code class="literal">insert into</code>-clause can be used to send results into a further stream and input and output adapters or data flows can exist to process output events from that stream.
				Also the data flow <code class="literal">EPStatementSource</code> operator can be used to hook up actions declaratively.
				The <code class="literal">EPStatementStateListener </code> can inform your application of new statements coming online.
			</p></div><p>
				Your application may attach one or more listeners, zero or one single subscriber and in addition use the Pull API on the same statement. There are no limitations to the use of iterator, subscriber or listener
				alone or in combination to receive statement results.
			</p><p>
				The best delivery performance can generally be achieved by attaching a subscriber and by not attaching listeners.
                The engine is aware of the listeners and subscriber attached to a statement. The engine uses this information internally to reduce statement overhead. For example, if your statement does not have listeners or a subscriber attached, the engine does not need to continuously generate results for delivery.
			</p><p>
				If your application attaches both a subscriber and one or more listeners then the subscriber receives the result first before any of the listeners.
			</p><p>
				If your application attaches more than one listener then the <code class="literal">UpdateListener</code> listeners receive results first in the order they were added to the statement, and
				<code class="literal">StatementAwareUpdateListener</code> listeners receive results next in the order they were added to the statement. To change the order of delivery among listeners your application can add and remove listeners at runtime.
			</p><p>
				If you have configured outbound threading, it means a thread from the outbound thread pool delivers results to the subscriber and listeners instead of the processing or event-sending thread.
			</p><p>
				If outbound threading is turned on, we recommend turning off the engine setting preserving the order of events delivered to listeners as described in <a class="xref" href="#config-engine-threading-dispatch" title="15.4.13.1.Â Preserving the Order of Events Delivered to Listeners">SectionÂ 15.4.13.1, âPreserving the Order of Events Delivered to Listenersâ</a>. If outbound threading is turned on statement execution is not blocked for the configured time in the case a subscriber or listener takes too much time.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-admin-subscriber"/>14.3.3.Â Setting a Subscriber Object</h3></div></div></div><a id="d0e36493" class="indexterm"/><a id="d0e36496" class="indexterm"/><p>
				A subscriber object is a direct binding of query results to a Java object. The object, a POJO, receives statement results via method invocation. The subscriber class does not need to implement an interface or extend a superclass. Only one subscriber object may be set for a statement.
			</p><p>
			  Subscriber objects have several advantages over listeners. First, they offer a substantial performance benefit: Query results are delivered directly to your method(s) through Java virtual machine method calls, and there is no intermediate representation (<code class="literal">EventBean</code>). Second, as subscribers receive strongly-typed parameters, the subscriber code tends to be simpler.
			</p><p>
			  This chapter describes the requirements towards the methods provided by your subscriber class.
			</p><p>
			  The engine can deliver results to your subscriber in two ways:			 
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						Each evert in the insert stream results in a method invocation, and each event in the remove stream results in further method invocations. This is termed <span class="emphasis"><em>row-by-row delivery</em></span>.
					</p></li><li><p>
						A single method invocation that delivers all rows of the insert and remove stream. This is termed <span class="emphasis"><em>multi-row</em></span> delivery.
					</p></li></ol></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="api-admin-subscriber-epstatement"/>14.3.3.1.Â Using the <code class="literal">EPStatement</code> Parameter</h4></div></div></div><a id="d0e36531" class="indexterm"/><p>
					In the case that your subscriber object wishes to receive the <code class="literal">EPStatement</code> instance along with output data,
					please add <code class="literal">EPStatement</code> as the very first parameter of any of the delivery method footprints that are discussed next.
				</p><p>
					For example, your statement may be:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*) from OrderEvent</pre><p>
					Your subscriber class exposes the method:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void update(EPStatement statement, long currentCount) {...}</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="api-admin-subscriber-rowbyrow"/>14.3.3.2.Â Row-by-Row Delivery</h4></div></div></div><a id="d0e36555" class="indexterm"/><p>
					Your subscriber class must provide a method by name <code class="literal">update</code> to receive insert stream events row-by-row. The number and types of parameters declared by the <code class="literal">update</code> method must match the number and types of columns as specified in the <code class="literal">select</code> clause, in the same order as in the <code class="literal">select</code> clause.
				</p><p>
					For example, if your statement is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select orderId, price, count(*) from OrderEvent</pre><p>
					Then your subscriber <code class="literal">update</code> method looks as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MySubscriber {
  ...
  public void update(String orderId, double price, long count) {...}
  ...
}</pre><p>
					Each method parameter declared by the <code class="literal">update</code> method must be assignable from the respective column type as listed in the <code class="literal">select</code>-clause, in the order selected. The assignability rules are:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							Widening of types follows Java standards. For example, if your <code class="literal">select</code> clause selects an integer value, the method parameter for the same column can be typed int, long, float or double (or any equivalent boxed type).
						</p></li><li><p>
							Auto-boxing and unboxing follows Java standards. For example, if your <code class="literal">select</code> clause selects an <code class="literal">java.lang.Integer</code> value, the method parameter for the same column can be typed <code class="literal">int</code>. Note that if your <code class="literal">select</code> clause column may generate <code class="literal">null</code> values, an exception may occur at runtime unboxing the <code class="literal">null</code> value.
						</p></li><li><p>
							Interfaces and super-classes are honored in the test for assignability. Therefore <code class="literal">java.lang.Object</code> can be used to accept any <code class="literal">select</code> clause column type
						</p></li></ul></div><p>
				  In the case that your subscriber class offers multiple <code class="literal">update</code> method footprints, the engine selects the closest-matching footprint by comparing the output types and method parameter types. The engine prefers the update method that is an exact match of types, followed by an update method that requires boxing or unboxing, followed by an update method that requires widening and finally any other allowable update method. 
				</p><p>
				  Within the above criteria, in the case that your subscriber class offers multiple <code class="literal">update</code> method footprints with same method parameter types, the engine prefers the update method that has <code class="literal">EPStatement</code> as the first parameter.
				</p><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="api-admin-subscriber-rowbyrow-wildcard"/>14.3.3.2.1.Â Wildcards</h5></div></div></div><p>
						If your <code class="literal">select</code> clause contains one or more wildcards (*), then the equivalent parameter type is the underlying event type of the stream selected from.
					</p><p>
						For example, your statement may be:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select *, count(*) from OrderEvent</pre><p>
						Then your subscriber <code class="literal">update</code> method looks as follows:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void update(OrderEvent orderEvent, long count) {...}</pre><p>
						In a join, the wildcard expands to the underlying event type of each stream in the join in the order the streams occur in the <code class="literal">from</code> clause. An example statement for a join is:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select *, count(*) from OrderEvent order, OrderHistory hist</pre><p>
						Then your subscriber <code class="literal">update</code> method should be:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void update(OrderEvent orderEvent, OrderHistory orderHistory, long count) {...}</pre><p>
						The stream wildcard syntax and the stream name itself can also be used:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select hist.*, order from OrderEvent order, OrderHistory hist</pre><p>
						The matching <code class="literal">update</code> method is:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void update(OrderHistory orderHistory, OrderEvent orderEvent) {...}</pre></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="api-admin-subscriber-rowbyrow-generic"/>14.3.3.2.2.Â Row Delivery as Map and Object Array </h5></div></div></div><p>
						Alternatively, your <code class="literal">update</code> method may simply choose to accept <code class="literal">java.util.Map</code> as a representation for each row. Each column in the <code class="literal">select</code> clause is 
						then made an entry in the resulting <code class="literal">Map</code>. The <code class="literal">Map</code> keys are the column name if supplied, or the expression string itself for columns without a name.
					</p><p>
						The <code class="literal">update</code> method for <code class="literal">Map</code> delivery is:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void update(Map row) {...}</pre><p>
						The engine also supports delivery of <code class="literal">select</code> clause columns as an object array. Each item in the object array represents a column in the <code class="literal">select</code> clause. The <code class="literal">update</code> method then looks as follows:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void update(Object[] row) {...}</pre></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="api-admin-subscriber-rowbyrow-rstream"/>14.3.3.2.3.Â Delivery of Remove Stream Events</h5></div></div></div><p>
						Your subscriber receives remove stream events if it provides a method named <code class="literal">updateRStream</code>. The method must accept the same number and types of parameters as the <code class="literal">update</code> method (including <code class="literal">EPStatement</code> if present).
					</p><p>
						An example statement:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select orderId, count(*) from OrderEvent#time(20 sec) group by orderId</pre><p>
						Then your subscriber <code class="literal">update</code> and <code class="literal">updateRStream</code> methods should be:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void update(String, long count) {...}
public void updateRStream(String orderId, long count) {...}</pre></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="api-admin-subscriber-rowbyrow-beginend"/>14.3.3.2.4.Â Delivery of Begin and End Indications</h5></div></div></div><p>
						If your subscriber requires a notification for begin and end of event delivery, it can expose methods by name <code class="literal">updateStart</code> and <code class="literal">updateEnd</code>. 
					</p><p>
						The <code class="literal">updateStart</code> method must take two integer parameters that indicate the number of events of the insert stream and remove stream to be delivered. The engine invokes the <code class="literal">updateStart</code> method immediately prior to delivering events to the <code class="literal">update</code> and <code class="literal">updateRStream</code> methods.
					</p><p>
						The <code class="literal">updateEnd</code> method must take no parameters. The engine invokes the <code class="literal">updateEnd</code> method immediately after delivering events to the <code class="literal">update</code> and <code class="literal">updateRStream</code> methods.
					</p><p>
						An example set of delivery methods:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Called by the engine before delivering events to update methods
public void updateStart(int insertStreamLength, int removeStreamLength)

// To deliver insert stream events
public void update(String orderId, long count) {...}

// To deliver remove stream events
public void updateRStream(String orderId, long count) {...}

// Called by the engine after delivering events
public void updateEnd() {...}</pre></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="api-admin-subscriber-multirow"/>14.3.3.3.Â Multi-Row Delivery</h4></div></div></div><a id="d0e36804" class="indexterm"/><p>
					In place of row-by-row delivery, your subscriber can receive all events in the insert and remove stream via a single method invocation. This is applicable when an EPL delivers multiple output rows for a given input event or time advancing, for example when multiple pattern matches occur for the same incoming event, for a join producing multiple output rows or with output rate limiting, for example.
				</p><p>
					The event delivery follow the scheme as described earlier in <a class="xref" href="#api-admin-subscriber-rowbyrow-generic" title="14.3.3.2.2.Â Row Delivery as Map and Object Array">SectionÂ 14.3.3.2.2, âRow Delivery as Map and Object Array â</a>. The subscriber class must provide one of the following methods:
				</p><div class="table"><a id="api-admin-subscriber-multirow-underlying"/><p class="title"><b>TableÂ 14.2.Â Update Method for Multi-Row Delivery of Underlying Events</b></p><div class="table-contents"><table summary="Update Method for Multi-Row Delivery of Underlying Events" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">update(Object[][] insertStream, Object[][] removeStream)</code></td><td>
									<p>The first dimension of each Object array is the event row, and the second dimension is the column matching the column order of the statement <code class="literal">select</code> clause</p>
								 </td></tr><tr><td><code class="literal">update(Map[] insertStream, Map[] removeStream)</code></td><td>
									<p> Each map represents one event, and Map entries represent columns of the statement <code class="literal">select</code> clause</p>
								</td></tr></tbody></table></div></div><br class="table-break"/><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="api-admin-subscriber-multirow-wildcard"/>14.3.3.3.1.Â Wildcards</h5></div></div></div><p>
						If your <code class="literal">select</code> clause contains a single wildcard (*) or wildcard stream selector, the subscriber object may also directly receive arrays of the underlying events. In this case, the subscriber class should provide a method <code class="literal">update(</code><span class="emphasis"><em>Underlying</em></span><code class="literal">[] insertStream, </code><span class="emphasis"><em>Underlying</em></span>[] <span class="emphasis"><em>removeStream</em></span><code class="literal">)</code> , such that <span class="emphasis"><em>Underlying</em></span> represents the class of the underlying event.
					</p><p>
						For example, your statement may be:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from OrderEvent#time(30 sec)</pre><p>
						Your subscriber class exposes the method:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void update(OrderEvent[] insertStream, OrderEvent[] removeStream) {...}</pre></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="api-admin-subscriber-null"/>14.3.3.4.Â No-Parameter Update Method</h4></div></div></div><a id="d0e36888" class="indexterm"/><p>
					In the case that your subscriber object wishes to receive no data from a statement please follow the instructions here. 
				</p><p>
				  You EPL statement must select a single <code class="literal">null</code> value.
				</p><p>
					For example, your statement may be:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select null from OrderEvent(price &gt; 100)</pre><p>
					Your subscriber class exposes the method:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void update() {...}</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-admin-listeners"/>14.3.4.Â Adding Listeners</h3></div></div></div><a id="d0e36911" class="indexterm"/><a id="d0e36914" class="indexterm"/><p>
				For NEsper .NET also see <a class="xref" href="#appendix_dotnet_api_admin_listeners" title="I.15.Â .NET API - Adding Listeners">SectionÂ I.15, â.NET API - Adding Listenersâ</a>.
			</p><p>
				Your application can subscribe to updates posted by a statement via the <code class="literal">addListener</code> and <code class="literal">removeListener</code> methods on <code class="literal">EPStatement</code> . Your application must to provide an implementation of the <code class="literal">UpdateListener</code> or the <code class="literal">StatementAwareUpdateListener</code> interface to the statement:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">UpdateListener myListener = new MyUpdateListener();
countStmt.addListener(myListener);</pre><p>			
				EPL statements and event patterns publish old data and new data to registered <code class="literal">UpdateListener</code> listeners. 
				New data published by statements is the events representing the new values of derived data held by the statement.
				Old data published by statements constists of the events representing the prior values of derived data held by the statement.
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>
				  	<code class="literal">UpdateListener</code> listeners receive multiple result rows in one invocation by the engine: the new data and old data parameters to your listener are array parameters. For example, if your application uses one of the batch data windows, or your application creates a pattern that matches multiple times when a single event arrives, then the engine indicates such multiple result rows in one invocation and your new data array carries two or more rows.
				</p></div><p>			
				A second listener interface is the <code class="literal">StatementAwareUpdateListener</code> interface. A <code class="literal">StatementAwareUpdateListener</code> is especially useful for registering the same listener object with multiple statements, 
				as the listener receives the statement instance and engine instance in addition to new and old data when the engine indicates new results to a listener.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">StatementAwareUpdateListener myListener = new MyStmtAwareUpdateListener();
statement.addListener(myListener);</pre><p>			
				To indicate results the engine invokes this method on <code class="literal">StatementAwareUpdateListener</code> listeners: <code class="literal">update(EventBean[] newEvents, EventBean[] oldEvents, EPStatement statement, EPServiceProvider epServiceProvider)</code>
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="api-admin-listeners-replay"/>14.3.4.1.Â Subscription Snapshot and Atomic Delivery</h4></div></div></div><p>
					The <code class="literal">addListenerWithReplay</code> method provided by <code class="literal">EPStatement</code> makes it possible to send a snapshot of current statement results to a listener when the listener is added.
				</p><p>
					When using the <code class="literal">addListenerWithReplay</code> method to register a listener, the listener receives current statement results as the first call to the update method of the listener, passing in the newEvents parameter the current statement results as an array of zero or more events. Subsequent calls to the update method of the listener are statement results.   
				</p><p>
					Current statement results are the events returned by the <code class="literal">iterator</code> or <code class="literal">safeIterator</code> methods.
				</p><p>
					Delivery is atomic: Events occurring during delivery of current results to the listener are guaranteed to be delivered in a separate call and not lost. The listener implementation should thus minimize long-running or blocking operations to reduce lock times held on statement-level resources.
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-admin-iterators"/>14.3.5.Â Using Iterators</h3></div></div></div><a id="d0e36998" class="indexterm"/><a id="d0e37001" class="indexterm"/><a id="d0e37004" class="indexterm"/><p>
				Subscribing to events posted by a statement is following a push model. The engine pushes data to listeners when events are received that cause data to change or patterns to match. Alternatively, you need to know that statements serve up data that your application can obtain via the <code class="literal">safeIterator</code> and <code class="literal">iterator</code> methods on <code class="literal">EPStatement</code>. This is called the pull API and can come in handy if your application is not interested in all new updates, and only needs to perform a frequent or infrequent poll for the latest data. 
			</p><p>
				The <code class="literal">safeIterator</code> method on <code class="literal">EPStatement</code> returns a concurrency-safe iterator returning current statement results, even while concurrent threads may send events into the engine for processing. The engine employs a read-write lock per context partition and obtains a read lock for iteration. Thus safe iterator guarantees correct results even as events are being processed by other threads and other context partitions. The cost is that the iterator obtains and holds zero, one or multiple context partition locks for that statement that must be released via the <code class="literal">close</code> method on the <code class="literal">SafeIterator</code> instance. 
			</p><p>
				The <code class="literal">iterator</code> method on <code class="literal">EPStatement</code> returns a concurrency-unsafe iterator. This iterator is only useful for applications that are single-threaded, or applications that themselves perform coordination between the iterating thread and the  threads that send events into the engine for processing. The advantage to this iterator is that it does not hold a lock.
			</p><p>
			  When statements are used with contexts and context partitions, the APIs to identify, filter and select context partitions for statement iteration are described in <a class="xref" href="#api-contextpartitionselection" title="14.18.Â Context Partition Selection">SectionÂ 14.18, âContext Partition Selectionâ</a>.
			</p><p>
				The next code snippet shows a short example of use of safe iterators:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPStatement statement = epAdmin.createEPL("select avg(price) as avgPrice from MyTick");
// .. send events into the engine
// then use the pull API...
SafeIterator&lt;EventBean&gt; safeIter = statement.safeIterator();
try {
  for (;safeIter.hasNext();) {
     // .. process event ..
     EventBean event = safeIter.next();
     System.out.println("avg:" + event.get("avgPrice");
  }
}
finally {
  safeIter.close();	// Note: safe iterators must be closed
}</pre><p>
				This is a short example of use of the regular iterator that is not safe for concurrent event processing:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">double averagePrice = (Double) eplStatement.iterator().next().get("average");</pre><p>
				The <code class="literal">safeIterator</code> and <code class="literal">iterator</code> methods can be used to pull results out of all statements, including statements that join streams, contain aggregation functions, pattern statements, and statements that contain a <code class="literal">where</code> clause, <code class="literal">group by</code> clause, <code class="literal">having</code> clause or <code class="literal">order by</code> clause.
			</p><p>
				For statements without an <code class="literal">order by</code> clause, the <code class="literal">iterator</code> method returns events in the order maintained by the data window. For statements that contain an <code class="literal">order by</code> clause, the <code class="literal">iterator</code> method returns events in the order indicated by the <code class="literal">order by</code> clause.
			</p><p>
				Consider using the <code class="literal">on-select</code> clause and a named window if your application requires iterating over a partial result set or requires indexed access for fast iteration; Note that <code class="literal">on-select</code> requires that you sent a trigger event, which may contain the key values for indexed access.
			</p><p>
				Esper places the following restrictions on the pull API and usage of the <code class="literal">safeIterator</code> and <code class="literal">iterator</code> methods:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						In multithreaded applications, use the <code class="literal">safeIterator</code> method. Note: make sure your application closes the iterator via the <code class="literal">close</code> method when done, otherwise the iterated statement context partitions stay locked and event processing for statement context partitions does not resume.
					</p></li><li><p>
						In multithreaded applications, the <code class="literal">iterator</code> method does not hold any locks. The iterator returned by this method does not make any guarantees towards correctness of results and fail-behavior, if your application processes events into the engine instance by multiple threads. Use the <code class="literal">safeIterator</code> method for concurrency-safe iteration instead.
					</p></li><li><p>
						Since the <code class="literal">safeIterator</code> and <code class="literal">iterator</code> methods return events to the application immediately, the iterator does not honor an output rate limiting clause, if present. That is, the iterator returns results as if there is no output-rate clause for the statement in statements without grouping or aggregation. For statements with grouping or aggregation, the iterator in combintion with an output clause returns last output group and aggregation results. Use a separate statement and the <code class="literal">insert into</code> clause to control the output rate for iteration, if so required.
					</p></li><li><p>
						When iterating a statement that operates on an unbound stream (no data window declared), please note the following:
					</p><div class="itemizedlist"><ul compact="compact"><li><p>
								When iterating a statement that groups and aggregates values from an unbound stream and that specifies <code class="literal">output snapshot</code>, the engine retains groups and aggregations for output as iteration results or upon the output snapshot condition .
							</p></li><li><p>
								When iterating a statement that groups and aggregates values from an unbound stream and that does not specify <code class="literal">output snapshot</code>, the engine only retains the last aggregation values and the iterated result contains only the last updated group.
							</p></li><li><p>
								When iterating a statement that operates on an unbound stream the iterator returns no rows. This behavior can be changed by specifying either the <code class="literal">@IterableUnbound</code> annotation or by changing the global view resources configuration.
							</p></li></ul></div></li></ol></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-admin-mgmt-stmt"/>14.3.6.Â Managing Statements</h3></div></div></div><p>
				The <code class="literal">EPAdministrator</code> interface provides the facilities for managing statements:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						Use the <code class="literal">getStatement</code> method to obtain an existing started or stopped statement by name
					</p></li><li><p>
						Use the <code class="literal">getStatementNames</code> methods to obtain a list of started and stopped statement names
					</p></li><li><p>
						Use the <code class="literal">startAllStatements</code>, <code class="literal">stopAllStatements</code> and <code class="literal">destroyAllStatements</code> methods to manage all statements in one operation
					</p></li></ul></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-admin-atomic"/>14.3.7.Â Atomic Statement Management</h3></div></div></div><p>
				Your application can concurrently send events into the engine while performing statement or module management. Therefore it is safe to stop and start statements or 
				un-deploy and deploy modules while sending in events from other threads concurrently. 
			</p><p>
				Your application can use the API described below to obtain a lock and perform statement or module management as an atomic unit. 
				For example, if your application would like to un-deploy and re-deploy all statements or modules as a single administrative unit, while at the same time sending events into the engine from different threads,
				it can obtain a lock to ensure that no events are concurrently processed while the statement or module management operations take place.
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
					Deploying or un-deploying a single module is already an atomic operation by default and does not require taking an explicit lock.
					Please see <a class="xref" href="#devlifecycle-admin" title="16.6.Â The Deployment Administrative Interface">SectionÂ 16.6, âThe Deployment Administrative Interfaceâ</a> for the deployment API.
					If your application would like to deploy multiple modules and/or statements as a unit, please obtain a lock as discussed below.
				</p></div><p>
				The below code sample obtains the engine exclusive write lock to perform multiple management operations as a unit, excluding concurrent processing of events.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epService.getEngineInstanceWideLock().writeLock().lock();
// Start atomic management unit. 
// Any events concurrently being processed by other threads must complete before the code completes obtaining the lock. 
// Any events sent in by other threads will await the release of the lock.
try {
  // Perform operations such as : 
  //   - start statements, destroy statements, stop statements
  //   - un-deploy multiple modules, deploy multiple modules (deployment admin API)
  // There is no need to obtain this lock when deploying or un-deploying a single module.
  // The lock is reentrant and can be safely taken multiple times by the same thread.
  // Make sure you use "try" and "finally" just like we have it here.
}
finally {
  // Complete atomic management unit. 
  // Any events sent in by other threads will now continue processing against the changed set of statements.
  epService.getEngineInstanceWideLock().writeLock().unlock();
}</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
					There should always be a <code class="literal">finally</code> block in your code to ensure the lock is released in all cases.
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-admin-runtime-config"/>14.3.8.Â Runtime Configuration</h3></div></div></div><a id="d0e37216" class="indexterm"/><p>
				Certain configuration changes are available to perform on an engine instance while in operation. Such configuration operations are available via the <code class="literal">getConfiguration</code> method on <code class="literal">EPAdministrator</code>,
				which returns a <code class="literal">ConfigurationOperations</code> object.
			</p><p>
				Please consult the JavaDoc of <code class="literal">ConfigurationOperations</code> for further information. The section <a class="xref" href="#configuration-runtime" title="15.6.Â Runtime Configuration">SectionÂ 15.6, âRuntime Configurationâ</a> provides a summary of available configurations.
			</p><p>
				In summary, the configuration operations available on a running engine instance are as follows:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						Add new event types for all event representations, check if an event type exists, update an existing event type, remove an event type, query a list of types and obtain a type by name.
					</p></li><li><p>
						Add and remove variables (get and set variable values is done via the runtime API).
					</p></li><li><p>
						Add a variant stream.
					</p></li><li><p>
						Add a revision event type.
					</p></li><li><p>
						Add event types for all event classes in a given Java package, using the simple class name as the event name.
					</p></li><li><p>
						Add import for user-defined functions.
					</p></li><li><p>
						Add a plug-in aggregation function, plug-in single row function, plug-in event type, plug-in event type resolution URIs.
					</p></li><li><p>
						Control metrics reporting.
					</p></li><li><p>
						Additional items please see the <code class="literal">ConfigurationOperations</code> interface.
					</p></li></ul></div><p>
				For examples of above runtime configuration API functions please consider the Configuration chapter, which applies to both static configuration and runtime configuration as the <code class="literal">ConfigurationOperations</code> interface is the same.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-runtime"/>14.4.Â The Runtime Interface</h2></div></div></div><a id="d0e37280" class="indexterm"/><p>
			The <code class="literal">EPRuntime</code> interface is used to send events for processing into an Esper engine, set and get variable values and execute on-demand queries.
        </p><p>
			The below code snippet shows how to send a Java object event to the engine. Note that the <code class="literal">sendEvent</code> method is overloaded. As events can take on different representation classes in Java, the <code class="literal">sendEvent</code> takes parameters to reflect the different 
			types of events that can be send into the engine. The <a class="xref" href="#event_representation" title="ChapterÂ 3.Â Event Representations">ChapterÂ 3, <i>Event Representations</i></a> section explains the types of events 
			accepted.
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPServiceProvider epService = EPServiceProviderManager.getDefaultProvider();
EPRuntime runtime = epService.getEPRuntime();

// Send an example event containing stock market data
runtime.sendEvent(new MarketDataBean('IBM', 75.0));		
</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>
				Events, in theoretical terms, are observations of a state change that occurred in the past. Since you cannot change an event that happened in the past, events are best modelled as immutable objects. 
			</p></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="caution"><h2>Caution</h2><p>
				The engine relies on events that are sent into an engine to not change their state. Typically, applications create a new event object for every new event, to represent that new event. Application should not modify an existing event that was sent into the engine.
			</p></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>
				Another important method in the runtime interface is the <code class="literal">route</code> method. This method is designed for use by <code class="literal">UpdateListener</code> and 
				subscriber implementations as well as engine extensions that need to send events into an engine instance to avoid the possibility of a stack overflow due to nested calls 
				to <code class="literal">sendEvent</code> and to ensure correct processing of the current and routed event.
				Note that if outbound-threading is enabled, listeners and subscribers should use <code class="literal">sendEvent</code> and not <code class="literal">route</code>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-runtime-eventsender"/>14.4.1.Â Event Sender</h3></div></div></div><p>
				The <code class="literal">EventSender</code> interface processes event objects that are of a known type. This facility can reduce the overhead of event object reflection and type lookup as an event sender
				is always associated to a single concrete event type.
			</p><p>
				Use the method <code class="literal">getEventSender(String eventTypeName) </code> to obtain an event sender for processing events of the named type:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EventSender sender = epService.getEPRuntime().getEventSender("MyEvent");
sender.sendEvent(myEvent);</pre><p>
				For events backed by a Java class (JavaBean events), the event sender ensures that the event object equals the underlying class, or implements or extends the underlying class
				for the given event type name.
			</p><p>
				For events backed by a <code class="literal">java.util.Map</code> (Map events), the event sender does not perform any checking other than checking that the event object implements Map.
			</p><p>
				For events backed by a <code class="literal">Object[]</code> (Object-array events), the event sender does not perform any checking other than checking that the event object implements Object[]. The array elements must be in the exact same order of properties as declared and array length must always be at least the number of properties declared.
			</p><p>
				For events backed by a Apache Avro <code class="literal">GenericData.Record</code>, the event sender does not perform any checking other than checking that the event object is a GenericData.Record. The schema associated to the record should match the event type's Avro schema.
			</p><p>
				For events backed by a org.w3c.Node (XML DOM events), the event sender checks that the root element name equals the root element name for the event type.
			</p><p>
				A second method to obtain an event sender is the method <code class="literal">getEventSender(URI[])</code>, which takes an array of URIs. This method is for use with plug-in event representations.
				The event sender returned by this method processes event objects that are of one of the types of one or more plug-in event representations. Please consult <a class="xref" href="#custom-event-representation" title="17.8.Â Event Type and Event Object">SectionÂ 17.8, âEvent Type and Event Objectâ</a> for more information.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-runtime-unmatched"/>14.4.2.Â Receiving Unmatched Events</h3></div></div></div><a id="d0e37368" class="indexterm"/><p>
				Your application can register an implementation of the <code class="literal">UnmatchedListener</code> interface with the <code class="literal">EPRuntime</code> runtime via the <code class="literal">setUnmatchedListener</code> method to receive events that were not matched by any statement.
			</p><p>
				 Events that can be unmatched are all events that your application sends into the runtime via one of the <code class="literal">sendEvent</code> or <code class="literal">route</code> methods, or that have been generated via an <code class="literal">insert into</code> clause.
			</p><p>
				For an event to become unmatched by any statement, the event must not match any statement's event stream filter criteria. Note that the EPL  <code class="literal">where</code> clause or <code class="literal">having</code> clause are not considered part of the filter criteria for a stream, as explained by example below.
			</p><p>
				In the following statement a MyEvent event with a 'quantity' property value of 5 or less does not match this statement's event stream filter criteria. The engine delivers such an event to the registered <code class="literal">UnmatchedListener</code> instance provided no other statement matches on the event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent(quantity &gt; 5)</pre><p>
				 For patterns, if no pattern sub-expression is active for an event type, an event of that type also counts as unmatched in regards to the pattern statement.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-ondemand"/>14.5.Â On-Demand Fire-and-Forget Query Execution</h2></div></div></div><p>
			As your application may not require streaming results and may not know each query in advance, the on-demand query facility provides for ad-hoc execution of an EPL expression.
		</p><p>
			On-demand queries are not continuous in nature: The query engine executes the query once and returns all result rows to the application. On-demand query execution is very lightweight as the engine performs no statement creation and the query leaves no traces within the engine.
		</p><p>
			Esper provides the facility to explicitly index named windows and tables to speed up on-demand and continuous queries. Please consult <a class="xref" href="#named_explicit_index" title="6.9.Â Explicitly Indexing Named Windows and Tables">SectionÂ 6.9, âExplicitly Indexing Named Windows and Tablesâ</a> for more information.
		</p><p>
		  When named windows and tables are used with contexts and context partitions, the APIs to identify, filter and select context partitions for on-demand queries can be found in <a class="xref" href="#api-contextpartitionselection" title="14.18.Â Context Partition Selection">SectionÂ 14.18, âContext Partition Selectionâ</a>.
		</p><p>
			The <code class="literal">EPRuntime</code> interface provides three ways to run on-demand queries:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					Use the <code class="literal">executeQuery</code> method to executes a given on-demand query exactly once, see <a class="xref" href="#api-ondemand-single" title="14.5.1.Â On-Demand Query Single Execution">SectionÂ 14.5.1, âOn-Demand Query Single Executionâ</a>.
				</p></li><li><p>
					Use the <code class="literal">prepareQuery</code> method to prepare a given on-demand query such that the same query can be executed multiple times without repeated parsing, see <a class="xref" href="#api-ondemand-prepared" title="14.5.2.Â On-Demand Query Prepared Unparameterized Execution">SectionÂ 14.5.2, âOn-Demand Query Prepared Unparameterized Executionâ</a>.
				</p></li><li><p>
					Use the <code class="literal">prepareQueryWithParameters</code> method to prepare a given on-demand query that may have substitution parameters such that the same query can be parameterized and executed multiple times without repeated parsing, see <a class="xref" href="#api-ondemand-preparedparameterized" title="14.5.3.Â On-Demand Query Prepared Parameterized Execution">SectionÂ 14.5.3, âOn-Demand Query Prepared Parameterized Executionâ</a>
				</p></li></ol></div><p>
		  If your application must execute the same EPL on-demand query multiple times with different parameters use <code class="literal">prepareQueryWithParameters</code>. 
		</p><p>
		  If your application must execute the same EPL on-demand query multiple times without use either <code class="literal">prepareQuery</code> or <code class="literal">prepareQueryWithParameters</code> and specify no substitution parameters.
		</p><p>
		  By using any of the <code class="literal">prepare...</code> methods the engine can compile an EPL query string or object model once and reuse the object and thereby speed up repeated execution.
		</p><p>
			The following limitations apply:
		</p><div class="itemizedlist"><ul><li><p>
					An on-demand EPL expression only evaluates against the named windows and tables that your application creates. On-demand queries may not specify any other streams or application event types.
				</p></li><li><p>
					The following clauses are not allowed in on-demand EPL: <code class="literal">insert into</code> and <code class="literal">output</code>.
				</p></li><li><p>
					Data windows and patterns are not allowed to appear in on-demand queries.
				</p></li><li><p>
					On-demand EPL may not perform subqueries.
				</p></li><li><p>
					The <code class="literal">previous</code> and <code class="literal">prior</code> functions may not be used.
				</p></li></ul></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-ondemand-single"/>14.5.1.Â On-Demand Query Single Execution</h3></div></div></div><p>
			  Use the <code class="literal">executeQuery</code> method for executing an on-demand query once. For repeated execution, please consider any of the <code class="literal">prepare...</code> methods instead.
			</p><p>
				The next program listing runs an on-demand query against a named window <code class="literal">MyNamedWindow</code> and prints a column of each row result of the query:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String query = "select * from MyNamedWindow";
EPOnDemandQueryResult result = epRuntime.executeQuery(query);
for (EventBean row : result.getArray()) {
  System.out.println("name=" + row.get("name"));
}</pre><p>
				For executing an on-demand query against a table please put the table name into the <code class="literal">from</code>-clause instead.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-ondemand-prepared"/>14.5.2.Â On-Demand Query Prepared Unparameterized Execution</h3></div></div></div><p>
				Prepared on-demand queries are designed for repeated execution and may perform better then the dynamic single-execution method if running the same query multiple times. 
				For use with parameter placeholders please see <a class="xref" href="#api-ondemand-preparedparameterized" title="14.5.3.Â On-Demand Query Prepared Parameterized Execution">SectionÂ 14.5.3, âOn-Demand Query Prepared Parameterized Executionâ</a>.
			</p><p>
				The next code snippet demonstrates prepared on-demand queries without parameter placeholder:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String query = "select * from MyNamedWindow where orderId = '123'"
EPOnDemandPreparedQuery prepared = epRuntime.prepareQuery(query);
EPOnDemandQueryResult result = prepared.execute();

// ...later on execute once more ...
prepared.execute();	// execute a second time</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-ondemand-preparedparameterized"/>14.5.3.Â On-Demand Query Prepared Parameterized Execution</h3></div></div></div><p>
				You can insert substitution parameters into an on-demand query as a single question mark character <code class="literal">'?'</code>, making the substitution parameter addressable by index.
			</p><p>
				You can also insert substitution parameters using the following syntax, which makes the substitution parameter addressable by name:
			</p><pre class="synopsis">?:<span class="emphasis"><em>name</em></span></pre><p>
				If substitution parameters do not have a name assigned, the engine assigns the first substitution parameter an index of 1 and subsequent parameters increment the index by one.
				Please see <a class="xref" href="#api-prepared" title="14.13.Â Prepared Statement and Substitution Parameters">SectionÂ 14.13, âPrepared Statement and Substitution Parametersâ</a>  for additional detail and examples.
			</p><p>
				Substitution parameters can be inserted into any EPL construct that takes an expression. 
			</p><p>
				All substitution parameters must be replaced by actual values before an on-demand query with substitution parameters can be executed. Substitution parameters can be replaced with an actual value using the <code class="literal">setObject</code> method for each index or name. Substitution parameters can be set to new values and the query executed more than once.
			</p><p>
				While the <code class="literal">setObject</code> method allows substitution parameters to assume any actual value including application Java objects or enumeration values, the application must provide the correct type of substitution parameter that matches the requirements of the expression the parameter resides in.
			</p><p>
				The next program listing runs a prepared and parameterized on-demand query against a named window <code class="literal">MyNamedWindow</code> (this example does not assign names to substitution parameters):
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String query = "select * from MyNamedWindow where orderId = ?";
EPOnDemandPreparedQueryParameterized prepared = epRuntime.prepareQueryWithParameters(query);

// Set the required parameter values before each execution
prepared.setObject(1, "123");
result = epRuntime.executeQuery(prepared);

// ...execute a second time with new parameter values...
prepared.setObject(1, "456");
result = epRuntime.executeQuery(prepared);</pre><p>
			  This second example uses the <code class="literal">in</code> operator and has multiple parameters:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String query = "select * from MyNamedWindow where orderId in (?) and price &gt; ?";
EPOnDemandPreparedQueryParameterized prepared = epRuntime.prepareQueryWithParameters(query);
prepared.setObject(1, new String[] {"123", "456"});
prepared.setObject(2, 1000.0});</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-event"/>14.6.Â Event and Event Type</h2></div></div></div><a id="d0e37584" class="indexterm"/><a id="d0e37587" class="indexterm"/><p>
			An <code class="literal">EventBean</code> object represents a row (event) in your continuous query's result set. Each <code class="literal">EventBean</code> object has an associated <code class="literal">EventType</code> object providing event metadata.
        </p><p>
			An <code class="literal">UpdateListener</code> implementation receives one or more <code class="literal">EventBean</code> events with each invocation. Via the <code class="literal">iterator</code> method on <code class="literal">EPStatement</code> your application can poll or read data out of statements. Statement iterators also return <code class="literal">EventBean</code> instances.
        </p><p>
			Each statement provides the event type of the events it produces, available via the <code class="literal">getEventType</code> method on <code class="literal">EPStatement</code>.
        </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-eventtype"/>14.6.1.Â Event Type Metadata</h3></div></div></div><p>
				An <code class="literal">EventType</code> object encapsulates all the metadata about a certain type of events. As Esper supports an inheritance hierarchy for event types, it also provides information about super-types to an event type.
			</p><p>
				An <code class="literal">EventType</code> object provides the following information:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						For each event property, it lists the property name and type as well as flags for indexed or mapped properties and whether a property is a fragment.
					</p></li><li><p>
						The direct and indirect super-types to the event type.
					</p></li><li><p>
						Value getters for property expressions.
					</p></li><li><p>
						Underlying class of the event representation.
					</p></li></ul></div><p>
				For each property of an event type, there is an <code class="literal">EventPropertyDescriptor</code> object that describes the property.
				The <code class="literal">EventPropertyDescriptor</code> contains flags that indicate whether a property is an indexed (array) or a mapped property and whether access to property values require an integer index value (indexed properties only) or string key value (mapped properties only). The descriptor also contains a fragment flag that indicates whether a property value is available as a fragment.
			</p><p>
				The term <span class="emphasis"><em>fragment</em></span> means an event property value that is itself an event, or a property value that can be represented as an event. The <code class="literal">getFragmentType</code> on <code class="literal">EventType</code> may be used to determine a fragment's event type in advance. 
			</p><p>
				A fragment event type and thereby fragment events allow navigation over a statement's results even if the statement result contains nested events or a graph of events. There is no need to use the Java reflection API to navigate events, 
				since fragments allow the querying of nested event properties or array values, including nested Java classes.
			</p><p>
				When using the Map or Object-array event representation, any named Map type or Object-array type nested within a Map or Object-array as a simple or array property is also available as a fragment. When using Java objects either directly or within Map or Object-array events, any object that is neither a primitive or boxed built-in type, and that is not an enumeration and does not implement the Map interface is also available as a fragment.
			</p><p>
				The nested, indexed and mapped property syntax can be combined to a property expression that may query an event property graph. Most of the methods on the <code class="literal">EventType</code> interface allow a property expression to be passed.
			</p><p>
				Your application may use an <code class="literal">EventType</code> object to obtain special getter-objects. A getter-object is a fast accessor to a property value of an event of a given type. All getter objects implement the <code class="literal">EventPropertyGetter</code> interface.  Getter-objects work only for events of the same type or sub-types as the <code class="literal">EventType</code> that provides the <code class="literal">EventPropertyGetter</code>. The performance section provides additional information and samples on using getter-objects.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-eventbean"/>14.6.2.Â Event Object</h3></div></div></div><p>
				An event object is an <code class="literal">EventBean</code> that provides:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						The property value for a property given a property name or property expression that may include nested, indexed or mapped properties in any combination.
					</p></li><li><p>
						The event type of the event.
					</p></li><li><p>
						Access to the underlying event object.
					</p></li><li><p>
						The <code class="literal">EventBean</code> fragment or array of <code class="literal">EventBean</code> fragments given a property name or property expression.
					</p></li></ul></div><p>
				The <code class="literal">getFragment</code> method on <code class="literal">EventBean</code> and <code class="literal">EventPropertyGetter</code> return the fragment <code class="literal">EventBean</code> or array of <code class="literal">EventBean</code>, if the property is itself an event
				or can be represented as an event. Your application may use <code class="literal">EventPropertyDescriptor</code> to determine which properties are also available as fragments.
			</p><p>
				The underlying event object of an <code class="literal">EventBean</code> can be obtained via the <code class="literal">getUnderlying</code> method. Please see <a class="xref" href="#event_representation" title="ChapterÂ 3.Â Event Representations">ChapterÂ 3, <i>Event Representations</i></a>  for more information on different event representations.
			</p><p>
				From a threading perspective, it is safe to retain and query <code class="literal">EventBean</code> and <code class="literal">EventType</code> objects in multiple threads.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-eventtype-query"/>14.6.3.Â Query Example</h3></div></div></div><p>
				Consider a statement that returns the symbol, count of events per symbol and average price per symbol for tick events. Our sample statement may declare a fully-qualified Java class name as the event type: <code class="literal">org.sample.StockTickEvent</code>. Assume that this class exists and exposes a <code class="literal">symbol</code> property of type String, and a <code class="literal">price</code> property of type (Java primitive) double.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, avg(price) as avgprice, count(*) as mycount 
from org.sample.StockTickEvent 
group by symbol</pre><p>
				The next table summarizes the property names and types as posted by the statement above:
			</p><div class="table"><a id="d0e37777"/><p class="title"><b>TableÂ 14.3.Â Properties Offered by Sample Statement Aggregating Price</b></p><div class="table-contents"><table summary="Properties Offered by Sample Statement Aggregating Price" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Java code snippet</th></tr></thead><tbody><tr><td><code class="literal">symbol</code></td><td>java.lang.String</td><td>Value of symbol event property</td><td><pre class="synopsis">eventBean.get("symbol")</pre></td></tr><tr><td><code class="literal">avgprice</code></td><td>java.lang.Double</td><td>Average price per symbol</td><td><pre class="synopsis">eventBean.get("avgprice")</pre></td></tr><tr><td><code class="literal">mycount</code></td><td>java.lang.Long</td><td>Number of events per symbol</td><td><pre class="synopsis">eventBean.get("mycount")</pre></td></tr></tbody></table></div></div><br class="table-break"/><p>
				A code snippet out of a possible <code class="literal">UpdateListener</code> implementation to this statement may look as below:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String symbol = (String) newEvents[0].get("symbol");
Double price= (Double) newEvents[0].get("avgprice");
Long count= (Long) newEvents[0].get("mycount");</pre><p>
				The engine supplies the boxed <code class="literal">java.lang.Double</code> and <code class="literal">java.lang.Long</code> types as property values rather than primitive Java types. This is because aggregated values can return a <code class="literal">null</code> value to indicate that no data is available for aggregation. Also, in a select statement that computes expressions, the underlying event objects to <code class="literal">EventBean</code> instances are either of type <code class="literal">Object[]</code> (object-array) or of type <code class="literal">java.util.Map</code>. 
			</p><p>
			  Use <code class="literal">statement.getEventType().getUnderlyingType()</code> to inspect the underlying type for all events delivered to listeners. Whether the engine delivers Map or Object-array events to listeners can be specified as follows. If the statement provides the <code class="literal">@EventRepresentation(objectarray)</code> annotation the engine delivers the output events as object array. If the statement provides the <code class="literal">@EventRepresentation(map)</code> annotation the engine delivers output events as a Map. If neither annotation is provided, the engine delivers the configured default event representation as discussed in <a class="xref" href="#config-engine-eventmeta-representation" title="15.4.14.1.Â Default Event Representation">SectionÂ 15.4.14.1, âDefault Event Representationâ</a>.
			</p><p>
				Consider the next statement that specifies a wildcard selecting the same type of event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from org.sample.StockTickEvent where price &gt; 100</pre><p>
				The property names and types provided by an <code class="literal">EventBean</code> query result row, as posted by the statement above are as follows:
			</p><div class="table"><a id="d0e37878"/><p class="title"><b>TableÂ 14.4.Â Properties Offered by Sample Wildcard-Select Statement</b></p><div class="table-contents"><table summary="Properties Offered by Sample Wildcard-Select Statement" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Java code snippet</th></tr></thead><tbody><tr><td><code class="literal">symbol</code></td><td>java.lang.String</td><td>Value of symbol event property</td><td><pre class="synopsis">eventBean.get("symbol")</pre></td></tr><tr><td><code class="literal">price</code></td><td>double</td><td>Value of price event property</td><td><pre class="synopsis">eventBean.get("price")</pre></td></tr></tbody></table></div></div><br class="table-break"/><p>
				As an alternative to querying individual event properties via the <code class="literal">get</code> methods, the <code class="literal">getUnderlying</code> method on <code class="literal">EventBean</code> returns the underlying object representing the query result.
				In the sample statement that features a wildcard-select, the underlying event object is of type <code class="literal">org.sample.StockTickEvent</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">StockTickEvent tick = (StockTickEvent) newEvents[0].getUnderlying();</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-eventtype-pattern"/>14.6.4.Â Pattern Example</h3></div></div></div><p>
				Composite events are events that aggregate one or more other events. Composite events are typically created by the engine for statements that join two event streams, and for event patterns in which the causal events are retained and reported in a composite event. The example below shows such an event pattern.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Look for a pattern where BEvent follows AEvent
String pattern = "a=AEvent -&gt; b=BEvent";
EPStatement stmt = epService.getEPAdministrator().createPattern(pattern);
stmt.addListener(testListener);
</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Example listener code
public class MyUpdateListener implements UpdateListener {
  public void update(EventBean[] newData, EventBean[] oldData) {
    System.out.println("a event=" + newData[0].get("a"));
    System.out.println("b event=" + newData[0].get("b"));
  }
}</pre><p>
				Note that the <code class="literal">update</code> method can receive multiple events at once as it accepts an array of <code class="literal">EventBean</code> instances. For example, a time batch window may post multiple events to listeners representing a batch of events received during a given time period. 
			</p><p>
				Pattern statements can also produce multiple events delivered to update listeners in one invocation. The pattern statement below, for instance, delivers an event for each A event that was not followed by a B event with the same <code class="literal">id</code> property within 60 seconds of the A event. The engine may deliver all matching A events as an array of events in a single invocation of the <code class="literal">update</code> method of each listener to the statement:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern[
  every a=A -&gt; (timer:interval(60 sec) and not B(id=a.id))]</pre><p>
				A code snippet out of a possible <code class="literal">UpdateListener</code> implementation to this statement that retrives the events as fragments may look as below:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EventBean a = (EventBean) newEvents[0].getFragment("a");
// ... or using a nested property expression to get a value out of A event...
double value = (Double) newEvent[0].get("a.value");</pre><p>
				Some pattern objects return an array of events. An example is the unbound repeat operator. Here is a sample pattern that collects all A events until a B event arrives:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern [a=A until b=B]</pre><p>
				A possible code to retrieve different fragments or property values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EventBean[] a = (EventBean[]) newEvents[0].getFragment("a");
// ... or using a nested property expression to get a value out of A event...
double value = (Double) newEvent[0].get("a[0].value");</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-threading"/>14.7.Â Engine Threading and Concurrency</h2></div></div></div><a id="d0e37980" class="indexterm"/><p>
			For NEsper .NET also see <a class="xref" href="#appendix_dotnet_api_threading" title="I.16.Â .NET API - Engine Threading and Concurrency">SectionÂ I.16, â.NET API - Engine Threading and Concurrencyâ</a>.
		</p><p>
			Esper is designed from the ground up to operate as a component to multi-threaded, highly-concurrent applications that require efficient use of Java VM resources. In addition, multi-threaded execution requires guarantees in predictability of results and deterministic processing. This section discusses these concerns in detail. 
        </p><p>
In Esper, an engine instance is a unit of separation. Applications can obtain and discard (initialize) one or more engine instances within the same Java VM and can provide the same or different engine configurations to each instance. An engine instance can shares resources between statements by means of named windows, tables and variables.
        </p><p>
			Applications can use Esper APIs to concurrently, by multiple threads of execution, perform such functions as creating and 
managing statements, or sending events into an engine instance for processing. Applications can use application-managed threads or thread pools or any set of same or different threads of execution with any of the public Esper APIs. There are no restrictions towards threading other than those noted in specific sections of this document. 
        </p><p>
Esper does not prescribe a specific threading model. Applications using Esper retain full control over threading, allowing an engine to be easily embedded and used as a component or library in your favorite Java container or process.
        </p><p>
In the default configuration it is up to the application code to use multiple threads for processing events by the engine, if so desired. All event processing takes places within your application thread call stack. The exception is timer-based processing if your engine instance relies on the internal timer (default). If your application relies on external timer events instead of the internal timer then there need not be any Esper-managed internal threads.
        </p><p>
The fact that event processing can take place within your application thread's call stack makes developing applications with Esper easier: Any common Java integrated development environment (IDE) can host an Esper engine instance. This allows developers to easily set up test cases, debug through listener code and inspect input or output events, or trace their call stack.
        </p><p>
In the default configuration, each engine instance maintains a single timer thread (internal timer) providing for time or schedule-based processing within the engine. The default resolution at which the internal timer operates is 100 milliseconds. The internal timer thread can be disabled and applications can instead send external time events to an engine instance to perform timer or scheduled processing at the resolution required by an application.
        </p><p>
Each engine instance performs minimal locking to enable high levels of concurrency. An engine instance locks on the combination of query and context partition to protect context partition resources. For example, two queries with three partitions each have a total of six locks. For stateless EPL select-statements the engine does not use a context-partition lock and operates lock-free for the context partition. For stateful statements, the maximum (theoretical) degree of parallelism is 2^31-1 (2,147,483,647) parallel threads working to process a single EPL statement under a hash segmented context.
        </p><p>
			For named windows and tables, <code class="literal">on-select</code>, <code class="literal">on-merge</code>, <code class="literal">on-update</code> and <code class="literal">on-delete</code> all execute under the same lock as the partition of the named window or table.
			Any <code class="literal">insert into</code> produces a new event for the work queue and does not lock the target of the insert-into.
        </p><p>
You may turn off context partition locking engine-wide (also read the caution notice) as described in <a class="xref" href="#config-engine-execution-disablelock" title="15.4.27.3.Â Disable Locking">SectionÂ 15.4.27.3, âDisable Lockingâ</a>. You may disable context partition locking for a given statement by providing the <code class="literal">@NoLock</code> annotation as part of your EPL. Note, Esper provides the <code class="literal">@NoLock</code> annotation for the purpose of identifying locking overhead, or when your application is single-threaded, or when using an external mechanism for concurrency control or for example with virtual data windows or plug-in data windows to allow customizing concurrency for a given statement or named window. Using this annotation may have unpredictable results unless your application is taking concurrency under consideration.
        </p><p>
For an engine instance to produce predictable results from the viewpoint of listeners to statements, an engine instance by default ensures that 
it dispatches statement result events to listeners in the order in which a statement produced result events. Applications that require the highest possible concurrency and do not require predictable order of delivery of events to listeners, this feature can be turned off via configuration, see
<a class="xref" href="#config-engine-threading-dispatch" title="15.4.13.1.Â Preserving the Order of Events Delivered to Listeners">SectionÂ 15.4.13.1, âPreserving the Order of Events Delivered to Listenersâ</a>. For example, assume thread T1 processes an event applied to statement S producing output event O1. Assume thread T2 processes another event applied to statement S and produces output event O2.  The engine employs a configurable latch system to ensure that listeners to statement S receive and may complete processing of O1 before receiving O2. When using outbound threading (advanced threading options) or changing the configuration this guarantee is weakened or removed.
        </p><p>
In multithreaded environments, when one or more statements make result events available via the <code class="literal">insert into</code> clause to further statements, the engine preserves the order of events inserted into the generated insert-into stream, allowing statements that consume other statement's events to behave deterministic. This feature can also be turned off via configuration, see , see <a class="xref" href="#config-engine-threading-insert-into" title="15.4.13.2.Â Preserving the Order of Events for Insert-Into Streams">SectionÂ 15.4.13.2, âPreserving the Order of Events for Insert-Into Streamsâ</a>. For example, assume thread T1 processes an event applied to statement S and thread T2 processes another event applied to statement S.  Assume statement S inserts into into stream ST. T1 produces an output event O1 for processing by consumers of ST1 and T2 produces an output event O2 for processing by consumers of ST. The engine employs a configurable latch system such that O1 is processed before O2 by consumers of ST. When using route execution threading (advanced threading options) or changing the configuration this guarantee is weakened or removed.
        </p><p>
We generally recommended that listener implementations block minimally or do not block at all. By implementing listener code as non-blocking code execution threads can often achieve higher levels of concurrency.
        </p><p>
We recommended that, when using a single listener or subscriber instance to receive output from multiple statements, that the listener or subscriber code is multithread-safe. If your application has shared state between
listener or subscriber instances then such shared state should be thread-safe. 
        </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-threading-advanced"/>14.7.1.Â Advanced Threading</h3></div></div></div><p>
				In the default configuration the same application thread that invokes any of the <code class="literal">sendEvent</code> methods will process the event fully and also deliver output events to listeners and subscribers. By default the single internal timer thread based on system time performs time-based processing and delivery of time-based results. 
			</p><p>
				This default configuration reduces the processing overhead associated with thread context switching, is lightweight and fast and works well in many environments such as J2EE, server or client. Latency and throughput requirements are largely use case dependant, and Esper provides engine-level facilities for controlling concurrency that are described next.
			</p><p>
				<span class="emphasis"><em>Inbound Threading</em></span> queues all incoming events: A pool of engine-managed threads performs the event processing. The application thread that sends an event via any of the <code class="literal">sendEvent</code> methods returns without blocking.
			</p><p>
				<span class="emphasis"><em>Outbound Threading</em></span> queues events for delivery to listeners and subscribers, such that slow or blocking listeners or subscribers do not block event processing.
			</p><p>
				<span class="emphasis"><em>Timer Execution Threading</em></span> means time-based event processing is performed by a pool of engine-managed threads. With this option the internal timer thread (or external timer event) serves only as a metronome, providing units-of-work to the engine-managed threads in the timer execution pool, pushing threading to the level of each statement for time-based execution.
			</p><p>
				<span class="emphasis"><em>Route Execution Threading</em></span> means that the thread sending in an event via any of the <code class="literal">sendEvent</code> methods (or the inbound threading pooled thread if inbound threading is enabled) only identifies and pre-processes an event, and a pool of engine-managed threads handles the actual processing of the event for each statement, pushing threading to the level of each statement for event-arrival-based execution.
			</p><p>
				The engine starts engine-managed threads as daemon threads when the engine instance is first obtained. The engine stops engine-managed threads when the engine instance is destroyed via the <code class="literal">destroy</code> method. When the engine is initialized via the <code class="literal">initialize</code> method the existing engine-managed threads are stopped and new threads are created. When shutting down your application, use the <code class="literal">destroy</code> method to stop engine-managed threads.
			</p><p>
				Note that the options discussed herein may introduce additional processing overhead into your system, as each option involves work queue management and thread context switching.
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
					If your use cases require ordered processing of events or do not tolerate disorder, the threading options described herein are not the right choice.
				</p><p>
					For enforcing a processing order within a given criteria, your application must enforce such processing order. Esper does not enforce order of processing if you enable inbound or route threading. 
					Your application code could, for example, utilize a thread per group of criteria keys, a latch per criteria key, or a queue per criteria key, or use Java's completion service, all depending on your ordering requirements.
				</p></div><p>
				If your use cases require loss-less processing of events, wherein the threading options mean that events are held in an in-memory queue, the threading options described herein may not be the right choice.
			</p><p>
				Care should be taken to consider arrival rates and queue depth. Threading options utilize unbound queues or capacity-bound queues with blocking-put, depending on your configuration, and may therefore introduce an overload or blocking situation to your application. You may use the service provider interface as outlined below to manage queue sizes, if required, and to help tune the engine to your application needs. Consider throttling down the event send rate when the API (see below) indicates that events are getting queued.
			</p><p>
				All threading options are on the level of an engine. If you require different threading behavior for certain statements then consider using multiple engine instances, consider using the <code class="literal">route</code> method or consider 
				using application threads instead.
			</p><p>
				Please consult <a class="xref" href="#config-engine-threading" title="15.4.13.Â Engine Settings Related to Concurrency and Threading">SectionÂ 15.4.13, âEngine Settings Related to Concurrency and Threadingâ</a> for instructions on how to configure threading options. Threading options take effect at engine initialization time.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="api-threading-advanced-inbound"/>14.7.1.1.Â Inbound Threading</h4></div></div></div><p>
					With inbound threading an engine places inbound events in a queue for processing by one or more engine-managed threads other than the delivering application threads.
				</p><p>
					The delivering application thread uses one of the <code class="literal">sendEvent</code> methods on <code class="literal">EPRuntime</code> to deliver events or may also use the <code class="literal">sendEvent</code> method on a <code class="literal">EventSender</code>. The engine receives the event and places the event into a queue, allowing the delivering thread to continue and not block while the event is being processed and results are delivered.
				</p><p>
					Events that are sent into the engine via one of the <code class="literal">route</code> methods are not placed into queue but processed by the same thread invoking the <code class="literal">route</code> operation.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="api-threading-advanced-outbound"/>14.7.1.2.Â Outbound Threading</h4></div></div></div><p>
					With outbound threading an engine places outbound events in a queue for delivery by one or more engine-managed threads other than the processing thread originating the result.
				</p><p>
					With outbound threading your listener or subscriber class receives statement results from one of the engine-managed threads in the outbound pool of threads. This is useful when you expect your listener or subscriber code to perform significantly blocking operations and you do not want to hold up event processing.
				</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
					If outbound-threading is enabled, listeners and subscribers that send events back into the engine should use the <code class="literal">sendEvent</code> method and not the <code class="literal">route</code> method.
				</div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="api-threading-advanced-timer-exec"/>14.7.1.3.Â Timer Execution Threading</h4></div></div></div><p>
					With timer execution threading an engine places time-based work units into a queue for processing by one or more engine-managed threads other than the internal timer thread or the application thread that sends an external timer event.
				</p><p>
					Using timer execution threading the internal timer thread (or thread delivering an external timer event) serves to evaluate which time-based work units must be processed. A pool of engine-managed threads performs the actual processing of time-based work units and thereby offloads the work from the internal timer thread (or thread delivering an external timer event).
				</p><p>
					Enable this option as a tuning parameter when your statements utilize time-based patterns or data windows. Timer execution threading is fine grained and works on the level of a time-based schedule in combination with a statement.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="api-threading-advanced-route-exec"/>14.7.1.4.Â Route Execution Threading</h4></div></div></div><p>
					With route execution threading an engine identifies event-processing work units based on the event and statement combination. It places such work units into a queue for processing by one or more engine-managed threads other than the thread that originated the event.
				</p><p>
					While inbound threading works on the level of an event, route execution threading is fine grained and works on the level of an event in combination with a statement.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="api-threading-management"/>14.7.1.5.Â Threading Service Provider Interface</h4></div></div></div><p>
					The service-provider interface <code class="literal">EPServiceProviderSPI</code> is an extension API that allows to manage engine-level queues and thread pools .
				</p><p>
					The service-provider interface <code class="literal">EPServiceProviderSPI</code> is considered an extension API and subject to change between release versions.
				</p><p>
					The following code snippet shows how to obtain the <code class="literal">BlockingQueue&lt;Runnable&gt;</code> and the <code class="literal">ThreadPoolExecutor</code> for the managing the queue and thread pool responsible for inbound threading:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPServiceProviderSPI spi = (EPServiceProviderSPI) epService;
int queueSize = spi.getThreadingService().getInboundQueue().size();
ThreadPoolExecutor threadpool = spi.getThreadingService().getInboundThreadPool();</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-processingorder"/>14.7.2.Â Processing Order</h3></div></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="api-processingorder-competingstmt"/>14.7.2.1.Â Competing Statements</h4></div></div></div><p>
				  This section discusses the order in which N competing statements that all react to the same arriving event execute. 
				</p><p>
					The engine, by default, does not guarantee to execute competing statements in any particular order unless using @Priority.  We therefore recommend that an application does not rely on the order of execution of statements by the engine, since that best shields the behavior of an application from changes in the order that statements may get created by your application or by threading configurations that your application may change at will.
				</p><p>
					If your application requires a defined order of execution of competing statements, use the @Priority EPL syntax to make the order of execution between statements well-defined (requires that you set the prioritized-execution configuration setting). And the @Drop can make a statement preempt all other lowered priority ones that then won't get executed for any matching events.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="api-processingorder-eventdepth"/>14.7.2.2.Â Competing Events in a Work Queue</h4></div></div></div><p>
				  This section discusses the order of event evaluation when multiple events must be processed, for example when multiple statements use insert-into to generate further events upon arrival of an event.
				</p><p>
					The engine processes an arriving event completely before indicating output events to listeners and subscribers, and before considering output events generated by insert-into or routed events inserted by listeners or subscribers.
				</p><p>
					For example, assume three statements (1) select * from MyEvent and (2) insert into ABCStream select * from MyEvent. (3) select * from ABCStream. When a MyEvent event arrives then the listeners to statements (1) and (2) execute first (default threading model). Listeners to statement (3) which receive the inserted-into stream events are always executed after delivery of the triggering event. 
				</p><p>
					Among all events generated by insert-into of statements and the events routed into the engine via the <code class="literal">route</code> method, all events that insert-into a named window are processed first in the order generated. All other events are processed thereafter in the order they were generated.
				</p><p>
				  When enabling timer or route execution threading as explained under advanced threading options then the engine does not make any guarantee to the processing order except that is will prioritize events inserted into a named window.
				</p></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-controlling-time"/>14.8.Â Controlling Time-Keeping</h2></div></div></div><a id="d0e38224" class="indexterm"/><a id="d0e38229" class="indexterm"/><a id="d0e38232" class="indexterm"/><p>
			There are two modes for an engine to keep track of time: The internal timer based on JVM system time (the default), and externally-controlled (aka. event time) time giving your application full control over the concept of time within an engine or isolated service.
        </p><p>
			An isolated service is an execution environment separate from the main engine runtime, allowing full control over the concept of time for a group of statements, as further described in <a class="xref" href="#api-isolatedservice" title="14.9.Â Service Isolation">SectionÂ 14.9, âService Isolationâ</a>.
        </p><p>
			By default the internal timer provides time and evaluates schedules. External clocking i.e. event time can be used to supply time ticks to the engine instead. 
			The latter is useful for when events themselves provide the time to advance. External clocking also helps in testing time-based event sequences or for synchronizing the engine with an external time source.  
        </p><p>
			The internal timer relies on the <code class="literal">java.util.concurrent.ScheduledThreadPoolExecutor</code> class for time tick events. The next section describes timer resolution for the internal timer, by default set to 100 milliseconds but is configurable via the threading options. When using externally-controlled time the timer resolution is in your control.
        </p><p>
			To disable the internal timer and use externally-provided time instead, there are two options. The first option is to use the configuration API at engine initialization time. The second option toggles on and off the internal timer at runtime, via special timer control events that are sent into the engine like any other event.
        </p><p>
			If using a timer execution thread pool as discussed above, the internal timer or external time event provide the schedule evaluation however do not actually perform the time-based processing. The time-based processing is performed by the threads in the timer execution thread pool.
        </p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>
			  External and internal/system time is the same internally to the engine thus the engine behaves the same whether using external or internal timer.
			</p></div><p>
			This code snippet shows the use of the configuration API to disable the internal timer and thereby turn on externally-provided time (see the Configuration section for configuration via XML file):
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getThreading().setInternalTimerEnabled(false);
EPServiceProvider epService = EPServiceProviderManager.getDefaultProvider(config);</pre><p>
			After disabling the internal timer, it is wise to set a defined time so that any statements created thereafter start relative to the time defined. Use the <code class="literal">CurrentTimeEvent</code> class to indicate current time to the engine
			and to move time forward for the engine (a.k.a application-time model).
        </p><p>
			This code snippet obtains the current time and sends a timer event in:
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">long timeInMillis = System.currentTimeMillis();
CurrentTimeEvent timeEvent = new CurrentTimeEvent(timeInMillis);
epService.getEPRuntime().sendEvent(timeEvent);</pre><p>
			Alternatively, you can use special timer control events to enable or disable the internal timer. Use the <code class="literal">TimerControlEvent</code> class to control timer operation at runtime.
        </p><p>
			The next code snippet demonstrates toggling to external timer at runtime, by sending in a <code class="literal">TimerControlEvent</code> event:
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPServiceProvider epService = EPServiceProviderManager.getDefaultProvider();
EPRuntime runtime = epService.getEPRuntime();
// switch to external clocking
runtime.sendEvent(new TimerControlEvent(TimerControlEvent.ClockType.CLOCK_EXTERNAL));</pre><p>
			Your application sends a <code class="literal">CurrentTimeEvent</code> event when it desires to move the time forward. All aspects of Esper engine time related to EPL statements and patterns are driven by the time provided by the <code class="literal">CurrentTimeEvent</code> that your application sends in.
		</p><p>
			The next example sequence of instructions sets time to zero, then creates a statement, then moves time forward to 1 seconds later and then 6 seconds later:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Set start time at zero.
runtime.sendEvent(new CurrentTimeEvent(0));

// create a statement here
epAdministrator.createEPL("select * from MyEvent output every 5 seconds");

// move time forward 1 second
runtime.sendEvent(new CurrentTimeEvent(1000));

// move time forward 5 seconds
runtime.sendEvent(new CurrentTimeEvent(6000));</pre><p>
			When sending external timer events, your application should make sure that <code class="literal">long</code>-type time values are ascending. That is, each long-type value should be either the same value or a larger value then the prior value provided by a <code class="literal">CurrentTimeEvent</code>.
		</p><p>
		    Your application may use the <code class="literal">getNextScheduledTime</code> method in <code class="literal">EPRuntime</code> to determine the earliest time a schedule for any statement requires evaluation.
		</p><p>
			The following code snippet sets the current time, creates a statement and prints the next scheduled time which is 1 minute later then the current time:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Set start time to the current time.
runtime.sendEvent(new CurrentTimeEvent(System.currentTimeMillis()));

// Create a statement.
epService.getEPAdministrator().createEPL("select * from pattern[timer:interval(1 minute)]");

// Print next schedule time
System.out.println("Next schedule at " + new Date(runtime.getNextScheduledTime());</pre><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-controlling-time-span"/>14.8.1.Â Controlling Time Using Time Span Events</h3></div></div></div><p>
				With <code class="literal">CurrentTimeEvent</code>, as described above, your application can advance engine time to a given point in time. In addition, the <code class="literal">getNextScheduledTime</code> method in <code class="literal">EPRuntime</code> returns the next scheduled time according to started statements.
				You would typically use <code class="literal">CurrentTimeEvent</code> to advance time at a relatively high resolution.
			</p><p>
				To advance time for a span of time without sending individual <code class="literal">CurrentTimeEvent</code> events to the engine, the API provides the class <code class="literal">CurrentTimeSpanEvent</code>.  You may use <code class="literal">CurrentTimeSpanEvent</code> with or without a resolution.
			</p><p>
				If your application only provides the target end time of time span to <code class="literal">CurrentTimeSpanEvent</code> and no resolution, the engine advances time up to the target time by stepping through all relevant times according to started statements.
			</p><p>
				If your application provides the target end time of time span and in addition a <code class="literal">long</code>-typed resolution, the engine advances time up to the target time by incrementing time according to the resolution (regardless of next scheduled time according to started statements).
			</p><p>
				Consider the following example:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Set start time to Jan.1, 2010, 00:00 am for this example
SimpleDateFormat format = new SimpleDateFormat("yyyy MM dd HH:mm:ss SSS");
Date startTime = format.parse("2010 01 01 00:00:00 000");
runtime.sendEvent(new CurrentTimeEvent(startTime.getTime()));

// Create a statement.
EPStatement stmt = epService.getEPAdministrator().createEPL("select current_timestamp() as ct " +
  "from pattern[every timer:interval(1 minute)]");
stmt.addListener(...);	// add a listener

// Advance time to 10 minutes after start time
runtime.sendEvent(new CurrentTimeSpanEvent(startTime.getTime() + 10*60*1000));</pre><p>
				The above example advances time to 10 minutes after the time set using <code class="literal">CurrentTimeSpanEvent</code>. As the example does not pass a resolution, the engine advances time according to statement schedules.
				Upon sending the <code class="literal">CurrentTimeSpanEvent</code> the listener sees 10 invocations for minute 1 to minute 10.
			</p><p>
				To advance time according to a given resolution, you may provide the resolution as shown below:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Advance time to 10 minutes after start time at 100 msec resolution
runtime.sendEvent(new CurrentTimeSpanEvent(startTime.getTime() + 10*60*1000, 100));</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-time-resolution"/>14.8.2.Â Time Resolution and Time Unit</h3></div></div></div><a id="d0e38369" class="indexterm"/><p>
				Time can have a resolution of either milliseconds or microseconds. 
			</p><p>
				The default time resolution is milliseconds.  To configure the engine for microsecond resolution, please see <a class="xref" href="#config-engine-timeunit" title="15.4.22.2.Â Time Unit">SectionÂ 15.4.22.2, âTime Unitâ</a>. 
			</p><div class="table"><a id="d0e38380"/><p class="title"><b>TableÂ 14.5.Â Time Resolution</b></p><div class="table-contents"><table summary="Time Resolution" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Â </th><th>Millisecond</th><th>Microsecond</th></tr></thead><tbody><tr><td>Smallest unit for advancing time</td><td>1 millisecond</td><td>1 microsecond</td></tr><tr><td>Equivalent <code class="literal">java.util.concurrent.TimeUnit</code></td><td>TimeUnit.MILLISECONDS</td><td>TimeUnit.MICROSECONDS</td></tr><tr><td>Default?</td><td>Default</td><td>Requires configuration change, see <a class="xref" href="#config-engine-timeunit" title="15.4.22.2.Â Time Unit">SectionÂ 15.4.22.2, âTime Unitâ</a></td></tr><tr><td>Long-type engine time represents</td><td>Milliseconds since Epoch</td><td>Microseconds since Epoch</td></tr><tr><td>Example: the date Tue, 01 Jan 1980 00:00:00 GMT</td><td>315532800000</td><td>315532800000000</td></tr><tr><td>Support for Internal System Time</td><td>Yes</td><td>No, requires external time (aka. event time) via <code class="literal">CurrentTimeSpanEvent</code> or <code class="literal">CurrentTimeEvent</code></td></tr></tbody></table></div></div><br class="table-break"/><p>
				A few notes on usage of microsecond time unit for time resolution:
			</p><div class="itemizedlist"><ul><li><p>
					The engine automatically computes time periods into microseconds. For example <code class="literal">1 minute 2 seconds</code> is <code class="literal">62000000</code> microseconds (<code class="literal">62 * 1000000</code>).
					</p></li><li><p>
					The engine automatically computes time-in-second parameters into microseconds. For example <code class="literal">5.02 seconds</code> is <code class="literal">5020000</code> microseconds.
					</p></li><li><p>
					The engine automatically computes ISO schedules, crontabs and hints related to engine time into microseconds. 
					</p></li><li><p>
					The <code class="literal">CurrentTimeSpanEvent</code> or <code class="literal">CurrentTimeEvent</code> events must provide microsecond values.
					</p></li><li><p>
					Date-time methods with long-type input values assume microsecond values.
					</p></li><li><p>
					Date-time methods or other functions that take millisecond parameters or produce millisecond values still consume/produce millisecond values, such as the date-time method <code class="literal">toMillisec</code>.
					</p></li><li><p>
					The internal timer must be disabled (<code class="literal">setInternalTimerEnabled(false)</code>) and <code class="literal">TimerControlEvent.ClockType.CLOCK_INTERNAL</code> cannot be used.
					</p></li></ul></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-time-internal"/>14.8.3.Â Internal Timer Based on JVM System Time</h3></div></div></div><p>
				By default the internal timer is enabled and that tracks VM system time. For many use cases your application may want to use event time or external time instead, as discussed above.
			</p><p>
				The internal timer thread, by default, uses the call <code class="literal">System.currentTimeMillis()</code> to obtain system time. Please see the JIRA issue ESPER-191 Support nano/microsecond resolution for more information on Java system time-call performance, accuracy and drift. 
			</p><p>
				The internal timer thread can be configured to use nano-second time as returned by <code class="literal">System.nanoTime()</code>. If configured for nano-second time, the engine computes an offset of the nano-second ticks to wall clock time upon startup to present back an accurate millisecond wall clock time. 
				Please see section <a class="xref" href="#config-engine-time-source" title="15.4.22.Â Engine Settings Related to Time Source">SectionÂ 15.4.22, âEngine Settings Related to Time Sourceâ</a> to configure the internal timer thread to use <code class="literal">System.nanoTime()</code>.
			</p><p>
				The internal timer is based on <code class="literal">java.util.concurrent.ScheduledThreadPoolExecutor</code> and that generally provides high accuracy VM time
				(<code class="literal">java.util.Timer</code> does not support high accuracy VM time).
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-controlling-time-spi"/>14.8.4.Â Additional Time-Related APIs</h3></div></div></div><p>
				Consider using the service-provider interface <code class="literal">EPRuntimeSPI</code> <code class="literal">EPRuntimeIsolatedSPI</code>. The two interfaces are service-provider interfaces that expose additional function to manage statement schedules. However the SPI interfaces should be considered an extension API and are subject to change between release versions.
			</p><p>
				Additional engine-internal SPI interfaces can be obtained by downcasting <code class="literal">EPServiceProvider</code> to <code class="literal">EPServiceProviderSPI</code>. For example the <code class="literal">SchedulingServiceSPI</code> exposes schedule information per statement (downcast from <code class="literal">SchedulingService</code>). Engine-internal SPI are subject to change between versions.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-isolatedservice"/>14.9.Â Service Isolation</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-isolatedservice-overview"/>14.9.1.Â Overview</h3></div></div></div><p>
				An <span class="emphasis"><em>isolated service</em></span> allows an application to control event visibility and the concept of time as desired on a statement level: Events sent into an isolated service are visible only to those statements that currently reside in the isolated service and are not visible to statements outside of that isolated service. Within an isolated service an application can control time independently, start time at a point in time and advance time at the resolution and pace suitable for the statements added to that isolated service. 
			</p><p>
				In the default configuration, isolated service is disabled and not available. This is because there is a small overhead associated with this feature. 
				Please review <a class="xref" href="#config-engine-execution-allowisolatedservice" title="15.4.27.7.Â Allow Isolated Service Provider">SectionÂ 15.4.27.7, âAllow Isolated Service Providerâ</a> for the configuration setting.
			</p><p>
				As discussed before, a single Java Virtual Machine may hold multiple Esper engine instances unique by engine URI. Within an Esper engine instance the default execution environment for statements is the <code class="literal">EPRuntime</code> engine runtime, which coordinates all statement's reaction to incoming events and to time passing (via internal or external timer).
			</p><p>
				Subordinate to an Esper engine instance, your application can additionally allocate multiple isolated services (or execution environments), uniquely identified by a name and represented by the <code class="literal">EPServiceProviderIsolated</code> interface. In the isolated service, time passes only when you application sends timer events to the <code class="literal">EPRuntimeIsolated</code> instance. Only events explicitly sent to the isolated service are visible to statements added.
			</p><p>
				Your application can create new statements that start in an isolated service. You can also move existing statements back and forth between the engine and an isolated service.
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
					Isolation does not apply and is not supported for globally-visible concepts. Specifically it is not supported for the following.
				</p><div class="orderedlist"><ol><li><p>
							Contexts, context partitions.
						</p></li><li><p>
							Variables.
						</p></li><li><p>
							Named Windows.
						</p></li><li><p>
							Tables.
						</p></li></ol></div></div><p>
				An isolated service allows an application to:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						Suspend a statement without losing its statement state that may have accumulated for the statement.
					</p></li><li><p>
					  Control the concept of time separately for a set of statements, for example to simulate, backtest, adjust arrival order or compute arrival time.
					</p></li><li><p>
					   Initialize statement state by replaying events, without impacting already running statements, to catch-up statements from historical events for example.
					</p></li></ol></div><p>
				While a statement resides in an isolated runtime it receives only those events explicitly sent to the isolated runtime, and performs time-based processing based on the timer events provided to that isolated runtime.
			</p><p>
				Use the <code class="literal">getEPServiceIsolated</code> method on <code class="literal">EPServiceProvider</code> passing a name to obtain an isolated runtime:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPServiceProviderIsolated isolatedService = epServiceManager.getEPServiceIsolated("name");</pre><p>
				Set the start time for your isolated runtime via the <code class="literal">CurrentTimeEvent</code> timer event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// In this example start the time at the system time
long startInMillis = System.currentTimeMillis();	
isolatedService.getEPRuntime().sendEvent(new CurrentTimeEvent(startInMillis));</pre><p>
				Use the <code class="literal">addStatement</code> method on <code class="literal">EPAdministratorIsolated</code> to move an existing statement out of the engine runtime into the isolated runtime:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// look up the existing statement
EPStatement stmt = epServiceManager.getEPAdministrator().getStatement("MyStmt");

// move it to an isolated service
isolatedService.getEPAdministrator().addStatement(stmt);</pre><p>
				To remove the statement from isolation and return the statement back to the engine runtime, use the <code class="literal">removeStatement</code> method on <code class="literal">EPAdministratorIsolated</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">isolatedService.getEPAdministrator().removeStatement(stmt);</pre><p>
				To create a new statement in the isolated service, use the <code class="literal">createEPL</code> method on <code class="literal">EPAdministratorIsolated</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">isolatedService.getEPAdministrator().createEPL(
  "@Name('MyStmt') select * from Event", null, null); 
// the example is passing the statement name in an annotation and no user object</pre><p>
				The <code class="literal">destroy</code> method on <code class="literal">EPServiceProviderIsolated</code> moves all currently-isolated statements for that isolated service provider back to engine runtime.
			</p><p>
				When moving a statement between engine runtime and isolated service or back, the algorithm ensures that events are aged according to the time that passed and time schedules stay intact.
			</p><p>
				To use isolated services, your configuration must have view sharing disabled as described in <a class="xref" href="#config-engine-viewresources-sharing" title="15.4.15.1.Â Sharing View Resources Between Statements">SectionÂ 15.4.15.1, âSharing View Resources Between Statementsâ</a>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-isolatedruntime-suspend"/>14.9.2.Â Example: Suspending a Statement</h3></div></div></div><p>
				By adding an existing statement to an isolated service, the statement's processing effectively becomes suspended. Time does not pass for the statement and it will not process events, unless your application explicitly moves time forward or sends events into the isolated service.
			</p><p>
				First, let's create a statement and send events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPStatement stmt = epServiceManager.getEPAdministrator().createEPL("select * from TemperatureEvent#time(30)");
epServiceManager.getEPRuntime().send(new TemperatureEvent(...));
// send some more events over time</pre><p>
				The steps to suspend the previously created statement are as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPServiceProviderIsolated isolatedService = epServiceManager.getEPServiceIsolated("suspendedStmts");
isolatedService.getEPAdministrator().addStatement(stmt);</pre><p>
				To resume the statement, move the statement back to the engine:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">isolatedService.getEPAdministrator().removeStatement(stmt);</pre><p>
				If the statement employed a time window, the events in the time window did not age. If the statement employed patterns, the pattern's time-based schedule remains unchanged. This is because the example did not advance time in the isolated service.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-isolatedruntime-catchup"/>14.9.3.Â Example: Catching Up a Statement From Historical Data</h3></div></div></div><p>
				This example creates a statement in the isolated service, replays some events and advances time, then merges back the statement to the engine to let it participate in incoming events and engine time processing.
			</p><p>
				First, allocate an isolated service and explicitly set it to a start time. Assuming that <code class="literal">myStartTime</code> is a long millisecond time value that marks the beginning of the data to replay, the sequence is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPServiceProviderIsolated isolatedService = epServiceManager.getEPServiceIsolated("suspendedStmts");
isolatedService.getEPRuntime().sendEvent(new CurrentTimeEvent(myStartTime));</pre><p>
				Next, create the statement. The sample statement is a pattern statement looking for temperature events following each other within 60 seconds:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPStatement stmt = epAdmin.createEPL(
  "select * from pattern[every a=TemperatureEvent -&gt; b=TemperatureEvent where timer:within(60)]");</pre><p>
				For each historical event to be played, advance time and send an event. This code snippet assumes that <code class="literal">currentTime</code> is a time greater then <code class="literal">myStartTime</code> and reflects the time that  the historical event should be processed at.
				It also assumes <code class="literal">historyEvent</code> is the historical event object.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">isolatedService.getEPRuntime().sendEvent(new CurrentTimeEvent(currentTime));
isolatedService.getEPRuntime().send(historyEvent);
// repeat the above advancing time until no more events</pre><p>
				Finally, when done replaying events, merge the statement back with the engine:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">isolatedService.getEPAdministrator().removeStatement(stmt);</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-isolatedruntime-insertinto"/>14.9.4.Â Isolation for Insert-Into</h3></div></div></div><p>
				When isolating statements, events that are generated by <code class="literal">insert into</code> are visible within the isolated service that currently holds that <code class="literal">insert into</code> statement.
			</p><p>
				For example, assume the below two statements named A and B:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Name('A') insert into MyStream select * from MyEvent
@Name('B') select * from MyStream</pre><p>
				When adding statement A to an isolated service, and assuming a <code class="literal">MyEvent</code> is sent to either the engine runtime or the isolated service, a listener to statement B does not receive that event.
			</p><p>
				When adding statement B to an isolated service, and assuming a <code class="literal">MyEvent</code> is sent to either the engine runtime or the isolated service, a listener to statement B does not receive that event.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-isolatedruntime-namedwindowtable"/>14.9.5.Â Isolation for Named Windows and Tables</h3></div></div></div><p>
				When isolating named windows or tables, the event visibility of events entering and leaving from a named window or the rows inserted, changed and removed from tables 
				is not limited to the isolated service. This is because named windows are global data windows and tables are global data structures.
			</p><p>
				For example, assume the below three statements named A, B and C:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Name('A') create window MyNamedWindow#time(60) as select * from MyEvent
@Name('B') insert into MyNamedWindow select * from MyEvent
@Name('C') select * from MyNamedWindow</pre><p>
				When adding statement A to an isolated service, and assuming a <code class="literal">MyEvent</code> is sent to either the engine runtime or the isolated service, a listener to statement A and C does not receive that event.
			</p><p>
				When adding statement B to an isolated service, and assuming a <code class="literal">MyEvent</code> is sent to either the engine runtime or the isolated service, a listener to statement A and C does not receive that event.
			</p><p>
				When adding statement C to an isolated service, and assuming a <code class="literal">MyEvent</code> is sent to the engine runtime, a listener to statement A and C does receive that event.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-isolatedruntime-runtime"/>14.9.6.Â Runtime Considerations</h3></div></div></div><p>
				Moving statements between an isolated service and the engine is an expensive operation and should not be performed with high frequency.
			</p><p>
				When using multiple threads to send events and at the same time moving a statement to an isolated service, it its undefined whether events will be delivered to a listener of the isolated statement until all threads completed sending events.
			</p><p>
				Metrics reporting is not available for statements in an isolated service. Advanced threading options are also not available in the isolated service, however it is thread-safe to send events including timer events from multiple threads to the
				same or different isolated service.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-exception"/>14.10.Â Exception Handling</h2></div></div></div><p>
			You may register one or more exception handlers for the engine to invoke in the case it encounters an exception processing a continuously-executing statement. By default and without exception handlers the engine cancels execution of the current EPL statement that encountered the exception, logs the exception and continues to the next statement, if any. The configuration is described in <a class="xref" href="#config-engine-exceptionhandling" title="15.4.28.Â Engine Settings Related to Exception Handling">SectionÂ 15.4.28, âEngine Settings Related to Exception Handlingâ</a>.
        </p><p>
			If your application registers exception handlers as part of engine configuration, the engine invokes the exception handlers in the order they are registered passing relevant exception information such as EPL statement name, expression and the exception itself.
        </p><p>
			Exception handlers receive any EPL statement unchecked exception such as internal exceptions or exceptions thrown by plug-in aggregation functions or plug-in data windows. The engine does not provide to exception handlers any exceptions thrown by static method invocations for function calls, method invocations in joins, methods on variables and event classes and listeners or subscriber exceptions.
        </p><p>
			An exception handler can itself throw a runtime exception to cancel execution of the current event against any further statements.
        </p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
				Exceptions are meant to indicate an actual unexpected problem. 
			</p><p>
				We do not recommend explicitly throwing exceptions for the purpose of flow control, preempting execution or other normal situations.
			</p><p>
				The engine does not guarantee that throwing an exception has no other side effect and the engine may not roll back changes that are already made to state.
			</p></div><p>
			For on-demand queries the API indicates any exception directly back to the caller without the exception handlers being invoked, as exception handlers apply to continuous queries only. The same applies to any API calls other than <code class="literal">sendEvent</code> and the <code class="literal">EventSender</code> methods.
        </p><p>
			As the configuration section describes, your application registers one or more classes that implement the <code class="literal">ExceptionHandlerFactory</code> interface in the engine configuration. Upon engine initialization the engine obtains a factory instance from the class name that then provides the exception handler instance. The exception handler class must implement the <code class="literal">ExceptionHandler</code> interface.
        </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-condition"/>14.11.Â Condition Handling</h2></div></div></div><p>
			You may register one or more condition handlers for the engine to invoke in the case it encounters certain conditions, as outlined below, when executing a statement. By default and without condition handlers the engine logs the condition at informational level and continues processing. The configuration is described in <a class="xref" href="#config-engine-conditionhandling" title="15.4.29.Â Engine Settings Related to Condition Handling">SectionÂ 15.4.29, âEngine Settings Related to Condition Handlingâ</a>.
        </p><p>
			If your application registers condition handlers as part of engine configuration, the engine invokes the condition handlers in the order they are registered passing relevant condition information such as EPL statement name, expression and the condition information itself.
        </p><p>
			Currently the only conditions indicated by this facility are raised by the pattern followed-by operator, see <a class="xref" href="#pattern-temporal-followed-by-max" title="7.5.8.1.Â Limiting Sub-Expression Count">SectionÂ 7.5.8.1, âLimiting Sub-Expression Countâ</a> and see <a class="xref" href="#pattern-temporal-followed-by-engine-max" title="7.5.8.2.Â Limiting Engine-wide Sub-Expression Count">SectionÂ 7.5.8.2, âLimiting Engine-wide Sub-Expression Countâ</a>.
        </p><p>
			A condition handler may not itself throw a runtime exception or return any value.
        </p><p>
			As the configuration section describes, your application registers one or more classes that implement the <code class="literal">ConditionHandlerFactory</code> interface in the engine configuration. Upon engine initialization the engine obtains a factory instance from the class name that then provides the condition handler instance. The condition handler class must implement the <code class="literal">ConditionHandler</code> interface.
        </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-soda"/>14.12.Â Statement Object Model</h2></div></div></div><a id="d0e38847" class="indexterm"/><p>
			The statement object model is a set of classes that provide an object-oriented representation of an EPL  or pattern statement. The object model classes are found in package <code class="literal">com.espertech.esper.client.soda</code>. An instance of <code class="literal">EPStatementObjectModel</code> represents a statement's object model.
        </p><p>
			The statement object model classes are a full and complete specification of a statement. All EPL  and pattern constructs including expressions and sub-queries are available via the statement object model. 
        </p><p>
			In conjunction with the administrative API, the statement object model provides the means to build, change or interrogate statements beyond the EPL  or pattern syntax string representation. The object graph of the statement object model is fully navigable for easy querying by code, and is also serializable allowing applications to persist or transport statements in object form, when required.
        </p><p>
			The statement object model supports full round-trip from object model to EPL  statement string and back to object model: A statement object model can be rendered into an EPL  string representation via the <code class="literal">toEPL</code> method on <code class="literal">EPStatementObjectModel</code>. Further, the administrative API allows to compile a statement string into an object model representation via the <code class="literal">compileEPL</code> method on <code class="literal">EPAdministrator</code>.
        </p><p>
			The statement object model is fully mutable. Mutating a any list such as returned by <code class="literal">getChildren()</code>, for example, is acceptable and supported.
        </p><p>
			The <code class="literal">create</code> method on <code class="literal">EPAdministrator</code> creates and starts a statement as represented by an object model. In order to obtain an object model from an existing statement, obtain the statement expression text of the statement via the <code class="literal">getText</code> method on <code class="literal">EPStatement</code> and use the <code class="literal">compileEPL</code> method to obtain the object model.
		</p><p>
			The following limitations apply:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					Statement object model classes are not safe for sharing between threads other than for read access. 
				</p></li><li><p>
					Between versions of Esper, the serialized form of the object model is subject to change. Esper makes no guarantees that the serialized object model of one version will be fully compatible with the 
					serialized object model generated by another version of Esper. Please consider this issue when storing Esper object models in persistent store. 
				</p></li></ul></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-soda-building-step1"/>14.12.1.Â Building an Object Model</h3></div></div></div><p>
				A <code class="literal">EPStatementObjectModel</code> consists of an object graph representing all possible clauses that can be part of an EPL  statement. 
			</p><p>
				Among all clauses, the <code class="literal">SelectClause</code> and <code class="literal">FromClause</code> objects are required clauses that must be present, in order to define what to select and where to select from.
			</p><div class="table"><a id="soda-building-classes-1"/><p class="title"><b>TableÂ 14.6.Â Required Statement Object Model Instances</b></p><div class="table-contents"><table summary="Required Statement Object Model Instances" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Class</th><th>Description</th></tr></thead><tbody><tr><td><span class="emphasis"><em>EPStatementObjectModel</em></span></td><td>All statement clauses for a statement, such as the select-clause and the from-clause, are specified within the object graph of an instance of this class</td></tr><tr><td><span class="emphasis"><em>SelectClause</em></span></td><td>A list of the selection properties or expressions, or a wildcard</td></tr><tr><td><span class="emphasis"><em>FromClause</em></span></td><td>A list of one or more streams; A stream can be a filter-based, a pattern-based or a SQL-based stream; Add data windows here.</td></tr></tbody></table></div></div><br class="table-break"/><p>
				Part of the statement object model package are convenient builder classes that make it easy to build a new object model or change an existing object model. The <code class="literal">SelectClause</code> and <code class="literal">FromClause</code> are such builder classes and provide convenient <code class="literal">create</code> methods.
			</p><p>
				Within the from-clause you have a choice of different streams to select on. The <code class="literal">FilterStream</code> class represents a stream that is filled by events of a certain type and that pass an optional filter expression.
			</p><p>
				We can use the classes introduced above to create a simple statement object model:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPStatementObjectModel model = new EPStatementObjectModel();
model.setSelectClause(SelectClause.createWildcard());
model.setFromClause(FromClause.create(FilterStream.create("com.chipmaker.ReadyEvent")));</pre><p>
				The model as above is equivalent to the EPL :
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from com.chipmaker.ReadyEvent</pre><p>
				Last, the code snippet below creates a statement from the object model:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPStatement stmt = epService.getEPAdministrator().create(model);</pre><p>
				Notes on usage: 
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						Variable names can simply be treated as property names.
					</p></li><li><p>
						When selecting from named windows or tables, the name of the named window or table is the event type name for use in <code class="literal">FilterStream</code> instances or patterns.
					</p></li><li><p>
						To compile an arbitrary sub-expression text into an <code class="literal">Expression</code> object representation, simply add the expression text to a <code class="literal">where</code> clause,
						compile the EPL  string into an object model via the <code class="literal">compileEPL</code> on <code class="literal">EPAdministrator</code>, and obtain the compiled <code class="literal">where</code>
						from the <code class="literal">EPStatementObjectModel</code> via the <code class="literal">getWhereClause</code> method.
					</p></li></ul></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-soda-building-step2"/>14.12.2.Â Building Expressions</h3></div></div></div><p>
				The <code class="literal">EPStatementObjectModel</code> includes an optional where-clause. The where-clause is a filter expression that the engine applies to events in one or more streams. The key interface for all expressions is the <code class="literal">Expression</code> interface.
			</p><p>
				The <code class="literal">Expressions</code> class provides a convenient way of obtaining <code class="literal">Expression</code> instances for all possible expressions. Please consult the JavaDoc for detailed method information. 
				The next example discusses sample where-clause expressions.
			</p><p>
				Use the <code class="literal">Expressions</code> class as a service for creating expression instances, and add additional expressions via the <code class="literal">add</code> method that most expressions provide.
			</p><p>
				The next example adds a simple where-clause to the EPL as shown earlier:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from com.chipmaker.ReadyEvent where line=8</pre><p>
				And the code to add a where-clause to the object model is below.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">model.setWhereClause(Expressions.eq("line", 8));</pre><p>
				The following example considers a more complex where-clause. Assume you need to build an expression using logical-and and logical-or:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from com.chipmaker.ReadyEvent 
where (line=8) or (line=10 and age&lt;5)</pre><p>
				The code for building such a where-clause by means of the object model classes is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">model.setWhereClause(Expressions.or()
  .add(Expressions.eq("line", 8))
  .add(Expressions.and()
      .add(Expressions.eq("line", 10))
      .add(Expressions.lt("age", 5))
  ));</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-soda-building-step3"/>14.12.3.Â Building a Pattern Statement</h3></div></div></div><p>
				The <code class="literal">Patterns</code> class is a factory for building pattern expressions. It provides convenient methods to create all pattern expressions of the pattern language.
			</p><p>
				Patterns in EPL  are seen as a stream of events that consist of patterns matches. The <code class="literal">PatternStream</code> class represents a stream of pattern matches and contains a pattern expression within. 
			</p><p>
				 For instance, consider the following pattern statement.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern [every a=MyAEvent and not b=MyBEvent]</pre><p>
				The next code snippet outlines how to use the statement object model and specifically the <code class="literal">Patterns</code> class to create a statement object model that is equivalent to the pattern statement above.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPStatementObjectModel model = new EPStatementObjectModel();
model.setSelectClause(SelectClause.createWildcard());
PatternExpr pattern = Patterns.and()
  .add(Patterns.everyFilter("MyAEvent", "a"))
  .add(Patterns.notFilter("MyBEvent", "b"));
model.setFromClause(FromClause.create(PatternStream.create(pattern)));</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-soda-building-step4"/>14.12.4.Â Building a Select Statement</h3></div></div></div><p>
				This section builds a complete example statement and includes all optional clauses in one EPL  statement, to demonstrate the object model API.
			</p><p>
				A sample statement:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into ReadyStreamAvg(line, avgAge) 
select line, avg(age) as avgAge 
from com.chipmaker.ReadyEvent(line in (1, 8, 10))#time(10) as RE
where RE.waverId != null
group by line 
having avg(age) &lt; 0
output every 10.0 seconds 
order by line</pre><p>
				Finally, this code snippet builds the above statement from scratch:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPStatementObjectModel model = new EPStatementObjectModel();
model.setInsertInto(InsertIntoClause.create("ReadyStreamAvg", "line", "avgAge"));
model.setSelectClause(SelectClause.create()
    .add("line")
    .add(Expressions.avg("age"), "avgAge"));
Filter filter = Filter.create("com.chipmaker.ReadyEvent", Expressions.in("line", 1, 8, 10));
model.setFromClause(FromClause.create(
    FilterStream.create(filter, "RE").addView("win", "time", 10)));
model.setWhereClause(Expressions.isNotNull("RE.waverId"));
model.setGroupByClause(GroupByClause.create("line"));
model.setHavingClause(Expressions.lt(Expressions.avg("age"), Expressions.constant(0)));
model.setOutputLimitClause(OutputLimitClause.create(OutputLimitSelector.DEFAULT, Expressions.timePeriod(null, null, null, 10.0, null)));
model.setOrderByClause(OrderByClause.create("line"));</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-soda-building-step5"/>14.12.5.Â Building a Create-Variable and On-Set Statement</h3></div></div></div><p>
				This sample statement creates a variable:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create variable integer var_output_rate = 10</pre><p>
				The code to build the above statement using the object model:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPStatementObjectModel model = new EPStatementObjectModel();
model.setCreateVariable(CreateVariableClause.create("integer", "var_output_rate", 10));
epService.getEPAdministrator().create(model);</pre><p>
				A second statement sets the variable to a new value:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on NewValueEvent set var_output_rate = new_rate</pre><p>
				The code to build the above statement using the object model:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPStatementObjectModel model = new EPStatementObjectModel();
model.setOnExpr(OnClause.createOnSet("var_output_rate", Expressions.property("new_rate")));
model.setFromClause(FromClause.create(FilterStream.create("NewValueEvent")));
EPStatement stmtSet = epService.getEPAdministrator().create(model);</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-soda-building-step6"/>14.12.6.Â Building Create-Window, On-Delete and On-Select Statements</h3></div></div></div><p>
				This sample statement creates a named window:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window OrdersTimeWindow#time(30 sec) as select symbol as sym, volume as vol, price from OrderEvent</pre><p>
				The is the code that builds the create-window statement as above:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPStatementObjectModel model = new EPStatementObjectModel();
model.setCreateWindow(CreateWindowClause.create("OrdersTimeWindow").addView("win", "time", 30));
model.setSelectClause(SelectClause.create()
		.addWithName("symbol", "sym")
		.addWithName("volume", "vol")
		.add("price"));
model.setFromClause(FromClause.create(FilterStream.create("OrderEvent)));</pre><p>
				A second statement deletes from the named window:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on NewOrderEvent as myNewOrders
delete from OrdersNamedWindow as myNamedWindow
where myNamedWindow.symbol = myNewOrders.symbol</pre><p>
				The object model is built by:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPStatementObjectModel model = new EPStatementObjectModel();
model.setOnExpr(OnClause.createOnDelete("OrdersNamedWindow", "myNamedWindow"));
model.setFromClause(FromClause.create(FilterStream.create("NewOrderEvent", "myNewOrders")));
model.setWhereClause(Expressions.eqProperty("myNamedWindow.symbol", "myNewOrders.symbol"));
EPStatement stmtOnDelete = epService.getEPAdministrator().create(model);</pre><p>
				A third statement selects from the named window using the non-continuous on-demand selection via on-select:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on QueryEvent(volume&gt;0) as query
select count(*) from OrdersNamedWindow as win
where win.symbol = query.symbol</pre><p>
				The on-select statement is built from scratch via the object model as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPStatementObjectModel model = new EPStatementObjectModel();
model.setOnExpr(OnClause.createOnSelect("OrdersNamedWindow", "win"));
model.setWhereClause(Expressions.eqProperty("win.symbol", "query.symbol"));
model.setFromClause(FromClause.create(FilterStream.create("QueryEvent", "query", 
  Expressions.gt("volume", 0))));
model.setSelectClause(SelectClause.create().add(Expressions.countStar()));
EPStatement stmtOnSelect = epService.getEPAdministrator().create(model);</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-prepared"/>14.13.Â Prepared Statement and Substitution Parameters</h2></div></div></div><p>
			The <code class="literal">prepare</code> method that is part of the administrative API pre-compiles an EPL statement and stores the precompiled statement in an <code class="literal">EPPreparedStatement</code> object. This 
			object can then be used to efficiently start the parameterized statement multiple times.
        </p><p>
			You can insert substitution parameters as a single question mark character <code class="literal">'?'</code>, making the substitution parameter addressable by index.
		</p><p>
			You can also insert substitution parameters using the following syntax, which makes the substitution parameter addressable by name:
		</p><pre class="synopsis">?:<span class="emphasis"><em>name</em></span></pre><p>
			All substitution parameters must either be unnamed (just <code class="literal">'?'</code>) or named (<code class="literal">'?:</code><span class="emphasis"><em>name</em></span><code class="literal">'</code>). It is not possible to mix the two styles.
        </p><p>
			If not assigning a name to substitution parameters, the engine assigns the first substitution parameter an index of 1 and subsequent parameters increment the index by one.
        </p><p>
			If assigning a name to each substitution parameter, the name can include slash (<code class="literal">/</code>) characters and can occur multiple times.
        </p><p>
			Substitution parameters can be inserted into any EPL construct that takes an expression. 
			They are therefore valid in any clauses such as the select-clause, from-clause filters, where-clause, group-by-clause, 
			having-clause or order-by-clause, including data window parameters and pattern observers and guards.
			Substitution parameters cannot be used where a numeric constant is required rather than an expression and in SQL statements.
        </p><p>
			All substitution parameters must be replaced by actual values before a statement with substitution parameters can be started. Substitution parameters can be set to new values and new statements can be created from the same <code class="literal">EPPreparedStatement</code> object more than once.
        </p><p>
			If not assigning a name to substitution parameters, replace the substitution parameter with an actual value using the <code class="literal">setObject(int index, Object value)</code> method for each index, starting from 1.
        </p><p>
			If assigning a name to each substitution parameter, replace the substitution parameter with an actual value using the <code class="literal">setObject(String name, Object value)</code> method for each name.
        </p><p>
			While the <code class="literal">setObject</code> method allows substitution parameters to assume any actual value including application Java objects or enumeration values, the application must provide the correct type of  substitution parameter that matches the requirements of the expression the parameter resides in.
        </p><p>
			In the following example of setting parameters on a prepared statement and starting the prepared statement, <code class="literal">epService</code> represents an engine instance:
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String stmt = "select * from com.chipmaker.ReadyEvent(line=?)";
EPPreparedStatement prepared = epService.getEPAdministrator().prepareEPL(stmt);
prepared.setObject(1, 8);
EPStatement statement = epService.getEPAdministrator().create(prepared);</pre><p>
			The next example names the substitution parameter:
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String stmt = "select * from ReadyEvent(line=?:lines/line1)";
EPPreparedStatement prepared = epService.getEPAdministrator().prepareEPL(stmt);
prepared.setObject("lines/line1", 1);</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-instrumentation"/>14.14.Â Engine and Statement Metrics Reporting</h2></div></div></div><p>
			The engine can report key processing metrics through the JMX platform mbean server by setting a single configuration flag described in <a class="xref" href="#config-engine-jmxmetrics" title="15.4.23.Â Engine Settings Related to JMX Metrics">SectionÂ 15.4.23, âEngine Settings Related to JMX Metricsâ</a>.
			For additional detailed reporting and metrics events, please read on.
        </p><p>
			Metrics reporting is a feature that allows an application to receive ongoing reports about key engine-level and statement-level metrics. Examples are the number of incoming events, the CPU time and wall time taken by statement executions or the number of output events per statement.
        </p><p>
			Metrics reporting is, by default, disabled. To enable reporting, please follow the steps as outlined in <a class="xref" href="#config-engine-instrumentation" title="15.4.24.Â Engine Settings Related to Metrics Reporting">SectionÂ 15.4.24, âEngine Settings Related to Metrics Reportingâ</a>. Metrics reporting must be enabled at engine initialization time. Reporting intervals can be controlled at runtime via the <code class="literal">ConfigurationOperations</code> interface available from the administrative API.
        </p><p>
			Your application can receive metrics at configurable intervals via EPL statement. A metric datapoint is simply a well-defined event. The events are <code class="literal">EngineMetric</code> and <code class="literal">StatementMetric</code> and the Java class representing the events can be found in the client API in package <code class="literal">com.espertech.esper.client.metric</code>.
        </p><p>
			Since metric events are processed by the engine the same as application events, your EPL may use any construct on such events. For example, your application may select, filter, aggregate properties, sort or insert into a stream, named window or table all metric events the same as application events.
        </p><p>
			This example statement selects all engine metric events:
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from com.espertech.esper.client.metric.EngineMetric</pre><p>
			The next statement selects all statement metric events:
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from com.espertech.esper.client.metric.StatementMetric</pre><p>
			Make sure to have metrics reporting enabled since only then do listeners or subscribers to a statement such as above receive metric events.
        </p><p>
			The engine provides metric events after the configured interval of time has passed. By default, only started statements that have activity within an interval (in the form of event or timer processing) are reported upon.
        </p><p>
			The default configuration performs the publishing of metric events in an Esper daemon thread under the control of the engine instance. Metrics reporting honors externally-supplied time, if using external timer events. 
        </p><p>
			Via runtime configuration options provided by <code class="literal">ConfigurationOperations</code>, your application may enable and disable metrics reporting globally, provided that metrics reporting was enabled at initialization time. Your application may also enable and disable metrics reporting for individual statements by statement name.
        </p><p>
			Statement groups is a configuration feature that allows to assign reporting intervals to statements. Statement groups are described further in the <a class="xref" href="#config-engine-instrumentation" title="15.4.24.Â Engine Settings Related to Metrics Reporting">SectionÂ 15.4.24, âEngine Settings Related to Metrics Reportingâ</a> section. Statement groups cannot be added or removed at runtime. 
        </p><p>
			The following limitations apply:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					If your Java VM version does not report current thread CPU time (most JVM do), then CPU time is reported as zero (use <code class="literal"> ManagementFactory.getThreadMXBean().isCurrentThreadCpuTimeSupported()</code> to determine if your JVM supports this feature).
				</p><p>
					Note: In some JVM the accuracy of CPU time returned is very low (in the order of 10 milliseconds off) which can impact the usefulness of CPU metrics returned. 
					Consider measuring CPU time in your application thread after sending a number of events in the same thread, external to the engine as an alternative.
				</p></li><li><p>
					Your Java VM may not provide high resolution time via <code class="literal">System.nanoTime</code>. In such case wall time may be inaccurate and inprecise.
				</p></li><li><p>
					CPU time and wall time have nanosecond precision but not necessarily nanosecond accuracy, please check with your Java VM provider.
				</p></li><li><p>
					There is a performance cost to collecting and reporting metrics.
				</p></li><li><p>
					Not all statements may report metrics: The engine performs certain runtime optimizations sharing resources between similar statements, thereby not reporting on certain statements unless resource sharing is disabled through configuration.
				</p></li></ul></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-instrumentation-enginemetrics"/>14.14.1.Â Engine Metrics</h3></div></div></div><p>
				Engine metrics are properties of <code class="literal">EngineMetric</code> events:
			</p><div class="table"><a id="api-instrumentation-events-engine"/><p class="title"><b>TableÂ 14.7.Â EngineMetric Properties</b></p><div class="table-contents"><table summary="EngineMetric Properties" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>engineURI</td><td>The URI of the engine instance.</td></tr><tr><td>timestamp</td><td>The current engine time.</td></tr><tr><td>inputCount</td><td>Cumulative number of input events since engine initialization time. Input events are defined as events send in via application threads as well as <code class="literal">insert into</code> events.</td></tr><tr><td>inputCountDelta</td><td>Number of input events since last reporting period.</td></tr><tr><td>scheduleDepth</td><td>Number of outstanding schedules.</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-instrumentation-statementmetrics"/>14.14.2.Â Statement Metrics</h3></div></div></div><p>
				Statement metrics are properties of <code class="literal">StatementMetric</code>. The properties are:
			</p><div class="table"><a id="api-instrumentation-events-statement"/><p class="title"><b>TableÂ 14.8.Â StatementMetric Properties</b></p><div class="table-contents"><table summary="StatementMetric Properties" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>engineURI</td><td>The URI of the engine instance.</td></tr><tr><td>timestamp</td><td>The current engine time.</td></tr><tr><td>statementName</td><td>Statement name, if provided at time of statement creation, otherwise a generated name.</td></tr><tr><td>cpuTime</td><td>Statement processing CPU time (system and user) in nanoseconds (if available by Java VM, obtained from <code class="literal">ThreadMXBean.getCurrentThreadCpuTime</code>).</td></tr><tr><td>wallTime</td><td>Statement processing wall time in nanoseconds (based on <code class="literal">System.nanoTime</code>).</td></tr><tr><td>numInput</td><td>Number of input events to the statement.</td></tr><tr><td>numOutputIStream</td><td>Number of insert stream rows output to listeners or the subscriber, if any.</td></tr><tr><td>numOutputRStream</td><td>Number of remove stream rows output to listeners or the subscriber, if any.</td></tr></tbody></table></div></div><br class="table-break"/><p>
				The totals reported are cumulative relative to the last metric report.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-output-rendering"/>14.15.Â Event Rendering to XML and JSON</h2></div></div></div><p>
			Your application may use the built-in XML and JSON formatters to render output events into a readable textual format, such as for integration or debugging purposes. This section introduces the utility classes in the client <code class="literal">util</code> package for rendering events to strings. Further API information can be found in the JavaDocs.
		</p><p>
			The <code class="literal">EventRenderer</code> interface accessible from the runtime interface via the <code class="literal">getEventRenderer</code> method provides access to JSON and XML rendering. For repeated rendering of events of the same event type or subtypes, it is recommended to obtain a <code class="literal">JSONEventRenderer</code> or <code class="literal">XMLEventRenderer</code> instance and use the <code class="literal">render</code> method provided by the interface. This allows the renderer implementations to cache event type metadata for fast rendering.
		</p><p>
			This example shows how to obtain a renderer for repeated rendering of events of the same type, assuming that <code class="literal">statement</code> is an instance of <code class="literal">EPStatement</code>:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">JSONEventRenderer jsonRenderer = epService.getEPRuntime().
    getEventRenderer().getJSONRenderer(statement.getEventType());</pre><p>
			Assuming that <code class="literal">event</code> is an instance of <code class="literal">EventBean</code>, this code snippet renders an event into the JSON format:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String jsonEventText = jsonRenderer.render("MyEvent", event);</pre><p>
			The XML renderer works the same:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">XMLEventRenderer xmlRenderer = epService.getEPRuntime().
    getEventRenderer().getXMLRenderer(statement.getEventType());</pre><p>
			...and...
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String xmlEventText = xmlRenderer.render("MyEvent", event);</pre><p>
			If the event type is not known in advance or if you application does not want to obtain a renderer instance per event type for fast rendering, your application can use one of the following methods to render an event to a XML or JSON textual format:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String json = epService.getEPRuntime().getEventRenderer().renderJSON(event);
String xml = epService.getEPRuntime().getEventRenderer().renderXML(event);</pre><p>
			Use the <code class="literal">JSONRenderingOptions</code> or <code class="literal">XMLRenderingOptions</code> classes to control how events are rendered. To render specific event properties using a custom event property renderer, specify an <code class="literal">EventPropertyRenderer</code> as part of the options
			that renders event property values to strings. Please see the JavaDoc documentation for more information.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-output-rendering-json"/>14.15.1.Â JSON Event Rendering Conventions and Options</h3></div></div></div><p>
				The JSON renderer produces JSON text according to the standard documented at <code class="literal">http://www.json.org</code>.
			</p><p>
				The renderer formats simple properties as well as nested properties and indexed properties according to the JSON string encoding, array encoding and nested object encoding requirements.
			</p><p>
				The renderer does render indexed properties, it does not render indexed properties that require an index, i.e. if your event representation is backed by POJO objects and your getter method is <code class="literal">getValue(int index)</code>, the indexed property values are not part of the JSON text. This is because the implementation has no way to determine how many index keys there are. A workaround is to have a method such as <code class="literal">Object[] getValue()</code> instead.
			</p><p>
				The same is true for mapped properties that the renderer also renders.  If a property requires a Map key for access, i.e. your getter method is <code class="literal">getValue(String key)</code>, such property values are not part of the result text as there is no way for the implementation to determine the key set.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-output-rendering-xml"/>14.15.2.Â XML Event Rendering Conventions and Options</h3></div></div></div><p>
				The XML renderer produces well-formed XML text according to the XML standard.
			</p><p>
				The renderer can be configured to format simple properties as attributes or as elements. Nested properties and indexed properties are always represented as XML sub-elements to the root or parent element.
			</p><p>
				The root element name provided to the XML renderer must be the element name of the root in the XML document and may include namespace instructions.
			</p><p>
				The renderer does render indexed properties, it does not render indexed properties that require an index, i.e. if your event representation is backed by POJO objects and your getter method is <code class="literal">getValue(int index)</code>, the indexed property values are not part of the XML text. This is because the implementation has no way to determine how many index keys there are. A workaround is to have a method such as <code class="literal">Object[] getValue()</code> instead.
			</p><p>
				The same is true for mapped properties that the renderer also renders.  If a property requires a Map key for access, i.e. your getter method is <code class="literal">getValue(String key)</code>, such property values are not part of the result text as there is no way for the implementation to determine the key set.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-plugin"/>14.16.Â Plug-In Loader</h2></div></div></div><a id="d0e39530" class="indexterm"/><p>
			A plug-in loader is for general use with input adapters, output adapters or EPL code deployment or any other task that can benefits from being part of an Esper configuration file and that follows engine lifecycle.
        </p><p>
			A plug-in loader implements the <code class="literal">com.espertech.esper.plugin.PluginLoader</code> interface and can be listed in the configuration. 
        </p><p>
			Each configured plug-in loader follows the engine instance lifecycle: When an engine instance initializes, it instantiates each <code class="literal">PluginLoader</code> implementation class listed in the configuration. The engine then invokes the lifecycle 
			methods of the <code class="literal">PluginLoader</code> implementation class before and after the engine is fully initialized and before an engine instance is destroyed.
        </p><p>
			Declare a plug-in loader in your configuration XML as follows:
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">...
  &lt;plugin-loader name="MyLoader" class-name="org.mypackage.MyLoader"&gt;
    &lt;init-arg name="property1" value="val1"/&gt;
  &lt;/plugin-loader&gt;
...</pre><p>
			Alternatively, add the plug-in loader via the configuration API:
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
Properties props = new Properties();
props.put("property1", "value1");
config.addPluginLoader("MyLoader", "org.mypackage.MyLoader", props);</pre><p>
			Implement the <code class="literal">init</code> method of your <code class="literal">PluginLoader</code> implementation to receive
			initialization parameters. The engine invokes this method before the engine is fully initialized, therefore your implementation
			should not yet rely on the engine instance within the method body:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyPluginLoader implements PluginLoader {
  public void init(String loaderName, Properties properties, EPServiceProviderSPI epService) {
     // save the configuration for later, perform checking
  }
  ...</pre><p>
			The engine calls the <code class="literal">postInitialize</code> method once the engine completed initialization
			and to indicate the engine is ready for traffic.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void postInitialize() {
  // Start the actual interaction with external feeds or the engine here
}
...</pre><p>
			The engine calls the <code class="literal">destroy</code> method once the engine is destroyed or initialized for a second time.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void destroy() {
  // Destroy resources allocated as the engine instance is being destroyed
}</pre><p>
			To access the plug-in at runtime, the <code class="literal">getContext</code> method provides access under the name <code class="literal">plugin-loader/</code><span class="emphasis"><em>name</em></span>:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epService.getContext().getEnvironment().get("plugin-loader/MyLoader");</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-annotation"/>14.17.Â Interrogating EPL Annotations</h2></div></div></div><a id="d0e39595" class="indexterm"/><p>
			As discussed in <a class="xref" href="#epl-syntax-annotation" title="5.2.7.Â Annotation">SectionÂ 5.2.7, âAnnotationâ</a> an EPL annotation is an addition made to information in an EPL statement. The API and examples to interrogate annotations are described here.
        </p><p>
          You may use the <code class="literal">getAnnotations</code> method of <code class="literal">EPStatement</code> to obtain annotations specified for an EPL statement. Or when compiling an EPL expression to a <code class="literal">EPStatementObjectModel</code> statement object model you may also query, change or add annotations.
        </p><p>
          The following example code demonstrates iterating over an <code class="literal">EPStatement</code> statement's annotations and retrieving values:
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String exampleEPL = "@Tag(name='direct-output', value='sink 1') select * from RootEvent";
EPStatement stmt = epService.getEPAdministrator().createEPL(exampleEPL);
for (Annotation annotation : stmt.getAnnotations()) {
  if (annotation instanceof Tag) {
    Tag tag = (Tag) annotation;
    System.out.println("Tag name " + tag.name() + " value " + tag.value());
  }
}</pre><p>
			The output of the sample code shown above is <code class="literal">Tag name direct-output value sink 1</code>.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-contextpartitionselection"/>14.18.Â Context Partition Selection</h2></div></div></div><p>
			This chapter discusses how to select context partitions. Contexts are discussed in <a class="xref" href="#context" title="ChapterÂ 4.Â Context and Context Partitions">ChapterÂ 4, <i>Context and Context Partitions</i></a> and the reasons for context partition selection are introduced in <a class="xref" href="#context_selection" title="4.9.Â Operations on Specific Context Partitions">SectionÂ 4.9, âOperations on Specific Context Partitionsâ</a>.
        </p><p>
			The section is only relevant when you declare a context. It applies to all different types of hash, partitioned, category, overlapping or other temporal contexts. The section uses a category context for the purpose of illustration. The API discussed herein is general and handles all different types of contexts including nested contexts.
        </p><p>
			Consider a category context that separates bank transactions into small, medium and large:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// declare category context
create context TxnCategoryContext 
  group by amount &lt; 100 as small, 
  group by amount between 100 and 1000 as medium, 
  group by amount &gt; 1000 as large from BankTxn</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// retain 1 minute of events of each category separately
context TxnCategoryContext select * from BankTxn#time(1 minute)</pre><p>
		  In order for your application to iterate one or more specific categories it is necessary to identify which category, i.e. which context partition, to iterate. Similarly for on-demand queries, to execute on-demand queries against one or more specific categories, it is necessary to identify which context partition to execute the on-demand query against.
		</p><p>
			Your application may iterate one or more specific context partitions using either the <code class="literal">iterate</code> or <code class="literal">safeIterate</code> method of <code class="literal">EPStatement</code> by providing an implementation of the <code class="literal">ContextPartitionSelector</code> interface.
        </p><p>
			For example, assume your application must obtain all bank transactions for small amounts. It may use the API to identify the category and iterate the associated context partition:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">ContextPartitionSelectorCategory categorySmall = new ContextPartitionSelectorCategory() {
    public Set&lt;String&gt; getLabels() {
      return Collections.singleton("small");
    }
  };
Iterator&lt;EventBean&gt; it = stmt.iterator(categorySmall);</pre><p>
             Your application may execute on-demand queries against one or more specific context partitions by using the <code class="literal">executeQuery</code> method on <code class="literal">EPRuntime</code> or the <code class="literal">execute</code> method on <code class="literal">EPOnDemandPreparedQuery</code> and by providing an implementation of <code class="literal">ContextPartitionSelector</code>.
        </p><p>
			On-demand queries execute against named windows and tables, therefore below EPL statement creates a named window which the engine manages separately for small, medium and large transactions according to the context declared earlier:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Named window per category
context TxnCategoryContext create window BankTxnWindow#time(1 min) as BankTxn</pre><p>			
			The following code demonstrates how to fire an on-demand query against the small and the medium category:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">ContextPartitionSelectorCategory categorySmallMed = new ContextPartitionSelectorCategory() {
    public Set&lt;String&gt; getLabels() {
      return new HashSet&lt;String&gt;(Arrays.asList("small", "medium"));
    }
  };
epService.getEPRuntime().executeQuery(
   "select count(*) from BankTxnWindow", 
   new ContextPartitionSelector[] {categorySmallMed});</pre><p>
				The following limitations apply:
			</p><div class="itemizedlist"><ul><li><p>
						On-demand queries may not join named windows or tables that declare a context.
					</p></li></ul></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-contextpartitionselection-selectors"/>14.18.1.Â Selectors</h3></div></div></div><p>
				  This section summarizes the selector interfaces that are available for use to identify and interrogate context partitions. Please refer to the JavaDoc documentation for package <code class="literal">com.espertech.esper.client.context</code> and classes therein for additional information.
				</p><p>
					Use an implementation of <code class="literal">ContextPartitionSelectorAll</code> or the <code class="literal">ContextPartitionSelectorAll.INSTANCE</code> object to instruct the engine to consider all context partitions.
				</p><p>
					Use an implementation of <code class="literal">ContextPartitionSelectorById</code> if your application knows the context partition ids to query. This selector instructs the engine to consider only those provided context partitions based on their integer id value. The engine outputs the context partition id in the built-in property <code class="literal">context.id</code>.
				</p><p>
				    Use an implementation of <code class="literal">ContextPartitionSelectorFiltered</code> to receive and interrogate context partitions. Use the <code class="literal">filter</code> method that receives a <code class="literal">ContextPartitionIdentifier</code> to return a boolean indicator whether to include the context partition or not. The <code class="literal">ContextPartitionIdentifier</code> provides information about each context partition. Your application may not retain <code class="literal">ContextPartitionIdentifier</code> instances between <code class="literal">filter</code> method invocations as the engine reuses the same instance. This selector is not supported with nested contexts.
				</p><p>
				    Use an implementation of <code class="literal">ContextPartitionSelectorCategory</code> with category contexts.
				</p><p>
				    Use an implementation of <code class="literal">ContextPartitionSelectorSegmented</code> with keyed segmented contexts.
				</p><p>
				    Use an implementation of <code class="literal">ContextPartitionSelectorHash</code> with hash segmented contexts.
				</p><p>
				    Use an implementation of <code class="literal">ContextPartitionSelectorNested</code> in combination with the selectors described above with nested contexts.
				</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-contextpartitionadmin"/>14.19.Â Context Partition Administration</h2></div></div></div><a id="d0e39762" class="indexterm"/><p>
			This chapter briefly discusses the API to manage context partitions. Contexts are discussed in <a class="xref" href="#context" title="ChapterÂ 4.Â Context and Context Partitions">ChapterÂ 4, <i>Context and Context Partitions</i></a>.
        </p><p>
			The section is only relevant when you declare a context. It applies to all different types of hash, partitioned, category, overlapping or other temporal contexts.
        </p><p>
			The administrative API for context partitions is <code class="literal">EPContextPartitionAdmin</code>. Use the <code class="literal">getContextPartitionAdmin</code> method of the <code class="literal">EPAdministrator</code> interface 
			to obtain said service.
		</p><p>
			The context partition admin API allows an application to:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					Start, stop and destroy individual context partitions.
				</p></li><li><p>
					Interrogate the state and identifiers for existing context partitions.
				</p></li><li><p>
					Determine statements associated to a context and context nesting level.
				</p></li><li><p>
					Receive a callback when new contexts get created and destroyed or when context partitions are allocated and de-allocated.
				</p></li><li><p>
					Obtain context properties.
				</p></li></ul></div><p>
			Stopping individual context partitions is useful to drop state, free memory and suspend a given context partition without stopping or destroying any associated statements.
			For example, assume a keyed segmented context per user id. To suspend and free the memory for a given user id your application can stop the user id's context partition. 
			The engine does not allocate a context partition for this user id again, until your application destroys or starts the context partition.
		</p><p>
			Destroying individual context partitions is useful to drop state, free memory and deregister the given context partition without stopping or destroying any associated statements.
			For example, assume a keyed segmented context per user id. To deregister and free the memory for a given user id your application can destroy the user id's context partition.
			The engine can allocate a fresh context partition for this user id when events for this user id arrive.
		</p><p>
			Please see the JavaDoc documentation for more information.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-testing"/>14.20.Â Test and Assertion Support</h2></div></div></div><a id="d0e39809" class="indexterm"/><a id="d0e39812" class="indexterm"/><p>
			Esper offers a listener and an assertions class to facilitate automated testing of EPL rules, for example when using a test framework such as <code class="literal">JUnit</code> or <code class="literal">TestNG</code>. 
        </p><p>
			Esper does not require any specific test framework. If your application has the <code class="literal">JUnit</code> test framework in classpath Esper uses <code class="literal">junit.framework.AssertionFailedError</code> to indicate assertion errors, so as to integrate with continuous integration tools.
        </p><p>
            For detailed method-level information, please consult the JavaDoc of the package <code class="literal">com.espertech.esper.client.scopetest</code>.
        </p><p>
            The class <code class="literal">com.espertech.esper.client.scopetest.EPAssertionUtil</code> provides methods to assert or compare event property values as well as perform various array arthithmatic, sort events and convert events or iterators to arrays.
        </p><p>
            The class <code class="literal">com.espertech.esper.client.scopetest.SupportUpdateListener</code> provides an <code class="literal">UpdateListener</code> implementation that collects events and returns event data for assertion.
        </p><p>
            The class <code class="literal">com.espertech.esper.client.scopetest.SupportSubscriber</code> provides a subscriber implementation that collects events and returns event data for assertion. The <code class="literal">SupportSubscriberMRD</code> is a subscriber that accepts events multi-row delivery. The <code class="literal">SupportSubscriber</code> and <code class="literal">SupportSubscriberMRD</code> work similar to <code class="literal">SupportUpdateListener</code> that is introduced in more detail below.
        </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-testing-assertion"/>14.20.1.Â <code class="literal">EPAssertionUtil</code> Summary</h3></div></div></div><p>
			  The below table only summarizes the most relevant assertion methods offered by <code class="literal">EPAssertionUtil</code>. Methods provide multiple footprints that are not listed in detail below. Please consult the JavaDoc for additional method-level information.
			</p><div class="table"><a id="api-testing-assertion-summary"/><p class="title"><b>TableÂ 14.9.Â Method Summary for EPAssertionUtil</b></p><div class="table-contents"><table summary="Method Summary for EPAssertionUtil" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">assertProps</code></td><td><p>Methods that assert that property values of a single <code class="literal">EventBean</code>, POJO or Map matches compared to expected values.</p></td></tr><tr><td><code class="literal">assertPropsPerRow</code></td><td><p>Methods that assert that property values of multiple <code class="literal">EventBean</code>, POJOs or Maps match compared to expected values.</p></td></tr><tr><td><code class="literal">assertPropsPerRowAnyOrder</code></td><td><p>Same as above, but any row may match. Useful for unordered result sets.</p></td></tr><tr><td><code class="literal">assertEqualsExactOrder</code></td><td><p>Methods that compare arrays, allowing <code class="literal">null</code>. as parameters.</p></td></tr><tr><td><code class="literal">assertEqualsAnyOrder</code></td><td><p>Same as above, but any row may match. Useful for unordered result sets.</p></td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-testing-listener"/>14.20.2.Â <code class="literal">SupportUpdateListener</code> Summary</h3></div></div></div><p>
			  The below table only summarizes the most relevant methods offered by <code class="literal">SupportUpdateListener</code>. Please consult the JavaDoc for additional information.
			</p><div class="table"><a id="api-testing-listener-summary"/><p class="title"><b>TableÂ 14.10.Â Method Summary for SupportUpdateListener</b></p><div class="table-contents"><table summary="Method Summary for SupportUpdateListener" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">reset</code></td><td><p>Initializes listener clearing current events and resetting the invoked flag.</p></td></tr><tr><td><code class="literal">getAndClearIsInvoked</code></td><td><p>Returns the "invoked" flag indicating the listener has been invoked, and clears the flag.</p></td></tr><tr><td><code class="literal">getLastNewData</code></td><td><p>Returns the last events received by the listener.</p></td></tr><tr><td><code class="literal">getAndResetDataListsFlattened</code></td><td><p>Returns all events received by the listener as a pair.</p></td></tr><tr><td><code class="literal">assertOneGetNewAndReset</code></td><td><p>Asserts that exactly one new event was received and no removed events, returns the event and resets the listener.</p></td></tr><tr><td><code class="literal">assertOneGetNew</code></td><td><p>Asserts that exactly one new event was received and returns the event.</p></td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="api-testing-usage"/>14.20.3.Â Usage Example</h3></div></div></div><p>
			  The next code block is a short but complete programming example that asserts that the properties received from output events match expected value.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String epl = "select personName, count(*) as cnt from PersonEvent#length(3) group by personName";
EPStatement stmt = epService.getEPAdministrator().createEPL(epl);

SupportUpdateListener listener = new SupportUpdateListener();
stmt.addListener(listener);

epService.getEPRuntime().sendEvent(new PersonEvent("Joe"));
EPAssertionUtil.assertProps(listener.assertOneGetNewAndReset(), "personName,cnt".split(","),
    new Object[]{"Joe", 1L});</pre><p>
			  A few additional examples are shown below:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String[] fields = new String[] {"property"};			
EPAssertionUtil.assertPropsPerRow(listener.getAndResetDataListsFlattened(), fields, 
    new Object[][]{{"E2"}}, new Object[][]{{"E1"}});</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPAssertionUtil.assertPropsPerRow(listener.getAndResetLastNewData(), fields, 
    new Object[][]{{"E1"}, {"E2"}, {"E3"}});</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">assertTrue(listener.getAndClearIsInvoked());</pre><p>
			  Please refer to the Esper codebase test sources for more examples using the assertion class and the listener class. 
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="api-osgi"/>14.21.Â OSGi, Class Loader, Class-For-Name</h2></div></div></div><a id="d0e40020" class="indexterm"/><a id="d0e40023" class="indexterm"/><a id="d0e40026" class="indexterm"/><p>
			Esper's static configuration object (<code class="literal">Configuration</code>), in respect to classes, holds the fully-qualified class name and does not generally hold <code class="literal">Class</code> references.
			This is by design since the configuration object can be populated from XML.
		</p><p>
			At engine initialization time, Esper may look up classes using the fully-qualified class name. If using bean event types, the <code class="literal">Class.forName()</code> call can be avoided by 
			using the runtime configuration API such as <code class="literal">epService.getEPAdministrator().getConfiguration().addEventType(MyEvent.class);</code>.
		</p><p>
			When creating new EPL statements, Esper may need to look up a class by name and may need to obtain a class loader for CGLib <code class="literal">FastClass</code> creation.
			For deploying resources using the deployment admin API, Esper may also use a class loader to find resources as described in the JavaDoc.
			Your application has full control over class-for-name and classloader use. OSGi environments can provide a specific class-for-name and class loader.
			Please refer to <a class="xref" href="#configuration-transientobjects" title="15.3.Â Passing Services or Transient Objects">SectionÂ 15.3, âPassing Services or Transient Objectsâ</a>.
		</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="configuration"/>ChapterÂ 15.Â Configuration</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#configuration-programmatic">15.1. Programmatic Configuration</a></span></dt><dt><span class="sect1"><a href="#configuration-via-xml">15.2. Configuration via XML File</a></span></dt><dt><span class="sect1"><a href="#configuration-transientobjects">15.3. Passing Services or Transient Objects</a></span></dt><dd><dl><dt><span class="sect2"><a href="#configuration-transientobjects-service">15.3.1. Service Example</a></span></dt><dt><span class="sect2"><a href="#configuration-transientobjects-classforname">15.3.2. Class-for-Name</a></span></dt><dt><span class="sect2"><a href="#configuration-transientobjects-classloader">15.3.3. Class Loader</a></span></dt><dt><span class="sect2"><a href="#configuration-transientobjects-classloaderfastclass">15.3.4. Class Loader CGLib FastClass</a></span></dt></dl></dd><dt><span class="sect1"><a href="#configuration-items">15.4. Configuration Items</a></span></dt><dd><dl><dt><span class="sect2"><a href="#config-java">15.4.1. Events Represented by Java Classes</a></span></dt><dt><span class="sect2"><a href="#config-java-util-map">15.4.2. Events Represented by java.util.Map</a></span></dt><dt><span class="sect2"><a href="#config-objectarray">15.4.3. Events Represented by Object[] (Object-array)</a></span></dt><dt><span class="sect2"><a href="#config-avro">15.4.4. Events Represented by Avro GenericData.Record</a></span></dt><dt><span class="sect2"><a href="#config-xml-dom">15.4.5. Events Represented by org.w3c.dom.Node</a></span></dt><dt><span class="sect2"><a href="#config-plugineventrep">15.4.6. Events Represented by Plug-in Event Representations</a></span></dt><dt><span class="sect2"><a href="#config-class--package-imports">15.4.7. Class and Package Imports</a></span></dt><dt><span class="sect2"><a href="#config-class--package-imports-annotations">15.4.8. Annotation Class and Package Imports</a></span></dt><dt><span class="sect2"><a href="#config-method-invocations">15.4.9. Cache Settings for From-Clause Method Invocations</a></span></dt><dt><span class="sect2"><a href="#config-variables">15.4.10. Variables</a></span></dt><dt><span class="sect2"><a href="#config-database-ref">15.4.11. Relational Database Access</a></span></dt><dt><span class="sect2"><a href="#config-engine-bytecodegen">15.4.12. Engine Settings Related to Byte Code Generation and Compilation</a></span></dt><dt><span class="sect2"><a href="#config-engine-threading">15.4.13. Engine Settings Related to Concurrency and Threading</a></span></dt><dt><span class="sect2"><a href="#config-engine-eventmeta">15.4.14. Engine Settings Related to Event Metadata</a></span></dt><dt><span class="sect2"><a href="#config-engine-viewresources">15.4.15. Engine Settings Related to View Resources</a></span></dt><dt><span class="sect2"><a href="#config-engine-logging">15.4.16. Engine Settings Related to Logging</a></span></dt><dt><span class="sect2"><a href="#config-engine-variables">15.4.17. Engine Settings Related to Variables</a></span></dt><dt><span class="sect2"><a href="#config-engine-patterns">15.4.18. Engine Settings Related to Patterns</a></span></dt><dt><span class="sect2"><a href="#config-engine-matchrecognize">15.4.19. Engine Settings Related to Match-Recognize</a></span></dt><dt><span class="sect2"><a href="#config-engine-scripts">15.4.20. Engine Settings Related to Scripts</a></span></dt><dt><span class="sect2"><a href="#config-engine-stream-selection">15.4.21. Engine Settings Related to Stream Selection</a></span></dt><dt><span class="sect2"><a href="#config-engine-time-source">15.4.22. Engine Settings Related to Time Source</a></span></dt><dt><span class="sect2"><a href="#config-engine-jmxmetrics">15.4.23. Engine Settings Related to JMX Metrics</a></span></dt><dt><span class="sect2"><a href="#config-engine-instrumentation">15.4.24. Engine Settings Related to Metrics Reporting</a></span></dt><dt><span class="sect2"><a href="#config-engine-language">15.4.25. Engine Settings Related to Language and Locale</a></span></dt><dt><span class="sect2"><a href="#config-engine-expression">15.4.26. Engine Settings Related to Expression Evaluation</a></span></dt><dt><span class="sect2"><a href="#config-engine-execution">15.4.27. Engine Settings Related to Execution of Statements</a></span></dt><dt><span class="sect2"><a href="#config-engine-exceptionhandling">15.4.28. Engine Settings Related to Exception Handling</a></span></dt><dt><span class="sect2"><a href="#config-engine-conditionhandling">15.4.29. Engine Settings Related to Condition Handling</a></span></dt><dt><span class="sect2"><a href="#config-revisionevent">15.4.30. Revision Event Type</a></span></dt><dt><span class="sect2"><a href="#config-variantstream">15.4.31. Variant Stream</a></span></dt></dl></dd><dt><span class="sect1"><a href="#configuration-type-names">15.5. Type Names</a></span></dt><dt><span class="sect1"><a href="#configuration-runtime">15.6. Runtime Configuration</a></span></dt><dt><span class="sect1"><a href="#configuration-logging">15.7. Logging Configuration</a></span></dt><dd><dl><dt><span class="sect2"><a href="#configuration-logging-log4j">15.7.1. Log4j Logging Configuration</a></span></dt></dl></dd></dl></div><a id="d0e40055" class="indexterm"/><a id="d0e40060" class="indexterm"/><p>
        Esper engine configuration is entirely optional. Esper has a very small number of configuration parameters that can be used to simplify event 
        pattern and EPL statements, and to tune the engine behavior to specific requirements. The Esper engine works out-of-the-box without configuration.
    </p><p>
        An application can supply configuration at the time of engine allocation using the <code class="literal">Configuration</code> class, and can also use XML files to hold configuration. Configuration can be changed at runtime
        via the <code class="literal">ConfigurationOperations</code> interface available from <code class="literal">EPAdministrator</code> via the <code class="literal">getConfiguration</code> method.
    </p><p>
		The difference between using a <code class="literal">Configuration</code> object and the <code class="literal">ConfigurationOperations</code> interface is that for the latter, all configuration including event types added through that interface are considered runtime configurations. 
		This means they will be discarded when calling the <code class="literal">initialize</code> method on an <code class="literal">EPServiceProvider</code> instance.
    </p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-programmatic"/>15.1.Â Programmatic Configuration</h2></div></div></div><a id="d0e40096" class="indexterm"/><p>
            An instance of <code class="literal">com.espertech.esper.client.Configuration</code> represents all configuration parameters. The <code class="literal">Configuration</code> is used to build an <code class="literal">EPServiceProvider</code>, which provides the administrative and runtime interfaces for an Esper engine instance.
        </p><p>
            You may obtain a <code class="literal">Configuration</code> instance by instantiating it directly and adding or setting values on it. The <code class="literal">Configuration</code> instance is then passed to <code class="literal">EPServiceProviderManager</code> to obtain a configured Esper engine.
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration configuration = new Configuration();
configuration.addEventType("PriceLimit", PriceLimit.class.getName());
configuration.addEventType("StockTick", StockTick.class.getName());
configuration.addImport("org.mycompany.mypackage.MyUtility");
configuration.addImport("org.mycompany.util.*");

EPServiceProvider epService = EPServiceProviderManager.getProvider("sample", configuration);
</pre><p>
			Note that <code class="literal">Configuration</code> is meant only as an initialization-time object. The Esper engine represented by an <code class="literal">EPServiceProvider</code> does not retain any association back to the <code class="literal">Configuration</code>.
        </p><p>
			 For adding a type at runtime please use either EPL <code class="literal">create schema</code> or <code class="literal">epServiceProvider.getEPAdministrator().getConfiguration().addEventType(...)</code>.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-via-xml"/>15.2.Â Configuration via XML File</h2></div></div></div><a id="d0e40147" class="indexterm"/><p>
			An alternative approach to configuration is to specify a configuration in a XML file. 
        </p><p>
			The default name for the XML configuration file is <code class="literal">esper.cfg.xml</code>. Esper reads this file from the root of the <code class="literal">CLASSPATH</code> as an application resource via the <code class="literal">configure</code> method.
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration configuration = new Configuration();		
configuration.configure();
</pre><p>
			The <code class="literal">Configuration</code> class can read the XML configuration file from other sources as well. The <code class="literal">configure</code> method accepts <code class="literal">URL, File and String</code> filename parameters.
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration configuration = new Configuration();		
configuration.configure("myengine.esper.cfg.xml");
</pre><p>
			Here is an example configuration file.
            The schema for the configuration file can be found in the <code class="literal">etc</code> folder and is named <code class="literal">esper-configuration-7-0.xsd</code>.
            It is also available online at <code class="literal">http://www.espertech.com/schema/esper/esper-configuration-</code><span class="emphasis"><em>majorversion</em></span><code class="literal">-0.xsd</code> so that IDE can fetch it automatically.
            The namespace used is <code class="literal">http://www.espertech.com/schema/esper</code>.
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;esper-configuration xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="http://www.espertech.com/schema/esper"
    xsi:schemaLocation="
http://www.espertech.com/schema/esper
http://www.espertech.com/schema/esper/esper-configuration-7-0.xsd"&gt;
  &lt;event-type name="StockTick" class="com.espertech.esper.example.stockticker.event.StockTick"/&gt;
  &lt;event-type name="PriceLimit" class="com.espertech.esper.example.stockticker.event.PriceLimit"/&gt;
  &lt;auto-import import-name="org.mycompany.mypackage.MyUtility"/&gt;
  &lt;auto-import import-name="org.mycompany.util.*"/&gt;
&lt;/esper-configuration&gt;		
</pre><p>
			The example above is only a subset of the configuration items available. The next chapters outline the available configuration in greater detail.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-transientobjects"/>15.3.Â Passing Services or Transient Objects</h2></div></div></div><a id="d0e40205" class="indexterm"/><p>
			The <code class="literal">Configuration</code> object allows passing application objects such as services or other transient objects. 
			This information can be used by extensions, listeners or subscribers, for example, to obtain application objects from the engine.	
			Your application may provide a custom class loader or class-for-name service.
        </p><p>
			Use <code class="literal">setTransientConfiguration</code> and provide a <code class="literal">Map&lt;String, Object&gt;</code> that contains the application objects.
			The engine retains and makes available the same <code class="literal">Map</code> instance as part of <code class="literal">ConfigurationOperations</code> that is available as part of the adminstrative interface,
			and contents including services can be changed by an application at runtime.
        </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="configuration-transientobjects-service"/>15.3.1.Â Service Example</h3></div></div></div><p>
				Assuming your application has a service <code class="literal">myLocalService</code> instance, the example code is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration configuration = new Configuration();
HashMap&lt;String, Object&gt; transients = new HashMap&lt;String, Object&gt;();
transients.put(SERVICE_NAME, myLocalService); // SERVICE_NAME is a well-known string value defined elsewhere
configuration.setTransientConfiguration(transients);

EPServiceProvider epService = EPServiceProviderManager.getDefaultProvider(configuration);</pre><p>
				A sample listener that receives a service from transient configuation is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyListener implements StatementAwareUpdateListener {
  public void update(EventBean[] newEvents, EventBean[] oldEvents, EPStatement statement, EPServiceProvider epServiceProvider) {
    MyLocalService service = (MyLocalService) epServiceProvider.getEPAdministrator().getConfiguration().getTransientConfiguration().get(SERVICE_NAME);
    // use the service here
  }
}</pre><p>
				An alternative means to obtain application services is to define a constant variable.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="configuration-transientobjects-classforname"/>15.3.2.Â Class-for-Name</h3></div></div></div><p>
				By default, when resolving a fully-qualified class name to a <code class="literal">Class</code>, the <code class="literal">com.espertech.esper.client.util.ClassForNameProviderDefault</code> uses:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">ClassLoader cl = Thread.currentThread().getContextClassLoader();
return Class.forName(className, true, cl);</pre><p>
				Your application can implement the <code class="literal">com.espertech.esper.client.util.ClassForNameProvider</code> interface to provide an alternate implementation.
			</p><p>
				For example, this provider prevents the <code class="literal">System</code> class from being available in EPL:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epService.getEPAdministrator().getConfiguration().getTransientConfiguration().put(ClassForNameProvider.NAME,
  new ClassForNameProvider() {
    public Class classForName(String className) throws ClassNotFoundException {
      if (className.equals(System.class.getName())) { // prevent the System class from loading
        return null;
      }
      return Class.forName(className, true, Thread.currentThread().getContextClassLoader());
   }
});</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="configuration-transientobjects-classloader"/>15.3.3.Â Class Loader</h3></div></div></div><p>
				By default, to obtain a class loader, the <code class="literal">com.espertech.esper.client.util.ClassLoaderProviderDefault</code> uses <code class="literal">Thread.currentThread().getContextClassLoader()</code>.
			</p><p>
				Your application can implement the <code class="literal">com.espertech.esper.client.util.ClassLoaderProvider</code> interface to provide an alternate implementation.
			</p><p>
				For example, this provider returns a pre-determined classloader:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">ClassLoader classLoader = new CustomClassLoader();
epService.getEPAdministrator().getConfiguration().getTransientConfiguration().put(ClassLoaderProvider.NAME,
  new ClassLoaderProvider() {
    public ClassLoader classloader() {
      return classLoader;
    }
});</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="configuration-transientobjects-classloaderfastclass"/>15.3.4.Â Class Loader CGLib <code class="literal">FastClass</code></h3></div></div></div><p>
				By default, to obtain a class loader for use with CGLib <code class="literal">FastClass</code> code generation, the <code class="literal">com.espertech.esper.client.util.FastClassClassLoaderProviderDefault</code> uses <code class="literal">Thread.currentThread().getContextClassLoader()</code>.
			</p><p>
				Your application can implement the <code class="literal">com.espertech.esper.client.util.FastClassClassLoaderProvider</code> interface to provide an alternate implementation.
			</p><p>
				For example, this provider uses the class loader associated to the class:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epService.getEPAdministrator().getConfiguration().getTransientConfiguration().put(FastClassClassLoaderProvider.NAME,
  new FastClassClassLoaderProvider() {
    public ClassLoader classloader(Class clazz) {
      return clazz.getClassLoader();
    }
});</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-items"/>15.4.Â Configuration Items</h2></div></div></div><a id="d0e40318" class="indexterm"/><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-java"/>15.4.1.Â Events Represented by Java Classes</h3></div></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-java-package-alias"/>15.4.1.1.Â Package of Java Event Classes</h4></div></div></div><p>
					Via this configuration an application can make the Java package or packages that contain an application's Java event classes known to an engine. 
					Thereby an application can simply refer to event types in statements by using the simple class name of
					each Java class representing an event type.
				</p><p>
					For example, consider an order-taking application that places all event classes in package <code class="literal">com.mycompany.order.event</code>. One Java class representing an event is the class <code class="literal">OrderEvent</code>. 
					The application can simply issue a statement as follows to select <code class="literal">OrderEvent</code> events:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from OrderEvent</pre><p>
					The XML configuration for defining the Java packages that contain Java event classes is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;event-type-auto-name package-name="com.mycompany.order.event"/&gt;</pre><p>
					The same configuration but using the <code class="literal">Configuration</code> class:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.addEventTypeAutoName("com.mycompany.order.event");
// ... or ...
config.addEventTypeAutoName(MyEvent.getPackage().getName());</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-java-event-name"/>15.4.1.2.Â Event type name to Java class mapping</h4></div></div></div><p>
					This configuration item can be used to allow event pattern statements and EPL statements to use an event type name rather then the fully qualified Java class name. Note that Java Interface classes and abstract classes are also supported as event types via the fully qualified Java class name, and an event type name can also be defined for such classes.
				</p><p>
					The example pattern statement below first shows a pattern that uses the name <code class="literal">StockTick</code>. The second pattern statement is equivalent but specifies the fully-qualified Java class name.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every StockTick(symbol='IBM')"</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every com.espertech.esper.example.stockticker.event.StockTick(symbol='IBM')</pre><p>
					The event type name can be listed in the XML configuration file as shown below. The <code class="literal">Configuration</code> API can also be used to programatically specify an event type name, as shown in an earlier code snippet.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;event-type name="StockTick" class="com.espertech.esper.example.stockticker.event.StockTick"/&gt;</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-java-legacy"/>15.4.1.3.Â Non-JavaBean and Legacy Java Event Classes</h4></div></div></div><p>
					Esper can process Java classes that provide event properties through other means then through JavaBean-style getter methods. It is not necessary that the method and member variable names in your Java class adhere to the JavaBean convention - any public methods and public member variables can be exposed as event properties via the below configuration.
				</p><p>
					A Java class can optionally be configured with an accessor style attribute. This attribute instructs the engine how it should expose methods and fields for use as event properties in statements.
				</p><div class="table"><a id="d0e40383"/><p class="title"><b>TableÂ 15.1.Â Accessor Styles</b></p><div class="table-contents"><table summary="Accessor Styles" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Style Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">javabean</code></td><td>As the default setting, the engine exposes an event property for each public method following the JavaBean getter-method conventions</td></tr><tr><td><code class="literal">public</code></td><td>The engine exposes an event property for each public method and public member variable of the given class</td></tr><tr><td><code class="literal">explicit</code></td><td>The engine exposes an event property only for the explicitly configured public methods and public member variables</td></tr></tbody></table></div></div><br class="table-break"/><p>
					For NEsper .NET accessor styles are <code class="literal">NATIVE</code>, <code class="literal">PUBLIC</code> and <code class="literal">EXPLICIT</code>.
				</p><p>
					Using the <code class="literal">public</code> setting for the <code class="literal">accessor-style</code> attribute instructs the engine to expose an event property for each public method and public member variable of a Java class. The engine assigns event property names of the same name as the name of the method or member variable in the Java class.
				</p><p>					
					For example, assuming the class <code class="literal">MyLegacyEvent</code> exposes a method named <code class="literal">readValue</code> and a member variable named <code class="literal">myField</code>, you can then use properties as shown. 
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select readValue, myField from MyLegacyEvent</pre><p>
					Using the <code class="literal">explicit</code> setting for the <code class="literal">accessor-style</code> attribute requires that event properties are declared via configuration. This is outlined in the next chapter.
				</p><p>
					When configuring an engine instance from a XML configuration file, the XML snippet below demonstrates the use of the <code class="literal">legacy-type</code> element and the <code class="literal">accessor-style</code> attribute.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;event-type name="MyLegacyEvent" class="com.mycompany.mypackage.MyLegacyEventClass"&gt;
  &lt;legacy-type accessor-style="public"/&gt;
&lt;/event-type&gt;</pre><p>
					When configuring an engine instance via Configuration API, the sample code below shows how to set the accessor style.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration configuration = new Configuration();
ConfigurationEventTypeLegacy legacyDef = new ConfigurationEventTypeLegacy();
legacyDef.setAccessorStyle(ConfigurationEventTypeLegacy.AccessorStyle.PUBLIC);
config.addEventType("MyLegacyEvent", MyLegacyEventClass.class.getName(), legacyDef);

EPServiceProvider epService = EPServiceProviderManager.getProvider("sample", configuration);
</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-java-spec-properties"/>15.4.1.4.Â Specifying Event Properties for Java Classes</h4></div></div></div><p>
					Sometimes it may be convenient to use event property names in pattern and EPL statements that are backed up by a given public method or member variable (field) in a Java class. And it can be useful to declare multiple event properties that each map to the same method or member variable.
				</p><p>
					We can configure properties of events via <code class="literal">method-property</code> and <code class="literal">field-property</code> elements, as the next example shows.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;event-type name="StockTick" class="com.espertech.esper.example.stockticker.event.StockTickEvent"&gt;
	&lt;legacy-type accessor-style="javabean" code-generation="enabled"&gt;
		&lt;method-property name="price" accessor-method="getCurrentPrice" /&gt;
		&lt;field-property name="volume" accessor-field="volumeField" /&gt;
	&lt;/legacy-type&gt;
&lt;/event-type&gt;</pre><p>
					The XML configuration snippet above declared an event property named <code class="literal">price</code> backed by a getter-method named <code class="literal">getCurrentPrice</code>, and a second event property named <code class="literal">volume</code> that is backed by a public member variable named <code class="literal">volumeField</code>. Thus the price and volume properties can be used in a statement:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select avg(price * volume) from StockTick</pre><p>
					As with all configuration options, the API can also be used:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration configuration = new Configuration();
ConfigurationEventTypeLegacy legacyDef = new ConfigurationEventTypeLegacy();
legacyDef.addMethodProperty("price", "getCurrentPrice");
legacyDef.addFieldProperty("volume", "volumeField");
config.addEventType("StockTick", StockTickEvent.class.getName(), legacyDef);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-java-bytecodegen"/>15.4.1.5.Â Turning off Byte Code Generation</h4></div></div></div><p>
					Esper employes the <code class="literal">CGLIB</code> library for very fast read access to event property values. For certain legacy Java classes it may be desirable to disable the use of this library and instead use Java reflection to obtain event property values from event objects.
				</p><p>
					In the XML configuration, the optional <code class="literal">code-generation</code> attribute in the <code class="literal">legacy-type</code> section can be set to <code class="literal">disabled</code> as shown next.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;event-type name="MyLegacyEvent" class="com.mycompany.package.MyLegacyEventClass"&gt;
	&lt;legacy-type accessor-style="javabean" code-generation="disabled" /&gt;
&lt;/event-type&gt;
</pre><p>
					The sample below shows how to configure this option via the API.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration configuration = new Configuration();
ConfigurationEventTypeLegacy legacyDef = new ConfigurationEventTypeLegacy();
legacyDef.setCodeGeneration(ConfigurationEventTypeLegacy.CodeGeneration.DISABLED);
config.addEventType("MyLegacyEvent", MyLegacyEventClass.class.getName(), legacyDef);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-java-property-case-sensitivity"/>15.4.1.6.Â Case Sensitivity and Property Names</h4></div></div></div><p>
					By default the engine resolves Java event properties case sensitive. That is, property names in statements must match JavaBean-convention property names in name and case. This option controls case sensitivity per Java class.
				</p><p>
					In the configuration XML, the optional <code class="literal">property-resolution-style</code> attribute in the <code class="literal">legacy-type</code> element can be set to any of these values:
				</p><div class="table"><a id="d0e40541"/><p class="title"><b>TableÂ 15.2.Â Property Resolution Case Sensitivity Styles</b></p><div class="table-contents"><table summary="Property Resolution Case Sensitivity Styles" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Style Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">case_sensitive (default)</code></td><td>As the default setting, the engine matches property names for the exact name and case only.</td></tr><tr><td><code class="literal">case_insensitive</code></td><td>Properties are matched if the names are identical.  A case insensitive search is used and will choose the first property that matches the name exactly 
											or the first property that matches case insensitively should no match be found.
								</td></tr><tr><td><code class="literal">distinct_case_insensitive</code></td><td>Properties are matched if the names are identical.  A case insensitive search is used and will choose the first property that matches the name exactly case insensitively.  If more than one 'name' can be mapped to the property an exception is thrown.</td></tr></tbody></table></div></div><br class="table-break"/><p>
					The sample below shows this option in XML configuration, however the setting can also be changed via API:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;event-type name="MyLegacyEvent" class="com.mycompany.package.MyLegacyEventClass"&gt;
  &lt;legacy-type property-resolution-style="case_insensitive"/&gt;
&lt;/event-type&gt;</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-java-factory-copy-method"/>15.4.1.7.Â Factory and Copy Method</h4></div></div></div><p>
					The <code class="literal">insert into</code> clause and directly instantiate and populate your event object. By default the engine invokes the default constructor to instantiate an event object. To change this behavior, you may configure
					a factory method. The factory method is a method name or a class name plus a method name (in the format class.method) that returns an instance of the class.
				</p><p>
					The <code class="literal">update</code> clause can change event properties on an event object. For the purpose of maintaining consistency, the engine may have to copy your event object via serialization (implement the <code class="literal">java.io.Serializable</code> interface). If instead you do not want any copy operations to occur, or your application needs to control the copy operation, you may configure a copy method. The copy method is the name of a method on the event object that copies the event object.
				</p><p>
					The sample below shows this option in XML configuration, however the setting can also be changed via <code class="literal">ConfigurationEventTypeLegacy</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;event-type name="MyLegacyEvent" class="com.mycompany.package.MyLegacyEventClass"&gt;
  &lt;legacy-type factory-method="com.mycompany.myapp.MySampleEventFactory.createMyLegacyTypeEvent" copy-method="myCopyMethod"/&gt;
&lt;/event-type&gt;</pre><p>
				  The copy method should be a public method that takes no parameters and returns a new event object (it may not return <code class="literal">this</code>). The copy method may not be a static method and may not take parameters.
				</p><p>
				  The <code class="literal">Beacon</code> data flow operator in connection with the Sun JVM can use <code class="literal">sun.reflect.ReflectionFactory</code> if the class has no default no-argument constructor.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-java-startendtimestamp"/>15.4.1.8.Â Start and End Timestamp</h4></div></div></div><p>
					For use with date-time interval methods, for example, you may let the engine know which property of your class carries the start and end timestamp value.
				</p><p>
					The sample below shows this option in XML configuration, however the setting can also be changed via API. The sample sets the name of the property providing the start timestamp to <code class="literal">startts</code> and the name of the property providing the end timestamp <code class="literal">endts</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;event-type name="MyLegacyEvent" class="com.mycompany.package.MyLegacyEventClass"&gt;
  &lt;legacy-type start-timestamp-property-name="startts" end-timestamp-property-name="endts"/&gt;
&lt;/event-type&gt;
</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-java-util-map"/>15.4.2.Â Events Represented by <code class="literal">java.util.Map</code></h3></div></div></div><p>
				The engine can process <code class="literal">java.util.Map</code> events via the <code class="literal">sendEvent(Map map, String eventTypeName)</code> method on the <code class="literal">EPRuntime</code> interface. Entries in the Map represent event properties. Please see the <a class="xref" href="#appendix_eventrepmap" title="AppendixÂ E.Â Event Representation: java.util.Map Events">AppendixÂ E, <i>Event Representation: java.util.Map Events</i></a> section for details on how to use <code class="literal">Map</code> events with the engine.
			</p><p>
				Via configuration you can provide an event type name for <code class="literal">Map</code> events for use in statements, and the event property names and types enabling the engine to validate properties in statements.
			</p><p>
				The below snippet of XML configuration configures an event type named <code class="literal">MyMapEvent</code>.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;event-type name="MyMapEvent"&gt;
  &lt;java-util-map&gt;
    &lt;map-property name="carId" class="int"/&gt;
    &lt;map-property name="carType" class="string"/&gt;
    &lt;map-property name="assembly" class="com.mycompany.Assembly"/&gt;    
  &lt;/java-util-map&gt;
&lt;/event-type&gt;</pre><p>
				For NEsper .NET use <code class="literal">util-map</code> instead of <code class="literal">java-util-map</code>.
			</p><p>
				This configuration defines the <code class="literal">carId</code> property of <code class="literal">MyMapEvent</code> events to be of type <code class="literal">int</code>, and the <code class="literal">carType</code> property to be of type <code class="literal">java.util.String</code>. The <code class="literal">assembly</code> property of the Map event will contain instances of <code class="literal">com.mycompany.Assembly</code> for the engine to query.
			</p><p>
				The valid types for the <code class="literal">class</code> attribute are listed in <a class="xref" href="#configuration-type-names" title="15.5.Â Type Names">SectionÂ 15.5, âType Namesâ</a>. In addition, any fully-qualified Java class name that can be resolved via <code class="literal">Class.forName</code> is allowed.
			</p><p>
				 You can also use the configuration API to configure <code class="literal">Map</code> event types, as the short code snippet below demonstrates:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Map&lt;String, Object&gt; properties = new Map&lt;String, Object&gt;();
properties.put("carId", "int");
properties.put("carType", "string");
properties.put("assembly", Assembly.class.getName());

Configuration configuration = new Configuration();
configuration.addEventType("MyMapEvent", properties);</pre><p>
				 For strongly-typed nested maps (maps-within-maps), the configuration API method <code class="literal">addEventType</code> can also used to define the nested types. The XML configuration does not provide the capability to configure nested maps.
			</p><p>
				Finally, here is a sample EPL statement that uses the configured <code class="literal">MyMapEvent</code> map event. This statement uses the <code class="literal">chassisTag</code> and <code class="literal">numParts</code> properties of <code class="literal">Assembly</code> objects in each map.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select carType, assembly.chassisTag, count(assembly.numParts) from MyMapEvent#time(60 sec)</pre><p>
				A Map event type may also become a subtype of one or more supertypes that must also be Map event types. The <code class="literal">java-util-map</code> element provides the optional attribute <code class="literal">supertype-names</code> that accepts a comma-separated list of names of Map event types that are supertypes to the type:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;event-type name="AccountUpdate"&gt;
&lt;java-util-map supertype-names="BaseUpdate, AccountEvent"&gt;
...</pre><p>
				For initialization time configuration, the <code class="literal">addMapSuperType</code> method can be used to add Map hierarchy information. For runtime configuration, pass the supertype names to the <code class="literal">addEventType</code> method in <code class="literal">ConfigurationOperations</code>.
			</p><p>
				A Map event type may declare a start and end timestamp property name. The XML shown next instructs the engine that the <code class="literal">startts</code> property carries the event start timestamp and the <code class="literal">endts</code> property carries the event end timestamp:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;event-type name="AccountUpdate"&gt;
&lt;java-util-map start-timestamp-property-name="startts" end-timestamp-property-name="endts"&gt;
...</pre><p>
				 For adding a type at runtime please use either EPL <code class="literal">create map schema</code> or <code class="literal">epServiceProvider.getEPAdministrator().getConfiguration().addEventType(...)</code>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-objectarray"/>15.4.3.Â Events Represented by <code class="literal">Object[]</code> (Object-array)</h3></div></div></div><p>
				The engine can process Object-array (<code class="literal">Object[]</code>) events via the <code class="literal">sendEvent(Object[] array, String eventTypeName)</code> method on the <code class="literal">EPRuntime</code> interface. Elements in the Object array represent event properties. Please see the <a class="xref" href="#appendix_eventrepoa" title="AppendixÂ F.Â Event Representation: Object-Array (Object[]) Events">AppendixÂ F, <i>Event Representation: Object-Array (Object[]) Events</i></a> section for details on how to use <code class="literal">Object[]</code> events with the engine.
			</p><p>
				Via configuration you can provide an event type name for <code class="literal">Object[]</code> events for use in statements, and the event property names and types enabling the engine to validate properties in statements.
			</p><p>
				The below snippet of XML configuration configures an event type named <code class="literal">MyObjectArrayEvent</code>.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;event-type name="MyObjectArrayEvent"&gt;
  &lt;objectarray&gt;
    &lt;objectarray-property name="carId" class="int"/&gt;
    &lt;objectarray-property name="carType" class="string"/&gt;
    &lt;objectarray-property name="assembly" class="com.mycompany.Assembly"/&gt;    
  &lt;/objectarray&gt;
&lt;/event-type&gt;</pre><p>
				This configuration defines the <code class="literal">carId</code> property of <code class="literal">MyObjectArrayEvent</code> events to be of type <code class="literal">int</code> and in the object array first element (<code class="literal">[0]</code>). The <code class="literal">carType</code> property to be of type <code class="literal">java.util.String</code> is expected in the second array element (<code class="literal">[1]</code>) . The <code class="literal">assembly</code> property of the object array event will contain instances of <code class="literal">com.mycompany.Assembly</code> for the engine to query in element two (<code class="literal">[2]</code>).
			</p><p>
			  Note that the engine does not verify the length and property values of object array events when your application sends object-array events into the engine. For the example above, the proper object array would look as follows: <code class="literal">new Object[] {carId, carType, assembly}</code>.
			</p><p>
				The valid types for the <code class="literal">class</code> attribute are listed in <a class="xref" href="#configuration-type-names" title="15.5.Â Type Names">SectionÂ 15.5, âType Namesâ</a>. In addition, any fully-qualified Java class name that can be resolved via <code class="literal">Class.forName</code> is allowed.
			</p><p>
				 You can also use the configuration API to configure <code class="literal">Object[]</code> event types, as the short code snippet below demonstrates:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String[] propertyNames = {"carId", "carType", "assembly"};
Object[] propertyTypes = {int.class, String.class, Assembly.class};

Configuration configuration = new Configuration();
configuration.addEventType("MyObjectArrayEvent", propertyNames, propertyTypes);</pre><p>
				Finally, here is a sample EPL statement that uses the configured <code class="literal">MyObjectArrayEvent</code> object-array event. This statement uses the <code class="literal">chassisTag</code> and <code class="literal">numParts</code> properties of <code class="literal">Assembly</code> objects.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select carType, assembly.chassisTag, count(assembly.numParts) from MyObjectArrayEvent#time(60 sec)</pre><p>
				An Object-array event type may also become a subtype of one supertype that must also be an Object-array event type. The <code class="literal">objectarray</code> element provides the optional attribute <code class="literal">supertype-names</code> that accepts a single name of an Object-array event type that is the supertype to the type:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;event-type name="AccountUpdate"&gt;
&lt;objectarray supertype-names="BaseUpdate"&gt;
...</pre><p>
				An Object-array event type may declare a start and end timestamp property name. The XML shown next instructs the engine that the <code class="literal">startts</code> property carries the event start timestamp and the <code class="literal">endts</code> property carries the event end timestamp:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;event-type name="AccountUpdate"&gt;
&lt;objectarray start-timestamp-property-name="startts" end-timestamp-property-name="endts"&gt;
...</pre><p>
				 For adding a type at runtime please use either EPL <code class="literal">create objectarray schema</code> or <code class="literal">epServiceProvider.getEPAdministrator().getConfiguration().addEventType(...)</code>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-avro"/>15.4.4.Â Events Represented by Avro <code class="literal">GenericData.Record</code></h3></div></div></div><p>
				The engine can process Avro <code class="literal">GenericData.Record</code> events via the <code class="literal">sendEventAvro(GenericData.Record event, String eventTypeName)</code> method on the <code class="literal">EPRuntime</code> interface. Please see the <a class="xref" href="#appendix_eventrepavro" title="AppendixÂ G.Â Event Representation: Avro Events (org.apache.avro.generic.GenericData.Record)">AppendixÂ G, <i>Event Representation: Avro Events (org.apache.avro.generic.GenericData.Record)</i></a> section for details on how to use Avro events with the engine.
			</p><p>
				Via configuration you can provide an event type name for Avro events for use in statements, and the Avro schema enabling the engine to validate properties in statements.
			</p><p>
				The below snippet of XML configuration configures an event type named <code class="literal">MyAvroEvent</code>.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;event-type name="MyAvroEvent"&gt;
  &lt;avro schema-text='{"type":"record","name":"MyAvroEvent","fields":[{"name":"carId","type":"int"},{"name":"carType","type":{"type":"string","avro.java.string":"String"}}]}'/&gt;
&lt;/event-type&gt;</pre><p>
				The sample Avro schema above in pretty-print is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{
  "type" : "record",
  "name" : "MyAvroEvent",
  "fields" : [ {
    "name" : "carId",
    "type" : "int"
  }, {
    "name" : "carType",
    "type" : {
      "type" : "string",
      "avro.java.string" : "String"
    }
  } ]
}</pre><p>
				This schema defines:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>A <code class="literal">carId</code> property of type <code class="literal">int</code>.</p></li><li><p>A <code class="literal">carType</code> property of type <code class="literal">string</code>. Note:Wse the Avro-provided <code class="literal">avro.java.string</code> property to ensure is is a <code class="literal">java.lang.String</code> instance and not a <code class="literal">java.lang.CharSequence</code>) instance.</p></li></ol></div><p>
			  Note that the engine does not verify that Avro events are valid or that they actually match the schema provided for the Avro event type.
			</p><p>
				 You can also use the configuration API to configure Avro event types, as the short code snippet below demonstrates:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration configuration = new Configuration();
ConfigurationEventTypeAvro avroType = new ConfigurationEventTypeAvro();
avroType.setAvroSchema(schema);
configuration.addEventTypeAvro("MyAvroType", avroType);</pre><p>
				 For adding a type at runtime please use either EPL <code class="literal">create avro schema</code> or <code class="literal">epServiceProvider.getEPAdministrator().getConfiguration().addEventTypeAvro(...)</code>.
			</p><p>
				Finally, here is a sample EPL statement that uses the configured <code class="literal">MyAvroEvent</code> Avro event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select carType, count(distinct carId) from MyAvroEvent</pre><p>
				An Avro event type may also become a subtype of one supertype that must also be an Avro event type. The <code class="literal">avro</code> element provides the optional attribute <code class="literal">supertype-names</code> that accepts a single name of an Avro event type that is the supertype to the type:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;avro supertype-names="BaseUpdate" ....&gt;</pre><p>
				An Avro event type may declare a start and end timestamp property name. The XML shown next instructs the engine that the <code class="literal">startts</code> property carries the event start timestamp and the <code class="literal">endts</code> property carries the event end timestamp:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;avro start-timestamp-property-name="startts" end-timestamp-property-name="endts" ...&gt;</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-xml-dom"/>15.4.5.Â Events Represented by <code class="literal">org.w3c.dom.Node</code></h3></div></div></div><p>
				Via this configuration item the Esper engine can natively process <code class="literal">org.w3c.dom.Node</code> instances, i.e. XML document object model (DOM) nodes.
				Please see the <a class="xref" href="#appendix_eventrepxml" title="AppendixÂ H.Â Event Representation: org.w3c.dom.Node XML Events">AppendixÂ H, <i>Event Representation: org.w3c.dom.Node XML Events</i></a> section for details on how to use <code class="literal">Node</code> events with the engine.
			</p><p>
				Esper allows configuring XPath expressions as event properties. You can specify arbitrary XPath functions or expressions and provide a property name by which their result values will be available for use in expressions. 
			</p><p>
				For XML documents that follow a XML schema, Esper can load and interrogate your schema and validate event property names and types against the schema information. 
			</p><p>
				Nested, mapped and indexed event properties are also supported in expressions against <code class="literal">org.w3c.dom.Node</code> events. Thus XML trees can conveniently be
				interrogated using the existing event property syntax for querying JavaBean objects, JavaBean object graphs or <code class="literal">java.util.Map</code> events.
			</p><p>
				In the simplest form, the Esper engine only requires a configuration entry containing the root element name and the event type name in order to process <code class="literal">org.w3c.dom.Node</code> events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;event-type name="MyXMLNodeEvent"&gt;
  &lt;xml-dom root-element-name="myevent" /&gt;
&lt;/event-type&gt;</pre><p>
				 You can also use the configuration API to configure XML event types, as the short example below demonstrates. 
				 In fact, all configuration options available through XML configuration can 
				 also be provided via setter methods on the <code class="literal">ConfigurationEventTypeXMLDOM</code> class.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration configuration = new Configuration();
ConfigurationEventTypeXMLDOM desc = new ConfigurationEventTypeXMLDOM();
desc.setRootElementName("myevent");
desc.addXPathProperty("name1", "/element/@attribute", XPathConstants.STRING);
desc.addXPathProperty("name2", "/element/subelement", XPathConstants.NUMBER);
configuration.addEventType("MyXMLNodeEvent", desc);</pre><p>
				 The next example presents configuration options in a sample configuration entry.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;event-type name="AutoIdRFIDEvent"&gt;
  &lt;xml-dom root-element-name="Sensor" schema-resource="data/AutoIdPmlCore.xsd" 
       default-namespace="urn:autoid:specification:interchange:PMLCore:xml:schema:1"&gt;
    &lt;namespace-prefix prefix="pmlcore" 
       namespace="urn:autoid:specification:interchange:PMLCore:xml:schema:1"/&gt;
    &lt;xpath-property property-name="countTags" 
       xpath="count(/pmlcore:Sensor/pmlcore:Observation/pmlcore:Tag)" type="number"/&gt;
  &lt;/xml-dom&gt;
&lt;/event-type&gt;</pre><p>
				 This example configures an event property named <code class="literal">countTags</code> whose value is computed by an XPath expression. The namespace prefixes
				 and default namespace are for use with XPath expressions and must also be made known to the engine in order for the engine to compile XPath expressions. 
				 Via the <code class="literal">schema-resource</code> attribute you can instruct the engine to load a schema file. You may also use <code class="literal">schema-text</code> instead to 
				 provide the actual text of the schema.
			</p><p>
				 Here is an example EPL statement using the configured event type named <code class="literal">AutoIdRFIDEvent</code>.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select ID, countTags from AutoIdRFIDEvent#time(30 sec)</pre><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-xml-dom-schema"/>15.4.5.1.Â Schema Resource</h4></div></div></div><p>
					 The <code class="literal">schema-resource</code> attribute takes a schema resource URL or classpath-relative filename. 
					 The engine attempts to resolve the schema resource as an URL. If the schema resource name is not a valid URL, the engine attempts to resolve the resource from classpath via the <code class="literal">ClassLoader.getResource</code> method using the thread context class loader. If the name could not be resolved, the engine uses the Configuration class classloader. Use the <code class="literal">schema-text</code> attribute instead when it is more practical to provide the actual text of the schema. 
				</p><p>
					 By configuring a schema file for the engine to load, the engine performs these additional services:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							Validates the event properties in a statement, ensuring the event property name matches an attribute or element in the XML
						</p></li><li><p>
							Determines the type of the event property allowing event properties to be used in type-sensitive expressions such as expressions involving arithmetic (Note: XPath properties are also typed)
						</p></li><li><p>
							Matches event property names to either element names or attributes
						</p></li></ul></div><p>
					 If no schema resource is specified, none of the event properties specified in statements are validated at statement creation time and their type defaults to <code class="literal">java.lang.String</code>. Also, attributes are not supported
					 if no schema resource is specified and must thus be declared via XPath expression.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-xml-dom-xpathprop"/>15.4.5.2.Â Explicit XPath Property</h4></div></div></div><p>
					 The <code class="literal">xpath-property</code> element adds explicitly-names event properties to the event type that are computed via an XPath expression.
					 In order for the XPath expression to compile, be sure to specify the <code class="literal">default-namespace</code> attribute and use the 
					 <code class="literal">namespace-prefix</code> to declare namespace prefixes.
				</p><p>
					 XPath expression properties are strongly typed. The <code class="literal">type</code> attribute allows the following values. These values correspond to those declared by 
					 <code class="literal">javax.xml.xpath.XPathConstants</code>.
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							number (Note: resolves to a <code class="literal">double</code>)
						</p></li><li><p>
							string
						</p></li><li><p>
							boolean
						</p></li><li><p>
							node
						</p></li><li><p>
							nodeset
						</p></li></ul></div><p>
					 In case you need your XPath expression to return a type other than the types listed above, an optional cast-to type can be specified. If specified, the operation firsts obtains the result of the XPath expression as the defined type (number, string, boolean) and then casts or parses the returned type to the specified cast-to-type. At runtime, a warning message is logged if the XPath expression returns a result object that cannot be casted or parsed.
				</p><p>
					 The next line shows how to return a long-type property for an XPath expression that returns a string:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">desc.addXPathProperty("name", "/element/sub", XPathConstants.STRING, "long");</pre><p>
					 The equivalent configuration XML is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;xpath-property property-name="name"  xpath="/element/sub" type="string" cast="long"/&gt;</pre><p>
				  See <a class="xref" href="#configuration-type-names" title="15.5.Â Type Names">SectionÂ 15.5, âType Namesâ</a> for a list of cast-to type names.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-xml-dom-absolute"/>15.4.5.3.Â Absolute or Deep Property Resolution</h4></div></div></div><p>
					This setting indicates that when properties are compiled to XPath expressions that the compilation should generate an absolute XPath expression or a deep (find element) XPath expression. 					
				</p><p>
					For example, consider the following statement against an event type that is represented by a XML DOM document, assuming the event type GetQuote has been configured with the engine as a XML DOM event type:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select request, request.symbol from GetQuote</pre><p>
					By default, the engine compiles the "request" property name to an XPath expression "/GetQuote/request". It compiles the nested property named "request.symbol" to an XPath expression "/GetQuote/request/symbol", wherein the root element node is "GetQuote".
				</p><p>
					By setting absolute property resolution to false, the engine compiles the "request" property name to an XPath expression "//request". It compiles the nested property named "request.symbol" to an XPath expression "//request/symbol".
					This enables these elements to be located anywhere in the XML document.
				</p><p>
					The setting is available in XML via the attribute <code class="literal">resolve-properties-absolute</code>.
				</p><p>
					The configuration API provides the above settings as shown here in a sample code:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">ConfigurationEventTypeXMLDOM desc = new ConfigurationEventTypeXMLDOM();
desc.setRootElementName("GetQuote");
desc.setDefaultNamespace("http://services.samples/xsd");
desc.setRootElementNamespace("http://services.samples/xsd");
desc.addNamespacePrefix("m0", "http://services.samples/xsd");
desc.setResolvePropertiesAbsolute(false);
configuration.addEventType("GetQuote", desc);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-xml-dom-xpathresolver"/>15.4.5.4.Â XPath Variable and Function Resolver</h4></div></div></div><p>
					If your XPath expressions require variables or functions, your application may provide the class name of an <code class="literal">XPathVariableResolver</code> and <code class="literal">XPathFunctionResolver</code>. At type initialization time 
					the engine instantiates the resolver instances and provides these to the XPathFactory.
				</p><p>
					This example shows the API to set this configuration.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">ConfigurationEventTypeXMLDOM desc = new ConfigurationEventTypeXMLDOM();
desc.setXPathFunctionResolver(MyXPathFunctionResolver.class.getName());
desc.setXPathVariableResolver(MyXPathVariableResolver.class.getName());</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-xml-dom-autofragment"/>15.4.5.5.Â Auto Fragment</h4></div></div></div><p>
					This option is for use when a XSD schema is provided and determines whether the engine automatically creates an event type when a property expression transposes a property that is a complex type according to the schema.
				</p><p>
					An example:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">ConfigurationEventTypeXMLDOM desc = new ConfigurationEventTypeXMLDOM();
desc.setAutoFragment(false);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-xml-dom-xpathpropertyexpr"/>15.4.5.6.Â XPath Property Expression</h4></div></div></div><p>
					By default Esper employs the built-in DOM walker implementation to evaluate XPath expressions, which is not namespace-aware.
				</p><p>
					This configuration setting, when set to true, instructs the engine to rewrite property expressions into XPath.
				</p><p>
					An example:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">ConfigurationEventTypeXMLDOM desc = new ConfigurationEventTypeXMLDOM();
desc.setXPathPropertyExpr(true);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-xml-dom-eventsendervalidatesroot"/>15.4.5.7.Â Event Sender Setting</h4></div></div></div><p>
					By default an <code class="literal">EventSender</code> for a given XML event type validates the root element name for which the type has been declared against the one provided by the <code class="literal">org.w3c.Node</code> sent into the engine.
				</p><p>
					This configuration setting, when set to false, instructs an <code class="literal">EventSender</code> to not validate.
				</p><p>
					An example:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">ConfigurationEventTypeXMLDOM desc = new ConfigurationEventTypeXMLDOM();
desc.setEventSenderValidatesRoot(false);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-xml-dom-startendtimestamp"/>15.4.5.8.Â Start and End Timestamp</h4></div></div></div><p>
					You may configure the name of the properties that provides the event start timestamp and the event end timestamp as part of the configuration.
				</p><p>
					An example that configures <code class="literal">startts</code> as the property name providing the start timestamp and <code class="literal">endts</code> as the property name providing the end timestamp:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">ConfigurationEventTypeXMLDOM desc = new ConfigurationEventTypeXMLDOM();
desc.setStartTimestampPropertyName("startts");
desc.setEndTimestampPropertyName("endts");</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-plugineventrep"/>15.4.6.Â Events Represented by Plug-in Event Representations</h3></div></div></div><p>
				As part of the extension API plug-in event representations allows an application to create new event types and event instances based on information available elsewhere. Please see <a class="xref" href="#custom-event-representation" title="17.8.Â Event Type and Event Object">SectionÂ 17.8, âEvent Type and Event Objectâ</a> for details.
			</p><p>
				The configuration examples shown next use the configuration API to select settings. All options are also configurable via XML, please refer to the sample configuration XML in file <code class="literal">esper.sample.cfg.xml</code>.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-plugineventrep-enable"/>15.4.6.1.Â Enabling an Custom Event Representation</h4></div></div></div><p>
					Use the method <code class="literal">addPlugInEventRepresentation</code> to enable a custom event representation, like this:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">URI rootURI = new URI("type://mycompany/myproject/myname");
config.addPlugInEventRepresentation(rootURI, 
    MyEventRepresentation.class.getName(), null);</pre><p>
					The <code class="literal">type://</code> part of the URI is an optional convention for the scheme part of an URI. 
				</p><p>
					If your event representation takes initialization parameters, these are passed in as the last parameter. Initialization parameters can also be stored in the configuration XML, in which case
					they are passed as an XML string to the plug-in class.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-plugineventrep-types"/>15.4.6.2.Â Adding Plug-in Event Types</h4></div></div></div><p>
					To register event types that your plug-in event representation creates in advance of creating an EPL statement (either at runtime or at configuration time), use the method <code class="literal">addPlugInEventType</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">URI childURI = new URI("type://mycompany/myproject/myname/MyEvent");
configuration.addPlugInEventType("MyEvent", new URI[] {childURI}, null);</pre><p>
					Your plug-in event type may take initialization parameters, these are passed in as the last parameter. Initialization parameters can also be stored in the configuration XML.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-plugineventrep-resolution"/>15.4.6.3.Â Setting Resolution URIs</h4></div></div></div><p>
					The engine can invoke your plug-in event representation when an EPL statement is created with an event type name that the engine has not seen before. Plug-in event representations can resolve such names to an actual event type. In order to do this, you need to supply a list of resolution URIs. Use the method <code class="literal">setPlugInEventTypeNameResolutionURIs</code>, at runtime or at configuration time:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">URI childURI = new URI("type://mycompany/myproject/myname");
configuration.setPlugInEventTypeNameResolutionURIs(new URI[] {childURI});</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-class--package-imports"/>15.4.7.Â Class and Package Imports</h3></div></div></div><p>
				Esper allows invocations of static Java library functions in expressions, as outlined in <a class="xref" href="#epl-single-row-function-ref" title="10.1.Â Single-Row Function Reference">SectionÂ 10.1, âSingle-Row Function Referenceâ</a>. This configuration 
				item can be set to allow a partial rather than a fully qualified class name in such invocations. The imports work in the same way as in Java files, so both packages and classes can be imported.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select Math.max(priceOne, PriceTwo)
// via configuration equivalent to
select java.lang.Math.max(priceOne, priceTwo)</pre><p>
				Esper auto-imports the following Java library packages. Any additional imports that are specified in configuration files or through the API are added to the configuration
				in addition to the imports below.
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						java.lang.*
					</p></li><li><p>
						java.math.*
					</p></li><li><p>
						java.text.*
					</p></li><li><p>
						java.util.*
					</p></li></ul></div><p>
				In a XML configuration file the auto-import configuration may look as below:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;auto-import import-name="com.mycompany.mypackage.*"/&gt;
&lt;auto-import import-name="com.mycompany.myapp.MyUtilityClass"/&gt;</pre><p>
				Here is an example of providing imports via the API:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.addImport("com.mycompany.mypackage.*");	// package import
config.addImport("com.mycompany.mypackage.MyLib");   // class import</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-class--package-imports-annotations"/>15.4.8.Â Annotation Class and Package Imports</h3></div></div></div><p>
				If your application has certain classes or packages that should only be visible within an <code class="literal">@</code>-annotation, 
				you may add these to the annotation imports list. Such classes are only visible when used in an annotation and not elsewhere.
			</p><p>
				In a XML configuration file the auto-import-annotation configuration may look as below:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;auto-import-annotation import-name="com.mycompany.mypackage.myannotations.*"/&gt;</pre><p>
				Here is an example of providing annotation-only imports via the API:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
// package import, only visible for annotation use
config.addAnnotationImport("com.mycompany.mypackage.myannotations.*");</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-method-invocations"/>15.4.9.Â Cache Settings for From-Clause Method Invocations</h3></div></div></div><p>
				Method invocations are allowed in the <code class="literal">from</code> clause in EPL, such that your application may join event streams to the data returned by a web service, or to data read from a distributed cache or object-oriented database, or obtain data by other means. A local cache may be placed in front of such method invocations through the configuration settings described herein.
			</p><p>
				The LRU cache is described in detail in <a class="xref" href="#config-database-cache-lru" title="15.4.11.6.1.Â LRU Cache">SectionÂ 15.4.11.6.1, âLRU Cacheâ</a>. The expiry-time cache documentation can be found in <a class="xref" href="#config-database-cache-expiry" title="15.4.11.6.2.Â Expiry-Time Cache">SectionÂ 15.4.11.6.2, âExpiry-Time Cacheâ</a>
			</p><p>
				The next XML snippet is a sample cache configuration that applies to methods provided by the classes 'MyFromClauseLookupLib'  and 'MyFromClauseWebServiceLib'. The XML and API configuration understand both the fully-qualified Java class name, as well as the simple class name:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;method-reference class-name="com.mycompany.MyFromClauseLookupLib"&gt;
  &lt;expiry-time-cache max-age-seconds="10" purge-interval-seconds="10" ref-type="weak"/&gt;
&lt;/method-reference&gt; 	
&lt;method-reference class-name="MyFromClauseWebServiceLib"&gt;
  &lt;lru-cache size="1000"/&gt;
&lt;/method-reference&gt; </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-variables"/>15.4.10.Â Variables</h3></div></div></div><p>
				Variables can be created dynamically in EPL via the <code class="literal">create variable</code> syntax but can also be configured at runtime and at configuration time.
			</p><p>
				A variable is declared by specifying a variable name, the variable type, an optional initialization value and an optional boolean-type flag indicating whether the variable is a constant (false by default). The initialization value can be of the same or compatible type as the variable type, or can also be a String value that, when parsed, is compatible to the type declared for the variable. Declare each variable a constant to achieve the best performance.
			</p><p>
				In a XML configuration file the variable configuration may look as below. The <code class="literal">Configuration</code> API can also be used to configure variables.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;variable name="var_threshold" type="long" initialization-value="100"/&gt;
&lt;variable name="var_key" type="string"/&gt;
&lt;variable name="test" type="int" constant="true"/&gt;</pre><p>
				Please find the list of valid values for the <code class="literal">type</code> attribute in <a class="xref" href="#configuration-type-names" title="15.5.Â Type Names">SectionÂ 15.5, âType Namesâ</a>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-database-ref"/>15.4.11.Â Relational Database Access</h3></div></div></div><p>
				For NEsper .NET also see <a class="xref" href="#appendix_dotnet_config_database_ref" title="I.17.Â .NET Configurations - Relational Database Access">SectionÂ I.17, â.NET Configurations - Relational Database Accessâ</a>.
			</p><p>
				Esper has the capability to join event streams against historical data sources, such as a relational database. This section describes the configuration entries that the engine requires to access data stored in your database. Please see <a class="xref" href="#histdata_overview" title="5.13.Â Accessing Relational Data via SQL">SectionÂ 5.13, âAccessing Relational Data via SQLâ</a> for information on the use of EPL queries that include historical data sources.
			</p><p>
					EPL queries that poll data from a relational database specify the name of the database as part of the EPL statement. The engine uses the configuration information described here to resolve the database name in the statement to database settings. The required and optional database settings are summarized below. 
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						Database connections can be obtained via JDBC <code class="literal">javax.xml.DataSource</code>, via <code class="literal">java.sql.DriverManager</code> and via data source factory. Either one of these methods to obtain database connections is a required configuration.
					</p></li><li><p>
						Optionally, JDBC connection-level settings such as auto-commit, transaction isolation level, read-only and the catalog name can be defined.
					</p></li><li><p>
						Optionally, a connection lifecycle can be set to indicate to the engine whether the engine must retain connections or must obtain a new connection for each lookup and close the connection when the lookup is done (pooled).
					</p></li><li><p>
						Optionally, define a cache policy to allow the engine to retrieve data from a query cache, reducing the number of query executions.
					</p></li></ul></div><p>
				Some of the settings can have important performance implications that need to be carefully considered in relationship to your database software, JDBC driver and runtime environment. This section attempts to outline such implications where appropriate.
			</p><p>
				The sample XML configuration file in the "etc" folder can be used as a template for configuring database settings. All settings are also available by means of the configuration API through the classes <code class="literal">Configuration</code> and <code class="literal">ConfigurationDBRef</code>.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-database-datasource"/>15.4.11.1.Â Connections Obtained via DataSource</h4></div></div></div><p>
					This configuration causes Esper to obtain a database connection from a <code class="literal">javax.sql.DataSource</code> available from your JNDI provider.
				</p><p>
					The setting is most useful when running within an application server or when a JNDI directory is otherwise present in your Java VM. If your application environment does not provide an available <code class="literal">DataSource</code>, the next section outlines how to use Apache DBCP as a <code class="literal">DataSource</code> implementation with connection pooling options and outlines how to use a custom factory for <code class="literal">DataSource</code> implementations.
				</p><p>
					If your <code class="literal">DataSource</code> provides connections out of a connection pool, your configuration should set the collection lifecycle setting to <code class="literal">pooled</code>.
				</p><p>
				The snippet of XML below configures a database named <code class="literal">mydb1</code> to obtain connections via a <code class="literal">javax.sql.DataSource</code>. The <code class="literal">datasource-connection</code> element instructs the engine to obtain new connections to the database <code class="literal">mydb1</code> by performing a lookup via <code class="literal">javax.naming.InitialContext</code> for the given object lookup name. Optional environment properties for the <code class="literal">InitialContext</code> are also shown in the example.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;database-reference name="mydb1"&gt;
  &lt;datasource-connection context-lookup-name="java:comp/env/jdbc/mydb"&gt;
    &lt;env-property name="java.naming.factory.initial" value ="com.myclass.CtxFactory"/&gt;
    &lt;env-property name="java.naming.provider.url" value ="iiop://localhost:1050"/&gt;
  &lt;/datasource-connection&gt;
&lt;/database-reference&gt;</pre><p>
					To help you better understand how the engine uses this information to obtain connections, please look at the logic below.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">if (envProperties.size() &gt; 0) {
  initialContext = new InitialContext(envProperties);
}
else {
  initialContext = new InitialContext();
}
DataSource dataSource = (DataSource) initialContext.lookup(lookupName);
Connection connection = dataSource.getConnection();</pre><p>
					In order to plug-in your own implementation of the <code class="literal">DataSource</code> interface, your application may use an existing JNDI provider as provided by an application server if running in a J2EE environment.
				</p><p>
					In case your application does not have an existing JNDI implementation to register a <code class="literal">DataSource</code> to provide connections, you may set the <code class="literal">java.naming.factory.initial</code> property in the configuration to point to your application's own implementation of the <code class="literal">javax.naming.spi.InitialContextFactory</code> interface that can return your application <code class="literal">DataSource</code> though the <code class="literal">javax.naming.Context</code> provided by the factory implementation. Please see Java Naming and Directory Interface (JNDI) API documentation for further information.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-database-datasourcefactory"/>15.4.11.2.Â Connections Obtained via DataSource Factory</h4></div></div></div><p>
					This section describes how to use <em class="citetitle"><a class="link" href="http://commons.apache.org/dbcp" target="">Apache Commons Database Connection Pooling (Apache DBCP)</a></em> with Esper. It explains how to provide a custom application-specific <code class="literal">DataSource</code> factory if not using Apache DBCP.
				</p><p>
					If your <code class="literal">DataSource</code> provides connections out of a connection pool, your configuration should set the collection lifecycle setting to <code class="literal">pooled</code>.
				</p><p>
					Apache DBCP provides comprehensive means to test for dead connections or grow and shrik a connection pool. Configuration properties for Apache DBCP can be found at <em class="citetitle"><a class="link" href="http://commons.apache.org/dbcp/configuration.html" target="">Apache DBCP configuration</a></em>. The listed properties are passed to Apache DBCP via the properties list provided as part of the Esper configuration.
				</p><p>
				   The snippet of XML below is an example that configures a database named <code class="literal">mydb3</code> to obtain connections via the pooling <code class="literal">DataSource</code> provided by Apache DBCP <code class="literal">BasicDataSourceFactory</code>.
				</p><p>
				   The listed properties are passed to DBCP to instruct DBCP how to manage the connection pool. The settings below initialize the connection pool to 2 connections and provide the validation query <code class="literal">select 1 from dual</code> for DBCP to validate a connection before providing a connection from the pool to Esper:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;database-reference name="mydb3"&gt;
  &lt;!-- For a complete list of properties see Apache DBCP. --&gt;
  &lt;!-- NOTE: "dbcp2" applies to api-2.0 of DBCP, use "dbcp" otherwise. --&gt;
  &lt;datasourcefactory-connection class-name="org.apache.commons.dbcp2.BasicDataSourceFactory"&gt;	
    &lt;env-property name="username" value ="myusername"/&gt;
    &lt;env-property name="password" value ="mypassword"/&gt;
    &lt;env-property name="driverClassName" value ="com.mysql.jdbc.Driver"/&gt;
    &lt;env-property name="url" value ="jdbc:mysql://localhost/test"/&gt;
    &lt;env-property name="initialSize" value ="2"/&gt;
    &lt;env-property name="validationQuery" value ="select 1 from dual"/&gt;
  &lt;/datasourcefactory-connection&gt;
  &lt;connection-lifecycle value="pooled"/&gt;
&lt;/database-reference&gt;</pre><p>
					The same configuration options provided through the API:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Properties props = new Properties();
props.put("username", "myusername");
props.put("password", "mypassword");
props.put("driverClassName", "com.mysql.jdbc.Driver");
props.put("url", "jdbc:mysql://localhost/test");
props.put("initialSize", 2);
props.put("validationQuery", "select 1 from dual");

ConfigurationDBRef configDB = new ConfigurationDBRef();
// BasicDataSourceFactory is an Apache DBCP import
configDB.setDataSourceFactory(props, BasicDataSourceFactory.class.getName());
configDB.setConnectionLifecycleEnum(ConfigurationDBRef.ConnectionLifecycleEnum.POOLED);

Configuration configuration = new Configuration();;
configuration.addDatabaseReference("mydb3", configDB);</pre><p>
					Apache Commons DBCP is a separate download and not provided as part of the Esper distribution. The Apache Commons DBCP jar file requires the Apache Commons Pool jar file.
				</p><p>
					Your application can provide its own factory implementation for <code class="literal">DataSource</code> instances: Set the class name to the name of the application class that provides a public static method named <code class="literal">createDataSource</code> which takes a single <code class="literal">Properties</code> object as parameter and returns a  <code class="literal">DataSource</code> implementation. For example:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">configDB.setDataSourceFactory(props, MyOwnDataSourceFactory.class.getName());
...
class MyOwnDataSourceFactory {
  public static DataSource createDataSource(Properties properties) {
    return new MyDataSourceImpl(properties);
  }
}</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-database-drivermanager"/>15.4.11.3.Â Connections Obtained via DriverManager</h4></div></div></div><p>
				The next snippet of XML configures a database named <code class="literal">mydb2</code> to obtain connections via <code class="literal">java.sql.DriverManager</code>. The <code class="literal">drivermanager-connection</code> element instructs the engine to obtain new connections to the database <code class="literal">mydb2</code> by means of <code class="literal">Class.forName</code> and <code class="literal">DriverManager.getConnection</code> using the class name, URL and optional username, password and connection arguments.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;database-reference name="mydb2"&gt;
  &lt;drivermanager-connection class-name="my.sql.Driver" 
        url="jdbc:mysql://localhost/test?user=root&amp;amp;password=mypassword" 
        user="myuser" password="mypassword"&gt;
    &lt;connection-arg name="user" value ="myuser"/&gt;
    &lt;connection-arg name="password" value ="mypassword"/&gt;
    &lt;connection-arg name="somearg" value ="someargvalue"/&gt;
  &lt;/drivermanager-connection&gt;
&lt;/database-reference&gt;</pre><p>
					The username and password are shown in multiple places in the XML only as an example. Please check with your database software on the required information in
					URL and connection arguments.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-database-connections"/>15.4.11.4.Â Connections-Level Settings</h4></div></div></div><p>
					Additional connection-level settings can optionally be provided to the engine which the engine will apply to new connections. When the engine obtains a new connection, it applies only those settings to the connection that are explicitly configured. The engine leaves all other connection settings at default values.
				</p><p>
					The below XML is a sample of all available configuration settings. Please refer to the Java API JavaDocs for <code class="literal">java.sql.Connection</code> for more information to each option or check the documentation of your JDBC driver and database software.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;database-reference name="mydb2"&gt;
... configure data source or driver manager settings...
  &lt;connection-settings auto-commit="true" catalog="mycatalog" 
      read-only="true" transaction-isolation="1" /&gt;
&lt;/database-reference&gt;</pre><p>
					The <code class="literal">read-only</code> setting can be used to indicate to your database engine that SQL statements are read-only. The <code class="literal">transaction-isolation</code> and <code class="literal">auto-commit</code> help you database software perform the right level of locking and lock release. Consider setting these values to reduce transactional overhead in your database queries.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-database-connections-lifecycle"/>15.4.11.5.Â Connections Lifecycle Settings</h4></div></div></div><p>
					By default the engine retains a separate database connection for each started EPL statement. However, it is possible to override this behavior and require the engine to obtain a new database connection for each lookup, and to close that database connection after the lookup is completed. This often makes sense when you have a large number of EPL statements and require pooling of connections via a connection pool.
				</p><p>
					In the <code class="literal">pooled</code> setting, the engine obtains a database connection from the data source or driver manager for every query, and closes the connection when done, returning the database connection to the pool if using a pooling data source.
				</p><p>
					In the <code class="literal">retain</code> setting, the engine retains a separate dedicated database connection for each statement and does not close the connection between uses.
				</p><p>
					The XML for this option is below. The connection lifecycle allows the following values: <code class="literal">pooled</code> and <code class="literal">retain</code>.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;database-reference name="mydb2"&gt;
... configure data source or driver manager settings...
    &lt;connection-lifecycle value="pooled"/&gt;
&lt;/database-reference&gt;</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-database-cache"/>15.4.11.6.Â Cache Settings</h4></div></div></div><p>
					Cache settings can dramatically reduce the number of database queries that the engine executes for EPL statements. If no cache setting is specified, the engine does not cache query results and executes a separate database query for every event.
				</p><p>
					Caches store the results of database queries and make these results available to subsequent queries using the exact same query parameters as the query for which
					the result was stored. If your query returns one or more rows, the cache keep the result rows of the query keyed to the parameters of the query. If your query returns no rows, the cache also keeps the empty result. Query results are held by a cache until the cache entry is evicted. The strategies available for evicting cached 
					query results are listed next.
				</p><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="config-database-cache-lru"/>15.4.11.6.1.Â LRU Cache</h5></div></div></div><p>
						The least-recently-used (LRU) cache is configured by a maximum size. The cache discards the least recently used query results first once the cache reaches the maximum size.
					</p><p>
						The XML configuration entry for a LRU cache is as below. This entry configures an LRU cache holding up to 1000 query results.
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;database-reference name="mydb"&gt;
... configure data source or driver manager settings...
    &lt;lru-cache size="1000"/&gt;
&lt;/database-reference&gt;</pre></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="config-database-cache-expiry"/>15.4.11.6.2.Â Expiry-Time Cache</h5></div></div></div><p>
						The expiry time cache is configured by a maximum age in seconds, a purge interval and an optional reference type. The cache discards (on the get operation) any query results that are older then the maximum age so that stale data is not used. If the cache is not empty, then every purge interval number of seconds the engine purges any expired entries from the cache.
					</p><p>
						The XML configuration entry for an expiry-time cache is as follows. The example configures an expiry time cache in which prior query results are valid for 60 seconds and which the engine inspects every 2 minutes to remove query results older then 60 seconds.
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;database-reference name="mydb"&gt;
... configure data source or driver manager settings...
    &lt;expiry-time-cache max-age-seconds="60" purge-interval-seconds="120" /&gt;
&lt;/database-reference&gt;</pre><p>
						By default, the expiry-time cache is backed by a <code class="literal">java.util.WeakHashMap</code> and thus relies on weak references. That means that cached SQL results can be freed during garbage collection. 
					</p><p>
						Via XML or using the configuration API the type of reference can be configured to not allow entries to be garbage collected, by setting the <code class="literal">ref-type</code> property to <code class="literal">hard</code>:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;database-reference name="mydb"&gt;
... configure data source or driver manager settings...
    &lt;expiry-time-cache max-age-seconds="60" purge-interval-seconds="120" ref-type="hard"/&gt;
&lt;/database-reference&gt;</pre><p>
						The last setting for the cache reference type is <code class="literal">soft</code>: This strategy allows the garbage collection of cache entries only when all other weak references have been collected.
					</p></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-database-columnchangecase"/>15.4.11.7.Â Column Change Case</h4></div></div></div><p>
					This setting instructs the engine to convert to lower- or uppercase any output column names returned by your database system. When using Oracle relational database software, for example, column names
					can be changed to lowercase via this setting.
				</p><p>
					A sample XML configuration entry for this setting is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;column-change-case value="lowercase"/&gt;</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-database-sqltypes"/>15.4.11.8.Â SQL Types Mapping</h4></div></div></div><p>
					For NEsper .NET this section is not applicable.
				</p><p>
					By providing a mapping of SQL types (<code class="literal">java.sql.Types</code>) to Java built-in types your code can avoid using sometimes awkward default database types and can easily change the way Esper
					returns Java types for columns returned by a SQL query.
				</p><p>
					The mapping maps a constant as defined by <code class="literal">java.sql.Types</code> to a Java built-in type of any of the following Java type names: <code class="literal">String, BigDecimal, Boolean, Byte, Short, Int, Long, Float, Double, ByteArray, SqlDate, SqlTime, SqlTimestamp</code>.  The Java type names are not case-sensitive.
				</p><p>
					A sample XML configuration entry for this setting is shown next. The sample maps <code class="literal">Types.NUMERIC</code> which is a constant value of <code class="literal">2</code> per JDBC API to the Java <code class="literal">int</code> type.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;sql-types-mapping sql-type="2" java-type="int" /&gt;</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-database-metadata"/>15.4.11.9.Â Metadata Origin</h4></div></div></div><p>
					This setting controls how the engine retrieves SQL statement metadata from JDBC prepared statements.
				</p><div class="table"><a id="epl-grouping-aggregate-func"/><p class="title"><b>TableÂ 15.3.Â Syntax and Results of Aggregate Functions</b></p><div class="table-contents"><table summary="Syntax and Results of Aggregate Functions" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Option</th><th>Description</th></tr></thead><tbody><tr><td>default</td><td>
									<p>
										By default, the engine detects the driver name and queries prepared statement metadata if the driver is not an Oracle database driver. For Oracle drivers, the engine uses
										lexical analysis of the SQL statement to construct a sample SQL statement and then fires that statement to retrieve statement metadata.
									</p>
								</td></tr><tr><td>metadata</td><td>
									<p>
										The engine always queries prepared statement metadata regardless of the database driver used.
									</p>
								</td></tr><tr><td>sample</td><td>
									<p>
										The engine always uses lexical analysis of the SQL statement to construct a sample SQL statement, and then fires that statement to retrieve statement metadata.
									</p>
								</td></tr></tbody></table></div></div><br class="table-break"/></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-engine-bytecodegen"/>15.4.12.Â Engine Settings Related to Byte Code Generation and Compilation</h3></div></div></div><p>
			  The setting <code class="literal">enable-resultset</code> is true by default and controls whether the engine generates code for all of result-set-processing including the select-clause, having-clause and group-by expressions.
			</p><p>
			  The setting <code class="literal">enable-aggregation</code> is true by default and controls whether the engine generates code for all of aggregation-processing.
			</p><p>
			  The setting <code class="literal">enable-selectclause</code> is true by default and controls whether the engine generates code for the entire select-clause.
			</p><p>
			  The setting <code class="literal">enable-expression</code> is true by default and controls whether the engine generates code for interdependent expressions.
			</p><p>
			  When all <code class="literal">enable-</code>flags are false the engine does not depend on Janino and Janino can be removed from classpath.
			</p><p>
			  The setting <code class="literal">enable-fallback</code> is true by default and controls whether the engine, upon encountering any exception generating any code, 
			  falls back to regular evaluation. When this flag is false the engine rethrows any exception encountered for byte code generation.
			</p><p>
			  The setting <code class="literal">enable-propertygetter</code> is false by default. It controls whether the engine generates code for event property getters when using the 
			  <code class="literal">getGetter</code> method on <code class="literal">EventType</code>. This setting does not affect byte code generation for event properties that are part of an expression.
			</p><p>
			  The setting <code class="literal">include-debugsymbols</code> is false by default. It controls whether the engine instructs the compiler to generate debug symbols as part of the binary class.
			</p><p>
			  The setting <code class="literal">include-comments</code> is false by default. It controls whether the engine generates code that contains additional information to help
			  tracing back generated code to the code that generated it.
			</p><p>
				The sample code below sets the same values as the default values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration configuration = new Configuration();
ConfigurationEngineDefaults.ByteCodeGeneration byteCodeGen = configuration.getEngineDefaults().getByteCodeGeneration();
byteCodeGen.setEnableResultSet(true);
byteCodeGen.setEnableAggregation(true);
byteCodeGen.setEnableExpression(true);
byteCodeGen.setEnableFallback(true);
byteCodeGen.setEnableSelectClause(false); // since included in result set
byteCodeGen.setEnablePropertyGetter(false); // since included in expressions
byteCodeGen.setIncludeDebugSymbols(false);
byteCodeGen.setIncludeComments(false);</pre><p>
				The sample XML configuration below also sets default values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;bytecodegen 
      enable-resultset="true" 
      enable-aggregation="true" 
      enable-expression="true" 
      enable-selectclause="false" 
      enable-fallback="true" 
      enable-propertygetter="false" 
      include-comments="false" 
      include-debugsymbols="false"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-engine-threading"/>15.4.13.Â Engine Settings Related to Concurrency and Threading</h3></div></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-threading-dispatch"/>15.4.13.1.Â Preserving the Order of Events Delivered to Listeners</h4></div></div></div><p>
					In multithreaded environments, this setting controls whether dispatches of statement result events to listeners preserve the ordering in which a statement processes events. By default the engine guarantees that it delivers a statement's result events to statement listeners in the order in which the result is generated. This behavior can be turned off via configuration as below. This behavior applies to stateful statements
					and not to stateless statements as stateless statements execute lock-free.
				</p><p>
					The next code snippet shows how to control this feature:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getThreading().setListenerDispatchPreserveOrder(false);
engine = EPServiceProviderManager.getDefaultProvider(config);</pre><p>
					And the XML configuration file can also control this feature by adding the following elements:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;threading&gt;
      &lt;listener-dispatch preserve-order="true" timeout-msec="1000" locking="spin"/&gt;
    &lt;/threading&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
					As discussed, by default the engine can temporarily block another processing thread when delivering result events to listeners in order to preserve the order in which results are delivered to a given statement. The maximum time the engine blocks a thread can also be configured, and by default is set to 1 second.
				</p><p>
					As such delivery locks are typically held for a very short amount of time, the default blocking technique employs a spin lock (There are two techniques for implementing blocking; having the operating system suspend the thread until it is awakened later or using spin locks). While spin locks are CPU-intensive and appear inefficient, a spin lock can be more efficient than suspending the thread and subsequently waking it up, especially if the lock in question is held for a very short time. That is because there is significant overhead to suspending and rescheduling a thread.  
				</p><p>
					The locking technique can be changed to use a blocking strategy that suspends the thread, by means of setting the locking property to 'suspend'.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-threading-insert-into"/>15.4.13.2.Â Preserving the Order of Events for Insert-Into Streams</h4></div></div></div><p>
					In multithreaded environments, this setting controls whether statements producing events for other statements via insert-into preserve the order of delivery within the producing and consuming statements, allowing statements that consume other statement's events to behave deterministic in multithreaded applications, if the consuming statement requires such determinism. By default, the engine makes this guarantee (the setting is on). This behavior applies to stateful statements and not to stateless statements as stateless statements execute lock-free.
				</p><p>
					Take, for example, an application where a single statement (S1) inserts events into a stream that another statement (S2) further evaluates. A multithreaded application may have multiple threads processing events into statement S1. As statement S1 produces events for consumption by statement S2, such results may need to be delivered in the exact order produced as the consuming statement may rely on the order received. For example, if the first statement counts the number of events, the second statement may employ a pattern that inspects counts and thus expect the counts posted by statement S1 to continuously increase by 1 even though multiple threads process events. 
				</p><p>
					The engine may need to block a thread such that order of delivery is maintained, and statements that require order (such as pattern detection, previous and prior functions) receive a deterministic order of events. The settings available control the blocking technique and parameters. As described in the section immediately prior, the default blocking technique employs spin locks per statement inserting events for consumption, as the locks in questions are typically held a very short time. The 'suspend' blocking technique can be configured and a timeout value can also defined.
				</p><p>
					The XML configuration file may change settings via the following elements:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;threading&gt;
      &lt;insert-into-dispatch preserve-order="true" timeout-msec="100" locking="spin"/&gt;
    &lt;/threading&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-threading-named-window-dispatch"/>15.4.13.3.Â Preserving the Order of Named Window Dispatches to Named Window Consumer Statements</h4></div></div></div><p>
					In multithreaded environments, this setting controls whether named windows producing insert and remove streams for other statements that consume the named window by 
					means of <code class="literal">from</code>-clause preserve the order of delivery within the producing named window and the consuming statements, allowing statements that consume named window's insert 
					and remove stream events to behave deterministic in multithreaded applications, if the consuming statement requires such determinism. 
					By default, the engine makes this guarantee (the setting is on) with spin locking and <code class="literal">Long.MAX_VALUE</code> as millisecond timeout.
				</p><p>
					Take, for example, an application where a named window (W1) produces inserts and remove stream events that a statement (S1) consumes. A multithreaded application may have multiple threads producing insert and remove stream events for consumption by statement S1. Such results may need to be delivered in the exact order produced by the named window as the consuming statement may rely on the order received. 
				</p><p>
					The engine may need to block a thread such that order of delivery is maintained, and statements that require order receive a deterministic order of events. The settings available control the blocking technique and parameters. As described in the section immediately prior, the default blocking technique employs spin locks per named window producing insert and removed stream events for consumption, as the locks in questions are typically held a very short time. The 'suspend' blocking technique can be configured and a timeout value can also defined.
				</p><p>
					The XML configuration file may change settings via the following elements:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;threading&gt;
      &lt;named-window-consumer-dispatch preserve-order="true" locking="spin"/&gt;
    &lt;/threading&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-threading-internal-timer"/>15.4.13.4.Â Internal Timer Settings</h4></div></div></div><p>
					This option can be used to disable the internal timer thread and such have the application supply external time events, as well as to set a timer resolution.
				</p><p>
					The next code snippet shows how to disable the internal timer thread via the configuration API:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
  config.getEngineDefaults().getThreading().setInternalTimerEnabled(false);</pre><p>
					This snippet of XML configuration leaves the internal timer enabled (the default) and sets a resolution of 200 milliseconds (the default is 100 milliseconds):
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;threading&gt;
      &lt;internal-timer enabled="true" msec-resolution="200"/&gt;
    &lt;/threading&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
					We recommend that when disabling the internal timer, applications send an external timer event setting the start time before creating statements,
					such that statement start time is well-defined.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-threading-advanced"/>15.4.13.5.Â Advanced Threading Options</h4></div></div></div><p>
					The settings described herein are for enabling advanced threading options for inbound, outbound, timer and route executions.
				</p><p>
					Take the next snippet of XML configuration as an example. It configures all threading options to 2 threads, which may not be suitable to your application, however demonstrates the configuration:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;threading&gt;
      &lt;threadpool-inbound enabled="true" num-threads="2"/&gt;
      &lt;threadpool-outbound enabled="true" num-threads="2" capacity="1000"/&gt;
      &lt;threadpool-timerexec enabled="true" num-threads="2"/&gt;
      &lt;threadpool-routeexec enabled="true" num-threads="2"/&gt;
    &lt;/threading&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
					By default, queues are unbound and backed by <code class="literal">java.util.concurrent.LinkedBlockingQueue</code>. 
					The optional <code class="literal">capacity</code> attribute can be set to instruct the threading option to configure a capacity-bound queue with a sender-wait (blocking put) policy, backed <code class="literal">ArrayBlockingQueue</code>.
				</p><p>
					This example uses the API for configuring inbound threading :
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getThreading().setThreadPoolInbound(true);
config.getEngineDefaults().getThreading().setThreadPoolInboundNumThreads(2);</pre><p>
					With a bounded work queue, the queue size and pool size should be tuned together. A large queue coupled with a small pool can help reduce memory usage, CPU usage, and context switching, at the cost of potentially constraining throughput.
				</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
						If outbound-threading is enabled, listeners and subscribers that send events back into the engine should use the <code class="literal">sendEvent</code> method and not the <code class="literal">route</code> method.
					</p></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-execution-enginefairlock"/>15.4.13.6.Â Engine Fair Locking</h4></div></div></div><p>
					By default Esper configures the engine-level lock without fair locking. The engine-level lock coordinates event processing threads (threads that send events) with threads that perform administrative functions (threads that start or destroy statements, for example).
					A fair lock is generally less performing that an unfair lock thus the default configuration is an unfair lock.
				</p><p>				
					If your application is multi-threaded and multiple threads sends events without gaps and if the per-event processing time is significant, then configuring a fair lock can help prioritize administrative functions. Administrative functions exclude event-processing threads until the administrative function completed. You may need to set this flag to prevent lock starvation to perform an administrative function in the face of concurrent event processing. Please consult the Java API documentation under <code class="literal">ReentrantReadWriteLock</code> and <span class="emphasis"><em>Fair Mode</em></span> for more information.
				</p><p>
					 The XML configuration to enable fair locking, which is disabled by default, is as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;threading engine-fairlock="true"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
				 The API to change the setting:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getThreading().setEngineFairlock(true);</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-engine-eventmeta"/>15.4.14.Â Engine Settings Related to Event Metadata</h3></div></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-eventmeta-representation"/>15.4.14.1.Â Default Event Representation</h4></div></div></div><p>
				  The default event representation is the Map event representation.
				</p><p>
				  The default event representation is relevant when your query outputs individual properties to a listener and it does not specify a specific event representation in an annotation.
				  The default event representation is also relevant for <code class="literal">create schema</code> and <code class="literal">create window</code>.
				</p><p>
				  Note that the engine may still use the Map representation for certain types of statements even when the default event representation is object array.
				</p><p>
				  For example, consider the following query:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select propertyOne, propertyTwo from MyEvent</pre><p>
				  Listeners to the statement above currently receive a Map-type event. By setting the configuration flag to object-array or Avro as described herein, listeners to the statement receive an Object-array-type event or an Avro-type event instead.
				</p><p>The XML snippet below is an example of setting the default event representation to Object-array:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;esper-configuration
  &lt;engine-settings&gt;
    &lt;defaults&gt;
      &lt;event-meta&gt;
        &lt;event-representation type="objectarray"/&gt; &lt;!-- use "avro" for Avro --&gt;
      &lt;/event-meta&gt;
    &lt;/defaults&gt;
  &lt;/engine-settings&gt;
&lt;/esper-configuration&gt;</pre><p>The code snippet shown next sets the default event representation to Object-array in the configuration object:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">configuration.getEngineDefaults().getEventMeta().
    setDefaultEventRepresentation(Configuration.EventRepresentation.OBJECTARRAY);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-eventmeta-avro"/>15.4.14.2.Â Avro Settings</h4></div></div></div><p>
					This configuration controls engine settings in respect to Avro.
				</p><p>
					The <code class="literal">enable-avro</code> setting is boolean-typed and is true by default. It controls whether Avro is enabled or disabled.
					If disabled the engine disallows registering Avro event types or using an Avro event representation.
				</p><p>
					The <code class="literal">enable-native-string</code> setting is boolean-typed and is true by default. It controls whether for String-type values,
					when the engine generates an Avro schema, such field schema adds the property <code class="literal">avro.java.string</code> of value <code class="literal">String</code>.
				</p><p>
					The <code class="literal">enable-schema-default-nonnull</code> setting is boolean-typed and is true by default. It controls whether the engine 
					assembles non-null Avro schemas (true) or nullable (union) Avro schemas (false).
				</p><p>
					The <code class="literal">objectvalue-typewidener-factory-class</code> setting is a fully-qualified class name of the class implementing the <code class="literal">com.espertech.esper.client.hook.ObjectValueTypeWidenerFactory</code> interface and is null by default. 
					If specified the factory can provide a type widener for widening, coercing or transforming any object value to a Avro field value.
				</p><p>
					The <code class="literal">type-representation-mapper-class</code> setting is a fully-qualified class name of the class implementing the <code class="literal">com.espertech.esper.client.hook.TypeRepresentationMapper</code> interface and is null by default. 
					If specified the implementation can provide for a given class the Avro schema for the field.
				</p><p>The XML snippet below is an example of Avro settings that configures the same as the default values:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;esper-configuration
  &lt;engine-settings&gt;
    &lt;defaults&gt;
      &lt;event-meta&gt;
        &lt;avro-settings enable-avro="true" enable-native-string="true" enable-schema-default-nonnull="true"
            objectvalue-typewidener-factory-class=""
            type-representation-mapper-class=""/&gt;
      &lt;/event-meta&gt;
    &lt;/defaults&gt;
  &lt;/engine-settings&gt;
&lt;/esper-configuration&gt;</pre><p>The code snippet shown next sets the default event representation to Object-array in the configuration object:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">configuration.getEngineDefaults().getEventMeta().getAvroSettings().setEnableAvro(true);
configuration.getEngineDefaults().getEventMeta().getAvroSettings().setEnableNativeString(true);
configuration.getEngineDefaults().getEventMeta().getAvroSettings().setEnableSchemaDefaultNonNull(true);
configuration.getEngineDefaults().getEventMeta().getAvroSettings().setObjectValueTypeWidenerFactoryClass(null);
configuration.getEngineDefaults().getEventMeta().getAvroSettings().setTypeRepresentationMapperClass(null);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-eventmeta-propertyreso"/>15.4.14.3.Â Java Class Property Names, Case Sensitivity and Accessor Style</h4></div></div></div><p>
					The engine-wide settings discussed here are used when you want to control case sensitivity or accessor style for all event classes as a default. The two settings are found under <code class="literal">class-property-resolution</code> under <code class="literal">event-meta</code> in the XML configuration.
				</p><p>
				  To control the case sensitivity as discussed in <a class="xref" href="#config-java-property-case-sensitivity" title="15.4.1.6.Â Case Sensitivity and Property Names">SectionÂ 15.4.1.6, âCase Sensitivity and Property Namesâ</a>, add the <code class="literal">style</code> attribute in the XML configuration to set a default case sensitivity applicable to all event classes unless specifically overridden by class-specific configuration. 
				  The default case sensitivity is <code class="literal">case_sensitive</code> (case sensitivity turned on).
				</p><p>
				  To control the accessor style as discussed in <a class="xref" href="#config-java-legacy" title="15.4.1.3.Â Non-JavaBean and Legacy Java Event Classes">SectionÂ 15.4.1.3, âNon-JavaBean and Legacy Java Event Classesâ</a>, add the <code class="literal">accessor-style</code> attribute in the XML configuration to set a default accessor style applicable to all event classes unless specifically overridden by class-specific configuration. The default accessor style is <code class="literal">javabean</code> JavaBean accessor style.
				</p><p>
					The next code snippet shows how to control this feature via the API:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getEventMeta().setClassPropertyResolutionStyle(
    Configuration.PropertyResolutionStyle.CASE_INSENSITIVE);
config.getEngineDefaults().getEventMeta().setDefaultAccessorStyle(
    ConfigurationEventTypeLegacy.AccessorStyle.PUBLIC);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-eventmeta-anonymouscache"/>15.4.14.4.Â Cache Size for Anonymous Event Types</h4></div></div></div><p>
					By default the engine maintains a cache of the last 5 recently allocated anonymous event types. Anonymous event types are unnamed output event types associated to statements.
					The <code class="literal">anonymous-cache</code> element under the <code class="literal">event-meta</code> element in the XML configuration contols the cache size.
					The cache size can be set to zero to disable the cache.
				</p><p>
					The next code snippet shows how to control this setting via the API:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getEventMeta().setAnonymousCacheSize(5);</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-engine-viewresources"/>15.4.15.Â Engine Settings Related to View Resources</h3></div></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-viewresources-sharing"/>15.4.15.1.Â Sharing View Resources Between Statements</h4></div></div></div><p>
					As multi-threaded environments are common, the engine by default does not implicitly share data windows between multiple statements. The <code class="literal">share-views</code> setting is thereby false by default.
				</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
						The preferred means of sharing data windows is by declaring a named window or table.
					</p></div><p>
					By setting <code class="literal">share-views</code> to true the engine checks upon statement creation whether it can re-use an existing statement's data window, under these conditions:
				</p><div class="itemizedlist"><ul><li><p>
							The statement does not have an associated context declared using <code class="literal">context ...</code>.
						</p></li><li><p>
							The other statement must declare the same event type, filter criteria and data window including data window parameters.
						</p></li><li><p>
							The other statement data window must be empty.
						</p></li></ul></div><p>
					Setting <code class="literal">share-views</code> to true means that statements can implicitly share locks which can reduce performance in multi-threaded environments, at the benefit of sharing data window's data structures, however that does generally not reduce memory use significantly.
				</p><p>
					The next code snippet outlines the API to turn on view resource sharing between statements:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getViewResources().setShareViews(true);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-viewresources-iterableunbound"/>15.4.15.2.Â Iterator Behavior For Unbound Streams</h4></div></div></div><p>
				   By default, when using the iterator API to iterate an EPL statement with an unbound stream the engine returns an empty iterator.
				</p><p>
				   To have the engine return the last event instead, please use the <code class="literal">@IterableUnbound</code> statement annotation or enable the engine-wide setting as described herein.
				</p><p>
					A code sample that turns iterable-unbound on is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getViewResources().setIterableUnbound(true);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-viewresources-multipolicy"/>15.4.15.3.Â Configuring Multi-Expiry Policy Defaults</h4></div></div></div><p>
				   By default, when combining multiple data windows, Esper applies an intersection of the data windows unless the <code class="literal">retain-union</code> keyword is provided which instructs to apply an union. The setting described herein may be used primarily for backward compatibility to instruct that intersection should not be the default.
				</p><p>
				   Here is a sample statement that specifies multiple expiry policies:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#unique(price)#unique(quantity)</pre><p>
				   By default Esper applies intersection as described in <a class="xref" href="#epl-from-clause-view-multidatawindow" title="5.4.4.Â Multiple Data Windows">SectionÂ 5.4.4, âMultiple Data Windowsâ</a>. 
				</p><p>
				   Here is the setting to allow multiple data windows without the intersection default:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getViewResources().setAllowMultipleExpiryPolicies(true);</pre><p>
				   When setting this option to true, and when using multiple data windows for a given stream, the behavior is as follows: The top-most data window receives an insert stream of events. It passes each insert stream event to each further data window view in the chain. Each data window view may remove events according to its expiry policy. Such remove stream events are only passed to data windows further in the chain, and are not made available to data windows earlier in the chain.
				</p><p>
				   It is recommended to leave the default setting at false.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-viewresources-outputrateopt"/>15.4.15.4.Â Configuring Output Rate Limiting Options</h4></div></div></div><p>
				   This flag impacts output rate limiting as further outlined in <a class="xref" href="#appendix_outputlimit" title="AppendixÂ B.Â Runtime Considerations for Output Rate Limiting">AppendixÂ B, <i>Runtime Considerations for Output Rate Limiting</i></a>. The flag serves to control the default behavior for output rate limiting for all statements that do not specify a hint.
				</p><p>
				   If set to true (the default), all statements behave as if they hint <code class="literal">@Hint('enable_outputlimit_opt')</code>.
				</p><p>
				   If set to false, all statements behave as if they hint <code class="literal">@Hint('disable_outputlimit_opt')</code>.
				</p><p>
				   Here is the setting to allow multiple data windows without the intersection default:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getViewResources().setOutputLimitOpt(true);</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-engine-logging"/>15.4.16.Â Engine Settings Related to Logging</h3></div></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-logging-execpath"/>15.4.16.1.Â Execution Path Debug Logging</h4></div></div></div><p>
				   By default, the engine does not produce debug output for the event processing execution paths even when Log4j or Logger configurations have been set to output debug level logs.
				   To enable debug level logging, set this option in the configuration as well as in your Log4j configuration file.
				</p><p>
					Statement-level processing information can be output via the <code class="literal">@Audit</code> annotation, please see <a class="xref" href="#devlifecycle-debugging-audit" title="16.3.1.Â @Audit Annotation">SectionÂ 16.3.1, â@Audit Annotationâ</a>.
				</p><p>
				   When debug-level logging is enabled by setting the flag as below and by setting DEBUG in the Log4j configuration file, then the timer processing may produce extensive debug output that
				   you may not want to have in the log file. The <code class="literal">timer-debug</code> setting in the XML or via API as below disables timer debug output which is enabled by default.
				</p><p>
					The API to use to enable debug logging and disable timer event output is shown here:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getLogging().setEnableExecutionDebug(true);
config.getEngineDefaults().getLogging().setEnableTimerDebug(false);</pre><p>
					Note: this is a configuration option that applies to all engine instances of a given Java module or VM.
				</p><p>
					The XML snippet is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;esper-configuration&gt;
  &lt;engine-settings&gt;
    &lt;defaults&gt;
      &lt;logging&gt;
        &lt;execution-path enabled="true"/&gt;
        &lt;timer-debug enabled="false"/&gt;
    &lt;/logging&gt;
    &lt;/defaults&gt;
  &lt;/engine-settings&gt;
&lt;/esper-configuration&gt;</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-logging-queryplan"/>15.4.16.2.Â Query Plan Logging</h4></div></div></div><p>
				   By default, the engine does not produce query plan output unless logging at debug-level. 
				   To enable query plan logging, set this option in the configuration. When enabled, the engine reports, at INFO level, any query plans under the log name <code class="literal">com.espertech.esper.queryplan</code>.
				</p><p>
					Query plan logging is applicable to subqueries, joins (any type), named window and table on-actions (on-select, on-merge, on-insert, on-update, on-select) and fire-and-forget queries. 
					It is not applicable and will not provide additional information for other types of constructs.
				</p><p>
					The API to use to enable query plan logging is shown here:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getLogging().setEnableQueryPlan(true);</pre><p>
					The XML snippet is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;esper-configuration&gt;
  &lt;engine-settings&gt;
    &lt;defaults&gt;
      &lt;logging&gt;
        &lt;query-plan enabled="true"/&gt;
    &lt;/logging&gt;
    &lt;/defaults&gt;
  &lt;/engine-settings&gt;
&lt;/esper-configuration&gt;</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-logging-jdbc"/>15.4.16.3.Â JDBC Logging</h4></div></div></div><p>
				   By default, the engine does not measure JDBC query execution times or report the number of rows returned from a JDBC query through logging. 
				   To enable JDBC logging, set this option in the configuration. When enabled, the engine reports, at INFO level, any JDBC query performance and number of rows returned under the log name <code class="literal">com.espertech.esper.jdbc</code>.
				</p><p>
					The API to use to enable JDBC query logging is shown here:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getLogging().setEnableJDBC(true);</pre><p>
					The XML snippet is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;esper-configuration&gt;
  &lt;engine-settings&gt;
    &lt;defaults&gt;
      &lt;logging&gt;
        &lt;jdbc enabled="true"/&gt;
    &lt;/logging&gt;
    &lt;/defaults&gt;
  &lt;/engine-settings&gt;
&lt;/esper-configuration&gt;</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-logging-audit"/>15.4.16.4.Â Audit Logging</h4></div></div></div><p>
				   The settings herein control the output format of <code class="literal">@Audit</code> logs.
				</p><p>
					This setting applies to all engine instances in the same JVM. Please also see the API documentation for information on pattern conversion characters.
				</p><div class="table"><a id="d0e42262"/><p class="title"><b>TableÂ 15.4.Â Audit Log Conversion Characters</b></p><div class="table-contents"><table summary="Audit Log Conversion Characters" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Character</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">m</code></td><td>Audit message.</td></tr><tr><td><code class="literal">s</code></td><td>Statement name.</td></tr><tr><td><code class="literal">u</code></td><td>Engine URI.</td></tr></tbody></table></div></div><br class="table-break"/><p>
					The API to use to set am audit log format is shown here:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getLogging().setAuditPattern("[%u] [%s] %m");</pre><p>
					The XML snippet is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;esper-configuration&gt;
  &lt;engine-settings&gt;
    &lt;defaults&gt;
      &lt;logging&gt;
        &lt;audit pattern="[%u] [%s]%m"/&gt;
    &lt;/logging&gt;
    &lt;/defaults&gt;
  &lt;/engine-settings&gt;
&lt;/esper-configuration&gt;</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-logging-code"/>15.4.16.5.Â Byte Code Generation Logging</h4></div></div></div><p>
				   By enabling this setting the engine logs byte code generation information at INFO level. This setting is disabled by default.
				</p><p>
					The API to use to enable logging for generated code is shown here:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getLogging().setEnableCode(true);</pre><p>
					The XML snippet is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;esper-configuration&gt;
  &lt;engine-settings&gt;
    &lt;defaults&gt;
      &lt;logging&gt;
        &lt;code enabled="true"/&gt;
    &lt;/logging&gt;
    &lt;/defaults&gt;
  &lt;/engine-settings&gt;
&lt;/esper-configuration&gt;</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-engine-variables"/>15.4.17.Â Engine Settings Related to Variables</h3></div></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-variables-lifetimeold"/>15.4.17.1.Â Variable Version Release Interval</h4></div></div></div><p>
				   This setting controls the length of time that the engine retains variable versions for use by statements that use variables and that execute, within the same statement for the same event, longer then the time interval.
				   By default, the engine retains 15 seconds of variable versions.
				</p><p>
				   For statements that use variables and that execute (in response to a single timer or other event) longer then the time period, the engine returns the current variable version at the time the statement executes, thereby softening the guarantee of consistency of variable values within the long-running statement. Please see <a class="xref" href="#variable_using" title="5.17.3.Â Using Variables">SectionÂ 5.17.3, âUsing Variablesâ</a> for more information.
				</p><p>
					The XML configuration for this setting is shown below:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;variables&gt;
      &lt;msec-version-release value="15000"/&gt;
    &lt;/variables&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-engine-patterns"/>15.4.18.Â Engine Settings Related to Patterns</h3></div></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-patterns-max"/>15.4.18.1.Â Followed-By Operator Maximum Subexpression Count</h4></div></div></div><p>
				   You may use this setting to limit the total engine-wide number of pattern sub-expressions that all followed-by operators may manage. When the limit is reached, a condition is raised by the engine through the condition callback API.
				</p><p>
				  By default, when the limit is reached, the engine also prevents the start of new pattern sub-expressions, until pattern sub-expressions end and the limit is no longer reached. By setting the <code class="literal">prevent-start</code> flag to false you can instruct the engine to only raise a condition and continue to allow the start of new pattern sub-expressions.
				</p><p>
				  The implications of the settings described herein are also detailed in <a class="xref" href="#pattern-temporal-followed-by-engine-max" title="7.5.8.2.Â Limiting Engine-wide Sub-Expression Count">SectionÂ 7.5.8.2, âLimiting Engine-wide Sub-Expression Countâ</a>.
				</p><p>
					A sample XML configuration for this setting is shown below:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;patterns&gt;
      &lt;max-subexpression value="100" prevent-start="false"/&gt;
    &lt;/patterns&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
				  The limit can be changed and disabled or enabled at runtime via the runtime configuration API. Pass a null value as the limit to disable limit checking.
				</p><p>
				  A sample code snippet that sets a new limit is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epService.getEPAdministrator().getConfiguration().setPatternMaxSubexpressions(100L);</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-engine-matchrecognize"/>15.4.19.Â Engine Settings Related to Match-Recognize</h3></div></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-matchrecognize-max"/>15.4.19.1.Â Maximum State Count</h4></div></div></div><p>
				   You may use this setting to limit the total engine-wide number of states that all match-recognize constructs may manage. 
				   When the limit is reached, a condition is raised by the engine through the condition callback API.
				</p><p>
				  By default, when the limit is reached, the engine also prevents the allocation of new states, until states get removed and the limit is no longer reached. By setting the <code class="literal">prevent-start</code> flag to false you can instruct the engine to only raise a condition and continue to allow the allocation of new states.
				</p><p>
				  The implications of the settings described herein are also detailed in <a class="xref" href="#match-recognize-state-max" title="8.11.Â Limiting Engine-Wide State Count">SectionÂ 8.11, âLimiting Engine-Wide State Countâ</a>.
				</p><p>
					A sample XML configuration for this setting is shown below:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;match-recognize&gt;
      &lt;max-state value="100" prevent-start="false"/&gt;
    &lt;/match-recognize&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
				  The limit can be changed and disabled or enabled at runtime via the runtime configuration API. Pass a null value as the limit to disable limit checking.
				</p><p>
				  A sample code snippet that sets a new limit is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epService.getEPAdministrator().getConfiguration().setMatchRecognizeMaxStates(100L);</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-engine-scripts"/>15.4.20.Â Engine Settings Related to Scripts</h3></div></div></div><p>
			   You may configure a default script dialect as described herein. The default script dialect is <code class="literal">js</code> which stands for JavaScript, since most JVM ship with an integrated JavaScript engine.
			</p><p>
				A sample XML configuration for this setting is shown below:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
&lt;defaults&gt;
  &lt;scripts default-dialect="js"/&gt;
&lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
			  A sample code snippet that sets a new script dialect is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">config.getEngineDefaults().getScripts().setDefaultDialect("js");</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-engine-stream-selection"/>15.4.21.Â Engine Settings Related to Stream Selection</h3></div></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-streamselect-choices"/>15.4.21.1.Â Default Statement Stream Selection</h4></div></div></div><p>
				   Statements can produce both insert stream (new data) and remove stream (old data) results. Remember that insert stream refers to arriving events and new aggregation values, while remove stream refers to events leaving data windows and prior aggregation values. By default, the engine delivers only the insert stream to listeners and observers of a statement.
				</p><p>
				   There are keywords in the <code class="literal">select</code> clause that instruct the engine to not generate insert stream and/or remove stream results if your application does not need either one of the streams. These keywords are the <code class="literal">istream</code>, <code class="literal">rstream</code> and the <code class="literal">irstream</code> keywords. 
				</p><p>
				   By default, the engine only generates insert stream results equivalent to using the optional <code class="literal">istream</code> keyword in the <code class="literal">select</code> clause.
				   If you application requires insert and remove stream results for many statements, your application can add the <code class="literal">irstream</code> keyword to the <code class="literal">select</code> clause of each statement,
				   or you can set a new default stream selector via this setting.
				</p><p>
					The XML configuration for this setting is shown below:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;stream-selection&gt;
      &lt;stream-selector value="irstream" /&gt;
    &lt;/stream-selection&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
					The equivalent code snippet using the configuration API is here:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getStreamSelection()
    .setDefaultStreamSelector(StreamSelector.RSTREAM_ISTREAM_BOTH);</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-engine-time-source"/>15.4.22.Â Engine Settings Related to Time Source</h3></div></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-timesource-choices"/>15.4.22.1.Â Default Time Source</h4></div></div></div><p>
				   This setting only applies if internal timer events control engine time (default). If external timer events provide engine clocking, the setting does not apply.
				</p><p>
				   By default, the internal timer uses the call <code class="literal">System.currentTimeMillis()</code> to determine engine time in milliseconds. Via this setting the internal timer can be instructed to use <code class="literal">System.nanoTime()</code> instead. Please see <a class="xref" href="#api-time-resolution" title="14.8.2.Â Time Resolution and Time Unit">SectionÂ 14.8.2, âTime Resolution and Time Unitâ</a> for more information. 
				</p><p>
					Note: This is a Java VM global setting. If running multiple engine instances in a Java VM, the timer setting is global and applies to all engine instances in the same Java VM, for performance reasons.
				</p><p>
					A sample XML configuration for this setting is shown below, whereas the sample setting sets the time source to the nanosecond time provider:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;time-source&gt;
      &lt;time-source-type value="nano" /&gt;
    &lt;/time-source&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
					The equivalent code snippet using the configuration API is here:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getTimeSource().
      setTimeSourceType(ConfigurationEngineDefaults.TimeSourceType.NANO);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-timeunit"/>15.4.22.2.Â Time Unit</h4></div></div></div><p>
				   The default time unit of time resolution is milliseconds. Your application may set the time resolution to microseconds instead.
				</p><p>
					A sample XML configuration for millisecond time resolution is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;time-source&gt;
      &lt;time-unit value="milliseconds"/&gt;
    &lt;/time-source&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
					The equivalent code snippet using the configuration API is here:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getTimeSource().setTimeUnit(TimeUnit.MILLISECONDS);</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-engine-jmxmetrics"/>15.4.23.Â Engine Settings Related to JMX Metrics</h3></div></div></div><p>
				Please set the flag as described herein to have the engine report key counters and other processing information through the JMX mbean platform server. By default JMX is not enabled.
				For NEsper .NET this section does not apply and there is currently no equivalent.
			</p><p>
			    A sample XML configuration is shown below:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;metrics-reporting jmx-engine-metrics="true"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
			    A sample code snippet to set this configuration via the API follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">configuration.getEngineDefaults().getMetricsReporting().setJmxEngineMetrics(true);</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-engine-instrumentation"/>15.4.24.Â Engine Settings Related to Metrics Reporting</h3></div></div></div><p>
				This section explains how to enable and configure metrics reporting, which is by default disabled. Please see <a class="xref" href="#api-instrumentation" title="14.14.Â Engine and Statement Metrics Reporting">SectionÂ 14.14, âEngine and Statement Metrics Reportingâ</a> for more information on the metrics data reported to your application.
			</p><p>
				The flag that enables metrics reporting is global to a Java virtual machine. If metrics reporting is enabled, the overhead incurred for reporting metrics is carried by all engine instances per Java VM.
			</p><p>
				Metrics reporting occurs by an engine-controlled separate daemon thread that each engine instance starts at engine initialization time, if metrics reporting and threading is enabled (threading enabled is the default).
			</p><p>
			    Engine and statement metric intervals are in milliseconds. A negative or zero millisecond interval value may be provided to disable reporting.
			</p><p>
			    To control statement metric reporting for individual statements or groups of statements, the engine provides a facility that groups statements by statement name. 
			    Each such statement group may have different reporting intervals configured, and intervals can be
			    changed at runtime through runtime configuration. A statement group is assigned a group name at configuration time to identify the group.
			</p><p>
			    Metrics reporting configuration is part of the engine default settings. All configuration options are also available via the <code class="literal">Configuration</code> API.
			</p><p>
			    A sample XML configuration is shown below:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;metrics-reporting enabled="true" engine-interval="1000" statement-interval="1000" 
        threading="true"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
			    The <code class="literal">engine-interval</code> setting (defaults to 10 seconds) determines the frequency in milliseconds at which the engine reports engine metrics, in this example every 1 second. The <code class="literal">statement-interval</code> is for statement metrics. The <code class="literal">threading</code> flag is true by default since reporting takes place by a dedicated engine thread and can be set to false to use the external or internal timer thread instead.
			</p><p>
			    The next example XML declares a statement group: The statements that have statement names that fall within the group follow a different reporting frequency:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;metrics-reporting enabled="true" statement-interval="0"&gt;
  &lt;stmtgroup name="MyStmtGroup" interval="2000" default-include="true" num-stmts="100" 
        report-inactive="true"&gt;
    &lt;exclude-regex&gt;.*test.*&lt;/exclude-regex&gt;
  &lt;/stmtgroup&gt;
&lt;/metrics-reporting&gt;</pre><p>
			    The above example configuration sets the <code class="literal">statement-interval</code> to zero to disable reporting for all statements. It defines a statement group by name <code class="literal">MyStmtGroup</code> and specifies a 2-second interval. The example sets the <code class="literal">default-include</code> flag to true (by default false) to include all statements in the statement group. The example also sets <code class="literal">report-inactive</code> to true (by default false) to report inactive statements.
			</p><p>
			  The <code class="literal">exclude-regex</code> element may be used to specify a regular expression that serves to exclude statements from the group. Any statement whose statement name matches the exclude regular expression is not included in the group. In the above example, all statements with the characters 'test' inside their statement name are excluded from the group.
			</p><p>
			  Any statement not belonging to any of the statement groups follow the configured statement interval. 
			</p><p>
			 There are additional elements available to include and exclude statements: <code class="literal">include-regex</code>, <code class="literal">include-like</code> and <code class="literal">exclude-like</code>. The latter two apply SQL-like matching. All patterns are case-sensitive.
			</p><p>
			 Here is a further example of a possible statement group definition, which includes statements whose statement name have the characters <code class="literal">@REPORT</code> or <code class="literal">@STREAM</code>, and excludes statements whose statement name have the characters <code class="literal">@IGNORE</code> or <code class="literal">@METRICS</code> inside.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;metrics-reporting enabled="true"&gt;
  &lt;stmtgroup name="MyStmtGroup" interval="1000"&gt;
    &lt;include-like&gt;%@REPORT%&lt;/include-like&gt;
    &lt;include-regex&gt;.*@STREAM.*&lt;/include-like&gt;
    &lt;exclude-like&gt;%@IGNORE%&lt;/exclude-like&gt;
    &lt;exclude-regex&gt;.*@METRICS.*&lt;/exclude-regex&gt;
  &lt;/stmtgroup&gt;
&lt;/metrics-reporting&gt;</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-engine-language"/>15.4.25.Â Engine Settings Related to Language and Locale</h3></div></div></div><p>
				Locale-dependence in Esper can be present in the sort order of string values by the <code class="literal">order by</code> clause and by the sort window.
			</p><p>
				By default, Esper sorts string values using the <code class="literal">compare</code> method that is not locale dependent. To enable local dependent sorting you must set the configuration flag as described below.
			</p><p>
			 The XML configuration sets the locale dependent sorting as shown below:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;language sort-using-collator="true"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
			 The API to change the setting:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getLanguage().setSortUsingCollator(true);</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-engine-expression"/>15.4.26.Â Engine Settings Related to Expression Evaluation</h3></div></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-expression-division"/>15.4.26.1.Â Integer Division and Division by Zero</h4></div></div></div><p>
					By default Esper returns double-typed values for divisions regardless of operand types. Division by zero returns positive or negative double infinity.
				</p><p>
					To have Esper use Java-standard integer division instead, use this setting as described here. In Java integer division, when dividing integer types, the result is an integer type. This means that if you divide an integer unevenly by another integer, it returns the whole number part of the result, does not perform any rounding and the fraction part is dropped. If Java-standard integer division is enabled, when dividing an integer numerator by an integer denominator, the result is an integer number. Thus the expression <code class="literal">1 / 4</code> results in an integer zero. Your EPL must then convert at least one of the numbers to a double value before the division, for example by specifying <code class="literal">1.0 / 4</code> or by using <code class="literal">cast(myint, double)</code>.
				</p><p>
					When using Java integer division, division by zero for integer-typed operands always returns null. However division by zero for double-type operands still returns positive or negative double infinity. To also return null upon division by zero for double-type operands, set the flag to true as below (default is false).
				</p><p>
				 The XML configuration is as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;expression integer-division="false" division-by-zero-is-null="false"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
				 The API to change the setting:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getExpression().setIntegerDivision(true);
config.getEngineDefaults().getExpression().setDivisionByZeroReturnsNull(true);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-expression-subselecteval"/>15.4.26.2.Â Subselect Evaluation Order</h4></div></div></div><p>
					By default Esper updates sub-selects with new events before evaluating the enclosing statement. This is relevant for statements that look for the same event in both the <code class="literal">from</code> clause and subselects.
				</p><p>
					To have Esper evaluate the enclosing clauses before updating the subselect in a subselect expression, set the flag as indicated herein.
				</p><p>
					 The XML configuration as below sets the same as the default value:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;expression self-subselect-preeval="true"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
					 Here is a sample statement that utilitzes a sub-select against the same-events:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent where prop not in (select prop from MyEvent#unique(otherProp))</pre><p>
					 By default the subselect data window updates first before the <code class="literal">where</code> clause is evaluated, thereby above statement never returns results.
				</p><p>
					 Changing the setting described here causes the <code class="literal">where</code> clause to evaluate before the subselect data window updates, thereby the statement does post results.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-expression-udfcache"/>15.4.26.3.Â User-Defined Function or Static Method Cache</h4></div></div></div><p>
					By default Esper caches the result of an user-defined function if the parameter set to that function is empty or all parameters are constant values. Results of custom plug-in single-row functions are not cached according to the default configuration, unless the single-row function is explicitly configured with value cache enabled.
				</p><p>
					To have Esper evaluate the user-defined function regardless of constant parameters, set the flag to false as indicated herein.
				</p><p>
					 The XML configuration as below sets the same as the default value:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;expression udf-cache="true"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-expression-extendedagg"/>15.4.26.4.Â Extended Built-in Aggregation Functions</h4></div></div></div><p>
					By default Esper provides a number of additional aggregation functions over the SQL standards. To have Esper only allow the standard SQL aggregation functions and not the additional ones,
					disable the setting as described here.
				</p><p>
					 The XML configuration as below sets the same as the default value:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;expression extend-agg="true"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-expression-ducktype"/>15.4.26.5.Â Duck Typing</h4></div></div></div><p>
					By default Esper validates method references when using the dot operator syntax at time of statement creation. With duck typing, the engine resolves method references at runtime.
				</p><p>
					 The XML configuration as below sets the same as the default value:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;expression ducktyping="false"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-expression-mathcontext"/>15.4.26.6.Â Math Context</h4></div></div></div><p>
					By default, when computing the average of BigDecimal values, the engine does not pass a <code class="literal">java.math.MathContext</code>.
					Use the setting herein to specify a default math context.
				</p><p>
					 The below XML configuration sets precision to 2 and rounding mode ceiling:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;expression math-context="precision=2 roundingMode=CEILING"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
					 An example API configuration is shown next:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">config.getEngineDefaults().getExpression().setMathContext(...);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-expression-timezone"/>15.4.26.7.Â Time Zone</h4></div></div></div><p>
					By default, when performing calendar operations, the engine uses the default time zone obtained by <code class="literal">java.util.TimeZone.getDefault()</code>.
					Use the setting herein to specify a time zone other then the default time zone.
				</p><p>
					 The below XML configuration sets a time zone 'GMT-4:00':
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;expression time-zone="GMT-4:00"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
					 An example API configuration is shown next:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">config.getEngineDefaults().getExpression().setTimeZone(TimeZone.getTimeZone("GMT-4:00"));</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-engine-execution"/>15.4.27.Â Engine Settings Related to Execution of Statements</h3></div></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-execution-prioritized"/>15.4.27.1.Â Prioritized Execution</h4></div></div></div><p>
					By default Esper ignores @Priority and @Drop annotations and executes unprioritized, that is the engine does not attempt to interpret assigned priorities and reorder executions based on priority. Use this setting if your application requires prioritized execution.
				</p><p>
					By setting this configuration, the engine executes statements, when an event or schedule matches multiple statements, according to the assigned priority, starting from the highest priority value. See built-in EPL annotations in <a class="xref" href="#epl-syntax-annotation-priority" title="5.2.7.7.Â @Priority">SectionÂ 5.2.7.7, â@Priorityâ</a>.
				</p><p>
					By enabling this setting view sharing between statements as described in <a class="xref" href="#config-engine-viewresources-sharing" title="15.4.15.1.Â Sharing View Resources Between Statements">SectionÂ 15.4.15.1, âSharing View Resources Between Statementsâ</a> is disabled.
				</p><p>
					 The XML configuration to enable the flag, which is disabled by default, is as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;execution prioritized="true"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
				 The API to change the setting:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getExecution().setPrioritized(true);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-execution-fairlock"/>15.4.27.2.Â Context Partition Fair Locking</h4></div></div></div><p>
					By default Esper configures context partition locks without fair locking. If your application is multi-threaded and performs very frequent reads via iterator or fire-and-forget queries, you may need to set this flag to prevent lock starvation in the face of concurrent reads and writes. Please consult the Java API documentation under <code class="literal">ReentrantReadWriteLock</code> and <span class="emphasis"><em>Fair Mode</em></span> for more information.
				</p><p>
					 The XML configuration to enable fair locking, which is disabled by default, is as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;execution fairlock="true"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
				 The API to change the setting:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getExecution().setFairlock(true);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-execution-disablelock"/>15.4.27.3.Â Disable Locking</h4></div></div></div><p>
					By default Esper configures context partition locks as required after analyzing your EPL statements. You may disable context partition locks engine-wide using the setting described here. Use the <code class="literal">@NoLock</code> annotation instead to disable locking for a given statement or named window only.
				</p><p>
					CAUTION: Esper provides this setting for the purpose of identifying locking overhead, or when your application is single-threaded, or when using an external mechanism for concurrency control.
					Setting disable-locking to true may have unpredictable results unless your application is taking concurrency under consideration.
				</p><p>
					 The XML configuration to disable context level locking is as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;execution disable-locking="true"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
				 The API to change the setting:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getExecution().setDisableLocking(true);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-execution-threadingprofile"/>15.4.27.4.Â Threading Profile</h4></div></div></div><p>
					This setting is for performance tuning when using a large number of threads, such as 100 or more threads.
				</p><p>
					The configuration provides a setting that instructs the engine to reduce the use of thread-local variables. As the engine may use thread-local variables to reduce temporary object allocation, it can potentially use too much memory when a large number of threads are used with the engine. By setting the threading profile to large, the engine will allocate temporary objects instead of using thread-local variables for certain logic. Currently this setting applies exclusively to patterns and their filter expressions.
				</p><p>
					 The XML configuration to set a large threading profile is as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;execution threading-profile="large"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
				 The API to change the setting:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getExecution().setThreadingProfile(
    ConfigurationEngineDefaults.ThreadingProfile.LARGE);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-execution-filterserviceprofile"/>15.4.27.5.Â Filter Service Profile</h4></div></div></div><p>
					This setting is for performance tuning of filter service which handles matching incoming events to context partitions and statements.
				</p><p>
					In the default configuration termed <code class="literal">readmostly</code>, filter service locking is coarse-grained assuming a large number of reads and comparatively few writes.
					"Reads" are evaluations of events, while with "writes" we mean filter service changes such as new statements, a new pattern subexpression becoming active or a 
					pattern subexpression being deactivated.
				</p><p>
					Set the configuration to <code class="literal">readwrite</code> if you have multiple threads and your statements very frequently add and remove filters using pattern subexpressions, for example.
					This setting instructs the engine to maintain fine-grained locks instead generally allowing for higher concurrency but possibly incurring additional overhead.
				</p><p>
					 The XML configuration to set a new filter service profile is as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;execution filter-server-profile="readwrite"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
				 The API to change the setting:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getExecution().
    setFilterServiceProfile(ConfigurationEngineDefaults.FilterServiceProfile.READWRITE);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-execution-filterservicemaxfilterwidth"/>15.4.27.6.Â Filter Service Max Filter Width</h4></div></div></div><p>
					This setting is for performance tuning of filter expression analysis and breakdown.
				</p><p>
					In the default configuration the setting is 16, which means that the filter expression analyzer can at most create 16 path expressions from a given filter expression. If the number of
					path expressions is over 16, the expression will instead be evaluated as non-path and not be subject to to be entered into filter indexes.
				</p><p>
					On the level of an EPL statement, this setting can be controlled by providing a hint. For example:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// The engine optimizes the filter expression to become:
//   "a=1, c=1" or "b=1, c=1" or "a=1, d=1" or "b=1, d=1".
//   This enables filter index sharing between filter expressions.
select * from Event((a=1 or b=1) and (c=1 or d=1))</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// The engine does not optimize filter expressions
@Hint('MAX_FILTER_WIDTH=0') select * from Event((a=1 or b=1) and (c=1 or d=1))</pre><p>
					 The XML configuration to sets a new engine-wide value:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;execution filter-service-max-filter-width="100"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
				 The API to change the setting:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getExecution().
    setFilterServiceMaxFilterWidth(16);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-execution-allowisolatedservice"/>15.4.27.7.Â Allow Isolated Service Provider</h4></div></div></div><p>
					By default isolated service provider is disabled to reduce engine overhead. Before using isolated service providers you must enable as described herein.
				</p><p>
					 The XML configuration to enable isolated service providers is as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;execution allow-isolated-service="true"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
				 The API to change the setting:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getExecution().setAllowIsolatedService(true);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="config-engine-execution-declaredexprvaluecachesize"/>15.4.27.8.Â Declared Expression Value Cache Size</h4></div></div></div><p>
					In the default configuration the setting is 1, which means that for each declared expression the engine retains a cache of only the last computed value, 
					for use for the duration of an evaluation of an event or time against a context partition.
					You may set the value to zero to disable caching.
					You may set the value to N to instruct the engine to retain a cache of the last N computed values.
					This setting is not applicable to stateful declared expressions such as declared expressions with aggregation functions, for example.
				</p><p>
					 The XML configuration to sets the same value as the default:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;execution declared-expr-value-cache-size="1"/&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
				 The API to change the setting:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getExecution().
    setDeclaredExprValueCacheSize(1);</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-engine-exceptionhandling"/>15.4.28.Â Engine Settings Related to Exception Handling</h3></div></div></div><p>
				Use the settings as described here to register an exception handler factory class that provides an exception handler. The engine invokes exception handlers in the order they are listed to handle a continues-query unchecked exception, as further described in <a class="xref" href="#api-exception" title="14.10.Â Exception Handling">SectionÂ 14.10, âException Handlingâ</a>.
				Please provide the full-qualified class name of each class that implements the <code class="literal">com.espertech.esper.client.hook.ExceptionHandlerFactory</code> interface in the engine defaults configuration as below.
			</p><p>
				By default, during a module undeploy when the engine encounters a runtime exception for any of the statements it logs such exceptions as warnings. 
				You can set the <code class="literal">undeploy-rethrow-policy</code> flag to <code class="literal">rethrow_first</code> instead have the engine rethrow the first runtime exception.
			</p><p>
				 The XML configuration is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;exceptionHandling undeploy-rethrow-policy="warn"&gt;
      &lt;handlerFactory class="my.company.cep.MyCEPEngineExceptionHandlerFactory"/&gt;
    &lt;/exceptionHandling&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
			 The API calls to register an exception handler factory are as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getExceptionHandling().addClass(MyCEPEngineExceptionHandlerFactory.class);
config.getEngineDefaults().getExceptionHandling().setUndeployRethrowPolicy(ConfigurationEngineDefaults.ExceptionHandling.UndeployRethrowPolicy.RETHROW_FIRST);</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-engine-conditionhandling"/>15.4.29.Â Engine Settings Related to Condition Handling</h3></div></div></div><p>
				Use the settings as described here to register a condition handler factory class that provides a condition handler. The engine invokes condition handlers in the order they are listed to indicate conditions, which is the term used for notification when certain predefined limits are reached, as further described in <a class="xref" href="#api-condition" title="14.11.Â Condition Handling">SectionÂ 14.11, âCondition Handlingâ</a>.
			</p><p>
				Please provide the full-qualified class name of each class that implements the <code class="literal">com.espertech.esper.client.hook.ConditionHandlerFactory</code> interface in the engine defaults configuration as below.
			</p><p>
				 The XML configuration is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;engine-settings&gt;
  &lt;defaults&gt;
    &lt;conditionHandling&gt;
      &lt;handlerFactory class="my.company.cep.MyCEPEngineConditionHandlerFactory"/&gt;
    &lt;/conditionHandling&gt;
  &lt;/defaults&gt;
&lt;/engine-settings&gt;</pre><p>
			 The API calls to register a condition handler factory are as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getConditionHandling().addClass(MyCEPEngineConditionHandlerFactory.class);</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-revisionevent"/>15.4.30.Â Revision Event Type</h3></div></div></div><p>
			   Revision event types reflect a versioning relationship between events of same or different event types. Please refer to <a class="xref" href="#eventrep-update" title="3.8.Â Updating, Merging and Versioning Events">SectionÂ 3.8, âUpdating, Merging and Versioning Eventsâ</a> and <a class="xref" href="#named_versioning" title="6.11.Â Versioning and Revision Event Type Use With Named Windows">SectionÂ 6.11, âVersioning and Revision Event Type Use With Named Windowsâ</a>.
			</p><p>
				The configuration consists of the following:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						An name of an event type whose events are <span class="emphasis"><em>base</em></span> events.
					</p></li><li><p>
						Zero, one or more names of event types whose events are <span class="emphasis"><em>delta</em></span> events.
					</p></li><li><p>
						One or more property names that supply the key values that tie base and delta events to existing revision events. Properties must exist on the event type as simple properties. Nested, indexed or mapped properties are not allowed.
					</p></li><li><p>
						Optionally, a strategy for overlaying or merging properties. The default strategy is <span class="emphasis"><em>Overlay Declared</em></span> as described below.
					</p></li></ul></div><p>
				The XML configuration for this setting is shown below:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;revision-event-type name="UserProfileRevisions"&gt;
  &lt;base-event-type name="ProfileCreation"/&gt;
  &lt;delta-event-type name="ProfileUpdate"/&gt;
  &lt;key-property name="userid"/&gt;
&lt;/revision-event-type&gt;</pre><p>
				If configuring via runtime or initialization-time API, this code snippet explains how:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
ConfigurationRevisionEventType configRev = new ConfigurationRevisionEventType();
configRev.setNameBaseEventType("ProfileCreation");
configRev.addNameDeltaEventType("ProfileUpdate");
configRev.setKeyPropertyNames(new String[] {"userid"});
config.addRevisionEventType("UserProfileRevisions", configRev);</pre><p>
				As the configuration provides names of base and delta event types, such names must be configured for JavaBean, Map or XML events as the previous sections outline.
			</p><p>
				The next table outlines the available strategies:
			</p><div class="table"><a id="d0e42961"/><p class="title"><b>TableÂ 15.5.Â Property Revision Strategies</b></p><div class="table-contents"><table summary="Property Revision Strategies" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>Overlay Declared (default)</td><td>
								<p>A fast strategy for revising events that groups properties provided by base and delta events and overlays contributed properties to compute a revision.</p>
								<p>For use when there is a limited number of combinations of properties that change on an event, and such combinations are known in advance.</p>
							    <p>The properties available on the output revision events are all properties of the base event type. Delta event types do not add any additional properties that are not present on the base event type.</p>
								<p>Any null values or non-existing property on a delta (or base) event results in a null values for the same property on the output revision event.</p>
							</td></tr><tr><td>Merge Declared</td><td> 
							    <p>A strategy for revising events by merging properties provided by base and delta events, considering null values and non-existing (dynamic) properties as well.</p>
							    <p>For use when there is a limited number of combinations of properties that change on an event, and such combinations are known in advance.</p>
							    <p>The properties available on the output revision events are all properties of the base event type plus all additional properties that any of the delta event types provide.</p>
								<p>Any null values or non-existing property on a delta (or base) event results in a null values for the same property on the output revision event.</p>
							</td></tr><tr><td>Merge Non-null</td><td>
							    <p>A strategy for revising events by merging properties provided by base and delta events, considering only non-null values.</p>
								<p>For use when there is an unlimited number of combinations of properties that change on an event, or combinations are not known in advance.</p>
							    <p>The properties available on the output revision events are all properties of the base event type plus all additional properties that any of the delta event types provide.</p>
								<p>Null values returned by delta (or base) event properties provide no value to output revision events, i.e. null values are not merged.</p>
							</td></tr><tr><td>Merge Exists</td><td>
								 <p>A strategy for revising events by merging properties provided by base and delta events, considering only values supplied by event properties that exist.</p>
								 <p>For use when there is an unlimited number of combinations of properties that change on an event, or combinations are not known in advance.</p>
							    <p>The properties available on the output revision events are all properties of the base event type plus all additional properties that any of the delta event types provide.</p>
								 <p>All properties are treated as dynamic properties: If an event property does not exist on a delta event (or base) event the property provides no value to output revision events, i.e. non-existing property values are not merged.</p>
							</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="config-variantstream"/>15.4.31.Â Variant Stream</h3></div></div></div><p>
			   A <span class="emphasis"><em>variant stream</em></span> is a predefined stream into which events of multiple disparate event types can be inserted, and which can be selected from in patterns and the <code class="literal">from</code> clause.
			</p><p>
				The name of the variant stream and, optionally, the type of events that the stream may accept, are part of the stream definition. By default, the variant stream accepts only the predefined event types. The engine validates your <code class="literal">insert into</code> clause which inserts into the variant stream against the predefined types.
			</p><p>
				A variant stream can be set to accept any type of event, in which case all properties of the variant stream are effectively dynamic properties. Set the <code class="literal">type variance</code> flag to <code class="literal">ANY</code> to indicate the variant stream accepts any type  of event.
			</p><p>
				The following XML configuration defines a variant stream by name <code class="literal">OrderStream</code> that carries only <code class="literal">PartsOrder</code> and <code class="literal">ServiceOrder</code> events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;variant-stream name="OrderStream"&gt;
  &lt;variant-event-type name="PartsOrder"/&gt;
  &lt;variant-event-type name="ServiceOrder"/&gt;
&lt;/variant-stream&gt;</pre><p>
				This code snippet sets up a variant stream by name <code class="literal">OutgoingEvent</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
ConfigurationVariantStream variant = new ConfigurationVariantStream();
variant.setTypeVariance(ConfigurationVariantStream.TypeVariance.ANY);
config.addVariantStream("OutgoingEvent", variant);</pre><p>
				If specifying variant event type names, make sure such names have been configured for JavaBean, Map or XML events.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-type-names"/>15.5.Â Type Names</h2></div></div></div><p>
			Certain configuration values accept type names. Type names can occur in the configuration of variable types, Map-event property types as well as XPath cast types, for example. Types names are not case-sensitive.
		</p><p>
			The table below outlines all possible type names:
		</p><div class="table"><a id="d0e43095"/><p class="title"><b>TableÂ 15.6.Â Variable Type Names</b></p><div class="table-contents"><table summary="Variable Type Names" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Type Name</th><th>Type</th></tr></thead><tbody><tr><td><code class="literal">string</code>, <code class="literal">varchar</code>, <code class="literal">varchar2</code> or <code class="literal">java.lang.String</code></td><td>A string value</td></tr><tr><td><code class="literal">int</code>, <code class="literal">integer</code> or <code class="literal">java.lang.Integer</code></td><td>An integer value</td></tr><tr><td><code class="literal">long</code> or <code class="literal">java.lang.Long</code></td><td>A long value</td></tr><tr><td><code class="literal">bool</code>, <code class="literal">boolean</code> or <code class="literal">java.lang.Boolean</code></td><td>A boolean value</td></tr><tr><td><code class="literal">double</code> or <code class="literal">java.lang.Double</code></td><td>A double value</td></tr><tr><td><code class="literal">float</code> or <code class="literal">java.lang.Float</code></td><td>A float value</td></tr><tr><td><code class="literal">short</code> or <code class="literal">java.lang.Short</code></td><td>A short value</td></tr><tr><td><code class="literal">char</code>, <code class="literal">character</code> or <code class="literal">java.lang.Character</code></td><td>A character value</td></tr><tr><td><code class="literal">byte</code> or <code class="literal">java.lang.Byte</code></td><td>A byte value</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-runtime"/>15.6.Â Runtime Configuration</h2></div></div></div><a id="d0e43207" class="indexterm"/><p>
			Certain configuration changes are available to perform on an engine instance while in operation. Such configuration operations are available via the <code class="literal">getConfiguration</code> method on <code class="literal">EPAdministrator</code>,
			which returns an <code class="literal">ConfigurationOperations</code> object. Please consult the JavaDoc documentation for more detail.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-logging"/>15.7.Â Logging Configuration</h2></div></div></div><a id="d0e43226" class="indexterm"/><p>
			For NEsper .NET also see <a class="xref" href="#appendix_dotnet_configuration_logging" title="I.18.Â .NET Configurations - Logging Configuration">SectionÂ I.18, â.NET Configurations - Logging Configurationâ</a>.
		</p><p>
		   Esper logs all messages to SLF4J under an appropriate log level. To output log messages you can add Log4j and SLF4J-Log4j (1.2) to classpath and configure Log4j as below.
		</p><p>
			Esper's only direct dependency for logging is the SLF4J interfaces (<code class="literal">slf4j-api-x.y.z.jar</code>). Please see the SLF4J documentation on redirecting logs to other logging frameworks.
		</p><p>
			Statement-level processing information can be output, please see <a class="xref" href="#devlifecycle-debugging-audit" title="16.3.1.Â @Audit Annotation">SectionÂ 16.3.1, â@Audit Annotationâ</a>.
		</p><p>
		   For performance reasons, Esper does not log any debug-level or informational-level messages for event execution unless explicitly configured via <a class="xref" href="#config-engine-logging-execpath" title="15.4.16.1.Â Execution Path Debug Logging">SectionÂ 15.4.16.1, âExecution Path Debug Loggingâ</a>.
		</p><p>
			A callback API for receiving certain critical engine reports is available as described in <a class="xref" href="#api-exception" title="14.10.Â Exception Handling">SectionÂ 14.10, âException Handlingâ</a>.
		</p><p>
		  More information on configuring engine-level settings for logging are at <a class="xref" href="#config-engine-logging" title="15.4.16.Â Engine Settings Related to Logging">SectionÂ 15.4.16, âEngine Settings Related to Loggingâ</a>.
		</p><p>
		   The next table explains the log levels:
		</p><div class="table"><a id="d0e43260"/><p class="title"><b>TableÂ 15.7.Â Log Levels</b></p><div class="table-contents"><table summary="Log Levels" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Log Level</th><th>Use</th></tr></thead><tbody><tr><td>Debug</td><td>Displays detailed engine-internal information that may not be easy to understand for application developers but are useful for engine support.</td></tr><tr><td>Info</td><td>Used for a few critical engine-level log messages.</td></tr><tr><td>Warn</td><td>Certain important warning or informational messages are displayed under the warning level.</td></tr><tr><td>Error</td><td>Exceptions reported within the engine or by plug-in components are reported under the error level. When users enter invalid EPL statements such validation errors are not reported as error logs and are indicated via API exception instead.</td></tr></tbody></table></div></div><br class="table-break"/><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="configuration-logging-log4j"/>15.7.1.Â Log4j Logging Configuration</h3></div></div></div><p>
				Log4j is the default logging component. Please find additional information for Log4j configuration and extension in <a class="link" href="http://logging.apache.org/log4j" target="">http://logging.apache.org/log4j</a>.
			</p><p>
				The easiest way to configure Log4j is by providing a Log4J configuration file, similar to the <code class="literal">log4j.xml</code> file shipped in the <code class="literal">etc</code> folder of the distribution.
			</p><p>
				Add the <code class="literal">log4j.configuration</code> system property to the <code class="literal">java</code> command line and provide the file name of the Log4j configuration file, making sure your classpath also includes the directory of the file:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">java -Dlog4j.configuration=log4j.xml ...</pre></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="devlifecycle"/>ChapterÂ 16.Â Development Lifecycle</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#devlifecycle-authoring">16.1. Authoring</a></span></dt><dt><span class="sect1"><a href="#devlifecycle-testing">16.2. Testing</a></span></dt><dt><span class="sect1"><a href="#devlifecycle-debugging">16.3. Debugging</a></span></dt><dd><dl><dt><span class="sect2"><a href="#devlifecycle-debugging-audit">16.3.1. @Audit Annotation</a></span></dt></dl></dd><dt><span class="sect1"><a href="#devlifecycle-packagedeploy">16.4. Packaging and Deploying Overview</a></span></dt><dt><span class="sect1"><a href="#devlifecycle-eplmodule">16.5. EPL Modules</a></span></dt><dt><span class="sect1"><a href="#devlifecycle-admin">16.6. The Deployment Administrative Interface</a></span></dt><dd><dl><dt><span class="sect2"><a href="#devlifecycle-admin-readparse">16.6.1. Reading Module Content</a></span></dt><dt><span class="sect2"><a href="#devlifecycle-admin-order">16.6.2. Ordering Multiple Modules</a></span></dt><dt><span class="sect2"><a href="#devlifecycle-admin-devlifecycle-undeploy">16.6.3. Deploying and Un-Deploying</a></span></dt><dt><span class="sect2"><a href="#devlifecycle-admin-list">16.6.4. Listing Deployments</a></span></dt><dt><span class="sect2"><a href="#devlifecycle-admin-transition">16.6.5. State Transitioning a Module</a></span></dt><dt><span class="sect2"><a href="#devlifecycle-admin-bestpractices">16.6.6. Best Practices</a></span></dt></dl></dd><dt><span class="sect1"><a href="#devlifecycle-j2ee">16.7. J2EE Packaging and Deployment</a></span></dt><dd><dl><dt><span class="sect2"><a href="#devlifecycle-j2ee-considerations">16.7.1. J2EE Deployment Considerations</a></span></dt><dt><span class="sect2"><a href="#devlifecycle-j2ee-servletcontextlistener">16.7.2. Servlet Context Listener</a></span></dt></dl></dd><dt><span class="sect1"><a href="#devlifecycle-monitoring">16.8. Monitoring and JMX</a></span></dt></dl></div><p>
		This chapter presents information related to the development lifecycle for developing an event processing application with EPL. It includes information on authoring, testing, debugging, packaging and deploying.
    </p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="devlifecycle-authoring"/>16.1.Â Authoring</h2></div></div></div><p>
          Enterprise Edition includes authoring tools for EPL statements and modules by providing form-based dialogs, templates, an expression builder, simulation tool and other tools. Enterprise Edition also supports hot deployment and packaging options for EPL and related code.
        </p><p>
           EPL statements can be organized into modules as described below. Any text editor can edit EPL statement and module text. A text editor or IDE that highlights SQL syntax or keywords works.
        </p><p>
			For authoring configuration files please consult the XSD schema files as provided with the distribution.
        </p><p>
            For information on authoring event classes or event definitions in general please see <a class="xref" href="#event_representation" title="ChapterÂ 3.Â Event Representations">ChapterÂ 3, <i>Event Representations</i></a> or <a class="xref" href="#epl_createschema" title="5.15.Â Declaring an Event Type: Create Schema">SectionÂ 5.15, âDeclaring an Event Type: Create Schemaâ</a>.
        </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="devlifecycle-testing"/>16.2.Â Testing</h2></div></div></div><p>
			We recommend testing EPL statements using a test framework such as JUnit or TestNG. Please consult the Esper test suite for extensive examples, which can be downloaded from the distribution site.
        </p><p>
           Esper's API provides test framework classes to simplify automated testing of EPL statements. Please see <a class="xref" href="#api-testing" title="14.20.Â Test and Assertion Support">SectionÂ 14.20, âTest and Assertion Supportâ</a> for more information.
        </p><p>
			We recommend performing latency and throughput tests early in the development lifecycle. Please consider the performance tips in <a class="xref" href="#performance" title="ChapterÂ 23.Â Performance">ChapterÂ 23, <i>Performance</i></a> for optimal performance.
        </p><p>
			Consider engine and statement metrics reporting for identifying slow-performing statements, for example. See <a class="xref" href="#api-instrumentation" title="14.14.Â Engine and Statement Metrics Reporting">SectionÂ 14.14, âEngine and Statement Metrics Reportingâ</a>.
        </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="devlifecycle-debugging"/>16.3.Â Debugging</h2></div></div></div><p>
          Enterprise Edition includes a debugger for EPL statement execution.
        </p><p>
            One important tool for debugging without Enterprise Edition is the parameterized <code class="literal">@Audit </code> annotation. This annotation allows to output, on statement-level, detailed information about many aspects of statement processing.
        </p><p>
			Another tool for logging engine-level detail is <a class="xref" href="#config-engine-logging-execpath" title="15.4.16.1.Â Execution Path Debug Logging">SectionÂ 15.4.16.1, âExecution Path Debug Loggingâ</a>.
        </p><p>
			Please see <a class="xref" href="#configuration-logging" title="15.7.Â Logging Configuration">SectionÂ 15.7, âLogging Configurationâ</a> for information on configuring logging in general.
        </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="devlifecycle-debugging-audit"/>16.3.1.Â @Audit Annotation</h3></div></div></div><p>
				Use the <code class="literal">@Audit</code> annotation to have the engine output detailed information about statement processing. The engine reports, at INFO level, the information under log name <code class="literal">com.espertech.esper.audit</code>. You may define an output format for audit information via configuration.
			</p><p>
				You may provide a comma-separated list of category names to <code class="literal">@Audit</code> to output information related to specific categories only. The table below lists all available categories. If no parameter is provided, the engine outputs information for all categories. Category names are not case-sensitive.
			</p><p>
				For the next statement  the engine produces detailed processing information (all categories) for the statement: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Name('All Order Events') @Audit select * from OrderEvent</pre><p>
				For the next statement the engine provides information about new events and also about event property values (2 categories are listed):
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Name('All Order Events') @Audit('stream,property') select price from OrderEvent</pre><p>
				Here is a more complete example that uses the API to create the schema, create above statement and send an event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epService.getEPAdministrator().createEPL("create schema OrderEvent(price double)");
String epl = "@Name('All-Order-Events') @Audit('stream,property') select price from OrderEvent";
epService.getEPAdministrator().createEPL(epl).addListener(listener);
epService.getEPRuntime().sendEvent(Collections.singletonMap("price", 100d), "OrderEvent");</pre><p>
				The output is similar to the following:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">INFO  [audit] Statement All-Order-Events stream OrderEvent inserted {price=100.0}
INFO  [audit] Statement All-Order-Events property price value 100.0</pre><div class="table"><a id="d0e43406"/><p class="title"><b>TableÂ 16.1.Â @Audit Categories</b></p><div class="table-contents"><table summary="@Audit Categories" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Category</th><th>Description</th></tr></thead><tbody><tr><td>ContextPartition</td><td>Each context partition allocation and de-allocation (only for statements that declare a context).</td></tr><tr><td>Dataflow-Source</td><td>Each data flow source operator providing an event.</td></tr><tr><td>Dataflow-Op</td><td>Each data flow operator processing an event.</td></tr><tr><td>Dataflow-Transition</td><td>Each data flow instance state transition.</td></tr><tr><td>Exprdef</td><td>Each expression declaration name and return value.</td></tr><tr><td>Expression</td><td>Each top-level expression and its return value.</td></tr><tr><td>Expression-nested</td><td>Each expression including child or nested expressions and their return value.</td></tr><tr><td>Insert</td><td>Each event inserted via insert-into.</td></tr><tr><td>Pattern</td><td>Each pattern sub-expression and its change in truth-value.</td></tr><tr><td>Pattern-instances</td><td>Each pattern sub-expression and its count of active instances.</td></tr><tr><td>Property</td><td>Each property name and the event's property value.</td></tr><tr><td>Schedule</td><td>Each schedule modification and trigger received by a statement.</td></tr><tr><td>Stream</td><td>Each new event received by a statement.</td></tr><tr><td>View</td><td>Each data window name and its insert and remove stream.</td></tr></tbody></table></div></div><br class="table-break"/><p>
				Note that the engine only evaluates select-clause expressions if either a listener or subscriber is attached to the statement or if used with insert-into.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="devlifecycle-packagedeploy"/>16.4.Â Packaging and Deploying Overview</h2></div></div></div><p>
			Please consider Esper Enterprise Edition as a target deployment platform. Esper alone does not ship with a server as it is designed as a core CEP engine.
		</p><p>
			 For un-deploying, deploying or re-deploying single or multiple statements or modules as an atomic management unit please see <a class="xref" href="#api-admin-atomic" title="14.3.7.Â Atomic Statement Management">SectionÂ 14.3.7, âAtomic Statement Managementâ</a>.
		</p><p>
			To support packaging and deploying event-driven applications, Esper offers infrastructure as outlined herein:
        </p><div class="itemizedlist"><ul><li><p>
                    EPL modules to build a cohesive, easily-externalizable deployment unit out of related statements as described in <a class="xref" href="#devlifecycle-eplmodule" title="16.5.Â EPL Modules">SectionÂ 16.5, âEPL Modulesâ</a>.
                </p></li><li><p>
                    The deployment administrative interface is described in <a class="xref" href="#devlifecycle-admin" title="16.6.Â The Deployment Administrative Interface">SectionÂ 16.6, âThe Deployment Administrative Interfaceâ</a>.
                </p></li><li><p>
			        Instructions and code for use when the deployment target is a J2EE web application server or servlet runtime, please see <a class="xref" href="#devlifecycle-j2ee" title="16.7.Â J2EE Packaging and Deployment">SectionÂ 16.7, âJ2EE Packaging and Deploymentâ</a>.
                </p></li></ul></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="devlifecycle-eplmodule"/>16.5.Â EPL Modules</h2></div></div></div><a id="d0e43521" class="indexterm"/><a id="d0e43526" class="indexterm"/><p>
			An EPL module file is a plain text file in which EPL statements appear separated by the semicolon (;) character. It bundles EPL statements with optional deployment instructions. A service provider instance keeps track of the known and/or deployed EPL modules and makes it easy to add, remove, deploy and un-deploy EPL modules.
		</p><p>
			The synopsis of an EPL module file is:
		</p><pre class="synopsis">[module <span class="emphasis"><em>module_name</em></span>;]
[uses <span class="emphasis"><em>module_name</em></span>; | import <span class="emphasis"><em>import_name</em></span>;] [uses <span class="emphasis"><em>module_name</em></span>; | import <span class="emphasis"><em>import_name</em></span>;] [...]
[<span class="emphasis"><em>epl_statement</em></span>;] [<span class="emphasis"><em>epl_statement</em></span>;] [...]</pre><p>
			Use the <code class="literal">module</code> keyword followed a <span class="emphasis"><em>module_name</em></span> identifier or a package (identifiers separated by dots) to declare the name of the module. The module name declaration must be at the beginning of the file, comments and whitespace excluded. The module name 
			serves to check uses-dependences of other modules.  
		 </p><p>
			If a module file requires certain constructs that may be shared by other module files, such as named windows, tables, variables, event types, variant streams or inserted-into streams required by statements,
			a module file may specify zero to many dependent modules with the <code class="literal">uses</code> keyword. At deployment time the engine checks the uses-dependencies
			and ensures that a module of that name is already deployed or will be deployed as part of the deployments. The deployment API supports ordering modules according to their uses-relationship.
		 </p><p>
			 If the EPL statements in the module require Java classes such as for underlying events or user-defined functions, use the <code class="literal">import</code> keyword followed by the fully-qualified class name or package name in the format <code class="literal">package.*</code>.
			 The <code class="literal">uses</code> and <code class="literal">import</code> keywords are optional and must occur after the <code class="literal">module</code> declaration.
		 </p><p>
			 Following the optional deployment instructions are any number of <span class="emphasis"><em>epl_statement</em></span> EPL statements that are separated by semicolon (<code class="literal">;</code>).
		 </p><p>
			 The following is a sample EPL module file explained in detail thereafter:
		 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Declare the name for the module
module org.myorganization.switchmonitor;

// Declare other module(s) that this module depends on
uses org.myorganization.common;

// Import any Java/.NET classes in an application package 
import org.myorganization.events.*;

// Declare an event type based on a Java class in the package that was imported as above
create schema MySwitchEvent as MySwitchEventPOJO;

// Sample statement
@Name('Off-On-Detector')
insert into MyOffOnStream
select * from pattern[every-distinct(id) a=MySwitchEvent(status='off') 
  -&gt; b=MySwitchEvent(id=a.id, status='on')];

// Sample statement
@Name('Count-Switched-On')
@Description('Count per switch id of the number of Off-to-On switches in the last 1 hour')
select id, count(*) from MyOffOnStream#time(1 hour) group by id;</pre><p>
			The example above declares a module name of <code class="literal">org.myorganization.switchmonitor</code>. As defined by the <code class="literal">uses</code> keyword, it ensures that the <code class="literal">org.myorganization.common</code> module is already deployed.
			The example demonstrates the <code class="literal">import</code> keyword to make a package name known to the engine for resolving POJO class names, as the example assumes that <code class="literal">MySwitchEventPOJO</code> is a POJO event class.
			In addition the example module contains two statements separated by semicolon characters.
        </p><p>
			Your application code may, after deployment, look up a statement and attach listeners as shown here:
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epService.getEPAdministrator().getStatement("Count-Switched-On").addListener(...);</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="devlifecycle-admin"/>16.6.Â The Deployment Administrative Interface</h2></div></div></div><a id="d0e43624" class="indexterm"/><a id="d0e43629" class="indexterm"/><p>
			The <code class="literal">com.espertech.esper.client.deploy.EPDeploymentAdmin</code> service available from the <code class="literal">EPAdministrator</code> interface by method <code class="literal">getDeploymentAdmin</code> provides the functionality available to manage packaging and deployment.
			Please consult the JavaDoc documentation for more information.
		</p><p>
		  The deployment API allows to read resources and parse text strings to obtain an object representation of the EPL module, the <code class="literal">Module</code>. A <code class="literal">Module</code> object can also be simply constructed.
		</p><p>
		  After your application obtains a <code class="literal">Module</code> instance it may either use <code class="literal">deploy</code> to deploy the module directly, starting all statements of the module. Alternatively your application
		  may add a module, making it known without starting statements for later deployment. In each case the module is assigned a deployment id, which acts as a unique primary key for all known modules. Your application may assign its own deployment id
		  or may have the engine generate a deployment id (two footprints for <code class="literal">add</code> and <code class="literal">deploy</code> methods).
		</p><p>
		  A module may be in two states: un-deployed or deployed. When calling <code class="literal">add</code> to add a module, it starts life in the un-deployed state. When calling <code class="literal">deploy</code> to deploy a module, it starts life in the deployed state. 
		  A module may be transitioned by providing the deployment id and by calling the <code class="literal">deploy</code> or <code class="literal">undeploy</code> methods.
		</p><p>
		  Your code can remove a module in un-deployed state using the <code class="literal">remove</code> method or the <code class="literal">undeployRemove</code> method. If the module is in deployed state, use <code class="literal">undeployRemove</code> to un-deploy and remove the module.
		</p><p>
		  The <code class="literal">DeploymentOptions</code> instance that can be passed to the <code class="literal">deploy</code> method when validating or deploying modules controls validation, fail-fast, rollback and the isolated service provider, if any, for the deployment.
		  Also use <code class="literal">DeploymentOptions</code> to set a user object per statement and to set a statement name per statement.
		</p><p>
			Deployment and un-deployment operations are, by default, atomic operations: Events that come in during deployment or un-deployment are processed after deployment or un-deployment completed.
			Using <code class="literal">DeploymentOptions</code> you may provide a strategy for obtaining and releasing the engine-wide lock. 
			Please also see <a class="xref" href="#api-admin-atomic" title="14.3.7.Â Atomic Statement Management">SectionÂ 14.3.7, âAtomic Statement Managementâ</a> for more information.
		</p><p>
		  We provide additional sample code to read and deploy modules as part of the J2EE considerations below.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="devlifecycle-admin-readparse"/>16.6.1.Â Reading Module Content</h3></div></div></div><p>
				Read and parse module files via the <code class="literal">EPDeploymentAdmin</code> interface <code class="literal">read</code> and <code class="literal">parse</code> methods, which returns a <code class="literal">Module</code> instance to represent the module information. 
			</p><p>
				This code snippet demonstrates reading and parsing a module given a file name:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPServiceProvider epService = EPServiceProviderManager.getDefaultProvider();
EPDeploymentAdmin deployAdmin = epService.getEPAdministrator().getDeploymentAdmin();
Module module = deployAdmin.read(new File("switchmonitor.epl"));</pre><p>
				The service provides additional read and parse methods to read from a URL, classpath, input stream or string.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="devlifecycle-admin-order"/>16.6.2.Â Ordering Multiple Modules</h3></div></div></div><p>
				Since modules may have inter-dependencies as discussed under the <code class="literal">uses</code> declaration,  the deployment interface provides the <code class="literal">getDeploymentOrder</code> method to order a collection of modules before deployment.
			</p><p>
				Assuming your application reads multiple modules into a <code class="literal">mymodules</code> module list, this code snippet orders the modules for deployment and validates dependency declarations for each module:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">List&lt;Module&gt; mymodules =  ... read modules...;  
DeploymentOrder order = deployAdmin.getDeploymentOrder(mymodules, new DeploymentOrderOptions());</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="devlifecycle-admin-devlifecycle-undeploy"/>16.6.3.Â Deploying and Un-Deploying</h3></div></div></div><p>
				The deployment interface returns a deployment id for each module made known by adding a module or by deploying a module. To un-deploy the module your application must provide the deployment id. Your application can assign its own deployment id or obtain the module name
				from the <code class="literal">Module</code> and use that as the deployment id.
			</p><p>
				The <code class="literal">undeploy</code> operation removes all named windows, tables, variables, event types or any other information associated to the statements within the module to be un-deployed.
			</p><p>
				The next code snippet deploys modules, starting each modulle's EPL statements:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">for (Module mymodule : order.getOrdered()) {
  DeploymentResult deployResult = deployAdmin.deploy(mymodule, new DeploymentOptions());
}</pre><p>
				Un-deploying a module destroys all started statements associated to the module.
			</p><p>
				To un-deploy and at the same time remove the module from the list of known modules use the <code class="literal">undeployRemove</code> method and pass the deployment id:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">deployAdmin.undeployRemove(deployResult.getDeploymentId());</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="devlifecycle-admin-list"/>16.6.4.Â Listing Deployments</h3></div></div></div><p>
				The deployment interface returns all module information that allows your application to determine which modules are known and their current state. 
			</p><p>
				To obtain a list of all known modules or information for a specific module, the calls are:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">DeploymentInformation[] info = deployAdmin.getDeploymentInformation();
			
// Given a deployment id, return the deployment information
DeploymentInformation infoModule = deployAdmin.getDeploymen(deploymentId);</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="devlifecycle-admin-transition"/>16.6.5.Â State Transitioning a Module</h3></div></div></div><p>
				The following sample code adds a module, transitions the module to deployed, then un-deploys and removes the module entirely;
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// This sample uses the parse method to obtain a module
Module module = deployAdmin.parse("create schema MySchema (col1 int)";

// Make the module know; It now shows up in un-deployed state
String moduleDeploymentId = deployAdmin.add(module);

// Start all statements, passing a null options object for default options
deployAdmin.deploy(moduleDeploymentId, null);

// Un-deploy module, destroying all statements
deployAdmin.undeploy(moduleDeploymentId);

// Remove module; It will no longer be known
deployAdmin.remove(moduleDeploymentId);</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="devlifecycle-admin-bestpractices"/>16.6.6.Â Best Practices</h3></div></div></div><p>
				Use the <code class="literal">@Name</code> annotation to assign a name to each statement that your application would like to attach a listener or subscriber, or look up the statement for iteration or management by the administrative API.
			</p><p>
				Use the <code class="literal">create schema</code> syntax and the <code class="literal">import</code> keyword to define event types. When sharing event types, named windows or variables between modules use the <code class="literal">uses</code> keyword to 
				declare a separate module that holds the shared definitions.
			</p><p>
				To validate whether a set of statements is complete and can start without issues, set the following flags on a <code class="literal">DeploymentOptions</code> instance passed to the <code class="literal">deploy</code> method as the code snippet below shows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">DeploymentOptions options = new DeploymentOptions();
options.setIsolatedServiceProvider("validation");	// isolate any statements 
options.setValidateOnly(true);	// validate leaving no started statements
options.setFailFast(false); // do not fail on first error
epService.getEPAdministrator().getDeploymentAdmin()
  .deploy(module, options);</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="devlifecycle-j2ee"/>16.7.Â J2EE Packaging and Deployment</h2></div></div></div><a id="d0e43827" class="indexterm"/><a id="d0e43832" class="indexterm"/><p>
			Esper can well be deployed as part of a J2EE web or enterprise application archive to a web application server. 
			When designing for deployment into a J2EE web application server, please consider the items discussed here.
		</p><p>
			We provide a sample servlet context listener in this section that uses the deployment API to deploy and un-deploy modules as part of the servlet lifecycle. 
		</p><p>
			The distribution provides a message-driven bean (MDB) example that you may find useful.
		</p><p>
			Esper does not have a dependency on any J2EE or Servlet APIs to allow the engine to run in any environment or container.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="devlifecycle-j2ee-considerations"/>16.7.1.Â J2EE Deployment Considerations</h3></div></div></div><p>
			  As multiple web applications deployed to a J2EE web application server typically have a separate classloader per application, you should consider whether engine instances need to be shared between applications or can remain separate engine instances. Consider the <code class="literal">EPServiceProviderManager</code> a Singleton. 
			  When deploying multiple web applications, your J2EE container classloader may provide a separate instance of the Singleton <code class="literal">EPServiceProviderManager</code> to each web application resulting in multiple independent engine instances.
			</p><p>
			  To share <code class="literal">EPServiceProvider</code> instances between web applications, one approach is to add the Esper jar files to the system classpath. A second approach can be to have multiple web applications share the same servet context and have your application place the <code class="literal">EPServiceProvider</code> instance into a servlet context attribute for sharing. Architecturally you may also consider a single archived application (such as an message-driven bean) that all your web applications communicate to via the JMS broker provided by your application server or an external JMS broker. 
			</p><p> 
			  As per J2EE standards there are restrictions in regards to starting new threads in J2EE application code. Esper adheres to these restrictions: It allows to be driven entirely by external events. To remove all Esper threads, set the internal timer off and leave the advanced threading options turned off.
			  To provide timer events when the internal timer is turned off, you should check with your J2EE application container for support of the Java system timer or for support of batch or work loading to send timer events to an engine instance.
			</p><p> 
			  As per J2EE standards there are restrictions in regards to input and output by J2EE application code. Esper adheres to these restrictions: By itself it does not start socket listeners or performs any file IO.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="devlifecycle-j2ee-servletcontextlistener"/>16.7.2.Â Servlet Context Listener</h3></div></div></div><p>
				When deploying a J2EE archive that contains EPL modules files below is sample code to read and deploy EPL modules files packaged with the enterprise or web application archive when the servlet initializes. The sample un-deploys EPL modules when the servlet context gets destroyed.
			</p><p>
				A sample <code class="literal">web.xml</code> configuration extract is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app&gt;
  &lt;listener&gt;
    &lt;listener-class&gt;SampleServletListener&lt;/listener-class&gt;
  &lt;/listener&gt;
  &lt;context-param&gt;
    &lt;param-name&gt;eplmodules&lt;/param-name&gt;
    &lt;param-value&gt;switchmonitor.epl&lt;/param-value&gt;
&lt;/context-param&gt;
&lt;/web-app&gt;</pre><p>
				A servet listener that deploys EPL module files packaged into the archive on context initialization and that un-deploys when the application server destroys the context is shown here:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class SampleServletListener implements ServletContextListener {

  private List&lt;String&gt; deploymentIds = new ArrayList&lt;String&gt;();
  
  public void contextInitialized(ServletContextEvent servletContextEvent) {
    try {
      EPServiceProvider epServiceProvider = EPServiceProviderManager.getDefaultProvider();
      String modulesList = servletContextEvent.getServletContext().getInitParameter("eplmodules");
      List&lt;Module&gt; modules = new ArrayList&lt;Module&gt;();
      if (modulesList != null) {
        String[] split = modulesList.split(",");
        for (int i = 0; i &lt; split.length; i++) {
          String resourceName = split[i].trim();
          if (resourceName.length() == 0) {
            continue;
          }
          String realPath = servletContextEvent.getServletContext().getRealPath(resourceName);
  		Module module = epServiceProvider.getEPAdministrator()
  		        .getDeploymentAdmin().read(new File(realPath));
          modules.add(module);
        }
      }
    
      // Determine deployment order
      DeploymentOrder order = epServiceProvider.getEPAdministrator()
                  .getDeploymentAdmin().getDeploymentOrder(modules, null);
  
      // Deploy
      for (Module module : order.getOrdered()) {
        DeploymentResult result = epServiceProvider.getEPAdministrator()
                  .getDeploymentAdmin().deploy(module, new DeploymentOptions());
        deploymentIds.add(result.getDeploymentId());
      }
    }
    catch (Exception ex) {
      ex.printStackTrace();
    }
  }
  
  public void contextDestroyed(ServletContextEvent servletContextEvent) {
    EPServiceProvider epServiceProvider = EPServiceProviderManager.getDefaultProvider();
    for (String deploymentId : deploymentIds) {
       epServiceProvider.getEPAdministrator().getDeploymentAdmin().undeployRemove(deploymentId);
    }
  }
}</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="devlifecycle-monitoring"/>16.8.Â Monitoring and JMX</h2></div></div></div><p>
			The engine can report key processing metrics through the JMX platform mbean server by setting a single configuration flag described in <a class="xref" href="#config-engine-jmxmetrics" title="15.4.23.Â Engine Settings Related to JMX Metrics">SectionÂ 15.4.23, âEngine Settings Related to JMX Metricsâ</a>.
        </p><p>
			Engine and statement-level metrics reporting is described in <a class="xref" href="#api-instrumentation" title="14.14.Â Engine and Statement Metrics Reporting">SectionÂ 14.14, âEngine and Statement Metrics Reportingâ</a>.			
        </p><p>
			The easiest way to see thread contentions is by using VisualVM when Esper is under load and looking at the Threads tab. 
			In the worst case you will see a lot of red color in VisualVM.
			The red line in VisualVM shows the threads that are either in a monitor region or waiting in an entry set for the monitor. 
			The monitor is the mechanism that Java uses to support synchronization.
			When an EPL statement is stateful, Esper manages the state using a monitor (lock) per context partition.
		</p><p>
			A JVM profiler can be handy to see how much CPU is spent in Esper by the <code class="literal">sendEvent</code> method.
		</p><p>
				The <code class="literal">jconsole</code> can provide information on the JVM heap. If memory gets tights the performance can drop significantly.
		</p><p>
				Enterprise Edition has a library for measuring and reporting memory use for Esper.
		</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="extension"/>ChapterÂ 17.Â Integration and Extension</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#extension-overview">17.1. Overview</a></span></dt><dt><span class="sect1"><a href="#extension-virtualdw">17.2. Virtual Data Window</a></span></dt><dd><dl><dt><span class="sect2"><a href="#extension-virtualdw-howto">17.2.1. How to Use</a></span></dt><dt><span class="sect2"><a href="#extension-virtualdw-vdwfactory">17.2.2. Implementing the Factory</a></span></dt><dt><span class="sect2"><a href="#extension-virtualdw-vdw">17.2.3. Implementing the Virtual Data Window</a></span></dt><dt><span class="sect2"><a href="#extension-virtualdw-lookup">17.2.4. Implementing the Lookup</a></span></dt></dl></dd><dt><span class="sect1"><a href="#custom-singlerow-function">17.3. Single-Row Function</a></span></dt><dd><dl><dt><span class="sect2"><a href="#custom-singlerow-implementing">17.3.1. Implementing a Single-Row Function</a></span></dt><dt><span class="sect2"><a href="#custom-single-row-config">17.3.2. Configuring the Single-Row Function Name</a></span></dt><dt><span class="sect2"><a href="#custom-single-row-cache">17.3.3. Value Cache</a></span></dt><dt><span class="sect2"><a href="#custom-single-filter-optimizable">17.3.4. Single-Row Functions in Filter Predicate Expressions</a></span></dt><dt><span class="sect2"><a href="#custom-single-eventsparam">17.3.5. Single-Row Functions Taking Events as Parameters</a></span></dt><dt><span class="sect2"><a href="#custom-single-returningevents">17.3.6. Single-Row Functions Returning Events</a></span></dt><dt><span class="sect2"><a href="#custom-single-receivectx">17.3.7. Receiving a Context Object</a></span></dt><dt><span class="sect2"><a href="#custom-single-rethrowex">17.3.8. Exception Handling</a></span></dt></dl></dd><dt><span class="sect1"><a href="#custom-views">17.4. Derived-Value and Data Window View</a></span></dt><dd><dl><dt><span class="sect2"><a href="#custom-views-viewfactory">17.4.1. Implementing a View Factory</a></span></dt><dt><span class="sect2"><a href="#custom-views-view">17.4.2. Implementing a View</a></span></dt><dt><span class="sect2"><a href="#custom-views-contract">17.4.3. View Contract</a></span></dt><dt><span class="sect2"><a href="#custom-views-config">17.4.4. Configuring View Namespace and Name</a></span></dt><dt><span class="sect2"><a href="#custom-views-datawin">17.4.5. Requirement for Data Window Views</a></span></dt><dt><span class="sect2"><a href="#custom-views-derivedvalue">17.4.6. Requirement for Derived-Value Views</a></span></dt><dt><span class="sect2"><a href="#custom-views-grouped">17.4.7. Requirement for Grouped Views</a></span></dt></dl></dd><dt><span class="sect1"><a href="#custom-aggregation-function">17.5. Aggregation Function</a></span></dt><dd><dl><dt><span class="sect2"><a href="#custom-aggregation-single">17.5.1. Aggregation Single-Function Development</a></span></dt><dt><span class="sect2"><a href="#custom-aggregation-multi">17.5.2. Aggregation Multi-Function Development</a></span></dt></dl></dd><dt><span class="sect1"><a href="#custom-pattern-guard">17.6. Pattern Guard</a></span></dt><dd><dl><dt><span class="sect2"><a href="#custom-pattern-guard-factory-implementing">17.6.1. Implementing a Guard Factory</a></span></dt><dt><span class="sect2"><a href="#custom-pattern-guard-implementing">17.6.2. Implementing a Guard Class</a></span></dt><dt><span class="sect2"><a href="#custom-pattern-guard-config">17.6.3. Configuring Guard Namespace and Name</a></span></dt></dl></dd><dt><span class="sect1"><a href="#custom-pattern-observer">17.7. Pattern Observer</a></span></dt><dd><dl><dt><span class="sect2"><a href="#custom-pattern-observer-factory-implementing">17.7.1. Implementing an Observer Factory</a></span></dt><dt><span class="sect2"><a href="#custom-pattern-observer-implementing">17.7.2. Implementing an Observer Class</a></span></dt><dt><span class="sect2"><a href="#custom-pattern-observer-config">17.7.3. Configuring Observer Namespace and Name</a></span></dt></dl></dd><dt><span class="sect1"><a href="#custom-event-representation">17.8. Event Type and Event Object</a></span></dt><dd><dl><dt><span class="sect2"><a href="#custom-eventrep-overview">17.8.1. How It Works</a></span></dt><dt><span class="sect2"><a href="#custom-eventrep-steps">17.8.2. Steps</a></span></dt><dt><span class="sect2"><a href="#custom-eventrep-uriresolution">17.8.3. URI-Based Resolution</a></span></dt><dt><span class="sect2"><a href="#custom-eventrep-example">17.8.4. Example</a></span></dt></dl></dd></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="extension-overview"/>17.1.Â Overview</h2></div></div></div><p>
		  This chapter summarizes integration and describes in detail each of the extension APIs that allow integrating external data and/or extend engine functionality. 
		</p><p>
		  For information on calling external services via instance method invocation, for instance to integrate with dependency injection frameworks such as Spring or Guice,
		  please see <a class="xref" href="#variable_eventtype" title="5.17.5.Â Class and Event-Type Variables">SectionÂ 5.17.5, âClass and Event-Type Variablesâ</a>.
		</p><p>
		  For information on input and output adapters that connect to an event transport and perform event transformation for incoming and outgoing on-the-wire event data, for use with streaming data, please see the EsperIO reference documentation. The data flow instances as described in <a class="xref" href="#dataflow" title="ChapterÂ 20.Â EPL Reference: Data Flow">ChapterÂ 20, <i>EPL Reference: Data Flow</i></a> are an easy way to plug in operators that perform input and output. 
		  Data flows allow providing parameters and managing individual flows independent of engine lifecycle.
		  Also consider using the Plug-in Loader API for creating a new adapter that starts or stops as part of the CEP engine initialization and destroy lifecycle, see <a class="xref" href="#api-plugin" title="14.16.Â Plug-In Loader">SectionÂ 14.16, âPlug-In Loaderâ</a>.
		</p><p>
		  To join data that resides in a relational database and that is accessible via JDBC driver and SQL statement the engine offers a syntax for using SQL within EPL, see <a class="xref" href="#histdata_overview" title="5.13.Â Accessing Relational Data via SQL">SectionÂ 5.13, âAccessing Relational Data via SQLâ</a>. A relational database input and output adapter for streaming input from and output to a relational database also exists (EsperIO).
		</p><p>
		  To join data that resides in a non-relational store the engine offers a two means: First, the virtual data window, as described below, for transparently integrating the external store as a named window. The second mechanism is a special join syntax based on static method invocation, see <a class="xref" href="#joining_method" title="5.14.Â Accessing Non-Relational Data via Method, Script or UDF Invocation">SectionÂ 5.14, âAccessing Non-Relational Data via Method, Script or UDF Invocationâ</a>.
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>
		  The best way to test that your extension code works correctly is to write unit tests against an EPL statement that utilizes the extension code. Samples can be obtained from Esper regression test code base.
		  </p></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
			  For all extension code and similar to listeners and subscribers, to send events into the engine from extension code the <code class="literal">route</code> method should be used (and not <code class="literal">sendEvent</code>) to avoid the possibility of stack overflow due to event-callback looping and ensure correct processing of the current and routed event.
			  Note that if outbound-threading is enabled, listeners and subscribers should use <code class="literal">sendEvent</code> and not <code class="literal">route</code>.
			</p></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
			  For all extension code it is not safe to administrate the engine within the extension code. For example, it is not safe to implement a data window that creates a new statement or destroys an existing statement.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="extension-virtualdw"/>17.2.Â Virtual Data Window</h2></div></div></div><p>
			Use a virtual data window if you have a (large) external data store that you want to access as a named window. The access is transparent: There is no need to use special syntax or join syntax. All regular queries including subqueries, joins, on-merge, on-select, on-insert, on-delete, on-update and fire-and-forget are supported with virtual data windows.
        </p><p>
           There is no need to keep any data or events in memory with virtual data windows. The only requirement for virtual data windows is that all data rows returned are <code class="literal">EventBean</code> instances.
        </p><p>
			When implementing a virtual data window it is not necessary to send any events into the engine or to use insert-into. The event content is simply assumed to exist and accessible to the engine via the API implementation you provide. 
        </p><p>
          The distribution ships with a sample virtual data window in the examples folder under the name <code class="literal">virtualdw</code>. The code snippets below are extracts from the example.
        </p><p>
			We use the term <span class="emphasis"><em>store</em></span> here to mean a source set of data that is managed by the virtual data window. We use the term <span class="emphasis"><em>store row</em></span> or just <span class="emphasis"><em>row</em></span> to mean a single data item provided by the store. We use the term <span class="emphasis"><em>lookup</em></span>
			to mean a read operation against the store returning zero, one or many rows.
        </p><p>
           Virtual data windows allow high-performance low-latency lookup by exposing all relevant EPL query access path information. This makes it possible for the virtual data window to choose the desired access method into its store.
        </p><p>
			The following steps are required to develop and use a virtual data window: 
        </p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					Implement the interface <code class="literal">com.espertech.esper.client.hook.VirtualDataWindowFactory</code>.
				</p></li><li><p>
					Implement the interface <code class="literal">com.espertech.esper.client.hook.VirtualDataWindow</code>.
				</p></li><li><p>
					Implement the interface <code class="literal">com.espertech.esper.client.hook.VirtualDataWindowLookup</code>.
				</p></li><li><p>
					Register the factory class in the engine configuration.
				</p></li></ol></div><p> 
			Once you have completed above steps, the virtual data window is ready to use in EPL statements.
		</p><p>
		  From a threading perspective, virtual data window implementation classes must be thread-safe if objects are shared between multiple named windows. If no objects are shared between multiple different named windows, thereby each object is only used for the same named window and other named windows receive a separate instance, it is no necessary that the implementation classes are thread-safe.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="extension-virtualdw-howto"/>17.2.1.Â How to Use</h3></div></div></div><p>
				Your application must first register the virtual data window factory as part of engine configuration:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.addPlugInVirtualDataWindow("sample", "samplevdw", 
    SampleVirtualDataWindowFactory.class.getName());</pre><p>
				Your application may then create a named window backed by a virtual data window.
			</p><p>
				For example, assume that the <code class="literal">SampleEvent</code> event type is declared as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema SampleEvent as (key1 string, key2 string, value1 int, value2 double)</pre><p>
				The next EPL statement creates a named window <code class="literal">MySampleWindow</code> that provides <code class="literal">SampleEvent</code> events and is backed by a virtual data window provided by <code class="literal">SampleVirtualDataWindowFactory</code> as configured above:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window MySampleWindow.sample:samplevdw() as SampleEvent</pre><p>
			    You may then access the named window, same as any other named window, for example by subquery, join, on-action, fire-and-forget query or by consuming its insert and remove stream. While this example uses Map-type events, the example code is the same for POJO or other events.
			</p><p>
				Your application may obtain a reference to the virtual data window from the engine context.
			</p><p>
			  This code snippet looks up the virtual data window by the named window name:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">try {
  return (VirtualDataWindow) epService.getContext().lookup("/virtualdw/MySampleWindow");
}
catch (NamingException e) {
  throw new RuntimeException("Failed to look up virtual data window, is it created yet?");
}</pre><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="extension-virtualdw-howto-access"/>17.2.1.1.Â Query Access Path</h4></div></div></div><p>
					When you application registers a subquery, join or on-action query or executes a fire-and-forget query against a virtual data window the engine interacts with the virtual data window. The interaction is a two-step process. 
				</p><p>
					At time of EPL statement creation (once), the engine analyzes the EPL where-clause, if present. It then compiles a list of hash-index and binary tree (btree, i.e. sorted) index properties. It passes the property names that are queried as well as the operators (i.e. =, &gt;, range etc.) to the virtual data window. The virtual data window returns a lookup strategy object to the engine.
				</p><p>
					At time of EPL statement execution (repeatedly as triggered) , the engine uses that lookup strategy object to execute a lookup. It passes to the lookup all actual key values (hash, btree including ranges) to make fast and efficient lookup achievable.
				</p><p>
				    To explain in detail, assume that your application creates an EPL statement with a subquery as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select (select * from MySampleWindow where key1 = 'A1') from OtherEvent</pre><p>
				  At the time of creation of the EPL query above the engine analyzes the EPL query. It determines that the subquery queries a virtual data window.  It determines from the where-clause that the lookup uses property <code class="literal">key1</code> and hash-equals semantics. The engine then provides this information as part of <code class="literal">VirtualDataWindowLookupContext</code> passed to the <code class="literal">getLookup</code> method. Your application may inspect hash and btree properties and may determine the appropriate store access method to use.
				</p><p>
					The hash and btree property lookup information is for informational purposes, to enable fast and performant queries that returns the smallest number of rows possible. Your implementation classes may use some or none of the information provided and may also instead return some or perhaps even all rows, as is practical to your implementation. The <code class="literal">where</code>-clause still remains in effect and gets evaluated on all rows that are returned by the lookup strategy.
				</p><p>
				  Following the above example, the sub-query executes once when a <code class="literal">OtherEvent</code> event arrives. At time of execution the engine delivers the string value <code class="literal">A1</code> to the <code class="literal">VirtualDataWindowLookup</code> lookup implementation provided by your application. The lookup object queries the store and returns 
				  store rows as <code class="literal">EventBean</code> instances.
				</p><p>
				    As a second example, consider an EPL join statement as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MySampleWindow, MyTriggerEvent where key1 = trigger1 and key2 = trigger2</pre><p>
					The engine analyzes the query and passes to the virtual data window the information that the lookup occurs on properties <code class="literal">key1</code> and <code class="literal">key2</code> under hash-equals semantics. When a <code class="literal">MyTriggerEvent</code> arrives, 
					it passes the actual value of the <code class="literal">trigger1</code> and <code class="literal">trigger2</code> properties of the current MyTriggerEvent to the lookup.
				</p><p>
				    As a last example, consider an EPL fire-and-forget statement as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MySampleWindow key1 = 'A2' and value1 between 0 and 1000</pre><p>
					The engine analyzes the query and passes to the virtual data window the lookup information.  The lookup occurs on property <code class="literal">key1</code> under hash-equals semantics and on property <code class="literal">value1</code> under btree-open-range semantics. When you application 
					executes the fire-and-forget query the engine passes <code class="literal">A2</code> and the range endpoints <code class="literal">0</code> and <code class="literal">1000</code> to the lookup.
				</p><p>
					For more information, please consult the JavaDoc API documentation for class <code class="literal">com.espertech.esper.client.hook.VirtualDataWindow</code>, <code class="literal">VirtualDataWindowLookupContext</code> or <code class="literal">VirtualDataWindowLookupFieldDesc</code>.
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="extension-virtualdw-vdwfactory"/>17.2.2.Â Implementing the Factory</h3></div></div></div><p>
			  For each named window that refers to the virtual data window, the engine instantiates one instance of the factory.
			</p><p>
				A virtual data window factory class is responsible for the following functions:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						Implement the <code class="literal">initialize</code> method that accepts a virtual data window factory context object as a parameter.
					</p></li><li><p>
						Implement the <code class="literal">create</code> method that accepts a virtual data window context object as a parameter and returns a <code class="literal">VirtualDataWindow</code> implementation.
					</p></li><li><p>
						Implement the <code class="literal">destroyAllContextPartitions</code> method that gets called once when the named window is stopped or destroyed.
					</p></li></ul></div><p>
			  The engine instantiates a <code class="literal">VirtualDataWindowFactory</code> instance for each named window created via <code class="literal">create window</code>. The engine invokes the <code class="literal">initialize</code> method once in respect to the named window being created passing a <code class="literal">VirtualDataWindowFactoryContext</code> context object.
			</p><p>
			  If not using contexts, the engine calls the <code class="literal">create</code> method once after calling the <code class="literal">initialize</code> method. If using contexts, the engine calls the <code class="literal">create</code> method every time it allocates a context partition.
			  If using contexts and your virtual data window implementation operates thread-safe, you may return the same virtual data window implementation object for each context partition. If using contexts and your implementation object is not thread safe, return a separate thread-safe implementation object for each context partition.
			</p><p>
			  The engine invokes the <code class="literal">destroyAllContextPartitions</code> once when the named window is stopped or destroyed. If not using contexts, the engine calls the <code class="literal">destroy</code> method of the virtual data window implementation object before calling
			  the <code class="literal">destroyAllContextPartitions</code> method on the factory object. If using contexts, the engine calls the <code class="literal">destroy</code> method on each instance associates to a context partition at the time when the associated context partition terminates.
			</p><p>
				The sample code shown here can be found among the examples in the distribution under <code class="literal">virtualdw</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class SampleVirtualDataWindowFactory implements VirtualDataWindowFactory {

    public void initialize(VirtualDataWindowFactoryContext factoryContext) {
		// Can add initialization logic here.
    }

  public VirtualDataWindow create(VirtualDataWindowContext context) {
    // This example allocates a new virtual data window (one per context partitions if using contexts).
    // For sharing the virtual data window instance between context partitions, return the same reference.
    return new SampleVirtualDataWindow(context);
  }
  
  public void destroyAllContextPartitions() {
    // Release shared resources here
  }
}</pre><p>
				Your factory class must implement the <code class="literal">create</code> method which receives a <code class="literal">VirtualDataWindowContext</code> object. This method is called once for each EPL that creates a virtual data window (see example <code class="literal">create window</code> above).
			</p><p>
				The <code class="literal">VirtualDataWindowContext</code> provides to your application:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String namedWindowName;	// Name of named window being created.
Object[] parameters;  // Any optional parameters provided as part of create-window.
EventType eventType;  // The event type of events.
EventBeanFactory eventFactory;  // A factory for creating EventBean instances from store rows.
VirtualDataWindowOutStream outputStream;  // For stream output to consuming statements.
AgentInstanceContext agentInstanceContext;  // Other EPL statement information in statement context.</pre><p>
			    When using contexts you can decide whether your factory returns a new virtual data window for each context partition or returns the same virtual data window instance for all context partitions.
			    Your extension code may refer to the named window name to identify the named window and may refer to the agent instance context that holds the agent instance id which is the id of the context partition. 
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="extension-virtualdw-vdw"/>17.2.3.Â Implementing the Virtual Data Window</h3></div></div></div><p>
				A virtual data window implementation is responsible for the following functions:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						Accept the lookup context object as a parameter and return the <code class="literal">VirtualDataWindowLookup</code> implementation.
					</p></li><li><p>
						Optionally, post insert and remove stream data.
					</p></li><li><p>
						Implement the <code class="literal">destroy</code> method, which the engine calls for each context partition when the named window is stopped or destroyed, or once when a context partition is ended/terminated.
					</p></li></ul></div><p>
				The sample code shown here can be found among the examples in the distribution under <code class="literal">virtualdw</code>.
			</p><p>
			  The implementation class must implement the <code class="literal">VirtualDataWindow</code> interface like so:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class SampleVirtualDataWindow implements VirtualDataWindow {

  private final VirtualDataWindowContext context;
  
  public SampleVirtualDataWindow(VirtualDataWindowContext context) {
    this.context = context;
  } ...</pre><p>
			  When the engine compiles an EPL statement and detects a virtual data window, the engine invokes the <code class="literal">getLookup</code> method indicating hash and btree access path information by passing a <code class="literal">VirtualDataWindowLookupContext</code> context. The lookup method must return a <code class="literal">VirtualDataWindowLookup</code> implementation that the EPL statement
			  uses for all lookups until the EPL statement is stopped or destroyed.
			</p><p>
			  The sample implementation does not use the hash and btree access path information and simply returns a lookup object: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public VirtualDataWindowLookup getLookup(VirtualDataWindowLookupContext desc) {

  // Place any code that interrogates the hash-index and btree-index fields here.

  // Return the lookup strategy.
  return new SampleVirtualDataWindowLookup(context);
}</pre><p>
				If your virtual data window returns null instead of a lookup object, the EPL query creation fails and throws an <code class="literal">EPStatementException</code>.
			</p><p>
			 The engine calls the <code class="literal">update</code> method when data changes because of on-merge, on-delete, on-update or insert-into. For example, if you have an on-merge statement that is triggered and that updates the virtual data window, the <code class="literal">newData</code> parameter receives the new (updated) event and the <code class="literal">oldData</code> parameters receives the event prior to the update. Your code may use these events to update the store or delete from the store, if needed.
			</p><p>
				If your application plans to consume data from the virtual data window, for example via <code class="literal">select * from MySampleWindow</code>, then the code must implement the <code class="literal">update</code> method to forward insert and remove stream events, as shown below, to receive the events in consuming statements. To post insert and remove stream data, use the <code class="literal">VirtualDataWindowOutStream</code> provided by the context object as follows. 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void update(EventBean[] newData, EventBean[] oldData) {
  // This sample simply posts into the insert and remove stream what is received.
  context.getOutputStream().update(newData, oldData);
}</pre><p>
				Your application should not use <code class="literal">VirtualDataWindowOutStream</code> to post new events that originate from the store. The object is intended for use with on-action EPL statements. Use insert-into instead for any new events that originate from the store.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="extension-virtualdw-lookup"/>17.2.4.Â Implementing the Lookup</h3></div></div></div><p>
				A lookup implementation is responsible for the following functions:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						Accept the lookup values as a parameter and return a set of <code class="literal">EventBean</code> instances.
					</p></li></ul></div><p>
				The sample code shown here can be found among the examples in the distribution under <code class="literal">virtualdw</code>.
			</p><p>
			  The implementation class must implement the <code class="literal">VirtualDataWindowLookup</code> interface:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class SampleVirtualDataWindowLookup implements VirtualDataWindowLookup {

  private final VirtualDataWindowContext context;
  
  public SampleVirtualDataWindowLookup(VirtualDataWindowContext context) {
    this.context = context;
  } ...</pre><p>
			  When an EPL query fires, the engine invokes the lookup and provides the actual lookup values. The lookup values are provided in the same exact order as the access path information that the engine provided when obtaining the lookup.
			</p><p>
				Each store row must be wrapped as an <code class="literal">EventBean</code> instance. The context object provides an <code class="literal">EventBeanFactory</code> implementation returned by <code class="literal">getEventFactory()</code> that can be used to wrap rows.
			</p><p>
			  The sample implementation does not use the lookup values and simply returns a hardcoded sample event: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public Set&lt;EventBean&gt; lookup(Object[] lookupValues) {
  // Add code to interogate lookup values here.

  // Create sample event.
  // This example uses Map events; Other underlying events such as POJO are exactly the same code.
  Map&lt;String, Object&gt; eventData = new HashMap&lt;String, Object&gt;();
  eventData.put("key1", "sample1");
  eventData.put("key2", "sample2");
  eventData.put("value1", 100);
  eventData.put("value2", 1.5d);
  EventBean event = context.getEventFactory().wrap(eventData);
  return Collections.singleton(event);
}</pre><p>
				The <code class="literal">lookupValues</code> object array represents all actual joined property values or expression results if you where-clause criteria are expressions. The code may use these keys to for efficient store access.
			</p><p>
				When a key value is a range, the key value is an instance of <code class="literal">VirtualDataWindowKeyRange</code>.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="custom-singlerow-function"/>17.3.Â Single-Row Function</h2></div></div></div><a id="d0e44383" class="indexterm"/><a id="d0e44388" class="indexterm"/><p>
			Single-row functions return a single value. They are not expected to aggregate rows but instead should be stateless functions. These functions can appear in any expressions and can be passed any number of parameters.
        </p><p>
			The following steps are required to develop and use a custom single-row function with Esper. 
        </p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					Implement a class providing one or more public static methods accepting the number and type of parameters as required.
				</p></li><li><p>
					Register the single-row function class and method name with the engine by supplying a function name, via the engine configuration file or the configuration API.
				</p></li></ol></div><p>
			You may not override a built-in function with a single-row function provided by you. The single-row function you register must have a different name then any of the built-in functions.
		</p><p>
			An example single-row function can also be found in the examples under the runtime configuration example.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-singlerow-implementing"/>17.3.1.Â Implementing a Single-Row Function</h3></div></div></div><p>
				Single-row function classes have no further requirement then provide a public static method.
			</p><p>
				The following sample single-row function simply computes a percentage value based on two number values. 
			</p><p>
				This sample class provides a public static method by name <code class="literal">computePercent</code> to return a percentage value:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyUtilityClass {
  public static double computePercent(double amount, double total) {
    return amount / total * 100;
  }
}</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-single-row-config"/>17.3.2.Â Configuring the Single-Row Function Name</h3></div></div></div><p>
				The class name of the class, the method name and the function name of the new single-row function must be added to the engine configuration via the configuration API or using the XML configuration file. The configuration shown below is XML however the same options are available through the runtime and static configuration API:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;esper-configuration
  &lt;plugin-singlerow-function name="percent" 
    function-class="mycompany.MyUtilityClass" function-method="computePercent" /&gt;
&lt;/esper-configuration&gt;</pre><p>
				Note that the function name and method name need not be the same.
			</p><p>
				The new single-row function is now ready to use in a statement:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select percent(fulfilled,total) from MyEvent</pre><p>
				When selecting from a single stream, you may also pass wildcard to the single-row function and the function receives the underlying event:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select percent(*) from MyEvent</pre><p>
				If the single-row function returns an object that provides further functions, you may chain function calls.
			</p><p>
				The following demonstrates a chained single-row function. The example assumes that a single-row function by name <code class="literal">calculator</code> returns an object that provides the <code class="literal">add</code> function which accepts two parameters:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select calculator().add(5, amount) from MyEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-single-row-cache"/>17.3.3.Â Value Cache</h3></div></div></div><p>
				When a single-row function receives parameters that are all constant values or expressions that themselves receive only constant values, Esper can pre-evaluate the result of the single-row function at time of statement creation. By default, Esper does not pre-evaluate the single-row function unless you configure
				the value cache as enabled.
			</p><p>
			  The following configuration XML enables the value cache for the single-row function:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;esper-configuration
  &lt;plugin-singlerow-function name="getDate" 
    function-class="mycompany.DateUtil" function-method="parseDate"
    value-cache="enabled" /&gt;
&lt;/esper-configuration&gt;</pre><p>
				When the single-row function receives constants as parameters, the engine computes the result once and returns the cached result for each evaluation:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select getDate('2002-05-30T9:00:00.000') from MyEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-single-filter-optimizable"/>17.3.4.Â Single-Row Functions in Filter Predicate Expressions</h3></div></div></div><p>
			  Your EPL may use plug-in single row functions among the predicate expressions as part of the filters in a stream or pattern.
			</p><p>
			  For example, the EPL below uses the function <code class="literal">computeHash</code> as part of a predicate expression:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent(computeHash(field) = 100)</pre><p>
			   When you have many EPL statements or many context partitions that refer to the same function, event type and parameters in a predicate expression, the engine may optimize evaluation: The function gets evaluated only once per event.
			</p><p>
				While the optimization is enabled by default for all plug-in single row functions, you can also disable the optimization for a specific single-row function. By disabling the optimization for a single-row function the engine may use less memory to identify reusable function footprints but may cause the engine to evaluate each function more frequently then necessary.
			</p><p>
			  The following configuration XML disables the filter optimization for a single-row function (by default it is enabled):
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;esper-configuration
  &lt;plugin-singlerow-function name="computeHash" 
    function-class="mycompany.HashUtil" function-method="computeHash"
    filter-optimizable="disabled" /&gt;
&lt;/esper-configuration&gt;</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-single-eventsparam"/>17.3.5.Â Single-Row Functions Taking Events as Parameters</h3></div></div></div><p>
			  Esper allows parameters to a single-row function to be events. In this case, declare the method parameter type to either take <code class="literal">EventBean</code>, <code class="literal">Collection&lt;EventBean&gt;</code>
			  or the underlying class as a parameter.			  
			</p><p>
			  Sample method footprints are:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public static double doCompute(EventBean eventBean) {...}
public static boolean doCheck(MyEvent myEvent, String text) {...}
public static String doSearch(Collection&lt;EventBean&gt; events) {...}</pre><p>
			  To pass the event, specify the stream alias, or wildcard <code class="literal">(*)</code> or the tag name when used in a pattern.
			</p><p>
			  The EPL below shows example uses:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent(doCompute(me) = 100) as me</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent where doCompute(*) = 100</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern[a=MyEvent -&gt; MyEvent(doCheck(a, 'sometext'))]</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#time(1 min) having doCompute(last(*))]</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent#time(1 min) having doSearch(window(*))]</pre><p>
			  Declare the method parameter as <code class="literal">Collection&lt;EventBean&gt;</code> if the method expects 
			  an expression result that returns multiple events.
			</p><p>
			  Declare the method parameter as <code class="literal">EventBean</code> if the method expects 
			  an expression result that returns a single event.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-single-returningevents"/>17.3.6.Â Single-Row Functions Returning Events</h3></div></div></div><p>
			  A single-row function may return events. Please declare your single-row function method to return <code class="literal">Collection&lt;EventBean&gt;</code> or <code class="literal">EventBean[]</code> and configure the event type name.
			</p><p>
			  For example, assuming there is an <code class="literal">MyItem</code> event type such as created via <code class="literal">create schema MyItem(id string)</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public static EventBean[] myItemProducer(String string, EPLMethodInvocationContext context) {
  String[] split = string.split(",");
  EventBean[] events = new EventBean[split.length];
  for (int i = 0; i &lt; split.length; i++) {
    events[i] = context.getEventBeanService().adapterForMap(Collections.singletonMap("id", split[i]), "MyItem");
  }
  return events;
}</pre><p>
			  The sample EPL queries items filtering those items that have a given value for the <code class="literal">id</code> field:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select myItemProducer(ordertext).where(v =&gt; v.id in ('id1', 'id3')) as c0 from Order</pre><p>
			  This sample code register the <code class="literal">myItemProducer</code> function as a single-row function with an event type name:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">ConfigurationPlugInSingleRowFunction entry = new ConfigurationPlugInSingleRowFunction();
entry.setName("myItemProducer");
entry.setFunctionClassName(...);
entry.setFunctionMethodName(...);
entry.setEventTypeName("MyItem");
epService.getEPAdministrator().getConfiguration().addPlugInSingleRowFunction(entry);</pre><p>
				If your single row function returns <code class="literal">EventBean[]</code> and is used with enumeration methods the configuration must provide an event type name.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-single-receivectx"/>17.3.7.Â Receiving a Context Object</h3></div></div></div><p>
			  Esper can pass an object containing contextual information such as statement name, function name, engine URI and context partition id to your
			  method. The container for this information is <code class="literal">EPLMethodInvocationContext</code> in package <code class="literal">com.espertech.esper.client.hook</code>.
			  Please declare your method to take <code class="literal">EPLMethodInvocationContext</code> as the last parameter. The engine then passes the information along.
			</p><p> 
			  A sample method footprint and EPL are shown below:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public static double computeSomething(double number, EPLMethodInvocationContext context) {...}</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select computeSomething(10) from MyEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-single-rethrowex"/>17.3.8.Â Exception Handling</h3></div></div></div><p>
			  By default the engine logs any exceptions thrown by the single row function and returns a null value. 
			  To have exceptions be re-thrown instead, which makes exceptions visible to any registered exception handler,
			  please configure as discussed herein. 
			</p><p>
				Set the <code class="literal">rethrow-exceptions</code> flag in the XML configuration or the <code class="literal">rethrowExceptions</code> flag in the API
				when registering the single row function to have the engine re-throw any exceptions that the single row function may throw.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="custom-views"/>17.4.Â Derived-Value and Data Window View</h2></div></div></div><a id="d0e44602" class="indexterm"/><a id="d0e44607" class="indexterm"/><p>
			Views in Esper are used to derive information from an event stream, and to represent data windows onto an event stream. This chapter describes how to plug-in a new, custom view. 
        </p><p>
			The following steps are required to develop and use a custom view with Esper. 
        </p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					Implement a view factory class. View factories are classes that accept and check view parameters and instantiate the appropriate view class.
				</p></li><li><p>
					Implement a view class. A view class commonly represents a data window or derives new information from a stream.
				</p></li><li><p>
					Configure the view factory class supplying a view namespace and name in the engine configuration file.
				</p></li></ol></div><p>
			The example view factory and view class that are used in this chapter can be found in the examples source folder in the OHLC (open-high-low-close) example. The class names are <code class="literal">OHLCBarPlugInViewFactory</code> and <code class="literal">OHLCBarPlugInView</code>.
        </p><p>
			Views can make use of the following engine services available via <code class="literal">StatementServiceContext</code>:
        </p><div class="itemizedlist"><ul compact="compact"><li><p>
					The <code class="literal">SchedulingService</code> interface allows views to schedule timer callbacks to a view
				</p></li><li><p>
					The <code class="literal">EventAdapterService</code> interface allows views to create new event types and event instances of a given type. 
				</p></li><li><p>
					The <code class="literal">StatementStopService</code> interface allows view to register a callback that the engine invokes to indicate that the view's statement has been stopped
				</p></li></ul></div><p>
			<a class="xref" href="#custom-views-contract" title="17.4.3.Â View Contract">SectionÂ 17.4.3, âView Contractâ</a> outlines the requirements for correct behavior of a your custom view within the engine.
        </p><p>
			Note that custom views may use engine services and APIs that can be subject to change between major releases. The engine services discussed above and view APIs are considered part of the engine internal public API and are stable. Any changes to such APIs are disclosed through the release change logs and history. Please also consider contributing your custom view to the Esper project team by submitting the view code through the mailing list or via a JIRA issue.
        </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-views-viewfactory"/>17.4.1.Â Implementing a View Factory</h3></div></div></div><p>
				A view factory class is responsible for the following functions:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						Accept zero, one or more view parameters. View parameters are themselves expressions. The view factory must validate and evaluate these expressions.
					</p></li><li><p>
						Instantiate the actual view class.
					</p></li><li><p>
						Provide information about the event type of events posted by the view.
					</p></li></ul></div><p>
				View factory classes simply subclass <code class="literal">com.espertech.esper.view.ViewFactorySupport</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class OHLCBarPlugInViewFactory extends ViewFactorySupport { ...</pre><p>
				Your view factory class must implement the <code class="literal">setViewParameters</code> method to accept and parse view parameters. The next code snippet shows an implementation of this method. The code checks the number of parameters and retains the parameters passed to the method:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class OHLCBarPlugInViewFactory extends ViewFactorySupport {
    private ViewFactoryContext viewFactoryContext;
    private List&lt;ExprNode&gt; viewParameters;
    private ExprNode timestampExpression;
    private ExprNode valueExpression;

    public void setViewParameters(ViewFactoryContext viewFactoryContext, 
            List&lt;ExprNode&gt; viewParameters) throws ViewParameterException {
        this.viewFactoryContext = viewFactoryContext;
        if (viewParameters.size() != 2) {
            throw new ViewParameterException(
                "View requires a two parameters: " +
                "the expression returning timestamps and the expression supplying OHLC data points");
        }
        this.viewParameters = viewParameters;
    }
  ...</pre><p>
			After the engine supplied view parameters to the factory, the engine will ask the view to attach to its parent view and validate any parameter expressions against the parent view's event type. If the view will be generating events of a different type then the events generated by the parent view, then the view factory can create the new event type in this method:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void attach(EventType parentEventType, 
		StatementContext statementContext, 
		ViewFactory optionalParentFactory, 
		List&lt;ViewFactory&gt; parentViewFactories) throws ViewParameterException {
		
    ExprNode[] validatedNodes = ViewFactorySupport.validate("OHLC view", 
	      parentEventType, statementContext, viewParameters, false);

    timestampExpression = validatedNodes[0];
    valueExpression = validatedNodes[1];

    if ((timestampExpression.getExprEvaluator().getType() != long.class) &amp;&amp; 
        (timestampExpression.getExprEvaluator().getType() != Long.class)) {
        throw new ViewParameterException(
            "View requires long-typed timestamp values in parameter 1");
    }
    if ((valueExpression.getExprEvaluator().getType() != double.class) &amp;&amp; 
        (valueExpression.getExprEvaluator().getType() != Double.class)) {
        throw new ViewParameterException(
            "View requires double-typed values for in parameter 2");
    }
}</pre><p>
			Finally, the engine asks the view factory to create a view instance, and asks for the type of event generated by the view:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public View makeView(AgentInstanceViewFactoryChainContext agentInstanceViewFactoryContext) {
    return new OHLCBarPlugInView(agentInstanceViewFactoryContext, timestampExpression, valueExpression);
}

public EventType getEventType() {
    return OHLCBarPlugInView.getEventType(viewFactoryContext.getEventAdapterService());
}</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-views-view"/>17.4.2.Â Implementing a View</h3></div></div></div><p>
				A view class is responsible for:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						The <code class="literal">setParent</code> method informs the view of the parent view's event type
					</p></li><li><p>
						The <code class="literal">update</code> method receives insert streams and remove stream events from its parent view
					</p></li><li><p>
						The <code class="literal">iterator</code> method supplies an (optional) iterator to allow an application to pull or request results from an <code class="literal">EPStatement</code>
					</p></li></ul></div><p>
				View classes simply subclass <code class="literal">com.espertech.esper.view.ViewSupport</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyTrendSpotterView extends ViewSupport { ...</pre><p>
				Your view's <code class="literal">update</code> method will be processing incoming (insert stream) and outgoing (remove stream) events posted by the parent view (if any), as well as providing incoming and outgoing events to child views. The convention required of your update method implementation is that the view releases any insert stream events (EventBean object references) which the view generates as reference-equal remove stream events (EventBean object references) at a later time. 
			</p><p>
				The view implementation must call the <code class="literal">updateChildren</code> method to post outgoing insert and remove stream events. Similar to the <code class="literal">update</code> method, the <code class="literal">updateChildren</code> method takes insert and remove stream events as parameters.
			</p><p>
				A sample <code class="literal">update</code> method implementation is provided in the OHLC example.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-views-contract"/>17.4.3.Â View Contract</h3></div></div></div><p>
				The <code class="literal">update</code> method must adhere to the following conventions, to prevent memory leaks and to enable correct behavior within the engine:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						A view implementation that posts events to the insert stream must post unique <code class="literal">EventBean</code> object references as insert stream events, and cannot post the same <code class="literal">EventBean</code> object reference multiple times. The underlying event to the <code class="literal">EventBean</code> object reference can be the same object reference, however the <code class="literal">EventBean</code> object reference posted by the view into the insert stream must be a new instance for each insert stream event.
					</p></li><li><p>
						If the custom view posts a continuous insert stream, then the views must also post a continuous remove stream (second parameter to the <code class="literal">updateChildren</code> method). If the view does not post remove stream events, it assumes unbound keep-all semantics.
					</p></li><li><p>
						<code class="literal">EventBean</code> events posted as remove stream events must be the same object reference as the <code class="literal">EventBean</code> events posted as insert stream by the view. Thus remove stream events posted by the view (the <code class="literal">EventBean</code> instances, does not affect the underlying representation) must be reference-equal to insert stream events posted by the view as part of an earlier invocation of the update method, or the same invocation of the update method.
					</p></li><li><p>
						<code class="literal">EventBean</code> events represent a unique observation. The values of the observation can be the same, thus the underlying representation of an <code class="literal">EventBean</code> event can be reused, however event property values must be kept immutable and not be subject to change.
					</p></li><li><p>
						Array elements of the insert and remove stream events must not carry null values. Array size must match the number of <code class="literal">EventBean</code> instances posted. It is recommended to use a <code class="literal">null</code> value for no insert or remove stream events rather then an empty zero-size array. 
					</p></li></ul></div><p>
				Your view implementation can register a callback indicating when a statement using the view, or a context partition using the view, is stopped or terminated. Your
				view code must implement, or provide an implementation, of the <code class="literal">com.espertech.esper.util.StopCallback</code> interface. Register the stop callback in order for the engine to invoke the callback:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">agentInstanceContext.getTerminationCallbacks().add(this);</pre><p>
				Please refer to the sample views for a code sample on how to implement the <code class="literal">iterator</code> method.
			</p><p>
				In terms of multiple threads accessing view state, there is no need for your custom view factory or view implementation to perform any synchronization to protect internal state. The iterator of the custom view implementation does also not need to be thread-safe. The engine ensures the custom view executes in the context of a single thread at a time. If your view uses shared external state, such external state must be still considered for synchronization when using multiple threads.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-views-config"/>17.4.4.Â Configuring View Namespace and Name</h3></div></div></div><p>
				The view factory class name as well as the view namespace and name for the new view must be added to the engine configuration via the configuration API or using the XML configuration file. The configuration shown below is XML however the same options are available through the configuration API:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;esper-configuration
  &lt;plugin-view namespace="custom" name="ohlc" 
      factory-class="com.espertech.esper.example.ohlc.OHLCBarPlugInViewFactory" /&gt; 
&lt;/esper-configuration&gt;</pre><p>
				The new view is now ready to use in a statement:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTick.custom:ohlc(timestamp, price)</pre><p>
				Note that the view must implement additional interfaces if it acts as a data window view, or works in a grouping context, as discussed in detail below.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-views-datawin"/>17.4.5.Â Requirement for Data Window Views</h3></div></div></div><p>
				Your custom view may represent an expiry policy and may retain events and thus act as a data window view. In order to allow the engine to validate that your view can be used with named windows, which allow only data window views,
				this section documents any additional requirement that your classes must fulfill.
			</p><p>
				Your view factory class must implement the <code class="literal">com.espertech.esper.view.DataWindowViewFactory</code> interface. This marker interface (no methods required) indicates that your view factory provides only data window views.  
			</p><p>
				Your view class must implement the <code class="literal">com.espertech.esper.view.DataWindowView</code> interface. This interface indicates that your view is a data window view and therefore eligible to be used in any construct that requires a data window view. The <code class="literal">DataWindowView</code> interface extends the <code class="literal">ViewDataVisitable</code> interface. Please provide an empty implementation method for the <code class="literal">visitView</code> method as required by <code class="literal">ViewDataVisitable</code> (the default behavior is sufficient).
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-views-derivedvalue"/>17.4.6.Â Requirement for Derived-Value Views</h3></div></div></div><p>
				Your custom view may compute derived information from the arriving stream, instead of retaining events, and thus act as a derived-value view. 
			</p><p>
				Your view class should implement the <code class="literal">com.espertech.esper.view.DerivedValueView</code> interface. This marker interface indicates that your view is a derived-value view,
				affecting correct behavior of the view when used in joins.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-views-grouped"/>17.4.7.Â Requirement for Grouped Views</h3></div></div></div><p>
				Grouped views are views that operate under the <code class="literal">#groupwin</code> view. When operating under <code class="literal">#groupwin</code>, the engine instantiates a single instance when the statement starts, and a new instance per group criteria dynamically as new group criteria become known. 
			</p><p>
				The next statement shows EPL for using a view instance per grouping criteria:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from StockTick#groupwin(symbol).custom:trendspotter(price)</pre><p>
				Your view must implement the <code class="literal">com.espertech.esper.view.GroupableView</code> interface to indicate that the view can handle grouped windows.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="custom-aggregation-function"/>17.5.Â Aggregation Function</h2></div></div></div><a id="d0e44903" class="indexterm"/><a id="d0e44908" class="indexterm"/><p>
		  Aggregation functions are stateful functions that aggregate events, event property values or expression results. Examples for built-in aggregation functions are <code class="literal">count(*)</code>, <code class="literal">sum(price * volume)</code>, <code class="literal">window(*)</code> or <code class="literal">maxby(volume)</code>.
		</p><p>
		  Esper allows two different ways for your application to provide aggregation functions. We use the name <span class="emphasis"><em>aggregation single-function</em></span> and <span class="emphasis"><em>aggregation multi-function</em></span> for the two independent extension APIs for aggregation functions.			
        </p><p>
			The aggregation single-function API is simple to use however it imposes certain restrictions on how expressions that contain aggregation functions share state and are evaluated.
		</p><p>
			The aggregation multi-function API is more powerful and provides control over how expressions that contain aggregation functions share state and are evaluated.
		</p><p>
		  The next table compares the two aggregation function extension API's:
        </p><div class="table"><a id="d0e44941"/><p class="title"><b>TableÂ 17.1.Â Aggregation Function Extension API's</b></p><div class="table-contents"><table summary="Aggregation Function Extension API's" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Â </th><th>Single-Function</th><th>Multi-Function</th></tr></thead><tbody><tr><td>Return Value</td><td>Can only return a single value or object. Cannot return an <code class="literal">EventBean</code> event, collection of <code class="literal">EventBean</code> events or collection or array of values for use with enumeration methods, for example.</td><td>Can return an <code class="literal">EventBean</code> event, a collection of <code class="literal">EventBean</code> events or a collection or array of objects for use with enumeration methods or to access event properties.</td></tr><tr><td>Complexity of API</td><td>Simple (consists of 2 interfaces).</td><td>More complex (consists of 6 interfaces).</td></tr><tr><td>State Sharing</td><td>State and parameter evaluation shared if multiple aggregation functions of the same name in the same statement (and context partition) take the exact same parameter expressions.</td><td>State and parameter evaluation sharable when multiple aggregation functions of a related name (related thru configuration) for the same statement (and context partition) exist, according to a sharing-key provided by your API implementation.</td></tr><tr><td>Function Name</td><td>Each aggregation function expression receives its own factory object.</td><td>Multiple related aggregation function expressions share a single factory object.</td></tr><tr><td>Distinct Keyword</td><td>Handled by the engine transparently.</td><td>Indicated to the API implementation only.</td></tr></tbody></table></div></div><br class="table-break"/><p>
		  The following sections discuss developing an aggregation single-function first, followed by the subject of developing an aggregation multi-function.
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
			  The aggregation multi-function API is a powerful and lower-level API to extend the engine. Any classes that are not part of the <code class="literal">client</code>, <code class="literal">plugin</code> or <code class="literal">agg.access</code> package are subject to change between minor and major releases of the engine.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-aggregation-single"/>17.5.1.Â Aggregation Single-Function Development</h3></div></div></div><p>
				This section describes the <span class="emphasis"><em>aggregation single-function</em></span> extension API for providing aggregation functions.
			</p><p>
				The following steps are required to develop and use a custom aggregation single-function with Esper. 
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						Implement an aggregation function factory by implementing the interface <code class="literal">com.espertech.esper.client.hook.AggregationFunctionFactory</code>.
					</p></li><li><p>
						Implement an aggregation function by implementing the interface <code class="literal">com.espertech.esper.epl.agg.aggregator.AggregationMethod</code>.
					</p></li><li><p>
						Register the aggregation single-function factory class with the engine by supplying a function name, via the engine configuration file or the runtime and static configuration API.
					</p></li></ol></div><p>
				The optional keyword <code class="literal">distinct</code> ensures that only distinct (unique) values are aggregated and duplicate values are ignored by the aggregation function. Custom plug-in aggregation single-functions do not need to implement the logic to handle <code class="literal">distinct</code> values. This is because when the engine encounters the <code class="literal">distinct</code> keyword, it eliminates any non-distinct values before passing the value for aggregation to the custom aggregation single-function.
			</p><p>
				Custom aggregation functions can also be passed multiple parameters, as further described in <a class="xref" href="#custom-aggregation-single-multiparam" title="17.5.1.4.Â Aggregation Single-Function: Accepting Multiple Parameters">SectionÂ 17.5.1.4, âAggregation Single-Function: Accepting Multiple Parametersâ</a>. In the example below the aggregation function accepts a single parameter.
			</p><p>
				The code for the example aggregation function as shown in this chapter can be found in the runtime configuration example in the package <code class="literal">com.espertech.esper.example.runtimeconfig</code> by the name <code class="literal">MyConcatAggregationFunction</code>. The sample function simply concatenates string-type values.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-aggregation-single-factory"/>17.5.1.1.Â Implementing an Aggregation Single-Function Factory</h4></div></div></div><p>
					An aggregation function factory class is responsible for the following functions:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							Implement a <code class="literal">setFunctionName</code> method that receives the function name assigned to this instance. 
						</p></li><li><p>
							Implement a <code class="literal">validate</code> method that validates the value type of the data points that the function must process.
						</p></li><li><p>
							Implement a <code class="literal">getValueType</code> method that returns the type of the aggregation value generated by the aggregation function instances. For example, the built-in <code class="literal">count</code> aggregation function returns <code class="literal">Long.class</code> as it generates <code class="literal">long</code> -typed values.
						</p></li><li><p>
							Implement a <code class="literal">newAggregator</code> method that instantiates and returns an aggregation function instance. 
						</p></li></ul></div><p>
					Aggregation function classes implement the interface <code class="literal">com.espertech.esper.client.hook.AggregationFunctionFactory</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyConcatAggregationFunctionFactory implements AggregationFunctionFactory { ...</pre><p>
					The engine generally constructs one instance of the aggregation function factory class for each time the function is listed in an EPL statement, however the engine may decide to reduce the number of aggregation class instances if it finds equivalent aggregations.
				</p><p>
					The aggregation function factory instance receives the aggregation function name via set <code class="literal">setFunctionName</code> method.
				</p><p>
				  The sample concatenation function factory provides an empty <code class="literal">setFunctionName</code> method:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void setFunctionName(String functionName) {
  // no action taken
}</pre><p>
					An aggregation function factory must provide an implementation of the <code class="literal">validate</code> method that is passed a <code class="literal">AggregationValidationContext</code> validation context object. Within the validation context you find the result type of each of the parameters expressions to the aggregation function as well as information about constant values and data window use. Please see the JavaDoc API documentation for a comprehensive list of validation context information.
				</p><p>
					Since the example concatenation function requires string types, it implements a type check:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void validate(AggregationValidationContext validationContext) {
  if ((validationContext.getParameterTypes().length != 1) ||
    (validationContext.getParameterTypes()[0] != String.class)) {
    throw new IllegalArgumentException("Concat aggregation requires a single parameter of type String");
  }
}</pre><p>
					In order for the engine to validate the type returned by the aggregation function against the types expected by enclosing expressions, the <code class="literal">getValueType</code> must return the result type of any values produced by the aggregation function:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public Class getValueType() {
  return String.class;
}</pre><p>
					 Finally the factory implementation must provide a <code class="literal">newAggregator</code> method that returns instances of <code class="literal">AggregationMethod</code>. The engine invokes this method for each new aggregation state to be allocated.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public AggregationMethod newAggregator() {
  return new MyConcatAggregationFunction();
}</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-aggregation-single implementing"/>17.5.1.2.Â Implementing an Aggregation Single-Function</h4></div></div></div><p>
					An aggregation function class is responsible for the following functions:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							Implement an <code class="literal">enter</code> method that the engine invokes to add a data point into the aggregation, when an event enters a data window
						</p></li><li><p>
							Implement a <code class="literal">leave</code> method that the engine invokes to remove a data point from the aggregation, when an event leaves a data window
						</p></li><li><p>
							Implement a <code class="literal">getValue</code> method that returns the current value of the aggregation. 
						</p></li><li><p>
							Implement a <code class="literal">clear</code> method that resets the current value. 
						</p></li></ul></div><p>
					Aggregation function classes implement the interface <code class="literal">AggregationMethod</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyConcatAggregationFunction implements AggregationMethod { ...</pre><p>
					The class that provides the aggregation and implements <code class="literal">AggregationMethod</code> does not have to be threadsafe.
				</p><p>
					The constructor initializes the aggregation function:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyConcatAggregationFunction implements AggregationMethod {
  private final static char DELIMITER = ' ';
  private StringBuilder builder;
  private String delimiter;

  public MyConcatAggregationFunction() {
    builder = new StringBuilder();
    delimiter = "";
  }
  ...</pre><p>
					The <code class="literal">enter</code> method adds a datapoint to the current aggregation value. The example <code class="literal">enter</code> method shown below adds a delimiter and the string value to a string buffer:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void enter(Object value) {
  if (value != null) {
    builder.append(delimiter);
    builder.append(value.toString());
    delimiter = String.valueOf(DELIMITER);
  }
}</pre><p>
					Conversly, the <code class="literal">leave</code> method removes a datapoint from the current aggregation value. The example <code class="literal">leave</code> method removes from the string buffer:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void leave(Object value) {
  if (value != null) {
    builder.delete(0, value.toString().length() + 1);
  }
}</pre><p>
					Finally, the engine obtains the current aggregation value by means of the <code class="literal">getValue</code> method:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public Object getValue() {
  return builder.toString();
}</pre><p>
					For on-demand queries the aggregation function must support resetting its value to empty or start values. Implement the <code class="literal">clear</code> function to reset the value as shown below:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void clear() {
  builder = new StringBuilder();
  delimiter = "";
}</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-aggregation-single-config"/>17.5.1.3.Â Configuring the Aggregation Single-Function Name</h4></div></div></div><p>
					The aggregation function class name as well as the function name for the new aggregation function must be added to the engine configuration via the configuration API or using the XML configuration file. The configuration shown below is XML however the same options are available through the configuration API:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;esper-configuration
  &lt;plugin-aggregation-function name="concat" 
    factory-class="com.espertech.esper.example.runtimeconfig.MyConcatAggregationFunctionFactory" /&gt;
&lt;/esper-configuration&gt;</pre><p>
					The new aggregation function is now ready to use in a statement:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select concat(symbol) from StockTick#length(3)</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-aggregation-single-multiparam"/>17.5.1.4.Â Aggregation Single-Function: Accepting Multiple Parameters</h4></div></div></div><p>
					Your plug-in aggregation function may accept multiple parameters, simply by casting the Object parameter of the <code class="literal">enter</code> and <code class="literal">leave</code> method to <code class="literal">Object[]</code>.
				</p><p>
					For instance, assume an aggregation function <code class="literal">rangeCount</code> that counts all values that fall into a range of values. The EPL that calls this function and provides a lower and upper bounds of 1 and 10 is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select rangeCount(1, 10, myValue) from MyEvent</pre><p>
					The <code class="literal">enter</code> method of the plug-in aggregation function may look as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void enter(Object value)  {
  Object[] params = (Object[]) value;
  int lower = (Integer) params[0];
  int upper = (Integer) params[1];
  int val = (Integer) params[2];
  if ((val &gt;= lower) &amp;&amp; (val &lt;= upper)) {
    count++;
  }
}</pre><p>
					Your plug-in aggregation function may want to validate parameter types or may want to know which parameters are constant-value expressions. Constant-value expressions are evaluated only once by the engine and could
					therefore be cached by your aggregation function for performance reasons. The engine provides constant-value information as part of the <code class="literal">AggregationValidationContext</code> passed to the <code class="literal">validate</code> method.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-aggregation-single-filter"/>17.5.1.5.Â Aggregation Single-Function: The Filter Parameter</h4></div></div></div><p>
					When an EPL statement provides the <code class="literal">filter</code> named parameter the value of the filter expression is a <code class="literal">boolean</code>-type value
					that the engine determines and provides to your <code class="literal">enter</code> method as the last value in the parameter array.
				</p><p>
					For instance, assume an aggregation function <code class="literal">concat</code> that receives a <code class="literal">word</code> value and that has a <code class="literal">filter</code> expression as parameters:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select concat(word, filter: word not like '%jim%') from MyWordEvent</pre><p>
					The <code class="literal">enter</code> method of the plug-in aggregation function may look as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void enter(Object value)  {
  Object[] arr = (Object[]) value;
  Boolean pass = (Boolean) arr[1];
  if (pass != null &amp;&amp; pass) {
    buffer.append(arr[0].toString());
  }
}</pre><p>
					Your code can obtain the actual filter expression from the <code class="literal">AggregationValidationContext</code> that is passed to the <code class="literal">validate</code> method and that 
					returns the named parameters via <code class="literal">getNamedParameters</code>.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-aggregation-single-dotmethod"/>17.5.1.6.Â Aggregation Single-Function: Dot-Operator Use</h4></div></div></div><p>
					When the custom aggregation function returns an object as a return value, the EPL can use parenthesis and the dot-operator to invoke methods on the return value.
				</p><p>
					The following example assumes that the <code class="literal">myAggregation</code> custom aggregation function returns an object that has <code class="literal">getValueOne</code> and <code class="literal">getValueTwo</code> methods:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select (myAggregation(myValue)).getValueOne(),  (myAggregation(myValue)).getValueTwo() from MyEvent</pre><p>
					Since the above EPL aggregates the same value, the engine internally uses a single aggregation to represent the current value of <code class="literal">myAggregation</code> (and not two instances of the aggregation, even though <code class="literal">myAggregation</code> is listed twice).
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-aggregation-multi"/>17.5.2.Â Aggregation Multi-Function Development</h3></div></div></div><p>
				This section introduces the aggregation multi-function API. Please refer to the JavaDoc for more complete class and method-level documentation.
			</p><p>
				Among the Esper examples is an example use of the aggregation multi-function API in the example by name Cycle-Detect. 
				Cycle-Detect takes incoming transaction events that have from-account and to-account fields.
				The example detects a cycle in the transactions between accounts in order to detect a possible transaction fraud. 
				Please note that the graph and cycle detection logic of the example is not part of Esper:
				The example utilizes the <code class="literal">jgrapht</code> library.
			</p><p>
				In the Cycle-Detect example, the vertices of a graph are the account numbers. For example the account numbers <code class="literal">Acct-1</code>, <code class="literal">Acct-2</code> and <code class="literal">Acct-3</code>.
				In the graph the edges are transaction events that identify a from-account and a to-account. An example edge is <code class="literal">{from:Acct-1, to:Acct-2}</code>.
				An example cycle is therefore in the three transactions <code class="literal">{from:Acct-1, to:Acct-2}</code>, <code class="literal">{from:Acct-2, to:Acct-3}</code> and <code class="literal">{from:Acct-3, to:Acct-1}</code>.
			</p><p>
				The code for the example aggregation multi-function as shown in this chapter can be found in the Cycle-Detect example in the package <code class="literal">com.espertech.esper.example.cycledetect</code>.
				The example provides two aggregation functions named <code class="literal">cycledetected</code> and <code class="literal">cycleoutput</code>:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					  The <code class="literal">cycledetected</code> function returns a boolean value whether a graph cycle is found or not.
					</p></li><li><p>
					  The <code class="literal">cycleoutput</code> function outputs the vertices (account numbers) that are part of the graph cycle.
					</p></li></ol></div><p>
			  In the Cycle-Detect example, the following statement utilizes the two functions <code class="literal">cycledetected</code> and <code class="literal">cycleoutput</code> that
			  share the same graph state to detect a cycle among the last 1000 events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Name('CycleDetector') select cycleoutput() as cyclevertices
from TransactionEvent#length(1000)
having cycledetected(fromAcct, toAcct)</pre><p>
			  If instead the goal is to run graph cycle detection every 1 second (and not upon arrival of a new event), this sample EPL statement uses a pattern to trigger cycle detection:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Name('CycleDetector')
select (select cycleoutput(fromAcct, toAcct) from TransactionEvent#length(1000)) as cyclevertices
from pattern [every timer:interval(1)]</pre><p>
				The following steps are required to develop and use a custom aggregation multi-function with Esper. 
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						Implement an aggregation multi-function factory by implementing the interface <code class="literal">com.espertech.esper.plugin.PlugInAggregationMultiFunctionFactory</code>.
					</p></li><li><p>
						Implement one or more handlers for aggregation functions by implementing the interface <code class="literal">com.espertech.esper.plugin.PlugInAggregationMultiFunctionHandler</code>.
					</p></li><li><p>
						Implement an aggregation state key by implementing the interface <code class="literal">com.espertech.esper.epl.agg.access.AggregationStateKey</code>.
					</p></li><li><p>
						Implement an aggregation state factory by implementing the interface <code class="literal">com.espertech.esper.plugin.PlugInAggregationMultiFunctionStateFactory</code>.
					</p></li><li><p>
						Implement an aggregation state holder by implementing the interface <code class="literal">com.espertech.esper.epl.agg.access.AggregationState</code>.
					</p></li><li><p>
						Implement a state accessor by implementing the interface <code class="literal">com.espertech.esper.epl.agg.access.AggregationAccessor</code>.
					</p></li><li><p>
						Register the aggregation multi-function factory class with the engine by supplying one or more function names, via the engine configuration file or the runtime and static configuration API.
					</p></li></ol></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-aggregation-multi-factory"/>17.5.2.1.Â Implementing an Aggregation Multi-Function Factory</h4></div></div></div><p>
					An aggregation multi-function factory class is responsible for the following functions:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							Implement the <code class="literal">addAggregationFunction</code> method that receives an invocation for each aggregation function declared in the statement that matches any of the function names provided at configuration time. 
						</p></li><li><p>
							Implement the <code class="literal">validateGetHandler</code> method that receives an invocation for each aggregation function to be validated in the statement that matches any of the function names provided at configuration time.
						</p></li></ul></div><p>
					Aggregation multi-function factory classes implement the interface <code class="literal">com.espertech.esper.plugin.PlugInAggregationMultiFunctionFactory</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class CycleDetectorAggregationFactory implements PlugInAggregationMultiFunctionFactory { ...</pre><p>
					The engine constructs a single instance of the aggregation multi-function factory class that is shared for all aggregation function expressions in a statement that have one of the function names provided in the configuration object.
				</p><p>
					The engine invokes the <code class="literal">addAggregationFunction</code> method at the time it parses an EPL statement or compiles a statement object model (SODA API).
					The method receives a declaration-time context object that provides the function name as well as additional information.
				</p><p>
				  The sample Cycle-Detect factory class provides an empty <code class="literal">addAggregationFunction</code> method:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void addAggregationFunction(PlugInAggregationMultiFunctionDeclarationContext declarationContext) {
  // no action taken
}</pre><p>
					The engine invokes the <code class="literal">validateGetHandler</code> method at the time of expression validation. It passes 
					a <code class="literal">PlugInAggregationMultiFunctionValidationContext</code> validation context object that contains actual parameters expressions. 
					Please see the JavaDoc API documentation for a comprehensive list of validation context information.
				</p><p>
					The <code class="literal">validateGetHandler</code> method must return a handler object the implements the <code class="literal">PlugInAggregationMultiFunctionHandler</code> interface.
					Return a handler object for each aggregation function expression according to the aggregation function name and its parameters that are provided in the validation 
					context.
				</p><p>
					The example <code class="literal">cycledetect</code> function takes two parameters that provide the cycle edge (from-account and to-account):
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public PlugInAggregationMultiFunctionHandler validateGetHandler(PlugInAggregationMultiFunctionValidationContext validationContext) {
  if (validationContext.getParameterExpressions().length == 2) {
    fromExpression = validationContext.getParameterExpressions()[0].getExprEvaluator();
    toExpression = validationContext.getParameterExpressions()[1].getExprEvaluator();
  }
  return new CycleDetectorAggregationHandler(this, validationContext);
}</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-aggregation-multi-handlr"/>17.5.2.2.Â Implementing an Aggregation Multi-Function Handler</h4></div></div></div><p>
					An aggregation multi-function handler class must implement the <code class="literal">PlugInAggregationMultiFunctionHandler</code> interface and is responsible for the following functions:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							Implement the <code class="literal">getAccessor</code> method that returns a reader object for the aggregation state.
						</p></li><li><p>
							Implement the <code class="literal">getReturnType</code> method that returns information about the type of return values provided by the accessor reader object.
						</p></li><li><p>
							Implement the <code class="literal">getAggregationStateUniqueKey</code> method that provides a key object used by the engine to determine which aggregation functions share state. 
						</p></li><li><p>
							Implement the <code class="literal">getStateFactory</code> method that returns a state factory object that the engine invokes, when required, to instantiate aggregation state holders.
						</p></li></ul></div><p>
					Typically your API returns a handler instance for each aggregation function in an EPL statement expression.
				</p><p>
					In the Cycle-Detect example, the class <code class="literal">CycleDetectorAggregationHandler</code> is the handler for all aggregation functions.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class CycleDetectorAggregationHandler implements PlugInAggregationMultiFunctionHandler { ...</pre><p>
				  The <code class="literal">getAccessor</code> methods return a reader object according to whether the aggregation function name is <code class="literal">cycledetected</code> or <code class="literal">cycleoutput</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public AggregationAccessor getAccessor() {
  if (validationContext.getFunctionName().toLowerCase().equals(CycleDetectorConstant.CYCLEOUTPUT_NAME)) {
    return new CycleDetectorAggregationAccessorOutput();
  }
  return new CycleDetectorAggregationAccessorDetect();
}</pre><p>
				  The <code class="literal">getReturnType</code> method provided by the handler instructs the engine about the return type of each aggregation accessor.
				  The class <code class="literal">com.espertech.esper.client.util.ExpressionReturnType</code> holds return type information.
				</p><p>
					In the Cycle-Detect example the <code class="literal">cycledetected</code> function returns a single boolean value. The <code class="literal">cycleoutput</code> returns a collection of vertices:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public ExpressionReturnType getReturnType() {
  if (validationContext.getFunctionName().toLowerCase().equals(CycleDetectorConstant.CYCLEOUTPUT_NAME)) {
    return ExpressionReturnType.collectionOfSingleValue(factory.getFromExpression().getType());
  }
  return ExpressionReturnType.singleValue(Boolean.class) ;
}</pre><p>
					The engine invokes the <code class="literal">getAggregationStateUniqueKey</code> method to determine whether multiple aggregation function expressions
					in the same statement can share the same aggregation state or should receive different aggregation state instances.
				</p><p>
					The <code class="literal">getAggregationStateUniqueKey</code> method must return an instance of <code class="literal">AggregationStateKey</code>.
					The engine uses equals-semantics (the <code class="literal">hashCode</code> and <code class="literal">equals</code> methods) to determine whether multiple aggregation function share the state object.
					If the key object returned for each aggregation function by the handler is an equal key object then the engine shares aggregation 
					state between such aggregation functions for the same statement and context partition.
				</p><p>
				  In the Cycle-Detect example the state is shared, which it achieves by simply returning the same key instance:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">private static final AggregationStateKey CYCLE_KEY = new AggregationStateKey() {};

public AggregationStateKey getAggregationStateUniqueKey() {
  return CYCLE_KEY;   // Share the same aggregation state instance
}</pre><p>
				  The engine invokes the <code class="literal">getStateFactory</code> method to obtain an instance of <code class="literal">PlugInAggregationMultiFunctionStateFactory</code>. The 
				  state factory is responsible to instantiating separate aggregation state instances. If you statement does not have a <code class="literal">group by</code> clause,
				  the engine obtains a single aggregation state from the state factory. If your statement has a <code class="literal">group by</code> clause, the engine obtains
				  an aggregation state instance for each group when it encounters a new group. 
				</p><p>
				  In the Cycle-Detect example the method passes the expression evaluators providing the from-account and to-account expressions to the state factory:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public PlugInAggregationMultiFunctionStateFactory getStateFactory() {
  return new CycleDetectorAggregationStateFactory(factory.getFromExpression(), factory.getToExpression());
}</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-aggregation-multi-statefactory"/>17.5.2.3.Â Implementing an Aggregation Multi-Function State Factory</h4></div></div></div><p>
					An aggregation multi-function state factory class must implement the <code class="literal">PlugInAggregationMultiFunctionStateFactory</code> interface and is responsible for the following functions:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							Implement the <code class="literal">makeAggregationState</code> method that returns an aggregation state holder.
						</p></li></ul></div><p>
					The engine invokes the <code class="literal">makeAggregationState</code> method to obtain a new aggregation state instance before applying aggregation state. 
					If using <code class="literal">group by</code> in your statement, the engine invokes the <code class="literal">makeAggregationState</code> method to obtain a state holder for each group.
				</p><p>
					In the Cycle-Detect example, the class <code class="literal">CycleDetectorAggregationStateFactory</code> is the state factory for all aggregation functions:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class CycleDetectorAggregationStateFactory implements PlugInAggregationMultiFunctionStateFactory {
  private final ExprEvaluator fromEvaluator;
  private final ExprEvaluator toEvaluator;

  public CycleDetectorAggregationStateFactory(ExprEvaluator fromEvaluator, ExprEvaluator toEvaluator) {
    this.fromEvaluator = fromEvaluator;
    this.toEvaluator = toEvaluator;
  }

  public AggregationState makeAggregationState(PlugInAggregationMultiFunctionStateContext stateContext) {
    return new CycleDetectorAggregationState(this);
  }

  public ExprEvaluator getFromEvaluator() {
    return fromEvaluator;
  }

  public ExprEvaluator getToEvaluator() {
    return toEvaluator;
  }
}</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-aggregation-multi-state"/>17.5.2.4.Â Implementing an Aggregation Multi-Function State</h4></div></div></div><p>
					An aggregation multi-function state class must implement the <code class="literal">AggregationState</code> interface and is responsible for the following functions:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							Implement the <code class="literal">applyEnter</code> method that enters events, event properties or computed values.
						</p></li><li><p>
							Optionally implement the <code class="literal">applyLeave</code> method that can remove events or computed values.
						</p></li><li><p>
							Implement the <code class="literal">clear</code> method to clear state. 
						</p></li></ul></div><p>
					In the Cycle-Detect example, the class <code class="literal">CycleDetectorAggregationState</code> is the state for all aggregation functions.
					Please review the example for more information.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-aggregation-multi-accessor"/>17.5.2.5.Â Implementing an Aggregation Multi-Function Accessor</h4></div></div></div><p>
					An aggregation multi-function accessor class must implement the <code class="literal">AggregationAccessor</code> interface and is responsible for the following functions:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							Implement the <code class="literal">Object getValue(AggregationState state)</code> method that returns a result object for the aggregation state.
						</p></li><li><p>
							Implement the <code class="literal">Collection&lt;EventBean&gt; getEnumerableEvents(AggregationState state)</code> method that returns a collection of events for enumeration,
							if applicable (or null).
						</p></li><li><p>
							Implement the <code class="literal">EventBean getEnumerableEvent(AggregationState state)</code> method that returns an event, if applicable (or null).
						</p></li></ul></div><p>
					In the Cycle-Detect example, the class <code class="literal">CycleDetectorAggregationAccessorDetect</code> returns state for the <code class="literal">cycledetected</code> aggregation function
					and the <code class="literal">CycleDetectorAggregationAccessorOutput</code> returns the state for the <code class="literal">cycleoutput</code> aggregation function.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-aggregation-multi-config"/>17.5.2.6.Â Configuring the Aggregation Multi-Function Name</h4></div></div></div><p> 
				  An aggregation multi-function configuration can receive one or multiple function names. You must also set a factory class name.
				</p><p>
				  The sample XML snippet below configures an aggregation multi-function that is associated with the function names <code class="literal">func1</code> and <code class="literal">func2</code>.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;esper-configuration
  &lt;plugin-aggregation-multifunction 
      function-names="cycledetected,cycleoutput"   // a comma-separated list of function name
      factory-class="com.espertech.esper.example.cycledetect.CycleDetectorAggregationFactory"/&gt;
&lt;/esper-configuration&gt;</pre><p>
				  The next example uses the runtime configuration API to register the same:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String[] functionNames = new String[] {"cycledetected", "cycleoutput"};
ConfigurationPlugInAggregationMultiFunction config = new ConfigurationPlugInAggregationMultiFunction(functionNames, CycleDetectorAggregationFactory.class.getName());
engine.getEPAdministrator().getConfiguration().addPlugInAggregationMultiFunction(config);</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-aggregation-multi-threadsafety"/>17.5.2.7.Â Aggregation Multi-Function Thread Safety</h4></div></div></div><p>
					The engine shares an <code class="literal">AggregationAccessor</code> instance between threads. The accessor should be designed stateless and should not use any locking of any kind
					in the <code class="literal">AggregationAccessor</code> implementation unless your implementation uses other state.
					Since the engine passes an aggregation state instance to the accessor it is thread-safe as long as it relies only on the aggregation state passed to it.
				</p><p>
					The engine does not share an <code class="literal">AggregationState</code> instance between threads. There is no need to use locking of any kind 
					in the <code class="literal">AggregationState</code> implementation unless your implementation uses other state.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-aggregation-multi-table"/>17.5.2.8.Â Aggregation Multi-Function Use With Tables</h4></div></div></div><p>
					Tables allow columns to hold aggregation state including the state for multi-function aggregations. This section provides API pointers.
				</p><p>
					When an EPL statement accesses a table column that declares aggregation state of a multi-function aggregation, the 
					<code class="literal">PlugInAggregationMultiFunctionValidationContext</code> contains an <code class="literal">optionalTableColumnAccessed</code> field that provides information
					about the table column.
				</p><p>
					To find out the statement type, such as to determine whether the current statement is a <code class="literal">create-table</code> statement, use 
					<code class="literal">context.getValidationContext().getExprEvaluatorContext().getStatementType()</code>.
				</p><p>
					To find out whether the statement aggregates into a table, use <code class="literal">context.getValidationContext().getIntoTableName()</code> that returns the table name or null if not aggregating into a table.
				</p><p>
					The engine uses <code class="literal">AggregationStateKey</code> to determine whether an aggregation function listed with <code class="literal">into table</code> is compatible with the aggregation type 
					that a table column declares. The <code class="literal">equals</code> method of the object must return true for compatible and false for incompatible.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-aggregation-multi-filter"/>17.5.2.9.Â Aggregation Multi-Function Use Filter Expression</h4></div></div></div><p>
					The <code class="literal">filter</code> expression is passed to you in <code class="literal">PlugInAggregationMultiFunctionValidationContext</code> as part of <code class="literal">getNamedParameters</code> under the name <code class="literal">filter</code>. When use with tables the filter expression is part of <code class="literal">PlugInAggregationMultiFunctionAgentContext</code>.
				</p><p>
					Your application must invoke the filter expression as the engine does not evaluate the filter expression for you. For example:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">ExprEvaluator filterEval = validationContext.getNamedParameters().get("filter").get(0).getExprEvaluator();</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void applyEnter(EventBean[] eventsPerStream, ExprEvaluatorContext exprEvaluatorContext) {
  Boolean pass = (Boolean) filterEval.evaluate(eventsPerStream, true, exprEvaluatorContext); // note: pass "false" for applyLeave
  if (pass != null &amp;&amp; pass) {
    Object value = valueEval.evaluate(eventsPerStream, true, exprEvaluatorContext); // note: pass "false" for applyLeave
    // do something
  }
}</pre></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="custom-pattern-guard"/>17.6.Â Pattern Guard</h2></div></div></div><a id="d0e45853" class="indexterm"/><a id="d0e45858" class="indexterm"/><p>
			Pattern guards are pattern objects that control the lifecycle of the guarded sub-expression, and can filter the events fired by the subexpression. 
        </p><p>
			The following steps are required to develop and use a custom guard object with Esper. 
        </p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					Implement a guard factory class, responsible for creating guard object instances.
				</p></li><li><p>
					Implement a guard class.
				</p></li><li><p>
					Register the guard factory class with the engine by supplying a namespace and name, via the engine configuration file or the configuration API.
				</p></li></ol></div><p>
			The code for the example guard object as shown in this chapter can be found in the test source folder in the package <code class="literal">com.espertech.esper.regression.client</code> by the name <code class="literal">MyCountToPatternGuardFactory</code>. The sample guard discussed here counts the number of events occurring up to a maximum number of events, and end the sub-expression when that maximum is reached.
        </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-pattern-guard-factory-implementing"/>17.6.1.Â Implementing a Guard Factory</h3></div></div></div><p>
				A guard factory class is responsible for the following functions:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						Implement a <code class="literal">setGuardParameters</code> method that takes guard parameters, which are themselves expressions.
					</p></li><li><p>
						Implement a <code class="literal">makeGuard</code> method that constructs a new guard instance.
					</p></li></ul></div><p>
				Guard factory classes subclass <code class="literal">com.espertech.esper.pattern.guard.GuardFactorySupport</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyCountToPatternGuardFactory extends GuardFactorySupport { ...</pre><p>
				The engine constructs one instance of the guard factory class for each time the guard is listed in a statement. 
			</p><p>
				The guard factory class implements the <code class="literal">setGuardParameters</code> method that is passed the parameters to the guard as supplied by the statement. It verifies the guard parameters, similar to the code snippet shown next. Our example counter guard takes a single numeric parameter:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void setGuardParameters(List&lt;ExprNode&gt; guardParameters, 
			MatchedEventConvertor convertor) throws GuardParameterException {
    String message = "Count-to guard takes a single integer-value expression as parameter";
    if (guardParameters.size() != 1) {
        throw new GuardParameterException(message);
    }

    if (guardParameters.get(0).getExprEvaluator().getType() != Integer.class) {
        throw new GuardParameterException(message);
    }

    this.numCountToExpr = guardParameters.get(0);
    this.convertor = convertor;
}</pre><p>
				The <code class="literal">makeGuard</code> method is called by the engine to create a new guard instance. The example <code class="literal">makeGuard</code> method shown below passes the maximum count of events to the guard instance. It also passes a <code class="literal">Quitable</code> implementation to the guard instance. The guard uses <code class="literal">Quitable</code> to indicate that the sub-expression contained within must stop (quit) listening for events.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public Guard makeGuard(PatternAgentInstanceContext context,
      MatchedEventMap beginState, 
      Quitable quitable, 
      Object stateNodeId, 
      Object guardState) {
      
    Object parameter = PatternExpressionUtil.evaluate("Count-to guard", 
        beginState, numCountToExpr, convertor);
    if (parameter == null) {
        throw new EPException("Count-to guard parameter evaluated to a null value");
    }

    Integer numCountTo = (Integer) parameter;
    return new MyCountToPatternGuard(numCountTo, quitable);
}</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-pattern-guard-implementing"/>17.6.2.Â Implementing a Guard Class</h3></div></div></div><p>
				A guard class has the following responsibilities:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						Provides a <code class="literal">startGuard</code> method that initalizes the guard.
					</p></li><li><p>
						Provides a <code class="literal">stopGuard</code> method that stops the guard, called by the engine when the whole pattern is stopped, or the sub-expression containing the guard is stopped.
					</p></li><li><p>
						Provides an <code class="literal">inspect</code> method that the pattern engine invokes to determine if the guard lets matching events pass for further evaluation by the containing expression.
					</p></li></ul></div><p>
				Guard classes subclass <code class="literal">com.espertech.esper.pattern.guard.GuardSupport</code> as shown here:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public abstract class GuardSupport implements Guard { ...</pre><p>
				The engine invokes the guard factory class to construct an instance of the guard class for each new sub-expression instance within a statement.
			</p><p>
				A guard class must provide an implementation of the <code class="literal">startGuard</code> method that the pattern engine invokes to start a guard instance. In our example, the method resets the guard's counter to zero:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void startGuard() {
  counter = 0;
}</pre><p>
				The pattern engine invokes the <code class="literal">inspect</code> method for each time the sub-expression indicates a new event result. Our example guard needs to count the number of events matched, and quit if the maximum number is reached:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public boolean inspect(MatchedEventMap matchEvent) {
  counter++;
  if (counter &gt; numCountTo) {
    quitable.guardQuit();
    return false;
  }
  return true;
}</pre><p>
				The <code class="literal">inspect</code> method returns true for events that pass the guard, and false for events that should not pass the guard.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-pattern-guard-config"/>17.6.3.Â Configuring Guard Namespace and Name</h3></div></div></div><p>
				The guard factory class name as well as the namespace and name for the new guard must be added to the engine configuration via the configuration API or using the XML configuration file. The configuration shown below is XML however the same options are available through the configuration API:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;esper-configuration
  &lt;plugin-pattern-guard namespace="myplugin" name="count_to" 
      factory-class="com.espertech.esper.regression.client.MyCountToPatternGuardFactory"/&gt;
&lt;/esper-configuration&gt;</pre><p>
				The new guard is now ready to use in a statement. The next pattern statement detects the first 10 MyEvent events:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern [(every MyEvent) where myplugin:count_to(10)]</pre><p>
				Note that the <code class="literal">every</code> keyword was placed within parentheses to ensure the guard controls the repeated matching of events.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="custom-pattern-observer"/>17.7.Â Pattern Observer</h2></div></div></div><a id="d0e46006" class="indexterm"/><a id="d0e46011" class="indexterm"/><p>
			Pattern observers are pattern objects that are executed as part of a pattern expression and can observe events or test conditions. Examples for built-in observers are <code class="literal">timer:at</code> and <code class="literal">timer:interval</code>. Some suggested uses of observer objects are: 
        </p><div class="itemizedlist"><ul compact="compact"><li><p>
					Implement custom scheduling logic using the engine's own scheduling and timer services
				</p></li><li><p>
					Test conditions related to prior events matching an expression
				</p></li></ul></div><p>
			The following steps are required to develop and use a custom observer object within pattern statements: 
        </p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					Implement an observer factory class, responsible for creating observer object instances.
				</p></li><li><p>
					Implement an observer class.
				</p></li><li><p>
					Register an observer factory class with the engine by supplying a namespace and name, via the engine configuration file or the configuration API.
				</p></li></ol></div><p>
			The code for the example observer object as shown in this chapter can be found in the test source folder in package <code class="literal">com.espertech.esper.regression.client</code> by the name <code class="literal">MyFileExistsObserver</code>. The sample observer discussed here very simply checks if a file exists, using the filename supplied by the pattern statement, and via the <code class="literal">java.io.File</code> class.
        </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-pattern-observer-factory-implementing"/>17.7.1.Â Implementing an Observer Factory</h3></div></div></div><p>
				An observer factory class is responsible for the following functions:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						Implement a <code class="literal">setObserverParameters</code> method that takes observer parameters, which are themselves expressions.
					</p></li><li><p>
						Implement a <code class="literal">makeObserver</code> method that constructs a new observer instance.
					</p></li></ul></div><p>
				Observer factory classes subclass <code class="literal">com.espertech.esper.pattern.observer.ObserverFactorySupport</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyFileExistsObserverFactory extends ObserverFactorySupport { ...</pre><p>
				The engine constructs one instance of the observer factory class for each time the observer is listed in a statement. 
			</p><p>
				The observer factory class implements the <code class="literal">setObserverParameters</code> method that is passed the parameters to the observer as supplied by the statement. It verifies the observer parameters, similar to the code snippet shown next. Our example file-exists observer takes a single string parameter:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void setObserverParameters(List&lt;ExprNode&gt; expressionParameters, 
			MatchedEventConvertor convertor, ExprValidationContext validationContext) throws ObserverParameterException {
    String message = "File exists observer takes a single string filename parameter";
    if (expressionParameters.size() != 1) {
	    throw new ObserverParameterException(message);
    }
    if (!(expressionParameters.get(0).getExprEvaluator().getType() == String.class)) {
	    throw new ObserverParameterException(message);
    }

    this.filenameExpression = expressionParameters.get(0);
    this.convertor = convertor;
}</pre><p>
				The pattern engine calls the <code class="literal">makeObserver</code> method to create a new observer instance. The example <code class="literal">makeObserver</code> method shown below passes parameters to the observer instance:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public EventObserver makeObserver(PatternAgentInstanceContext context,
			MatchedEventMap beginState, 
			ObserverEventEvaluator observerEventEvaluator, 
			Object stateNodeId, 
			Object observerState) {
    Object filename = PatternExpressionUtil.evaluate("File-exists observer ", beginState, filenameExpression, convertor);
    if (filename == null) {
	    throw new EPException("Filename evaluated to null");
    }

    return new MyFileExistsObserver(beginState, observerEventEvaluator, filename.toString());
}</pre><p>
				The <code class="literal">ObserverEventEvaluator</code> parameter allows an observer to indicate events, and to indicate change of truth value to permanently false. Use this interface to indicate when your observer has received or witnessed an event, or changed it's truth value to true or permanently false.
			</p><p>
				The <code class="literal">MatchedEventMap</code> parameter provides a Map of all matching events for the expression prior to the observer's start. For example, consider a pattern as below:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">a=MyEvent -&gt; myplugin:my_observer(...)</pre><p>
				The above pattern tagged the MyEvent instance with the tag "a". The pattern engine starts an instance of <code class="literal">my_observer</code> when it receives the first MyEvent. The observer can query the <code class="literal">MatchedEventMap</code> using  "a" as a key and obtain the tagged event.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-pattern-observer-implementing"/>17.7.2.Â Implementing an Observer Class</h3></div></div></div><p>
				An observer class has the following responsibilities:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						Provides a <code class="literal">startObserve</code> method that starts the observer.
					</p></li><li><p>
						Provides a <code class="literal">stopObserve</code> method that stops the observer, called by the engine when the whole pattern is stopped, or the sub-expression containing the observer is stopped.
					</p></li></ul></div><p>
				Observer classes subclass <code class="literal">com.espertech.esper.pattern.observer.ObserverSupport</code> as shown here:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyFileExistsObserver implements EventObserver { ...</pre><p>
				The engine invokes the observer factory class to construct an instance of the observer class for each new sub-expression instance within a statement.
			</p><p>
				An observer class must provide an implementation of the <code class="literal">startObserve</code> method that the pattern engine invokes to start an observer instance. In our example, the observer checks for the presence of a file and indicates the truth value to the remainder of the expression:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public void startObserve() {
  File file = new File(filename);
  if (file.exists()) {
    observerEventEvaluator.observerEvaluateTrue(beginState);
  } 
  else {
    observerEventEvaluator.observerEvaluateFalse(); 
  }
}</pre><p>
				Note the observer passes the <code class="literal">ObserverEventEvaluator</code> an instance of <code class="literal">MatchedEventMap</code>. The observer can also create one or more new events and pass these events through the Map to the remaining expressions in the pattern.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-pattern-observer-config"/>17.7.3.Â Configuring Observer Namespace and Name</h3></div></div></div><p>
				The observer factory class name as well as the namespace and name for the new observer must be added to the engine configuration via the configuration API or using the XML configuration file. The configuration shown below is XML however the same options are available through the configuration API:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;esper-configuration
  &lt;plugin-pattern-observer namespace="myplugin" name="file_exists" 
    factory-class="com.espertech.esper.regression.client.MyFileExistsObserverFactory" /&gt;
&lt;/esper-configuration&gt;</pre><p>
				The new observer is now ready to use in a statement. The next pattern statement checks every 10 seconds if the given file exists, and indicates to the listener when the file is found.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern [every timer:interval(10 sec) -&gt; myplugin:file_exists("myfile.txt")]</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="custom-event-representation"/>17.8.Â Event Type and Event Object</h2></div></div></div><a id="d0e46174" class="indexterm"/><a id="d0e46179" class="indexterm"/><p>
			Creating a plug-in event representation can be useful under any of these conditions:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					Your application has existing Java classes that carry event metadata and event property values and your application does not want to (or cannot) extract or transform such event metadata and event data into one of the built-in event representations (POJO Java objects, Map or XML DOM).
				</p></li><li><p>
					Your application wants to provide a faster or short-cut access path to event data, for example to access XML event data through a Streaming API for XML (StAX).
				</p></li><li><p>
					Your application must perform a network lookup or other dynamic resolution of event type and events.
				</p></li></ul></div><p>
			Note that the classes to plug-in custom event representations are held stable between minor releases, but can be subject to change between major releases. 
		</p><p>
			Currently, EsperIO provides the following additional event representations:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					Apache Axiom provides access to XML event data on top of the fast Streaming API for XML (StAX). 
				</p></li></ul></div><p>
			The source code is available for these and they are therefore excellent examples for how to implement a plug-in event representation.
			Please see the EsperIO documentation for usage details.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-eventrep-overview"/>17.8.1.Â How It Works</h3></div></div></div><p>
				Your application provides a plug-in event representation as an implementation of the <code class="literal">com.espertech.esper.plugin.PlugInEventRepresentation</code> interface. It registers the implementation class in the
				<code class="literal">Configuration</code> and at the same time provides a unique URI. This URI is called the root event representation URI. An example value for a root URI is <code class="literal">type://xml/apacheaxiom/OMNode</code>. 
			</p><p>
				One can register multiple plug-in event representations. Each representation has a root URI. The root URI serves to divide the overall space of different event representations and plays a role in resolving event types and event objects.
			</p><p>
				There are two situations in an Esper engine instance asks an event representation for an event type:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						When an application registers a new event type using the method <code class="literal">addPlugInEventType</code> on <code class="literal">ConfigurationOperations</code>, either at runtime or at configuration time.
					</p></li><li><p>
						When an EPL statement is created with a new event type name (a name not seen before) and the URIs for resolving such names are set beforehand via <code class="literal">setPlugInEventTypeNameResolutionURIs</code> on <code class="literal">ConfigurationOperations</code>.
					</p></li></ol></div><p>
				The implementation of the <code class="literal">PlugInEventRepresentation</code> interface must provide implementations for two key interfaces: <code class="literal">com.espertech.esper.client.EventType</code> and <code class="literal">EventBean</code>. It must also implement several other related interfaces as described below.
			</p><p>
				The <code class="literal">EventType</code> methods provide event metadata including property names and property types. They also provide instances of <code class="literal">EventPropertyGetter</code> for retrieving event property values. Each instance of <code class="literal">EventType</code> represents a distinct type of event.
			</p><p>
				The <code class="literal">EventBean</code> implementation is the event itself and encapsulates the underlying event object.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-eventrep-steps"/>17.8.2.Â Steps</h3></div></div></div><p>
				Follow the steps outlined below to process event objects for your event types:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						Implement the <code class="literal">EventType</code>, <code class="literal">EventPropertyGetter</code> and <code class="literal">EventBean</code> interfaces.
					</p></li><li><p>
						Implement the <code class="literal">PlugInEventRepresentation</code> interface, the <code class="literal">PlugInEventTypeHandler</code> and <code class="literal">PlugInEventBeanFactory</code> interfaces, then add the <code class="literal">PlugInEventRepresentation</code> class name to configuration.
					</p></li><li><p>
						Register plug-in event types, and/or set the event type name resolution URIs, via configuration.
					</p></li><li><p>
						Obtain an <code class="literal">EventSender</code> from <code class="literal">EPRuntime</code> via the <code class="literal">getEventSender(URI[])</code> method and use that to send in your event objects.
					</p></li></ol></div><p>
				Please consult the JavaDoc for further information on each of the interfaces and their respective methods. The Apache Axiom event representation is an example implementation that can be found in the 
				EsperIO packages.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-eventrep-uriresolution"/>17.8.3.Â URI-Based Resolution</h3></div></div></div><p>
				Assume you have registered event representations using the following URIs:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
						type://myFormat/myProject/myName
					</p></li><li><p>
						type://myFormat/myProject
					</p></li><li><p>
						type://myFormat/myOtherProject
					</p></li></ol></div><p>
				When providing an array of child URIs for resolution, the engine compares each child URI to each of the event representation root URIs, in the order provided. Any event representation root URIs that 
				spans the child URI space becomes a candidate event representation. If multiple root URIs match, the order is defined by the more specific root URI first, to the least specific root URI last.
			</p><p>
				During event type resolution and event sender resolution you provide a child URI. Assuming the child URI provided is <code class="literal">type://myFormat/myProject/myName/myEvent?param1=abc&amp;param2=true</code>. In this example both root URIs #1 (the more specific) and #1 (the less specific) match, while root URI #3 is not a match. Thus at the time of type resolution the engine invokes the <code class="literal">acceptType</code> method on event presentation for URI #1 first (the more specific), before asking #2 (the less specific) to resolve the type.
			</p><p>			    
				The <code class="literal">EventSender</code> returned by the <code class="literal">getEventSender(URI[])</code> method follows the same scheme. The event sender instance asks each matching event representation for each URI to resolve the event object in the order of most specific to least specific root URI, and the first event representation to return an instance of <code class="literal">EventBean</code> ends the resolution process for event objects.
			</p><p>
				The <code class="literal">type://</code> part of the URI is an optional convention for the scheme part of an URI that your application may follow. URIs can also be simple names and can include parameters, as the Java software JavaDoc documents for class <code class="literal">java.net.URI</code>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="custom-eventrep-example"/>17.8.4.Â Example</h3></div></div></div><p>
					This section implements a minimal sample plug-in event representation. For the sake of keeping the example easy to understand, the event representation is rather straightforward: an event is a <code class="literal">java.util.Properties</code> object that consists of key-values pairs of type string.
				</p><p>
					The code shown next does not document method footprints. Please consult the JavaDoc API documentation for method details.
				</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-eventrep-example-eventtype"/>17.8.4.1.Â Sample Event Type</h4></div></div></div><p>
					First, the sample shows how to implement the <code class="literal">EventType</code> interface. The event type provides information about property names and types, as well as supertypes of the event type.
				</p><p>
					Our <code class="literal">EventType</code> takes a set of valid property names:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyPlugInPropertiesEventType implements EventType {
  private final Set&lt;String&gt; properties;

  public MyPlugInPropertiesEventType(Set&lt;String&gt; properties) {
    this.properties = properties;
  }

  public Class getPropertyType(String property) {
    if (!isProperty(property)) {
      return null;
    }
    return String.class;
  }

  public Class getUnderlyingType() {
    return Properties.class;
  }
  
  //... further methods below
}</pre><p>
					An <code class="literal">EventType</code> is responsible for providing implementations of <code class="literal">EventPropertyGetter</code> to query actual events. The getter simply
					queries the <code class="literal">Properties </code> object underlying each event:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">  public EventPropertyGetter getGetter(String property) {
    final String propertyName = property;
    
    return new EventPropertyGetter() {
      public Object get(EventBean eventBean) throws PropertyAccessException {
        MyPlugInPropertiesEventBean propBean = (MyPlugInPropertiesEventBean) eventBean;
        return propBean.getProperties().getProperty(propertyName);
      }
      
      public boolean isExistsProperty(EventBean eventBean) {
        MyPlugInPropertiesEventBean propBean = (MyPlugInPropertiesEventBean) eventBean;
        return propBean.getProperties().getProperty(propertyName) != null;
      }
      
      public Object getFragment(EventBean eventBean) {
	    return null;	// The property is not a fragment
      }
    };
  }</pre><p>
				  Our sample <code class="literal">EventType</code> does not have supertypes. Supertypes represent an extends-relationship between event types, and subtypes are expected to exhibit the same event property names and types as each of their supertypes combined:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">  public EventType[] getSuperTypes() {
    return null;	// no supertype for this example
  }

  public Iterator&lt;EventType&gt; getDeepSuperTypes() {
    return null;
  }
  
  public String getName() {
    return name;
  }

  public EventPropertyDescriptor[] getPropertyDescriptors() {
    Collection&lt;EventPropertyDescriptor&gt; descriptorColl = descriptors.values();
    return descriptorColl.toArray(new EventPropertyDescriptor[descriptors.size()]);
  }

  public EventPropertyDescriptor getPropertyDescriptor(String propertyName) {
    return descriptors.get(propertyName);
  }

  public FragmentEventType getFragmentType(String property) {
    return null;  // sample does not provide any fragments
  }</pre><p>
			The example event type as above does not provide fragments, which are properties of the event that can themselves be represented as an event, to keep the example simple.
		  </p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-eventrep-example-eventbean"/>17.8.4.2.Â Sample Event Bean</h4></div></div></div><p>
					Each <code class="literal">EventBean</code> instance represents an event. The interface is straightforward to implement. In this example an event is backed by a <code class="literal">Properties</code> object:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyPlugInPropertiesEventBean implements EventBean {
  private final MyPlugInPropertiesEventType eventType;
  private final Properties properties;

  public MyPlugInPropertiesEventBean(MyPlugInPropertiesEventType eventType, 
        Properties properties) {
    this.eventType = eventType;
    this.properties = properties;
  }

  public EventType getEventType() {
    return eventType;
  }

  public Object get(String property) throws PropertyAccessException {
    EventPropertyGetter getter = eventType.getGetter(property);
    return getter.get(this);
  }

  public Object getFragment(String property) {
    EventPropertyGetter getter = eventType.getGetter(property);
    if (getter != null) {
      return getter.getFragment(this);
    }
    return null;
  }

  public Object getUnderlying() {
    return properties;
  }

  protected Properties getProperties() {
    return properties;
  }    
}</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-eventrep-example-eventrep"/>17.8.4.3.Â Sample Event Representation</h4></div></div></div><p>
					A <code class="literal">PlugInEventRepresentation</code> serves to create <code class="literal">EventType</code> and <code class="literal">EventBean</code> instances through its related interfaces.
				</p><p>
					The sample event representation creates <code class="literal">MyPlugInPropertiesEventType</code> and <code class="literal">MyPlugInPropertiesEventBean</code> instances. 
					The <code class="literal">PlugInEventTypeHandler</code> returns the <code class="literal">EventType</code> instance and an <code class="literal">EventSender</code> instance.
				</p><p>
					Our sample event representation accepts all requests for event types by returning boolean true on the <code class="literal">acceptType</code> method.  When asked for the <code class="literal">PlugInEventTypeHandler</code>, it constructs a new <code class="literal">EventType</code>. The list of property names for the new type is passed as an initialization value provided through the configuration API or XML, as a comma-separated list of property names:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyPlugInEventRepresentation implements PlugInEventRepresentation {

  private List&lt;MyPlugInPropertiesEventType&gt; types;

  public void init(PlugInEventRepresentationContext context) {
    types = new ArrayList&lt;MyPlugInPropertiesEventType&gt;();
  }

  public boolean acceptsType(PlugInEventTypeHandlerContext context) {
    return true;
  }

  public PlugInEventTypeHandler getTypeHandler(PlugInEventTypeHandlerContext eventTypeContext) {
    String proplist = (String) eventTypeContext.getTypeInitializer();
    String[] propertyList = proplist.split(",");

    Set&lt;String&gt; typeProps = new HashSet&lt;String&gt;(Arrays.asList(propertyList));

    MyPlugInPropertiesEventType eventType = new MyPlugInPropertiesEventType(typeProps);
    types.add(eventType);

    return new MyPlugInPropertiesEventTypeHandler(eventType);
  }
  // ... more methods below
}</pre><p>
					The <code class="literal">PlugInEventTypeHandler</code> simply returns the <code class="literal">EventType</code> as well as an implementation of <code class="literal">EventSender</code> for processing same-type events:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyPlugInPropertiesEventTypeHandler implements PlugInEventTypeHandler {
  private final MyPlugInPropertiesEventType eventType;

  public MyPlugInPropertiesEventTypeHandler(MyPlugInPropertiesEventType eventType) {
    this.eventType = eventType;
  }

  public EventSender getSender(EPRuntimeEventSender runtimeEventSender) {
    return new MyPlugInPropertiesEventSender(eventType, runtimeEventSender);
  }

  public EventType getType() {
    return eventType;
  }
}</pre><p>
					The <code class="literal">EventSender</code> returned by <code class="literal">PlugInEventTypeHandler</code> is expected process events of the same type or any subtype:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyPlugInPropertiesEventSender implements EventSender {
  private final MyPlugInPropertiesEventType type;
  private final EPRuntimeEventSender runtimeSender;

  public MyPlugInPropertiesEventSender(MyPlugInPropertiesEventType type, 
        EPRuntimeEventSender runtimeSender) {
    this.type = type;
    this.runtimeSender = runtimeSender;
  }

  public void sendEvent(Object event) {
    if (!(event instanceof Properties)) {
       throw new EPException("Sender expects a properties event");
    }
    EventBean eventBean = new MyPlugInPropertiesEventBean(type, (Properties) event);
    runtimeSender.processWrappedEvent(eventBean);
  }
}</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="custom-eventrep-example-eventbeanfac"/>17.8.4.4.Â Sample Event Bean Factory</h4></div></div></div><p>
					The plug-in event representation may optionally provide an implementation of <code class="literal">PlugInEventBeanFactory</code>. A <code class="literal">PlugInEventBeanFactory</code> may inspect event objects and assign an event type dynamically based on resolution URIs and event properties.
				</p><p>
					Our sample event representation accepts all URIs and returns a <code class="literal">MyPlugInPropertiesBeanFactory</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyPlugInEventRepresentation implements PlugInEventRepresentation {

  // ... methods as seen earlier
  public boolean acceptsEventBeanResolution(
        PlugInEventBeanReflectorContext eventBeanContext) {
    return true;
  }

  public PlugInEventBeanFactory getEventBeanFactory(
        PlugInEventBeanReflectorContext eventBeanContext) {
    return new MyPlugInPropertiesBeanFactory(types);
   }
}</pre><p>
			  Last, the sample <code class="literal">MyPlugInPropertiesBeanFactory</code> implements the <code class="literal">PlugInEventBeanFactory</code> interface. It inspects incoming events and determines
			  an event type based on whether all properties for that event type are present:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyPlugInPropertiesBeanFactory implements PlugInEventBeanFactory {
  private final List&lt;MyPlugInPropertiesEventType&gt; knownTypes;

  public MyPlugInPropertiesBeanFactory(List&lt;MyPlugInPropertiesEventType&gt; types) {
    knownTypes = types;
  }

  public EventBean create(Object event, URI resolutionURI) {
    Properties properties = (Properties) event;

    // use the known types to determine the type of the object
    for (MyPlugInPropertiesEventType type : knownTypes) {
      // if there is one property the event does not contain, then its not the right type
      boolean hasAllProperties = true;
      for (String prop : type.getPropertyNames()) {
        if (!properties.containsKey(prop)) {
          hasAllProperties = false;
          break;
        }
      }

      if (hasAllProperties) {
        return new MyPlugInPropertiesEventBean(type, properties);
      }
    }
    return null; // none match, unknown event
  }
}</pre></div></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="script"/>ChapterÂ 18.Â Script Support</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#script-overview">18.1. Overview</a></span></dt><dt><span class="sect1"><a href="#script-syntax">18.2. Syntax</a></span></dt><dt><span class="sect1"><a href="#script-examples">18.3. Examples</a></span></dt><dt><span class="sect1"><a href="#script-variablevisibility">18.4. Built-In EPL Script Attributes</a></span></dt><dt><span class="sect1"><a href="#script-performance">18.5. Performance Notes</a></span></dt><dt><span class="sect1"><a href="#script-other">18.6. Additional Notes</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="script-overview"/>18.1.Â Overview</h2></div></div></div><a id="d0e46525" class="indexterm"/><a id="d0e46528" class="indexterm"/><a id="d0e46531" class="indexterm"/><a id="d0e46534" class="indexterm"/><a id="d0e46537" class="indexterm"/><a id="d0e46540" class="indexterm"/><a id="d0e46543" class="indexterm"/><p>
			Esper allows the use scripting languages within EPL. You may use scripts for imperative programming to execute certain code as part of EPL processing by the engine.
		</p><p>
		    The syntax and examples outlined below discuss how to declare a script that is visible to the same EPL statement that listed the script.
		</p><p>
			For declaring scripts that are visible across multiple EPL statements i.e. globally visible scripts please consult <a class="xref" href="#create-exprglobal-script" title="5.18.3.Â Global Scripts">SectionÂ 5.18.3, âGlobal Scriptsâ</a> 
			that explains the <code class="literal">create expression</code> clause.
		</p><p>
			Any scripting language that supports JSR 223 and also the MVEL scripting language can be specified in EPL. This section provides MVEL and JavaScript examples.
		</p><p>
			For more information on the MVEL scripting language and its syntax, please refer to 
			the MVEL documentation. MVEL is an expression language that has a natural syntax for Java-based applications and compiles to provide fast execution times. To use MVEL with Esper, please make sure to add the MVEL jar file to the application classpath.
		</p><p>
			For more information on JSR 223 scripting languages, please refer to external resources. As JSR 223 defines a standard API for script engines, your application may use any script engine that implements the API. Current JVM versions ship with a JavaScript script engine. Other script engines such as Groovy, Ruby and Python scripts can be used as implementations of JSR 223.
		</p><p>
		  As an alternative to a script consider providing a custom single row function as described in <a class="xref" href="#custom-singlerow-function" title="17.3.Â Single-Row Function">SectionÂ 17.3, âSingle-Row Functionâ</a>
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="script-syntax"/>18.2.Â Syntax</h2></div></div></div><p>
		The syntax for scripts is:
		</p><pre class="synopsis">expression [<span class="emphasis"><em>return_type</em></span>] [@type(<span class="emphasis"><em>eventtype_name</em></span>)] [<span class="emphasis"><em>dialect_identifier</em></span>:] script_name [ (<span class="emphasis"><em>parameters</em></span>) ] [ script_body ]</pre><p>
		  Use the <code class="literal">expression</code> keyword to declare a script.
		</p><p>
			The <span class="emphasis"><em>return_type</em></span> is optional. If the script declaration provides a return type the engine can perform strong type checking: Any expressions that invoke the script and use the return value are aware of the return type. If no return type is provided the engine assumes the script returns <code class="literal">java.lang.Object</code>.
		</p><p>
			If the return type of the script is <code class="literal">EventBean[]</code> you must provide the <code class="literal">@type(name)</code> annotation after the return type to name the event type of events returned by the script. 
			The <code class="literal">@type</code> is allowed only when the return type is <code class="literal">EventBean</code> instances.
		</p><p>
			The <span class="emphasis"><em>dialect_identifier</em></span> is optional and identifies the scripting language. Use <code class="literal">mvel</code> for MVEL , <code class="literal">js</code> for JavaScript and <code class="literal">python</code> for Python and similar for other JSR 223 scripting languages.
			If no dialect identifier is specified, the default dialect that is configured applies, which is <code class="literal">js</code> unless your application changes the default configuration.
		</p><p>
			It follows the script name. You may use the same script name multiple times and thus overload providing multiple signatures under the same script name. The combination of script name and number of parameters must be unique however.
		</p><p>
		   If you have script parameters, specify the parameter names for the script as a comma-separated list of identifiers in parenthesis. It is not necessary to list parameter types.
		</p><p>
		  The <span class="emphasis"><em>script body</em></span> is the actual MVEL or JavaScript or other scripting language script and is placed in square brackets: <code class="literal">[ ... script body ...]</code>.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="script-examples"/>18.3.Â Examples</h2></div></div></div><p>
			The next example shows an EPL statement that calls a JavaScript script which computes the Fibonacci total for a given number:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression double js:fib(num) [
fib(num);
function fib(n) {
  if(n &lt;= 1)
    return n;
  return fib(n-1) + fib(n-2);
}
]
select fib(intPrimitive) from SupportBean;
</pre><p>
		  The <code class="literal">expression</code> keyword is followed by the return type (<code class="literal">double</code>), the dialect (<code class="literal">js</code>) and the script name (<code class="literal">fib</code>) that declares a single parameter (<code class="literal">num</code>).
		  The JavaScript code that computes the Fibonacci total is between square brackets <code class="literal">[]</code>.
		</p><p>
			The following example shows an EPL statement that calls a MVEL script which outputs all the different colors that are listed in the <code class="literal">colors</code> property of each <code class="literal">ColorEvent</code>:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression mvel:printColors(colors) [
String c = null;
for (c : colors) {
   System.out.println(c);
}
]
select printColors(colors) from ColorEvent;</pre><p>
			This example instead uses JavaScript to print colors and passes the event itself as a script parameter (this example is for Java 8 and Nashorn):
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression js:printColors(colorEvent) [
  print(java.util.Arrays.toString(colorEvent.getColors()));
]
select printColors(colorEvent) from ColorEvent as colorEvent</pre><p>
			The next example creates a globally-visible script that returns <code class="literal">ItemEvent</code> events, 
			assuming that the <code class="literal">ItemEvent</code> event type is an event type defined by <code class="literal">create schema ItemEvent(id string)</code>:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create expression EventBean[] @type(ItemEvent) js:myScriptReturnsEvents() [
myScriptReturnsEvents();
function myScriptReturnsEvents() {
  var EventBeanArray = Java.type(\"com.espertech.esper.client.EventBean[]\");
  var events = new EventBeanArray(1);
  events[0] = epl.getEventBeanService().adapterForMap(java.util.Collections.singletonMap(\"id\", \"id1\"), \"ItemEvent\");
  return events;
}

// sample EPL:
// select myScriptReturnsEvents().where(v =&gt; v.id in ('id1', 'id3')) from MyEvent]</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="script-variablevisibility"/>18.4.Â Built-In EPL Script Attributes</h2></div></div></div><p>
		  The engine provides a built-in script object under the variable name <code class="literal">epl</code> to all scripts. Your scripts may use this script object to share and retain state by setting and reading script attributes.
		  The engine maintains a separate script object per context partition or per statement if not declaring a context. Therefore script attributes are not shared between statements,
		  however multiple scripts executed by the same context partition receive the same script object.
		</p><p>
		  The <code class="literal">epl</code> script object implements the interface <code class="literal">com.espertech.esper.client.hook.EPLScriptContext</code>.
		  Please see the JavaDoc for services provided by <code class="literal">EPLScriptContext</code>.
		</p><p>
		  For script state management, the <code class="literal">EPLScriptContext</code> interface has two methods: The <code class="literal">void setScriptAttribute(String attribute, Object value)</code> method to set an attribute value and the <code class="literal">Object getScriptAttribute(String attribute)</code> method to read an attribute value.
		</p><p>
		  The next example demonstrates the use of the <code class="literal">epl</code> script object. It outputs a flag value <code class="literal">true</code> when an RFID event matched because the location is <code class="literal">A</code>, 
		  and outputs a flag value <code class="literal">false</code> when an RFID event matched because the location is <code class="literal">B</code>. The example works the same for either MVEL or JavaScript dialects: You may simple replace the <code class="literal">js</code> dialect with <code class="literal">mvel</code>.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression boolean js:setFlag(name, value, returnValue) [
  if (returnValue) epl.setScriptAttribute(name, value);
  returnValue;
]
expression js:getFlag(name) [
  epl.getScriptAttribute(name);
]
select getFlag('locA') as flag from RFIDEvent(zone = 'Z1' and
  (setFlag('locA', true, location = 'A') or setFlag('locA', false, location = 'B')) )</pre><p>
		  The example above utilizes two scripts: The <code class="literal">setFlag</code>  script receives an attribute name, attribute value and a return value. The script sets the script attribute only when the return value is true. The  <code class="literal">getFlag</code> script simply returns the script attribute value.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="script-performance"/>18.5.Â Performance Notes</h2></div></div></div><p>
			Upon EPL statement compilation, the engine resolves script parameter types and performs script compilation. At runtime the engine evaluates the script in its compiled form.
		</p><p>
		  As the engine cannot inspect scripts if is not possible for the engine to perform query planning or many optimizations based on the information in scripts. It is thus recommended to structure EPL such that basic filter and join expressions are
		  EPL expressions and not script expressions.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="script-other"/>18.6.Â Additional Notes</h2></div></div></div><p>
		  Your EPL may declare a return type for the script. If no return type is declared and when using the MVEL dialect, the engine will infer the return type from the MVEL expression analysis result. If the return type is not provided and cannot be inferred or the dialect is not MVEL, the return type is <code class="literal">Object</code>.
		</p><p>
		  If the EPL declares a numeric return type then engine performs coercion of the numeric result to the return type that is specified.
		</p><p>
		  In the case that the EPL declares a return type that does not match the type of the actual script return value, the engine does not check return value type.
		</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="spatial"/>ChapterÂ 19.Â EPL Reference: Spatial Methods and Indexes</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#spatial_intro">19.1. Overview</a></span></dt><dt><span class="sect1"><a href="#spatial_method">19.2. Spatial Methods</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spatial_method_pointinsiderectangle">19.2.1. Point-Inside-Rectangle</a></span></dt><dt><span class="sect2"><a href="#spatial_method_rectangleintersectsrectangle">19.2.2. Rectangle-Intersects-Rectangle</a></span></dt></dl></dd><dt><span class="sect1"><a href="#spatial_index">19.3. Spatial Index - Quadtree</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spatial_index_overview">19.3.1. Overview</a></span></dt><dt><span class="sect2"><a href="#spatial_index_pointregionquadtreedeclare">19.3.2. Declaring a Point-Region Quadtree Index</a></span></dt><dt><span class="sect2"><a href="#spatial_index_pointregionquadtreefilterindex">19.3.3. Using a Point-Region Quadtree as a Filter Index</a></span></dt><dt><span class="sect2"><a href="#spatial_index_pointregionquadtreeeventindex">19.3.4. Using a Point-Region Quadtree as an Event Index</a></span></dt><dt><span class="sect2"><a href="#spatial_index_mxcifquadtreedeclare">19.3.5. Declaring a MX-CIF Quadtree Index</a></span></dt><dt><span class="sect2"><a href="#spatial_index_mxcifquadtreefilterindex">19.3.6. Using a MX-CIF Quadtree as a Filter Index</a></span></dt><dt><span class="sect2"><a href="#spatial_index_mxcifquadtreeeventindex">19.3.7. Using a MX-CIF Quadtree as an Event Index</a></span></dt></dl></dd><dt><span class="sect1"><a href="#spatial_etc">19.4. Spatial Types, Functions and Methods from External Libraries</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="spatial_intro"/>19.1.Â Overview</h2></div></div></div><a id="d0e46784" class="indexterm"/><p>
			EPL provides spatial methods and spatial indexes.  
		</p><p>
			The engine analyzes filter criteria and the <code class="literal">where</code>-clause and considers spatial methods, utilizing spatial filter indexes or spatial event indexes for efficient matching and lookup.
		</p><p>
			For general information on the dot-operator please consult <a class="xref" href="#epl-operator-ref-dot" title="9.6.Â Dot Operator">SectionÂ 9.6, âDot Operatorâ</a>.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="spatial_method"/>19.2.Â Spatial Methods</h2></div></div></div><a id="d0e46803" class="indexterm"/><a id="d0e46808" class="indexterm"/><p>
			The below table summarizes the built-in spatial methods available:
		</p><div class="table"><a id="spatial_method_table"/><p class="title"><b>TableÂ 19.1.Â Spatial Methods</b></p><div class="table-contents"><table summary="Spatial Methods" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Method</th><th>Result</th></tr></thead><tbody><tr><td>point(x,y).inside(rectangle(x,y,width,height))</td><td>
							<p>
								Returns true if the point is inside the rectangle.
							</p>
							<p>
								<a class="xref" href="#spatial_method_pointinsiderectangle" title="19.2.1.Â Point-Inside-Rectangle">SectionÂ 19.2.1, âPoint-Inside-Rectangleâ</a>.
							</p>
						</td></tr><tr><td>rectangle(x,y,width,height).intersects(rectangle(x,y,width,height))</td><td>
							<p>
								Returns true if the rectangle intersects with the rectangle.
							</p>
							<p>
								<a class="xref" href="#spatial_method_rectangleintersectsrectangle" title="19.2.2.Â Rectangle-Intersects-Rectangle">SectionÂ 19.2.2, âRectangle-Intersects-Rectangleâ</a>.
							</p>
						</td></tr></tbody></table></div></div><br class="table-break"/><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="spatial_method_pointinsiderectangle"/>19.2.1.Â Point-Inside-Rectangle</h3></div></div></div><p>
				The method compares a point to a rectangle and returns true if the point falls inside the rectangle.
			</p><p>
				The method takes a point as input and a rectangle as a parameter:
			</p><pre class="synopsis">point(<span class="emphasis"><em>point_x</em></span>, <span class="emphasis"><em>point_y</em></span> [, filterindex:<span class="emphasis"><em>configexpression</em></span>]).inside(rectangle(<span class="emphasis"><em>rect_x</em></span>, <span class="emphasis"><em>rect_y</em></span>, <span class="emphasis"><em>width</em></span>, <span class="emphasis"><em>height</em></span>))</pre><p>
				For the point, please provide the <span class="emphasis"><em>point_x</em></span> and <span class="emphasis"><em>point_y</em></span> expressions that return the (x, y)-coordinates of the point. 
				The <code class="literal">filterindex</code> named parameter is for use with filter indexes as described below.
				The left-hand side point can be subject to point-region quadtree indexing (MX-CIF quadtrees do not apply).
			</p><p>
				For the rectangle, the <span class="emphasis"><em>rect_x</em></span> expression and <span class="emphasis"><em>rect_y</em></span> expressions return the (x, y)-coordinates of the rectangle and the <span class="emphasis"><em>width</em></span> expression and <span class="emphasis"><em>height</em></span> expressions return the width and height of the rectangle.
			</p><p>
				All expressions must return a number-type and the implementation compares the <code class="literal">double</code>-values returned by the expressions. 
			</p><p>
				A point is considered inside the rectangle if <code class="literal">(point_x &gt;= rect_x) and (point_x &lt; rect_x + width) and (point_y &gt;= rect_y) and (point_y &lt; rect_y + height)</code>.
			</p><div class="table"><a id="spatial_method_pointinsiderectangle_example"/><p class="title"><b>TableÂ 19.2.Â Point-Inside-Rectangle Examples</b></p><div class="table-contents"><table summary="Point-Inside-Rectangle Examples" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td><pre class="synopsis">point(10, 20).inside(rectangle(0, 0, 50, 50))</pre></td><td>true</td></tr><tr><td><pre class="synopsis">point(10, 20).inside(rectangle(20, 20, 50, 50))</pre></td><td>false</td></tr><tr><td><pre class="synopsis">point(10, 20).inside(rectangle(9, 19, 1, 1))</pre></td><td>false</td></tr><tr><td><pre class="synopsis">point(10, 20).inside(rectangle(9, 19, 1.0001, 1.0001))</pre></td><td>true</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="spatial_method_rectangleintersectsrectangle"/>19.2.2.Â Rectangle-Intersects-Rectangle</h3></div></div></div><p>
				The method compares a rectangle to a rectangle and returns true if the rectangles intersect.
			</p><p>
				The method takes a rectangle as input and a rectangle as a parameter:
			</p><pre class="synopsis">rectangle(<span class="emphasis"><em>rect_x</em></span>, <span class="emphasis"><em>rect_y</em></span>, <span class="emphasis"><em>rect_width</em></span>, <span class="emphasis"><em>rect_height</em></span> [, filterindex:<span class="emphasis"><em>configexpression</em></span>]).intersects(rectangle(<span class="emphasis"><em>other_x</em></span>, <span class="emphasis"><em>other_y</em></span>, <span class="emphasis"><em>other_width</em></span>, <span class="emphasis"><em>other_height</em></span>))</pre><p>
				The left-hand side is the rectangle's <span class="emphasis"><em>rect_x</em></span>, <span class="emphasis"><em>rects_y</em></span>, <span class="emphasis"><em>rect_width</em></span> and <span class="emphasis"><em>rect_height</em></span> expressions 
				that return the (x, y)-coordinates and the size of the rectangle.
				The <code class="literal">filterindex</code> named parameter is for use with filter indexes as described below.
				The left-hand side rectangle can be subject to MX-CIF quadtree indexing (point-region quadtrees do not apply).
			</p><p>
				For the compared-to rectangle on the right-hand side, the <span class="emphasis"><em>other_x</em></span>, <span class="emphasis"><em>other_y</em></span>, <span class="emphasis"><em>other_width</em></span> and <span class="emphasis"><em>other_height</em></span> expressions return the (x, y)-coordinates and size of the compared-to rectangle.
			</p><p>
				All expressions must return a number-type and the implementation compares the <code class="literal">double</code>-values returned by the expressions. 
			</p><p>
				A rectangle is considered to intersect another rectangle if:
			</p><div class="itemizedlist"><ul><li><p><code class="literal">rect_x + rect_width &gt;= other_x</code> (a is not left of b) and</p></li><li><p><code class="literal">rect_x &lt;= other_x + other_width</code> (a is not right of b) and</p></li><li><p><code class="literal">rect_y + rect_height &gt;= other_y</code> (a is not above b) and</p></li><li><p><code class="literal">rect_y &lt;= other_y + other_height</code> (a is not below b).</p></li></ul></div><div class="table"><a id="spatial_method_rectangleintersectsrectangle_example"/><p class="title"><b>TableÂ 19.3.Â Rectangle-Intersects-Rectangle Examples</b></p><div class="table-contents"><table summary="Rectangle-Intersects-Rectangle Examples" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td><pre class="synopsis">rectangle(10, 20, 5, 5).intersects(rectangle(0, 0, 50, 50))</pre></td><td>true</td></tr><tr><td><pre class="synopsis">rectangle(10, 20, 5, 5).intersects(rectangle(20, 20, 50, 50))</pre></td><td>false</td></tr><tr><td><pre class="synopsis">rectangle(10, 20, 5, 5).intersects(rectangle(9, 19, 1, 1))</pre></td><td>true</td></tr><tr><td><pre class="synopsis">rectangle(10, 20, 5, 5).intersects(rectangle(9, 19, 0.999, 0.999))</pre></td><td>false</td></tr><tr><td><pre class="synopsis">rectangle(10, 20, 5, 5).intersects(rectangle(15, 25, 1, 1))</pre></td><td>true</td></tr><tr><td><pre class="synopsis">rectangle(10, 20, 5, 5).intersects(rectangle(15.001, 25.001, 1, 1))</pre></td><td>false</td></tr></tbody></table></div></div><br class="table-break"/></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="spatial_index"/>19.3.Â Spatial Index - Quadtree</h2></div></div></div><a id="d0e47103" class="indexterm"/><a id="d0e47108" class="indexterm"/><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="spatial_index_overview"/>19.3.1.Â Overview</h3></div></div></div><p>
				A quadtree is a tree data structure in which each branch node has exactly four children. 
				Quadtrees are often used to partition a two-dimensional space by recursively subdividing it into four quadrants or regions (source:WikiPedia).			
			</p><p>
				Quadtree indexes can be used for:
			</p><div class="itemizedlist"><ul><li><p>Filter indexes, which organize active filters so that they can be searched efficiently. When the engine receives an event, it consults the filter indexes to determine which statements, if any, must process the event.</p></li><li><p>Event indexes, which organize properties of events so that they can be searched efficiently. When the engine performs statement processing it may use event indexes to find correlated events efficiently.</p></li></ul></div><p>
				The <span class="emphasis"><em>point-region quadtree</em></span> is a quadtree for the efficient finding of points that fall inside a given rectangle. Use this index with the point-inside-rectangle method described above.
			</p><p>
				The <span class="emphasis"><em>MX-CIF quadtree</em></span> is a quadtree for the efficient finding of rectangles that intersect with a given rectangle. Use this index with the rectangle-intersects-rectangle method described above.
			</p><p>
				While point-region quadtree and MX-CIF quadtree are similar, they are not compatible and are not the same. In point-region quadtree, only leaf nodes have data. In MX-CIF quadtrees both branch and leaf nodes have data as branches hold rectangles that don't fit any given quadrant. The engine expands and shrinks both types of trees dynamically based on data by promoting or subdividing a leaf node to branch nodes when adding data and by demoting or merging branches to a leaf node when removing data.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="spatial_index_pointregionquadtreedeclare"/>19.3.2.Â Declaring a Point-Region Quadtree Index</h3></div></div></div><p>
				Declaring a point-region quadtree index is the same for both filter indexes and event indexes.
				Point-region quadtrees are suitable for efficiently finding points inside a rectangle, when there are many points.
			</p><p>
				The synopsis to declare a point-region quadtree index, as part of an EPL statement, is:
			</p><pre class="synopsis">pointregionquadtree(<span class="emphasis"><em>min_x_expression</em></span>, <span class="emphasis"><em>min_y_expression</em></span>, 
  <span class="emphasis"><em>width</em></span>, <span class="emphasis"><em>height</em></span> [, <span class="emphasis"><em>leaf_capacity_expression</em></span> [, <span class="emphasis"><em>max_tree_height_expression</em></span>]])</pre><p>
				The <span class="emphasis"><em>min_x_expression</em></span>, <span class="emphasis"><em>min_y_expression</em></span>,  <span class="emphasis"><em>width</em></span>, <span class="emphasis"><em>height</em></span> are index parameter expressions 
				that return the range of the index. The width and height must be greater zero. The index range rectangle is represented by <code class="literal">double</code>-type values internally.
				A point is inside the index range if <code class="literal">x &gt;= minX and y &gt;= minY and x &lt; minX+width and y &lt; minY+height</code>.
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
					An attempt to insert points into the index that are outside of the declared index range causes an exception. 
				</p></div><p>
				The <span class="emphasis"><em>leaf_capacity_expression</em></span> is optional and must return a positive integer. It defines the number of coordinates a node may contain before it gets split into regions.
				The default value is 4.
			</p><p>
				The <span class="emphasis"><em>max_tree_height_expression</em></span> is optional and must return an integer value of 2 or more. It defines the maximum depth of the tree. 
				Upon the tree reaching the maximum depth a leaf node  does not get split into regions. The default value is 20.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="spatial_index_pointregionquadtreefilterindex"/>19.3.3.Â Using a Point-Region Quadtree as a Filter Index</h3></div></div></div><p>
				The section that summarizes filter indexes is <a class="xref" href="#processingmodel_indexes_filterindexes" title="2.18.2.Â Filter Indexes">SectionÂ 2.18.2, âFilter Indexesâ</a>.
				As there could be many <code class="literal">point(...).inside(rectangle)</code> filters active, having a filter index allows the engine to efficiently match incoming events to EPL statements.
			</p><p>
				For use of a point-region quadtree index within filter criteria you must: 
			</p><div class="itemizedlist"><ul><li><p>Define an expression that returns the point-region quadtree configuration, making sure it specifies <code class="literal">pointregionquadtree</code>.</p></li><li><p>Add the <code class="literal">filterindex</code> named parameter providing the expression name.</p></li></ul></div><p>
				For defining a local or global expression, please consult <a class="xref" href="#epl-syntax-expression-decl" title="5.2.9.Â Expression Declaration">SectionÂ 5.2.9, âExpression Declarationâ</a>.
			</p><p>
				This sample EPL query defines the point-region quadtree filter index to have a bounding box of <code class="literal">(0,0,100,100)</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression myPointRegionQuadtreeSettings { pointregionquadtree(0, 0, 100, 100) } 
select * from RectangleEvent(point(0, 0, filterindex:myPointRegionQuadtreeSettings).inside(rectangle(x, y, width, height)))</pre><p>
				The <code class="literal">filterindex</code> named parameter instructs the engine that the settings for the point-region quadtree filter index are provided by the expression <code class="literal">myPointRegionQuadtreeSettings</code>, a local expression in this example.
				For sharing point-region quadtree settings across statements you may use a global expression instead. Please see <a class="xref" href="#create-exprglobal" title="5.18.Â Declaring Global Expressions, Aliases and Scripts: Create Expression">SectionÂ 5.18, âDeclaring Global Expressions, Aliases and Scripts: Create Expressionâ</a>.
			</p><p>
				If your EPL does not specify <code class="literal">filterindex</code> the engine does not build a point-region quadtree filter index.
			</p><p>
				If your EPL specifies <code class="literal">filterindex</code> the engine always builds and uses a point-region quadtree filter index.
				In the case the engine analyses filter criteria and determines that it cannot use the point-region quadtree filter index, the engine fails statement validation.
			</p><p>
				If your EPL specifies <code class="literal">filterindex</code> and the engine determines that it cannot use the point-region quadtree filter index it fails statement validation.
			</p><p>
				The engine shares point-region quadtree filter indexes across the engine within the same event type given that:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Filters have the same <code class="literal">rectangle</code> expressions.</p></li><li><p>Filters use the same <code class="literal">filterindex</code> parameter i.e. the text <code class="literal">myPointRegionQuadtreeSettings</code> in above example.</p></li><li><p>Filters use the same point-region quadtree index configuration i.e. <code class="literal">pointregionquadtree(0,0,100,100)</code> in above example.</p></li></ol></div><p>
				For use with the <code class="literal">filterindex</code> named parameter, the following requirements apply towards <code class="literal">point</code> expressions:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Point expressions must be a constant, a context-provided built-in property or an event property provided by a previous pattern match within the same pattern.</p></li></ol></div><p>
				For use with the <code class="literal">filterindex</code> named parameter, the following requirements apply towards <code class="literal">rectangle</code> expressions:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Rectangle expressions must be event properties.</p></li></ol></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="spatial_index_pointregionquadtreeeventindex"/>19.3.4.Â Using a Point-Region Quadtree as an Event Index</h3></div></div></div><p>
				The section that summarizes event indexes is  <a class="xref" href="#processingmodel_indexes_eventindexes" title="2.18.3.Â Event Indexes">SectionÂ 2.18.3, âEvent Indexesâ</a>. The <code class="literal">create index</code> clause is described in <a class="xref" href="#named_explicit_index" title="6.9.Â Explicitly Indexing Named Windows and Tables">SectionÂ 6.9, âExplicitly Indexing Named Windows and Tablesâ</a>.
			</p><p>
				Declare a point-region quadtree event index as follows:
			</p><pre class="synopsis">create index ... on ... (
  (<span class="emphasis"><em>x_expression</em></span>, <span class="emphasis"><em>y_expression</em></span>) pointregionquadtree(<span class="emphasis"><em>pointregion_quadtree_configuration</em></span>)
)</pre><p>
				The <span class="emphasis"><em>x_expression</em></span> and <span class="emphasis"><em>y_expression</em></span> expressions form the index columns. 
				The expressions return the (x, y)-coordinates and must return numeric values.  Coordinates are represented as <code class="literal">double</code>-type values internally.
				See above for the <span class="emphasis"><em>pointregion_quadtree_configuration</em></span> point-region quadtree configuration.
			</p><p>
				For example, assume a table that contains points:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table PointTable(pointId string primary key, px double, py double)</pre><p>
				This example EPL declares an index on the points, with <code class="literal">px</code> and <code class="literal">py</code> becoming index columns that determine (x, y)-coordinates:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create index PointIndex on PointTable((px, py) pointregionquadtree(0, 0, 100, 100))</pre><p>
				The above sample quadtree index expects (x, y)-coordinates that are in the range <code class="literal">0 &lt;= px &lt;= 100</code> and <code class="literal">0 &lt;= py &lt;= 100</code>.
			</p><p>
				The example schema for events providing rectangles is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema RectangleEvent(rx double, ry double, w double, h double)</pre><p>
				This EPL outputs, upon arrival of a RectangleEvent, all points that fall inside the rectangle:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on RectangleEvent
select pointId from PointTable
where point(px, py).inside(rectangle(rx, ry, w, h))</pre><p>
				Internally the engine does not instantiate point or rectangle objects at all but instead optimizes the expression to comparison between <code class="literal">double</code>-type values.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="spatial_index_pointregionquadtreeusenotes"/>19.3.4.1.Â Point-Region Quadtree Event Index Usage Notes</h4></div></div></div><p>
					Point-Region quadtree indexes allow computed values for both index columns and index parameters. For example, the following EPL declares an index wherein (x, y)-coordinates are <code class="literal">(px/100, py/100)</code>-values. The sample EPL assumes that <code class="literal">context.frame</code> is a built-in property as provided by context <code class="literal">FramedCtx</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context FramedCtx create index PointIndex on PointTable((Math.round(px/100), Math.round(py/100)) pointregionquadtree(context.frame.startx, context.frame.starty, context.frame.w, context.frame.h))</pre><p>
					The engine compares the index column expressions to the <code class="literal">point-inside-rectangle</code> left-hand-side expressions to determine which index to use.				
					For example, if the expression is <code class="literal">point(px+1, py+1).inside(rectangle(rx, ry, w, h))</code>
					as <code class="literal">(px+1, py+1)</code> does not match <code class="literal">(Math.round(px/100), Math.round(py/100))</code> the query planner does not use the index.
					If the expression is <code class="literal">point(Math.round(px/100), Math.round(py/100)).inside(rectangle(rx, ry, w, h))</code> the query planner does use the index as index column expressions match.
				</p><p>
					The query planner prefers point-region quadtree over other index types. Index hints are not yet available for query planning with quadtree indexes.
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="spatial_index_mxcifquadtreedeclare"/>19.3.5.Â Declaring a MX-CIF Quadtree Index</h3></div></div></div><p>
				Declaring a MX-CIF quadtree index is the same for both filter indexes and event indexes.
				MX-CIF quadtrees are suitable for efficiently finding rectangles that intersect with a rectangle, when there are many rectangles.
			</p><p>
				The synopsis to declare a MX-CIF quadtree index, as part of an EPL statement, is:
			</p><pre class="synopsis">mxcifquadtree(<span class="emphasis"><em>min_x_expression</em></span>, <span class="emphasis"><em>min_y_expression</em></span>, 
  <span class="emphasis"><em>width</em></span>, <span class="emphasis"><em>height</em></span> [, <span class="emphasis"><em>leaf_capacity_expression</em></span> [, <span class="emphasis"><em>max_tree_height_expression</em></span>]])</pre><p>
				The <span class="emphasis"><em>min_x_expression</em></span>, <span class="emphasis"><em>min_y_expression</em></span>,  <span class="emphasis"><em>width</em></span>, <span class="emphasis"><em>height</em></span> are index parameter expressions 
				that return the range of the index. The width and height must be greater zero. The index range rectangle is represented by <code class="literal">double</code>-type values internally.
				A given rectangle must intersect with the index range.
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
					An attempt to insert rectangles into the index that do not intersect with the declared index range causes an exception. 
				</p></div><p>
				The <span class="emphasis"><em>leaf_capacity_expression</em></span> is optional and must return a positive integer. It defines the number of coordinates a node may contain before it gets split into regions.
				The default value is 4.
			</p><p>
				The <span class="emphasis"><em>max_tree_height_expression</em></span> is optional and must return an integer value of 2 or more. It defines the maximum depth of the tree. 
				Upon the tree reaching the maximum depth a leaf node  does not get split into regions. The default value is 20.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="spatial_index_mxcifquadtreefilterindex"/>19.3.6.Â Using a MX-CIF Quadtree as a Filter Index</h3></div></div></div><p>
				The section that summarizes filter indexes is <a class="xref" href="#processingmodel_indexes_filterindexes" title="2.18.2.Â Filter Indexes">SectionÂ 2.18.2, âFilter Indexesâ</a>.
				As there could be many <code class="literal">rectangle(...).intersects(rectangle)</code> filters active, having a filter index allows the engine to efficiently match incoming events to EPL statements.
			</p><p>
				For use of a MX-CIF quadtree index within filter criteria you must: 
			</p><div class="itemizedlist"><ul><li><p>Define an expression that returns the MX-CIF quadtree configuration, making sure it specifies <code class="literal">mxcifquadtree</code>.</p></li><li><p>Add the <code class="literal">filterindex</code> named parameter providing the expression name.</p></li></ul></div><p>
				For defining a local or global expression, please consult <a class="xref" href="#epl-syntax-expression-decl" title="5.2.9.Â Expression Declaration">SectionÂ 5.2.9, âExpression Declarationâ</a>.
			</p><p>
				This sample EPL query defines the MX-CIF quadtree filter index to have a bounding box of <code class="literal">(0,0,100,100)</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">expression myMXCIFQuadtreeSettings { mxcifquadtree(0, 0, 100, 100) } 
select * from RectangleEvent(rectangle(10, 20, 5, 5, filterindex:myMXCIFQuadtreeSettings).intersects(rectangle(x, y, width, height)))</pre><p>
				The <code class="literal">filterindex</code> named parameter instructs the engine that the settings for the MX-CIF quadtree filter index are provided by the expression <code class="literal">myMXCIFQuadtreeSettings</code>, a local expression in this example.
				For sharing MX-CIF quadtree settings across statements you may use a global expression instead. Please see <a class="xref" href="#create-exprglobal" title="5.18.Â Declaring Global Expressions, Aliases and Scripts: Create Expression">SectionÂ 5.18, âDeclaring Global Expressions, Aliases and Scripts: Create Expressionâ</a>.
			</p><p>
				If your EPL does not specify <code class="literal">filterindex</code> the engine does not build a MX-CIF quadtree filter index.
			</p><p>
				If your EPL specifies <code class="literal">filterindex</code> the engine always builds and uses a MX-CIF quadtree filter index.
				In the case the engine analyses filter criteria and determines that it cannot use the MX-CIF quadtree filter index, the engine fails statement validation.
			</p><p>
				If your EPL specifies <code class="literal">filterindex</code> and the engine determines that it cannot use the MX-CIF quadtree filter index it fails statement validation.
			</p><p>
				The engine shares MX-CIF quadtree filter indexes across the engine within the same event type given that:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Filters have the same <code class="literal">rectangle</code> expressions.</p></li><li><p>Filters use the same <code class="literal">filterindex</code> parameter i.e. the text <code class="literal">myMXCIFQuadtreeSettings</code> in above example.</p></li><li><p>Filters use the same MX-CIF quadtree index configuration i.e. <code class="literal">mxcifquadtree(0,0,100,100)</code> in above example.</p></li></ol></div><p>
				For use with the <code class="literal">filterindex</code> named parameter, the following requirements apply towards left-hand side <code class="literal">rectangle</code> expressions:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Left-hand side  rectangle expressions must be a constant, a context-provided built-in property or an event property provided by a previous pattern match within the same pattern.</p></li></ol></div><p>
				For use with the <code class="literal">filterindex</code> named parameter, the following requirements apply towards right-hand side <code class="literal">rectangle</code> expressions:
			</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Right-hand side rectangle expressions must be event properties.</p></li></ol></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="spatial_index_mxcifquadtreeeventindex"/>19.3.7.Â Using a MX-CIF Quadtree as an Event Index</h3></div></div></div><p>
				The section that summarizes event indexes is  <a class="xref" href="#processingmodel_indexes_eventindexes" title="2.18.3.Â Event Indexes">SectionÂ 2.18.3, âEvent Indexesâ</a>. The <code class="literal">create index</code> clause is described in <a class="xref" href="#named_explicit_index" title="6.9.Â Explicitly Indexing Named Windows and Tables">SectionÂ 6.9, âExplicitly Indexing Named Windows and Tablesâ</a>.
			</p><p>
				Declare a MX-CIF quadtree event index as follows:
			</p><pre class="synopsis">create index ... on ... (
  (<span class="emphasis"><em>x_expression</em></span>, <span class="emphasis"><em>y_expression</em></span>, <span class="emphasis"><em>width_expression</em></span>, <span class="emphasis"><em>height_expression</em></span>) mxcifquadtree(<span class="emphasis"><em>mxcif_quadtree_configuration</em></span>)
)</pre><p>
				The <span class="emphasis"><em>x_expression</em></span>, <span class="emphasis"><em>y_expression</em></span>, <span class="emphasis"><em>width_expression</em></span> and <span class="emphasis"><em>height_expression</em></span> expressions form the index columns. 
				The expressions return the (x, y)-coordinates and rectangle size and must return numeric values.  Coordinates and sizes are represented as <code class="literal">double</code>-type values internally.
				See above for the <span class="emphasis"><em>mxcif_quadtree_configuration</em></span> MX-CIF quadtree configuration.
			</p><p>
				For example, assume a table that contains rectangles:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table RectangleTable(rectangleId string primary key, rx double, ry double, rwidth double, rheight double)</pre><p>
				This example EPL declares an index on the rectangles, with <code class="literal">rx</code>, <code class="literal">ry</code>, <code class="literal">rwidth</code> and <code class="literal">rheight</code> becoming index columns that determine the (x, y)-coordinates and the sizes:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create index RectangleIndex on RectangleTable((rx, ry, rwidth, rheight) mxcifquadtree(0, 0, 100, 100))</pre><p>
				The above sample quadtree index expects rectangles to intersect the rectangle <code class="literal">(0, 0, 100, 100)</code>.
			</p><p>
				The example schema for arriving events is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema OtherRectangleEvent(otherX double, otherY double, otherWidth double, otherHeight double)</pre><p>
				This EPL outputs, upon arrival of a <code class="literal">OtherRectangleEvent</code>, all rectangles stored in the table that intersect the arriving-events rectangle:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">on OtherRectangleEvent
select rectangleId from RectangleTable
where rectangle(rx, ry, rwidth, rheight).intersects(rectangle(otherX, otherY, otherWidth, otherHeight))</pre><p>
				Internally the engine does not instantiate rectangle objects at all but instead optimizes the expression to comparison between <code class="literal">double</code>-type values.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="spatial_index_mxcifquadtreeusenotes"/>19.3.7.1.Â MX-CIF Quadtree Event Index Usage Notes</h4></div></div></div><p>
					MX-CIF quadtree indexes allow computed values for both index columns and index parameters. For example, the following EPL declares an index wherein (x, y)-coordinates are <code class="literal">(px/100, py/100)</code>-values. The sample EPL assumes that <code class="literal">context.frame</code> is a built-in property as provided by context <code class="literal">FramedCtx</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context FramedCtx create index RectangleIndex on RectangleTable((Math.round(rx/100), Math.round(ry/100), Math.round(rwidth/100), Math.round(rheight/100)) mxcifquadtree(context.frame.startx, context.frame.starty, context.frame.w, context.frame.h))</pre><p>
					The engine compares the index column expressions to the <code class="literal">rectangle-interwsects-rectangle</code> left-hand-side expressions to determine which index to use.				
				</p><p>
					The query planner prefers MX-CIF quadtree over other index types. Index hints are not yet available for query planning with quadtree indexes.
				</p></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="spatial_etc"/>19.4.Â Spatial Types, Functions and Methods from External Libraries</h2></div></div></div><a id="d0e47701" class="indexterm"/><a id="d0e47706" class="indexterm"/><a id="d0e47711" class="indexterm"/><p>
			The scope of the Esper engine does not include addressing all geographical, topological or spatial processing. 
			We encourage using external libraries with Esper and Esper.
			Esper and EPL make it easy to use and extend EPL, using functions, methods, data types and data structures provided by external libraries.
		</p><p>
			For example, assume you would like to use a geometric data type and the geographical distance function. 
			Please consider using the Java Topology Suite (JTS) (<code class="literal">https://www.locationtech.org</code>) which provides a pretty complete set of geo computing functionality.
		</p><p>
			To pick an example data type, Esper allows any class such as the JTS Geometry class (<code class="literal">org.locationtech.jts.geom.Geometry</code>) to become an event type, an event property type or a column type in a named window, table.
			Esper also allows the use of such class anywhere within EPL expressions as well.
		</p><p>
			The EPL snippet below declares an event type that has a Geometry property: 
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema ShapeArrivalEvent(shapeId string, geometry org.locationtech.jts.geom.Geometry) // use imports to remove the need to have a package name</pre><p>
			EPL can call methods and your application can declare its own functions. Registering an own EPL function is described in  <a class="xref" href="#custom-singlerow-function" title="17.3.Â Single-Row Function">SectionÂ 17.3, âSingle-Row Functionâ</a>.
		</p><p>
			This sample EPL outputs events that have a <code class="literal">distance</code> of more than 100 comparing the current event's <code class="literal">geometry</code> to the last 1 minute of previous event's <code class="literal">geometry</code>:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from ShapeArrivalEvent as e1 unidirectional, ShapeArrivalEvent.time(1 minute) as e2
where e1.geometry.distance(e2.geometry) &gt; 100</pre></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="dataflow"/>ChapterÂ 20.Â EPL Reference: Data Flow</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#dataflow-intro">20.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#dataflow-usage">20.2. Usage</a></span></dt><dd><dl><dt><span class="sect2"><a href="#dataflow-usage-overview">20.2.1. Overview</a></span></dt><dt><span class="sect2"><a href="#dataflow-usage-syntax">20.2.2. Syntax</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dataflow-reference">20.3. Built-In Operators</a></span></dt><dd><dl><dt><span class="sect2"><a href="#dataflow-reference-beaconsource">20.3.1. BeaconSource</a></span></dt><dt><span class="sect2"><a href="#dataflow-reference-epstatementsource">20.3.2. EPStatementSource</a></span></dt><dt><span class="sect2"><a href="#dataflow-reference-eventbussink">20.3.3. EventBusSink</a></span></dt><dt><span class="sect2"><a href="#dataflow-reference-eventbussource">20.3.4. EventBusSource</a></span></dt><dt><span class="sect2"><a href="#dataflow-reference-filter">20.3.5. Filter</a></span></dt><dt><span class="sect2"><a href="#dataflow-reference-logsink">20.3.6. LogSink</a></span></dt><dt><span class="sect2"><a href="#dataflow-reference-select">20.3.7. Select</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dataflow-api">20.4. API</a></span></dt><dd><dl><dt><span class="sect2"><a href="#dataflow-api-declaring">20.4.1. Declaring a Data Flow</a></span></dt><dt><span class="sect2"><a href="#dataflow-api-instantiating">20.4.2. Instantiating a Data Flow</a></span></dt><dt><span class="sect2"><a href="#dataflow-api-executing">20.4.3. Executing a Data Flow</a></span></dt><dt><span class="sect2"><a href="#dataflow-api-instantiationoptions">20.4.4. Instantiation Options</a></span></dt><dt><span class="sect2"><a href="#dataflow-api-startcaptive">20.4.5. Start Captive</a></span></dt><dt><span class="sect2"><a href="#dataflow-api-punctuation">20.4.6. Data Flow Punctuation With Markers</a></span></dt><dt><span class="sect2"><a href="#dataflow-api-exception">20.4.7. Exception Handling</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dataflow-examples">20.5. Examples</a></span></dt><dt><span class="sect1"><a href="#dataflow-op">20.6. Operator Implementation</a></span></dt><dd><dl><dt><span class="sect2"><a href="#dataflow-op-source">20.6.1. Sample Operator Acting as Source</a></span></dt><dt><span class="sect2"><a href="#dataflow-op-second">20.6.2. Sample Tokenizer Operator</a></span></dt><dt><span class="sect2"><a href="#dataflow-op-third">20.6.3. Sample Aggregator Operator</a></span></dt></dl></dd></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="dataflow-intro"/>20.1.Â Introduction</h2></div></div></div><a id="d0e47755" class="indexterm"/><p>
			Data flows in Esper EPL have the following purposes:			
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					Support for data flow programming and flow-based programming.
				</p></li><li><p>
					Declarative and runtime manageable integration of Esper input and output adapters that may be provided by EsperIO or by an application.
				</p></li><li><p>
					Remove the need to use an event bus achieving dataflow-only visibility of events and event types for performance gains.
				</p></li></ol></div><p>
		  Data flow operators communicate via streams of either underlying event objects or wrapped events. Underlying event objects are POJO, Map, Object-array or DOM/XML. Wrapped events are represented by <code class="literal">EventBean</code> instances that associate type information to underlying event objects.
		</p><p>
		  For more information on data flow programming or flow-based programming please consult the <a class="link" href="http://en.wikipedia.org/wiki/Flow-based_programming" target="">Wikipedia FBP Article</a>.		  
		</p><p>
		  Esper offers a number of useful built-in operators that can be combined in a graph to program a data flow. In addition EsperIO offers prebuilt operators that act as sources or sinks of events. An application can easily create and use its own data flow operators.
		</p><p>
		  Using data flows an application can provide events to the data flow operators directly without using an engine's event bus. Not using an event bus (as represented by <code class="literal">EPRuntime.sendEvent</code>) can achieve performance gains as the engine does not need to match events to statements and the engine does not need to wrap underlying event objects in <code class="literal">EventBean</code> instances.
		</p><p>
		  Data flows also allow for finer-grained control over threading, synchronous and asynchronous operation.
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
			  Data flows are new in release 4.6 and may be subject to evolutionary change.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="dataflow-usage"/>20.2.Â Usage</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-usage-overview"/>20.2.1.Â Overview</h3></div></div></div><p>
				Your application declares a data flow using <code class="literal">create dataflow </code><span class="emphasis"><em>dataflow-name</em></span>. Declaring the data flow causes the EPL compiler to validate the syntax and some aspects of the data flow graph of operators. Declaring the data flow does not actually instantiate or execute a data flow. Resolving event types and instantiating operators (as required) takes place at time of data flow instantiation.
			</p><p>
				After your application has declared a data flow, it can instantiate the data flow and execute it. A data flow can be instantiated as many times as needed and each data flow instance can only be executed once.
			</p><p>
			  The example EPL below creates a data flow that, upon execution, outputs the text <code class="literal">Hello World</code> to console and then ends.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow HelloWorldDataFlow
  BeaconSource -&gt; helloworld.stream { text: 'hello world' , iterations: 1}
  LogSink(helloworld.stream) {}</pre><p>
				The sample data flow above declares a <code class="literal">BeaconSource</code> operator parameterized by the "hello world" text and 1 iteration. The <code class="literal">-&gt;</code> keyword reads as <span class="emphasis"><em>produces streams</em></span>. The <code class="literal">BeaconSource</code> operator produces a single stream named <code class="literal">helloworld.stream</code>. The <code class="literal">LogSink</code> operator receives this stream and prints it unformatted.
			 </p><p>
			  The next program code snippet declares the data flow to the engine:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String epl = "create dataflow HelloWorldDataFlow\n" +
  "BeaconSource -&gt; helloworldStream { text: 'hello world' , iterations: 1}\n" +
  "LogSink(helloworldStream) {}";
epService.getEPAdministrator().createEPL(epl);</pre><p>
			   After declaring a data flow to an engine, your application can then instantiate and execute the data flow.
			 </p><p>
			   The following program code snippet instantiates the data flow:
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPDataFlowInstance instance =
  epService.getEPRuntime().getDataFlowRuntime().instantiate("HelloWorldDataFlow");</pre><p>
			    A data flow instance is represented by an <code class="literal">EPDataFlowInstance</code> object.
			  </p><p>
			   The next code snippet executes the data flow instance:
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">instance.run();</pre><p>
			  By using the <code class="literal">run</code> method of <code class="literal">EPDataFlowInstance</code> the engine executes the data flow using the same thread (blocking execute) and returns when the data flow completes. A data flow completes when all operators receive final markers.
			</p><p>
			  The hello world data flow simply prints an unformatted <code class="literal">Hello World</code> string to console. Please check the built-in operator reference for <code class="literal">BeaconSource</code> and <code class="literal">LogSink</code> for more options.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-usage-syntax"/>20.2.2.Â Syntax</h3></div></div></div><p>
			  The synopsis for declaring a data flow is:
			</p><pre class="synopsis">create dataflow <span class="emphasis"><em>name</em></span>
	[<span class="emphasis"><em>schema_declarations</em></span>]
	[<span class="emphasis"><em>operator_declarations</em></span>]
	</pre><p>
			  After <code class="literal">create dataflow</code> follows the data flow name and a mixed list of event type (schema) declarations and operator declarations.
			</p><p>
			  Schema declarations define an event type. Specify any number of <code class="literal">create schema</code> clauses as part of the data flow declaration followed by a comma character to end each schema declaration. The syntax for <code class="literal">create schema</code> is described in <a class="xref" href="#epl_createschema" title="5.15.Â Declaring an Event Type: Create Schema">SectionÂ 5.15, âDeclaring an Event Type: Create Schemaâ</a>.
			</p><p>
			  All event types that are defined as part of a data flow are private to the data flow and not available to other EPL statements. To define event types that are available across data flows and other EPL statements, use a <code class="literal">create schema</code> EPL statement, runtime or static configuration.
			</p><p>
			  Annotations as well as expression declarations and scripts can also be pre-pended to the data flow declaration.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="dataflow-usage-syntax-op"/>20.2.2.1.Â Operator Declaration</h4></div></div></div><p>
				  For each operator, declare the operator name, input streams, output streams and operator parameters.
				</p><p>
				  The syntax for declaring a data flow operator is:
				</p><pre class="synopsis"><span class="emphasis"><em>operator_name</em></span> [(<span class="emphasis"><em>input_streams</em></span>)]  [-&gt; <span class="emphasis"><em>output_streams</em></span>] {
  [<span class="emphasis"><em>parameter_name</em></span> : <span class="emphasis"><em>parameter_value_expr</em></span>] [, ...]
}</pre><p>
	              The operator name is an identifier that identifies an operator.
	            </p><p>
	              If the operator accepts input streams then those may be listed in parenthesis after the operator name, see <a class="xref" href="#dataflow-usage-syntax-opinputstreams" title="20.2.2.2.Â Declaring Input Streams">SectionÂ 20.2.2.2, âDeclaring Input Streamsâ</a>.
	            </p><p>
	              If the operator can produce output streams then specify <code class="literal">-&gt;</code> followed by a list of output stream names and types. See <a class="xref" href="#dataflow-usage-syntax-opoutputstreams" title="20.2.2.3.Â Declaring Output Streams">SectionÂ 20.2.2.3, âDeclaring Output Streamsâ</a>.
	            </p><p>
	              Following the input and output stream declaration provide curly brackets (<code class="literal">{}</code>) containing operator parameters. See <a class="xref" href="#dataflow-usage-syntax-opparams" title="20.2.2.4.Â Declaring Operator Parameters">SectionÂ 20.2.2.4, âDeclaring Operator Parametersâ</a>.
	            </p><p>
				  An operator that receives no input streams, produces no output streams and has no parameters assigned to it is shown in this EPL example data flow:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  MyOperatorSimple {}</pre><p>
				  The next EPL shows a data flow that consists of an operator <code class="literal">MyOperator</code> that receives a single input stream <code class="literal">myInStream</code> and produces a single output stream <code class="literal">myOutStream</code> holding <code class="literal">MyEvent</code> events.
				  The EPL configures the operator parameter <code class="literal">myParameter</code> with a value of 10:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  create schema MyEvent as (id string, price double),
  MyOperator(myInStream) -&gt; myOutStream&lt;MyEvent&gt; {
    myParameter : 10
  }</pre><p>
				    The next sections outline input stream, output stream and parameter assignment in greater detail.
				  </p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="dataflow-usage-syntax-opinputstreams"/>20.2.2.2.Â Declaring Input Streams</h4></div></div></div><p>
				  In case the operator receives input streams, list the input stream names within parenthesis following the operator name. As part of the input stream declaration you may use the <code class="literal">as</code> keyword to assign an alias short name to one or multiple input streams.
				</p><p>
				  The EPL shown next declares <code class="literal">myInStream</code> and assigns the alias <code class="literal">mis</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  MyOperator(myInStream as mis) {}</pre><p>
				  Multiple input streams can be listed separated by comma. We use the term <span class="emphasis"><em>input port</em></span> to mean the ordinal number of the input stream in the order the input streams are listed.
				</p><p>
				  The EPL as below declares two input streams and assigns an alias to each. The engine assigns <code class="literal">streamOne</code> to input port 0 (zero) and <code class="literal">streamTwo</code> to port 1.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  MyOperator(streamOne as one, streamTwo as two) {}</pre><p>
				  You may assign multiple input streams to the same port and alias by placing the stream names into parenthesis. All input streams for the same port must have the same event type associated.
				</p><p>
				  The next EPL statement declares an operator that receives input streams <code class="literal">streamA</code> and <code class="literal">streamB</code> both assigned to port 0 (zero) and alias <code class="literal">streamsAB</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  MyOperator( (streamA, streamB) as streamsAB) {}</pre><p>
				    Input and output stream names can have the dot-character in their name.
				 </p><p>
				    The following is also valid EPL:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  MyOperator(my.in.stream) -&gt; my.out.stream {}</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
					    Reserved keywords may not appear in the stream name.
					  </p></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="dataflow-usage-syntax-opoutputstreams"/>20.2.2.3.Â Declaring Output Streams</h4></div></div></div><p>
				  In case the operator produces output streams, list the output streams after the <code class="literal">-&gt;</code> keyword. Multiple output streams can be listed separated by comma. We use the term <span class="emphasis"><em>output port</em></span> to mean the ordinal number of the output stream in the order the output streams are listed.
				</p><p>
				    The sample EPL below declares an operator that produces two output streams <code class="literal">my.out.one</code> and <code class="literal">my.out.two</code>. 
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  MyOperator -&gt; my.out.one, my.out.two {}</pre><p>
				   Each output stream can be assigned optional type information within less/greater-then (<code class="literal">&lt;&gt;</code>). Type information is required if the operator cannot deduce the output type from the input type and the operator does not declare explicit output type(s). The event type name can 
				   either be an event type defined within the same data flow or an event type defined in the engine.
				</p><p>
				    This EPL example declares an <code class="literal">RFIDSchema</code> event type based on an object-array event representation and associates the output stream <code class="literal">rfid.stream</code> with the <code class="literal">RFIDSchema</code> type. 
				    The stream <code class="literal">rfid.stream</code> therefore carries object-array (<code class="literal">Object[]</code>) typed objects according to schema <code class="literal">RFIDSchema</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  create objectarray schema RFIDSchema (tagId string, locX double, locY double),
  MyOperator -&gt; rfid.stream&lt;RFIDSchema&gt; {}</pre><p>
				  The keyword <code class="literal">eventbean</code> is reserved: Use <code class="literal">eventbean&lt;</code><span class="emphasis"><em>type-name</em></span><code class="literal">&gt;</code> to indicate that a stream carries <code class="literal">EventBean</code> instances of the given type instead of the underlying event object.
				</p><p>
				    This EPL example declares an <code class="literal">RFIDSchema</code> event type based on an object-array event representation and associates the output stream <code class="literal">rfid.stream</code> with the event type,
				    such that the stream <code class="literal">rfid.stream</code> carries <code class="literal">EventBean</code> objects:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  create objectarray schema RFIDSchema (tagId string, locX double, locy double),
  MyOperator -&gt; rfid.stream&lt;eventbean&lt;RFIDSchema&gt;&gt; {}</pre><p>
				   Use questionmark (<code class="literal">?</code>) to indicate that the type of events is not known in advance.
				</p><p>
				    In the next EPL the stream <code class="literal">my.stream</code> carries <code class="literal">EventBean</code> instances of any type:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  MyOperator -&gt; my.stream&lt;eventbean&lt;?&gt;&gt; {}</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="dataflow-usage-syntax-opparams"/>20.2.2.4.Â Declaring Operator Parameters</h4></div></div></div><p>
				  Operators can receive constants, objects, EPL expressions and complete EPL statements as parameters. All parameters are listed within curly brackets (<code class="literal">{}</code>) after input and output stream declarations. Curly brackets are required as a separator even if 
				  the operator has no parameters.
				</p><p>
				  The syntax for parameters is:
				</p><pre class="synopsis"><span class="emphasis"><em>name</em></span> : <span class="emphasis"><em>value_expr</em></span> [,...]</pre><p>
				  The parameter name is an identifier that is followed by the colon (<code class="literal">:</code>) or equals (<code class="literal">=</code>) character and a value expression. A value expression can be any expression, system property, JSON notation object or EPL statement. Parameters are separated by comma character.
				</p><p>
				    The next EPL demonstrates operator parameters that are scalar values:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  MyOperator {
    stringParam : 'sample',
    secondString : "double-quotes are fine",
    intParam : 10
  }</pre><p>
				  Operator parameters can be any EPL expression including expressions that use variables. Subqueries, aggregations and the <code class="literal">prev</code> and <code class="literal">prior</code> functions cannot be applied here.
				</p><p>
				    The EPL shown below lists operator parameters that are expressions:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  MyOperator {
    intParam : 24*60*60,
    threshold : var_threshold	// a variable defined in the engine
  }</pre><p>
				  To obtain the value of a system property, the special <code class="literal">systemProperties</code> property name is reserved for access to system properties.
				</p><p>
				    The following EPL sets operator parameters to a value obtained from a system property:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  MyOperator {
    someSystemProperty : systemProperties('mySystemProperty') 
  }</pre><p>
				    Any JSON value can also be used as a value. Use square brackets <code class="literal">[]</code> for JSON arrays. Use curly brackets <code class="literal">{}</code> to hold nested Map or other object values. Provide the special <code class="literal">class</code> property to 
				    instantiate a given instance by class name. The engine populates the respective array, Map or Object as specified in the JSON parameter value.
				 </p><p>
					The below EPL demonstrates operator parameters that are JSON values:
				 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  MyOperator {
    myStringArray: ['a', "b"],
    myMapOrObject: {
      a : 10,
      b : 'xyz',
    },
    myInstance: {
      class: 'com.myorg.myapp.MyImplementation',
      myValue : 'sample'
    }
  }</pre><p>
				    The special parameter name <code class="literal">select</code> is reserved for use with EPL select statements. Please see the <code class="literal">Select</code> built-in operator for an example.
				 </p></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="dataflow-reference"/>20.3.Â Built-In Operators</h2></div></div></div><p>
			The below table summarizes the built-in data flow operators (Esper only) available:
		</p><div class="table"><a id="data_flow_operators_esper"/><p class="title"><b>TableÂ 20.1.Â Esper Built-in Operators</b></p><div class="table-contents"><table summary="Esper Built-in Operators" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Operator</th><th>Description</th></tr></thead><tbody><tr><td>BeaconSource</td><td>
							<p>
								Utility source that generates events. See <a class="xref" href="#dataflow-reference-beaconsource" title="20.3.1.Â BeaconSource">SectionÂ 20.3.1, âBeaconSourceâ</a>.
							</p>
						</td></tr><tr><td>Emitter</td><td>
							<p>
								Special operator for injecting events into a stream. See <a class="xref" href="#dataflow-api-startcaptive" title="20.4.5.Â Start Captive">SectionÂ 20.4.5, âStart Captiveâ</a>.
							</p>
						</td></tr><tr><td>EPStatementSource</td><td>
							<p>
								One or more EPL statements act as event sources. See <a class="xref" href="#dataflow-reference-epstatementsource" title="20.3.2.Â EPStatementSource">SectionÂ 20.3.2, âEPStatementSourceâ</a>.
							</p>
						</td></tr><tr><td>EventBusSink</td><td>
							<p>
								The event bus is the sink: Sends events from the data flow into the event bus. See <a class="xref" href="#dataflow-reference-eventbussink" title="20.3.3.Â EventBusSink">SectionÂ 20.3.3, âEventBusSinkâ</a>.
							</p>
						</td></tr><tr><td>EventBusSource</td><td>
							<p>
								The event bus is the source: Receives events from the event bus into the data flow. See <a class="xref" href="#dataflow-reference-eventbussource" title="20.3.4.Â EventBusSource">SectionÂ 20.3.4, âEventBusSourceâ</a>.
							</p>
						</td></tr><tr><td>Filter</td><td>
							<p>
								Filters an input stream and produces an output stream containing the events passing the filter criteria. See <a class="xref" href="#dataflow-reference-filter" title="20.3.5.Â Filter">SectionÂ 20.3.5, âFilterâ</a>.
							</p>
						</td></tr><tr><td>LogSink</td><td>
							<p>
								Utility sink that outputs events to console or log. See <a class="xref" href="#dataflow-reference-logsink" title="20.3.6.Â LogSink">SectionÂ 20.3.6, âLogSinkâ</a>.
							</p>
						</td></tr><tr><td>Select</td><td>
							<p>
								An EPL select statement that executes on the input stream events. See <a class="xref" href="#dataflow-reference-select" title="20.3.7.Â Select">SectionÂ 20.3.7, âSelectâ</a>.
							</p>
						</td></tr></tbody></table></div></div><br class="table-break"/><p>
			The below table summarizes the built-in EsperIO data flow operators. Please see the EsperIO documentation and source for more information.
		</p><div class="table"><a id="data_flow_operators_esperio"/><p class="title"><b>TableÂ 20.2.Â EsperIO Built-in Operators</b></p><div class="table-contents"><table summary="EsperIO Built-in Operators" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Operator</th><th>Description</th></tr></thead><tbody><tr><td>AMQPSource</td><td>
							<p>
								Attaches to AMQP broker to receive messages to process. 
							</p>
						</td></tr><tr><td>AMQPSink</td><td>
							<p>
								Attaches to AMQP broker to send messages.
							</p>
						</td></tr><tr><td>FileSource</td><td>
							<p>
								Reads one or more files and produces events from file data.
							</p>
						</td></tr><tr><td>FileSink</td><td>
							<p>
								Write one or more files from events received.
							</p>
						</td></tr></tbody></table></div></div><br class="table-break"/><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-reference-beaconsource"/>20.3.1.Â BeaconSource</h3></div></div></div><p>
			  The BeaconSource operator generates events and populates event properties.
			</p><p>
			  The BeaconSource operator does not accept any input streams and has no input ports.
			</p><p>
			  The BeaconSource operator must have a single output stream. When the BeaconSource operator completed generating events according to the number of iterations provided or when it is cancelled it outputs a final marker to the output stream.
			</p><p>
			  Parameters for the BeaconSource operator are all optional parameters:
			</p><div class="table"><a id="beacon_params"/><p class="title"><b>TableÂ 20.3.Â BeaconSource Parameters</b></p><div class="table-contents"><table summary="BeaconSource Parameters" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>initialDelay</td><td>Specifies the number of seconds delay before producing events.</td></tr><tr><td>interval</td><td>Time interval between events. Takes a integer or double-typed value for the number of seconds. The interval is zero when not provided.</td></tr><tr><td>iterations</td><td>Number of events produced. Takes an integer value. When not provided the operator produces tuples until the data flow instance gets cancelled.</td></tr></tbody></table></div></div><br class="table-break"/><p>
			  Event properties to be populated can simply be added to the parameters.
			</p><p>
			  If your declaration provides an event type for the output stream then BeaconSource will populate event properties of the underlying events. If no event type is specified, BeaconSource creates an anonymous object-array event type to carry the event properties that are generated and associates this type with its output stream.
			</p><p>
				Examples are:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  create schema SampleSchema(tagId string, locX double),	// sample type			
			
  // BeaconSource that produces empty object-array events without delay 
  // or interval until cancelled.
  BeaconSource -&gt; stream.one {}
  
  // BeaconSource that produces one RFIDSchema event populating event properties
  // from a user-defined function "generateTagId" and the provided values.
  BeaconSource -&gt; stream.two&lt;SampleSchema&gt; {
    iterations : 1,
    tagId : generateTagId(),
    locX : 10
  }
  
  // BeaconSource that produces 10 object-array events populating
  // the price property with a random value.
  BeaconSource -&gt; stream.three {
    iterations : 10,
    interval : 10, // every 10 seconds
    initialDelay : 5, // start after 5 seconds
    price : Math.random() * 100
  }</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-reference-epstatementsource"/>20.3.2.Â EPStatementSource</h3></div></div></div><p>
			  The EPStatementSource operator maintains a subscription to the results of one or more EPL statements. The operator produces the statement output events.
			</p><p>
			  The EPStatementSource operator does not accept any input streams and has no input ports.
			</p><p>
			  The EPStatementSource operator must have a single output stream. It does not generate a final or other marker.
			</p><p>
			  Either the statement name or the statement filter parameter is required:
			</p><div class="table"><a id="epstatementsource_params"/><p class="title"><b>TableÂ 20.4.Â EPStatementSource Parameters</b></p><div class="table-contents"><table summary="EPStatementSource Parameters" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>collector</td><td>Optional parameter, used to transform statement output events to submitted events.</td></tr><tr><td>statementName</td><td>Name of the statement that produces events. The statement does not need to exist at the time of data flow instantiation.</td></tr><tr><td>statementFilter</td><td>Implementation of the <code class="literal">EPDataFlowEPStatementFilter</code> that returns true for each statement that produces events. Statements do not need to exist at the time of data flow instantiation.</td></tr></tbody></table></div></div><br class="table-break"/><p>
				  If a statement name is provided, the operator subscribes to output events of the statement if the statement exists or when it gets created at a later point in time.  
			</p><p>
				  If a statement filter is provided instead, the operator subscribes to output events of all statements that currently exist and pass the filter <code class="literal">pass</code> method or that get created at a later point in time and pass the filter <code class="literal">pass</code> method.
			</p><p>
				  The <code class="literal">collector</code> can be specified to transform output events. If no collector is specified the operator submits the underlying events of the insert stream received from the statement. The collector object must implement the interface <code class="literal">EPDataFlowIRStreamCollector</code>.
			</p><p>
				Examples are:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  create schema SampleSchema(tagId string, locX double),	// sample type			
			
  // Consider only the statement named MySelectStatement when it exists.
  // No transformation.
  EPStatementSource -&gt; stream.one&lt;eventbean&lt;?&gt;&gt; {
    statementName : 'MySelectStatement'
  }
  
  // Consider all statements that match the filter object provided.
  // No transformation.
  EPStatementSource -&gt; stream.two&lt;eventbean&lt;?&gt;&gt; {
    statementFilter : {
      class : 'com.mycompany.filters.MyStatementFilter'
    }
  }
  
  // Consider all statements that match the filter object provided.
  // With collector that performs transformation.
  EPStatementSource -&gt; stream.two&lt;SampleSchema&gt; {
    collector : {
      class : 'com.mycompany.filters.MyCollector'
    },
    statementFilter : {
      class : 'com.mycompany.filters.MyStatementFilter'
    }
  }</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-reference-eventbussink"/>20.3.3.Â EventBusSink</h3></div></div></div><p>
			  The EventBusSink operator send events received from a data flow into the event bus. Any statement that looks for any of the events gets triggered, equivalent to <code class="literal">EPRuntime.sendEvent</code> or the <code class="literal">insert into</code> clause.
			</p><p>
			  The EventBusSink operator accepts any number of input streams. The operator forwards all events arriving on any input ports to the event bus, equivalent to <code class="literal">EPRuntime.sendEvent</code>.
			</p><p>
			  The EventBusSink operator cannot declare any output streams. 
			</p><p>
			  Parameters for the EventBusSink operator are all optional parameters:
			</p><div class="table"><a id="eventbussink_params"/><p class="title"><b>TableÂ 20.5.Â EventBusSink Parameters</b></p><div class="table-contents"><table summary="EventBusSink Parameters" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>collector</td><td>Optional parameter, used to transform data flow events to event bus events.</td></tr></tbody></table></div></div><br class="table-break"/><p>
				  The <code class="literal">collector</code> can be specified to transform data flow events to event bus events. If no collector is specified the operator submits the events directly to the event bus. The collector object must implement the interface <code class="literal">EPDataFlowEventCollector</code>.
			</p><p>
				Examples are:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  BeaconSource -&gt; instream&lt;SampleSchema&gt; {}  // produces a sample stream
  
  // Send SampleSchema events produced by beacon to the event bus.
  EventBusSink(instream) {}
  
  // Send SampleSchema events produced by beacon to the event bus.
  // With collector that performs transformation.
  EventBusSink(instream) {
    collector : {
      class : 'com.mycompany.filters.MyCollector'
    }
  }</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-reference-eventbussource"/>20.3.4.Â EventBusSource</h3></div></div></div><p>
			  The EventBusSource operator receives events from the event bus and produces an output stream of the events received. With the term event bus we mean any event visible to the engine either because the application send the event via <code class="literal">EPRuntime.sendEvent</code> or because statements populated streams as a result of <code class="literal">insert into</code>.
			</p><p>
			  The EventBusSource operator does not accept any input streams and has no input ports.
			</p><p>
			  The EventBusSource operator must have a single output stream. It does not generate a final or other marker. The event type declared for the output stream is the event type of events received from the event bus.
			</p><p>
			  All parameters to EventBusSource are optional:
			</p><div class="table"><a id="eventbussource_params"/><p class="title"><b>TableÂ 20.6.Â EventBusSource Parameters</b></p><div class="table-contents"><table summary="EventBusSource Parameters" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>collector</td><td>Optional parameter and used to transform event bus events to submitted events.</td></tr><tr><td>filter</td><td>Filter expression for event bus matching.</td></tr></tbody></table></div></div><br class="table-break"/><p>
				  The <code class="literal">collector</code> can be specified to transform output events. If no collector is specified the operator submits the underlying events of the stream received from the event bus. The collector object must implement the interface <code class="literal">EPDataFlowEventBeanCollector</code>.
			</p><p>
				  The <code class="literal">filter</code> is an expression that the event bus compiles and efficiently matches even in the presence of a large number of event bus sources. The filter expression must return a boolean-typed value, returning true for those events that the event bus passes to the operator.
			</p><p>
				Examples are:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow

  // Receive all SampleSchema events from the event bus.
  // No transformation.
  EventBusSource -&gt; stream.one&lt;SampleSchema&gt; {}
  
  // Receive all SampleSchema events with tag id '001' from the event bus.
  // No transformation.
  EventBusSource -&gt; stream.one&lt;SampleSchema&gt; {
    filter : tagId = '001'
  }

  // Receive all SampleSchema events from the event bus.
  // With collector that performs transformation.
  EventBusSource -&gt; stream.two&lt;SampleSchema&gt; {
    collector : {
      class : 'com.mycompany.filters.MyCollector'
    },
  }</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-reference-filter"/>20.3.5.Â Filter</h3></div></div></div><p>
			  The Filter operator filters an input stream and produces an output stream containing the events passing the filter criteria. If a second output stream is provided, the operator sends events not passing filter criteria to that output stream.
			</p><p>
			  The Filter operator accepts a single input stream.
			</p><p>
			  The Filter operator requires one or two output streams. The event type of the input and output stream(s) must be the same. The first output stream receives the matching events according to the filter expression. If declaring two output streams, the second stream receives non-matching events.
			</p><p>
			  The Filter operator has a single required parameter:
			</p><div class="table"><a id="filter_params"/><p class="title"><b>TableÂ 20.7.Â Filter Parameters</b></p><div class="table-contents"><table summary="Filter Parameters" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>filter</td><td>The filter criteria expression.</td></tr></tbody></table></div></div><br class="table-break"/><p>
				Examples are:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  create schema SampleSchema(tagId string, locX double),	// sample type
  BeaconSource -&gt; samplestream&lt;SampleSchema&gt; {}  // sample source
  
  // Filter all events that have a tag id of '001'
  Filter(samplestream) -&gt; tags_001 {
    filter : tagId = '001' 
  }
  
  // Filter all events that have a tag id of '001', 
  // putting all other events into the second stream
  Filter(samplestream) -&gt; tags_001, tags_other {
    filter : tagId = '001' 
  }</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-reference-logsink"/>20.3.6.Â LogSink</h3></div></div></div><p>
			  The LogSink operator outputs events to console or log file in either a JSON, XML or built-in format (the default).
			</p><p>
			  The LogSink operator accepts any number of input streams. All events arriving on any input ports are logged.
			</p><p>
			  The LogSink operator cannot declare any output streams. 
			</p><p>
			  Parameters for the LogSink operator are all optional parameters:
			</p><div class="table"><a id="logsink_params"/><p class="title"><b>TableÂ 20.8.Â LogSink Parameters</b></p><div class="table-contents"><table summary="LogSink Parameters" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>format</td><td>Specify format as a string value: <code class="literal">json</code> for JSON-formatted output, <code class="literal">xml</code> for XML-formatted output and <code class="literal">summary</code> (default) for a built-in format.</td></tr><tr><td>layout</td><td>Pattern string according to which output is formatted. Place <code class="literal">%df</code> for data flow name,  <code class="literal">%p</code> for port number, <code class="literal">%i</code> for data flow instance id, <code class="literal">%t</code> for title, <code class="literal">%e</code> for event data.</td></tr><tr><td>log</td><td>Boolean true (default) for log output, false for console output.</td></tr><tr><td>linefeed</td><td>Boolean true (default) for line feed, false for no line feed.</td></tr><tr><td>title</td><td>String title text pre-pended to output.</td></tr></tbody></table></div></div><br class="table-break"/><p>
				Examples are:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  BeaconSource -&gt; instream {}  // produces sample stream to use below
  
  // Output textual event to log using defaults.
  LogSink(instream) {}
  
  // Output JSON-formatted to console.
  LogSink(instream) {
    format : 'json',
    layout : '%t [%e]',
    log : false,
    linefeed : true,
    title : 'My Custom Title:'
  }</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-reference-select"/>20.3.7.Â Select</h3></div></div></div><p>
			  The Select operator is configured with an EPL select statement. It applies events from input streams to the select statement and outputs results either continuously or when the final marker arrives.
			</p><p>
			  The Select operator accepts one or more input streams.
			</p><p>
			  The Select operator requires a single output stream. 
			</p><p>
			  The Select operator requires the <code class="literal">select</code> parameter, all other parameters are optional:
			</p><div class="table"><a id="select_params"/><p class="title"><b>TableÂ 20.9.Â Select Operator Parameters</b></p><div class="table-contents"><table summary="Select Operator Parameters" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>iterate</td><td>Boolean indicator whether results should be output continuously or only upon arrival of the final marker.</td></tr><tr><td>select</td><td>EPL <code class="literal">select</code> statement in parenthesis.</td></tr></tbody></table></div></div><br class="table-break"/><p>
			  Set the optional <code class="literal">iterate</code> flag to false (the default) to have the operator output results continuously. Set the <code class="literal">iterate</code> flag to true to indicate that the operator outputs results only when the final marker arrives. If <code class="literal">iterate</code> is true then output rate limiting clauses are not supported.
			</p><p>
			  The <code class="literal">select</code> parameter is required and provides an EPL select statement within parenthesis. 
			  For each input port the statement should list the input stream name or the alias name in the <code class="literal">from</code> clause. Only filter-based streams are allowed in the <code class="literal">from</code> clause and patterns or named windows are not supported. Also not allowed are 
			  the <code class="literal">insert into</code> clause, the <code class="literal">irstream</code> keyword and subselects.
			</p><p>
			  The Select operator determines the event type of output events based on the <code class="literal">select</code> clause. It is not necessary to declare an event type for the output stream.
			</p><p>
				Examples are:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow MyDataFlow
  create schema SampleSchema(tagId string, locX double),	// sample type			
  BeaconSource -&gt; instream&lt;SampleSchema&gt; {}  // sample stream
  BeaconSource -&gt; secondstream&lt;SampleSchema&gt; {}  // sample stream
  
  // Simple continuous count of events
  Select(instream) -&gt; outstream {
    select: (select count(*) from instream)
  }
  
  // Demonstrate use of alias
  Select(instream as myalias) -&gt; outstream {
    select: (select count(*) from myalias)
  }
  
  // Output only when the final marker arrives
  Select(instream as myalias) -&gt; outstream {
    select: (select count(*) from myalias),
    iterate: true
  }

  // Same input port for the two sample streams
  Select( (instream, secondstream) as myalias) -&gt; outstream {
    select: (select count(*) from myalias)
  }

  // A join with multiple input streams,
  // joining the last event per stream forming pairs
  Select(instream, secondstream) -&gt; outstream {
    select: (select a.tagId, b.tagId 
        from instream#lastevent as a, secondstream#lastevent as b)
  }
  
  // A join with multiple input streams and using aliases.
  Select(instream as S1, secondstream as S2) -&gt; outstream {
    select: (select a.tagId, b.tagId 
        from S1#lastevent as a, S2#lastevent as b)
  }</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="dataflow-api"/>20.4.Â API</h2></div></div></div><p>
			This section outlines the steps to declare, instantiate, execute and cancel or complete data flows.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-api-declaring"/>20.4.1.Â Declaring a Data Flow</h3></div></div></div><p>
				Use the <code class="literal">createEPL</code> and related <code class="literal">create</code> methods on <code class="literal">EPAdministrator</code> to declare a data flow or the deployment admin API. The <code class="literal">EPStatementObjectModel</code> statement object model can also be used to declare a data flow.
			</p><p>
			  Annotations that are listed at the top of the EPL text are applied to all EPL statements and operators in the data flow. Annotations listed for a specific operator apply to that operator only.
			</p><p>
			  The next program code snippet declares a data flow to the engine:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String epl = "@Name('MyStatementName') create dataflow HelloWorldDataFlow\n" +
  "BeaconSource -&gt; helloworldStream { text: 'hello world' , iterations: 1}\n" +
  "LogSink(helloworldStream) {}";
EPStatement stmt = epService.getEPAdministrator().createEPL(epl);</pre><p>
			  The statement name that can be assigned to the statement is used only for statement management. Your application may stop and/or destroy the statement declaring the data flow thereby making the data flow unavailable for instantiation. Existing instances of the data flow are not affected by a stop or destroy of the statement that declares the data flow (example: <code class="literal">stmt.destroy()</code>).
			</p><p>
			  Listeners or the subscriber to the statement declaring a data flow receive no events or other output. The statement declaring a data flow returns no rows when iterated.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-api-instantiating"/>20.4.2.Â Instantiating a Data Flow</h3></div></div></div><p>
			  The <code class="literal">com.espertech.esper.client.dataflow.EPDataFlowRuntime</code> available via <code class="literal">getDataFlowRuntime</code> on <code class="literal">EPRuntime</code> manages declared data flows.
			</p><p>
			  Use the <code class="literal">instantiate</code> method on <code class="literal">EPDataFlowRuntime</code> to instantiate a data flow after it has been declared. Pass the data flow name and optional instantiation options to the method. A data flow can be instantiated any number of times.
			</p><p>
			  A data flow instance is represented by an instance of <code class="literal">EPDataFlowInstance</code>. Each instance has a state as well as methods to start, run, join and cancel as well as methods to obtain execution statistics.
			</p><p>
			  Various optional arguments including operator parameters can be passed to <code class="literal">instantiate</code> via the <code class="literal">EPDataFlowInstantiationOptions</code> object as explained in more detail below.
			</p><p>
			   The following code snippet instantiates the data flow:
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPDataFlowInstance instance =
  epService.getEPRuntime().getDataFlowRuntime().instantiate("HelloWorldDataFlow");</pre><p>
			  The engine does not track or otherwise retain data flow instances in memory. It is up to your application to retain data flow instances as needed.
			</p><p>
			  Each data flow instance associates to a state. The start state is <code class="literal">EPDataFlowState.INSTANTIATED</code>. The end state is either <code class="literal">COMPLETED</code> or <code class="literal">CANCELLED</code>.
			</p><p>
			  The following table outlines all states:
			</p><div class="table"><a id="data_flow_instance_states"/><p class="title"><b>TableÂ 20.10.Â Data Flow Instance States</b></p><div class="table-contents"><table summary="Data Flow Instance States" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>State</th><th>Description</th></tr></thead><tbody><tr><td>INSTANTIATED</td><td>
								<p>
									Start state, applies when a data flow instance has been instantiated and has not executed.
								</p>
							</td></tr><tr><td>RUNNING</td><td>
								<p>
									A data flow instance transitions from instantiated to running when any of the <code class="literal">start</code>, <code class="literal">run</code> or <code class="literal">startCaptive</code> methods are invoked.
								</p>
							</td></tr><tr><td>COMPLETED</td><td>
								<p>
									A data flow instance transitions from running to completed when all final markers have been processed by all operators.
								</p>
							</td></tr><tr><td>CANCELLED</td><td>
								<p>
									A data flow instance transitions from running to cancelled when your application invokes the <code class="literal">cancel</code> method on the data flow instance.
								</p>
							</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-api-executing"/>20.4.3.Â Executing a Data Flow</h3></div></div></div><p>
			  After your application instantiated a data flow instance it can execute the data flow instance using either the <code class="literal">start</code>, <code class="literal">run</code> or <code class="literal">startCaptive</code> methods.
			</p><p>
			  Use the <code class="literal">start</code> method to have the engine allocate a thread for each source operator. Execution is non-blocking. Use the <code class="literal">join</code> method to have one or more threads join a data flow instance execution.
			</p><p>
			  Use the <code class="literal">run</code> method to have the engine use the current thread to execute the single source operator. Multiple source operators are not allowed when using <code class="literal">run</code>.
			</p><p>
			  Use the <code class="literal">startCaptive</code> method to have the engine return all <code class="literal">Runnable</code> instances and emitters, for the purpose of having complete control over execution. The engine allocates no threads and does not perform any logic for the data flow unless your application employs the <code class="literal">Runnable</code> instances and emitters returned by the method. 
			</p><p>
			   The next code snippet executes the data flow instance as a blocking call:
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">instance.run();</pre><p>
			  By using the <code class="literal">run</code> method of <code class="literal">EPDataFlowInstance</code> the engine executes the data flow instance using the same thread (blocking execute) and returns when the data flow instance completes. A data flow instance completes when all operators receive final markers.
			</p><p>
			  The hello world data flow simply prints an unformatted <code class="literal">Hello World</code> string to console. The <code class="literal">BeaconSource</code> operator generates a final marker when it finishes the 1 iteration. The data flow instance thus transitions to complete after the <code class="literal">LogSink</code> operator receives the final marker, and the thread invoking the <code class="literal">run</code> method returns.
			</p><p>
			   The next code snippet executes the data flow instance as a non-blocking call:
			 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">instance.start();</pre><p>
			  Use the <code class="literal">cancel</code> method to cancel execution of a running data flow instance:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">instance.cancel();</pre><p>
			  Use the <code class="literal">join</code> method to join execution of a running data flow instance, causing the joining thread to block until the data flow instance either completes or is cancelled:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">instance.join();</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-api-instantiationoptions"/>20.4.4.Â Instantiation Options</h3></div></div></div><p>
				The <code class="literal">EPDataFlowInstantiationOptions</code> object that can be passed to the <code class="literal">instantiate</code> method may be used to customize the operator graph, operator parameters and execution of the data flow instance.
			</p><p>
			    Passing runtime parameters to data flow operators is easiest using the <code class="literal">addParameterURI</code> method. The first parameter is the data flow operator name and the 
			    operator parameter name separated by the slash character. The second parameter is the value object.
			</p><p>
			    For example, in order to pass the file name to the <code class="literal">FileSource</code> operator at runtime, use the following code:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPDataFlowInstantiationOptions options = new EPDataFlowInstantiationOptions();
options.addParameterURI("FileSource/file", filename);
EPDataFlowInstance instance = epService.getEPRuntime().getDataFlowRuntime()
    .instantiate("MyFileReaderDataFlow",options);
instance.run();</pre><p>
			    The optional <code class="literal">operatorProvider</code> member takes an implementation of the <code class="literal">EPDataFlowOperatorProvider</code> interface. The engine invokes this provider to obtain operator instances.
			</p><p>
			    The optional <code class="literal">parameterProvider</code> member takes an implementation of the <code class="literal">EPDataFlowOperatorParameterProvider</code> interface. The engine invokes this provider to obtain operator parameter values. The values override the values provided via parameter URI above.
			</p><p>
			    The optional <code class="literal">exceptionHandler</code> member takes an implementation of the <code class="literal">EPDataFlowExceptionHandler</code> interface. The engine invokes this provider to when exceptions occur.
			</p><p>
			    The optional <code class="literal">dataFlowInstanceId</code> can be assigned any string value for the purpose of identifying the data flow instance.
			</p><p>
			    The optional <code class="literal">dataFlowInstanceUserObject</code> can be assigned any object value for the purpose of associating a user object to the data flow instance.
			</p><p>
			  Set the <code class="literal">operatorStatistics</code> flag to true to obtain statistics for operator execution.
			</p><p>
			  Set the <code class="literal">cpuStatistics</code> flag to true to obtain CPU statistics for operator execution.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-api-startcaptive"/>20.4.5.Â Start Captive</h3></div></div></div><p>
				Use the <code class="literal">startCaptive</code> method on a <code class="literal">EPDataFlowInstance</code> data flow instance when your application requires full control over threading. This method returns an <code class="literal">EPDataFlowInstanceCaptive</code> instance
				that contains a list of <code class="literal">java.lang.Runnable</code> instances that represent each source operator.
			</p><p>
				The special <code class="literal">Emitter</code> operator can occur in a data flow. This emitter can be used to inject events into the data flow without writing a new operator. Emitter takes a single <code class="literal">name</code> parameter that provides the name of the emitter
				and that is returned in a map of emitters by <code class="literal">EPDataFlowInstanceCaptive</code>. 
			</p><p>
			  The example EPL below creates a data flow that uses emitter.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow HelloWorldDataFlow
  create objectarray schema SampleSchema(text string),	// sample type		
	
  Emitter -&gt; helloworld.stream&lt;SampleSchema&gt; { name: 'myemitter' }
  LogSink(helloworld.stream) {}</pre><p>
			  Your application may obtain the Emitter instance and sends events directly into the output stream. This feature is only supported in relationship with <code class="literal">startCaptive</code> since the engine does not allocate any threads or run source operators.
		    </p><p>
			  The example code snippet below obtains the emitter instance and send events directly into the data flow instance:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPDataFlowInstance instance =
      epService.getEPRuntime().getDataFlowRuntime().instantiate("HelloWorldDataFlow", options);
EPDataFlowInstanceCaptive captiveStart = instance.startCaptive();
Emitter emitter = captiveStart.getEmitters().get("myemitter");
emitter.submit(new Object[] {"this is some text"});</pre><p>
			  When emitting DOM XML events please emit the root element obtained from <code class="literal">document.getDocumentElement()</code>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-api-punctuation"/>20.4.6.Â Data Flow Punctuation With Markers</h3></div></div></div><p>
				When your application executes a data flow instance by means of the <code class="literal">start</code> (non-blocking) or <code class="literal">run</code> (blocking) methods, the data flow instance stays running until either completed or cancelled. While cancellation is always via the <code class="literal">cancel</code> method,
				completion occurs when all source operators provide final markers.
			</p><p>
			   The final marker is an object that implements the <code class="literal">EPDataFlowSignalFinalMarker</code> interface. Some operators may also provide or process data window markers which implement the <code class="literal">EPDataFlowSignalWindowMarker</code> interface. All such signals implement the <code class="literal">EPDataFlowSignal</code> interface.
			</p><p>
			  Some source operators such as <code class="literal">EventBusSource</code> and <code class="literal">EPStatementSource</code> do not generate final markers as they act continuously.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-api-exception"/>20.4.7.Â Exception Handling</h3></div></div></div><p>
				All exceptions during the execution of a data flow are logged and reported to the <code class="literal">EPDataFlowExceptionHandler</code> instance if one was provided. 
			</p><p>
				If no exception handler is provided or the provided exception handler re-throws or generates a new runtime exception,
				the source operator handles the exception and completes (ends). When all source operators complete then the data flow instance transitions to complete.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="dataflow-examples"/>20.5.Â Examples</h2></div></div></div><p>
			The following example is a rolling top words count implemented as a data flow, over a 30 second time window and providing the top 3 words every 2 seconds:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow RollingTopWords
  create objectarray schema WordEvent (word string),
  
  Emitter -&gt; wordstream&lt;WordEvent&gt; {name:'a'} {} // Produces word stream
  
  Select(wordstream) -&gt; wordcount { // Sliding time window count per word
    select: (select word, count(*) as wordcount 
          from wordstream#time(30) group by word)
  }

  Select(wordcount) -&gt; wordranks { // Rank of words
    select: (select window(*) as rankedWords 
          from wordcount#sort(3, wordcount desc) 
          output snapshot every 2 seconds)
  }
  
  LogSink(wordranks) {}</pre><p>
			The next example implements a bargain index computation that separates a mixed trade and quote event stream into a trade and a quote stream, computes a vwap and joins the two streams to compute an index:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow VWAPSample
  create objectarray schema TradeQuoteType as (type string, ticker string, price double, volume long, askprice double, asksize long),
  
  MyObjectArrayGraphSource -&gt; TradeQuoteStream&lt;TradeQuoteType&gt; {}
  
  Filter(TradeQuoteStream) -&gt; TradeStream {
    filter: type = "trade"
  }
  
  Filter(TradeQuoteStream) -&gt; QuoteStream {
    filter: type = "quote"
  }
  
  Select(TradeStream) -&gt; VwapTrades {
    select: (select ticker, sum(price * volume) / sum(volume) as vwap, 
          min(price) as minprice
          from TradeStream#groupwin(ticker)#length(4) group by ticker)
  }
  
  Select(VwapTrades as T, QuoteStream as Q) -&gt; BargainIndex {
    select: 
      (select case when vwap &gt; askprice then asksize * (Math.exp(vwap - askprice)) else 0.0d end as index
      from T#unique(ticker) as t, Q#lastevent as q
      where t.ticker = q.ticker)
  }
  
  LogSink(BargainIndex) {}
</pre><p>
			The final example is a word count data flow, in which three custom operators tokenize, word count and aggregate. The custom operators in this example are discussed next.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow WordCount
  MyLineFeedSource -&gt; LineOfTextStream {}
  MyTokenizerCounter(LineOfTextStream) -&gt; SingleLineCountStream {}
  MyWordCountAggregator(SingleLineCountStream) -&gt; WordCountStream {}
  LogSink(WordCountStream) {}</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="dataflow-op"/>20.6.Â Operator Implementation</h2></div></div></div><p>
			This section discusses how to implement classes that serve as operators in a data flow. The section employs the example data flow as shown earlier.
		</p><p>
			This example data flow has operators <code class="literal">MyLineFeedSource</code>, <code class="literal">MyTokenizerCounter</code> and <code class="literal">MyWordCountAggregator</code> that are application provided operators:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create dataflow WordCount
  MyLineFeedSource -&gt; LineOfTextStream {}
  MyTokenizerCounter(LineOfTextStream) -&gt; SingleLineCountStream {}
  MyWordCountAggregator(SingleLineCountStream) -&gt; WordCountStream {}
  LogSink(WordCountStream) {}</pre><p>
	    In order to resolve application operators, add the package or operator class to imports:
	  </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Sample code adds 'package.*' to simply import the package.
epService.getEPAdministrator().getConfiguration()
  .addImport(MyTokenizerCounter.class.getPackage().getName() + ".*");</pre><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-op-source"/>20.6.1.Â Sample Operator Acting as Source</h3></div></div></div><p>
				The implementation class must implement the <code class="literal">DataFlowSourceOperator</code> interface.
			</p><p>
			  The implementation for the sample <code class="literal">MyLineFeedSource</code> with comments is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
// The OutputTypes annotation can be used to specify the type of events 
// that are output by the operator.
// If provided, it is not necessary to declare output types in the data flow.
// The event representation is object-array.
@OutputTypes(value = {
    @OutputType(name = "line", typeName = "String")
    })

// Provide the DataFlowOpProvideSignal annotation to indicate that 
// the source operator provides a final marker.
@DataFlowOpProvideSignal

public class MyLineFeedSource implements DataFlowSourceOperator {

     // Use the DataFlowContext annotation to indicate the field that receives the emitter.
     // The engine provides the emitter. 
    @DataFlowContext
    private EPDataFlowEmitter dataFlowEmitter;

    // Mark a parameter using the DataFlowOpParameter annotation
    @DataFlowOpParameter
    private String myStringParameter;

    private final Iterator&lt;String&gt; lines;

    public MyLineFeedSource(Iterator&lt;String&gt; lines) {
        this.lines = lines;
    }

    // Invoked by the engine at time of data flow instantiation.
    public DataFlowOpInitializeResult initialize(DataFlowOpInitializateContext context) throws Exception {
        return null;	// can return type information here instead 
    }

    // Invoked by the engine at time of data flow instante execution.
    public void open(DataFlowOpOpenContext openContext) {
      // attach to input
    }

    // Invoked by the engine in a tight loop. 
    // Submits the events which contain lines of text.
    public void next() {
        // read and submit events
        if (lines.hasNext()) {
            dataFlowEmitter.submit(new Object[] {lines.next()});
        }
        else {
            dataFlowEmitter.submitSignal(new EPDataFlowSignalFinalMarker() {});
        }
    }

    // Invoked by the engine at time of cancellation or completion.
    public void close(DataFlowOpCloseContext openContext) {
      // detach from input
    }
}</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-op-second"/>20.6.2.Â Sample Tokenizer Operator</h3></div></div></div><p>
			  The implementation for the sample <code class="literal">MyTokenizerCounter</code> with comments is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Annotate with DataFlowOperator so the engine knows its a data flow operator
@DataFlowOperator

@OutputTypes({
    @OutputType(name = "line", type = int.class),
    @OutputType(name = "wordCount", type = int.class),
    @OutputType(name = "charCount", type = int.class)
    })

public class MyTokenizerCounter {

    @DataFlowContext
    private EPDataFlowEmitter dataFlowEmitter;

    // Name the method that receives data onInput(...)
    public void onInput(String line) {
        // tokenize
        StringTokenizer tokenizer = new StringTokenizer(line, " \t");
        int wordCount = tokenizer.countTokens();
        int charCount = 0;
        while(tokenizer.hasMoreTokens()) {
            String token = tokenizer.nextToken();
            charCount += token.length();
        }
        
        // submit count of line, words and characters
        dataFlowEmitter.submit(new Object[] {1, wordCount, charCount});
    }
}</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="dataflow-op-third"/>20.6.3.Â Sample Aggregator Operator</h3></div></div></div><p>
			  The implementation for the sample <code class="literal">MyWordCountAggregator</code> with comments is:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@DataFlowOperator

@OutputTypes(value = {
    @OutputType(name = "stats", type = MyWordCountStats.class)
    })
    
public class MyWordCountAggregator {
  
    @DataFlowContext
    private EPDataFlowEmitter dataFlowEmitter;

    private final MyWordCountStats aggregate = new MyWordCountStats();

    public void onInput(int lines, int words, int chars) {
        aggregate.add(lines, words, chars);
    }

    // Name the method that receives a marker onSignal
    public void onSignal(EPDataFlowSignal signal) {
        // Received puntuation, submit aggregated totals
        dataFlowEmitter.submit(aggregate);
    }
}</pre></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="examples"/>ChapterÂ 21.Â Examples, Tutorials, Case Studies</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#examples-overview">21.1. Examples Overview</a></span></dt><dt><span class="sect1"><a href="#examples-running">21.2. Running the Examples</a></span></dt><dt><span class="sect1"><a href="#examples-autoid">21.3. AutoID RFID Reader</a></span></dt><dt><span class="sect1"><a href="#examples-runtimeconfig">21.4. Runtime Configuration</a></span></dt><dt><span class="sect1"><a href="#examples-servershell">21.5. JMS Server Shell and Client</a></span></dt><dd><dl><dt><span class="sect2"><a href="#examples-servershell-processes">21.5.1. Overview</a></span></dt><dt><span class="sect2"><a href="#examples-servershell-jmsevents">21.5.2. JMS Messages as Events</a></span></dt><dt><span class="sect2"><a href="#examples-servershell-jmx">21.5.3. JMX for Remote Dynamic Statement Management</a></span></dt></dl></dd><dt><span class="sect1"><a href="#examples-marketdata-monitor">21.6. Market Data Feed Monitor</a></span></dt><dd><dl><dt><span class="sect2"><a href="#examples-marketdata-monitor-input">21.6.1. Input Events</a></span></dt><dt><span class="sect2"><a href="#examples-marketdata-computing">21.6.2. Computing Rates per Feed</a></span></dt><dt><span class="sect2"><a href="#examples-marketdata-falloff">21.6.3. Detecting a Fall-Off</a></span></dt><dt><span class="sect2"><a href="#examples-marketdata-monitor-sim">21.6.4. Event generator</a></span></dt></dl></dd><dt><span class="sect1"><a href="#examples-ohlcpluginview">21.7. OHLC Plug-In Data Window</a></span></dt><dt><span class="sect1"><a href="#examples-transaction-3-event-challenge">21.8. Transaction 3-Event Challenge</a></span></dt><dd><dl><dt><span class="sect2"><a href="#examples-txn3event-1">21.8.1. The Events</a></span></dt><dt><span class="sect2"><a href="#examples-txn3event-2">21.8.2. Combined Event</a></span></dt><dt><span class="sect2"><a href="#examples-txn3event-3">21.8.3. Real-Time Summary Data</a></span></dt><dt><span class="sect2"><a href="#examples-txn3event-4">21.8.4. Find Problems</a></span></dt><dt><span class="sect2"><a href="#examples-txn3event-5">21.8.5. Event Generator</a></span></dt></dl></dd><dt><span class="sect1"><a href="#examples-terminalsvc-J2EE">21.9. Self-Service Terminal</a></span></dt><dd><dl><dt><span class="sect2"><a href="#examples-terminalsvc-events">21.9.1. Events</a></span></dt><dt><span class="sect2"><a href="#examples-terminalsvc-pattern1">21.9.2. Detecting Customer Check-In Issues</a></span></dt><dt><span class="sect2"><a href="#examples-terminalsvc-pattern2">21.9.3. Absence of Status Events</a></span></dt><dt><span class="sect2"><a href="#examples-terminalsvc-epl1">21.9.4. Activity Summary Data</a></span></dt><dt><span class="sect2"><a href="#examples-terminalsvc-j2ee">21.9.5. Sample Application for J2EE Application Server</a></span></dt></dl></dd><dt><span class="sect1"><a href="#examples-assets-moving">21.10. Assets Moving Across Zones - An RFID Example</a></span></dt><dt><span class="sect1"><a href="#examples-stockticker">21.11. StockTicker</a></span></dt><dt><span class="sect1"><a href="#examples-matchmaker">21.12. MatchMaker</a></span></dt><dt><span class="sect1"><a href="#examples-namedwindowquery">21.13. Named Window Query</a></span></dt><dt><span class="sect1"><a href="#examples-virtualdw">21.14. Sample Virtual Data Window</a></span></dt><dt><span class="sect1"><a href="#examples-cycledetect">21.15. Sample Cycle Detection</a></span></dt><dt><span class="sect1"><a href="#examples-qossla">21.16. Quality of Service</a></span></dt><dt><span class="sect1"><a href="#examples-trivia">21.17. Trivia Geeks Club</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="examples-overview"/>21.1.Â Examples Overview</h2></div></div></div><p>
			This chapter outlines the examples that come with Esper in the <code class="literal">examples</code> folder of the distribution. Each sample is in a separate folder that contains all files needed by the example, excluding jar files.
		</p><p>
			Here is an overview over the examples in alphabetical order:
		</p><div class="table"><a id="d0e49227"/><p class="title"><b>TableÂ 21.1.Â Examples</b></p><div class="table-contents"><table summary="Examples" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a class="xref" href="#examples-autoid" title="21.3.Â AutoID RFID Reader">SectionÂ 21.3, âAutoID RFID Readerâ</a></td><td>
							<p>
								An array of RFID readers sense RFID tags as pallets are coming within the range of one of the readers.
							</p>
							<p>
								Shows the use of an XSD schema and XML event representation. A single statement shows a rolling time window, a where-clause filter on a nested property and a group-by.
							</p>
						</td></tr><tr><td><a class="xref" href="#examples-marketdata-monitor" title="21.6.Â Market Data Feed Monitor">SectionÂ 21.6, âMarket Data Feed Monitorâ</a></td><td>
							<p>
								Processes a raw market data feed and reports throughput statistics and detects when the data rate of a feed falls off unexpectedly.
							</p>
							<p>
								Demonstrates a batch time window and a rolling time window with a having-clause. Multi-threaded example with a configurable number of threads and a simulator for generating feed data.
							</p>
						</td></tr><tr><td><a class="xref" href="#examples-matchmaker" title="21.12.Â MatchMaker">SectionÂ 21.12, âMatchMakerâ</a></td><td>
							<p>
								In the MatchMaker example every mobile user has an X and Y location and the task of the event patterns created by this example is to detect mobile users that are within proximity given a certain range, and for which certain properties match preferences.
							</p>
							<p>
								Dynamically creates and removes event patterns that use range matching based on mobile user events received.
							</p>
						</td></tr><tr><td><a class="xref" href="#examples-namedwindowquery" title="21.13.Â Named Window Query">SectionÂ 21.13, âNamed Window Queryâ</a></td><td>
							<p>
								A mini-benchmark that handles temperature sensor events. The sample creates a named window and fills it with a large number of events. It then executes a large number of pre-defined queries as well as fire-and-forget queries and reports times.
							</p>
							<p>
								Study this example if you are interested in named windows, Map event type representation, fire-and-forget queries as well as pre-defined queries via on-select, and the performance aspects.
							</p>
						</td></tr><tr><td><a class="xref" href="#examples-virtualdw" title="21.14.Â Sample Virtual Data Window">SectionÂ 21.14, âSample Virtual Data Windowâ</a></td><td>
							<p>
								This example demonstrates the use of virtual data window to expose a (large) external data store, without any need to keep events in memory, and without sacrificing query performance.
							</p>
						</td></tr><tr><td><a class="xref" href="#examples-cycledetect" title="21.15.Â Sample Cycle Detection">SectionÂ 21.15, âSample Cycle Detectionâ</a></td><td>
							<p>
								This example showcases the aggregation multi-function extension API for use with a cycle-detection problem detecting cycles in transactions between accounts.
							</p>
						</td></tr><tr><td><a class="xref" href="#examples-ohlcpluginview" title="21.7.Â OHLC Plug-In Data Window">SectionÂ 21.7, âOHLC Plug-In Data Windowâ</a></td><td>
							<p>
								A plug-in custom data window addressing a problem in the financial space: Computes open-high-low-close bars for minute-intervals of events that may arrive late, based on each event's timestamp.
							</p>
							<p>
								A custom plug-in data window based on the extension API can be a convenient and reusable way to express a domain-specific analysis problem as a unit, and this example includes the code for the OHLC data window factory and window as well as simulator to test the window.
							</p>
						</td></tr><tr><td><a class="xref" href="#performance-kit" title="23.3.Â Using the Performance Kit">SectionÂ 23.3, âUsing the Performance Kitâ</a></td><td>
							<p>
								A benchmark that is further described in the performance section of this document under performance kit.
							</p>
						</td></tr><tr><td><a class="xref" href="#examples-qossla" title="21.16.Â Quality of Service">SectionÂ 21.16, âQuality of Serviceâ</a></td><td>
							<p>
								This example develops some code for measuring quality-of-service levels such as for a service-level agreement (SLA).
							</p>
							<p>
								This example combines patterns with select-statements, shows the use of the timer <code class="literal">'at'</code> operator and followed-by operator <code class="literal">-&gt;</code>, and uses the iterator API to poll for current results.
							</p>
						</td></tr><tr><td><a class="xref" href="#examples-assets-moving" title="21.10.Â Assets Moving Across Zones - An RFID Example">SectionÂ 21.10, âAssets Moving Across Zones - An RFID Exampleâ</a></td><td>
							<p>
								An example out of the RFID domain processes location report events. The example includes a simple Swing-based GUI for visualization allows moving tags from zone to zone visually. It also a contains comprehensive simulator to generate data for a large number of asset groups and their tracking.
							</p>
							<p>
								The example hooks up statements that aggregate and detect patterns in the aggregated data to determine when an asset group constraint is violated.
							</p>
						</td></tr><tr><td><a class="xref" href="#examples-runtimeconfig" title="21.4.Â Runtime Configuration">SectionÂ 21.4, âRuntime Configurationâ</a></td><td>
							<p>
								Example code to demonstrate various key runtime configuration options such as adding event types on-the-fly, adding new variables, adding plug-in single-row and aggregation functions and adding variant streams and revision type definition.
							</p>
						</td></tr><tr><td><a class="xref" href="#examples-servershell" title="21.5.Â JMS Server Shell and Client">SectionÂ 21.5, âJMS Server Shell and Clientâ</a></td><td>
							<p>
								The server shell is a Java Messaging Service (JMS) -based server and client that send and listens to messages on a JMS destination. It also demonstrates a simple Java Management Extension (JMX) MBean for remote statement management.
							</p>
							<p>
								A single EPL statement computes an average duration for each IP address on a rolling time window and outputs a snapshot every 2 seconds.
							</p>
						</td></tr><tr><td><a class="xref" href="#examples-stockticker" title="21.11.Â StockTicker">SectionÂ 21.11, âStockTickerâ</a></td><td>
							<p>
								An example from the financial domain that features event patterns to filter stock tick events based on price and symbol. The example is designed to provide a high volume of events and includes multithreaded unit test code as well as a simulting data generator.
							</p>
							<p>
								Perhaps this is a good example to learn the API and get started with event patterns. The example dynamically creates and removes event patterns based on price limit events received.
							</p>
						</td></tr><tr><td><a class="xref" href="#examples-terminalsvc-J2EE" title="21.9.Â Self-Service Terminal">SectionÂ 21.9, âSelf-Service Terminalâ</a></td><td>
							<p>
								A J2EE-based self-service terminal managing system in an airport that gets a lot of events from connected terminals.
							</p>
							<p>
								Contains a message-driven bean (EJB-MDB) for use in a J2EE container, a client and a simulator, as well as EPL statements for detecting various conditions. A version that runs outside of a J2EE container is also available.
							</p>
						</td></tr><tr><td><a class="xref" href="#examples-trivia" title="21.17.Â Trivia Geeks Club">SectionÂ 21.17, âTrivia Geeks Clubâ</a></td><td>
							<p>
								Trivia Geeks Club demonstrates EPL for a scoring system computing scores in a trivia game.
							</p>
						</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="examples-running"/>21.2.Â Running the Examples</h2></div></div></div><p>
			In order to compile and run the samples please follow the below instructions:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
                    Make sure Java 1.6 or greater is installed and the JAVA_HOME environment variable is set.
                </p></li><li><p>
                    Open a console window and change directory to examples/<span class="emphasis"><em>example_name</em></span>/etc.
                </p></li><li><p>
                    Run "setenv.bat" (Windows) or "setenv.sh" (Unix) to verify your environment settings.
                </p></li><li><p>
                    Run "compile.bat" (Windows) or "compile.sh" (Unix) to compile an example.
                </p></li><li><p>
                    Now you are ready to run an example. Some examples require mandatory parameters that are also described in the file "readme.txt" in the "etc" folder.
                </p></li><li><p>
                    Modify the logger logging level in the "log4j.xml" configuration file 
                    changing DEBUG to INFO on a class or package level to control the volume of text output. 
                </p></li></ol></div><p>
			Each example also provides Eclipse project <code class="literal">.classpath</code> and <code class="literal">.project</code> files. The Eclipse projects expect an <code class="literal">esper_runtime</code> user library that includes the runtime dependencies.
		</p><p>
			JUnit tests exist for the example code. The JUnit test source code for the examples can be found in each example's <code class="literal">src/test</code> folder. To build and run the example JUnit tests, use the Maven 2 goal <code class="literal">test</code>.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="examples-autoid"/>21.3.Â AutoID RFID Reader</h2></div></div></div><p>
			In this example an array of RFID readers sense RFID tags as pallets are coming within the range of one of the readers. 
			A reader generates XML documents with observation information such as reader sensor ID, observation time 
			and tags observed. A statement computes the total number of tags per reader sensor ID within the last 60 seconds.
		</p><p>
			This example demonstrates how XML documents unmarshalled to <code class="literal">org.w3c.dom.Node</code> DOM document nodes
			can natively be processed by the engine without requiring Java object event representations. The example uses an XPath
			expression for an event property counting the number of tags observed by a sensor. The XML documents follow the AutoID (<code class="literal">http://www.autoid.org/</code>) organization
			standard. 
		</p><p>
			The classes for this example can be found in package <code class="literal">com.espertech.esper.example.autoid</code>.
			As events are XML documents with no Java object representation, the example does not have event classes.
		</p><p>
			A simulator that can be run from the command line is also available for this example.
			The simulator generates a number of XML documents as specified by a command line argument and
			prints out the totals per sensor.
			Run "run_autoid.bat" (Windows) or "run_autoid.sh" (Unix) to start the AutoID simulator. 
			Please see the readme file in the same folder for build instructions and command line parameters.
		</p><p>
			The code snippet below shows the simple statement to compute the total number of tags per sensor. The statement is created by class 
			<code class="literal">com.espertech.esper.example.autoid.RFIDTagsPerSensorStmt</code>.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select ID as sensorId, sum(countTags) as numTagsPerSensor
from AutoIdRFIDExample#time(60 seconds)
where Observation[0].Command = 'READ_PALLET_TAGS_ONLY'
group by ID</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="examples-runtimeconfig"/>21.4.Â Runtime Configuration</h2></div></div></div><p>
			This example demonstrates various key runtime configuration options such as adding event types on-the-fly, adding new variables, adding plug-in single-row and aggregation functions and adding variant streams and revision type definition.
		</p><p>
			The classes for this example live in package <code class="literal">com.espertech.esper.example.runtimeconfig</code>. 
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="examples-servershell"/>21.5.Â JMS Server Shell and Client</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="examples-servershell-processes"/>21.5.1.Â Overview</h3></div></div></div><p>
				The server shell is a Java Messaging Service (JMS) -based server that listens to messages on a JMS destination, and sends the received events into Esper. The example also demonstrates a Java Management Extension (JMX) MBean that allows remote dynamic statement management. This server has been designed to run with either Tibco (TM) Enterprise Messaging System (Tibco EMS), or with Apache ActiveMQ, controlled by a properties file.			
			</p><p>
				The server shell has been created as an alternative to the EsperIO Spring JMSTemplate adapter.  The server shell is a low-latency processor for byte messages. It employs JMS listeners to process message in multiple threads, this model reduces thread context switching for many JMS providers. The server is configurable and has been tested with two JMS providers. It consists of only 10 classes and is thus easy to understand.
			</p><p>
				The server shell sample comes with a client (server shell client) that sends events into the JMS-based server, and that also creates a statement on the server remotely through a JMX MBean proxy class.
			</p><p>
				The server shell classes for this example live in package <code class="literal">com.espertech.esper.example.servershell</code>. 
				Configure the server to point to your JMS provider by changing the properties in the file <code class="literal">servershell_config.properties</code> in the <code class="literal">etc</code> folder.
				Make sure your JMS provider (ActiveMQ or Tibco EMS) is running, then run "run_servershell.bat" (Windows) or "run_servershell.sh" (Unix) to start the JMS server. 
			</p><p>
				Start the server shell process first before starting the client, since the client also demonstrates remote statement management through JMX by attaching to the server process.
			</p><p>		
				The client classes to the server shell can be found in package <code class="literal">com.espertech.esper.example.servershellclient</code>. 
				The client shares the same configuration file as the server shell.
				Run "run_servershellclient.bat" (Windows) or "run_servershellclient.sh" (Unix) to start the JMS producer client  that includes a JMX client as well. 
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="examples-servershell-jmsevents"/>21.5.2.Â JMS Messages as Events</h3></div></div></div><p>
				The server shell starts a configurable number of JMS <code class="literal">MessageListener</code> instances that listen to a given JMS destination. The listeners expect a <code class="literal">BytesMessage</code> that contain a String payload. The payload consists of an IP address and a double-typed duration value separated by a comma.
			</p><p>
				Each listener extracts the payload of a message, constructs an event object and sends the event into the shared Esper engine instance. 
			</p><p>
				At startup time, the server creates a single EPL statement with the Esper engine that prints out the average duration per IP address for the last 10 seconds of events, and that specifies an output rate of 2 seconds. By running the server and then the client, you can see the output of the averages every 2 seconds.
			</p><p>
				The server shell client acts as a JMS producer that sends 1000 events with random IP addresses and durations.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="examples-servershell-jmx"/>21.5.3.Â JMX for Remote Dynamic Statement Management</h3></div></div></div><p>
				The server shell is also a JMX server providing an RMI-based connector. The server shell exposes a JMX MBean that allows remote statement management. The JMX MBean allows to create a statement remotely, attach a listener to the statement and destroy a statement remotely. 
			</p><p>
				The server shell client, upon startup, obtains a remote instance of the management MBean exposed by the server shell. It creates a statement through the MBean that filters out all durations greater then the value 9.9. 
				After sending 1000 events, the client then destroys the statement remotely on the server.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="examples-marketdata-monitor"/>21.6.Â Market Data Feed Monitor</h2></div></div></div><p>
			This example processes a raw market data feed. It reports throughput statistics and 
			detects when the data rate of a feed falls off unexpectedly. A rate fall-off may mean that the data is stale and 
			you want to alert when there is a possible problem with the feed.
		</p><p>
			The classes for this example live in package <code class="literal">com.espertech.esper.example.marketdatafeed</code>. 
			Run "run_mktdatafeed.bat" (Windows) or "run_mktdatafeed.sh" (Unix) in the <code class="literal">examples/etc</code> folder 
			to start the market data feed simulator. 			
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="examples-marketdata-monitor-input"/>21.6.1.Â Input Events</h3></div></div></div><p>
				The input stream consists of 1 event stream that contains 2 simulated market data feeds. Each individual event in the stream 
				indicates the feed that supplies the market data, the security symbol and some pricing information:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String symbol;
FeedEnum feed;
double bidPrice;
double askPrice;
</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="examples-marketdata-computing"/>21.6.2.Â Computing Rates per Feed</h3></div></div></div><p>
				For throughput statistics and to detect rapid fall-off, the example calculates a ticks per second rate for each market data feed. 
			</p><p>
				You can use an EPL statement that specifies a data window onto the market data event stream that batches together 1 second of events. 
				You specify the feed and a count of events per feed as output values. To make this data available for further processing, you
				insert output events into the TicksPerSecond event stream:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into TicksPerSecond
select feed, count(*) as cnt 
  from MarketDataEvent#time_batch(1 second) 
 group by feed</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="examples-marketdata-falloff"/>21.6.3.Â Detecting a Fall-Off</h3></div></div></div><p>
				We define a rapid fall-off by alerting when the number of ticks per second for any second falls below 75% of the 
				average number of ticks per second over the last 10 seconds. 
			</p><p>
				We can compute the average number of ticks per second over the last 10 seconds simply by using the TicksPerSecond events computed by the
				prior statement and averaging the last 10 seconds. Next, the example compares the current rate with the moving average and
				filter out any rates that fall below 75% of the average:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select feed, avg(cnt) as avgCnt, cnt as feedCnt 
  from TicksPerSecond#time(10 seconds)
 group by feed 
having cnt &lt; avg(cnt) * 0.75</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="examples-marketdata-monitor-sim"/>21.6.4.Â Event generator</h3></div></div></div><p>
				The simulator generates market data events for 2 feeds, feed A and feed B. 
				The first parameter to the simulator is a number of threads. Each thread sends events for each feed in an endless loop.
				Note that as the Java VM garbage collection kicks in, the example generates rate drop-offs during such pauses.
			</p><p>
				The second parameter is a rate drop probability parameter specifies the probability in percent that the simulator drops the rate 
				for a randomly chosen feed to 60% of the target rate for that second. Thus rate fall-off alerts can be generated.
			</p><p>
				The third parameter defines the number of seconds to run the example.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="examples-ohlcpluginview"/>21.7.Â OHLC Plug-In Data Window</h2></div></div></div><p>
			This example contains a fully-functional custom data window based on the extension API that computes OHLC open-high-low-close bars for events that provide a long-typed timestamp and a double-typed value.
        </p><p>
			OHLC bar is a problem out of the financial domain. The "Open" refers to the first datapoint and the "Close" to the last datapoint in an interval. The "High" refers to the maximum and the "Low" to the minimum value during each interval. The term "bar" is used to describe each interval results of these 4 values.
        </p><p>
			The example provides an OHLC data window that is hardcoded to 1-minute bars. It considers the timestamp value carried by each event, and not the system time. The cutoff time after which an event is no longer considered for a bar is hardcoded to 5 seconds.
        </p><p>
			The window assumes that events arrive in timestamp order: Each event's timestamp value is equal to or higher then the timestamp value provided by the prior event.
        </p><p>
			The window may also be used together with <code class="literal">#groupwin</code> to group per criteria, such as symbol. In this case the assumption of timestamp order applies per symbol.
        </p><p>
			The window gracefully handles no-event and late-event scenarios. Interval boundaries are defined by system time, thus event timestamp and system time must roughly be in-sync, unless using external timer events.
        </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="examples-transaction-3-event-challenge"/>21.8.Â Transaction 3-Event Challenge</h2></div></div></div><p>
			The classes for this example live in package <code class="literal">com.espertech.esper.example.transaction</code>. 
			Run "run_txnsim.bat" (Windows) or "run_txnsim.sh" (Unix) to start the transaction simulator. 
			Please see the readme file in the same folder for build instructions and command line parameters.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="examples-txn3event-1"/>21.8.1.Â The Events</h3></div></div></div><p>
	The use case involves tracking three components of a transaction. It's important that the example uses at least three components, since some engines have different performance or coding for only two events per transaction. Each component comes to the engine as an event with the following fields:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						Transaction ID
					</p></li><li><p>
						Time stamp
					</p></li></ul></div><p>
				In addition, the example has the following extra fields:
			</p><p>
				In event A:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						Customer ID
					</p></li></ul></div><p>
				In event C:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						Supplier ID (the ID of the supplier that the order was filled through)
					</p></li></ul></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="examples-txn3event-2"/>21.8.2.Â Combined Event</h3></div></div></div><p>
					We need to take in events A, B and C and produce a single, combined event with the following fields:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						Transaction ID
					</p></li><li><p>
						Customer ID
					</p></li><li><p>
						Time stamp from event A
					</p></li><li><p>
						Time stamp from event B
					</p></li><li><p>
						Time stamp from event C
					</p></li></ul></div><p>
What weâre doing here is matching the transaction IDs on each event, to form an aggregate event. If all these events were in a relational database, this could be done as a simple SQL joinâ¦ except that with 10,000 events per second, you will need some serious database hardware to do it.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="examples-txn3event-3"/>21.8.3.Â Real-Time Summary Data</h3></div></div></div><p>
Further, the example produces the following:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						Min,Max,Average total latency from the events (difference in time between A and C) over the past 30 minutes.
					</p></li><li><p>
						Min,Max,Average latency grouped by (a) customer ID and (b) supplier ID. In other words, metrics on the the latency of the orders coming from each customer and going to each supplier.
					</p></li><li><p>
						Min,Max,Average latency between events A/B (time stamp of B minus A) and B/C (time stamp of C minus B).
					</p></li></ul></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="examples-txn3event-4"/>21.8.4.Â Find Problems</h3></div></div></div><p>
The example detects a transaction that did not make it through all three events. In other words, a transaction with events A or B, but not C. Note that, in this case, what you care about is event C. The lack of events A or B could indicate a failure in the event transport and should be ignored. Although the lack of an event C could also be a transport failure, it merits looking into.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="examples-txn3event-5"/>21.8.5.Â Event Generator</h3></div></div></div><p>
To make testing easier, standard and to demonstrate how the example works, the example is including an event generator. The generator generates events for a given number of transactions, using the following rules:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						One in 5,000 transactions will skip event A
					</p></li><li><p>
						One in 1,000 transactions will skip event B
					</p></li><li><p>
						One in 10,000 transactions will skip event C.
					</p></li><li><p>
						Transaction identifiers are randomly generated
					</p></li><li><p>
						Customer and supplier identifiers are randomly chosen from two lists
					</p></li><li><p>
						The time stamp on each event is based on the system time. Between events A and B as well as B and C, between 0 and 999 is added to the time. So, you have an expected time difference of around 500 milliseconds between each event
					</p></li><li><p>
						Events are randomly shuffled as described below
					</p></li></ul></div><p>
	To make things harder, the example doesn't have transaction events coming in order. This code ensures that they come completely out of order. To do this, the example fills in a bucket with events and, when the bucket is full, it shuffles it. The buckets are sized so that some transactionsâ events will be split between buckets. So, you have a fairly randomized flow of events, representing the worst case from a big, distributed infrastructure.
				</p><p>
	The generator lets you change the size of the bucket (small, medium, large, larger, largerer). The larger the bucket size, the more events potentially come in between two events in a given transaction and so, the more the performance characteristics like buffers, hashes/indexes and other structures are put to the test as the bucket size increases.
				</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="examples-terminalsvc-J2EE"/>21.9.Â Self-Service Terminal</h2></div></div></div><p>
			The example is about a J2EE-based self-service terminal managing system in an airport that gets a lot of events from connected terminals. The event rate is around 500 events per second. Some events indicate abnormal situations such as 'paper low' or 'terminal out of order'. Other events observe activity as customers use a terminal to check in and print boarding tickets.
		</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="examples-terminalsvc-events"/>21.9.1.Â Events</h3></div></div></div><p>
				Each self-service terminal can publish any of the 6 events below.
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						Checkin - Indicates a customer started a check-in dialog
					</p></li><li><p>
						Cancelled - Indicates a customer cancelled a check-in dialog
					</p></li><li><p>
						Completed	- Indicates a customer completed a check-in dialog
					</p></li><li><p>
						OutOfOrder - Indicates the terminal detected a hardware problem
					</p></li><li><p>
						LowPaper	- Indicates the terminal is low on paper
					</p></li><li><p>
						Status - Indicates terminal status, published every 1 minute regardless of activity as a terminal heartbeat
					</p></li></ul></div><p>
				All events provide information about the terminal that published the event, and a timestamp. The terminal information is held in a property named "term" and provides a terminal id. Since all events carry similar information, it models each event as a subtype to a base class BaseTerminalEvent, which will provide the terminal information that all events share. This enables us to treat all terminal events polymorphically, that is you can treat derived event types just like their parent event types. This helps simplify our queries.
			</p><p>
				All terminals publish Status events every 1 minute. In normal cases, the Status events indicate that a terminal is alive and online. The absence of status events may indicate that a terminal went offline for some reason and that may need to be investigated.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="examples-terminalsvc-pattern1"/>21.9.2.Â Detecting Customer Check-In Issues</h3></div></div></div><p>
				A customer may be in the middle of a check-in when the terminal detects a hardware problem or when the network goes down. In that situation the example alerts a team member to help the customer. When the terminal detects a problem, it issues an OutOfOrder event. A pattern can find situations where the terminal indicates out-of-order and the customer is in the middle of the check-in process:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern [ every a=Checkin -&gt; 
      ( OutOfOrder(term.id=a.term.id) and not 
          (Cancelled(term.id=a.term.id) or Completed(term.id=a.term.id)) )]</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="examples-terminalsvc-pattern2"/>21.9.3.Â Absence of Status Events</h3></div></div></div><p>
				Since Status events arrive in regular intervals of 60 seconds, you can make use of temporal pattern matching using timer to find events that didn't arrive. You can use the every operator and timer:interval() to repeat an action every 60 seconds. Then you combine this with a not operator to check for absence of Status events. A 65 second interval during which you look for Status events allows 5 seconds to account for a possible delay in transmission or processing:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select 'terminal 1 is offline' from pattern 
  [every timer:interval(60 sec) -&gt; (timer:interval(65 sec) and not Status(term.id = 'T1'))]
output first every 5 minutes</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="examples-terminalsvc-epl1"/>21.9.4.Â Activity Summary Data</h3></div></div></div><p>
				By presenting statistical information about terminal activity to our staff in real-time you enable them to monitor the system and spot problems. The next example query simply gives us a count per event type every 1 minute. You could further use this data, available through the CountPerType event stream, to join and compare against a recorded usage pattern, or to just summarize activity in real-time.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into CountPerType
select type, count(*) as countPerType 
from BaseTerminalEvent#time(10 minutes) 
group by type
output all every 1 minutes</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="examples-terminalsvc-j2ee"/>21.9.5.Â Sample Application for J2EE Application Server</h3></div></div></div><p>
				The example code in the distribution package implements a message-driven enterprise java bean (MDB EJB). The example uses an MDB as a convenient place for processing incoming events via a JMS message queue or topic. The example uses 2 JMS queues: One queue to receive events published by terminals, and a second queue to indicate situations detected via EPL statement and listener back to a receiving process.
			</p><p>
				This example has been packaged for deployment into a JBoss Java application server (see http://www.jboss.org) with default deployment configuration. JBoss is an open-source application server available under LGPL license. Of course the choice of application server does not indicate a requirement or preference for the use of Esper in a J2EE container. Other quality J2EE application servers are available and perhaps more suitable to run this example or a similar application.
			</p><p>
				The complete example code can be found in the "examples/terminalsvc" folder of the distribution. The standalone version that does not require a J2EE container is in "examples/terminalsvc-jse".
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="examples-terminalsvc-j2ee-running"/>21.9.5.1.Â Running the Example</h4></div></div></div><p>
					The pre-build EAR file contains the MDB for deployment to a JBoss application server with default deployment options. The JBoss default configuration provides 2 queues that this example utilizes: queue/A and queue/B. The queue/B is used to send events into the MDB, while queue/A is used to indicate back the any data received by listeners to EPL statements.
				</p><p>
					The application can be deployed by copying the ear file in the "examples/terminalsvc/terminalsvc-ear" folder to your JBoss deployment directory located under the JBoss home directory under "standalone/deployments".
				</p><p>
					The example contains an event simulator and an event receiver that can be invoked from the command line. See the folder "examples/terminalsvc/etc" folder readme file and start scripts for Windows and Unix, and the documentation set for further information on the simulator.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="examples-terminalsvc-j2ee-building"/>21.9.5.2.Â Building the Example</h4></div></div></div><p>
					This example requires Maven 2 to build. To build the example, change directory to the folder "examples/terminalsvc" and type "mvn package". The instructions have been tested with JBoss AS 7.1.1  and Maven 3.0.4.
				</p><p>
					The Maven build packages the EAR file for deployment to a JBoss application server with default deployment options.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="examples-terminalsvc-j2ee-running-sim"/>21.9.5.3.Â Running the Event Simulator and Receiver</h4></div></div></div><p>
						The example also contains an event simulator that generates meaningful events. The simulator can be run from the directory "examples/terminalsvc/etc" via the command "run_terminalsvc_sender.bat" (Windows) and "run_terminalsvc_sender.sh" (Linux). The event simulator generates a batch of at least 200 events every 1 second. Randomly, with a chance of 1 in 10 for each batch of events, the simulator generates either an OutOfOrder or a LowPaper event for a random terminal. Each batch the simulator generates 100 random terminal ids and generates a Checkin event for each. It then generates either a Cancelled or a Completed event for each. With a chance of 1 in 1000, it generates an OutOfOrder event instead of the Cancelled or Completed event for a terminal.
					</p><p>
						The event receiver listens to the MDB-outcoming queue for alerts and prints these out to console. The receiver can be run from the directory "examples/terminalsvc/etc" via the command "run_terminalsvc_receiver.bat" (Windows) and "run_terminalsvc_receiver.sh" (Linux). Before running please copy the <code class="literal">jboss-client.jar</code> file from your JBoss AS installation bin directory to the "terminalsvc/lib" folder.
					</p><p>
					  The receiver and sender code use "guest" as user and "pass" as password. Add the "guest" user using the Jboss "add-user" script and assign the role "guest".
					  Your JBoss server may need to start with "-c standalone-full.xml" to have the messaging subsystem available.
					</p><p>
					  Add queue configurations to the messaging subsystem configuration as follows:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;jms-queue name="queue_a"&gt;
  &lt;entry name="queue_a"/&gt;
  &lt;entry name="java:jboss/exported/jms/queue/queue_a"/&gt;
&lt;/jms-queue&gt;
&lt;jms-queue name="queue_b"&gt;
  &lt;entry name="queue_b"/&gt;
  &lt;entry name="java:jboss/exported/jms/queue/queue_b"/&gt;
&lt;/jms-queue&gt;</pre><p>
					  Disable persistence in the messaging subsystem for this example so it is not running out of disk space:
					</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;persistence-enabled&gt;false&lt;/persistence-enabled&gt;</pre></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="examples-assets-moving"/>21.10.Â Assets Moving Across Zones - An RFID Example</h2></div></div></div><p>
			This example out of the RFID domain processes location report events. Each location report event indicates an asset id and the current zone of the asset. 
			The example solves the problem that when a given set of assets is not moving together from zone to zone, then an alert must be fired.
		</p><p>
			Each asset group is tracked by 2 statements. The two statements to track a single asset group consisting of assets identified by asset ids {1, 2, 3} are as follows:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into CountZone_G1
select 1 as groupId, zone, count(*) as cnt
from LocationReport(assetId in 1, 2, 3)#unique(assetId)
group by zone

select Part.zone from pattern [
  every Part=CountZone_G1(cnt in (1,2)) -&gt;
    (timer:interval(10 sec)  and not CountZone_G1(zone=Part.zone, cnt in (0,3)))]</pre><p>
			The classes for this example can be found in package <code class="literal">com.espertech.esper.example.rfid</code>.
		</p><p>
			This example provides a Swing-based GUI that can be run from the command line.
			The GUI allows drag-and-drop of three RFID tags that form one asset group from zone to zone. Each time you move an asset across the screen the example sends an
			event into the engine indicating the asset id and current zone. The example detects if within 10 seconds the three assets do not join each other
			within the same zone, but stay split across zones.
			Run "run_rfid_swing.bat" (Windows) or "run_rfid_swing.sh" (Unix) to start the example's Swing GUI. 
		</p><p>
			The example also provides a simulator that can be run from the command line.
			The simulator generates a number of asset groups as specified by a command line argument and starts a number of threads as specified by a command line argument
			to send location report events into the engine.
			Run "run_rfid_sim.bat" (Windows) or "run_rfid_sim.sh" (Unix) to start the RFID location report event simulator. 
			Please see the readme file in the same folder for build instructions and command line parameters.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="examples-stockticker"/>21.11.Â StockTicker</h2></div></div></div><p>
			 The StockTicker example comes from the stock trading domain. The example creates event patterns to filter stock tick events based on price and symbol. 
			 When a stock tick event is encountered that falls outside the lower or upper price limit, the example simply displays that stock tick event.
			 The price range itself is dynamically created and changed. This is accomplished by an event patterns that searches for another event class, the price limit event.			 			 
		</p><p>
			The classes <code class="literal">com.espertech.esper.example.stockticker.event.StockTick</code> and <code class="literal">PriceLimit</code> represent our events. The event patterns are created by the class <code class="literal">com.espertech.esper.example.stockticker.monitor.StockTickerMonitor</code>. 
		</p><p>
			Summary:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
                    Good example to learn the API and get started with event patterns
                </p></li><li><p>
                    Dynamically creates and removes event patterns based on price limit events received
                </p></li><li><p>
                    Simple, highly-performant filter expressions for event properties in the stock tick event such as symbol and price
                </p></li></ul></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="examples-matchmaker"/>21.12.Â MatchMaker</h2></div></div></div><p>
			 In the MatchMaker example every mobile user has an X and Y location, a set of properties (gender, hair color, age range) and a set of preferences (one for each property) to match. The task of the event patterns created by this example is to detect mobile users that are within proximity given a certain range, and for which the properties match preferences.
		</p><p>
			The event class representing mobile users is <code class="literal">com.espertech.esper.example.matchmaker.event.MobileUserBean</code>. The <code class="literal">com.espertech.esper.example.matchmaker.monitor.MatchMakingMonitor</code> class contains the patterns for detecing matches.
		</p><p>
			Summary:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
                    Dynamically creates and removes event patterns based on mobile user events received
                </p></li><li><p>
                    Uses range matching for X and Y properties of mobile user events
                </p></li></ul></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="examples-namedwindowquery"/>21.13.Â Named Window Query</h2></div></div></div><p>
			This example handles very minimal temperature sensor events which are represented by <code class="literal">java.util.Map</code>. It creates a named window and fills it with a large number of events. It then executes a large number of pre-defined queries via on-select as well as performs a large number of fire-and-forget queries against the named window, and reports execution times.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="examples-virtualdw"/>21.14.Â Sample Virtual Data Window</h2></div></div></div><p>
			Virtual data windows are an extension API used to integrate external stores and expose the data therein as a named window.
		</p><p>
		   See the <code class="literal">virtualdw</code> folder for example code, compile and run scripts.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="examples-cycledetect"/>21.15.Â Sample Cycle Detection</h2></div></div></div><p>
			The example is also discussed in the section on extension APIs specifically the aggregation multi-function development.
			The example uses the <code class="literal">jgrapht</code> library for a cycle-detection problem detecting cycles in transactions between accounts.
		</p><p>
		   See the <code class="literal">examples/cycledetect</code> folder for example code, compile and run scripts.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="examples-qossla"/>21.16.Â Quality of Service</h2></div></div></div><p>
            This example develops some code for measuring quality-of-service levels such as for a service-level agreement (SLA).
            A SLA is a contract between 2 parties that defines service constraints such as maximum latency for service operations or error rates.
        </p><p>                      
            The example measures and monitors operation latency and error counts per customer and operation. When 
            one of our operations oversteps these constraints, you want to be alerted right away. Additionally, you would like to have some monitoring in
            place that checks the health of our service and provides some information on how the operations are used.
        </p><p>                      
            Some of the constraints you need to check are:
         </p><div class="itemizedlist"><ul compact="compact"><li><p>
					That the latency (time to finish) of some of the operations is always less then X seconds.
				</p></li><li><p>
					That the latency average is always less then Y seconds over Z operation invocations. 
				</p></li></ul></div><p>
			The <code class="literal">com.espertech.esper.example.qos_sla.events.OperationMeasurement</code> event class with its latency and status properties is the main event used for the SLA analysis. The other event <code class="literal">LatencyLimit</code> serves to set latency limits on the fly.
		</p><p>
			The <code class="literal">com.espertech.esper.example.qos_sla.monitor.AverageLatencyMonitor</code> creates an EPL statement that computes latency statistics per customer and operation for the
			last 100 events. The <code class="literal">DynaLatencySpikeMonitor</code> uses an event pattern to listen to spikes in latency with dynamically set limits. The <code class="literal">ErrorRateMonitor</code> uses the timer <code class="literal">'at'</code> operator in an event pattern that wakes up periodically and polls the error rate within the last 10 minutes. The <code class="literal">ServiceHealthMonitor</code> simply alerts when 3 errors occur, and the <code class="literal">SpikeAndErrorMonitor</code> alerts when a fixed latency is overstepped or an error status is reported.
		</p><p>
			Summary:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
                    This example combines event patterns with EPL statements for event stream analysis.
                </p></li><li><p>
                    Shows the use of the timer <code class="literal">'at'</code> operator and followed-by operator <code class="literal">-&gt;</code> in event patterns.
                </p></li><li><p>
                    Outlines basic EPL statements.
                </p></li><li><p>
                    Shows how to pull data out of EPL statements rather then subscribing to events a statement publishes.
                </p></li></ul></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="examples-trivia"/>21.17.Â Trivia Geeks Club</h2></div></div></div><p>
            This example was developed for the DEBS 2011 conference and demonstrates how scoring rules for a trivia game can be implemented in EPL.
        </p><p>
          The EPL module that implements all scoring rules is located in the <code class="literal">etc</code> folder in file <code class="literal">trivia.epl</code>. The EPL is all required to run the solution without any custom functions required.
        </p><p>
           The trivia geeks club rules (the requirements) are provided in the <code class="literal">etc</code> folder in file <code class="literal">trivia_scoring_requirements.htm</code>.
        </p><p>
           The implementation provided tests the questions, answers and scoring according to the data provided in <code class="literal">trivia_test_questions_small.htm</code> and <code class="literal">trivia_test_questions_large.htm</code>.
        </p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="bytecodegen"/>ChapterÂ 22.Â Byte Code Generation</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#bytecodegen_intro">22.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#bytecodegen_usage">22.2. Usage Notes</a></span></dt><dd><dl><dt><span class="sect2"><a href="#bytecodegen_criteria">22.2.1. Criteria</a></span></dt><dt><span class="sect2"><a href="#bytecodegen_fallback">22.2.2. Fallback</a></span></dt><dt><span class="sect2"><a href="#bytecodegen_logging">22.2.3. Logging</a></span></dt><dt><span class="sect2"><a href="#bytecodegen_debugging">22.2.4. Debugging Generated Code</a></span></dt></dl></dd></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="bytecodegen_intro"/>22.1.Â Introduction</h2></div></div></div><a id="d0e50004" class="indexterm"/><p>
			Esper generates byte code for EPL statements. Byte code generation is a technique that blends state-of-the-art from modern compilers and MPP databases. 
		</p><p>
			Byte code generation can significantly speed up processing as it eliminates many virtual calls and especially megamorphic calls (a callsite with 3 or more possible implementations is megamorphic) as well as casts and branching.
			Byte code generation allows the runtime to optimize the generated code and allows the hardware to execute faster.
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>
				The engine implements the best architecture for performance engineering in data processing by performing byte code generation.
				Not all workloads can benefit from byte code generation to the same degree. 
			</p></div><p>
			Byte code generation is enabled by default and can be disabled entirely. Please refer to <a class="xref" href="#config-engine-bytecodegen" title="15.4.12.Â Engine Settings Related to Byte Code Generation and Compilation">SectionÂ 15.4.12, âEngine Settings Related to Byte Code Generation and Compilationâ</a> for configuration options.
		</p><p>
			For example, consider the expression <code class="literal">a + b</code> (field <code class="literal">a</code> plus field <code class="literal">b</code>).
			Upon creating a statement the engine performs these steps:
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					Analyzes the expression and determines where fields <code class="literal">a</code> and <code class="literal">b</code> come from (for example event type or variable) and the field type (for example string or integer).
				</p></li><li><p>
					Verifies that the addition arithmetic operation can indeed be applied to the two fields. It verifies that both fields are indeed numeric and can thus be added.
				</p></li></ol></div><p>
			Without byte code generation, for example, in order to evaluate the expression <code class="literal">a + b</code> the VM makes 3 virtual calls: One to obtain the value of field <code class="literal">a</code>, one to obtain the value of field <code class="literal">b</code> and one to perform the <code class="literal">+</code> plus-operation.
		</p><p>
			With byte code generation the engine can reduce the number of virtual calls. In the best case the number of virtual calls to evaluate the <code class="literal">a + b</code> expression is one (for the invocation of the generated code itself).
		</p><p>
			All byte code generation takes place at time of EPL statement creation (and not at runtime).
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="bytecodegen_usage"/>22.2.Â Usage Notes</h2></div></div></div><a id="d0e50068" class="indexterm"/><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bytecodegen_criteria"/>22.2.1.Â Criteria</h3></div></div></div><p>
				In the default configuration, the engine generates code for: 
			</p><div class="itemizedlist"><ul><li><p>
						The result-set-processing including the select-clause, aggregation processing and all expressions therein, including the group-by, having-clause and order-by clause processing.
					</p></li><li><p>
						 All other interdependent expressions (expressions that depend on other expressions).
					</p></li></ul></div><p>
				The engine does not generate code for (not a comprehensive list):
			</p><div class="itemizedlist"><ul><li><p>Constants and other expressions that can typically be evaluated with zero or very few virtual calls.</p></li><li><p>Expressions that only perform a state lookup such as the <code class="literal">prev</code> or <code class="literal">prior</code> function.</p></li></ul></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bytecodegen_fallback"/>22.2.2.Â Fallback</h3></div></div></div><p>
				By default, in the case that byte code generation fails, the engine logs a WARN-level message and falls back to regular evaluation, all at time of EPL statement creation.
				Please report any stack traces as a Github issue and include the code that was produced by byte code generation as well as the EPL statement.
				The fallback can be disabled by configuration.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bytecodegen_logging"/>22.2.3.Â Logging</h3></div></div></div><p>
				You can log generated classes at INFO log level by setting the configuration flag for code logging as described in <a class="xref" href="#config-engine-logging-code" title="15.4.16.5.Â Byte Code Generation Logging">SectionÂ 15.4.16.5, âByte Code Generation Loggingâ</a>.
			</p><p>
				As an alternative you can configure your log provider configuration file by setting DEBUG level for class <code class="literal">com.espertech.esper.codegen.compile.CodegenCompilerJanino</code> (provider class may change between versions).
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="bytecodegen_debugging"/>22.2.4.Â Debugging Generated Code</h3></div></div></div><p>
				The information herein is for developers and is specific to the Janino compiler at the version provided with the distribution.
			</p><p>
				To have Janino generate classes into a given directory, define the system property <code class="literal">org.codehaus.janino.source_debugging.dir</code> to a file system directory.
				The IDE can debug into generated classes and show the source code provided that the IDE can access the source code.
			</p><p>
				To include debug symbol information in the class binaries, or to include additional comments regarding the generating code itself in the generated source code, 
				you must change the configuration as outlined in <a class="xref" href="#config-engine-bytecodegen" title="15.4.12.Â Engine Settings Related to Byte Code Generation and Compilation">SectionÂ 15.4.12, âEngine Settings Related to Byte Code Generation and Compilationâ</a>.
			</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="performance"/>ChapterÂ 23.Â Performance</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#performance-results">23.1. Performance Results</a></span></dt><dt><span class="sect1"><a href="#performance-tips">23.2. Performance Tips</a></span></dt><dd><dl><dt><span class="sect2"><a href="#perf-tips-1">23.2.1. Understand How to Tune Your Java Virtual Machine</a></span></dt><dt><span class="sect2"><a href="#perf-tips-3">23.2.2. Input and Output Bottlenecks</a></span></dt><dt><span class="sect2"><a href="#perf-tips-3-a">23.2.3. Theading</a></span></dt><dt><span class="sect2"><a href="#perf-tips-4">23.2.4. Select the Underlying Event Rather Than Individual Fields</a></span></dt><dt><span class="sect2"><a href="#perf-tips-5">23.2.5. Prefer Stream-Level Filtering Over Where-Clause Filtering</a></span></dt><dt><span class="sect2"><a href="#perf-tips-6">23.2.6. Reduce the Use of Arithmetic in Expressions</a></span></dt><dt><span class="sect2"><a href="#perf-tips-6a">23.2.7. Remove Unneccessary Constructs</a></span></dt><dt><span class="sect2"><a href="#perf-tips-6b">23.2.8. End Pattern Sub-Expressions</a></span></dt><dt><span class="sect2"><a href="#perf-tips-7">23.2.9. Consider Using EventPropertyGetter for Fast Access to Event Properties</a></span></dt><dt><span class="sect2"><a href="#perf-tips-8">23.2.10. Consider Casting the Underlying Event</a></span></dt><dt><span class="sect2"><a href="#perf-tips-9">23.2.11. Turn Off Logging and Audit</a></span></dt><dt><span class="sect2"><a href="#perf-tips-11">23.2.12. Tune or Disable Delivery Order Guarantees</a></span></dt><dt><span class="sect2"><a href="#perf-tips-12">23.2.13. Use a Subscriber Object to Receive Events</a></span></dt><dt><span class="sect2"><a href="#perf-tips-12b">23.2.14. Consider Data Flows</a></span></dt><dt><span class="sect2"><a href="#perf-tips-13">23.2.15. High-Arrival-Rate Streams and Single Statements</a></span></dt><dt><span class="sect2"><a href="#perf-tips-13a">23.2.16. Subqueries Versus Joins and Where-Clause and Data Windows</a></span></dt><dt><span class="sect2"><a href="#perf-tips-13b">23.2.17. Patterns and Pattern Sub-Expression Instances</a></span></dt><dt><span class="sect2"><a href="#perf-tips-13b2">23.2.18. Pattern Sub-Expression Instance Versus Data Window Use</a></span></dt><dt><span class="sect2"><a href="#perf-tips-13c">23.2.19. The Keep-All Data Window</a></span></dt><dt><span class="sect2"><a href="#perf-tips-13d">23.2.20. Statement Design for Reduced Memory Consumption - Diagnosing OutOfMemoryError</a></span></dt><dt><span class="sect2"><a href="#perf-tips-14">23.2.21. Performance, JVM, OS and Hardware</a></span></dt><dt><span class="sect2"><a href="#perf-tips-15">23.2.22. Consider Using Hints</a></span></dt><dt><span class="sect2"><a href="#perf-tips-16">23.2.23. Optimizing Stream Filter Expressions</a></span></dt><dt><span class="sect2"><a href="#perf-tips-17">23.2.24. Statement and Engine Metric Reporting</a></span></dt><dt><span class="sect2"><a href="#perf-tips-18">23.2.25. Expression Evaluation Order and Early Exit</a></span></dt><dt><span class="sect2"><a href="#perf-tips-19">23.2.26. Large Number of Threads</a></span></dt><dt><span class="sect2"><a href="#perf-tips-19a">23.2.27. Filter Evaluation Tuning</a></span></dt><dt><span class="sect2"><a href="#perf-tips-20">23.2.28. Context Partition Related Information</a></span></dt><dt><span class="sect2"><a href="#perf-tips-21">23.2.29. Prefer Constant Variables Over Non-Constant Variables</a></span></dt><dt><span class="sect2"><a href="#perf-tips-22">23.2.30. Prefer Object-Array Events</a></span></dt><dt><span class="sect2"><a href="#perf-tips-23">23.2.31. Composite or Compound Keys</a></span></dt><dt><span class="sect2"><a href="#perf-tips-24">23.2.32. Notes on Query Planning</a></span></dt><dt><span class="sect2"><a href="#perf-tips-25a">23.2.33. Query Planning Expression Analysis Hints</a></span></dt><dt><span class="sect2"><a href="#perf-tips-25b">23.2.34. Query Planning Index Hints</a></span></dt><dt><span class="sect2"><a href="#perf-tips-26">23.2.35. Measuring Throughput</a></span></dt><dt><span class="sect2"><a href="#perf-tips-27">23.2.36. Do Not Create the Same or Similar EPL Statement X Times</a></span></dt><dt><span class="sect2"><a href="#perf-tips-28">23.2.37. Comparing Single-Threaded and Multi-Threaded Performance</a></span></dt><dt><span class="sect2"><a href="#perf-tips-29">23.2.38. Incremental Versus Recomputed Aggregation for Named Window Events</a></span></dt><dt><span class="sect2"><a href="#perf-tips-30">23.2.39. When Does Memory Get Released</a></span></dt><dt><span class="sect2"><a href="#perf-tips-31">23.2.40. Measure throughput of non-matches as well as matches</a></span></dt></dl></dd><dt><span class="sect1"><a href="#performance-kit">23.3. Using the Performance Kit</a></span></dt><dd><dl><dt><span class="sect2"><a href="#how-to-kit">23.3.1. How to Use the Performance Kit</a></span></dt></dl></dd></dl></div><p>
        Esper has been highly optimized to handle very high throughput streams with very little latency between event receipt and output result posting.
        It is also possible to use Esper on a soft-real-time or hard-real-time JVM to maximize predictability even
        further.
    </p><p>
        This section describes performance best practices and explains how to assess Esper performance by using our
        provided performance kit.
    </p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="performance-results"/>23.1.Â Performance Results</h2></div></div></div><p>
            For a complete understanding of those results, consult the next sections.
        </p><p>
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Esper exceeds over 500 000 event/s on a dual CPU 2GHz Intel based hardware,
with engine latency below 3 microseconds average (below 10us with more than 
99% predictability) on a VWAP benchmark with 1000 statements registered in the system 
- this tops at 70 Mbit/s at 85% CPU usage.

Esper also demonstrates linear scalability from 100 000 to 500 000 event/s on this 
hardware, with consistent results accross different statements.

Other tests demonstrate equivalent performance results
(straight through processing, match all, match none, no statement registered,
VWAP with time based window or length based windows).
                
Tests on a laptop demonstrated about 5x time less performance - that is 
between 70 000 event/s and 200 000 event/s - which still gives room for easy 
testing on small configuration.</pre><p>
        </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="performance-tips"/>23.2.Â Performance Tips</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-1"/>23.2.1.Â Understand How to Tune Your Java Virtual Machine</h3></div></div></div><p>
				Esper runs on a JVM and you need to be familiar with JVM tuning.
				Key parameters to consider include minimum and maximum heap memory and nursery heap sizes.
				Statements with time-based or length-based data windows can consume large amounts of memory as their size or length can be large.
			</p><p>
				For time-based data windows, one needs to be aware that the memory consumed depends on the actual event stream input
				throughput. Event pattern instances also consume memory, especially when using the "every"
				keyword in patterns to repeat pattern sub-expressions - which again will depend on the actual event stream input throughput.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-3"/>23.2.2.Â Input and Output Bottlenecks</h3></div></div></div><p>
				Your application receives output events from Esper statements through the <code class="literal">UpdateListener</code> interface or via the strongly-typed subscriber POJO object. Such output events are delivered by the application or timer thread(s) that sends an input event into the engine instance.
			</p><p>
				The processing of output events that your listener or subscriber performs temporarily blocks the thread until the processing completes, and may thus reduce throughput. It can therefore be beneficial for your application to process output events asynchronously and not block the Esper engine while an output event is being processed by your listener, especially if your listener code performs blocking IO operations.
			</p><p>
				For example, your application may want to send output events to a JMS destination or write output event data to a relational database. For optimal throughput, consider performing such blocking operations in a separate thread.
			</p><p>
				Additionally, when reading input events from a store or network in a performance test, you may find that Esper processes events faster then you are able to feed events into Esper. In such case you may want to consider an in-memory driver for use in performance testing. Also consider decoupling your read operation from the event processing operation (sendEvent method) by having multiple readers or by pre-fetching your data from the store.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-3-a"/>23.2.3.Â Theading</h3></div></div></div><p>
				We recommend using multiple threads to send events into Esper. There is a test class below. 
				Our test class does not use a blocking queue and thread pool so as to avoid a point of contention.
			</p><p>
				A sample code for testing performance with multiple threads is provided:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class SampleClassThreading {

    public static void main(String[] args) throws InterruptedException {

        int numEvents = 1000000;
        int numThreads = 3;

        Configuration config = new Configuration();
        config.getEngineDefaults().getThreading()
          .setListenerDispatchPreserveOrder(false);
        config.getEngineDefaults().getThreading()
          .setInternalTimerEnabled(false);   // remove thread that handles time advancing
        EPServiceProvider engine = EPServiceProviderManager
          .getDefaultProvider(config);
        engine.getEPAdministrator().getConfiguration().addEventType(MyEvent.class);

        engine.getEPAdministrator().createEPL(
          "create context MyContext coalesce by consistent_hash_crc32(id) " +
          "from MyEvent granularity 64 preallocate");
        String epl = "context MyContext select count(*) from MyEvent group by id";
        EPStatement stmt = engine.getEPAdministrator().createEPL(epl);
        stmt.setSubscriber(new MySubscriber());

        Thread[] threads = new Thread[numThreads];
        CountDownLatch latch = new CountDownLatch(numThreads);

        int eventsPerThreads = numEvents / numThreads;
        for (int i = 0; i &lt; numThreads; i++) {
            threads[i] = new Thread(
              new MyRunnable(latch, eventsPerThreads, engine.getEPRuntime()));
        }
        long startTime = System.currentTimeMillis();
        for (int i = 0; i &lt; numThreads; i++) {
            threads[i].start();
        }

        latch.await(10, TimeUnit.MINUTES);
        if (latch.getCount() &gt; 0) {
            throw new RuntimeException("Failed to complete in 10 minute");
        }
        long delta = System.currentTimeMillis() - startTime;
        System.out.println("Took " + delta + " millis");
    }

    public static class MySubscriber {
        public void update(Object[] args) {
        }
    }

    public static class MyRunnable implements Runnable {
        private final CountDownLatch latch;
        private final int numEvents;
        private final EPRuntime runtime;

        public MyRunnable(CountDownLatch latch, int numEvents, EPRuntime runtime) {
            this.latch = latch;
            this.numEvents = numEvents;
            this.runtime = runtime;
        }

        public void run() {
            Random r = new Random();
            for (int i = 0; i &lt; numEvents; i++) {
                runtime.sendEvent(new MyEvent(r.nextInt(512)));
            }
            latch.countDown();
        }
    }

    public static class MyEvent {
        private final int id;

        public MyEvent(int id) {
            this.id = id;
        }

        public int getId() {
            return id;
        }
    }
}</pre><p>
				We recommend using Java threads as above, or a blocking queue and thread pool with <code class="literal">sendEvent()</code> or alternatively we recommend configuring inbound threading if your application does not already employ threading.
				Esper provides the configuration option to use engine-level queues and threadpools for inbound, outbound and internal executions. See <a class="xref" href="#api-threading-advanced" title="14.7.1.Â Advanced Threading">SectionÂ 14.7.1, âAdvanced Threadingâ</a> for more information.
			</p><p>
				We recommend the outbound threading if your listeners are blocking. For outbound threading also see the section below on tuning and disabling listener delivery guarantees.
			</p><p>
				If enabling advanced threading options keep in mind that the engine will maintain a queue and thread pool. There is additional overhead associated with entering work units into the queue, maintaining the queue and the hand-off between threads. The Java blocking queues are not necessarily fast on all JVM. 
				It is not necessarily true that your application will perform better with any of the advanced threading options. 
			</p><p>
			  We found scalability better on Linux systems and running Java with <code class="literal">-server</code> and pinning threads to exclusive CPUs and after making sure CPUs are available on your system.
			</p><p>
				We recommend looking at LMAX Disruptor, an inter-thread messaging library, for setting up processing stages. Disruptor, however, is reportedly less suitable for setting up a worker pool.				
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="perf-tips-4-threadpoolpattern"/>23.2.3.1.Â Thead Pool Pattern</h4></div></div></div><p>
					The sample code below may help you get started setting up a thread pool of workers with back pressure and consideration for IO threads and clean shutdown.
				</p><p>
					The sample code starts by setting up a thread factory:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">private static class EngineThreadFactory implements ThreadFactory {
  private AtomicInteger id = new AtomicInteger(0);

  public Thread newThread(Runnable r) {
    Thread t = new Thread(r, "Event Engine Thread #" + id.incrementAndGet());
    t.setDaemon(true);
    t.setPriority(Thread.NORM_PRIORITY);
    return t;
  }
}</pre><p>
					The sample uses a fixed-size array blocking queue. To handle the situation where the queue is full and accepts no more messages,
					it uses a rejection handler that counts the number of rejections and retries:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">private class EngineRejectionHandler implements RejectedExecutionHandler {
  private volatile long spinCount = 0;
  
  public long getSpinCount() {
    return spinCount;
  }

  public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {
    ++spinCount;

    try {
      boolean isAccepted = false;
      while (!isAccepted) {
        isAccepted = executorQueue.offer(r, 120, TimeUnit.MICROSECONDS);
      }
    }
    catch (InterruptedException e) {
      log.warn("could not queue work entry");
    }
  }
}</pre><p>
					The Runnable that submits an event for processing could look like this:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">class Holder implements Runnable {
  public void run() {
    // do any stuff needed to "prepare" event which doesn't involve IO
    esperService.sendEvent(lm);
  }
}</pre><p>
					Initialize the queue and worker pool as follows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">  private final static int CAPACITY = 10000;
  private final static int THREAD_COUNT = 4;

  private static EPRuntime esperService;
  private ThreadFactory threadFactory = new EngineThreadFactory();
  private EngineRejectionHandler rejectionHandler = new EngineRejectionHandler();
  private BlockingQueue&lt;Runnable&gt; executorQueue;
  private ThreadPoolExecutor executor;

  public void start() {
    executorQueue = new ArrayBlockingQueue&lt;Runnable&gt;(CAPACITY);
    executor = new ThreadPoolExecutor(THREAD_COUNT, THREAD_COUNT, 0, TimeUnit.SECONDS,
    executorQueue, threadFactory, rejectionHandler);
    executor.allowCoreThreadTimeOut(false);
    while (executor.getPoolSize() &lt; executor.getCorePoolSize()) {
      executor.prestartCoreThread();
    }
  }</pre><p>
					To shut down cleanly, and before destroying the Esper engine instance, the sample code is:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">  executor.shutdown();
  while (!executor.isTerminated()) {
    Thread.sleep(100);
  }</pre><p>
					The next sample code goes into the IO or input thread(s) such as NIO mapped file, file channel, socket channel, or zmq / nanomsg etc., and submits a work unit to the queue:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">  while (programAlive) {
    // deserialize event to POJO, Map, Array, etc.,
    // pass along an event type name when needed
    executor.execute(new Holder(myeventobject));
  }</pre><p>
				  You could periodically dump the <code class="literal">spinCount</code> variable to get an idea of queue depth.
					You can tune the size of the Executor's pool, and the size of the TimeUnit's of sleep used inside the rejectedExecution method, until you get 1) stable performance at highest level (determined by optimal number of threads in pool, 2) avoid wasting CPU in IO thread(s) (determined by optimal sleeping time between each attempt to re-queue rejected events to the thread pool).
				  </p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-4"/>23.2.4.Â Select the Underlying Event Rather Than Individual Fields</h3></div></div></div><p>
				By selecting the underlying event in the select-clause you can reduce load on the engine, since the 
				engine does not need to generate a new output event for each input event.
			</p><p>
				For example, the following statement returns the underlying event to update listeners:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Better performance
select * from RFIDEvent</pre><p>
				In comparison, the next statement selects individual properties. This statement requires the engine to generate an output event that 
				contains exactly the required properties:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Less good performance
select assetId, zone, xlocation, ylocation from RFIDEvent </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-5"/>23.2.5.Â Prefer Stream-Level Filtering Over Where-Clause Filtering</h3></div></div></div><p>
				Esper stream-level filtering is very well optimized, while filtering via the where-clause post any data windows is not optimized. 				
			</p><p>
				The same is true for named windows. If your application is only interested in a subset of named window data and such filters
				are not correlated to arriving events, place the filters into parenthesis after the named window name.
			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="perf-tips-5-nonnamedwindowexample"/>23.2.5.1.Â Examples Without Named Windows</h4></div></div></div><p>
					Consider the example below, which performs stream-level filtering:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Better performance : stream-level filtering
select * from MarketData(ticker = 'GOOG')</pre><p>
					The example below is the equivalent (same semantics) statement and performs post-data-window filtering without a data window.
					The engine does not optimize statements that filter in the where-clause for the reason that data windows are generally present.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Less good performance : post-data-window filtering
select * from Market where ticker = 'GOOG'</pre><p>
					Thus this optimization technique applies to statements without any data window. 
				</p><p>
					When a data window is used, the semantics change. Let's look at an example to better understand the difference:
					In the next statement only GOOG market events enter the length window:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select avg(price) from MarketData(ticker = 'GOOG')#length(100)</pre><p>
					The above statement computes the average price of GOOG market data events for the last 100 GOOG market data events. 
				</p><p>
					Compare the filter position to a filter in the where clause. 
					The following statement is NOT equivalent as all events enter the data window (not just GOOG events):
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select avg(price) from Market#length(100) where ticker = 'GOOG'</pre><p>
					The statement above computes the average price of all market data events for the last 100 market data events, and outputs results only for GOOG.
				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="perf-tips-5-namedwindowexample"/>23.2.5.2.Â Examples Using Named Windows</h4></div></div></div><p>
					The next two example EPL queries put the account number filter criteria directly into parenthesis following the named window name:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Better performance : stream-level filtering
select * from WithdrawalNamedWindow(accountNumber = '123')</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Better performance : example with subquery
select *, (select * from LoginSucceededWindow(accountNumber = '123'))
from WithdrawalNamedWindow(accountNumber = '123')</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="perf-tips-5-whereclausecomputations"/>23.2.5.3.Â Common Computations in Where-Clauses</h4></div></div></div><p>
					If you have a number of queries performing a given computation on incoming events, consider moving the computation from the where-clause to a 
					plug-in user-defined function that is listed as part of stream-level filter criteria.
					The engine optimizes evaluation of user-defined functions in filters such that an incoming event can undergo the computation just once even in the presence of N queries.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Prefer stream-level filtering with a user-defined function
select * from MarketData(vstCompare(*))</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Less preferable when there are N similar queries: 
// Move the computation in the where-clause to the "vstCompare" function.
select * from MarketData where (VST * RT) â (VST / RT) &gt; 1</pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-6"/>23.2.6.Â Reduce the Use of Arithmetic in Expressions</h3></div></div></div><p>
				Esper does not yet attempt to pre-evaluate arithmetic expressions that produce constant results.
			</p><p>
				Therefore, a filter expression as below is optimized:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Better performance : no arithmetic
select * from MarketData(price&gt;40) </pre><p>
				While the engine cannot currently optimize this expression:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Less good performance : with arithmetic
select * from MarketData(price+10&gt;50) </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-6a"/>23.2.7.Â Remove Unneccessary Constructs</h3></div></div></div><p>
				If your statement uses <code class="literal">order by</code> to order output events, consider removing <code class="literal">order by</code> unless your application does indeed require the events it receives to be ordered.
			</p><p>
				If your statement specifies <code class="literal">group by</code> but does not use aggregation functions, consider removing <code class="literal">group by</code>.
			</p><p>
				If your statement specifies <code class="literal">group by</code> but the filter criteria only allows one group, consider removing <code class="literal">group by</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Prefer:
select * from MarketData(symbol = 'GE') having sum(price) &gt; 1000

// Don't use this since the filter specifies a single symbol:
select * from MarketData(symbol = 'GE') group by symbol having sum(price) &gt; 1000</pre><p>
				If your statement specifies the grouped data window <code class="literal">#groupwin</code> but the window being grouped retains the same set of events regardless of grouping, 
				remove <code class="literal">#groupwin</code>, for example:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Prefer:
create window MarketDataWindow#keepall as MarketDataEventType

// Don't use this, since keeping all events 
// or keeping all events per symbol is the same thing:
create window MarketDataWindow#groupwin(symbol)#keepall as MarketDataEventType

// Don't use this, since keeping the last 1-minute of events 
// or keeping 1-minute of events per symbol is the same thing:
create window MarketDataWindow#groupwin(symbol)#time(1 min) as MarketDataEventType</pre><p>
				It is not necessary to specify a data window for each stream.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Prefer:
select * from MarketDataWindow

// Don't have a data window if just listening to events, prefer the above
select * from MarketDataWindow#lastevent</pre><p>
				If your statement specifies unique data window but the filter criteria only allows one unique criteria, consider removing the unique data window:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Prefer:
select * from MarketDataWindow(symbol = 'GE')#lastevent

// Don't have a unique-key data window if your filter specifies a single value
select * from MarketDataWindow(symbol = 'GE')#unique(symbol)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-6b"/>23.2.8.Â End Pattern Sub-Expressions</h3></div></div></div><p>
				In patterns, the <code class="literal">every</code> keyword in conjunction with followed by (<code class="literal">-&gt;</code>) starts a new sub-expression per match. 				
			</p><p>
				For example, the following pattern starts a sub-expression looking for a B event for every A event that arrives.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every A -&gt; B</pre><p>
				Determine under what conditions a subexpression should end so the engine can stop looking for a B event. Here are a few generic examples:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every A -&gt; (B and not C)
every A -&gt; B where timer:within(1 sec)</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-7"/>23.2.9.Â Consider Using EventPropertyGetter for Fast Access to Event Properties</h3></div></div></div><p>
				The EventPropertyGetter interface is useful for obtaining an event property value without property name table lookup 
				given an EventBean instance that is of the same event type that the property getter was obtained from.
			</p><p>
				When compiling a statement, the EPStatement instance lets us know the EventType via the getEventType() method.
				From the EventType you can obtain EventPropertyGetter instances for named event properties.
			</p><p>
				To demonstrate, consider the following simple statement:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, avg(price) from Market group by symbol</pre><p>
				After compiling the statement, obtain the EventType and pass the type to the listener:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EPStatement stmt = epService.getEPAdministrator().createEPL(stmtText);
MyGetterUpdateListener listener = new MyGetterUpdateListener(stmt.getEventType());</pre><p>
				The listener can use the type to obtain fast getters for property values of events for the same type:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyGetterUpdateListener implements StatementAwareUpdateListener {
    private final EventPropertyGetter symbolGetter;
    private final EventPropertyGetter avgPriceGetter;

    public MyGetterUpdateListener(EventType eventType) {
        symbolGetter = eventType.getGetter("symbol");
        avgPriceGetter = eventType.getGetter("avg(price)");
    }</pre><p>
				Last, the update method can invoke the getters to obtain event property values:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">    public void update(EventBean[] eventBeans, EventBean[] oldBeans, EPStatement epStatement, EPServiceProvider epServiceProvider) {
        String symbol = (String) symbolGetter.get(eventBeans[0]);
        long volume = (Long) volumeGetter.get(eventBeans[0]);
        // some more logic here
    }</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-8"/>23.2.10.Â Consider Casting the Underlying Event</h3></div></div></div><p>
				When an application requires the value of most or all event properties, it can often be best to simply select the underlying event via wildcard
				and cast the received events.
			</p><p>
				Let's look at the sample statement:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MarketData(symbol regexp 'E[a-z]')</pre><p>
				An update listener to the statement may want to cast the received events to the expected underlying event class:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">    public void update(EventBean[] eventBeans, EventBean[] eventBeans) {
        MarketData md = (MarketData) eventBeans[0].getUnderlying();
        // some more logic here
    }</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-9"/>23.2.11.Â Turn Off Logging and Audit</h3></div></div></div><p>
	Since Esper 1.10, even if you don't have a log4j configuration file in place, Esper will make sure to minimize execution path logging overhead.
	For prior versions, and to reduce logging overhead overall, we recommend the "WARN" log level or the "INFO" log level.
			</p><p>
	Please see the log4j configuration file in "etc/infoonly_log4j.xml" for example log4j settings.
			</p><p>
				Esper provides the <code class="literal">@Audit</code> annotation for statements. For performance testing and production deployment, we recommend removing <code class="literal">@Audit</code>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-11"/>23.2.12.Â Tune or Disable Delivery Order Guarantees</h3></div></div></div><p>
				If your application is not a multithreaded application, or you application is not sensitive to the order of delivery of result events to your application listeners, then consider disabling the delivery order guarantees the engine makes towards ordered delivery of results to listeners:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getThreading().setListenerDispatchPreserveOrder(false);</pre><p>
				If your application is not a multithreaded application, or your application uses the <code class="literal">insert into</code> clause to make results of one statement available for further consuming statements but does not require ordered delivery of results from producing statements to consuming statements, you may disable delivery order guarantees between statements: 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Configuration config = new Configuration();
config.getEngineDefaults().getThreading().setInsertIntoDispatchPreserveOrder(false);</pre><p>
				If your application declares only stateless EPL statements then the settings described herein are not relevant. 
			</p><p>
				Additional configuration options are available and described in the configuration section that specify timeout values and spin or thread context switching.
			</p><p>
				Esper logging will log the following informational message when guaranteed delivery order to listeners is enabled and spin lock times exceed the default or configured timeout : <code class="literal">Spin wait timeout exceeded in listener dispatch</code>.
				The respective message for delivery from <code class="literal">insert into</code> statements to consuming statements is <code class="literal">Spin wait timeout exceeded in insert-into dispatch</code>.
			</p><p>
				If your application sees messages that spin lock times are exceeded, your application has several options: First, disabling preserve order is an option. Second, ensure your listener does not perform (long-running) blocking operations before returning, for example by performing output event processing in a separate thread. Third, change the timeout value to a larger number to block longer without logging the message.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-12"/>23.2.13.Â Use a Subscriber Object to Receive Events</h3></div></div></div><p>
				The subscriber object is a technique to receive result data that has performance advantages over the <code class="literal">UpdateListener</code> interface. Please refer to <a class="xref" href="#api-admin-subscriber" title="14.3.3.Â Setting a Subscriber Object">SectionÂ 14.3.3, âSetting a Subscriber Objectâ</a>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-12b"/>23.2.14.Â Consider Data Flows</h3></div></div></div><p>
				Data flows offer a high-performance means to execute EPL select statements and use other built-in data flow operators. The data flow <code class="literal">Emitter</code> operator allows sending underlying event objects directly into a data flow. Thereby the engine does not need to wrap each underlying event into a <code class="literal">EventBean</code> instance and the engine does not need to match events to statements. Instead, the underling event directly applies to only that data flow instance that your application submits the event to, and no other continuous query statements or data flows see the same event.
			</p><p>
			  Data flows are described in <a class="xref" href="#dataflow" title="ChapterÂ 20.Â EPL Reference: Data Flow">ChapterÂ 20, <i>EPL Reference: Data Flow</i></a>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-13"/>23.2.15.Â High-Arrival-Rate Streams and Single Statements</h3></div></div></div><p>
				A context partition is associated with certain context partition state that consists of current aggregation values, partial pattern matches, data windows depending on whether your statement uses such constructs. When an engine receives events it updates context partition state under locking such that context partition state remains consistent under concurrent multi-threaded access.
			</p><p>
				For high-volume streams, the locking required to protected context partition state may slow down or introduce blocking for very high arrival rates of events that apply to the very same context partition and its state.
			</p><p>
				Your first choice should be to utilize a context that allows for multiple context partitions, such as the hash segmented context. The hash segmented context usually performs better
				compared to the keyed segmented context since in the keyed segmented context the engine must check whether a partition exists or must be created for a given key.
			</p><p>
				Your second choice is to split the statement into multiple statements that each perform part of the intended function or that each look for a certain subset of the high-arrival-rate stream. There is very little cost in terms of memory or CPU resources per statement, the engine can handle larger number of statements usually as efficiently as single statements.
			</p><p>
				For example, consider the following statement:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// less effective in a highly threaded environment 
select venue, ccyPair, side, sum(qty)
from CumulativePrice
where side='O'
group by venue, ccyPair, side</pre><p>
				The engine protects state of each context partition by a separate lock for each context partition, as discussed in the API section. In highly threaded applications threads may block on a specific context partition. You would therefore want to use multiple context partitions.
			</p><p>
				Consider creating either a hash segmented context or a keyed segmented context. In the hash segmented context incoming data is simply assigned to one of the buckets using a small computation.
				In the keyed segmented context the engine must check keys to see if a partition already exists or whether a new partition must be allocated. We'll discuss both below.
				For both types of context, since locking is on the level of context partition, the locks taken by the engine are very fine grained allowing for highly concurrent processing. 
			</p><p>
				This sample EPL declares a hash segmented context. In a hash segmented context the engine can pre-allocate context partitions and therefore does not need to check whether
				a partition exists already. In a hash segmented context the engine simply assigns events to context partitions based on result of a hash function and modulo operation. 
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context MyContext coalesce by consistent_hash_crc32(venue) from CumulativePrice(side='O') granularity 16 preallocate</pre><p>
				This sample EPL declares a keyed segmented context. The keyed segmented context instructs the engine to employ a context partition per <code class="literal">venue, ccyPair, side</code> key combination. The engine must check for each event whether a partition exists for that combination of <code class="literal">venue</code>, <code class="literal">ccyPair</code> and <code class="literal">side</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context MyContext partition by venue, ccyPair, side from CumulativePrice(side='O')</pre><p>
				After declaring the context using <code class="literal">create context</code>, make sure all your statements, including those statements that create named windows and tables, specify that context. This is done by prefixing each statement with <code class="literal">context </code><span class="emphasis"><em>context_name</em></span><code class="literal"> ....</code>.
			</p><p>
				The new statement that refers to the context as created above is below. Note the <code class="literal">context MyContext</code> which tells the engine that this statement executes context partitioned. This must be provided otherwise the statement does not execute context partitioned.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context MyContext select venue, ccyPair, side, sum(qty) from CumulativePrice</pre><p>
			  For testing purposes or if your application controls concurrency, you may disable context partition locking, see <a class="xref" href="#config-engine-execution-disablelock" title="15.4.27.3.Â Disable Locking">SectionÂ 15.4.27.3, âDisable Lockingâ</a>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-13a"/>23.2.16.Â Subqueries Versus Joins and Where-Clause and Data Windows</h3></div></div></div><p>
				When joining streams the engine builds a product of the joined data windows based on the <code class="literal">where</code> clause. It analyzes the <code class="literal">where</code> clause at time of statement compilation and
				builds the appropriate indexes and query strategy. Avoid using expressions in the join <code class="literal">where</code> clause that require evaluation, such as user-defined functions or arithmatic expressions.
			</p><p>
				When joining streams and not providing a <code class="literal">where</code> clause, consider using the <code class="literal">#unique</code> data window or <code class="literal">#lastevent</code> data window to join only the last event or the last event per unique key(s) of each stream. 
			</p><p>
				The sample query below can produce up to 5,000 rows when both data windows are filled and an event arrives for either stream:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Avoid joins between streams with data windows without where-clause
select * from StreamA#length(100), StreamB#length(50)</pre><p>
				Consider using a subquery, consider using separate statements with insert-into and consider providing a <code class="literal">where</code> clause to limit the product of rows.
			</p><p>
				Below examples show different approaches, that are not semantically equivalent, assuming that an <code class="literal">MyEvent</code> is defined with the properties symbol and value:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Replace the following statement as it may not perform well
select a.symbol, avg(a.value), avg(b.value) 
from MyEvent#length(100) a, MyEvent#length(50) b

// Join with where-clause
select a.symbol, avg(a.value), avg(b.value) 
from MyEvent#length(100) a, MyEvent#length(50) b 
where a.symbol = b.symbol

// Unidirectional join with where-clause
select a.symbol, avg(b.value) 
from MyEvent unidirectional, MyEvent#length(50) b 
where a.symbol = b.symbol

// Subquery
select 
  (select avg(value) from MyEvent#length(100)) as avgA, 
  (select avg(value) from MyEvent#length(50)) as avgB,
  a.symbol
from MyEvent

// Since streams cost almost nothing, use insert-into to populate and a unidirectional join 
insert into StreamAvgA select symbol, avg(value) as avgA from MyEvent#length(100)
insert into StreamAvgB select symbol, avg(value) as avgB from MyEvent#length(50)
select a.symbol, avgA, avgB from StreamAvgA unidirectional, StreamAvgB#unique(symbol) b
where a.symbol = b.symbol</pre><p>
				A join is multidirectionally evaluated: When an event of any of the streams participating in the join arrive, the join gets evaluated, unless using the unidirectional keyword.
				Consider using a subquery instead when evaluation only needs to take place when a certain event arrives:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Rewrite this join since you don't need to join when a LoginSucceededWindow arrives
// Also rewrite because the account number always is the value 123.
select * from LoginSucceededWindow as l, WithdrawalWindow as w
where w.accountNumber = '123' and w.accountNumber = l.accountNumber

// Rewritten as a subquery, 
select *, (select * from LoginSucceededWindow where accountNumber=â123â) 
from WithdrawalWindow(accountNumber=â123â) as w</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-13b"/>23.2.17.Â Patterns and Pattern Sub-Expression Instances</h3></div></div></div><p>
				The <code class="literal">every</code> and repeat operators in patterns control the number of sub-expressions that are active. Each sub-expression can consume memory as it may retain, depending on the use of tags in the pattern,
				the matching events. A large number of active sub-expressions can reduce performance or lead to out-of-memory errors. 
			</p><p>
				During the design of the pattern statement consider the use of <code class="literal">timer:within</code> to reduce the amount of time a sub-expression lives, or consider the <code class="literal">not</code> operator to end a sub-expression.
			</p><p>
				The examples herein assume an <code class="literal">AEvent</code> and a <code class="literal">BEvent</code> event type that have an <code class="literal">id</code> property that may correlate between arriving events of the two event types.
			</p><p>
				In the following sample pattern the engine starts, for each arriving AEvent, a new pattern sub-expression looking for a matching BEvent. Since the AEvent is tagged with <code class="literal">a</code> the engine retains
				each AEvent until a match is found for delivery to listeners or subscribers:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every a=AEvent -&gt; b=BEvent(b.id = a.id)</pre><p>
				One way to end a sub-expression is to attach a time how long it may be active.
			</p><p>
				The next statement ends sub-expressions looking for a matching BEvent 10 seconds after arrival of the AEvent event that started the sub-expression:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every a=AEvent -&gt; (b=BEvent(b.id = a.id) where timer:within(10 sec))</pre><p>
				A second way to end a sub-expression is to use the <code class="literal">not</code> operator. You can use the <code class="literal">not</code> operator together with the <code class="literal">and</code> operator to end a sub-expression when a certain event arrives.
			</p><p>
				The next statement ends sub-expressions looking for a matching BEvent when, in the order of arrival, the next BEvent that arrives after the AEvent event that started the sub-expression does not match the id of the AEvent:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every a=AEvent -&gt; (b=BEvent(b.id = a.id) and not BEvent(b.id != a.id))</pre><p>
				The <code class="literal">every-distinct</code> operator can be used to keep one sub-expression alive per one or more keys. The next pattern demonstrates an alternative to <code class="literal">every-distinct</code>. It ends sub-expressions looking for a matching BEvent when an AEvent arrives that matches the id of the AEvent that started the sub-expression:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every a=AEvent -&gt; (b=BEvent(b.id = a.id) and not AEvent(b.id = a.id))</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-13b2"/>23.2.18.Â Pattern Sub-Expression Instance Versus Data Window Use</h3></div></div></div><p>
			  For some use cases you can either specify one or more data windows as the solution, or you can specify a pattern that also solves your use case.
			</p><p>
			  For patterns, you should understand that the engine employs a dynamic state machine. For data windows, the engine employs a delta network and collections. Generally you may find patterns that require a large number of sub-expression instances to consume more memory and more CPU then data windows.
			</p><p>
			  For example, consider the following EPL statement that filters out duplicate transaction ids that occur within 20 seconds of each other:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from TxnEvent#firstunique(transactionId)#time(20 sec)</pre><p>
			  You could also address this solution using a pattern:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern [every-distinct(a.transactionId) a=TxnEvent where timer:within(20 sec)]</pre><p>
			  If you have a fairly large number of different transaction ids to track, you may find the pattern to perform less well then the data window solution as the pattern asks the engine to manage a pattern sub-expression per transaction id. The data window solution
			  asks the engine to manage expiry, which can give better performance in many cases.
			</p><p>
			  Similar to this, it is generally preferable to use EPL join syntax over a pattern that cardinally detects relationships i.e. <code class="literal">pattern [every-distinct(...) ... -&gt; every-distinct(...) ...]</code>. Join query planning is a powerful Esper feature that implements fast relational joins.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-13c"/>23.2.19.Â The Keep-All Data Window</h3></div></div></div><p>
				The <code class="literal">#keepall</code> data window is a data window that retains all arriving events. The data window can be useful during the development phase and to implement a custom expiry policy using <code class="literal">on-delete</code> and named windows. Care should be taken to timely remove from the keep-all data window however. Use <code class="literal">on-select</code> or on-demand queries to count the number of rows currently held by a named window with keep-all expiry policy.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-13d"/>23.2.20.Â Statement Design for Reduced Memory Consumption - Diagnosing OutOfMemoryError</h3></div></div></div><p>
			  This section describes common sources of out-of-memory problems.
			</p><p>
				If using the keep-all data window please consider the information above. If using pattern statements please consider pattern sub-expression instantiation and lifetime as discussed prior to this section.
			</p><p>
			  When using the <code class="literal">group-by</code> clause or <code class="literal">#groupwin</code> grouped data windows please consider the hints as described below. Make sure your grouping criteria are fields that don't have an unlimited number of possible values or specify hints otherwise.
			</p><p>
				The <code class="literal">#unique</code> unique data window can also be a source for error. If your uniqueness criteria include a field which is never unique the memory use of the data window can grow, unless your application deletes events.
			</p><p>
			  When using the <code class="literal">every-distinct</code> pattern construct parameterized by distinct value expressions that generate an unlimited number of distinct values, consider specifying a time period as part of the parameters to indicate to the pattern engine how long a distinct value should be considered.
			</p><p>
			  In a match-recognize pattern consider limiting the number of optional events if optional events are part of the data reported in the <code class="literal">measures</code> clause. Also when using the partition clause, if your partitioning criteria include a field which is never unique the memory use of the match-recognize pattern engine can grow.
			</p><p>
				A further source of memory use is when your application creates new statements but fails to destroy created statements when they are no longer needed.
			</p><p>
				In your application design you may also want to be conscious when the application listener or subscriber objects retain output data.
			</p><p>
			    An engine instance, uniquely identified by an <code class="literal">engine URI</code> is a relatively heavyweight object. Optimally your application allocates only one or a few engine instances per JVM.
			    A statement instance is associated to one engine instance, is uniquely identified by a statement name and is a medium weight object. We have seen applications allocate 100,000 statements easily.
			    A statement's context partition instance is associated to one statement, is uniquely identified by a context partition id and is a light weight object. We have seen applications allocate 5000 context partitions for 100 statements easily, i.e. 5,000,000 context partitions.
			    An aggregation row, data window row, pattern etc. is associated to a statement context partition and is a very lightweight object itself. 
			</p><p>
			  The <code class="literal">prev</code>, <code class="literal">prevwindow</code> and <code class="literal">prevtail</code> functions access a data window directly. The engine does not need to maintain a separate data structure and grouping is based on the use of the <code class="literal">#groupwin</code> grouped data window. 
			  Compare this to the use of event aggregation functions such as <code class="literal">first</code>, <code class="literal">window</code> and <code class="literal">last</code> which group according to the <code class="literal">group by</code> clause. If your statement utilizes both together consider reformulating to use <code class="literal">prev</code> instead.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-14"/>23.2.21.Â Performance, JVM, OS and Hardware</h3></div></div></div><p>
				Performance will also depend on your JVM (Sun HotSpot, BEA JRockit, IBM J9), your operating system and your hardware.
				A JVM performance index such as specJBB at <a class="link" href="http://www.spec.org" target="">spec.org</a> can be used. For memory intensive statement, you may want
				to consider 64bit architecture that can address more than 2GB or 3GB of memory, although a 64bit JVM usually comes with a slow performance penalty due to
				more complex pointer address management.
			</p><p>
				The choice of JVM, OS and hardware depends on a number of factors and therefore a definite suggestion is hard to make.
				The choice depends on the number of statements, and number of threads.
				A larger number of threads would benefit of more CPU and cores. If you have very low latency requirements, you should consider
				getting more GHz per core, and possibly soft real-time JVM to enforce GC determinism at the JVM level, or even consider dedicated hardware such as Azul.
				If your statements utilize large data windows, more RAM and heap space will be utilized hence you should clearly plan and account for that and possibly consider 64bit architectures or consider
				<a class="link" href="http://www.espertech.com/products/" target="">EsperHA</a>.
			</p><p>
				The number and type of statements is a factor that cannot be generically accounted for.
				The benchmark kit can help test out some requirements and establish baselines, and for more complex use cases
				a simulation or proof of concept would certainly works best.
				<a class="link" href="http://www.espertech.com/support/services.php" target="">EsperTech' experts</a> can be available to help write interfaces in a consulting relationship.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-15"/>23.2.22.Â Consider Using Hints</h3></div></div></div><p>
				The @Hint annotation provides a single keyword or a comma-separated list of keywords that provide instructions to the engine towards statement execution
				that affect runtime performance and memory-use of statements. Also see <a class="xref" href="#epl-syntax-annotation-hint" title="5.2.7.9.Â @Hint">SectionÂ 5.2.7.9, â@Hintâ</a>.
			</p><p>
			  The query planning in general is described in <a class="xref" href="#perf-tips-24" title="23.2.32.Â Notes on Query Planning">SectionÂ 23.2.32, âNotes on Query Planningâ</a>.
			</p><p>
			  The hint for influencing query planning expression analysis is described at <a class="xref" href="#perf-tips-25a" title="23.2.33.Â Query Planning Expression Analysis Hints">SectionÂ 23.2.33, âQuery Planning Expression Analysis Hintsâ</a>.
			</p><p>
			  The hint for influencing query planning index choice is described at <a class="xref" href="#perf-tips-25b" title="23.2.34.Â Query Planning Index Hints">SectionÂ 23.2.34, âQuery Planning Index Hintsâ</a>.
			</p><p>
				Further hints, also related to query planning, for use with joins, outer joins, unidirectional joins, relational and non-relational joins are described in <a class="xref" href="#epl-join-hints" title="5.12.6.Â Hints Related to Joins">SectionÂ 5.12.6, âHints Related to Joinsâ</a>.
			</p><p>
				The hint for use with <code class="literal">group by</code> to specify how state for groups is reclaimed is described in <a class="xref" href="#epl-groupby-hints" title="5.6.2.1.Â Hints Pertaining to Group-By">SectionÂ 5.6.2.1, âHints Pertaining to Group-Byâ</a> and <a class="xref" href="#view-std-groupwin" title="13.3.15.Â Grouped Data Window (groupwin or std:groupwin)">SectionÂ 13.3.15, âGrouped Data Window (groupwin or std:groupwin)â</a>.
			</p><p>
				The hint for use with <code class="literal">group by</code> to specify aggregation state reclaim for unbound streams and timestamp groups is described in <a class="xref" href="#epl-groupby-hints" title="5.6.2.1.Â Hints Pertaining to Group-By">SectionÂ 5.6.2.1, âHints Pertaining to Group-Byâ</a>.
			</p><p>
				The hint for use with <code class="literal">match_recognize</code> to specify iterate-only is described in <a class="xref" href="#match-recognize-patternops-iterator" title="8.4.7.Â Eliminating Duplicate Matches">SectionÂ 8.4.7, âEliminating Duplicate Matchesâ</a>.
			</p><p>
				To tune subquery performance when your subquery selects from a named window, consider the hints discussed in <a class="xref" href="#epl-subqueries-hints" title="5.11.8.Â Hints Related to Subqueries">SectionÂ 5.11.8, âHints Related to Subqueriesâ</a>.
			</p><p>
				The <code class="literal">@NoLock</code> hint to remove context partition locking (also read caution note) is described at <a class="xref" href="#api-threading" title="14.7.Â Engine Threading and Concurrency">SectionÂ 14.7, âEngine Threading and Concurrencyâ</a>.
			</p><p>
				The hint to control expansion of filter expressions, further described at <a class="xref" href="#config-engine-execution-filterservicemaxfilterwidth" title="15.4.27.6.Â Filter Service Max Filter Width">SectionÂ 15.4.27.6, âFilter Service Max Filter Widthâ</a>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-16"/>23.2.23.Â Optimizing Stream Filter Expressions</h3></div></div></div><p>
				Assume your EPL statement invokes a static method in the stream filter as the below statement shows as an example:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent(MyHelperLibrary.filter(field1, field2, field3, field4*field5))</pre><p>
				As a result of starting above statement, the engine must evaluate each MyEvent event invoking the <code class="literal">MyHelperLibrary.filter</code> method and passing certain event properties. The same applies to pattern filters that 
				specify functions to evaluate.
			</p><p>
				If possible, consider moving some of the checking performed by the function back into the filter or consider splitting the function into a two parts separated by <code class="literal">and</code> conjunction. In general for all expressions, the engine evaluates expressions left of the <code class="literal">and</code> first and can skip evaluation of the 
				further expressions in the conjunction in the case when the first expression returns false. In addition the engine can build a filter index for fields provided in stream or pattern filters.
			</p><p>
				For example, the below statement could be faster to evaluate:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from MyEvent(field1="value" and 
  MyHelperLibrary.filter(field1, field2, field3, field4*field5))</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-17"/>23.2.24.Â Statement and Engine Metric Reporting</h3></div></div></div><p>
					You can use statement and engine metric reporting as described in <a class="xref" href="#api-instrumentation" title="14.14.Â Engine and Statement Metrics Reporting">SectionÂ 14.14, âEngine and Statement Metrics Reportingâ</a> to monitor performance or identify slow statements.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-18"/>23.2.25.Â Expression Evaluation Order and Early Exit</h3></div></div></div><p>
				The term "early exit" or "short-circuit evaluation" refers to when the engine can evaluate an expression without a complete evaluation of all sub-expressions.
			</p><p>
				Consider an expression such as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">where expr1 and expr2 and expr3</pre><p>
				If expr1 is false the engine does not need to evaluate expr2 and expr3. Therefore when using the <code class="literal">AND</code> logical operator consider reordering expressions placing the most-selective expression first and less selective expressions thereafter.
			</p><p>
				The same is true for the <code class="literal">OR</code> logical operator: If expr1 is true the engine does not need to evaluate expr2 and expr3. Therefore when using the <code class="literal">OR</code> logical operator consider reordering expressions placing the least-selective expression first and more selective expressions thereafter. 
			</p><p>
				The order of expressions (here: expr1, expr2 and expr3) does not make a difference for the join and subquery query planner.
			</p><p>
				Note that the engine does not guarantee short-circuit evaluation in all cases. The engine may rewrite the where-clause or filter conditions into another order of evaluation so that it can perform index lookups.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-19"/>23.2.26.Â Large Number of Threads</h3></div></div></div><p>
					When using a large number of threads with the engine, such as more then 100 threads, you can provide a setting in the configuration that instructs the engine to reduce the use of thread-local variables. Please see  <a class="xref" href="#config-engine-execution" title="15.4.27.Â Engine Settings Related to Execution of Statements">SectionÂ 15.4.27, âEngine Settings Related to Execution of Statementsâ</a> for more information.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-19a"/>23.2.27.Â Filter Evaluation Tuning</h3></div></div></div><p>
					We offer a switch for tuning evaluation of incoming events against filters. Please see  <a class="xref" href="#config-engine-execution" title="15.4.27.Â Engine Settings Related to Execution of Statements">SectionÂ 15.4.27, âEngine Settings Related to Execution of Statementsâ</a> for more information.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-20"/>23.2.28.Â Context Partition Related Information</h3></div></div></div><p>
					As the engine locks on the level of context partition, high concurrency under threading can be achieved by using context partitions.
				</p><p>
					Generally context partitions require more memory then the more fine-grained grouping that can be achieved by <code class="literal">group by</code> or <code class="literal">#groupwin</code>.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-21"/>23.2.29.Â Prefer Constant Variables Over Non-Constant Variables</h3></div></div></div><p>
				The create-variable syntax as well as the APIs can identify a variable as a constant value. When a variable's value is not intended to change it is best to declare the variable as constant.
			</p><p>
				For example, consider the following two EPL statements that each declares a variable. The first statement declares a constant variable and the second statement declares a non-constant variable:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// declare a constant variable
create constant variable CONST_DEPARTMENT = 'PURCHASING'</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// declare a non-constant variable
create variable VAR_DEPARTMENT = 'SALES'</pre><p>
				When your application creates a statement that has filters for events according to variable values, the engine internally inspects such expressions and performs filter optimizations for constant variables that are more effective in evaluation.
			</p><p>
				For example, consider the following two EPL statements that each look for events related to persons that belong to a given department:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// perfer the constant
select * from PersonEvent(department=CONST_DEPARTMENT)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// less efficient
select * from PersonEvent(department=VAR_DEPARTMENT)</pre><p>
				The engine can more efficiently evaluate the expression using a variable declared as constant. The same observation can be made for subquery and join query planning.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-22"/>23.2.30.Â Prefer Object-Array Events</h3></div></div></div><p>
				Object-array events offer the best read access performance for access to event property values. In addition, object-array events use much less memory then Map-type events. They also offer the best write access performance. 
			</p><p>
			  A comparison of different event representations is in <a class="xref" href="#eventrep_comparing" title="3.5.Â Comparing Event Representations">SectionÂ 3.5, âComparing Event Representationsâ</a>.
			</p><p>
			    First, we recommend that your application sends object-array events into the engine, instead of Map-type events. See <a class="xref" href="#appendix_eventrepoa" title="AppendixÂ F.Â Event Representation: Object-Array (Object[]) Events">AppendixÂ F, <i>Event Representation: Object-Array (Object[]) Events</i></a> for more information.
			</p><p>
			    Second, we recommend that your application sets the engine-wide configuration of the default event representation to object array, as described in <a class="xref" href="#config-engine-eventmeta-representation" title="15.4.14.1.Â Default Event Representation">SectionÂ 15.4.14.1, âDefault Event Representationâ</a>. Alternatively you can use the <code class="literal">@EventRepresentation(objectarray)</code> annotation with individual statements.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-23"/>23.2.31.Â Composite or Compound Keys</h3></div></div></div><p>
					If your uniqueness, grouping, sorting or partitioning keys are composite keys or compound keys, this section may apply. A composite key is a key that consists of 2 or more properties or expressions.
				</p><p>
					In the example below the <code class="literal">firstName</code> and <code class="literal">lastName</code> expressions are part of a composite key: 
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">... group by firstName, lastName
..#unique(firstName, lastName)...
...order by firstName, lastName</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
				  The example above is not a comprehensive discussion where composite or compound keys may be used in EPL. Other places where composite keys may apply are
				  patterns, partitioned contexts and grouped data windows (we may have missed one).
				</div><p>
					You application could change the EPL to instead refer to a single value <code class="literal">fullName</code>:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">... group by fullName
..#unique(fullName)...
...order by fullName</pre><p>
					The advantage in using a single expression as the uniqueness, grouping and sorting key is that the engine does not need to compute multiple expressions 
					and retain a separate data structure in memory that represents the composite key, resulting in reduced memory use and increased throughput.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-24"/>23.2.32.Â Notes on Query Planning</h3></div></div></div><p>
				  Query planning takes place for subqueries, joins (any type), named window and table on-actions (on-select, on-merge, on-insert, on-update, on-select) and fire-and-forget queries. Query planning
				  affects query execution speed. Enable query plan logging to output query plan information.
				</p><p>
				  For query planning, the engine draws information from:
				</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
							The <code class="literal">where</code>-clauses, if any are specified. <code class="literal">Where</code>-clauses correlate streams, patterns, named windows, tables etc. with more streams, patterns, tables and named windows and are thus the main source of information for query planning.
						</p></li><li><p>
							The data window(s) declared on streams and named windows. 
							The <code class="literal">#unique</code> and the <code class="literal">#firstunique</code> data window instruct the engine to retain the last event per unique criteria.
						</p></li><li><p>
							For named windows and tables, the explicit indexes created via <code class="literal">create unique index</code> or <code class="literal">create index</code>.
						</p></li><li><p>
							For named windows (and not tables), the previously created implicit indexes. The engine can create implicit indexes automatically if explicit indexes do not match correlation requirements.
						</p></li><li><p>
							Any hints specified for the statement in question and including hints specified during the creation of named windows with <code class="literal">create window</code>.
						</p></li></ol></div><p>
				   The engine prefers unique indexes over non-unique indexes.
				</p><p>
				   The engine prefers hash-based lookups (equals) and combination hash-btree lookups (equals and relational-operator or range) over btree lookups (relational-operator or range)
				   over in-keyword (single and multi-index) lookup plans. This behavior can be controlled by hints that are discussed next.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-25a"/>23.2.33.Â Query Planning Expression Analysis Hints</h3></div></div></div><p>
					The expression analysis hints impact query planning for any statement and fire-and-forget query that performs a join or subquery. They also impact named window and table on-action statements.					
				</p><p>
					This hint instructs the engine which expressions, operators or streams should be excluded and therefore not considered for query planning. 
					The hint applies to the <code class="literal">where</code>-clause and, for outer joins, to the <code class="literal">on</code>-clause when present.
				</p><p>
					The hint takes a single expression as its sole parameter, which is placed in parenthesis. The expression must return a boolean value.
				</p><p>
					When the provided expression returns true for a given combination, that combination will not be considered for the query plan. 
					A combination consists of a from-stream (name or number), a to-stream (name or number), an operator (i.e. equals, relational, in-keyword) and a set of expressions.					
				</p><div class="table"><a id="d0e51053"/><p class="title"><b>TableÂ 23.1.Â Built-In Properties of the Expression Analysis Hint</b></p><div class="table-contents"><table summary="Built-In Properties of the Expression Analysis Hint" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>exprs</td><td>string-array (<code class="literal">String[]</code>)</td><td>Expression texts with minified whitespace.</td></tr><tr><td>from_streamname</td><td>string</td><td>The stream name of the stream providing lookup values as provided by the <code class="literal">as</code> keyword.</td></tr><tr><td>from_streamnum</td><td>int</td><td>The integer ordinal number of the stream providing lookup values as listed in the from-clause.</td></tr><tr><td>opname</td><td>string</td><td>The operator name. Valid values are <code class="literal">equals</code>, <code class="literal">relop</code> (relational operators and ranges) and <code class="literal">inkw</code> (<code class="literal">in</code>-keyword).</td></tr><tr><td>to_streamname</td><td>string</td><td>The stream name of the stream providing indexable values as provided by the <code class="literal">as</code> keyword.</td></tr><tr><td>to_streamnum</td><td>int</td><td>The integer ordinal number of the stream providing indexable values as listed in the from-clause.</td></tr></tbody></table></div></div><br class="table-break"/><p>
					Consider two event types A and B. Event type A has a property <code class="literal">aprop</code> and 
					event type B has a property <code class="literal">bprop</code>. Let's assume A and B are related by <code class="literal">aprop</code> and <code class="literal">bprop</code>.
				</p><p>
					An inner join of all A and B events might look like this:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from A#keepall as a, B#keepall as b where aprop = bprop</pre><p>
					In the default query plan, when an A event comes in, the engine obtains the value of <code class="literal">aprop</code> and performs an index lookup against <code class="literal">bprop</code>
					values to obtain matching B events. Vice versa, when a B event comes in, the engine obtains the value of <code class="literal">bprop</code> and performs an index lookup against <code class="literal">aprop</code> values to obtain matching A events.
				</p><p>
					The engine evaluates the hint expression for each combination. The table below outlines the two rows provided to the hint expression:
				</p><div class="table"><a id="d0e51166"/><p class="title"><b>TableÂ 23.2.Â Built-In Properties of the Expression Analysis Hint</b></p><div class="table-contents"><table summary="Built-In Properties of the Expression Analysis Hint" border="1"><colgroup><col/><col/><col/><col/><col/><col/></colgroup><thead><tr><th>exprs</th><th>from_streamname</th><th>from_streamnum</th><th>opname</th><th>to_streamname</th><th>to_streamnum</th></tr></thead><tbody><tr><td><code class="literal">["aprop", "bprop"]</code></td><td><code class="literal">a</code></td><td><code class="literal">0</code></td><td><code class="literal">equals</code></td><td><code class="literal">b</code></td><td><code class="literal">1</code></td></tr><tr><td><code class="literal">["bprop", "aprop"]</code></td><td><code class="literal">b</code></td><td><code class="literal">1</code></td><td><code class="literal">equals</code></td><td><code class="literal">a</code></td><td><code class="literal">0</code></td></tr></tbody></table></div></div><br class="table-break"/><p>
					The following EPL statement with hint causes the analyzer to exclude all combinations since the expression passed in always returns true,
					in effect causing the query planner to always execute the statement as a full table scan.
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@hint('exclude_plan(true)')
select * from A#keepall as a, B#keepall as b where aprop = bprop</pre><p>
					This hint instructs the engine to ignore all equals-operators for query planning:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@hint('exclude_plan(opname="equals")') select ....</pre><p>
					The next hint instructs the engine to ignore the equals-operator for the direction of lookup from A to B:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@hint('exclude_plan(opname="equals" and from_streamname="a")') select ....</pre><p>
					Conversely, this hint instructs the engine to ignore the equals-operator for the direction of lookup from B to A:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@hint('exclude_plan(opname="equals" and from_streamname="b")') select ....</pre><p>
					Use the <code class="literal">exprs</code> array of expression texts to exclude specific expressions:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@hint('exclude_plan(exprs[0]="aprop")') select ....</pre><p>
					For subqueries the stream number zero is the subquery from-clause itself and 1 to N are the enclosing statement's from-clause streams.
					For named window and table on-action statements the stream number zero is the named window or table and stream number 1 refers to the triggering pattern or event.
				</p><p>
					To specify multiple expressions, please specify multiple hints. The engine excludes a specific combination when any of the hint expressions returns true.
				</p><p>
					To inspect values passed to the hint expression, please enable query plan logging. To inspect expression evaluation, please use <code class="literal">@Audit</code>.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-25b"/>23.2.34.Â Query Planning Index Hints</h3></div></div></div><p>
				  Currently index hints are only supported for the following types of statements:
				</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
							Named window and table on-action statements (on-select, on-merge, on-insert, on-update, on-select).
						</p></li><li><p>
							Statements that have subselects against named windows that have index sharing enabled (the default is disabled).
						</p></li><li><p>
							Statements that have subselects against tables.
						</p></li><li><p>
							Fire-and-forget queries.
						</p></li></ol></div><p>
				  For the above statements, you may dictate to the engine which explicit index (created via <code class="literal">create index</code> syntax) to use.
				</p><p>
				  Specify the name of the explicit index in parentheses following <code class="literal">@Hint</code> and the <code class="literal">index</code> literal.
				</p><p>
				  The following example instructs the engine to use the <code class="literal">UserProfileIndex</code> if possible:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Hint('index(UserProfileIndex)')</pre><p>
				  Add the literal <code class="literal">bust</code> to instruct the engine to use the index, or if the engine cannot use the index fail query planning with an exception and therefore fail statement creation.
				</p><p>
				  The following example instructs the engine to use the <code class="literal">UserProfileIndex</code> if possible or fail with an exception if the index cannot be used:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Hint('index(UserProfileIndex, bust)')</pre><p>
				  Multiple indexes can be listed separated by comma (<code class="literal">,</code>). 
				</p><p>
				  The next example instructs the engine to consider the <code class="literal">UserProfileIndex</code> and the <code class="literal">SessionIndex</code> or fail with an exception if either index cannot be used:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Hint('index(UserProfileIndex, SessionIndex, bust)')</pre><p>
				  The literal <code class="literal">explicit</code> can be added to instruct the engine to use only explicitly created indexes.
				</p><p>
				  The final example instructs the engine to consider any explicitly create index or fail with an exception if any of the explicitly created indexes cannot be used:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Hint('index(explicit, bust)')</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-26"/>23.2.35.Â Measuring Throughput</h3></div></div></div><p>
					We recommend using <code class="literal">System.nanoTime()</code> to measure elapsed time when processing a batch of, for example, 1000 events.
				</p><p>
					Note that <code class="literal">System.nanoTime()</code> provides nanosecond precision, but not necessarily nanosecond resolution.  
				</p><p>
					Therefore don't try to measure the time spent by the engine processing a single event: The resolution of <code class="literal">System.nanoTime()</code> is not sufficient. 
					Also, there are reports that <code class="literal">System.nanoTime()</code> can be actually go "backwards" and may not always behave as expected under threading. 
					Please check your JVM platform documentation.
				</p><p>
				  In the default configuration, the best way to measure performance is to take nano time, send a large number of events, for example 10.000 events, and take nano time again reporting on the difference between the two numbers.
				</p><p>
				  If your configuration has inbound threading or other threading options set, you should either monitor the queue depth to determine performance, or disable 
				  threading options when measuring performance, or have your application use multiple threads to send events instead.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-27"/>23.2.36.Â Do Not Create the Same or Similar EPL Statement X Times</h3></div></div></div><p>
					It is vastly more efficient to create an EPL statement once and attach multiple listeners, then to create the same EPL statement X times.
				</p><p>
					It is vastly more efficient to use context declarations to factor out commonalities between EPL statements then creating X similar EPL statements.
				</p><p>
					Esper is optimized for low-latency and high-throughput execution. In order to accomplish that each EPL statement must be analyzed and planned and certain information within each EPL statement must be shared within the engine so that it can remove duplication of processing and thus the engine can achieve low-latency and high-throughput. The tradeoff is that the engine must, for each EPL statement, perform some upfront analysis.
				</p><p>
					Since your goal will be to make all test code as realistic, real-world and production-like as possible, we recommend against production code or test code creating 
					the same or similar EPL statement multiple times. Instead consider creating the same EPL statement once and attaching multiple listeners.
					Certain important optimizations that the engine can perform when EPL statements realistically differ, may not take place. 
					The engine also does not try to detect duplicate EPL statements, since that can easily be done by your application using public APIs. 
				</p><p>
					Let's assume your test statement computes an aggregation over a 1-minute time window, for example <code class="literal">select symbol, count(*) from StockTick#time(1 min) group by symbol</code>.
					If your code creates the same statement 100 times, and depending on engine configuration, the code instructs the engine to track 100 logically independent time windows 
					and to track aggregations for each group 100 times. Obviously, this is not a good use of EPL and the design of your EPL statements and code may not be optimal.
				</p><p>
					Consider the world of relational databases. Your code could attach to a relational database, create the same table with a different name 100 times, 
					and populate each of the 100 different tables with the same row data. A relational database administrator would probably recommend against creating 100 identical tables holding the same row data. 
					Compare an EPL statement to a relational database table in respect to how many there should be. 
					In a good design there are limited number of EPL statements. Esper is not specifically designed for very large number of EPL statements. 
					Similarly a relational database schema design that has 100,000 tables would be something one would seriously question.
					 It depends on the EPL statement itself in respect to how many EPL statements fit into memory and there is no general guideline.
				</p><p>
					EPL allows you the freedom to design your EPL in a way that reuses state and processing.
					For example, your EPL design could utilize a named window instead of allocating 100 independent time window. 
					Since named windows are shared, the engine only needs to track one time window instead of 100.
					And your EPL design could use an EPL table to maintain aggregations once and in a central place, so that tracking counts per symbol is done once instead of 100 times.
				</p><p>
					Context declarations can be an efficient way to take commonalities between statements (things that are similar between multiple statements) 
					and factor them out into a context declaration. Instead of creating X similar statements, 
					declare a context and attach one statement to the context, thus having X context partitions. This reduces the analysis that the engine must perform for each statement
					since now the engine only needs to analyze the context declaration and the EPL statement. 
					Your application can send start and stop events to control which context partitions exist and what events each context partition analyzes. 
					Use the context partition administrative API to browse or terminate context partitions.
				</p><p>
					For example, assume you need to create 100000 similar EPL statements that all filter <code class="literal">GeoEvent</code> events: 
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema GeoEvent(id string, value int, marker string)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@name('statment-1) select * from GeoEvent(id = '0001', value between 10 and 20, marker in ('a', 'b'))</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@name('statment-N) select * from GeoEvent(id = '0002', value between 20 and 30, marker in ('c', 'd'))</pre><p>
					If your application creates 100k statements as above, the engine must analyze each statement separately, determine filter criteria and the engine must enter each set of filter criteria into a shared filter index tree. Remember that
					the engine can process incoming events very fast, with low latency and high throughput, even for 100k statements. However analysis of 100k individual statements does take CPU time.
				</p><p>
					In this example, the EPL statements have similar filters: <code class="literal">id = </code><span class="emphasis"><em>an_id</em></span>, <code class="literal">value between </code><span class="emphasis"><em>start_range</em></span><code class="literal"> and </code><span class="emphasis"><em>end_range</em></span> and
					<code class="literal">marker in (</code><span class="emphasis"><em>markers</em></span><code class="literal">)</code>.
					You could say that statements are similar and look like:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from GeoEvent(id=an_id, value between start_range and end_range, marker in (markers))</pre><p>
					The <span class="emphasis"><em>an_id</em></span>, <span class="emphasis"><em>start_range</em></span>, <span class="emphasis"><em>end_range</em></span> and <span class="emphasis"><em>markers</em></span> are essential parameters to an instance of the filtering EPL statement.
					Instances of EPL statements are context partitions. Declare a context to refactor and change our design so the common filters are in one place. 
					This apprach just requires two statements: the context declaration and the statement with the filters. 
					You may declare two event types: one to allocate new context partitions and one to terminate context partitions.
				</p><p>
					Start by creating an event type that controls which instances of the filtering EPL statement (the context partitions) are active:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema InitEvent(id string, startRange int, endRange int, markers string[])</pre><p>
					Next, create an event type that controls when a context partition terminates:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create schema TermEvent(id string)</pre><p>
					The context declaration tells the engine that when an <code class="literal">InitEvent</code> arrives you want have a new instance that is parameterized by the <code class="literal">InitEvent</code> properties:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create context GeoEventFilterContext
  initiated by InitEvent as initevent
  terminated by by TermEvent(id=initevent.id)</pre><p>
					Define the statement that filters:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">context GeoEventFilterContext select * from GeoEvent(id = context.initevent.id, 
  value between context.initevent.startRange and context.initevent.endRange, 
  marker in (context.initevent.markers))</pre><p>
					 Your application can now send <code class="literal">InitEvent</code> instances, for example (notation from the online EPL tool):
				 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">InitEvent={id='0001', startRange=10, endRange=20, markers={'a', 'b'}}
InitEvent={id='0002', startRange=20, endRange=30, markers={'c', 'd'}}</pre><p>
					When the engine receives an <code class="literal">InitEvent</code> instance, it can simply take the <code class="literal">id</code>, <code class="literal">startRange</code>, <code class="literal">endRange</code> and <code class="literal">markers</code> values and 
					instantiate the EPL filter statement (aka. allocate a new context partition) and start looking for matching <code class="literal">GeoEvent</code> events.
				</p><p>
					To stop looking for a given id, send a <code class="literal">TermEvent</code>, like so:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">TermEvent={id='0001'}</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-28"/>23.2.37.Â Comparing Single-Threaded and Multi-Threaded Performance</h3></div></div></div><p>
					The Java Virtual Machine optimizes locks such that the time to obtain a read lock, for example, differs widely between single-threaded and multi-threaded applications.
					 We compared code that obtains an unfair <code class="literal">ReentrantReadWriteLock</code> read lock 100 million times, without any writer. 
					 We measured 3 seconds for a single-threaded application and 15 seconds for an application with 2 threads.
					 It can therefore not be expected that scaling from single-threaded to 2 threads will always double performance. There is a base cost for multiple threads to coordinate.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-29"/>23.2.38.Â Incremental Versus Recomputed Aggregation for Named Window Events</h3></div></div></div><p>
				  Whether aggregations of named window rows are computed incrementally or are recomputed from scratch depends on the type of query.
				</p><p>
				  When the engine computes aggregation values incrementally, meaning it continuously updates the aggregation value as events enter and leave a named window,
				  it means that the engine internally subscribes to named window updates and applies these updates as they occur. For some applications this is the desired behavior.
				</p><p>
				  For some applications re-computing aggregation values from scratch when a certain condition occurs, for example when a triggering event arrives or time passes, is beneficial. Re-computing an aggregation
				  can be less expensive if the number of rows to consider is small and/or when the triggering event or time condition triggers infrequently.
				</p><p>
				  The next paragraph assumes that a named window has been created to hold some historical financial data per symbol and minute:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create window HistoricalWindow#keepall as (symbol string, int minute, double price)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into HistoricalWindow select symbol, minute, price from HistoricalTick</pre><p>
				  For statements that simply select from a named window (excludes on-select) the engine computes aggregation values incrementally, continuously updating the aggregation, as events enter and leave the named window.
				</p><p>
				  For example, the below statement updates the total price incrementally as events enter and leave the named window. If events in the named window already 
				  exist at the time the statement gets created, the total price gets pre-computed once when the statement gets created and incrementally updated when events enter and leave the named window:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sum(price) from HistoricalWindow(symbol='GE')</pre><p>
				  The same is true for uncorrelated subqueries. 
				  For statements that sub-select from a named window, the engine computes aggregation values incrementally, continuously updating the aggregation, as events enter and leave the named window.
				  This is only true for uncorrelated subqueries that don't have a where-clause.
				</p><p>
				  For example, the below statement updates the total price incrementally as events enter and leave the named window. If events in the named window already 
				  exist at the time the statement gets created, the total price gets pre-computed once when the statement gets created and incrementally updated when events enter and leave the named window:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Output GE symbol total price, incrementally computed
// Outputs every 15 minutes on the hour.
select (sum(price) from HistoricalWindow(symbol='GE')) 
from pattern [every timer:at(0, 15, 30, 45), *, *, *, *, 0)]</pre><p>
				  If instead your application uses <code class="literal">on-select</code> or a correlated subquery, the engine recomputes aggregation values from scratch every time the triggering event fires.
				</p><p>
				  For example, the below statement does not incrementally compute the total price (use a plain select or subselect as above instead). 
				  Instead the engine computes the total price from scratch based on the where-clause and matching rows:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Output GE symbol total price (recomputed from scratch) every 15 minutes on the hour
on pattern [every timer:at(0, 15, 30, 45), *, *, *, *, 0)]
select sum(price) from HistoricalWindow where symbol='GE'</pre><p>
				  Unidirectional joins against named windows also do not incrementally compute aggregation values.
				</p><p>
				  Joins and outer joins, that are not unidirectional, compute aggregation values incrementally.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-30"/>23.2.39.Â When Does Memory Get Released</h3></div></div></div><p> 
					Java Virtual Machines (JVMs) release memory only when a garbage collection occurs. Depending on your JVM settings a garbage collection can occur frequently or
					infrequently and may consider all or only parts of heap memory.
				</p><p>
				  Esper is optimized towards latency and throughput. Esper does not force garbage collection or interfere with garbage collection. 
				  For performance-sensitive code areas, Esper utilizes thread-local buffers such as arrays or ringbuffers that can retain small amounts of recently processed state. 
				  Esper does not try to clean such buffers after every event for performance reasons. It does clean such buffers when destroying the engine and stopping or destroying statements.
				  It is therefore normal to see a small non-increasing amount of memory to be retained after processing events that the garbage collector may not free immediately.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="perf-tips-31"/>23.2.40.Â Measure throughput of non-matches as well as matches</h3></div></div></div><p> 
					When an event comes in and the event does not match any query or pattern, the engine can discard that event since the event is a non-match.
					When measuring throughput, we suggest including non-matching events. The fact that the engine can discard non-matching events extremely fast is an important aspect of processing.
				</p><p> 
					Many use cases look for a needle-in-a-haystack situation or rarely occurring pattern. For example, a use case looking for security breaches may analyze 10 million events
					and find only a single situation consisting, for example, of 5 correlated events of the 10 million input events. We'd recommend your benchmark to closely mimic or to play back
					production data and watch the expected ratio of input and output events. Reducing the number of output events generally increases performance.
				</p><p> 
					For example, assume you have 10 queries:
				</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select * from pattern[A -&gt; B(id = 1)];
select * from pattern[A -&gt; B(id = 2)];
.....
select * from pattern[A -&gt; B(id = 10)];</pre><p>
					The above patterns each match once when an A event comes in followed by a B event with a given id between 1 and 10.					
				</p><p>
					We recommend to measure throughput by sending in B events that have a value of minus one (-1) for id, for example, to determine how fast such events are discarded.
				</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="performance-kit"/>23.3.Â Using the Performance Kit</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="how-to-kit"/>23.3.1.Â How to Use the Performance Kit</h3></div></div></div><p>
            The benchmark application is basically an Esper event server build with Esper that listens to remote clients
            over TCP.
            Remote clients send MarketData(ticker, price, volume) streams to the event server.
            The Esper event server is started with 1000 statements of one single kind (unless otherwise written),
            with one statement per ticker symbol, unless the statement kind does not depend on the symbol.
            The statement prototype is provided along the results with a '$' instead of the actual ticker symbol value.
            The Esper event server is entirely multithreaded and can leverage the full power of 32bit or 64bit
            underlying hardware multi-processor multi-core architecture.
        </p><p>
                The kit also prints out when starting up the event size and the theoretical maximal throughput you can get on a
                100 Mbit/s and 1 Gbit/s network. Keep in mind a 100 Mbit/s network will be overloaded at about 400 000 event/s when using our kit despite
                the small size of events.
            </p><p>
            Results are posted on our Wiki page at <a class="link" href="http://www.espertech.com/esper" target="">Performance Wiki</a>.
            Reported results do not represent best ever obtained results. Reported results may help you better compare
            Esper to other solutions (for latency, throughput and CPU utilization) and also assess your target hardware and JVMs.
        </p><p>
                The Esper event server, client and statement prototypes are provided in the source repository
                <code class="literal">esper/trunk/examples/benchmark/</code>. 
                Refer to <a class="link" href="http://www.espertech.com/esper" target="">http://www.espertech.com/esper</a>
                for source access.
            </p><p>
                If you use the kit you should:
            </p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
                        Choose the statement you want to benchmark, add it to
                        <code class="literal">etc/statements.properties</code>
                        under
                        your own KEY and use the
                        <code class="literal">-mode KEY</code>
                        when you start the Esper event server.
                    </p></li><li><p>
                        Prepare your runServer.sh/runServer.cmd and runClient.sh/runclient.cmd scripts. You'll need to
                        drop required
                        jar libraries in
                        <code class="literal">lib/</code>
                        , make sure the classpath is configured in those script to include
                        <code class="literal">build</code>
                        and
                        <code class="literal">etc</code>
                        . The required libraries are Esper (any compatible version, we have tested started with Esper
                        1.7.0)
                        and its dependencies.
                        Note that <code class="literal">./etc</code> and <code class="literal">./build</code> have to be in the classpath.
                        At that stage you should also start to set min and max JVM heap. A good start is 1GB as in
                        <code class="literal">-Xms1g -Xmx1g</code>
                    </p></li><li><p>
                        Write the statement you want to benchmark given that client will send a stream MarketData(String
                        ticker, int volume, double price), add it to
                        <code class="literal">etc/statements.properties</code>
                        under
                        your own KEY and use the
                        <code class="literal">-mode KEY</code>
                        when you start the Esper event server.
                        Use <code class="literal">'$'</code> in the statement to create a prototype. For every symbol, a statement
                        will get registered with all <code class="literal">'$'</code> replaced by the actual symbol value (f.e. <code class="literal">'GOOG'</code>)
                    </p></li><li><p>
                        Ensure client and server are using the same
                        <code class="literal">-Desper.benchmark.symbol=1000</code> value.
                        This sets the number of symbol to use (thus may set the number of statement if you are using
                        a statement prototype, and governs how MarketData event are represented over the network.
                        Basically all events will have the same size over the network to ensure predictability and will be ranging
                        between <code class="literal">S0AA</code> and <code class="literal">S999A</code> if you use 1000 as a value here (prefix with S and padded with A up to
                        a fixed length string. Volume and price attributes will be randomized.
                    </p></li><li><p>
                        By default the benchmark registers a subscriber to the statement(s). Use <code class="literal">-Desper.benchmark.ul</code> to use
                        an UpdateListener instead. Note that the subscriber contains suitable update(..) methods for the default
                        proposed statement in the <code class="literal">etc/statements.properties</code> file but might not be suitable if you change statements due
                        to the strong binding with statement results. Refer to <a class="xref" href="#api-receive-results" title="14.3.2.Â Receiving Statement Results">SectionÂ 14.3.2, âReceiving Statement Resultsâ</a>.
                    </p></li><li><p>
                        Establish a performance baseline in simulation mode (without clients). Use the
                        <code class="literal">-rate 1x5000</code>
                        option
                        to simulate one client (one thread) sending 5000 evt/s. You can ramp up both the number of client simulated
                        thread and their emission rate to maximize CPU
                        utilization.
                        The right number should mimic the client emission rate you will use in the client/server benchmark
                        and should thus be
                        consistent with what your client machine and network will be able to send.
                        On small hardware, having a lot of thread with slow rate will not help getting high throughput in this
                        simulation mode.
                    </p></li><li><p>
                        Do performance runs with client/server mode. Remove the
                        <code class="literal">-rate NxM</code>
                        option from the runServer script or Ant task.
                        Start the server with
                        <code class="literal">-help</code>
                        to display the possible server options (listen port, statistics, fan out options etc).
                        On the remote machine, start one or more client. Use
                        <code class="literal">-help</code>
                        to display the possible client options (remote port, host,
                        emission rate). The client will output the actual number of event it is sending to the server.
                        If the server gets overloaded (or if you turned on
                        <code class="literal">-queue</code>
                        options on the server) the client will likely
                        not be able to reach its target rate.
                    </p><p>
                        Usually you will get better performance by using server side <code class="literal">-queue -1</code> option so as to have
                        each client connection handled by a single thread pipeline. If you change to 0 or more, there will be
                        intermediate structures to pass the event stream in an asynchronous fashion. This will increase context
                        switching, although if you are using many clients, or are using the <code class="literal">-sleep xxx</code> (xxx in
                        milliseconds) to simulate a listener delay you may get better performance.
                    </p><p>
                        The most important server side option is <code class="literal">-stat xxx</code> (xxx in seconds) to print out
                        throughput and latency statistics aggregated over the last xxx seconds (and reset every time).
                        It will produce both internal Esper latency (in nanosecond) and also end to end latency (in millisecond, including network time).
                        If you are measuring end to end latency you should make sure your server and client machine(s) are having the same time
                        with f.e. ntpd with a good enough precision.
                        The stat format is like:
                     </p><pre xmlns="" class="">---Stats - engine (unit: ns)
  Avg: 2528 #4101107
        0 &lt;    5000:  97.01%  97.01% #3978672
     5000 &lt;   10000:   2.60%  99.62% #106669
    10000 &lt;   15000:   0.35%  99.97% #14337
    15000 &lt;   20000:   0.02%  99.99% #971
    20000 &lt;   25000:   0.00%  99.99% #177
    25000 &lt;   50000:   0.00% 100.00% #89
    50000 &lt;  100000:   0.00% 100.00% #41
   100000 &lt;  500000:   0.00% 100.00% #120
   500000 &lt; 1000000:   0.00% 100.00% #2
  1000000 &lt; 2500000:   0.00% 100.00% #7
  2500000 &lt; 5000000:   0.00% 100.00% #5
  5000000 &lt;    more:   0.00% 100.00% #18
---Stats - endToEnd (unit: ms)
  Avg: -2704829444341073400 #4101609
        0 &lt;       1:  75.01%  75.01% #3076609
        1 &lt;       5:   0.00%  75.01% #0
        5 &lt;      10:   0.00%  75.01% #0
       10 &lt;      50:   0.00%  75.01% #0
       50 &lt;     100:   0.00%  75.01% #0
      100 &lt;     250:   0.00%  75.01% #0
      250 &lt;     500:   0.00%  75.01% #0
      500 &lt;    1000:   0.00%  75.01% #0
     1000 &lt;    more:  24.99% 100.00% #1025000
Throughput 412503 (active 0 pending 0 cnx 4)</pre><p>
                          This one reads as:
						</p><pre xmlns="" class="">"Throughput is 412 503 event/s with 4 client connected. No -queue options 
was used thus no event is pending at the time the statistics are printed. 
Esper latency average is at 2528 ns (that is 2.5 us) for 4 101 107 events 
(which means we have 10 seconds stats here). Less than 10us latency 
was achieved for 106 669 events that is 99.62%. Latency between 5us 
and 10us was achieved for those 2.60% of all the events in the interval."

"End to end latency was ... in this case likely due to client clock difference
we ended up with unusable end to end statistics."</pre><p>
		Consider the second output paragraph on end-to-end latency:
	</p><pre xmlns="" class="">---Stats - endToEnd (unit: ms)
  Avg: 15 #863396
        0 &lt;       1:   0.75%   0.75% #6434
        1 &lt;       5:   0.99%   1.74% #8552
        5 &lt;      10:   2.12%   3.85% #18269
       10 &lt;      50:  91.27%  95.13% #788062
       50 &lt;     100:   0.10%  95.32% #827
      100 &lt;     250:   4.36%  99.58% #37634
      250 &lt;     500:   0.42% 100.00% #3618
      500 &lt;    1000:   0.00% 100.00% #0
     1000 &lt;    more:   0.00% 100.00% #0</pre><p>
		 This would read:
     </p><pre xmlns="" class="">"End to end latency average is at 15 milliseconds for the 863 396 events 
considered for this statistic report. 95.13% ie 788 062 events were handled 
(end to end) below 50ms, and 91.27% were handled between 10ms and 50ms."</pre></li></ol></div></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="references"/>ChapterÂ 24.Â References</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#references-listing">24.1. Reference List</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="references-listing"/>24.1.Â Reference List</h2></div></div></div><div class="itemizedlist"><ul compact="compact"><li><p>
					Luckham, David. 2002. <span class="emphasis"><em>The Power of Events.</em></span> Addison-Wesley.
				</p></li><li><p>
					The Stanford Rapide (TM) Project. <span class="emphasis"><em>http://pavg.stanford.edu/rapide</em></span>.
				</p></li><li><p>
					Arasu, Arvind, et.al.. 2004. Linear Road: A Stream Data Management Benchmark, Stanford University <span class="emphasis"><em>http://www.cs.brown.edu/research/aurora/Linear_Road_Benchmark_Homepage.html</em></span>.
				</p></li></ul></div></div></div><div class="appendix" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_outputspec"/>AppendixÂ A.Â Output Reference and Samples</h2></div></div></div><p>
		This section specifies the output of a subset of EPL continuous queries, for two purposes: First, to help application developers understand streaming engine output in response to incoming events and in response to time passing. Second, to document and standardize output for EPL queries in a testable and trackable fashion. 
    </p><p>
		The section focuses on a subset of features, namely the time window, aggregation, grouping, and output rate limiting. The section does not currently provide examples for many of the other language features, thus there is no example for other data windows (the time window is used here), joins, sub-selects or named windows etc.
    </p><p>
		Rather then just describe syntax and output, this section provides detailed examples for each of the types of queries presented. The input for each type of query is always the same set of events, and the same timing. Each event has three properties: symbol, volume and price. The property types are string, long and double, respectively.
    </p><p>
		The chapters are organized by the type of query: The presence or absence of aggregation functions, as well as the presence or absence of a <code class="literal">group by</code> clause change statement output as 
		described in <a class="xref" href="#">???</a>.
	</p><p>
		You will notice that some queries utilize the <code class="literal">order by</code> clause for sorting output. The reason is that when multiple output rows are produced at once, the output can be easier to read if it is sorted.
	</p><p>
	    With output rate limiting, the engine invokes your listener even if there are no results to indicate when the output condition has been reached. Such is indicated as <code class="literal">(empty result)</code> in the output result columns.
	</p><p>
	    The output columns show both insert and remove stream events. Insert stream events are delivered as an array of <code class="literal">EventBean</code> instances to listeners in the <code class="literal">newData</code> parameter, while remove stream events are delivered to the <code class="literal">oldData</code> parameter of listeners. Delivery to observers follows similar rules.
	</p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="outputspec-intro"/>A.1.Â Introduction and Sample Data</h2></div></div></div><p>
			For the purpose of illustration and documentation, the example data set demonstrates input and remove streams based on a time window of a 5.5 second interval. The statement utilizing the time window 
			could look as follows:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select symbol, volume, price from MarketData#time(5.5 sec)</pre><p>
			We have picked a time window to demonstrate the output for events entering and leaving a data window with an expiration policy. The time window provides a simple expiration policy based on time: if an event resides in the time window more then 5.5 seconds, the engine expires the event from the time window.
		</p><p>
			The input events and their timing are below. The table should be read, starting from top, as "The time starts at 0.2 seconds. Event E1 arrives at 0.2 seconds with properties [S1, 100, 25]. At 0.8 second event E2 arrives with properties [S2, 5000, 9.0]" and so on.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
                       Input                                 
-----------------------------------------------  
 Time Symbol  Volume   Price
  0.2                          
          S1     100    25.0   Event E1 arrives
  0.8                          
          S2    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
  1.5                          
          S1     150    24.0   Event E3 arrives
          S3   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
          S1     155    26.0   Event E5 arrives
  2.2                          
  2.5                          
  3.0                          
  3.2                          
  3.5                          
          S3   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
  4.3                          
          S1     150    22.0   Event E7 arrives
  4.9                          
          S3   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
  5.7                          Event E1 leaves the time window
  5.9                          
          S3   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          </pre><p>
			  The event data set assumes a time window of 5.5 seconds. Thus at time 5.7 seconds the first arriving event (E1) leaves the time window.
		  </p><p>
			The data set as above shows times between 0.2 seconds and 7.2 seconds. Only a couple of time points have been picked for the table to keep the set of time points constant between statements, and thus make the test data and output easier to understand. 
			</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="outputspec-simple"/>A.2.Â Output for Un-Aggregated and Un-Grouped Queries</h2></div></div></div><p>
			This chapter provides sample output for queries that do not have aggregation functions and do not have a <code class="literal">group by</code> clause.
        </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-simple-none"/>A.2.1.Â No Output Rate Limiting</h3></div></div></div><p>
				Without an <code class="literal">output</code> clause, the engine dispatches to listeners as soon as events arrive, or as soon as time passes such that events leave data windows.
			</p><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, volume, price from MarketData#time(5.5 sec)</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
                                                 [IBM, 100, 25.0]                       
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
                                                 [MSFT, 5000, 9.0]                      
  1.0                          
  1.2                          
  1.5                          
         IBM     150    24.0   Event E3 arrives
                                                 [IBM, 150, 24.0]                       
         YAH   10000     1.0   Event E4 arrives
                                                 [YAH, 10000, 1.0]                      
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
                                                 [IBM, 155, 26.0]                       
  2.2                          
  2.5                          
  3.0                          
  3.2                          
  3.5                          
         YAH   11000     2.0   Event E6 arrives
                                                 [YAH, 11000, 2.0]                      
  4.0                          
  4.2                          
  4.3                          
         IBM     150    22.0   Event E7 arrives
                                                 [IBM, 150, 22.0]                       
  4.9                          
         YAH   11500     3.0   Event E8 arrives
                                                 [YAH, 11500, 3.0]                      
  5.0                          
  5.2                          
  5.7                          Event E1 leaves the time window
                                                                    [IBM, 100, 25.0]    
  5.9                          
         YAH   10500     1.0   Event E9 arrives
                                                 [YAH, 10500, 1.0]                      
  6.0                          
  6.2                          
  6.3                          Event E2 leaves the time window
                                                                    [MSFT, 5000, 9.0]   
  7.0                          Event E3 and E4 leave the time window
                                                                    [IBM, 150, 24.0]    
                                                                    [YAH, 10000, 1.0]   
  7.2                          </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-simple-default"/>A.2.2.Â Output Rate Limiting - Default</h3></div></div></div><p>
				With an <code class="literal">output</code> clause, the engine dispatches to listeners when the output condition occurs. Here, the output condition is a 1-second time interval. The engine thus outputs every 1 second, starting from the first event, even if there are no new events or no expiring events to output.
			</p><p>
				The default (no keyword) and the <code class="literal">ALL</code> keyword result in the same output.
			</p><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, volume, price from MarketData#time(5.5 sec) 
output every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [IBM, 100, 25.0]                       
                                                 [MSFT, 5000, 9.0]                      
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [IBM, 150, 24.0]                       
                                                 [YAH, 10000, 1.0]                      
                                                 [IBM, 155, 26.0]                       
  2.5                          
  3.0                          
  3.2                          
                                                 (empty result)     (empty result)      
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [YAH, 11000, 2.0]                      
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [IBM, 150, 22.0]                       
                                                 [YAH, 11500, 3.0]                      
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [YAH, 10500, 1.0]  [IBM, 100, 25.0]    
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                                    [MSFT, 5000, 9.0]   
                                                                    [IBM, 150, 24.0]    
                                                                    [YAH, 10000, 1.0] </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-simple-last"/>A.2.3.Â Output Rate Limiting - Last</h3></div></div></div><p>
				Using the <code class="literal">LAST</code> keyword in the <code class="literal">output</code> clause, the engine dispatches to listeners only the last event of each insert and remove stream.
			</p><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, volume, price from MarketData#time(5.5 sec) 
output last every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [MSFT, 5000, 9.0]                      
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [IBM, 155, 26.0]                       
  2.5                          
  3.0                          
  3.2                          
                                                 (empty result)     (empty result)      
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [YAH, 11000, 2.0]                      
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [YAH, 11500, 3.0]                      
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [YAH, 10500, 1.0]  [IBM, 100, 25.0]    
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                                    [YAH, 10000, 1.0] </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-simple-first"/>A.2.4.Â Output Rate Limiting - First</h3></div></div></div><p>
				Using the <code class="literal">FIRST</code> keyword in the <code class="literal">output</code> clause, the engine dispatches to listeners only the first event of each insert or remove stream, and does not output further
				events until the output condition is reached.
			</p><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, volume, price from MarketData#time(5.5 sec)
output first every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
                                                 [IBM, 100, 25.0]                       
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
  1.5                          
         IBM     150    24.0   Event E3 arrives
                                                 [IBM, 150, 24.0]                       
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
  2.5                          
  3.0                          
  3.2                          
  3.5                          
         YAH   11000     2.0   Event E6 arrives
                                                 [YAH, 11000, 2.0]                      
  4.0                          
  4.2                          
  4.3                          
         IBM     150    22.0   Event E7 arrives
                                                 [IBM, 150, 22.0]                       
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
  5.7                          Event E1 leaves the time window
                                                                    [IBM, 100, 25.0]    
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
  6.3                          Event E2 leaves the time window
                                                                    [MSFT, 5000, 9.0]   
  7.0                          Event E3 and E4 leave the time window
  7.2                          		</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-simple-snapshot"/>A.2.5.Â Output Rate Limiting - Snapshot</h3></div></div></div><p>
				Using the <code class="literal">SNAPSHOT</code> keyword in the <code class="literal">output</code> clause, the engine posts data window contents when the output condition is reached.
			</p><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, volume, price from MarketData#time(5.5 sec)
output snapshot every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [IBM, 100, 25.0]                       
                                                 [MSFT, 5000, 9.0]                      
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [IBM, 100, 25.0]                       
                                                 [MSFT, 5000, 9.0]                      
                                                 [IBM, 150, 24.0]                       
                                                 [YAH, 10000, 1.0]                      
                                                 [IBM, 155, 26.0]                       
  2.5                          
  3.0                          
  3.2                          
                                                 [IBM, 100, 25.0]                       
                                                 [MSFT, 5000, 9.0]                      
                                                 [IBM, 150, 24.0]                       
                                                 [YAH, 10000, 1.0]                      
                                                 [IBM, 155, 26.0]                       
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [IBM, 100, 25.0]                       
                                                 [MSFT, 5000, 9.0]                      
                                                 [IBM, 150, 24.0]                       
                                                 [YAH, 10000, 1.0]                      
                                                 [IBM, 155, 26.0]                       
                                                 [YAH, 11000, 2.0]                      
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [IBM, 100, 25.0]                       
                                                 [MSFT, 5000, 9.0]                      
                                                 [IBM, 150, 24.0]                       
                                                 [YAH, 10000, 1.0]                      
                                                 [IBM, 155, 26.0]                       
                                                 [YAH, 11000, 2.0]                      
                                                 [IBM, 150, 22.0]                       
                                                 [YAH, 11500, 3.0]                      
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [MSFT, 5000, 9.0]                      
                                                 [IBM, 150, 24.0]                       
                                                 [YAH, 10000, 1.0]                      
                                                 [IBM, 155, 26.0]                       
                                                 [YAH, 11000, 2.0]                      
                                                 [IBM, 150, 22.0]                       
                                                 [YAH, 11500, 3.0]                      
                                                 [YAH, 10500, 1.0]                      
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                 [IBM, 155, 26.0]                       
                                                 [YAH, 11000, 2.0]                      
                                                 [IBM, 150, 22.0]                       
                                                 [YAH, 11500, 3.0]                      
                                                 [YAH, 10500, 1.0] 			</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="outputspec-rowforall"/>A.3.Â Output for Fully-Aggregated and Un-Grouped Queries</h2></div></div></div><p>
			This chapter provides sample output for queries that have aggregation functions, and that do not have a <code class="literal">group by</code> clause, and in which all event properties are under aggregation.
        </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-rowforall-none"/>A.3.1.Â No Output Rate Limiting</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream sum(price) from MarketData#time(5.5 sec)</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
                                                 [25.0]             [null]              
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
                                                 [34.0]             [25.0]              
  1.0                          
  1.2                          
  1.5                          
         IBM     150    24.0   Event E3 arrives
                                                 [58.0]             [34.0]              
         YAH   10000     1.0   Event E4 arrives
                                                 [59.0]             [58.0]              
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
                                                 [85.0]             [59.0]              
  2.2                          
  2.5                          
  3.0                          
  3.2                          
  3.5                          
         YAH   11000     2.0   Event E6 arrives
                                                 [87.0]             [85.0]              
  4.0                          
  4.2                          
  4.3                          
         IBM     150    22.0   Event E7 arrives
                                                 [109.0]            [87.0]              
  4.9                          
         YAH   11500     3.0   Event E8 arrives
                                                 [112.0]            [109.0]             
  5.0                          
  5.2                          
  5.7                          Event E1 leaves the time window
                                                 [87.0]             [112.0]             
  5.9                          
         YAH   10500     1.0   Event E9 arrives
                                                 [88.0]             [87.0]              
  6.0                          
  6.2                          
  6.3                          Event E2 leaves the time window
                                                 [79.0]             [88.0]              
  7.0                          Event E3 and E4 leave the time window
                                                 [54.0]             [79.0]              
  7.2                         			</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-rowforall-default"/>A.3.2.Â Output Rate Limiting - Default</h3></div></div></div><p>
				Output occurs when the output condition is reached after each 1-second time interval. For each event arriving, the new aggregation value is output as part of the insert stream. As part of the remove stream, the prior aggregation value is output. This is useful for getting a delta-change for each event or group. If there is a <code class="literal">having</code> clause, the filter expression applies to each row.
			</p><p>
				Here also the default (no keyword) and the <code class="literal">ALL</code> keyword result in the same output.
			</p><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream sum(price) from MarketData#time(5.5 sec)
output every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [25.0]             [null]              
                                                 [34.0]             [25.0]              
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [58.0]             [34.0]              
                                                 [59.0]             [58.0]              
                                                 [85.0]             [59.0]              
  2.5                          
  3.0                          
  3.2                          
                                                 [85.0]             [85.0]              
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [87.0]             [85.0]              
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [109.0]            [87.0]              
                                                 [112.0]            [109.0]             
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [87.0]             [112.0]             
                                                 [88.0]             [87.0]              
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                 [79.0]             [88.0]              
                                                 [54.0]             [79.0] 			</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-rowforall-last"/>A.3.3.Â Output Rate Limiting - Last</h3></div></div></div><p>
				With the <code class="literal">LAST</code> keyword, the insert stream carries one event that holds the last aggregation value, and the remove stream carries the prior aggregation value.
			</p><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream sum(price) from MarketData#time(5.5 sec) 
output last every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [34.0]             [null]              
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [85.0]             [34.0]              
  2.5                          
  3.0                          
  3.2                          
                                                 [85.0]             [85.0]              
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [87.0]             [85.0]              
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [112.0]            [87.0]              
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [88.0]             [112.0]             
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                 [54.0]             [88.0]  			 </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-rowforall-first"/>A.3.4.Â Output Rate Limiting - First</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream sum(price) from MarketData#time(5.5 sec)
output first every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
                                                 [25.0]             [null]              
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
  1.5                          
         IBM     150    24.0   Event E3 arrives
                                                 [58.0]             [34.0]              
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
  2.5                          
  3.0                          
  3.2                          
  3.5                          
         YAH   11000     2.0   Event E6 arrives
                                                 [87.0]             [85.0]              
  4.0                          
  4.2                          
  4.3                          
         IBM     150    22.0   Event E7 arrives
                                                 [109.0]            [87.0]              
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
  5.7                          Event E1 leaves the time window
                                                 [87.0]             [112.0]             
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
  6.3                          Event E2 leaves the time window
                                                 [79.0]             [88.0]              
  7.0                          Event E3 and E4 leave the time window
  7.2    </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-rowforall-snapshot"/>A.3.5.Â Output Rate Limiting - Snapshot</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream sum(price) from MarketData#time(5.5 sec)
output snapshot every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [34.0]                                 
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [85.0]                                 
  2.5                          
  3.0                          
  3.2                          
                                                 [85.0]                                 
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [87.0]                                 
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [112.0]                                
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [88.0]                                 
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                 [54.0]                			</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="outputspec-aggregateall"/>A.4.Â Output for Aggregated and Un-Grouped Queries</h2></div></div></div><p>
			This chapter provides sample output for queries that have aggregation functions, and that do not have a <code class="literal">group by</code> clause, and in which there are event properties that are not under aggregation.
        </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-aggregateall-none"/>A.4.1.Â No Output Rate Limiting</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, sum(price) from MarketData#time(5.5 sec)</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
                                                 [IBM, 25.0]                            
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
                                                 [MSFT, 34.0]                           
  1.0                          
  1.2                          
  1.5                          
         IBM     150    24.0   Event E3 arrives
                                                 [IBM, 58.0]                            
         YAH   10000     1.0   Event E4 arrives
                                                 [YAH, 59.0]                            
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
                                                 [IBM, 85.0]                            
  2.2                          
  2.5                          
  3.0                          
  3.2                          
  3.5                          
         YAH   11000     2.0   Event E6 arrives
                                                 [YAH, 87.0]                            
  4.0                          
  4.2                          
  4.3                          
         IBM     150    22.0   Event E7 arrives
                                                 [IBM, 109.0]                           
  4.9                          
         YAH   11500     3.0   Event E8 arrives
                                                 [YAH, 112.0]                           
  5.0                          
  5.2                          
  5.7                          Event E1 leaves the time window
                                                                    [IBM, 87.0]         
  5.9                          
         YAH   10500     1.0   Event E9 arrives
                                                 [YAH, 88.0]                            
  6.0                          
  6.2                          
  6.3                          Event E2 leaves the time window
                                                                    [MSFT, 79.0]        
  7.0                          Event E3 and E4 leave the time window
                                                                    [IBM, 54.0]         
                                                                    [YAH, 54.0]         
  7.2                          			</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-aggregateall-default"/>A.4.2.Â Output Rate Limiting - Default</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, sum(price) from MarketData#time(5.5 sec)
output every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [IBM, 25.0]                            
                                                 [MSFT, 34.0]                           
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [IBM, 58.0]                            
                                                 [YAH, 59.0]                            
                                                 [IBM, 85.0]                            
  2.5                          
  3.0                          
  3.2                          
                                                 (empty result)     (empty result)      
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [YAH, 87.0]                            
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [IBM, 109.0]                           
                                                 [YAH, 112.0]                           
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [YAH, 88.0]        [IBM, 87.0]         
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                                    [MSFT, 79.0]        
                                                                    [IBM, 54.0]         
                                                                    [YAH, 54.0] 			</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-aggregateall-last"/>A.4.3.Â Output Rate Limiting - Last</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, sum(price) from MarketData#time(5.5 sec) 
output last every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [MSFT, 34.0]                           
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [IBM, 85.0]                            
  2.5                          
  3.0                          
  3.2                          
                                                 (empty result)     (empty result)      
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [YAH, 87.0]                            
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [YAH, 112.0]                           
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [YAH, 88.0]        [IBM, 87.0]         
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                                    [YAH, 54.0] 			 </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-aggregateall-first"/>A.4.4.Â Output Rate Limiting - First</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, sum(price) from MarketData#time(5.5 sec)
output first every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
                                                 [IBM, 25.0]                            
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
  1.5                          
         IBM     150    24.0   Event E3 arrives
                                                 [IBM, 58.0]                            
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
  2.5                          
  3.0                          
  3.2                          
  3.5                          
         YAH   11000     2.0   Event E6 arrives
                                                 [YAH, 87.0]                            
  4.0                          
  4.2                          
  4.3                          
         IBM     150    22.0   Event E7 arrives
                                                 [IBM, 109.0]                           
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
  5.7                          Event E1 leaves the time window
                                                                    [IBM, 87.0]         
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
  6.3                          Event E2 leaves the time window
                                                                    [MSFT, 79.0]        
  7.0                          Event E3 and E4 leave the time window
  7.2                          </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-aggregateall-snapshot"/>A.4.5.Â Output Rate Limiting - Snapshot</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, sum(price) from MarketData#time(5.5 sec)
output snapshot every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [IBM, 34.0]                            
                                                 [MSFT, 34.0]                           
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [IBM, 85.0]                            
                                                 [MSFT, 85.0]                           
                                                 [IBM, 85.0]                            
                                                 [YAH, 85.0]                            
                                                 [IBM, 85.0]                            
  2.5                          
  3.0                          
  3.2                          
                                                 [IBM, 85.0]                            
                                                 [MSFT, 85.0]                           
                                                 [IBM, 85.0]                            
                                                 [YAH, 85.0]                            
                                                 [IBM, 85.0]                            
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [IBM, 87.0]                            
                                                 [MSFT, 87.0]                           
                                                 [IBM, 87.0]                            
                                                 [YAH, 87.0]                            
                                                 [IBM, 87.0]                            
                                                 [YAH, 87.0]                            
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [IBM, 112.0]                           
                                                 [MSFT, 112.0]                          
                                                 [IBM, 112.0]                           
                                                 [YAH, 112.0]                           
                                                 [IBM, 112.0]                           
                                                 [YAH, 112.0]                           
                                                 [IBM, 112.0]                           
                                                 [YAH, 112.0]                           
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [MSFT, 88.0]                           
                                                 [IBM, 88.0]                            
                                                 [YAH, 88.0]                            
                                                 [IBM, 88.0]                            
                                                 [YAH, 88.0]                            
                                                 [IBM, 88.0]                            
                                                 [YAH, 88.0]                            
                                                 [YAH, 88.0]                            
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                 [IBM, 54.0]                            
                                                 [YAH, 54.0]                            
                                                 [IBM, 54.0]                            
                                                 [YAH, 54.0]                            
                                                 [YAH, 54.0]           			</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="outputspec-groupedrowpergroup"/>A.5.Â Output for Fully-Aggregated and Grouped Queries</h2></div></div></div><p>
			This chapter provides sample output for queries that have aggregation functions, and that have a <code class="literal">group by</code> clause, and in which all event properties are under aggregation or appear in the <code class="literal">group by</code> clause.
        </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-groupedrowpergroup-none"/>A.5.1.Â No Output Rate Limiting</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, sum(price) from MarketData#time(5.5 sec) 
group by symbol
order by symbol</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
                                                 [IBM, 25.0]        [IBM, null]         
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
                                                 [MSFT, 9.0]        [MSFT, null]        
  1.0                          
  1.2                          
  1.5                          
         IBM     150    24.0   Event E3 arrives
                                                 [IBM, 49.0]        [IBM, 25.0]         
         YAH   10000     1.0   Event E4 arrives
                                                 [YAH, 1.0]         [YAH, null]         
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
                                                 [IBM, 75.0]        [IBM, 49.0]         
  2.2                          
  2.5                          
  3.0                          
  3.2                          
  3.5                          
         YAH   11000     2.0   Event E6 arrives
                                                 [YAH, 3.0]         [YAH, 1.0]          
  4.0                          
  4.2                          
  4.3                          
         IBM     150    22.0   Event E7 arrives
                                                 [IBM, 97.0]        [IBM, 75.0]         
  4.9                          
         YAH   11500     3.0   Event E8 arrives
                                                 [YAH, 6.0]         [YAH, 3.0]          
  5.0                          
  5.2                          
  5.7                          Event E1 leaves the time window
                                                 [IBM, 72.0]        [IBM, 97.0]         
  5.9                          
         YAH   10500     1.0   Event E9 arrives
                                                 [YAH, 7.0]         [YAH, 6.0]          
  6.0                          
  6.2                          
  6.3                          Event E2 leaves the time window
                                                 [MSFT, null]       [MSFT, 9.0]         
  7.0                          Event E3 and E4 leave the time window
                                                 [IBM, 48.0]        [IBM, 72.0]         
                                                 [YAH, 6.0]         [YAH, 7.0]          
  7.2                          		</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-groupedrowpergroup-default"/>A.5.2.Â Output Rate Limiting - Default</h3></div></div></div><p>
				The default (no keyword) and the <code class="literal">ALL</code> keyword do not result in the same output. The default generates an output row per input event, while the <code class="literal">ALL</code> keyword
				generates a row for all groups.
			</p><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, sum(price) from MarketData#time(5.5 sec) 
group by symbol 
output every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">			                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [IBM, 25.0]        [IBM, null]         
                                                 [MSFT, 9.0]        [MSFT, null]        
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [IBM, 49.0]        [IBM, 25.0]         
                                                 [YAH, 1.0]         [YAH, null]         
                                                 [IBM, 75.0]        [IBM, 49.0]         
  2.5                          
  3.0                          
  3.2                          
                                                 (empty result)     (empty result)      
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [YAH, 3.0]         [YAH, 1.0]          
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [IBM, 97.0]        [IBM, 75.0]         
                                                 [YAH, 6.0]         [YAH, 3.0]          
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [IBM, 72.0]        [IBM, 97.0]         
                                                 [YAH, 7.0]         [YAH, 6.0]          
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                 [MSFT, null]       [MSFT, 9.0]         
                                                 [YAH, 6.0]         [YAH, 7.0]          
                                                 [IBM, 48.0]        [IBM, 72.0]  </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-groupedrowpergroup-all"/>A.5.3.Â Output Rate Limiting - All</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, sum(price) from MarketData#time(5.5 sec) 
group by symbol 
output all every 1 seconds 
order by symbol</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [IBM, 25.0]        [IBM, null]         
                                                 [MSFT, 9.0]        [MSFT, null]        
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [IBM, 75.0]        [IBM, 25.0]         
                                                 [MSFT, 9.0]        [MSFT, 9.0]         
                                                 [YAH, 1.0]         [YAH, null]         
  2.5                          
  3.0                          
  3.2                          
                                                 [IBM, 75.0]        [IBM, 75.0]         
                                                 [MSFT, 9.0]        [MSFT, 9.0]         
                                                 [YAH, 1.0]         [YAH, 1.0]          
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [IBM, 75.0]        [IBM, 75.0]         
                                                 [MSFT, 9.0]        [MSFT, 9.0]         
                                                 [YAH, 3.0]         [YAH, 1.0]          
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [IBM, 97.0]        [IBM, 75.0]         
                                                 [MSFT, 9.0]        [MSFT, 9.0]         
                                                 [YAH, 6.0]         [YAH, 3.0]          
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [IBM, 72.0]        [IBM, 97.0]         
                                                 [MSFT, 9.0]        [MSFT, 9.0]         
                                                 [YAH, 7.0]         [YAH, 6.0]          
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                 [IBM, 48.0]        [IBM, 72.0]         
                                                 [MSFT, null]       [MSFT, 9.0]         
                                                 [YAH, 6.0]         [YAH, 7.0]  			 </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-groupedrowpergroup-last"/>A.5.4.Â Output Rate Limiting - Last</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, sum(price) from MarketData#time(5.5 sec)
group by symbol 
output last every 1 seconds 
order by symbol</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [IBM, 25.0]        [IBM, null]         
                                                 [MSFT, 9.0]        [MSFT, null]        
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [IBM, 75.0]        [IBM, 25.0]         
                                                 [YAH, 1.0]         [YAH, null]         
  2.5                          
  3.0                          
  3.2                          
                                                 (empty result)     (empty result)      
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [YAH, 3.0]         [YAH, 1.0]          
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [IBM, 97.0]        [IBM, 75.0]         
                                                 [YAH, 6.0]         [YAH, 3.0]          
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [IBM, 72.0]        [IBM, 97.0]         
                                                 [YAH, 7.0]         [YAH, 6.0]          
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                 [IBM, 48.0]        [IBM, 72.0]         
                                                 [MSFT, null]       [MSFT, 9.0]         
                                                 [YAH, 6.0]         [YAH, 7.0]     			 </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-groupedrowpergroup-first"/>A.5.5.Â Output Rate Limiting - First</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, sum(price) from MarketData#time(5.5 sec)
group by symbol
output first every 1 seconds
			</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
                                                 [IBM, 25.0]        [IBM, null]         
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
                                                 [MSFT, 9.0]        [MSFT, null]        
  1.0                          
  1.2                          
  1.5                          
         IBM     150    24.0   Event E3 arrives
                                                 [IBM, 49.0]        [IBM, 25.0]         
         YAH   10000     1.0   Event E4 arrives
                                                 [YAH, 1.0]         [YAH, null]         
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
  2.5                          
  3.0                          
  3.2                          
  3.5                          
         YAH   11000     2.0   Event E6 arrives
                                                 [YAH, 3.0]         [YAH, 1.0]          
  4.0                          
  4.2                          
  4.3                          
         IBM     150    22.0   Event E7 arrives
                                                 [IBM, 97.0]        [IBM, 75.0]         
  4.9                          
         YAH   11500     3.0   Event E8 arrives
                                                 [YAH, 6.0]         [YAH, 3.0]          
  5.0                          
  5.2                          
  5.7                          Event E1 leaves the time window
                                                 [IBM, 72.0]        [IBM, 97.0]         
  5.9                          
         YAH   10500     1.0   Event E9 arrives
                                                 [YAH, 7.0]         [YAH, 6.0]          
  6.0                          
  6.2                          
  6.3                          Event E2 leaves the time window
                                                 [MSFT, null]       [MSFT, 9.0]         
  7.0                          Event E3 and E4 leave the time window
                                                 [IBM, 48.0]        [IBM, 72.0]         
                                                 [YAH, 6.0]         [YAH, 7.0]          
  7.2                          </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-groupedrowpergroup-snapshot"/>A.5.6.Â Output Rate Limiting - Snapshot</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, sum(price) from MarketData#time(5.5 sec) 
group by symbol 
output snapshot every 1 seconds 
order by symbol</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [IBM, 25.0]                            
                                                 [MSFT, 9.0]                            
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [IBM, 75.0]                            
                                                 [MSFT, 9.0]                            
                                                 [YAH, 1.0]                             
  2.5                          
  3.0                          
  3.2                          
                                                 [IBM, 75.0]                            
                                                 [MSFT, 9.0]                            
                                                 [YAH, 1.0]                             
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [IBM, 75.0]                            
                                                 [MSFT, 9.0]                            
                                                 [YAH, 3.0]                             
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [IBM, 97.0]                            
                                                 [MSFT, 9.0]                            
                                                 [YAH, 6.0]                             
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [IBM, 72.0]                            
                                                 [MSFT, 9.0]                            
                                                 [YAH, 7.0]                             
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                 [IBM, 48.0]                            
                                                 [YAH, 6.0]    			</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="outputspec-aggregategrouped"/>A.6.Â Output for Aggregated and Grouped Queries</h2></div></div></div><p>
			This chapter provides sample output for queries that have aggregation functions, and that have a <code class="literal">group by</code> clause, and in which some event properties are not under aggregation.
        </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-aggregategrouped-none"/>A.6.1.Â No Output Rate Limiting</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, volume, sum(price) from MarketData#time(5.5 sec) group by symbol</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
                                                 [IBM, 100, 25.0]                       
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
                                                 [MSFT, 5000, 9.0]                      
  1.0                          
  1.2                          
  1.5                          
         IBM     150    24.0   Event E3 arrives
                                                 [IBM, 150, 49.0]                       
         YAH   10000     1.0   Event E4 arrives
                                                 [YAH, 10000, 1.0]                      
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
                                                 [IBM, 155, 75.0]                       
  2.2                          
  2.5                          
  3.0                          
  3.2                          
  3.5                          
         YAH   11000     2.0   Event E6 arrives
                                                 [YAH, 11000, 3.0]                      
  4.0                          
  4.2                          
  4.3                          
         IBM     150    22.0   Event E7 arrives
                                                 [IBM, 150, 97.0]                       
  4.9                          
         YAH   11500     3.0   Event E8 arrives
                                                 [YAH, 11500, 6.0]                      
  5.0                          
  5.2                          
  5.7                          Event E1 leaves the time window
                                                                    [IBM, 100, 72.0]    
  5.9                          
         YAH   10500     1.0   Event E9 arrives
                                                 [YAH, 10500, 7.0]                      
  6.0                          
  6.2                          
  6.3                          Event E2 leaves the time window
                                                                    [MSFT, 5000, null]  
  7.0                          Event E3 and E4 leave the time window
                                                                    [IBM, 150, 48.0]    
                                                                    [YAH, 10000, 6.0]   
  7.2                          			</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-aggregategrouped-default"/>A.6.2.Â Output Rate Limiting - Default</h3></div></div></div><p>
				The default (no keyword) and the <code class="literal">ALL</code> keyword do not result in the same output. The default generates an output row per input event, while the <code class="literal">ALL</code> keyword
				generates a row for all groups based on the last new event for each group.
			</p><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, volume, sum(price) from MarketData#time(5.5 sec) 
group by symbol 
output every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [IBM, 100, 25.0]                       
                                                 [MSFT, 5000, 9.0]                      
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [IBM, 150, 49.0]                       
                                                 [YAH, 10000, 1.0]                      
                                                 [IBM, 155, 75.0]                       
  2.5                          
  3.0                          
  3.2                          
                                                 (empty result)     (empty result)      
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [YAH, 11000, 3.0]                      
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [IBM, 150, 97.0]                       
                                                 [YAH, 11500, 6.0]                      
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [YAH, 10500, 7.0]  [IBM, 100, 72.0]    
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                                    [MSFT, 5000, null]  
                                                                    [IBM, 150, 48.0]    
                                                                    [YAH, 10000, 6.0]   			</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-aggregategrouped-all"/>A.6.3.Â Output Rate Limiting - All</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, volume, sum(price) from MarketData#time(5.5 sec) 
group by symbol 
output all every 1 seconds 
order by symbol</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [IBM, 100, 25.0]                       
                                                 [MSFT, 5000, 9.0]                      
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [IBM, 150, 49.0]                       
                                                 [IBM, 155, 75.0]                       
                                                 [MSFT, 5000, 9.0]                      
                                                 [YAH, 10000, 1.0]                      
  2.5                          
  3.0                          
  3.2                          
                                                 [IBM, 155, 75.0]                       
                                                 [MSFT, 5000, 9.0]                      
                                                 [YAH, 10000, 1.0]                      
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [IBM, 155, 75.0]                       
                                                 [MSFT, 5000, 9.0]                      
                                                 [YAH, 11000, 3.0]                      
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [IBM, 150, 97.0]                       
                                                 [MSFT, 5000, 9.0]                      
                                                 [YAH, 11500, 6.0]                      
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [IBM, 150, 72.0]   [IBM, 100, 72.0]    
                                                 [MSFT, 5000, 9.0]                      
                                                 [YAH, 10500, 7.0]                      
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                 [IBM, 150, 48.0]   [IBM, 150, 48.0]    
                                                 [MSFT, 5000, null] [MSFT, 5000, null]  
                                                 [YAH, 10500, 6.0]  [YAH, 10000, 6.0]   </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-aggregategrouped-last"/>A.6.4.Â Output Rate Limiting - Last</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, volume, sum(price) from MarketData#time(5.5 sec)
group by symbol 
output last every 1 seconds 
order by symbol</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [IBM, 100, 25.0]                       
                                                 [MSFT, 5000, 9.0]                      
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [IBM, 155, 75.0]                       
                                                 [YAH, 10000, 1.0]                      
  2.5                          
  3.0                          
  3.2                          
                                                 (empty result)     (empty result)      
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [YAH, 11000, 3.0]                      
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [IBM, 150, 97.0]                       
                                                 [YAH, 11500, 6.0]                      
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [YAH, 10500, 7.0]  [IBM, 100, 72.0]    
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                                    [IBM, 150, 48.0]    
                                                                    [MSFT, 5000, null]  
                                                                    [YAH, 10000, 6.0] </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-aggregategrouped-first"/>A.6.5.Â Output Rate Limiting - First</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, volume, sum(price) from MarketData#time(5.5 sec) 
group by symbol 
output first every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
                                                 [IBM, 100, 25.0]                       
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
                                                 [MSFT, 5000, 9.0]                      
  1.0                          
  1.2                          
  1.5                          
         IBM     150    24.0   Event E3 arrives
                                                 [IBM, 150, 49.0]                       
         YAH   10000     1.0   Event E4 arrives
                                                 [YAH, 10000, 1.0]                      
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
  2.5                          
  3.0                          
  3.2                          
  3.5                          
         YAH   11000     2.0   Event E6 arrives
                                                 [YAH, 11000, 3.0]                      
  4.0                          
  4.2                          
  4.3                          
         IBM     150    22.0   Event E7 arrives
                                                 [IBM, 150, 97.0]                       
  4.9                          
         YAH   11500     3.0   Event E8 arrives
                                                 [YAH, 11500, 6.0]                      
  5.0                          
  5.2                          
  5.7                          Event E1 leaves the time window
                                                 [IBM, 100, 72.0]                       
  5.9                          
         YAH   10500     1.0   Event E9 arrives
                                                 [YAH, 10500, 7.0]                      
  6.0                          
  6.2                          
  6.3                          Event E2 leaves the time window
                                                 [MSFT, 5000, null]                     
  7.0                          Event E3 and E4 leave the time window
                                                 [IBM, 150, 48.0]                       
                                                 [YAH, 10000, 6.0]                      
  7.2                          </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-aggregategrouped-snapshot"/>A.6.6.Â Output Rate Limiting - Snapshot</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, volume, sum(price) from MarketData#time(5.5 sec) 
group by symbol 
output snapshot every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [IBM, 100, 25.0]                       
                                                 [MSFT, 5000, 9.0]                      
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [IBM, 100, 75.0]                       
                                                 [MSFT, 5000, 9.0]                      
                                                 [IBM, 150, 75.0]                       
                                                 [YAH, 10000, 1.0]                      
                                                 [IBM, 155, 75.0]                       
  2.5                          
  3.0                          
  3.2                          
                                                 [IBM, 100, 75.0]                       
                                                 [MSFT, 5000, 9.0]                      
                                                 [IBM, 150, 75.0]                       
                                                 [YAH, 10000, 1.0]                      
                                                 [IBM, 155, 75.0]                       
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [IBM, 100, 75.0]                       
                                                 [MSFT, 5000, 9.0]                      
                                                 [IBM, 150, 75.0]                       
                                                 [YAH, 10000, 3.0]                      
                                                 [IBM, 155, 75.0]                       
                                                 [YAH, 11000, 3.0]                      
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [IBM, 100, 97.0]                       
                                                 [MSFT, 5000, 9.0]                      
                                                 [IBM, 150, 97.0]                       
                                                 [YAH, 10000, 6.0]                      
                                                 [IBM, 155, 97.0]                       
                                                 [YAH, 11000, 6.0]                      
                                                 [IBM, 150, 97.0]                       
                                                 [YAH, 11500, 6.0]                      
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [MSFT, 5000, 9.0]                      
                                                 [IBM, 150, 72.0]                       
                                                 [YAH, 10000, 7.0]                      
                                                 [IBM, 155, 72.0]                       
                                                 [YAH, 11000, 7.0]                      
                                                 [IBM, 150, 72.0]                       
                                                 [YAH, 11500, 7.0]                      
                                                 [YAH, 10500, 7.0]                      
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                 [IBM, 155, 48.0]                       
                                                 [YAH, 11000, 6.0]                      
                                                 [IBM, 150, 48.0]                       
                                                 [YAH, 11500, 6.0]                      
                                                 [YAH, 10500, 6.0]  </pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="outputspec-groupedrowpergrouprollup"/>A.7.Â Output for Fully-Aggregated, Grouped Queries With Rollup</h2></div></div></div><p>
			This chapter provides sample output for queries that have aggregation functions, and that have a <code class="literal">group by</code> clause, and in which all event properties are under aggregation or appear in the group by clause, and the <code class="literal">group by</code> clause has a <code class="literal">rollup</code>, <code class="literal">cube</code> or <code class="literal">grouping sets</code> keyword(s) instructing the engine to perform multi-level aggregation.
        </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-groupedrowpergrouprollup-none"/>A.7.1.Â No Output Rate Limiting</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, volume, sum(price)
from MarketData#time(5.5 sec)
group by rollup(symbol)</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
                                                 [IBM, 25.0]        [IBM, null]         
                                                 [null, 25.0]       [null, null]        
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
                                                 [MSFT, 9.0]        [MSFT, null]        
                                                 [null, 34.0]       [null, 25.0]        
  1.0                          
  1.2                          
  1.5                          
         IBM     150    24.0   Event E3 arrives
                                                 [IBM, 49.0]        [IBM, 25.0]         
                                                 [null, 58.0]       [null, 34.0]        
         YAH   10000     1.0   Event E4 arrives
                                                 [YAH, 1.0]         [YAH, null]         
                                                 [null, 59.0]       [null, 58.0]        
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
                                                 [IBM, 75.0]        [IBM, 49.0]         
                                                 [null, 85.0]       [null, 59.0]        
  2.2                          
  2.5                          
  3.0                          
  3.2                          
  3.5                          
         YAH   11000     2.0   Event E6 arrives
                                                 [YAH, 3.0]         [YAH, 1.0]          
                                                 [null, 87.0]       [null, 85.0]        
  4.0                          
  4.2                          
  4.3                          
         IBM     150    22.0   Event E7 arrives
                                                 [IBM, 97.0]        [IBM, 75.0]         
                                                 [null, 109.0]      [null, 87.0]        
  4.9                          
         YAH   11500     3.0   Event E8 arrives
                                                 [YAH, 6.0]         [YAH, 3.0]          
                                                 [null, 112.0]      [null, 109.0]       
  5.0                          
  5.2                          
  5.7                          Event E1 leaves the time window
                                                 [IBM, 72.0]        [IBM, 97.0]         
                                                 [null, 87.0]       [null, 112.0]       
  5.9                          
         YAH   10500     1.0   Event E9 arrives
                                                 [YAH, 7.0]         [YAH, 6.0]          
                                                 [null, 88.0]       [null, 87.0]        
  6.0                          
  6.2                          
  6.3                          Event E2 leaves the time window
                                                 [MSFT, null]       [MSFT, 9.0]         
                                                 [null, 79.0]       [null, 88.0]        
  7.0                          Event E3 and E4 leave the time window
                                                 [IBM, 48.0]        [IBM, 72.0]         
                                                 [YAH, 6.0]         [YAH, 7.0]          
                                                 [null, 54.0]       [null, 79.0]        
  7.2</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-groupedrowpergrouprollup-default"/>A.7.2.Â Output Rate Limiting - Default</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, volume, sum(price)
from MarketData#time(5.5 sec) 
group by rollup(symbol)
output every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [IBM, 25.0]        [IBM, null]         
                                                 [null, 25.0]       [null, null]        
                                                 [MSFT, 9.0]        [MSFT, null]        
                                                 [null, 34.0]       [null, 25.0]        
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [IBM, 49.0]        [IBM, 25.0]         
                                                 [null, 58.0]       [null, 34.0]        
                                                 [YAH, 1.0]         [YAH, null]         
                                                 [null, 59.0]       [null, 58.0]        
                                                 [IBM, 75.0]        [IBM, 49.0]         
                                                 [null, 85.0]       [null, 59.0]        
  2.5                          
  3.0                          
  3.2                          
                                                 (empty result)     (empty result)      
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [YAH, 3.0]         [YAH, 1.0]          
                                                 [null, 87.0]       [null, 85.0]        
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [IBM, 97.0]        [IBM, 75.0]         
                                                 [null, 109.0]      [null, 87.0]        
                                                 [YAH, 6.0]         [YAH, 3.0]          
                                                 [null, 112.0]      [null, 109.0]       
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [IBM, 72.0]        [IBM, 97.0]         
                                                 [null, 87.0]       [null, 112.0]       
                                                 [YAH, 7.0]         [YAH, 6.0]          
                                                 [null, 88.0]       [null, 87.0]        
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                 [MSFT, null]       [MSFT, 9.0]         
                                                 [null, 79.0]       [null, 88.0]        
                                                 [IBM, 48.0]        [IBM, 72.0]         
                                                 [YAH, 6.0]         [YAH, 7.0]          
                                                 [null, 54.0]       [null, 79.0]</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-groupedrowpergrouprollup-all"/>A.7.3.Â Output Rate Limiting - All</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, volume, sum(price)
from MarketData#time(5.5 sec) 
group by rollup(symbol)
output all every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [IBM, 25.0]        [IBM, null]         
                                                 [MSFT, 9.0]        [MSFT, null]        
                                                 [null, 34.0]       [null, null]        
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [IBM, 75.0]        [IBM, 25.0]         
                                                 [MSFT, 9.0]        [MSFT, 9.0]         
                                                 [YAH, 1.0]         [YAH, null]         
                                                 [null, 85.0]       [null, 34.0]        
  2.5                          
  3.0                          
  3.2                          
                                                 [IBM, 75.0]        [IBM, 75.0]         
                                                 [MSFT, 9.0]        [MSFT, 9.0]         
                                                 [YAH, 1.0]         [YAH, 1.0]          
                                                 [null, 85.0]       [null, 85.0]        
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [IBM, 75.0]        [IBM, 75.0]         
                                                 [MSFT, 9.0]        [MSFT, 9.0]         
                                                 [YAH, 3.0]         [YAH, 1.0]          
                                                 [null, 87.0]       [null, 85.0]        
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [IBM, 97.0]        [IBM, 75.0]         
                                                 [MSFT, 9.0]        [MSFT, 9.0]         
                                                 [YAH, 6.0]         [YAH, 3.0]          
                                                 [null, 112.0]      [null, 87.0]        
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [IBM, 72.0]        [IBM, 97.0]         
                                                 [MSFT, 9.0]        [MSFT, 9.0]         
                                                 [YAH, 7.0]         [YAH, 6.0]          
                                                 [null, 88.0]       [null, 112.0]       
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                 [IBM, 48.0]        [IBM, 72.0]         
                                                 [MSFT, null]       [MSFT, 9.0]         
                                                 [YAH, 6.0]         [YAH, 7.0]          
                                                 [null, 54.0]       [null, 88.0]</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-groupedrowpergrouprollup-last"/>A.7.4.Â Output Rate Limiting - Last</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, volume, sum(price)
from MarketData#time(5.5 sec)
group by rollup(symbol)
output last every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [IBM, 25.0]        [IBM, null]         
                                                 [MSFT, 9.0]        [MSFT, null]        
                                                 [null, 34.0]       [null, null]        
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [IBM, 75.0]        [IBM, 25.0]         
                                                 [YAH, 1.0]         [YAH, null]         
                                                 [null, 85.0]       [null, 34.0]        
  2.5                          
  3.0                          
  3.2                          
                                                 (empty result)     (empty result)      
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [YAH, 3.0]         [YAH, 1.0]          
                                                 [null, 87.0]       [null, 85.0]        
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [IBM, 97.0]        [IBM, 75.0]         
                                                 [YAH, 6.0]         [YAH, 3.0]          
                                                 [null, 112.0]      [null, 87.0]        
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [IBM, 72.0]        [IBM, 97.0]         
                                                 [YAH, 7.0]         [YAH, 6.0]          
                                                 [null, 88.0]       [null, 112.0]       
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                 [MSFT, null]       [MSFT, 9.0]         
                                                 [IBM, 48.0]        [IBM, 72.0]         
                                                 [YAH, 6.0]         [YAH, 7.0]          
                                                 [null, 54.0]       [null, 88.0]   </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-groupedrowpergrouprollup-first"/>A.7.5.Â Output Rate Limiting - First</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, volume, sum(price)
from MarketData#time(5.5 sec) 
group by rollup(symbol) 
output first every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
                                                 [IBM, 25.0]        [IBM, null]         
                                                 [null, 25.0]       [null, null]        
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
                                                 [MSFT, 9.0]        [MSFT, null]        
  1.0                          
  1.2                          
  1.5                          
         IBM     150    24.0   Event E3 arrives
                                                 [IBM, 49.0]        [IBM, 25.0]         
                                                 [null, 58.0]       [null, 34.0]        
         YAH   10000     1.0   Event E4 arrives
                                                 [YAH, 1.0]         [YAH, null]         
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
  2.5                          
  3.0                          
  3.2                          
  3.5                          
         YAH   11000     2.0   Event E6 arrives
                                                 [YAH, 3.0]         [YAH, 1.0]          
                                                 [null, 87.0]       [null, 85.0]        
  4.0                          
  4.2                          
  4.3                          
         IBM     150    22.0   Event E7 arrives
                                                 [IBM, 97.0]        [IBM, 75.0]         
  4.9                          
         YAH   11500     3.0   Event E8 arrives
                                                 [YAH, 6.0]         [YAH, 3.0]          
                                                 [null, 112.0]      [null, 109.0]       
  5.0                          
  5.2                          
  5.7                          Event E1 leaves the time window
                                                 [IBM, 72.0]        [IBM, 97.0]         
  5.9                          
         YAH   10500     1.0   Event E9 arrives
                                                 [YAH, 7.0]         [YAH, 6.0]          
                                                 [null, 88.0]       [null, 87.0]        
  6.0                          
  6.2                          
  6.3                          Event E2 leaves the time window
                                                 [MSFT, null]       [MSFT, 9.0]         
  7.0                          Event E3 and E4 leave the time window
                                                 [IBM, 48.0]        [IBM, 72.0]         
                                                 [YAH, 6.0]         [YAH, 7.0]          
                                                 [null, 54.0]       [null, 79.0]</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="outputspec-groupedrowpergrouprollup-snapshot"/>A.7.6.Â Output Rate Limiting - Snapshot</h3></div></div></div><p>
				The statement for this sample reads:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select irstream symbol, volume, sum(price)
from MarketData#time(5.5 sec) 
group by rollup(symbol)
output snapshot every 1 seconds</pre><p>
				The output is as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">                       Input                                  Output
                                                 Insert Stream    Remove Stream
-----------------------------------------------  ----------------------------------
 Time Symbol  Volume   Price
  0.2                          
         IBM     100    25.0   Event E1 arrives
  0.8                          
        MSFT    5000     9.0   Event E2 arrives
  1.0                          
  1.2                          
                                                 [IBM, 25.0]                            
                                                 [MSFT, 9.0]                            
                                                 [null, 34.0]                           
  1.5                          
         IBM     150    24.0   Event E3 arrives
         YAH   10000     1.0   Event E4 arrives
  2.0                          
  2.1                          
         IBM     155    26.0   Event E5 arrives
  2.2                          
                                                 [IBM, 75.0]                            
                                                 [MSFT, 9.0]                            
                                                 [YAH, 1.0]                             
                                                 [null, 85.0]                           
  2.5                          
  3.0                          
  3.2                          
                                                 [IBM, 75.0]                            
                                                 [MSFT, 9.0]                            
                                                 [YAH, 1.0]                             
                                                 [null, 85.0]                           
  3.5                          
         YAH   11000     2.0   Event E6 arrives
  4.0                          
  4.2                          
                                                 [IBM, 75.0]                            
                                                 [MSFT, 9.0]                            
                                                 [YAH, 3.0]                             
                                                 [null, 87.0]                           
  4.3                          
         IBM     150    22.0   Event E7 arrives
  4.9                          
         YAH   11500     3.0   Event E8 arrives
  5.0                          
  5.2                          
                                                 [IBM, 97.0]                            
                                                 [MSFT, 9.0]                            
                                                 [YAH, 6.0]                             
                                                 [null, 112.0]                          
  5.7                          Event E1 leaves the time window
  5.9                          
         YAH   10500     1.0   Event E9 arrives
  6.0                          
  6.2                          
                                                 [MSFT, 9.0]                            
                                                 [IBM, 72.0]                            
                                                 [YAH, 7.0]                             
                                                 [null, 88.0]                           
  6.3                          Event E2 leaves the time window
  7.0                          Event E3 and E4 leave the time window
  7.2                          
                                                 [IBM, 48.0]                            
                                                 [YAH, 6.0]                             
                                                 [null, 54.0]  </pre></div></div></div><div class="appendix" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_outputlimit"/>AppendixÂ B.Â Runtime Considerations for Output Rate Limiting</h2></div></div></div><p>
			Output rate limiting provides output events to your application in regular intervals. Between intervals, the engine may use a buffer to hold data until the output condition is reached, as described below. 
			If your application has high-volume streams, you may need to be mindful of the memory needs for buffers especially if the output condition triggers infrequently.
		</p><p>
			The <code class="literal">output</code> clause with the <code class="literal">snapshot</code> keyword does not require a buffer for any type of query.
		</p><p>
			The <code class="literal">output</code> clause with the <code class="literal">first</code> keyword does not require a buffer for any type of query.
		</p><p>
			We use the term <span class="emphasis"><em>change set</em></span> to describe all insert and remove stream events that occur since the last triggering of the output condition. 
		</p><p>
			You can override the default behavior for some types of queries by specifying a hint.
		</p><p>
			Please see <a class="xref" href="#">???</a> for information on the types of queries discussed below.
		</p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-output-unaggandungrouped"/>B.1.Â For Un-Aggregated and Un-Grouped Queries</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-output-unaggandungrouped-last"/>B.1.1.Â <code class="literal">Output Last</code></h3></div></div></div><p>
					For queries that define <code class="literal">output last</code> the engine retains only the first remove stream event and the last insert stream event, both matching the <code class="literal">having</code>-clause, if present, 
					to compute insert and remove stream output when the output condition triggers.
				</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-output-unaggandungrouped-all"/>B.1.2.Â <code class="literal">Output All</code></h3></div></div></div><p>
					Without an order-by clause:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							Upon arrival of any row the engine applies the <code class="literal">having</code>-clause and retains only matching events, or retains all events if there is no <code class="literal">having</code>-clause.
						</p></li><li><p>
							Upon triggering of the output condition the engine computes the insert and remove stream output events according to the <code class="literal">select</code>-clause for output.
						</p></li></ul></div><p>
					With an order-by clause or when your EPL specifies the <code class="literal">@Hint('disable_outputlimit_opt')</code> hint:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
								The engine retains the change set and computes output from the change set at the time the output condition triggers, after which it discards the change set.
						</p></li></ul></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-output-fullyaggandungrouped"/>B.2.Â For Fully Aggregated and Un-Grouped Queries</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-output-fullyaggandungrouped-last"/>B.2.1.Â <code class="literal">Output Last</code></h3></div></div></div><p>
					Without an order-by clause:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							Upon arrival of the first row since the last triggering of the output condition the engine computes the remove stream output event according to the <code class="literal">select</code>-clause 
					for later output (when applicable).
						</p></li><li><p>
							Upon triggering of the output condition the engine computes the insert stream output event according to the <code class="literal">select</code>-clause for output.
						</p></li></ul></div><p>
					With an order-by clause or when your EPL specifies the <code class="literal">@Hint('disable_outputlimit_opt')</code> hint:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
						   The engine retains the change set and computes output from the change set at the time the output condition triggers, after which it discards the change set.
						</p></li></ul></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-output-fullyaggandungrouped-all"/>B.2.2.Â <code class="literal">Output All</code></h3></div></div></div><p>
					Without an order-by clause:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							Upon arrival of rows the engine applies the <code class="literal">having</code>-clause and computes the insert and remove stream output event according to the <code class="literal">select</code>-clause 
					for later output (when applicable).
						</p></li><li><p>
							Upon triggering of the output condition the engine outputs the insert and remove stream output events.
						</p></li></ul></div><p>
					With an order-by clause or when your EPL specifies the <code class="literal">@Hint('disable_outputlimit_opt')</code> hint:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
								The engine retains the change set and computes output from the change set at the time the output condition triggers, after which it discards the change set.
						</p></li></ul></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-output-aggandungrouped"/>B.3.Â For Aggregated and Un-Grouped Queries</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-output-aggandungrouped-last"/>B.3.1.Â <code class="literal">Output Last</code></h3></div></div></div><p>
					Without an order-by clause:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							Upon arrival of the first row since the last triggering of the output condition the engine computes the insert and remove stream output event according to the 
							<code class="literal">having</code>-clause (if present) and the <code class="literal">select</code>-clause 
							for later output (when applicable), retaining only the last computed insert and remove stream output event.
						</p></li><li><p>
							Upon triggering of the output condition the engine outputs the pre-computed last insert stream and remove stream output event.
						</p></li></ul></div><p>
					With an order-by clause or when your EPL specifies the <code class="literal">@Hint('disable_outputlimit_opt')</code> hint:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
						   The engine retains the change set and computes output from the change set at the time the output condition triggers, after which it discards the change set.
						</p></li></ul></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-output-aggandungrouped-all"/>B.3.2.Â <code class="literal">Output All</code></h3></div></div></div><p>
					Without an order-by clause:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							Upon arrival of rows the engine computes the insert and remove stream output events according to the <code class="literal">having</code>-clause (if present) and 
							the <code class="literal">select</code>-clause for later output, retaining only the computed insert and remove stream output events.
						</p></li><li><p>
							Upon triggering of the output condition the engine outputs the retained output events.
						</p></li></ul></div><p>
					With an order-by clause or when your EPL specifies the <code class="literal">@Hint('disable_outputlimit_opt')</code> hint:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
								The engine retains the change set and computes output from the change set at the time the output condition triggers, after which it discards the change set.
						</p></li></ul></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-output-fullyaggandgrouped"/>B.4.Â For Fully Aggregated and Grouped Queries (Includes Rollup)</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-output-fullyaggandgrouped-last"/>B.4.1.Â <code class="literal">Output Last</code></h3></div></div></div><p>
					Without an order-by clause:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							Upon arrival of the first row for a given group since the last triggering of the output condition the engine computes the remove stream output event for that group 
							according to the <code class="literal">select</code>-clause 
							for later output (when applicable), and also retains a single insert stream event per group. 
						</p></li><li><p>
							Upon triggering of the output condition the engine uses the retained insert stream events per group to compute output events according to the <code class="literal">select</code>-clause.
						</p></li></ul></div><p>
					With an order-by clause or when your EPL specifies the <code class="literal">@Hint('disable_outputlimit_opt')</code> hint:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
								The engine retains the change set and computes output from the change set at the time the output condition triggers, after which it discards the change set.
						</p></li></ul></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-output-fullyaggandgrouped-all"/>B.4.2.Â <code class="literal">Output All</code></h3></div></div></div><p>
					Without an order-by clause:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							The engine retains, for each group, a row to represent the group.
						</p></li><li><p>
							Upon arrival of rows the engine computes the remove stream output events according to the <code class="literal">having</code>-clause (if present) and 
							the <code class="literal">select</code>-clause for later output. 
						</p></li><li><p>
							Upon triggering of the output condition the engine computes the insert stream output events according to the <code class="literal">having</code>-clause (if present) and 
							the <code class="literal">select</code>-clause for output, for each group.
						</p></li></ul></div><p>
					With an order-by clause or when your EPL specifies the <code class="literal">@Hint('disable_outputlimit_opt')</code> hint:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
								The engine retains the change set and computes output from the change set at the time the output condition triggers, after which it discards the change set.
						</p></li></ul></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="epl-output-aggandgrouped"/>B.5.Â For Aggregated and Grouped Queries</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-output-aggandgrouped-last"/>B.5.1.Â <code class="literal">Output Last</code></h3></div></div></div><p>
					Without an order-by clause:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							Upon arrival of the first row for a given group since the last triggering of the output condition the engine computes the insert and remove stream output event for that group 
							according to the <code class="literal">select</code>-clause 
							for later output (when applicable), and retains a last insert and remove stream event per group. 
						</p></li><li><p>
							Upon triggering of the output condition the engine outputs the retained insert and remove stream output events per group.
						</p></li></ul></div><p>
					With an order-by clause or when your EPL specifies the <code class="literal">@Hint('disable_outputlimit_opt')</code> hint:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
								The engine retains the change set and computes output from the change set at the time the output condition triggers, after which it discards the change set.
						</p></li></ul></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="epl-output-aggandgrouped-all"/>B.5.2.Â <code class="literal">Output All</code></h3></div></div></div><p>
					Without an order-by clause:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
							The engine retains, for each group, a row to represent the group.
						</p></li><li><p>
							Upon arrival of rows the engine computes the insert and remove stream output events according to the <code class="literal">having</code>-clause (if present) and 
							the <code class="literal">select</code>-clause for later output. 
						</p></li><li><p>
							Upon triggering of the output condition the engine computes insert stream output events according to the <code class="literal">having</code>-clause (if present) and 
							the <code class="literal">select</code>-clause for output for each group that does not have output events yet, and outputs all events.
						</p></li></ul></div><p>
					With an order-by clause or when your EPL specifies the <code class="literal">@Hint('disable_outputlimit_opt')</code> hint:
				</p><div class="itemizedlist"><ul compact="compact"><li><p>
								The engine retains the change set and computes output from the change set at the time the output condition triggers, after which it discards the change set.
						</p></li></ul></div></div></div></div><div class="appendix" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_keywords"/>AppendixÂ C.Â Reserved Keywords</h2></div></div></div><p>
		The words in the following table are explicitly reserved in EPL, however certain keywords are allowed as event property names in expressions and as column names in the rename syntax of the <code class="literal">select</code> clause. 
	</p><p>
		Most of the words in the table are forbidden by standard SQL as well. A few are reserved because EPL needs them.
	</p><p>
		Names of built-in functions and certain auxiliary keywords are permitted as identifiers for use either as event property names in expressions and for the column rename syntax. The second column in the table below indicates which keywords are acceptable. For example, <code class="literal">count</code> is acceptable.
	</p><p>
		An example of permitted use is:
	</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select last, count(*) as count from MyEvent</pre><p>
		This example shows an incorrect use of a reserved keyword:
	</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// incorrect
select insert from MyEvent</pre><p>
		The table of explicitly reserved keywords and permitted keywords:
	</p><div class="table"><a id="d0e52634"/><p class="title"><b>TableÂ C.1.Â Reserved Keywords</b></p><div class="table-contents"><table summary="Reserved Keywords" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Keyword</th><th>Property Name and Rename Syntax</th></tr></thead><tbody><tr><td>after</td><td>-</td></tr><tr><td>all</td><td>-</td></tr><tr><td>and</td><td>-</td></tr><tr><td>as</td><td>-</td></tr><tr><td>at</td><td>yes</td></tr><tr><td>asc</td><td>-</td></tr><tr><td>avedev</td><td>yes</td></tr><tr><td>avg</td><td>yes</td></tr><tr><td>between</td><td>-</td></tr><tr><td>by</td><td>-</td></tr><tr><td>case</td><td>-</td></tr><tr><td>cast</td><td>yes</td></tr><tr><td>coalesce</td><td>yes</td></tr><tr><td>context</td><td>-</td></tr><tr><td>count</td><td>yes</td></tr><tr><td>create</td><td>-</td></tr><tr><td>current_timestamp</td><td>-</td></tr><tr><td>cube</td><td>-</td></tr><tr><td>dataflow</td><td>-</td></tr><tr><td>day</td><td>-</td></tr><tr><td>days</td><td>-</td></tr><tr><td>delete</td><td>-</td></tr><tr><td>define</td><td>yes</td></tr><tr><td>desc</td><td>-</td></tr><tr><td>distinct</td><td>-</td></tr><tr><td>else</td><td>-</td></tr><tr><td>end</td><td>-</td></tr><tr><td>escape</td><td>yes</td></tr><tr><td>events</td><td>yes</td></tr><tr><td>every</td><td>yes</td></tr><tr><td>exists</td><td>-</td></tr><tr><td>expression</td><td>-</td></tr><tr><td>false</td><td>yes</td></tr><tr><td>first</td><td>yes</td></tr><tr><td>for</td><td>yes</td></tr><tr><td>from</td><td>-</td></tr><tr><td>full</td><td>yes</td></tr><tr><td>group</td><td>-</td></tr><tr><td>grouping</td><td>-</td></tr><tr><td>grouping_id</td><td>-</td></tr><tr><td>having</td><td>-</td></tr><tr><td>hour</td><td>-</td></tr><tr><td>hours</td><td>-</td></tr><tr><td>in</td><td>-</td></tr><tr><td>initiated</td><td>-</td></tr><tr><td>inner</td><td>-</td></tr><tr><td>insert</td><td>-</td></tr><tr><td>instanceof</td><td>yes</td></tr><tr><td>into</td><td>-</td></tr><tr><td>irstream</td><td>-</td></tr><tr><td>is</td><td>-</td></tr><tr><td>istream</td><td>-</td></tr><tr><td>join</td><td>yes</td></tr><tr><td>last</td><td>yes</td></tr><tr><td>lastweekday</td><td>yes</td></tr><tr><td>left</td><td>yes</td></tr><tr><td>limit</td><td>-</td></tr><tr><td>like</td><td>-</td></tr><tr><td>max</td><td>yes</td></tr><tr><td>match_recognize</td><td>-</td></tr><tr><td>matched</td><td>-</td></tr><tr><td>matches</td><td>-</td></tr><tr><td>median</td><td>yes</td></tr><tr><td>measures</td><td>yes</td></tr><tr><td>merge</td><td>-</td></tr><tr><td>metadatasql</td><td>yes</td></tr><tr><td>min</td><td>yes</td></tr><tr><td>minute</td><td>yes</td></tr><tr><td>minutes</td><td>yes</td></tr><tr><td>microsecond</td><td>yes</td></tr><tr><td>microseconds</td><td>yes</td></tr><tr><td>millisecond</td><td>yes</td></tr><tr><td>milliseconds</td><td>yes</td></tr><tr><td>msec</td><td>yes</td></tr><tr><td>new</td><td>-</td></tr><tr><td>not</td><td>-</td></tr><tr><td>null</td><td>-</td></tr><tr><td>offset</td><td>-</td></tr><tr><td>on</td><td>-</td></tr><tr><td>or</td><td>-</td></tr><tr><td>order</td><td>-</td></tr><tr><td>outer</td><td>yes</td></tr><tr><td>output</td><td>-</td></tr><tr><td>partition</td><td>-</td></tr><tr><td>pattern</td><td>yes</td></tr><tr><td>prev</td><td>yes</td></tr><tr><td>prior</td><td>yes</td></tr><tr><td>regexp</td><td>-</td></tr><tr><td>retain-union</td><td>yes</td></tr><tr><td>retain-intersection</td><td>yes</td></tr><tr><td>right</td><td>yes</td></tr><tr><td>rollup</td><td>yes</td></tr><tr><td>rstream</td><td>-</td></tr><tr><td>sec</td><td>-</td></tr><tr><td>second</td><td>-</td></tr><tr><td>seconds</td><td>-</td></tr><tr><td>select</td><td>-</td></tr><tr><td>set</td><td>-</td></tr><tr><td>sets</td><td>-</td></tr><tr><td>some</td><td>-</td></tr><tr><td>snapshot</td><td>yes</td></tr><tr><td>sql</td><td>yes</td></tr><tr><td>start</td><td>-</td></tr><tr><td>stddev</td><td>yes</td></tr><tr><td>sum</td><td>yes</td></tr><tr><td>terminated</td><td>-</td></tr><tr><td>then</td><td>-</td></tr><tr><td>true</td><td>-</td></tr><tr><td>unidirectional</td><td>yes</td></tr><tr><td>until</td><td>yes</td></tr><tr><td>update</td><td>-</td></tr><tr><td>usec</td><td>yes</td></tr><tr><td>using</td><td>yes</td></tr><tr><td>variable</td><td>yes</td></tr><tr><td>values</td><td>yes</td></tr><tr><td>weekday</td><td>yes</td></tr><tr><td>when</td><td>-</td></tr><tr><td>where</td><td>-</td></tr><tr><td>while</td><td>-</td></tr><tr><td>window</td><td>yes</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="appendix" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepbean"/>AppendixÂ D.Â Event Representation: Plain-Old Java Object Events</h2></div></div></div><a id="d0e53250" class="indexterm"/><p>
		This section provides information for using Plain-Old or Bean Java Objects to represent events. 
    </p><p>
			For NEsper .NET also see <a class="xref" href="#appendix_dotnet_eventrep_javabean" title="I.7.Â .NET Object Events">SectionÂ I.7, â.NET Object Eventsâ</a>.
	</p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepbean_overview"/>D.1.Â Overview</h2></div></div></div><p>
			Plain-old Java object events are object instances that expose event properties through JavaBeans-style getter methods. Events classes or interfaces do not have to be fully compliant to the JavaBean specification; however for the Esper engine to obtain event properties, the required JavaBean getter methods must be present or an accessor-style and accessor-methods may be defined via configuration.
		</p><p>
			Esper supports JavaBeans-style event classes that extend a superclass or implement one or more interfaces. 
			Also, Esper event pattern and EPL statements can refer to Java interface classes and abstract classes. 
		</p><p>
			Classes that represent events should be made immutable. As events are recordings of a state change or action that occurred in the past, the relevant event properties should not be changeable. However this is not a hard requirement and the Esper engine accepts events that are mutable as well.
		</p><p>
			The <code class="literal">hashCode</code> and <code class="literal">equals</code> methods do not need to be implemented. The implementation of these methods by a Java event class does not affect the behavior of the engine in any way.
		</p><p>
			Please see <a class="xref" href="#configuration" title="ChapterÂ 15.Â Configuration">ChapterÂ 15, <i>Configuration</i></a> on options for naming event types represented by Java object event classes.
			Java classes that do not follow JavaBean conventions, such as legacy Java classes that expose public fields, or methods not following naming conventions, require additional configuration. Via configuration it is also possible to control case sensitivity in property name resolution. The relevant section in the chapter on configuration is <a class="xref" href="#config-java-legacy" title="15.4.1.3.Â Non-JavaBean and Legacy Java Event Classes">SectionÂ 15.4.1.3, âNon-JavaBean and Legacy Java Event Classesâ</a>.
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
				  Event classes must have <code class="literal">public</code> visibility.
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepbean_properties"/>D.2.Â Java Object Event Properties</h2></div></div></div><p>
			As outlined earlier, the different property types are supported by the standard JavaBeans specification, and some of which are uniquely supported by Esper:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					<span class="emphasis"><em>Simple</em></span> properties have a single value that may be retrieved. The underlying property type might be a Java language primitive (such as int, a simple object (such as a java.lang.String), or a more complex object whose class is defined either by the Java language, by the application, or by a class library included with the application.
				</p></li><li><p>
					<span class="emphasis"><em>Indexed</em></span> - An indexed property stores an ordered collection of objects (all of the same type) that can be individually accessed by an integer-valued, non-negative index (or subscript). 
				</p></li><li><p>
					<span class="emphasis"><em>Mapped</em></span> - As an extension to standard JavaBeans APIs, Esper considers any property that accepts a String-valued key a mapped property. 
				</p></li><li><p>
					<span class="emphasis"><em>Nested</em></span> - A nested property is a property that lives within another Java object which itself is a property of an event. 
				</p></li></ul></div><p>
			Assume there is an <code class="literal">NewEmployeeEvent</code> event class as shown below. The mapped and indexed properties in this example return Java objects but could also return Java language primitive types (such as int or String). The <code class="literal">Address</code> object and <code class="literal">Employee</code> can themselves have properties that are nested within them, such as a street name in the <code class="literal">Address</code> object or a name of the employee in the <code class="literal">Employee</code> object.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class NewEmployeeEvent {
	public String getFirstName();
	public Address getAddress(String type);
	public Employee getSubordinate(int index);
	public Employee[] getAllSubordinates();
}
</pre><p>
				<span class="emphasis"><em>Simple</em></span> event properties require a getter-method that returns the property value. In this example, the <code class="literal">getFirstName</code> getter method returns the <code class="literal">firstName</code> event property of type String.
			</p><p>
				<span class="emphasis"><em>Indexed</em></span> event properties require either one of the following getter-methods. A method that takes an integer-type key value and returns the property value, such as the <code class="literal">getSubordinate</code> method, or a method that returns an array-type, or a class that implements <code class="literal">Iterable</code>. An example is the <code class="literal">getAllSubordinates</code> getter method, which returns an array of Employee but could also return an <code class="literal">Iterable</code>. In an EPL or event pattern statement, indexed properties are accessed via the <code class="literal">property[index]</code> syntax.
			</p><p>
				<span class="emphasis"><em>Mapped</em></span> event properties require a getter-method that takes a String-typed key value and returns the property value, such as the <code class="literal">getAddress</code> method. In an EPL or event pattern statement, mapped properties are accessed via the <code class="literal">property('key')</code> syntax.
			</p><p>
				<span class="emphasis"><em>Nested</em></span> event properties require a getter-method that returns the nesting object. The <code class="literal">getAddress</code> and <code class="literal">getSubordinate</code> methods are mapped and indexed properties that return a nesting object. In an EPL or event pattern statement, nested properties are accessed via the <code class="literal">property.nestedProperty</code> syntax.
			</p><p>
				All event pattern and EPL statements allow the use of indexed, mapped and nested properties (or a combination of these) anywhere where one or more event property names are expected. The below example shows different combinations of indexed, mapped and nested properties in filters of event pattern expressions (each line is a separate EPL statement):
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">every NewEmployeeEvent(firstName='myName')
every NewEmployeeEvent(address('home').streetName='Park Avenue')
every NewEmployeeEvent(subordinate[0].name='anotherName')
every NewEmployeeEvent(allSubordinates[1].name='thatName')
every NewEmployeeEvent(subordinate[0].address('home').streetName='Water Street')</pre><p>
				Similarly, the syntax can be used in EPL statements in all places where an event property name is expected, such as in select lists, where-clauses or join criteria.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select firstName, address('work'), subordinate[0].name, subordinate[1].name
from NewEmployeeEvent(address('work').streetName = 'Park Ave')</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepbean_propertynames"/>D.3.Â Property Names</h2></div></div></div><p>
				Property names follows Java standards: the class <code class="literal">java.beans.Introspector</code> and method <code class="literal">getBeanInfo</code> returns the property names as derived from the name of getter methods. In addition, Esper configuration provides a flag to turn off case-sensitive property names. A sample list of getter methods and property names is: 
			</p><div class="table"><a id="d0e53414"/><p class="title"><b>TableÂ D.1.Â JavaBeans-Style Getter Methods and Property Names</b></p><div class="table-contents"><table summary="JavaBeans-Style Getter Methods and Property Names" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Method</th><th>Property Name</th><th>Example</th></tr></thead><tbody><tr><td><code class="literal">getPrice()</code></td><td>price</td><td><pre class="synopsis">select price from MyEvent</pre></td></tr><tr><td><code class="literal">getNAME()</code></td><td>NAME</td><td><pre class="synopsis">select NAME from MyEvent</pre></td></tr><tr><td><code class="literal">getItemDesc()</code></td><td>itemDesc</td><td><pre class="synopsis">select itemDesc from MyEvent</pre></td></tr><tr><td><code class="literal">getQ()</code></td><td>q</td><td><pre class="synopsis">select q from MyEvent</pre></td></tr><tr><td><code class="literal">getQN()</code></td><td>QN</td><td><pre class="synopsis">select QN from MyEvent</pre></td></tr><tr><td><code class="literal">getqn()</code></td><td>qn</td><td><pre class="synopsis">select qn from MyEvent</pre></td></tr><tr><td><code class="literal">gets()</code></td><td>s</td><td><pre class="synopsis">select s from MyEvent</pre></td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepbean_parameterized"/>D.4.Â Parameterized Types</h2></div></div></div><p>
			When your getter methods or accessor fields return a parameterized type, for example <code class="literal">Iterable&lt;MyEventData&gt;</code> for an indexed property or <code class="literal">Map&lt;String, MyEventData&gt;</code> for a mapped property, then property expressions may refer to the properties available through the class that is the type parameter.
		</p><p>
			An example event that has properties that are parameterized types is:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class NewEmployeeEvent {
public String getName();
public Iterable&lt;EducationHistory&gt; getEducation();
public Map&lt;String, Address&gt; getAddresses();
}</pre><p>
			A sample of valid property expressions for this event is shown next:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select name, education, education[0].date, addresses('home').street
from NewEmployeeEvent</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepbean_indexedmappedsetter"/>D.5.Â Setter Methods for Indexed and Mapped Properties</h2></div></div></div><p>
			An EPL statement may update indexed or mapped properties of an event, provided the event class exposes the required setter method. 
		</p><p>
			The setter method for indexed properties must be named <code class="literal">set</code><span class="emphasis"><em>PropertyName</em></span> and must take two parameters: the <code class="literal">int</code>-type index and the <code class="literal">Object</code> type new value.
		</p><p>
			The setter method for mapped properties must be named <code class="literal">set</code><span class="emphasis"><em>PropertyName</em></span> and must take two parameters: the <code class="literal">String</code>-type map key and the <code class="literal">Object</code> type new map value.
		</p><p>
		  The following is an example event that features a setter method for the <code class="literal">props</code> mapped property and for the <code class="literal">array</code> indexed property:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyEvent {
  private Map props = new HashMap();
  private Object[] array = new Object[10];

  public void setProps(String name, Object value) {
    props.put(name, value);
  }

  public void setArray(int index, Object value) {
    array[index] = value;
  }
  // ... also provide regular JavaBean getters and setters for all properties</pre><p>
		  This sample statement updates mapped and indexed property values:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">update istream MyEventStream set props('key') = 'abc', array[2] = 100</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepbean_knownlimit"/>D.6.Â Known Limitations</h2></div></div></div><p>
			Esper employs byte code generation for fast access to event properties. When byte code generation is unsuccessful, the engine logs a warning and uses Java reflection to obtain property values instead.
		</p><p>
			A known limitation is that when an interface has an attribute of a particular type and the actual event bean class returns a subclass of that attribute, the engine logs a warning and uses reflection for that property.
		</p></div></div><div class="appendix" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepmap"/>AppendixÂ E.Â Event Representation: <code class="literal">java.util.Map</code> Events</h2></div></div></div><a id="d0e53570" class="indexterm"/><a id="d0e53573" class="indexterm"/><p>
		This section provides information for using objects that implement the <code class="literal">java.util.Map</code> interface to represent events. 
    </p><p>
		For NEsper .NET also see <a class="xref" href="#appendix_dotnet_eventrep_map" title="I.8.Â .NET IDictionary Events">SectionÂ I.8, â.NET IDictionary Eventsâ</a>.
	</p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepmap_overview"/>E.1.Â Overview</h2></div></div></div><p>
			Events can also be represented by objects that implement the <code class="literal">java.util.Map</code> interface. 
			Event properties of <code class="literal">Map</code> events are the values in the map accessible through the <code class="literal">get</code> method exposed by the <code class="literal">java.util.Map</code> interface.
		</p><p>
			Similar to the Object-array event type, the Map event type takes part in the comprehensive type system that can eliminate the need to use Java classes as event types, thereby making it easier to change types at runtime or generate type information from another source.
		</p><p>
			A given Map event type can have one or more supertypes that must also be Map event types. All properties available on any of the Map supertypes are available on the type itself. In addition, anywhere within EPL that an event type name of a Map supertype is used, any of its Map subtypes and their subtypes match that expression.
		</p><p>
			Your application can add properties to an existing Map event type during runtime using the configuration operation <code class="literal">updateMapEventType</code>. Properties may not be updated or deleted - properties can only be added, and nested properties can be added as well. The runtime configuration also allows removing Map event types and adding them back with new type information.
		</p><p>
			After your application configures a Map event type by providing a type name, the type name can be used when defining further Map or Object-array event types by specifying the type name as a property type or an array property type.
		</p><p>
			One-to-Many relationships in Map event types are represented via arrays. A property in a Map event type may be an array of primitive, an array of Java object, an array of Map or an an array of Object-array.
		</p><p>
			The engine can process <code class="literal">java.util.Map</code> events via the <code class="literal">sendEvent(Map map, String eventTypeName)</code> method on the <code class="literal">EPRuntime</code> interface. Entries in the Map represent event properties. Keys must be of type <code class="literal">java.util.String</code> for the engine to be able to look up event property names specified by pattern or EPL statements. 
		</p><p>
			The engine does not validate Map event property names or values. Your application should ensure that objects passed in as event properties match the <code class="literal">create schema</code> property names and types, or the configured event type information when using runtime or static configuration.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepmap_properties"/>E.2.Â Map Properties</h2></div></div></div><p>
			Map event properties can be of any type. Map event properties that are Java application objects or that are of type <code class="literal">java.util.Map</code> (or arrays thereof) or that are of type <code class="literal">Object[]</code> (object-array) (or arrays thereof) offer additional power:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					Properties that are Java application objects can be queried via the nested, indexed, mapped and dynamic property syntax as outlined earlier. 
				</p></li><li><p>
					Properties that are of type <code class="literal">Map</code> allow Maps to be nested arbitrarily deep and thus can be used to represent complex domain information. The nested, indexed, mapped and dynamic property syntax can be used to query Maps within Maps and arrays of Maps within Maps. 					
				</p></li><li><p>
					Properties that are of type <code class="literal">Object[]</code> (object-array) allow object-arrays to be nested arbitrarily deep. The nested, indexed, mapped and dynamic property syntax can be used to query nested Maps and object-arrays alike.
				</p></li></ul></div><p>
			In order to use <code class="literal">Map</code> events, the event type name and property names and types must be made known to the engine via Configuration or <code class="literal">create schema</code> EPL syntax. Please see examples in <a class="xref" href="#epl_createschema" title="5.15.Â Declaring an Event Type: Create Schema">SectionÂ 5.15, âDeclaring an Event Type: Create Schemaâ</a> and <a class="xref" href="#config-java-util-map" title="15.4.2.Â Events Represented by java.util.Map">SectionÂ 15.4.2, âEvents Represented by java.util.Mapâ</a>.
		</p><p>
			The code snippet below defines a Map event type, creates a Map event and sends the event into the engine. The sample defines the <code class="literal">CarLocUpdateEvent</code> event type via runtime configuration interface (<code class="literal">create schema</code> or static configuration could have been used instead).
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Define CarLocUpdateEvent event type (example for runtime-configuration interface)
Map&lt;String, Object&gt; def = new HashMap&lt;String, Object&gt;;
def.put("carId", String.class);
def.put("direction", int.class);

epService.getEPAdministrator().getConfiguration().
  addEventType("CarLocUpdateEvent", def);</pre><p>
			The <code class="literal">CarLocUpdateEvent</code> can now be used in a statement:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select carId from CarLocUpdateEvent(direction = 1)#time(1 min)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Create a CarLocUpdateEvent event and send it into the engine for processing
Map&lt;String, Object&gt; event = new HashMap&lt;String, Object&gt;();
event.put("carId", carId);
event.put("direction", direction);

epRuntime.sendEvent(event, "CarLocUpdateEvent");</pre><p>
			The engine can also query Java objects as values in a <code class="literal">Map</code> event via the nested property syntax. Thus <code class="literal">Map</code> events can be used to 
			aggregate multiple data structures into a single event and query the composite information in a convenient way. The example below demonstrates a <code class="literal">Map</code> event with a transaction and an account object.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Map event = new HashMap();
event.put("txn", txn);
event.put("account", account);
epRuntime.sendEvent(event, "TxnEvent");</pre><p>
			An example statement could look as follows.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select account.id, account.rate * txn.amount 
from TxnEvent#time(60 sec) 
group by account.id</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepmap_supertype"/>E.3.Â Map Supertypes</h2></div></div></div><p>
		   Your <code class="literal">Map</code> event type may declare one or more supertypes when configuring the type at engine initialization time or at runtime through the administrative interface. 
	   </p><p>
		   Supertypes of a <code class="literal">Map</code> event type must also be Map event types. All property names and types of a supertype are also available on a subtype and override such same-name properties of the subtype. In addition, anywhere within EPL that an event type name of a Map supertype is used, any of its Map subtypes also matches that expression (similar to the concept of interface in Java).
	   </p><p>
		   This example assumes that the <code class="literal">BaseUpdate</code> event type has been declared and acts as a supertype to the <code class="literal">AccountUpdate</code> event type (both Map event types): 
	   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epService.getEPAdministrator().getConfiguration().
    addEventType("AccountUpdate", accountUpdateDef, 
    new String[] {"BaseUpdate"});</pre><p>
		   Your application EPL statements may select <code class="literal">BaseUpdate</code> events and receive both <code class="literal">BaseUpdate</code> and <code class="literal">AccountUpdate</code> events, as well as any other subtypes of <code class="literal">BaseUpdate</code> and their subtypes.
	   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Receive BaseUpdate and any subtypes including subtypes of subtypes
select * from BaseUpdate</pre><p>
		   Your application Map event type may have multiple supertypes. The multiple inheritance hierarchy between Maps can be arbitrarily deep, however cyclic dependencies are not allowed. If using runtime configuration, supertypes must exist before a subtype to a supertype can be added.
	   </p><p>
		   See <a class="xref" href="#config-java-util-map" title="15.4.2.Â Events Represented by java.util.Map">SectionÂ 15.4.2, âEvents Represented by java.util.Mapâ</a> for more information on configuring Map event types.
	   </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepmap_advanced"/>E.4.Â Advanced Map Property Types</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="appendix_eventrepmap_nested"/>E.4.1.Â Nested Properties</h3></div></div></div><p>
			   Strongly-typed nested <code class="literal">Map</code>-within-<code class="literal">Map</code> events can be used to build rich, type-safe event types on the fly. Use the <code class="literal">addEventType</code> method on <code class="literal">Configuration</code> or <code class="literal">ConfigurationOperations</code> for initialization-time and runtime-time type definition, or the <code class="literal">create schema</code> EPL syntax.
		   </p><p>
			   Noteworthy points are:
		   </p><div class="itemizedlist"><ul compact="compact"><li><p>
						JavaBean (POJO) objects can appear as properties in <code class="literal">Map</code> event types. 
					</p></li><li><p>
						One may represent Map-within-Map and Map-Array within Map (same for object-array) using the name of a previously registered Map (or object-array) event type.
					</p></li><li><p>
						There is no limit to the number of nesting levels.
					</p></li><li><p>
						Dynamic properties can be used to query <code class="literal">Map</code>-within-<code class="literal">Map</code> keys that may not be known in advance. 
					</p></li><li><p>
						The engine returns a <code class="literal">null</code> value for properties for which the access path into the nested structure cannot be followed where map entries do not exist.
					</p></li></ul></div><p>
			   For demonstration, in this example our top-level event type is an <code class="literal">AccountUpdate</code> event, which has an <code class="literal">UpdatedFieldType</code> structure as a property. Inside the <code class="literal">UpdatedFieldType</code> structure the example defines various fields, as well as a property by name 'history' that holds a JavaBean class <code class="literal">UpdateHistory</code> to represent the update history for the account. The code snippet to define the event type is thus:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Map&lt;String, Object&gt; updatedFieldDef = new HashMap&lt;String, Object&gt;();
updatedFieldDef.put("name", String.class);
updatedFieldDef.put("addressLine1", String.class);
updatedFieldDef.put("history", UpdateHistory.class);
epService.getEPAdministrator().getConfiguration().
    addEventType("UpdatedFieldType", updatedFieldDef);

Map&lt;String, Object&gt; accountUpdateDef = new HashMap&lt;String, Object&gt;();
accountUpdateDef.put("accountId", long.class);
accountUpdateDef.put("fields", "UpdatedFieldType");	
// the latter can also be:  accountUpdateDef.put("fields", updatedFieldDef);

epService.getEPAdministrator().getConfiguration().
    addEventType("AccountUpdate", accountUpdateDef);</pre><p>
			   The next code snippet populates a sample event and sends the event into the engine:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Map&lt;String, Object&gt; updatedField = new HashMap&lt;String, Object&gt;();
updatedField.put("name", "Joe Doe");
updatedField.put("addressLine1", "40 Popular Street");
updatedField.put("history", new UpdateHistory());

Map&lt;String, Object&gt; accountUpdate = new HashMap&lt;String, Object&gt;();
accountUpdate.put("accountId", 10009901);
accountUpdate.put("fields", updatedField);

epService.getEPRuntime().sendEvent(accountUpdate, "AccountUpdate");</pre><p>
			   Last, a sample query to interrogate <code class="literal">AccountUpdate</code> events is as follows:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select accountId, fields.name, fields.addressLine1, fields.history.lastUpdate
from AccountUpdate</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="appendix_eventrepmap_array"/>E.4.2.Â One-to-Many Relationships</h3></div></div></div><p>
			   To model repeated properties within a Map, you may use arrays as properties in a Map. You may use an array of primitive types or an array of JavaBean objects or an array of a previously declared Map or object-array event type.
		   </p><p>
			   When using a previously declared Map event type as an array property, the literal <code class="literal">[]</code> must be appended after the event type name.
		   </p><p>
			   This following example defines a Map event type by name <code class="literal">Sale</code> to hold array properties of the various types. It assumes a <code class="literal">SalesPerson</code> Java class exists and a Map event type by name <code class="literal">OrderItem</code> was declared:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Map&lt;String, Object&gt; sale = new HashMap&lt;String, Object&gt;();
sale.put("userids", int[].class);
sale.put("salesPersons", SalesPerson[].class);
sale.put("items", "OrderItem[]");	 // The property type is the name itself appended by []

epService.getEPAdministrator().getConfiguration().
    addEventType("SaleEvent", sale);</pre><p>
			   The three properties that the above example declares are:
		   </p><div class="itemizedlist"><ul><li><p>
					 An integer array of user ids.
				   </p></li><li><p>
					 An array of <code class="literal">SalesPerson</code> Java objects.
				   </p></li><li><p>
					 An array of Maps for order items.
				   </p></li></ul></div><p>
			   The next EPL statement is a sample query asking for property values held by arrays:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select userids[0], salesPersons[1].name, 
    items[1], items[1].price.amount from SaleEvent</pre></div></div></div><div class="appendix" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepoa"/>AppendixÂ F.Â Event Representation: Object-Array (<code class="literal">Object[]</code>) Events</h2></div></div></div><a id="d0e53887" class="indexterm"/><a id="d0e53890" class="indexterm"/><p>
		This section provides information for using Object-array (<code class="literal">Object[]</code>) to represent events. 
    </p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepoa_overview"/>F.1.Â Overview</h2></div></div></div><p>
			An event can also be represented by an array of objects. Event properties of <code class="literal">Object[]</code> events are the array element values. 
		</p><p>
			Similar to the Map event type, the object-array event type takes part in the comprehensive type system that can eliminate the need to use Java classes as event types, thereby making it easier to change types at runtime or generate type information from another source.
		</p><p>
			A given Object-array event type can have only a single supertype that must also be an Object-array event type. All properties available on the Object-array supertype is also available on the type itself. In addition, anywhere within EPL that an event type name of an Object-array supertype is used, any of its Object-array subtypes and their subtypes match that expression.
		</p><p>
			Your application can add properties to an existing Object-array event type during runtime using the configuration operation <code class="literal">updateObjectArrayEventType</code>. Properties may not be updated or deleted - properties can only be added, and nested properties can be added as well. The runtime configuration also allows removing Object-array event types and adding them back with new type information.
		</p><p>
			After your application configures an Object-array event type by providing a type name, the type name can be used when defining further Object-array or Map event types by specifying the type name as a property type or an array property type.
		</p><p>
			One-to-Many relationships in Object-array event types are represented via arrays. A property in an Object-array event type may be an array of primitive, an array of Java object, an array of Map or an array of Object-array.
		</p><p>
			The engine can process <code class="literal">Object[]</code> events via the <code class="literal">sendEvent(Object[] array, String eventTypeName)</code> method on the <code class="literal">EPRuntime</code> interface. Entries in the Object array represent event properties.
		</p><p>
			The engine does not validate Object array length or value types. Your application must ensure that Object array values match the declaration of the event type: The type and position of property values must match property names and types in the same exact order and object array length must match the number of properties declared via <code class="literal">create schema</code> or the static or runtime configuration.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepoa_properties"/>F.2.Â Object-Array Properties</h2></div></div></div><p>
			Object-array event properties can be of any type. Object-array event properties that are Java application objects or that are of type <code class="literal">java.util.Map</code> (or arrays thereof)  or that are of type <code class="literal">Object-array</code> (or arrays thereof) offer additional power:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					Properties that are Java application objects can be queried via the nested, indexed, mapped and dynamic property syntax as outlined earlier. 
				</p></li><li><p>
					Properties that are of type <code class="literal">Object[]</code> allow object-arrays to be nested arbitrarily deep and thus can be used to represent complex domain information. The nested, indexed, mapped and dynamic property syntax can be used to query object-array within object-arrays and arrays of object-arrays within object-arrays. 					
				</p></li><li><p>
					Properties that are of type <code class="literal">Map</code> allow Maps to be nested in object-array events and arbitrarily deep. The nested, indexed, mapped and dynamic property syntax can be used to query nested Maps and object-arrays alike.
				</p></li></ul></div><p>
			In order to use <code class="literal">Object[]</code> (object-array) events, the event type name and property names and types, in a well-defined order that must match object-array event properties, must be made known to the engine via configuration or <code class="literal">create schema</code> EPL syntax. Please see examples in <a class="xref" href="#epl_createschema" title="5.15.Â Declaring an Event Type: Create Schema">SectionÂ 5.15, âDeclaring an Event Type: Create Schemaâ</a> and <a class="xref" href="#config-objectarray" title="15.4.3.Â Events Represented by Object[] (Object-array)">SectionÂ 15.4.3, âEvents Represented by Object[] (Object-array)â</a>.
		</p><p>
			The code snippet below defines an Object-array event type, creates an Object-array event and sends the event into the engine. The sample defines the <code class="literal">CarLocUpdateEvent</code> event type via the runtime configuration interface (<code class="literal">create schema</code> or static configuration could have been used instead).
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Define CarLocUpdateEvent event type (example for runtime-configuration interface)
String[] propertyNames = {"carId", "direction"};   // order is important
Object[] propertyTypes = {String.class, int.class};  // type order matches name order

epService.getEPAdministrator().getConfiguration().
  addEventType("CarLocUpdateEvent", propertyNames, propertyTypes);</pre><p>
			The <code class="literal">CarLocUpdateEvent</code> can now be used in a statement:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select carId from CarLocUpdateEvent(direction = 1)#time(1 min)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Send an event
Object[] event = {carId, direction};
epRuntime.sendEvent(event, "CarLocUpdateEvent");</pre><p>
			The engine can also query Java objects as values in an <code class="literal">Object[]</code> event via the nested property syntax. Thus <code class="literal">Object[]</code> events can be used to 
			aggregate multiple data structures into a single event and query the composite information in a convenient way. The example below demonstrates a <code class="literal">Object[]</code> event with a transaction and an account object.
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epRuntime.sendEvent(new Object[] {txn, account}, "TxnEvent");</pre><p>
			An example statement could look as follows:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select account.id, account.rate * txn.amount 
from TxnEvent#time(60 sec) 
group by account.id</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepoa_supertype"/>F.3.Â Object-Array Supertype</h2></div></div></div><p>
		   Your <code class="literal">Object[]</code> (object-array) event type may declare one supertype when configuring the type at engine initialization time or at runtime through the administrative interface. 
	   </p><p>
		   The supertype of a <code class="literal">Object[]</code> event type must also be an object-array event type. All property names and types of a supertype are also available on a subtype and override such same-name properties of the subtype. In addition, anywhere within EPL that an event type name of an Object-array supertype is used, any of its Object-array subtypes also matches that expression (similar to the concept of interface or superclass).
	   </p><p>
		 The properties provided by the top-most supertype must occur first in the object array. Subtypes each append to the object array. The number of values appended must match the 
		 number of properties declared by the subtype.
	   </p><p>
		  For example, assume your application declares the following two types:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create objectarray schema SuperType (p0 string)</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create objectarray schema SubType (p1 string) inherits SuperType</pre><p>
		  The object array event objects that your application can send into the engine are shown by the next code snippet:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epRuntime.sendEvent(new Object[] {"p0_value", "p1_value"}, "SubType");
epRuntime.sendEvent(new Object[] {"p0_value"}, "SuperType");</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepoa_advanced"/>F.4.Â Advanced Object-Array Property Types</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="appendix_eventrepoa_arraynested"/>F.4.1.Â Nested Properties</h3></div></div></div><p>
			   Strongly-typed nested <code class="literal">Object[]</code>-within-<code class="literal">Object[]</code> events can be used to build rich, type-safe event types on the fly. Use the <code class="literal">addEventType</code> method on <code class="literal">Configuration</code> or <code class="literal">ConfigurationOperations</code> for initialization-time and runtime-time type definition, or the <code class="literal">create schema</code> EPL syntax.
		   </p><p>
			   Noteworthy points are:
		   </p><div class="itemizedlist"><ul compact="compact"><li><p>
						JavaBean (POJO) objects can appear as properties in <code class="literal">Object[]</code> event types. 
					</p></li><li><p>
						One may represent Object-array within Object-array and Object-Array-Array within Object-array (same for Map event types) using the name of a previously registered Object-array (or Map) event type.
					</p></li><li><p>
						There is no limit to the number of nesting levels.
					</p></li><li><p>
						Dynamic properties can be used to query <code class="literal">Object[]</code>-within-<code class="literal">Object[]</code> values that may not be known in advance. 
					</p></li><li><p>
						The engine returns a <code class="literal">null</code> value for properties for which the access path into the nested structure cannot be followed where entries do not exist.
					</p></li></ul></div><p>
			   For demonstration, in this example our top-level event type is an <code class="literal">AccountUpdate</code> event, which has an <code class="literal">UpdatedFieldType</code> structure as a property. Inside the <code class="literal">UpdatedFieldType</code> structure the example defines various fields, as well as a property by name 'history' that holds a JavaBean class <code class="literal">UpdateHistory</code> to represent the update history for the account. The code snippet to define the event type is thus:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String[] propertyNamesUpdField = {"name", "addressLine1", "history"};
Object[] propertyTypesUpdField = {String.class, String.class, UpdateHistory.class};
epService.getEPAdministrator().getConfiguration().
    addEventType("UpdatedFieldType", propertyNamesUpdField, propertyTypesUpdField);

String[] propertyNamesAccountUpdate = {"accountId", "fields"};
Object[] propertyTypesAccountUpdate = {long.class, "UpdatedFieldType"};
epService.getEPAdministrator().getConfiguration().
    addEventType("AccountUpdate", propertyNamesAccountUpdate, propertyTypesAccountUpdate);</pre><p>
			   The next code snippet populates a sample event and sends the event into the engine:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Object[] updatedField = {"Joe Doe", "40 Popular Street", new UpdateHistory()};
Object[] accountUpdate = {10009901, updatedField};

epService.getEPRuntime().sendEvent(accountUpdate, "AccountUpdate");</pre><p>
			   Last, a sample query to interrogate <code class="literal">AccountUpdate</code> events is as follows:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select accountId, fields.name, fields.addressLine1, fields.history.lastUpdate
from AccountUpdate</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="appendix_eventrepoa_array"/>F.4.2.Â One-to-Many Relationships</h3></div></div></div><p>
			   To model repeated properties within an Object-array, you may use arrays as properties in an Object-array. You may use an array of primitive types or an array of JavaBean objects or an array of a previously declared Object-array or Map event type.
		   </p><p>
			   When using a previously declared Object-array event type as an array property, the literal <code class="literal">[]</code> must be appended after the event type name.
		   </p><p>
			   This following example defines an Object-array event type by name <code class="literal">Sale</code> to hold array properties of the various types. It assumes a <code class="literal">SalesPerson</code> Java class exists and an Object-array event type by name <code class="literal">OrderItem</code> was declared:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String[] propertyNames = {"userids", "salesPersons", "items"};
Object[] propertyTypes = {int[].class, SalesPerson[].class, "OrderItem[]");

epService.getEPAdministrator().getConfiguration().
    addEventType("SaleEvent", propertyNames, propertyTypes);</pre><p>
			   The three properties that the above example declares are:
		   </p><div class="itemizedlist"><ul><li><p>
					 An integer array of user ids.
				   </p></li><li><p>
					 An array of <code class="literal">SalesPerson</code> Java objects.
				   </p></li><li><p>
					 An array of Object-array for order items.
				   </p></li></ul></div><p>
			   The next EPL statement is a sample query asking for property values held by arrays:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select userids[0], salesPersons[1].name, 
    items[1], items[1].price.amount from SaleEvent</pre></div></div></div><div class="appendix" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepavro"/>AppendixÂ G.Â Event Representation: Avro Events (<code class="literal">org.apache.avro.generic.GenericData.Record)</code></h2></div></div></div><a id="d0e54167" class="indexterm"/><a id="d0e54170" class="indexterm"/><p>
		This section provides information for using Avro to represent events. 
    </p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepavro_overview"/>G.1.Â Overview</h2></div></div></div><p>
			An event can be represented by an Avro <code class="literal">GenericData.Record</code> instance. Event properties of Avro events are the field values of a <code class="literal">GenericData.Record</code>. The top level schema must always be a record.
		</p><p>
			The advantages for supporting Avro as an event representation are:
		</p><div class="itemizedlist"><ul><li><p>Avro has excellent support for JSON, allowing JSON for incoming and outgoing events, while not compromising on type-safety since Avro provides a schema.</p></li><li><p>Avro has rich, extensible, standardized schema language defined in pure JSON; event types / schemas can be defined/imported/exported with EPL or from external sources.</p></li><li><p>Avro offers a compact binary representation and is thus efficient and fast for use with EsperHA persistence or for input/output in wire transfer.</p></li><li><p>Avro has a compact event representation reducing memory use, as each event is only a schema-reference and an Object[] (see GenericData.Record).</p></li><li><p>JSON itself is not memory efficient while Avro is: JSON repeats every field name with every single record and JSON alone is inefficient for high-volume usage.</p></li><li><p>Avro allows fast access to event properties since reading an event property value only requires reading the GenericData.Record-internal object-array at a given index.</p></li><li><p>Avro has bindings for a wide variety of programming languages and platforms and has RPC and file representations.</p></li><li><p>Avro does not require code generation so EPL can be written generically for any data stream. Type information can be made available at runtime while still providing type-safety.
				There is no need to generate code, therefore there is no need to manage generated classes, or to reload classes or to restart the process to reload classes.</p></li><li><p>Avro has the notion of schema compatibility for evolving your event data over time.</p></li></ul></div><p>
			Similar to the Map and object-array event type, the Avro event type takes part in the comprehensive type system that can eliminate the need to use Java classes as event types, thereby making it easier to change types at runtime or generate or import/export type information from/to another source/destination.
		</p><p>
			The engine can process Avro's <code class="literal">GenericData.Record</code> events via the <code class="literal">sendEventAvro(Object avroGenericDataDotRecord, String avroEventTypeName)</code> method on the <code class="literal">EPRuntime</code> interface.
		</p><p>
			The engine does not validate Avro events. Your application must ensure that Avro values match the declaration of the schema and that the schema of the event matches the schema declared for the event type of the event.
		</p><p>
			A given Avro event type can have only a single supertype that must also be an Avro event type. All properties available on the Avro supertype is also available on the type itself. In addition, anywhere within EPL that an event type name of an Avro supertype is used, the Avro subtype and the subtype of the subtype match that expression.
			Note that access to properties is by field position thereby subtype and supertype field positions should be congruent.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepavro_properties"/>G.2.Â Avro Event Type</h2></div></div></div><p>
			In order to use Avro for incoming events, the event type name and Avro schema must be made known to the engine via configuration or <code class="literal">create avro schema</code> EPL syntax. Please see examples in <a class="xref" href="#epl_createschema" title="5.15.Â Declaring an Event Type: Create Schema">SectionÂ 5.15, âDeclaring an Event Type: Create Schemaâ</a> and <a class="xref" href="#config-avro" title="15.4.4.Â Events Represented by Avro GenericData.Record">SectionÂ 15.4.4, âEvents Represented by Avro GenericData.Recordâ</a>.
		</p><p>
			The code snippet below defines an Avro event type, creates an Avro event and sends the event into the engine. The sample defines the <code class="literal">CarLocUpdateEvent</code> event type via the runtime configuration interface (<code class="literal">create schema</code> or static configuration could have been used instead).
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Define CarLocUpdateEvent event type (example for runtime-configuration interface)
Schema schema = record("CarLocUpdateEvent").fields()
  .name("carId").type().stringBuilder().prop(PROP_JAVA_STRING_KEY, PROP_JAVA_STRING_VALUE).endString().noDefault()
  .requiredInt("direction")
  .endRecord();
ConfigurationEventTypeAvro avroEvent = new ConfigurationEventTypeAvro(schema);
epService.getEPAdministrator().getConfiguration().addEventTypeAvro("CarLocUpdateEvent", avroEvent);</pre><p>
			The <code class="literal">CarLocUpdateEvent</code> can now be used in a statement:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select count(*) from CarLocUpdateEvent(direction = 1)#time(1 min)</pre><p>
			The sample code to send an event is:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">GenericData.Record event = new GenericData.Record(schema);
event.put("carId", "A123456");
event.put("direction", 1);
epService.getEPRuntime().sendEventAvro(event, "CarLocUpdateEvent");</pre><p>
			Use the <code class="literal">@EventRepresentation(avro)</code> annotation to obtain Avro output events.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepavro_schemanamerequirement"/>G.3.Â Avro Schema Name Requirement</h2></div></div></div><p>
			Avro schemas can contain further Avro schemas. The engine tracks nested schema based on the schema name. The engine implicitly registers an event type for each schema using the schema name, for nested simple and indexed properties.
			Therefore the engine requires schema names to match the initially-registered schema of the same name. 
		</p><p>
			For example, the schema:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{
  "type" : "record",
  "name" : "MyEvent",
  "fields" : [ {
    "name" : "nested",
    "type" : {
      "type" : "record",
      "name" : "MyNestedEvent",
      "fields" : [ {
        "name" : "value",
        "type" : "int"
      } ]
    }
  } ]
}</pre><p>
			For the above schema, upon registration of the schema as an event type, the engine creates an event type <code class="literal">MyNestedEvent</code> and associates it to the <code class="literal">MyNestedEvent</code> schema.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepavro_schematoprop"/>G.4.Â Avro Field Schema to Property Type Mapping</h2></div></div></div><p>
			Upon registering an Avro event type, the engine determines property names and property types.
			The Avro record field schema determines the property type.
	   </p><p>
		   The table below describes Avro field schema to property type mapping:
	   </p><div class="table"><a id="d0e54297"/><p class="title"><b>TableÂ G.1.Â Avro Field Schema to Property Type Mapping</b></p><div class="table-contents"><table summary="Avro Field Schema to Property Type Mapping" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Schema</th><th>Property Type</th></tr></thead><tbody><tr><td><code class="literal">"int"</code> (Schema.Type.INT)</td><td><code class="literal">int</code></td></tr><tr><td><code class="literal">"long"</code> (Schema.Type.LONG)</td><td><code class="literal">long</code></td></tr><tr><td><code class="literal">"double"</code> (Schema.Type.DOUBLE)</td><td><code class="literal">double</code></td></tr><tr><td><code class="literal">"float"</code> (Schema.Type.FLOAT)</td><td><code class="literal">float</code></td></tr><tr><td><code class="literal">"boolean"</code> (Schema.Type.BOOLEAN)</td><td><code class="literal">boolean</code></td></tr><tr><td><code class="literal">"bytes"</code> (Schema.Type.BYTES)</td><td><code class="literal">ByteBuffer</code></td></tr><tr><td><code class="literal">"null"</code> (Schema.Type.NULL)</td><td><code class="literal">null</code></td></tr><tr><td><code class="literal">"string"</code> (Schema.Type.STRING)</td><td>
							<p>
								If the field has the property <code class="literal">avro.java.string</code> as <code class="literal">String</code>, then the property type is <code class="literal">String</code> otherwise it is <code class="literal">CharSequence</code>.
							</p>
						</td></tr><tr><td><code class="literal">"union"</code> (Schema.Type.UNION)</td><td>See below.</td></tr><tr><td><code class="literal">"array"</code> (Schema.Type.ARRAY)</td><td><code class="literal">java.util.Collection</code></td></tr><tr><td><code class="literal">"map"</code> (Schema.Type.MAP)</td><td><code class="literal">java.util.Map</code></td></tr><tr><td><code class="literal">"record"</code> (Schema.Type.RECORD)</td><td><code class="literal">GenericData.Record</code></td></tr><tr><td><code class="literal">"fixed"</code> (Schema.Type.FIXED)</td><td><code class="literal">GenericFixed</code></td></tr><tr><td><code class="literal">"enum"</code> (Schema.Type.ENUM)</td><td><code class="literal">GenericEnumSymbol</code></td></tr></tbody></table></div></div><br class="table-break"/><p>
			For unions: 
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					If the union contains <code class="literal">null</code> and any of the primitive types, the property type is the boxed type. For example <code class="literal">unionOf().nullType().and().intType().endUnion()</code> is <code class="literal">Integer.class</code>.
				</p></li><li><p>
					If the union contains <code class="literal">null</code> and numeric types only, the property type is <code class="literal">Number.class</code>. For example <code class="literal">unionOf().longType().and().intType().endUnion()</code> is <code class="literal">Number.class</code>.
				</p></li><li><p>
					Otherwise the property type is <code class="literal">Object.class</code>.
				</p></li></ol></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepavro_typetoschema"/>G.5.Â Primitive Data Type and Class to Avro Schema Mapping</h2></div></div></div><p>
			This section lists for each JVM type the default Avro schema that the engine uses when assembling an Avro schema from a <code class="literal">select</code>-clause.
	   </p><p>
			For example, consider the following EPL statement. The statement assumes that <code class="literal">MyEvent</code> is a pre-registered event type of any kind (Map, Avro, Object-Array, POJO etc.):
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@EventRepresentation(avro) select 1 as carId, 'abc' as carType from MyEvent</pre><p>
			Your application may obtain the schema for the statement output event type as follows:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">String epl = "@EventRepresentation(avro) select 1 as carId, 'abc' as carType from MyEvent";
EPStatement stmt = epService.getEPAdministrator().createEPL(epl);
Schema schema = (Schema) ((AvroSchemaEventType) stmt.getEventType()).getSchema();</pre><p>
			The engine generates an Avro schema based on the expressions in the <code class="literal">select</code>-clause. The schema in pretty-print may look like this:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{
  "type" : "record",
  "name" : "anonymous_1_result_",
  "fields" : [ {
    "name" : "carId",
    "type" : "int"
  }, {
    "name" : "carType",
    "type" : {
      "type" : "string",
      "avro.java.string" : "String"
    }
  } ]
}</pre><p>
			Please consult <a class="xref" href="#config-engine-eventmeta-avro" title="15.4.14.2.Â Avro Settings">SectionÂ 15.4.14.2, âAvro Settingsâ</a> for details on controlling default mapping.
			Tables below outline the default mapping and provide alternative schemas depending on the avro settings .
		</p><p>
			By default the engine maps expression result types to Avro schema using non-null schema types. 
			By default, for String-type values, the engine sets the <code class="literal">avro.java.string</code> property to <code class="literal">String</code> to ensure that Avro uses <code class="literal">java.lang.String</code> to represent strings (and not <code class="literal">org.apache.avro.util.Utf8</code>).
			The tables below outline the default mapping and provide alternative schemas, which apply according to Esper Avro settings.
		</p><p>
			The mapping from primitive and string type to Avro schema is:
		</p><div class="table"><a id="d0e54517"/><p class="title"><b>TableÂ G.2.Â Primitive Data Type and String Mapping</b></p><div class="table-contents"><table summary="Primitive Data Type and String Mapping" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Type</th><th>Default Schema</th><th>Alternative Schemas</th></tr></thead><tbody><tr><td>byte</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">"int"</pre></td><td>N/A</td></tr><tr><td>java.lang.Byte</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">"int"</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null","int"]</pre></td></tr><tr><td>boolean</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">"boolean"</pre></td><td>N/A</td></tr><tr><td>java.lang.Boolean</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">"boolean"</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null","boolean"]</pre></td></tr><tr><td>double</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">"double"</pre></td><td>N/A</td></tr><tr><td>java.lang.Double</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">"double"</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null","double"]</pre></td></tr><tr><td>float</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">"float"</pre></td><td>N/A</td></tr><tr><td>java.lang.Float</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">"float"</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null","float"]</pre></td></tr><tr><td>int</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">"int"</pre></td><td>N/A</td></tr><tr><td>java.lang.Integer</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">"int"</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null","int"]</pre></td></tr><tr><td>long</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">"long"</pre></td><td>N/A</td></tr><tr><td>java.lang.Long</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">"long"</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null","long"]</pre></td></tr><tr><td>null</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">"null"</pre></td><td>N/A</td></tr><tr><td>java.lang.String and java.lang.CharSequence</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{"type":"string","avro.java.string":"String"}</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">"string"</pre> or <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null","string"]</pre> or <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null",{"type":"string","avro.java.string":"String"}]</pre></td></tr></tbody></table></div></div><br class="table-break"/><p>
			The mapping from array-type to Avro schema is:
		</p><div class="table"><a id="d0e54660"/><p class="title"><b>TableÂ G.3.Â Array Type Mapping</b></p><div class="table-contents"><table summary="Array Type Mapping" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Type</th><th>Default Schema</th><th>Alternative Schemas</th></tr></thead><tbody><tr><td>byte[]</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">"bytes"</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null","bytes"]</pre></td></tr><tr><td>Byte[]</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{"type":"array","items":["null","int"]}</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null",{"type":"array","items":["null","int"]}]</pre></td></tr><tr><td>boolean[]</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{"type":"array","items":"boolean"}</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null",{"type":"array","items":"boolean"}]</pre></td></tr><tr><td>Boolean[]</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{"type":"array","items":["null","boolean"]}</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null",{"type":"array","items":["null","boolean"]}]</pre></td></tr><tr><td>double[]</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{"type":"array","items":"double"}</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null",{"type":"array","items":"double"}]</pre></td></tr><tr><td>Double[]</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{"type":"array","items":["null","double"]}</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null",{"type":"array","items":["null","double"]}]</pre></td></tr><tr><td>float[]</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{"type":"array","items":"float"}</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null",{"type":"array","items":"float"}]</pre></td></tr><tr><td>Float[]</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{"type":"array","items":["null","float"]}</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null",{"type":"array","items":["null","float"]}]</pre></td></tr><tr><td>int[]</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{"type":"array","items":"int"}</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null",{"type":"array","items":"int"}]</pre></td></tr><tr><td>Integer[]</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{"type":"array","items":["null","int"]}</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null",{"type":"array","items":["null","int"]}]</pre></td></tr><tr><td>long[]</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{"type":"array","items":"long"}</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null",{"type":"array","items":"long"}]</pre></td></tr><tr><td>Long[]</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{"type":"array","items":["null","long"]}</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null",{"type":"array","items":["null","long"]}]</pre></td></tr><tr><td>java.lang.String[] and java.lang.CharSequence[]</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{"type":"array","items":{"type":"string","avro.java.string":"String"}}</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null",{"type":"array","items":{"type":"string","avro.java.string":"String"}}]</pre> or <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{"type":"array","items":"string"}</pre> (or the combination)</td></tr></tbody></table></div></div><br class="table-break"/><p>
			Additional mappings to Avro schema are:
		</p><div class="table"><a id="d0e54799"/><p class="title"><b>TableÂ G.4.Â Additional Mapping</b></p><div class="table-contents"><table summary="Additional Mapping" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Type</th><th>Default Schema</th><th>Alternative Schemas</th></tr></thead><tbody><tr><td><code class="literal">java.util.Map</code> interface implementation</td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">{"type":"map","values":{"type":"string","avro.java.string":"String"}}</pre></td><td><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">["null",{"type":"map","values":{"type":"string","avro.java.string":"String"}}]</pre></td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepavro_avroschemafieldannotation"/>G.6.Â Customizing Avro Schema Assignment</h2></div></div></div><p>
		   Esper provides the <code class="literal">@AvroSchemaField</code> annotation to assign a schema to a given property. The annotation requires the <code class="literal">name</code> attribute for the property name and the <code class="literal">schema</code> attributed for the Avro schema text.		
	   </p><p>
		   The schema provided via <code class="literal">@AvroSchemaField</code> for a given property replaces the Avro schema that is otherwise assigned according to the above mapping.
	   </p><p> 
		   The annotation can be used with <code class="literal">create-schema</code> or with <code class="literal">@EventRepresentation(avro)</code>.
	   </p><p>
		   In this example the <code class="literal">carId</code> property is a union of int-type and string-type.
	   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@AvroSchemaField(name='carId',schema='["int","string"]') create avro schema MyEvent(carId object)</pre><p>
		The engine determines the property type from the Avro field schema according to the rules listed above.
	   </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepavro_classtoavroschema"/>G.7.Â Customizing Class-to-Avro Schema</h2></div></div></div><p>
			In the default configuration only the primitive data types and the abovementioned classes have a corresponding Avro schema.
			When the engine encounters a class for which is does not know the Avro schema that is should use, it fails the EPL statement validation.
	   </p><p>
		   For example, the below EPL is invalid:
	   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Invalid since LocalDateTime has no equivalent Avro schema (by default)
create avro schema MyEvent(ldt as java.time.LocalDateTime)</pre><p>
			Instead of using <code class="literal">@AvroSchemaField</code> your application can configure a type-representation mapper class that can return the Avro schema to use.
			For configuration information please see <a class="xref" href="#config-engine-eventmeta-avro" title="15.4.14.2.Â Avro Settings">SectionÂ 15.4.14.2, âAvro Settingsâ</a> and the JavaDoc.
		 </p><p>
			Your application can implement the <code class="literal">com.espertech.esper.client.hook.TypeRepresentationMapper</code> interface. The engine invokes the provided mapper to determine the Avro schema for a given field.
	   </p><p>
			For example, the following type mapper implementation maps <code class="literal">LocalDateTime</code> to the Avro string type.
	   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class MyTypeRepresentationMapper implements TypeRepresentationMapper {
  public Object map(TypeRepresentationMapperContext context) {
    if (context.getClazz() == LocalDateTime.class) {
      return builder().stringBuilder().endString();
    }
    return null;
  }
}</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepavro_typemapping"/>G.8.Â Customizing Object-to-Avro Field Value Assignment</h2></div></div></div><p>
		   The engine can automatically widen and assign values to Avro fields. In the case when your application requires a custom logic to convert, widen, coerce or transform a value before assigment to an Avro field,
		   please use the mechanism below.
	   </p><p>
			Your application can implement the <code class="literal">com.espertech.esper.client.hook.ObjectValueTypeWidenerFactory</code> interface. The engine invokes the provided factory to determine a widener for values.
	   </p><p>
			For example, the factory implementation below returns a type widener that converts <code class="literal">LocalDateTime</code> instances to Avro string-type values by using the date-time formatter:
	   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public static class MyObjectValueTypeWidenerFactory implements ObjectValueTypeWidenerFactory {

  public TypeWidener make(ObjectValueTypeWidenerFactoryContext context) {
    if (context.getClazz() == LocalDateTime.class) {
      return new TypeWidener() {
        public Object widen(Object input) {
          LocalDateTime ldt = (LocalDateTime) input;
          return DateTimeFormatter.ISO_DATE_TIME.format(ldt);
        }
      };
    }
    return null;
  }
}</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepavro_apiexamples"/>G.9.Â API Examples</h2></div></div></div><p>
			To obtain the Avro schema for a given event type, use:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public static Schema getAvroSchema(EventType eventType) {
  return (Schema) ((AvroSchemaEventType) eventType).getSchema();
}</pre><p>
			To obtain the Avro schema for a registered event type, you may use:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public static Schema getAvroSchema(EPServiceProvider epService, String eventTypeName) {
  return getAvroSchema(epService.getEPAdministrator().getConfiguration().getEventType(eventTypeName));
}</pre><p>
			To obtain the Avro schema for a given event, you may use:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public static Schema getAvroSchema(EventBean event) {
  return getAvroSchema(event.getEventType());
}</pre><p>
			To obtain the <code class="literal">GenericData.Record</code> for a given event, you may use:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public static Schema getAvroRecord(EventBean event) {
  return (GenericData.Record) event.getUnderlying();
}</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepavro_limitations"/>G.10.Â Limitations</h2></div></div></div><p>
			The following limitations apply: 
		</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
					An Avro <code class="literal">GenericData.Record</code> cannot contain <code class="literal">EventBean</code> instances. 
				</p></li><li><p>
					There is no implicit translation from other event representations to Avro schemas.
				</p></li><li><p>
					While the engine performs best-effort assignment checking and widening, it does not actually itself verify that the <code class="literal">GenericData.Record</code> contains valid data, for both production 
					of <code class="literal">GenericData.Record</code> and consumption of <code class="literal">GenericData.Record</code>.
					</p></li></ol></div></div></div><div class="appendix" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepxml"/>AppendixÂ H.Â Event Representation: <code class="literal">org.w3c.dom.Node</code> XML Events</h2></div></div></div><a id="d0e54965" class="indexterm"/><a id="d0e54968" class="indexterm"/><p>
		This section provides information for using <code class="literal">org.w3c.dom.Node</code> XML to represent events. 
    </p><p>
		For NEsper .NET also see <a class="xref" href="#appendix_dotnet_eventrep_xml" title="I.9.Â .NET XML Events">SectionÂ I.9, â.NET XML Eventsâ</a>.
	</p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepxml_overview"/>H.1.Â Overview</h2></div></div></div><p>
			Events can be represented as <code class="literal">org.w3c.dom.Node</code> instances and send into the engine via the <code class="literal">sendEvent</code> method on <code class="literal">EPRuntime</code> or via <code class="literal">EventSender</code>. Please note that configuration is required so the event type name and root element name is known. See <a class="xref" href="#configuration" title="ChapterÂ 15.Â Configuration">ChapterÂ 15, <i>Configuration</i></a>.
		</p><p>
			If a XML schema document (XSD file) can be made available as part of the configuration, then Esper can read the schema and appropriately present event type metadata and validate statements that use the event type and its properties. See <a class="xref" href="#appendix_eventrepxml_schema" title="H.2.Â Schema-Provided XML Events">SectionÂ H.2, âSchema-Provided XML Eventsâ</a>.
		</p><p>
			When no XML schema document is provided, XML events can still be queried, however the return type and return values of property expressions are string-only and no event type metadata is available other than for explicitly configured properties. See <a class="xref" href="#appendix_eventrepxml_noschema" title="H.3.Â No-Schema-Provided XML Events">SectionÂ H.3, âNo-Schema-Provided XML Eventsâ</a>.
		</p><p>
			In all cases Esper allows you to configure explicit XPath expressions as event properties. You can specify arbitrary XPath functions or expressions and provide a property name and type by which result values will be available for use in EPL statements. See <a class="xref" href="#appendix_eventrepxml_explicit" title="H.4.Â Explicitly-Configured Properties">SectionÂ H.4, âExplicitly-Configured Propertiesâ</a>.
		</p><p>
			Nested, mapped and indexed event properties are also supported in expressions against <code class="literal">org.w3c.dom.Node</code> events. Thus XML trees can conveniently be interrogated via the property expression syntax.
		</p><p>
			Only one event type per root element name may be configured. The engine recognizes each event by its root element name or you may use <code class="literal">EventSender</code> to send events.
		</p><p>
			This section uses the following XML document as an example:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Sensor xmlns="SensorSchema"&gt;
  &lt;ID&gt;urn:epc:1:4.16.36&lt;/ID&gt;
  &lt;Observation Command="READ_PALLET_TAGS_ONLY"&gt;
    &lt;ID&gt;00000001&lt;/ID&gt;
    &lt;Tag&gt;
      &lt;ID&gt;urn:epc:1:2.24.400&lt;/ID&gt;
    &lt;/Tag&gt;
    &lt;Tag&gt;
      &lt;ID&gt;urn:epc:1:2.24.401&lt;/ID&gt;
    &lt;/Tag&gt;
  &lt;/Observation&gt;
&lt;/Sensor&gt;</pre><p>
			The schema for the example is:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;

  &lt;xs:element name="Sensor"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name="ID" type="xs:string"/&gt;
        &lt;xs:element ref="Observation" /&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name="Observation"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name="ID" type="xs:string"/&gt;
        &lt;xs:element ref="Tag" maxOccurs="unbounded" /&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name="Command" type="xs:string" use="required" /&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name="Tag"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name="ID" type="xs:string"/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
&lt;/xs:schema&gt;</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepxml_schema"/>H.2.Â Schema-Provided XML Events</h2></div></div></div><p>
		   If you have a XSD schema document available for your XML events, Esper can interrogate the schema. The benefits are:
	   </p><div class="itemizedlist"><ul compact="compact"><li><p>
					New EPL statements that refer to event properties are validated against the types provided in the schema.
				</p></li><li><p>
					Event type metadata becomes available for retrieval as part of the <code class="literal">EventType</code> interface.
				</p></li></ul></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="appendix_eventrepxml_schema-start"/>H.2.1.Â Getting Started</h3></div></div></div><p>
				The engine reads a XSD schema file from an URL you provide. Make sure files imported by the XSD schema file can also be resolved.
			</p><p>
				The configuration accepts a schema URL. This is a sample code snippet to determine a schema URL from a file in classpath:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">URL schemaURL = this.getClass().getClassLoader().getResource("sensor.xsd");
// For NEsper .NET use C# ResourceManager class for loading resources</pre><p>
				Here is a sample use of the runtime configuration API, please see <a class="xref" href="#configuration" title="ChapterÂ 15.Â Configuration">ChapterÂ 15, <i>Configuration</i></a> for further examples.
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epService = EPServiceProviderManager.getDefaultProvider();
ConfigurationEventTypeXMLDOM sensorcfg = new ConfigurationEventTypeXMLDOM();
sensorcfg.setRootElementName("Sensor");
sensorcfg.setSchemaResource(schemaURL.toString());
epService.getEPAdministrator().getConfiguration()
    .addEventType("SensorEvent", sensorcfg);</pre><p>
				You must provide a root element name. This name is used to look up the event type for the <code class="literal">sendEvent(org.w3c.Node node)</code> method. An <code class="literal">EventSender</code> is a useful alternative method
				for sending events if the type lookup based on the root or document element name is not desired.
			</p><p>
				After adding the event type, you may create statements and send events. Next is a sample statement:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select ID, Observation.Command, Observation.ID, 
  Observation.Tag[0].ID, Observation.Tag[1].ID
from SensorEvent</pre><p>
				As you can see from the example above, property expressions can query property values held in the XML document's elements and attributes.
			</p><p>
				There are multiple ways to obtain a XML DOM document instance from a XML string. The next code snippet shows how to obtain a XML DOM <code class="literal">org.w3c.Document</code> instance:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">InputSource source = new InputSource(new StringReader(xml));
DocumentBuilderFactory builderFactory = DocumentBuilderFactory.newInstance();
builderFactory.setNamespaceAware(true);
Document doc = builderFactory.newDocumentBuilder().parse(source);</pre><p>
				Send the <code class="literal">org.w3c.Node</code> or <code class="literal">Document</code> object into the engine for processing:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epService.getEPRuntime().sendEvent(doc);</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="appendix_eventrepxml_schema-propertyexpr"/>H.2.2.Â Property Expressions and Namespaces</h3></div></div></div><p>
				By default, property expressions such as <code class="literal">Observation.Tag[0].ID</code> are evaluated by a fast DOM-walker implementation provided by Esper. This DOM-walker implementation is not namespace-aware.
			</p><p>
				Should you require namespace-aware traversal of the DOM document, you must set the <code class="literal">xpath-property-expr</code> configuration option to true (default is false). This flag causes Esper to generate namespace-aware XPath
				expressions from each property expression instead of the DOM-walker, as described next. Setting the <code class="literal">xpath-property-expr</code> option to true requires that you also configure namespace prefixes as described below.
			</p><p>
				When matching up the property names with the XSD schema information, the engine determines whether the attribute or element provides values. The algorithm checks attribute names first followed by element names. It takes the first match to the specified property name.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="appendix_eventrepxml_schema-propertyexpr-xpath"/>H.2.3.Â Property Expression to XPath Rewrite</h3></div></div></div><p>
				By setting the <code class="literal">xpath-property-expr</code> option the engine rewrites each property expression as an XPath expression, effectively handing the evaluation over to the underlying XPath implementation
				available from classpath. Most JVM have a built-in XPath implementation and there are also optimized, fast implementations such as Jaxen that can be used as well.
			</p><p>
				Set the <code class="literal">xpath-property-expr</code> option if you need namespace-aware document traversal, such as when your schema mixes several namespaces and element names are overlapping.
			</p><p>
				The below table samples several property expressions and the XPath expression generated for each, without namespace prefixes to keep the example simple:
			</p><div class="table"><a id="d0e55125"/><p class="title"><b>TableÂ H.1.Â Property Expression to XPath Expression</b></p><div class="table-contents"><table summary="Property Expression to XPath Expression" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Property Expression</th><th>Equivalent XPath</th></tr></thead><tbody><tr><td><code class="literal">Observeration.ID</code></td><td><code class="literal">/Sensor/Observation/ID</code></td></tr><tr><td><code class="literal">Observeration.Command</code></td><td><code class="literal">/Sensor/Observation/@Command</code></td></tr><tr><td><code class="literal">Observeration.Tag[0].ID</code></td><td><code class="literal">/Sensor/Observation/Tag[position() = 1]/ID</code></td></tr></tbody></table></div></div><br class="table-break"/><p> 
				For mapped properties that are specified via the syntax <code class="literal">name('key')</code>, the algorithm looks for an attribute by name <code class="literal">id</code> and generates a XPath expression as <code class="literal">mapped[@id='key']</code>.
			</p><p> 
				Finally, here is an example that includes all different types of properties and their XPath expression equivalent in one property expression:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select nested.mapped('key').indexed[1].attribute from MyEvent</pre><p> 
				The equivalent XPath expression follows, this time including <code class="literal">n0</code> as a sample namespace prefix:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">/n0:rootelement/n0:nested/n0:mapped[@id='key']/n0:indexed[position() = 2]/@attribute</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="appendix_eventrepxml_schema-propertyarray"/>H.2.4.Â Array Properties</h3></div></div></div><p>
				All elements that are unbound or have max occurs greater then 1 in the XSD schema are represented as indexed properties and require an index for resolution.
			</p><p>
				For example, the following is not a valid property expression in the sample Sensor document: <code class="literal">Observeration.Tag.ID</code>. As no index is provided for <code class="literal">Tag</code>, the property expression is not valid.
			</p><p>
				Repeated elements within a parent element in which the repeated element is a simple type also are represented as an array.
			</p><p>
				Consider the next XML document:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;item&gt;
&lt;book sku="8800090"&gt;
&lt;author&gt;Isaac Asimov&lt;/author&gt;
&lt;author&gt;Robert A Heinlein&lt;/author&gt;
&lt;/book&gt;
&lt;/item&gt;</pre><p>
				Here, the result of the expression <code class="literal">book.author</code> is an array of type String and the result of <code class="literal">book.author[0]</code> is a String value.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="appendix_eventrepxml_schema-propertydynamic"/>H.2.5.Â Dynamic Properties</h3></div></div></div><p>
				  Dynamic properties are not validated against the XSD schema information and their result value is always <code class="literal">org.w3c.Node</code>. You may use a user-defined function to process dynamic properties returning <code class="literal">Node</code>. As an alternative consider using an explicit property.
			</p><p>
				An example dynamic property is <code class="literal">Origin?.ID</code> which will look for an element by name <code class="literal">Origin</code> that contains an element or attribute node by name <code class="literal">LocationCode</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select Origin?.LocationCode from SensorEvent</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="appendix_eventrepxml_schema-propertytranspose"/>H.2.6.Â Transposing Properties</h3></div></div></div><p>
				When providing a XSD document, the default configuration allows to transpose property values that are themselves complex elements, as defined in the XSD schema, into a new stream. This behavior can be controlled via the flag <code class="literal">auto-fragment</code>.
			</p><p>
				For example, consider the next query:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into ObservationStream
select ID, Observation from SensorEvent</pre><p>
				The <code class="literal">Observation</code> as a property of the <code class="literal">SensorEvent</code> gets itself inserted into a new stream by name <code class="literal">ObservationStream</code>. The <code class="literal">ObservationStream</code>
				thus consists of a string-typed <code class="literal">ID</code> property and a complex-typed property named <code class="literal">Observation</code>, as described in the schema.
			</p><p>
				A further statement can use this stream to query:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select Observation.Command, Observation.Tag[0].ID from ObservationStream</pre><p>
				Before continuing the discussion, here is an alternative syntax using the wildcard-select, that is also useful:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into TagListStream
select ID as sensorId, Observation.* from SensorEvent</pre><p>
				The new <code class="literal">TagListStream</code> has a string-typed <code class="literal">ID</code> and <code class="literal">Command</code> property as well as an array of <code class="literal">Tag</code> properties that are complex types themselves as defined in the schema.
			</p><p>
				Next is a sample statement to query the new stream:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select sensorId, Command, Tag[0].ID from TagListStream</pre><p>
				Please note the following limitations:
			</p><div class="itemizedlist"><ul compact="compact"><li><p>
						The XPath standard prescribes that XPath expressions against <code class="literal">org.w3c.Node</code> are evaluated against the owner document of the <code class="literal">Node</code>. Therefore XPath is not relative to the current node but absolute against each node's owner document. Since Esper does not create new document instances for transposed nodes, transposing properties is not possible when the <code class="literal">xpath-property-expr</code> flag is set.
					</p></li><li><p>
						Complex elements that have both simple element values and complex child elements are not transposed. This is to ensure their property value is not hidden. Use an explicit XPath expression to transpose such properties.
					</p></li></ul></div><p>
				Esper automatically registers a new event type for transposed properties. It generates the type name of the new XML event type from the XML event type name and the property names used in the expression. The synposis is <span class="emphasis"><em>type_name.property_name[.property_name...]</em></span>. The type name can be looked up, for example for use with <code class="literal">EventSender</code> or can be created in advance.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="appendix_eventrepxml_eventsender"/>H.2.7.Â Event Sender</h3></div></div></div><p>
				An <code class="literal">EventSender</code> sends events into the engine for a given type, saving a type lookup based on element name.
			</p><p>
				This brief example sends an event via <code class="literal">EventSender</code>:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">EventSender sender = epRuntime.getEventSender("SensorEvent");
sender.sendEvent(node);</pre><p>
				The XML DOM event sender checks the root element name before processing the event. Use the <code class="literal">event-sender-validates-root</code> setting to disable validation. This forces the engine to process XML documents according to any predefined type without validation of the root element name.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="appendix_eventrepxml_limitations"/>H.2.8.Â Limitations</h3></div></div></div><p>
			   The engine schema interrogation is based on the Xerces distribution packaged into Sun Java runtimes. Your application may not replace the JRE's Xerces version and use XML schemas, unless your application sets the DOM implementation registry as shown below before loading the engine configuration:
		   </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">System.setProperty(DOMImplementationRegistry.PROPERTY, 
"com.sun.org.apache.xerces.internal.dom.DOMXSImplementationSourceImpl");</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepxml_noschema"/>H.3.Â No-Schema-Provided XML Events</h2></div></div></div><p>
		   Without a schema document a XML event may still be queried. However there are important differences in the metadata available without a schema document and therefore the property expression results. These differences are outlined below.
	   </p><p>
			All property expressions against a XML type without schema are assumed valid. There is no validation of the property expression other than syntax validation. At runtime, property expressions return string-type values or <code class="literal">null</code> if the expression did not
			yield a matching element or attribute result.
		</p><p>
			When asked for property names or property metadata, a no-schema type returns empty array.
		</p><p>
			In all other aspects the type behaves the same as the schema-provided type described earlier.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_eventrepxml_explicit"/>H.4.Â Explicitly-Configured Properties</h2></div></div></div><p>
		 Regardless of whether or not you provide a XSD schema for the XML event type, you can always fall back to configuring explicit properties that are backed by XPath expressions.
	   </p><p>
		 For further documentation on XPath, please consult the XPath standard or other online material. Consider using Jaxen or Apache Axiom, for example, to provide faster XPath evaluation then your Java VM built-in XPath provider may offer.
	   </p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="appendix_eventrepxml_explicit-simple"/>H.4.1.Â Simple Explicit Property</h3></div></div></div><p>
				Shown below is an example configuration that adds an explicit property backed by a XPath expression and that defines namespace prefixes:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">epService = EPServiceProviderManager.getDefaultProvider();
ConfigurationEventTypeXMLDOM sensorcfg = new ConfigurationEventTypeXMLDOM();
sensorcfg.addXPathProperty("countTags", "count(/ss:Sensor/ss:Observation/ss:Tag)", 
    XPathConstants.NUMBER);
sensorcfg.addNamespacePrefix("ss", "SensorSchema");
sensorcfg.setRootElementName("Sensor");
epService.getEPAdministrator().getConfiguration()
    .addEventType("SensorEvent", sensorcfg);</pre><p>
				The <code class="literal">countTags</code> property is now available for querying:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select countTags from SensorEvent</pre><p>
				The XPath expression <code class="literal">count(...)</code> is a XPath built-in function that counts the number of nodes, for the example document the result is <code class="literal">2</code>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="appendix_eventrepxml_explicit-casted"/>H.4.2.Â Explicit Property Casting and Parsing</h3></div></div></div><p>
				Esper can parse or cast the result of your XPath expression to the desired type. Your property configuration provides the type to cast to, like this:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">sensorcfg.addXPathProperty("countTags", "count(/ss:Sensor/ss:Observation/ss:Tag)", 
    XPathConstants.NUMBER, "int");</pre><p>
				The type supplied to the property configuration must be one of the built-in types. Arrays of built-in type are also possible, requiring the <code class="literal">XPathConstants.NODESET</code> type returned by your XPath expression, as follows:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">sensorcfg.addXPathProperty("idarray", "//ss:Tag/ss:ID", 
    XPathConstants.NODESET, "String[]");</pre><p>
				The XPath expression <code class="literal">//ss:Tag/ss:ID</code> returns all ID nodes under a Tag node, regardless of where in the node tree the element is located. For the example document the result is <code class="literal">2</code> array elements <code class="literal">urn:epc:1:2.24.400</code> and <code class="literal">urn:epc:1:2.24.40</code>.
			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="appendix_eventrepxml_explicit-node"/>H.4.3.Â Node and Nodeset Explicit Property</h3></div></div></div><p>
				An explicit property may return <code class="literal">XPathConstants.NODE</code> or <code class="literal">XPathConstants.NODESET</code> and can provide the event type name of a pre-configured event type for the property. The method name to add such properties is <code class="literal">addXPathPropertyFragment</code>.
			</p><p>
				This code snippet adds two explicit properties and assigns an event type name for each property:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">sensorcfg.addXPathPropertyFragment("tagOne", "//ss:Tag[position() = 1]", 
    XPathConstants.NODE, "TagEvent");
sensorcfg.addXPathPropertyFragment("tagArray", "//ss:Tag", 
    XPathConstants.NODESET, "TagEvent");</pre><p>
				The configuration above references the <code class="literal">TagEvent</code> event type. This type must also be configured. Prefix the root element name with "//" to cause the lookup to search the nested schema elements for the definition of the type:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">ConfigurationEventTypeXMLDOM tagcfg = new ConfigurationEventTypeXMLDOM();
tagcfg.setRootElementName("//Tag");
tagcfg.setSchemaResource(schemaURL);
epAdministrator.getConfiguration()
    .addEventType("TagEvent", tagcfg);</pre><p>
				The <code class="literal">tagOne</code> and <code class="literal">tagArray</code> properties are now ready for selection and transposing to further streams:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into TagOneStream select tagOne.* from SensorEvent</pre><p>
				Select from the new stream:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select ID from TagOneStream</pre><p>
				An example with indexed properties is shown next:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">insert into TagArrayStream select tagArray as mytags from SensorEvent</pre><p>
				Select from the new stream:
			</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">select mytags[0].ID from TagArrayStream</pre></div></div></div><div class="appendix" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet"/>AppendixÂ I.Â NEsper .NET -Specific Information</h2></div></div></div><p>
		This section provides information for NEsper .NET users. 
    </p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet_general"/>I.1.Â .NET General Information</h2></div></div></div><p>
			<code class="literal">System.Collections.IEnumerable</code> and <code class="literal">System.Collections.Generic.IEnumerable&lt;T&gt;</code> are honored in most places where a collection would be taken.
		</p><p>
			In respect to <code class="literal">DateTime</code> differences, the baseline for CLR datetimes is <code class="literal">1/1/0001 12:00:00AM</code>. DateTimes are converted to ticks and then to milliseconds.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet_annotation"/>I.2.Â .NET and Annotations</h2></div></div></div><p>
			Annotations are implemented using .NET attributes. Annotations must derive from <code class="literal">System.Attribute</code> and must use .NET attribute naming conventions e.g. <code class="literal">@Hint</code> is implemented as <code class="literal">HintAttribute</code>.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet_locksconcurrency"/>I.3.Â .NET and Locks and Concurrency</h2></div></div></div><p>
			NEsper provides a lock manager that is configurable once per AppDomain: <code class="literal">com.espertech.esper.compat.threading.LockManager</code> is used for lock provision. 
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					Standard system locks are the default.
				</p></li><li><p>
					Spinlocks &amp; Slimlocks may be used.
				</p></li><li><p>
					Custom lock implementations can be leveraged.
				</p></li></ul></div><p>
			<code class="literal">com.espertech.esper.compat.threading.ReaderWriterLockManager</code> is used for RW lock management.
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					Standard reader writer locks are the default.
				</p></li><li><p>
					SlimReaderWriter locks are provided.
				</p></li><li><p>
					Fair &amp; FIFO ReaderWriter lock implementations are provided.
				</p></li></ul></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet_threading"/>I.4.Â .NET and Threading</h2></div></div></div><p>
			<code class="literal">com.espertech.esper.compat.threading.ThreadLocalManager</code> is used for thread local management.
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					Fast thread local implementation is the default - not .NET standard.
				</p></li><li><p>
					Standard implementation is available - however, it is found significantly slower.
				</p></li></ul></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet_configuration"/>I.5.Â .NET NEsper Configuration</h2></div></div></div><p>
			<code class="literal">com.espertech.esper.util.EsperSectionHandler</code> is provided to read Esper configuration from standard .NET configuration. It must be added as a <code class="literal">configSection</code> in order to be used.
		</p><p>
			For items not handled under the Esper configuration use <code class="literal">com.espertech.esper.compat.CompatSettings</code>.
			These are often applied for the entire AppDomain meaning they are effectively static for the container.
			These cover the following items:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					<code class="literal">DefaultLockType</code>.
				</p></li><li><p>
					<code class="literal">DefaultReaderWriterLockType</code>.
				</p></li><li><p>
					<code class="literal">MonitorLockTimeout</code>.
				</p></li><li><p>
					<code class="literal">ReaderLockTimeout</code>.
				</p></li><li><p>
					<code class="literal">WriterLockTimeout</code>.
				</p></li><li><p>
					<code class="literal">DefaultThreadLocalType</code>.
				</p></li></ul></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet_eventrep_intro"/>I.6.Â .NET Event Underlying Objects</h2></div></div></div><div class="table"><a id="d0e55603"/><p class="title"><b>TableÂ I.1.Â Event Underlying .NET Objects</b></p><div class="table-contents"><table summary="Event Underlying .NET Objects" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Java Class</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">System.Object</code></td><td>Any .NET object with properties.</td></tr><tr><td><code class="literal">System.Collections.Generic.IDictionary</code></td><td>Map events are implementations of the <code class="literal">IDictionary</code> interface where each map entry is a propery value.</td></tr><tr><td><code class="literal">System.Array, System.Object[] (array of object)</code></td><td>Object-array events are arrays of objects (type <code class="literal">Object[]</code>) where each array element is a property value.</td></tr><tr><td><code class="literal">System.Xml.XmlNode</code> and <code class="literal">System.Xml.Linq.XNode</code></td><td>XML document object model (DOM).</td></tr><tr><td>Application classes</td><td>Plug-in event representation via the extension API.</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet_eventrep_javabean"/>I.7.Â .NET Object Events</h2></div></div></div><p>
			Event classes provide accessors (getter methods) and mutators (setter methods) by means of auto-implemented properties or read write properties.
		</p><p>
			Below an example using auto-implemented properties:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">class NewEmployeeEvent {
  public string FirstName { get; set; }
  public Address Address { get; set; }	
}</pre><p>
			Below an example using read write properties:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">class NewEmployeeEvent {
  private string firstName = "N/A";
  private Address address = 0;

  public string FirstName
  {
    get
    {
      return firstName;
    }
    set
    {
      firstName = value;
    }
  }

  public Address Address
  {
    get
    {
      return address;
    }
    set
    {
      address = value;
    }
  }
}</pre><p>
		  The case conversion is uppercase as dictated by .NET property conventions.
		</p><p>
			Mapped indexes are handled through the indexing operator.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet_eventrep_map"/>I.8.Â .NET IDictionary Events</h2></div></div></div><p>
			For .NET the events can be represented by objects that implement the <code class="literal">IDictionary</code> interface.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet_eventrep_xml"/>I.9.Â .NET XML Events</h2></div></div></div><p>
			XML events are represented by <code class="literal">System.Xml</code> and <code class="literal">System.Xml.Linq</code>.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet_eventrep_insertinto"/>I.10.Â .NET Event Objects Instantiated and Populated by <code class="literal">Insert Into</code></h2></div></div></div><p>
			Objects need to follow the .NET property conventions. Objects can follow modified conventions for Java-style accessors and mutators using Get and Set respectively.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet_processingmodel_intro"/>I.11.Â .NET Basic Concepts</h2></div></div></div><p>
			There are no differences between Esper and NEsper in respect to basic concepts.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet_epl_syntax_datatype"/>I.12.Â .NET EPL Syntax - Data Types</h2></div></div></div><p>
			The data types are <code class="literal">sbyte</code>, <code class="literal">byte</code>, <code class="literal">short</code>, <code class="literal">ushort</code>, <code class="literal">int</code>, <code class="literal">uint</code>, <code class="literal">long</code>, <code class="literal">ulong</code>, <code class="literal">float</code>, <code class="literal">double</code>, <code class="literal">decimal</code>.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet_histdata_overview"/>I.13.Â .NET Accessing Relational Data via SQL</h2></div></div></div><p>
		.NET uses ADO-based drivers to accomplish the same work.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet_api_receive_results"/>I.14.Â .NET API - Receiving Statement Results</h2></div></div></div><p>
			NEsper exposes the Events <code class="literal">events</code> on <code class="literal">EPStatement</code> objects.
		</p><p>
			<code class="literal">UpdateListener</code> is replaced by <code class="literal">UpdateEventHandler</code> in .NET. Subscriber objects must implement the <code class="literal">Update</code> method 
			or subscriber objects must be a delegate with an appropriate number of arguments.
		</p><p>
			The <code class="literal">setSubscriber</code> method is replaced with the <code class="literal">Subscriber</code> property. This property can take an object or a delegate.
		</p><p>
			<code class="literal">Iterator</code> is replaced with <code class="literal">GetEnumerator</code>. <code class="literal">SafeIterator</code> is replaced with <code class="literal">GetSafeEnumerator</code>.
		</p><p>
			In NEsper you can assign a delegate to a subscriber using lamba this way:
		</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">statement.Subscriber = new Action&lt;TradeReportEvent, NesperTest&gt;((a, b) =&gt; {
  Debug.Print("got here");
});</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet_api_admin_listeners"/>I.15.Â .NET API - Adding Listeners</h2></div></div></div><p>
			Listeners are replaced with <code class="literal">UpdateEventHandlers</code>, for example <code class="literal">countStatement.Events += (sender, args) =&gt; { DoWork(); }</code>.
		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet_api_threading"/>I.16.Â .NET API - Engine Threading and Concurrency</h2></div></div></div><p>
			When using internal timer (and not the application provided external time), please note:
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					Windows uses a high resolution timer that uses the windows multimedia timers with a resolution of 1 millisecond. High resolution timers are cleaned up when the AppDomain is disposed.
				</p></li><li><p>
					If using Mono, Mono uses an internal timer that attempts to account for clock skew and drift.
				</p></li></ul></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet_config_database_ref"/>I.17.Â .NET Configurations - Relational Database Access</h2></div></div></div><p>
			Connections are obtained by selecting a <code class="literal">DbDriver</code>, which are a NEsper-construct. 
		</p><div class="itemizedlist"><ul compact="compact"><li><p>
					<code class="literal">DbDriverGeneric</code>: Positional or name based driver that must be completely configured prior to use.
				</p></li><li><p>
					<code class="literal">DbDriverMySQL</code>: Positional based driver that uses '?' prefix.
				</p></li><li><p>
					<code class="literal">DbDriverODBC</code>: Positional based driver that uses '?' prefix.
				</p></li><li><p>
					<code class="literal">DbDriverSqlServer</code>: Translates positional into named-based SqlParameters with '@' prefix.
				</p></li></ul></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix_dotnet_configuration_logging"/>I.18.Â .NET Configurations - Logging Configuration</h2></div></div></div><p>
			Log4j is replaced by .NET Commons Logging.
		</p></div></div><div class="index"><div class="titlepage"><div><div><h2 class="title"><a id="d0e55854"/>Index</h2></div></div></div><div class="index"><div class="indexdiv"><h3>Symbols</h3><dl><dt>-&gt; pattern operator, <a class="indexterm" href="#pattern-temporal-followed-by">Followed-By</a></dt></dl></div><div class="indexdiv"><h3>A</h3><dl><dt>after, <a class="indexterm" href="#epl-output-suppress">Suppressing Output With After</a></dt><dt>aggregation functions</dt><dd><dl><dt>custom plug-in, <a class="indexterm" href="#custom-aggregation-function">Aggregation Function</a></dt><dt>overview, <a class="indexterm" href="#epl-function-aggregation">Aggregation Functions</a></dt></dl></dd><dt>and pattern operator, <a class="indexterm" href="#pattern-logical-and">And</a></dt><dt>annotation, <a class="indexterm" href="#epl-syntax-annotation">Annotation</a></dt><dd><dl><dt>application-provided, <a class="indexterm" href="#epl-syntax-annotation-application">Application-Provided Annotations</a></dt><dt>builtin, <a class="indexterm" href="#epl-syntax-annotation-builtin">Built-In Statement Annotations</a></dt><dt>enumeration value, <a class="indexterm" href="#epl-syntax-annotation-withenum">Annotations With Enumeration Values</a></dt><dt>interrogating, <a class="indexterm" href="#api-annotation">Interrogating EPL Annotations</a></dt></dl></dd><dt>API</dt><dd><dl><dt>testing, <a class="indexterm" href="#api-testing">Test and Assertion Support</a></dt></dl></dd><dt>arithmetic operators, <a class="indexterm" href="#epl-operator-ref-arithmetic">Arithmetic Operators</a></dt><dt>array definition operator, <a class="indexterm" href="#epl-operator-ref-array">Array Definition Operator</a></dt><dt>avro event representation, <a class="indexterm" href="#appendix_eventrepavro">Event Representation: Avro Events (org.apache.avro.generic.GenericData.Record)</a></dt></dl></div><div class="indexdiv"><h3>B</h3><dl><dt>between operator, <a class="indexterm" href="#epl-operator-ref-keyword-between">The 'Between' Keyword</a></dt><dt>binary operators, <a class="indexterm" href="#epl-operator-ref-binary">Binary Operators</a></dt><dt>byte code generation</dt><dd><dl><dt>overview, <a class="indexterm" href="#bytecodegen_intro">Introduction</a></dt><dt>usage, <a class="indexterm" href="#bytecodegen_usage">Usage Notes</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>C</h3><dl><dt>case control flow function, <a class="indexterm" href="#epl-single-row-function-ref-case">The Case Control Flow Function</a></dt><dt>cast function, <a class="indexterm" href="#epl-single-row-function-cast">The Cast Function</a></dt><dd><dl><dt>date parsing, <a class="indexterm" href="#epl-single-row-function-cast-parsedate">The Cast Function For Parsing Dates</a></dt></dl></dd><dt>class loader, <a class="indexterm" href="#api-osgi">OSGi, Class Loader, Class-For-Name</a></dt><dt>class name resolution, <a class="indexterm" href="#api-osgi">OSGi, Class Loader, Class-For-Name</a></dt><dt>coalesce function, <a class="indexterm" href="#epl-single-row-function-ref-coalesce">The Coalesce Function</a></dt><dt>concatenation operators, <a class="indexterm" href="#epl-operator-ref-string">Concatenation Operators</a></dt><dt>configuration</dt><dd><dl><dt>items to configure, <a class="indexterm" href="#configuration-items">Configuration Items</a></dt><dt>logging, <a class="indexterm" href="#configuration-logging">Logging Configuration</a></dt><dt>overview, <a class="indexterm" href="#configuration">Configuration</a></dt><dt>programmatic, <a class="indexterm" href="#configuration-programmatic">Programmatic Configuration</a></dt><dt>runtime, <a class="indexterm" href="#api-admin-runtime-config">Runtime Configuration</a>, <a class="indexterm" href="#configuration-runtime">Runtime Configuration</a></dt><dt>transient, <a class="indexterm" href="#configuration-transientobjects">Passing Services or Transient Objects</a></dt><dt>via XML, <a class="indexterm" href="#configuration-via-xml">Configuration via XML File</a></dt></dl></dd><dt>Configuration class, <a class="indexterm" href="#configuration">Configuration</a></dt><dt>constants, <a class="indexterm" href="#epl-syntax-datatype-constants">Data Type of Constants</a>, <a class="indexterm" href="#epl-syntax-javaconst">Using Constants and Enum Types</a></dt><dt>context partition, <a class="indexterm" href="#api-contextpartitionadmin">Context Partition Administration</a></dt><dt>correlation, <a class="indexterm" href="#view-stat-correl">Correlation Derived-Value Window (correl or stat:correl)</a></dt><dt>create expression, <a class="indexterm" href="#create-exprglobal">Declaring Global Expressions, Aliases and Scripts: Create Expression</a></dt><dt>create index, <a class="indexterm" href="#named_explicit_index">Explicitly Indexing Named Windows and Tables</a></dt><dt>create schema, <a class="indexterm" href="#epl_createschema">Declaring an Event Type: Create Schema</a></dt><dt>create window, insert, <a class="indexterm" href="#named_populate_named">Populating a Named Window From an Existing Named Window</a></dt><dt>current_evaluation_context, <a class="indexterm" href="#epl-single-row-function-ref-currentevaluationcontext">The Current_Evaluation_Context Function</a></dt><dt>current_timestamp function, <a class="indexterm" href="#epl-single-row-function-ref-currenttime">The Current_Timestamp Function</a></dt></dl></div><div class="indexdiv"><h3>D</h3><dl><dt>data types, <a class="indexterm" href="#epl-syntax-datatype">Data Types</a></dt><dt>data window</dt><dd><dl><dt>correlation, <a class="indexterm" href="#view-stat-correl">Correlation Derived-Value Window (correl or stat:correl)</a></dt><dt>custom plug-in view, <a class="indexterm" href="#custom-views">Derived-Value and Data Window View</a></dt><dt>expiry expression batch window, <a class="indexterm" href="#view-win-exprbatch">Expiry Expression Batch Window (expr_batch or win:expr_batch)</a></dt><dt>expiry expression window, <a class="indexterm" href="#view-win-expr">Expiry Expression Window (expr or win:expr)</a></dt><dt>externally-time batch window, <a class="indexterm" href="#view-win-ext-time-batch">Externally-timed Batch Window (ext_timed_batch or win:ext_timed_batch)</a></dt><dt>externally-timed window, <a class="indexterm" href="#view-win-ext_time">Externally-timed Window (ext_timed or win:ext_timed)</a></dt><dt>first event, <a class="indexterm" href="#view-std-first">First Event Window (firstevent or std:firstevent)</a></dt><dt>first length window, <a class="indexterm" href="#view-win-firstlength">First Length Window(firstlength or win:firstlength)</a></dt><dt>first time window, <a class="indexterm" href="#view-win-firsttime">First Time Window (firsttime or win:firsttime)</a></dt><dt>first unique window, <a class="indexterm" href="#view-std-firstunique">First Unique Window (firstunique or std:firstunique)</a></dt><dt>grouped data window, <a class="indexterm" href="#view-std-groupwin">Grouped Data Window (groupwin or std:groupwin)</a></dt><dt>keep-all window, <a class="indexterm" href="#view-win-keepall">Keep-All Window (keepall or win:keepall)</a></dt><dt>last event window, <a class="indexterm" href="#view-std-last">Last Event Window (std:lastevent)</a></dt><dt>length batch window, <a class="indexterm" href="#view-win-length-batch">Length Batch Window (length_batch or win:length_batch)</a></dt><dt>length window, <a class="indexterm" href="#view-win-length">Length Window (length or win:length)</a></dt><dt>overview, <a class="indexterm" href="#epl-views">EPL Reference: Data Windows</a></dt><dt>ranked window, <a class="indexterm" href="#view-ext-rank">Ranked Window (rank or ext:rank)</a></dt><dt>regression, <a class="indexterm" href="#view-stat-linest">Regression Derived-Value Window (linest or stat:linest)</a></dt><dt>size window, <a class="indexterm" href="#view-std-size">Size Derived-Value Window (size) or std:size)</a></dt><dt>sorted window, <a class="indexterm" href="#view-ext-sort">Sorted Window (sort or ext:sort)</a></dt><dt>time batch window, <a class="indexterm" href="#view-win-time-batch">Time batch Window (time_batch or win:time_batch)</a></dt><dt>time length batch window, <a class="indexterm" href="#view-win-time-length-batch">Time-Length Combination Batch Window (time_length_batch or win:time_length_batch)</a></dt><dt>time window, <a class="indexterm" href="#view-win-time">Time Window (time or win:time)</a></dt><dt>time-accumulating window, <a class="indexterm" href="#view-win-time-accumulating">Time-Accumulating Window (time_accum or win:time_accum)</a></dt><dt>time-order window, <a class="indexterm" href="#view-time-order">Time-Order Window (time_order or ext:time_order)</a></dt><dt>time-to-live window, <a class="indexterm" href="#view-timetolive">Time-To-Live Window (timetolive or ext:timetolive)</a></dt><dt>unique window, <a class="indexterm" href="#view-std-unique">Unique Window (unique or std:unique)</a></dt><dt>univariate statistics, <a class="indexterm" href="#view-stat-uni">Univariate Statistics Derived-Value Window (uni or stat:uni)</a></dt><dt>weighted average, <a class="indexterm" href="#view-stat-weightedavg">Weighted Average Derived-Value Window (weighted_avg or stat:weighted_avg)</a></dt></dl></dd><dt>dataflow, <a class="indexterm" href="#dataflow-intro">Introduction</a></dt><dt>decorated event, <a class="indexterm" href="#insert-into-decorated">Decorated Events</a></dt><dt>delete, <a class="indexterm" href="#named_delete_faf">Deleting Data</a></dt><dt>deployment</dt><dd><dl><dt>EPDeploymentAdmin interface, <a class="indexterm" href="#devlifecycle-admin">The Deployment Administrative Interface</a></dt><dt>EPL module, <a class="indexterm" href="#devlifecycle-eplmodule">EPL Modules</a></dt><dt>J2EE, <a class="indexterm" href="#devlifecycle-j2ee">J2EE Packaging and Deployment</a></dt></dl></dd><dt>derived-value window</dt><dd><dl><dt>overview, <a class="indexterm" href="#epl-views">EPL Reference: Data Windows</a></dt></dl></dd><dt>dot operator, <a class="indexterm" href="#epl-operator-ref-dot">Dot Operator</a></dt><dt>duck typing, <a class="indexterm" href="#epl-operator-ref-dot">Dot Operator</a></dt><dt>dynamic event properties, <a class="indexterm" href="#eventrep-dyncproperties">Dynamic Event Properties</a></dt></dl></div><div class="indexdiv"><h3>E</h3><dl><dt>enum types, <a class="indexterm" href="#epl-syntax-javaconst">Using Constants and Enum Types</a></dt><dt>EPAdministrator interface, <a class="indexterm" href="#api-administrative">The Administrative Interface</a></dt><dt>EPL</dt><dd><dl><dt>from clause, <a class="indexterm" href="#epl-from-clause">Specifying Event Streams: The From Clause</a></dt><dt>group by clause, <a class="indexterm" href="#epl-grouping-group-by">Organizing Statement Results into Groups: The Group-by Clause</a></dt><dt>having clause, <a class="indexterm" href="#epl-grouping-having">Selecting Groups of Events: The Having Clause</a></dt><dt>inner join, <a class="indexterm" href="#epl-outerjoin">Outer, Left and Right Joins</a></dt><dt>insert into clause, <a class="indexterm" href="#epl-insert-into">Merging Streams and Continuous Insertion: The Insert Into Clause</a></dt><dt>join, <a class="indexterm" href="#epl-join">Joining Event Streams</a></dt><dt>join, unidirectional, <a class="indexterm" href="#epl-unidirectional">Unidirectional Joins</a></dt><dt>joining non-relational data via method, script or UDF invocation, <a class="indexterm" href="#joining_method">Accessing Non-Relational Data via Method, Script or UDF Invocation</a></dt><dt>joining relational data via SQL, <a class="indexterm" href="#histdata_overview">Accessing Relational Data via SQL</a></dt><dt>limit clause, <a class="indexterm" href="#epl-limit">Limiting Row Count: the Limit Clause</a></dt><dt>named window, <a class="indexterm" href="#nwtable-overview-namedwindow">Named Window Overview</a></dt><dd><dl><dt>deleting from, <a class="indexterm" href="#named_delete">Deleting Data: The On Delete Clause</a>, <a class="indexterm" href="#named_delete_faf">Deleting Data</a></dt><dt>inserting into, <a class="indexterm" href="#named_inserting">Inserting Into Named Windows</a>, <a class="indexterm" href="#named_insertfaf">Inserting Data</a></dt><dt>populating from a named window, <a class="indexterm" href="#named_populate_named">Populating a Named Window From an Existing Named Window</a></dt><dt>selecting from, <a class="indexterm" href="#named_selecting">Selecting From Named Windows</a></dt><dt>triggered select and delete using On Select Delete, <a class="indexterm" href="#named_selectdelete">Triggered Select+Delete: The On Select Delete Clause</a></dt><dt>triggered select using On Select, <a class="indexterm" href="#named_querying">Triggered Select: The On Select Clause</a></dt><dt>updating, <a class="indexterm" href="#named_update">Updating Data: The On Update Clause</a>, <a class="indexterm" href="#named_update_faf">Updating Data</a></dt></dl></dd><dt>order by clause, <a class="indexterm" href="#epl-order-by">Sorting Output: the Order By Clause</a></dt><dt>outer join, <a class="indexterm" href="#epl-outerjoin">Outer, Left and Right Joins</a></dt><dt>outer join, unidirectional, <a class="indexterm" href="#epl-unidirectional">Unidirectional Joins</a>, <a class="indexterm" href="#epl-unidirectional-fullouterjoin">Unidirectional Full Outer Joins</a></dt><dt>output control and stabilizing, <a class="indexterm" href="#epl-output-rate">Stabilizing and Controlling Output: The Output Clause</a></dt><dt>select clause, <a class="indexterm" href="#epl-select-list">Choosing Event Properties and Events: The Select Clause</a></dt><dt>subqueries, <a class="indexterm" href="#epl-subqueries">Subqueries</a></dt><dt>table, <a class="indexterm" href="#nwtable-overview-table">Table Overview</a></dt><dd><dl><dt>inserting into, <a class="indexterm" href="#nwtable-insert">Inserting Into Tables</a></dt><dt>selecting from, <a class="indexterm" href="#nwtable-table-selecting">Selecting From Tables</a></dt></dl></dd><dt>variable, <a class="indexterm" href="#variables_overview">Variables and Constants</a></dt><dt>where clause, <a class="indexterm" href="#epl-where-clause">Specifying Search Conditions: The Where Clause</a></dt></dl></dd><dt>EPRuntime interface, <a class="indexterm" href="#api-runtime">The Runtime Interface</a></dt><dt>EPServiceProviderManager class, <a class="indexterm" href="#api-engine-instances">The Service Provider Interface</a></dt><dt>EPStatement interface, <a class="indexterm" href="#api-administrative">The Administrative Interface</a></dt><dt>EPStatementObjectModel interface, <a class="indexterm" href="#api-soda">Statement Object Model</a></dt><dt>escape, <a class="indexterm" href="#epl-syntax-escapestring">Escaping Strings</a></dt><dt>event</dt><dd><dl><dt>additional representations, <a class="indexterm" href="#eventrep-plug-in">Additional Event Representations</a></dt><dt>Avro representation, <a class="indexterm" href="#appendix_eventrepavro">Event Representation: Avro Events (org.apache.avro.generic.GenericData.Record)</a></dt><dt>bulk, <a class="indexterm" href="#eventrep-coarse">Coarse-Grained Events</a></dt><dt>coarse, <a class="indexterm" href="#eventrep-coarse">Coarse-Grained Events</a></dt><dt>dynamic properties, <a class="indexterm" href="#eventrep-dyncproperties">Dynamic Event Properties</a></dt><dt>insert into, <a class="indexterm" href="#eventrep-insertinto">Event Objects Instantiated and Populated by Insert Into</a></dt><dt>Java object, <a class="indexterm" href="#appendix_eventrepbean">Event Representation: Plain-Old Java Object Events</a></dt><dt>Map representation, <a class="indexterm" href="#appendix_eventrepmap">Event Representation: java.util.Map Events</a></dt><dt>Object-array representation, <a class="indexterm" href="#appendix_eventrepoa">Event Representation: Object-Array (Object[]) Events</a></dt><dt>properties, <a class="indexterm" href="#eventrep-properties">Event Properties</a></dt><dt>underlying representation, <a class="indexterm" href="#eventrep_intro">Event Underlying Java Objects</a></dt><dt>update, <a class="indexterm" href="#eventrep-update">Updating, Merging and Versioning Events</a></dt><dt>version, <a class="indexterm" href="#eventrep-update">Updating, Merging and Versioning Events</a></dt><dt>XML representation, <a class="indexterm" href="#appendix_eventrepxml">Event Representation: org.w3c.dom.Node XML Events</a></dt></dl></dd><dt>event as a property, <a class="indexterm" href="#insert-into-eventasproperty">Event as a Property</a></dt><dt>event object</dt><dd><dl><dt>custom, <a class="indexterm" href="#custom-event-representation">Event Type and Event Object</a></dt></dl></dd><dt>event time, <a class="indexterm" href="#api-controlling-time">Controlling Time-Keeping</a></dt><dt>event type</dt><dd><dl><dt>declaring, <a class="indexterm" href="#epl_createschema">Declaring an Event Type: Create Schema</a></dt></dl></dd><dt>EventBean interface, <a class="indexterm" href="#api-event">Event and Event Type</a></dt><dt>EventType interface, <a class="indexterm" href="#api-event">Event and Event Type</a></dt><dt>every pattern operator, <a class="indexterm" href="#pattern-logical-every">Every</a></dt><dt>every-distinct pattern operator, <a class="indexterm" href="#pattern-logical-everydistinct">Every-Distinct</a></dt><dt>exists function, <a class="indexterm" href="#epl-single-row-function-exists">The Exists Function</a></dt><dt>expression</dt><dd><dl><dt>declaring, <a class="indexterm" href="#create-exprglobal">Declaring Global Expressions, Aliases and Scripts: Create Expression</a></dt></dl></dd><dt>expression alias, <a class="indexterm" href="#epl-syntax-expression-alias">Expression Alias</a></dt><dt>expression batch window, <a class="indexterm" href="#view-win-exprbatch">Expiry Expression Batch Window (expr_batch or win:expr_batch)</a></dt><dt>expression declaration, <a class="indexterm" href="#epl-syntax-expression-decl">Expression Declaration</a></dt><dt>expression window, <a class="indexterm" href="#view-win-expr">Expiry Expression Window (expr or win:expr)</a></dt><dt>external time, <a class="indexterm" href="#api-controlling-time">Controlling Time-Keeping</a></dt><dt>externally-timed batch window, <a class="indexterm" href="#view-win-ext-time-batch">Externally-timed Batch Window (ext_timed_batch or win:ext_timed_batch)</a></dt><dt>externally-timed window, <a class="indexterm" href="#view-win-ext_time">Externally-timed Window (ext_timed or win:ext_timed)</a></dt></dl></div><div class="indexdiv"><h3>F</h3><dl><dt>first event, <a class="indexterm" href="#view-std-first">First Event Window (firstevent or std:firstevent)</a></dt><dt>first length window, <a class="indexterm" href="#view-win-firstlength">First Length Window(firstlength or win:firstlength)</a></dt><dt>first time window, <a class="indexterm" href="#view-win-firsttime">First Time Window (firsttime or win:firsttime)</a></dt><dt>first unique window, <a class="indexterm" href="#view-std-firstunique">First Unique Window (firstunique or std:firstunique)</a></dt><dt>followed-by pattern operator, <a class="indexterm" href="#pattern-temporal-followed-by">Followed-By</a></dt><dt>from clause, <a class="indexterm" href="#epl-from-clause">Specifying Event Streams: The From Clause</a></dt><dt>functions</dt><dd><dl><dt>case control flow, <a class="indexterm" href="#epl-single-row-function-ref-case">The Case Control Flow Function</a></dt><dt>cast, <a class="indexterm" href="#epl-single-row-function-cast">The Cast Function</a></dt><dt>coalesce, <a class="indexterm" href="#epl-single-row-function-ref-coalesce">The Coalesce Function</a></dt><dt>current_evaluation_context, <a class="indexterm" href="#epl-single-row-function-ref-currentevaluationcontext">The Current_Evaluation_Context Function</a></dt><dt>current_timestamp, <a class="indexterm" href="#epl-single-row-function-ref-currenttime">The Current_Timestamp Function</a></dt><dt>exists, <a class="indexterm" href="#epl-single-row-function-exists">The Exists Function</a></dt><dt>grouping, <a class="indexterm" href="#epl-single-row-function-grouping">The Grouping Function</a></dt><dt>grouping_id, <a class="indexterm" href="#epl-single-row-function-groupingid">The Grouping_Id Function</a></dt><dt>instance-of, <a class="indexterm" href="#epl-single-row-function-instanceof">The Instance-Of Function</a></dt><dt>istream, <a class="indexterm" href="#epl-single-row-function-istream">The Istream Function</a></dt><dt>max, <a class="indexterm" href="#epl-single-row-function-ref-minmax">The Min and Max Functions</a></dt><dt>min, <a class="indexterm" href="#epl-single-row-function-ref-minmax">The Min and Max Functions</a></dt><dt>previous, <a class="indexterm" href="#epl-single-row-function-ref-previous">The Previous Function</a></dt><dt>previous count, <a class="indexterm" href="#epl-single-row-function-ref-previouscount">The Previous-Count Function</a></dt><dt>previous tail, <a class="indexterm" href="#epl-single-row-function-ref-previoustail">The Previous-Tail Function</a></dt><dt>previous window, <a class="indexterm" href="#epl-single-row-function-ref-previouswindow">The Previous-Window Function</a></dt><dt>prior, <a class="indexterm" href="#epl-single-row-function-ref-prior">The Prior Function</a></dt><dt>type-of, <a class="indexterm" href="#epl-single-row-function-typeof">The Type-Of Function</a></dt><dt>user-defined, <a class="indexterm" href="#epl-single-row-function-ref">Single-Row Function Reference</a>, <a class="indexterm" href="#epl-function-user-defined">User-Defined Functions</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>G</h3><dl><dt>group by clause, <a class="indexterm" href="#epl-grouping-group-by">Organizing Statement Results into Groups: The Group-by Clause</a></dt><dt>grouping function, <a class="indexterm" href="#epl-single-row-function-grouping">The Grouping Function</a></dt><dt>grouping_id function, <a class="indexterm" href="#epl-single-row-function-groupingid">The Grouping_Id Function</a></dt><dt>groupwin window, <a class="indexterm" href="#view-std-groupwin">Grouped Data Window (groupwin or std:groupwin)</a></dt></dl></div><div class="indexdiv"><h3>H</h3><dl><dt>having clause, <a class="indexterm" href="#epl-grouping-having">Selecting Groups of Events: The Having Clause</a></dt></dl></div><div class="indexdiv"><h3>I</h3><dl><dt>in set operator, <a class="indexterm" href="#epl-operator-ref-keyword-in">The 'In' Keyword</a></dt><dt>index</dt><dd><dl><dt>spatial, <a class="indexterm" href="#spatial_index">Spatial Index - Quadtree</a></dt></dl></dd><dt>inner join, <a class="indexterm" href="#epl-outerjoin">Outer, Left and Right Joins</a></dt><dt>insert, <a class="indexterm" href="#named_insertfaf">Inserting Data</a></dt><dt>insert into clause, <a class="indexterm" href="#epl-insert-into">Merging Streams and Continuous Insertion: The Insert Into Clause</a></dt><dt>instance-of function, <a class="indexterm" href="#epl-single-row-function-instanceof">The Instance-Of Function</a></dt><dt>istream, <a class="indexterm" href="#epl-single-row-function-istream">The Istream Function</a></dt><dt>iterator, <a class="indexterm" href="#api-admin-iterators">Using Iterators</a></dt></dl></div><div class="indexdiv"><h3>J</h3><dl><dt>JavaScript, <a class="indexterm" href="#script-overview">Overview</a></dt><dt>join, <a class="indexterm" href="#epl-join">Joining Event Streams</a></dt><dd><dl><dt>from clause, <a class="indexterm" href="#epl-from-clause">Specifying Event Streams: The From Clause</a></dt><dt>non-relational data via method, script or UDF invocation, <a class="indexterm" href="#joining_method">Accessing Non-Relational Data via Method, Script or UDF Invocation</a></dt><dt>relational data via SQL, <a class="indexterm" href="#histdata_overview">Accessing Relational Data via SQL</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>K</h3><dl><dt>keep-all window, <a class="indexterm" href="#view-win-keepall">Keep-All Window (keepall or win:keepall)</a></dt><dt>keywords, <a class="indexterm" href="#epl-syntax-keywords">Reserved Keywords</a></dt></dl></div><div class="indexdiv"><h3>L</h3><dl><dt>lambda</dt><dd><dl><dt>expression alias, <a class="indexterm" href="#epl-syntax-expression-alias">Expression Alias</a></dt><dt>expression declaration, <a class="indexterm" href="#epl-syntax-expression-decl">Expression Declaration</a></dt></dl></dd><dt>last event window, <a class="indexterm" href="#view-std-last">Last Event Window (std:lastevent)</a></dt><dt>length batch window, <a class="indexterm" href="#view-win-length-batch">Length Batch Window (length_batch or win:length_batch)</a></dt><dt>length window, <a class="indexterm" href="#view-win-length">Length Window (length or win:length)</a></dt><dt>like operator, <a class="indexterm" href="#epl-operator-ref-keyword-like">The 'Like' Keyword</a></dt><dt>limit clause, <a class="indexterm" href="#epl-limit">Limiting Row Count: the Limit Clause</a></dt><dt>limiting output row count, <a class="indexterm" href="#epl-limit">Limiting Row Count: the Limit Clause</a></dt><dt>literals, <a class="indexterm" href="#epl-syntax-datatype-constants">Data Type of Constants</a></dt><dt>logical and comparison operators, <a class="indexterm" href="#epl-operator-ref-logical">Logical and Comparison Operators</a></dt></dl></div><div class="indexdiv"><h3>M</h3><dl><dt>map event representation, <a class="indexterm" href="#appendix_eventrepmap">Event Representation: java.util.Map Events</a></dt><dt>match recognize</dt><dd><dl><dt>comparison, <a class="indexterm" href="#match-recognize-compare-pattern">Comparison of Match Recognize and EPL Patterns</a></dt><dt>overview, <a class="indexterm" href="#match-recognize-intro">Overview</a></dt></dl></dd><dt>match_recognize</dt><dd><dl><dt>operator precedences, <a class="indexterm" href="#match-recognize-patternops-precedence">Operator Precedence</a></dt></dl></dd><dt>max function, <a class="indexterm" href="#epl-single-row-function-ref-minmax">The Min and Max Functions</a></dt><dt>maximum-by, <a class="indexterm" href="#epl-function-aggregation-event-maxby">Maxby Aggregation Function</a></dt><dt>merge, <a class="indexterm" href="#named_upsert">Triggered Upsert Using the On-Merge Clause</a></dt><dt>method</dt><dd><dl><dt>spatial, <a class="indexterm" href="#spatial_method">Spatial Methods</a></dt></dl></dd><dt>methods</dt><dd><dl><dt>date-time, <a class="indexterm" href="#datetime-intro">Overview</a></dt><dt>enumeration, <a class="indexterm" href="#enumeration-intro">Overview</a></dt></dl></dd><dt>min function, <a class="indexterm" href="#epl-single-row-function-ref-minmax">The Min and Max Functions</a></dt><dt>minimum-by, <a class="indexterm" href="#epl-function-aggregation-event-minby">Minby Aggregation Function</a></dt><dt>MVEL, <a class="indexterm" href="#script-overview">Overview</a></dt></dl></div><div class="indexdiv"><h3>N</h3><dl><dt>named window, <a class="indexterm" href="#nwtable-overview-namedwindow">Named Window Overview</a></dt><dd><dl><dt>create index, <a class="indexterm" href="#named_explicit_index">Explicitly Indexing Named Windows and Tables</a></dt><dt>deleting from, <a class="indexterm" href="#named_delete">Deleting Data: The On Delete Clause</a>, <a class="indexterm" href="#named_delete_faf">Deleting Data</a></dt><dt>index, <a class="indexterm" href="#named_explicit_index">Explicitly Indexing Named Windows and Tables</a></dt><dt>inserting into, <a class="indexterm" href="#named_inserting">Inserting Into Named Windows</a>, <a class="indexterm" href="#named_insertfaf">Inserting Data</a></dt><dt>merge, <a class="indexterm" href="#named_upsert">Triggered Upsert Using the On-Merge Clause</a></dt><dt>populating from a named window, <a class="indexterm" href="#named_populate_named">Populating a Named Window From an Existing Named Window</a></dt><dt>selecting from, <a class="indexterm" href="#named_selecting">Selecting From Named Windows</a></dt><dt>triggered select and delete using On Select Delete, <a class="indexterm" href="#named_selectdelete">Triggered Select+Delete: The On Select Delete Clause</a></dt><dt>triggered select using On Select, <a class="indexterm" href="#named_querying">Triggered Select: The On Select Clause</a></dt><dt>updating, <a class="indexterm" href="#named_update">Updating Data: The On Update Clause</a>, <a class="indexterm" href="#named_update_faf">Updating Data</a></dt><dt>upsert, <a class="indexterm" href="#named_upsert">Triggered Upsert Using the On-Merge Clause</a></dt><dt>versioning events, <a class="indexterm" href="#named_versioning">Versioning and Revision Event Type Use With Named Windows</a></dt></dl></dd><dt>named windows</dt><dd><dl><dt>overview, <a class="indexterm" href="#nwtable-overview">Overview</a></dt></dl></dd><dt>new, <a class="indexterm" href="#epl-operator-new">The 'New' Keyword</a></dt><dt>not pattern operator, <a class="indexterm" href="#pattern-logical-not">Not</a></dt></dl></div><div class="indexdiv"><h3>O</h3><dl><dt>object-array event representation, <a class="indexterm" href="#appendix_eventrepoa">Event Representation: Object-Array (Object[]) Events</a></dt><dt>on-delete, <a class="indexterm" href="#named_delete">Deleting Data: The On Delete Clause</a></dt><dt>on-select, <a class="indexterm" href="#named_querying">Triggered Select: The On Select Clause</a></dt><dt>on-select-delete, <a class="indexterm" href="#named_selectdelete">Triggered Select+Delete: The On Select Delete Clause</a></dt><dt>on-update, <a class="indexterm" href="#named_update">Updating Data: The On Update Clause</a></dt><dt>operators</dt><dd><dl><dt>arithmetic, <a class="indexterm" href="#epl-operator-ref-arithmetic">Arithmetic Operators</a></dt><dt>array definition, <a class="indexterm" href="#epl-operator-ref-array">Array Definition Operator</a></dt><dt>between, <a class="indexterm" href="#epl-operator-ref-keyword-between">The 'Between' Keyword</a></dt><dt>binary, <a class="indexterm" href="#epl-operator-ref-binary">Binary Operators</a></dt><dt>concatenation, <a class="indexterm" href="#epl-operator-ref-string">Concatenation Operators</a></dt><dt>dot (period), <a class="indexterm" href="#epl-operator-ref-dot">Dot Operator</a></dt><dt>in, <a class="indexterm" href="#epl-operator-ref-keyword-in">The 'In' Keyword</a></dt><dt>like, <a class="indexterm" href="#epl-operator-ref-keyword-like">The 'Like' Keyword</a></dt><dt>logical and comparison, <a class="indexterm" href="#epl-operator-ref-logical">Logical and Comparison Operators</a></dt><dt>new, <a class="indexterm" href="#epl-operator-new">The 'New' Keyword</a></dt><dt>regexp, <a class="indexterm" href="#epl-operator-ref-keyword-regexp">The 'Regexp' Keyword</a></dt></dl></dd><dt>or pattern operator, <a class="indexterm" href="#pattern-logical-or">Or</a></dt><dt>order by clause, <a class="indexterm" href="#epl-order-by">Sorting Output: the Order By Clause</a></dt><dt>ordered, <a class="indexterm" href="#epl-function-aggregation-event-sorted">Sorted Aggregation Function</a></dt><dt>ordering output, <a class="indexterm" href="#epl-order-by">Sorting Output: the Order By Clause</a></dt><dt>OSGi, <a class="indexterm" href="#api-osgi">OSGi, Class Loader, Class-For-Name</a></dt><dt>outer join, <a class="indexterm" href="#epl-outerjoin">Outer, Left and Right Joins</a></dt><dt>output</dt><dd><dl><dt>snapshot, <a class="indexterm" href="#epl-output-snapshot">Output Snapshot</a></dt><dt>suppressing output, <a class="indexterm" href="#epl-output-suppress">Suppressing Output With After</a></dt></dl></dd><dt>output control and stabilizing clause, <a class="indexterm" href="#epl-output-rate">Stabilizing and Controlling Output: The Output Clause</a></dt><dt>output ordering, <a class="indexterm" href="#epl-order-by">Sorting Output: the Order By Clause</a></dt><dt>output row count, <a class="indexterm" href="#epl-limit">Limiting Row Count: the Limit Clause</a></dt><dt>output when, <a class="indexterm" href="#epl-output-expression">Controlling Output Using an Expression</a></dt></dl></div><div class="indexdiv"><h3>P</h3><dl><dt>packaging</dt><dd><dl><dt>EPDeploymentAdmin interface, <a class="indexterm" href="#devlifecycle-admin">The Deployment Administrative Interface</a></dt><dt>EPL module, <a class="indexterm" href="#devlifecycle-eplmodule">EPL Modules</a></dt><dt>J2EE, <a class="indexterm" href="#devlifecycle-j2ee">J2EE Packaging and Deployment</a></dt></dl></dd><dt>pattern</dt><dd><dl><dt>filter event consumption, <a class="indexterm" href="#pattern-filter-consumption">Controlling Event Consumption</a></dt><dt>filter expressions, <a class="indexterm" href="#pattern-filter">Filter Expressions in Patterns</a></dt><dt>named window, <a class="indexterm" href="#pattern-filter-namedwindow">Use With Named Windows and Tables</a></dt><dt>operator precedences, <a class="indexterm" href="#pattern-op-precedence">Operator Precedence</a></dt><dt>overview, <a class="indexterm" href="#event-pattern-intro">Event Pattern Overview</a></dt><dt>table, <a class="indexterm" href="#pattern-filter-namedwindow">Use With Named Windows and Tables</a></dt><dt>walkthrough, <a class="indexterm" href="#pattern-walkthrough">Event Pattern Walkthrough</a></dt></dl></dd><dt>pattern atom, <a class="indexterm" href="#pattern-atoms">Pattern Atoms</a></dt><dt>pattern guard, <a class="indexterm" href="#pattern-guards">Pattern Guards</a></dt><dd><dl><dt>custom plug-in, <a class="indexterm" href="#custom-pattern-guard">Pattern Guard</a></dt><dt>timer-within, <a class="indexterm" href="#pattern-guards-timerwithin">The timer:within Pattern Guard</a></dt><dt>timer-withinmax, <a class="indexterm" href="#pattern-guards-timerwithinmax">The timer:withinmax Pattern Guard</a></dt><dt>while, <a class="indexterm" href="#pattern-guards-while">The while Pattern Guard</a></dt></dl></dd><dt>pattern observer</dt><dd><dl><dt>custom plug-in, <a class="indexterm" href="#custom-pattern-observer">Pattern Observer</a></dt><dt>timer-at, <a class="indexterm" href="#pattern-timer-at">Crontab (timer:at)</a></dt><dt>timer-interval, <a class="indexterm" href="#pattern-timer-interval">Interval (timer:interval)</a></dt><dt>timer-schedule, <a class="indexterm" href="#pattern-timer-schedule">Schedule (timer:schedule)</a></dt></dl></dd><dt>pattern operator</dt><dd><dl><dt>and, <a class="indexterm" href="#pattern-logical-and">And</a></dt><dt>every, <a class="indexterm" href="#pattern-logical-every">Every</a></dt><dt>every-distinct, <a class="indexterm" href="#pattern-logical-everydistinct">Every-Distinct</a></dt><dt>followed-by, <a class="indexterm" href="#pattern-temporal-followed-by">Followed-By</a></dt><dt>not, <a class="indexterm" href="#pattern-logical-not">Not</a></dt><dt>or, <a class="indexterm" href="#pattern-logical-or">Or</a></dt></dl></dd><dt>PERL, <a class="indexterm" href="#script-overview">Overview</a></dt><dt>PHP, <a class="indexterm" href="#script-overview">Overview</a></dt><dt>plug-in</dt><dd><dl><dt>custom aggregation function, <a class="indexterm" href="#custom-aggregation-function">Aggregation Function</a></dt><dt>custom event object, <a class="indexterm" href="#custom-event-representation">Event Type and Event Object</a></dt><dt>custom pattern guard, <a class="indexterm" href="#custom-pattern-guard">Pattern Guard</a></dt><dt>custom pattern observer, <a class="indexterm" href="#custom-pattern-observer">Pattern Observer</a></dt><dt>custom view, <a class="indexterm" href="#custom-views">Derived-Value and Data Window View</a></dt><dt>single-row function, <a class="indexterm" href="#custom-singlerow-function">Single-Row Function</a></dt></dl></dd><dt>plug-in loader, <a class="indexterm" href="#api-plugin">Plug-In Loader</a></dt><dt>previous count function, <a class="indexterm" href="#epl-single-row-function-ref-previouscount">The Previous-Count Function</a></dt><dt>previous function, <a class="indexterm" href="#epl-single-row-function-ref-previous">The Previous Function</a></dt><dt>previous tail function, <a class="indexterm" href="#epl-single-row-function-ref-previoustail">The Previous-Tail Function</a></dt><dt>previous window function, <a class="indexterm" href="#epl-single-row-function-ref-previouswindow">The Previous-Window Function</a></dt><dt>prior function, <a class="indexterm" href="#epl-single-row-function-ref-prior">The Prior Function</a></dt><dt>pull API, <a class="indexterm" href="#api-admin-iterators">Using Iterators</a></dt><dt>Python, <a class="indexterm" href="#script-overview">Overview</a></dt></dl></div><div class="indexdiv"><h3>R</h3><dl><dt>ranked window, <a class="indexterm" href="#view-ext-rank">Ranked Window (rank or ext:rank)</a></dt><dt>regexp operator, <a class="indexterm" href="#epl-operator-ref-keyword-regexp">The 'Regexp' Keyword</a></dt><dt>regression, <a class="indexterm" href="#view-stat-linest">Regression Derived-Value Window (linest or stat:linest)</a></dt><dt>relational databases, <a class="indexterm" href="#histdata_overview">Accessing Relational Data via SQL</a></dt><dt>Ruby, <a class="indexterm" href="#script-overview">Overview</a></dt></dl></div><div class="indexdiv"><h3>S</h3><dl><dt>safe iterator, <a class="indexterm" href="#api-admin-iterators">Using Iterators</a></dt><dt>script</dt><dd><dl><dt>declaring, <a class="indexterm" href="#create-exprglobal">Declaring Global Expressions, Aliases and Scripts: Create Expression</a></dt></dl></dd><dt>script declaration, <a class="indexterm" href="#epl-syntax-script-decl">Script Declaration</a>, <a class="indexterm" href="#script-overview">Overview</a></dt><dt>select clause, <a class="indexterm" href="#epl-select-list">Choosing Event Properties and Events: The Select Clause</a></dt><dt>single-row functions</dt><dd><dl><dt>custom plug-in, <a class="indexterm" href="#custom-singlerow-function">Single-Row Function</a></dt></dl></dd><dt>size window, <a class="indexterm" href="#view-std-size">Size Derived-Value Window (size) or std:size)</a></dt><dt>sorted, <a class="indexterm" href="#epl-function-aggregation-event-sorted">Sorted Aggregation Function</a></dt><dt>sorted window, <a class="indexterm" href="#view-ext-sort">Sorted Window (sort or ext:sort)</a></dt><dt>spatial</dt><dd><dl><dt>functions, <a class="indexterm" href="#spatial_etc">Spatial Types, Functions and Methods from External Libraries</a></dt><dt>index, <a class="indexterm" href="#spatial_index">Spatial Index - Quadtree</a></dt><dt>intro, <a class="indexterm" href="#spatial_intro">Overview</a></dt><dt>method, <a class="indexterm" href="#spatial_method">Spatial Methods</a></dt><dt>methods (external library), <a class="indexterm" href="#spatial_etc">Spatial Types, Functions and Methods from External Libraries</a></dt><dt>types, <a class="indexterm" href="#spatial_etc">Spatial Types, Functions and Methods from External Libraries</a></dt></dl></dd><dt>SQL, <a class="indexterm" href="#histdata_overview">Accessing Relational Data via SQL</a></dt><dt>statement</dt><dd><dl><dt>receiving results, <a class="indexterm" href="#api-receive-results">Receiving Statement Results</a></dt><dt>subscriber object, <a class="indexterm" href="#api-admin-subscriber">Setting a Subscriber Object</a></dt></dl></dd><dt>StatementAwareUpdateListener interface, <a class="indexterm" href="#api-admin-listeners">Adding Listeners</a></dt><dt>static Java methods, <a class="indexterm" href="#epl-single-row-function-ref">Single-Row Function Reference</a></dt><dt>subqueries, <a class="indexterm" href="#epl-subqueries">Subqueries</a></dt><dt>subscriber object, <a class="indexterm" href="#api-admin-subscriber">Setting a Subscriber Object</a></dt><dd><dl><dt>EPStatement, <a class="indexterm" href="#api-admin-subscriber-epstatement">Using the EPStatement Parameter</a></dt><dt>multi-row, <a class="indexterm" href="#api-admin-subscriber-multirow">Multi-Row Delivery</a></dt><dt>no-parameter, <a class="indexterm" href="#api-admin-subscriber-null">No-Parameter Update Method</a></dt><dt>row-by-row, <a class="indexterm" href="#api-admin-subscriber-rowbyrow">Row-by-Row Delivery</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>T</h3><dl><dt>table, <a class="indexterm" href="#nwtable-overview-table">Table Overview</a></dt><dd><dl><dt>create index, <a class="indexterm" href="#named_explicit_index">Explicitly Indexing Named Windows and Tables</a></dt><dt>deleting from, <a class="indexterm" href="#named_delete_faf">Deleting Data</a></dt><dt>index, <a class="indexterm" href="#named_explicit_index">Explicitly Indexing Named Windows and Tables</a></dt><dt>inserting into, <a class="indexterm" href="#nwtable-insert">Inserting Into Tables</a>, <a class="indexterm" href="#named_insertfaf">Inserting Data</a></dt><dt>merge, <a class="indexterm" href="#named_upsert">Triggered Upsert Using the On-Merge Clause</a></dt><dt>selecting from, <a class="indexterm" href="#nwtable-table-selecting">Selecting From Tables</a></dt><dt>updating, <a class="indexterm" href="#named_update_faf">Updating Data</a></dt><dt>upsert, <a class="indexterm" href="#named_upsert">Triggered Upsert Using the On-Merge Clause</a></dt></dl></dd><dt>tables</dt><dd><dl><dt>overview, <a class="indexterm" href="#nwtable-overview">Overview</a></dt></dl></dd><dt>testing, <a class="indexterm" href="#api-testing">Test and Assertion Support</a></dt><dt>threading, <a class="indexterm" href="#api-threading">Engine Threading and Concurrency</a></dt><dt>time</dt><dd><dl><dt>controlling, <a class="indexterm" href="#api-controlling-time">Controlling Time-Keeping</a></dt><dt>resolution, <a class="indexterm" href="#api-time-resolution">Time Resolution and Time Unit</a></dt></dl></dd><dt>time batch window, <a class="indexterm" href="#view-win-time-batch">Time batch Window (time_batch or win:time_batch)</a></dt><dt>time length batch window, <a class="indexterm" href="#view-win-time-length-batch">Time-Length Combination Batch Window (time_length_batch or win:time_length_batch)</a></dt><dt>time window, <a class="indexterm" href="#view-win-time">Time Window (time or win:time)</a></dt><dt>time-accumulating window, <a class="indexterm" href="#view-win-time-accumulating">Time-Accumulating Window (time_accum or win:time_accum)</a></dt><dt>time-order window, <a class="indexterm" href="#view-time-order">Time-Order Window (time_order or ext:time_order)</a></dt><dt>time-to-live window, <a class="indexterm" href="#view-timetolive">Time-To-Live Window (timetolive or ext:timetolive)</a></dt><dt>timer-at pattern observer, <a class="indexterm" href="#pattern-timer-at">Crontab (timer:at)</a></dt><dt>timer-interval pattern observer, <a class="indexterm" href="#pattern-timer-interval">Interval (timer:interval)</a></dt><dt>timer-schedule pattern observer, <a class="indexterm" href="#pattern-timer-schedule">Schedule (timer:schedule)</a></dt><dt>timer-within pattern guard, <a class="indexterm" href="#pattern-guards-timerwithin">The timer:within Pattern Guard</a></dt><dt>timer-withinmax pattern guard, <a class="indexterm" href="#pattern-guards-timerwithinmax">The timer:withinmax Pattern Guard</a></dt><dt>type-of function, <a class="indexterm" href="#epl-single-row-function-typeof">The Type-Of Function</a></dt></dl></div><div class="indexdiv"><h3>U</h3><dl><dt>UDF</dt><dd><dl><dt>user-defined function, <a class="indexterm" href="#epl-function-user-defined">User-Defined Functions</a></dt></dl></dd><dt>unidirectional full outer joins, <a class="indexterm" href="#epl-unidirectional-fullouterjoin">Unidirectional Full Outer Joins</a></dt><dt>unidirectional joins, <a class="indexterm" href="#epl-unidirectional">Unidirectional Joins</a></dt><dt>unique window, <a class="indexterm" href="#view-std-unique">Unique Window (unique or std:unique)</a></dt><dt>univariate statistics, <a class="indexterm" href="#view-stat-uni">Univariate Statistics Derived-Value Window (uni or stat:uni)</a></dt><dt>UnmatchedListener interface, <a class="indexterm" href="#api-runtime-unmatched">Receiving Unmatched Events</a></dt><dt>update, <a class="indexterm" href="#named_update_faf">Updating Data</a></dt><dt>UpdateListener interface, <a class="indexterm" href="#api-admin-listeners">Adding Listeners</a></dt><dt>upsert, <a class="indexterm" href="#named_upsert">Triggered Upsert Using the On-Merge Clause</a></dt><dt>user-defined function, <a class="indexterm" href="#epl-function-user-defined">User-Defined Functions</a></dt><dt>user-defined single-row function, <a class="indexterm" href="#epl-single-row-function-ref">Single-Row Function Reference</a></dt></dl></div><div class="indexdiv"><h3>V</h3><dl><dt>variable, <a class="indexterm" href="#variables_overview">Variables and Constants</a></dt><dt>variant stream, <a class="indexterm" href="#insert-into-merging-types">Merging Disparate Types of Events: Variant Streams</a></dt></dl></div><div class="indexdiv"><h3>W</h3><dl><dt>weighted average, <a class="indexterm" href="#view-stat-weightedavg">Weighted Average Derived-Value Window (weighted_avg or stat:weighted_avg)</a></dt><dt>where clause, <a class="indexterm" href="#epl-where-clause">Specifying Search Conditions: The Where Clause</a></dt><dt>while pattern guard, <a class="indexterm" href="#pattern-guards-while">The while Pattern Guard</a></dt></dl></div><div class="indexdiv"><h3>X</h3><dl><dt>XML event representation, <a class="indexterm" href="#appendix_eventrepxml">Event Representation: org.w3c.dom.Node XML Events</a></dt></dl></div></div></div></div></body></html>